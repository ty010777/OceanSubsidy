<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="../script/map/jquery.js" type="text/javascript"></script>
    <script src="../script/map/bootstrap.js" type="text/javascript"></script>
    <link href="../App_Themes/map/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/map/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/Map/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/map/css/map.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/map/css/nanoscroller.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/Map/css/table.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript">
        var resizeInterval = null;
        var mapPlugin = parent.mapPlugin;
        $(function () {
            district_init();
            resizeLayout();
        });
        function resizeLayout() {
            clearInterval(resizeInterval);
            resizeInterval = setInterval(function () {
                parent.resizeBox($(".nano").offset().top + $(".tab-content").height() + 15);
                if ($(".nano").height() != ($("html").height() - $(".nano").offset().top)) {
                    $(".nano").height($("html").height() - $(".nano").offset().top);
                }
                clearInterval(resizeInterval);
            }, 200);
        }
        $(window).on("resize", function () {
            resizeLayout();
        });

        function switchLocateType(obj, target) {
            $("#lnk_" + target).tab('show');
            var $tabs = $(".TabBox .BtnTab");
            $tabs.removeClass("TabActive");
            $tabs.each(function () {
                if (this == obj) {
                    $(obj).addClass("TabActive");
                }
            });
            // 呼叫各個定位的初始動作
            try {
                eval(target + "_init();");
            } catch (e) {
            }
            resizeLayout();
        }
        function fillDropdownList(target, dataUrl, bKeepFirst, finishFunc) {
            var $target = null;
            if ($.prototype.isPrototypeOf(target)) {
                // target是jQuery物件
                $target = target;
            } else if (typeof target == "string") {
                // target是String
                $target = $("#" + target);
            } else {
                // 必須是html物件
                $target = $(target);
            }
            $.ajax({
                url: dataUrl,
                success: function (data) {
                    if (bKeepFirst) $target[0].options.length = 1;
                    else $target.children().remove();
                    for (var i = 0; i < data.length; i++) {
                        $($target[0]).append("<option value='" + data[i].key + "'>" + data[i].value + "</option");
                    }
                    if (finishFunc) finishFunc();
                }
            });

        }
    </script>
    <!--- for district --->
    <script type="text/javascript">
        function district_init() {
            genCounties();
        }
        function genCounties() {
            if ($("#ddlCounty").children().length == 0) {
                fillDropdownList("ddlCounty", "../Service/KeyValueDataSource.ashx?data=county", false, function () { $("#ddlCounty > option:contains('嘉義縣')").attr("selected", "selected"); genTowns(); });
            } else {
                return;
            }
        }
        function genTowns() {
            fillDropdownList("ddlTown", "../Service/KeyValueDataSource.ashx?data=town&county=" + encodeURIComponent($("#ddlCounty").val()), true);
        }
        function genVillages() {
            fillDropdownList("ddlVillage", "../Service/KeyValueDataSource.ashx?data=village&county=" + encodeURIComponent($("#ddlCounty").val()) + "&town=" + encodeURIComponent($("#ddlTown").val()), true);
        }
        function locateToDistrict() {
            var dataUrl = null;
            var labelText = null;
            if ($("#ddlVillage").val() != "") {
                dataUrl = "../Service/GetLocationInfo.ashx?data=village&county=" + encodeURIComponent($("#ddlCounty").val()) + "&town=" + encodeURIComponent($("#ddlTown").val()) + "&village=" + encodeURIComponent($("#ddlVillage").val());
                labelText = $('#ddlCounty :selected').text() + $('#ddlTown :selected').text() + $('#ddlVillage :selected').text();
            } else if ($("#ddlTown").val() != "") {
                dataUrl = "../Service/GetLocationInfo.ashx?data=town&county=" + encodeURIComponent($("#ddlCounty").val()) + "&town=" + encodeURIComponent($("#ddlTown").val());
                labelText = $('#ddlCounty :selected').text() + $('#ddlTown :selected').text();
            } else {
                dataUrl = "../Service/GetLocationInfo.ashx?data=county&county=" + encodeURIComponent($("#ddlCounty").val());
                labelText = $('#ddlCounty :selected').text();
            }
            $.ajax({
                url: dataUrl,
                success: function (data) {
                    parent.mapPlugin.locateTool.locateToWKT(data, "EPSG:4326", true, labelText);
                }
            });
        }
    </script>
    <!--- end district --->
    <!--- for address --->
    <script type="text/javascript">
        function address_init() {
        }
        function queryAddress() {
            $.ajax("../service/TGOS_Geocoder.ashx?addr=" + encodeURIComponent($.trim($("#txtAddress").val())))
             .then(
                    function (resp) {
                        if (resp.AddressList.length == 0) {
                            alert(resp.Info[0].OutTraceInfo);
                        } else {
                            var addr = resp.AddressList[0];
                            var coord = [addr.X, addr.Y];
                            var labelText = $("#txtAddress").val();
                            mapPlugin.showBubble({ coord: coord, proj: "EPSG:4326" }, addr.FULL_ADDR);
                            mapPlugin.locateTool.locateToCoord(coord, "EPSG:4326", labelText);
                        }
                    },
                    function () {
                        alert("目前此服務無法使用");
                    }
                );
        }
    </script>
    <!--- end address --->
    <!--- for coordinate --->
    <script type="text/javascript">
        function coordinate_init() {
        }
        // 以十進位經緯度定位
        function locateByWGS84Decimal() {
            var lat = parseFloat($("#txtLatCoord").val());
            var lng = parseFloat($("#txtLngCoord").val());
            var labelText = lat.toString() + ", " + lng.toString();
            if (isNaN(lat) || isNaN(lng)) {
                alert("經緯度必須是數字");
                return;
            }
            parent.mapPlugin.locateTool.locateToCoord([lng, lat], "EPSG:4326", true, labelText);
            parent.map.getView().setZoom(13);
        }
        // 以度分秒經緯度定位
        function locateByWGS84DMS() {
            var lat = parseFloat($("#txtLatDegree").val())
                    + (isNaN(parseFloat($("#txtLatMinute").val())) ? 0 : parseFloat($("#txtLatMinute").val())) / 60
                    + (isNaN(parseFloat($("#txtLatSecond").val())) ? 0 : parseFloat($("#txtLatSecond").val())) / 3600;

            var lng = parseFloat($("#txtLngDegree").val())
                    + (isNaN(parseFloat($("#txtLngMinute").val())) ? 0 : parseFloat($("#txtLngMinute").val())) / 60
                    + (isNaN(parseFloat($("#txtLngSecond").val())) ? 0 : parseFloat($("#txtLngSecond").val())) / 3600;
            var labelText = $("#txtLatDegree").val() + "度"
                + (isNaN(parseFloat($("#txtLatMinute").val())) ? 0 : $("#txtLatMinute").val()) + "分"
                + (isNaN(parseFloat($("#txtLatSecond").val())) ? 0 : $("#txtLatSecond").val()) + "秒, "
                + $("#txtLngDegree").val() + "度"
                + (isNaN(parseFloat($("#txtLngMinute").val())) ? 0 : $("#txtLngMinute").val()) + "分"
                + (isNaN(parseFloat($("#txtLngSecond").val())) ? 0 : $("#txtLngSecond").val()) + "秒";
            if (isNaN(lat) || isNaN(lng)) {
                alert("經緯度必須是數字");
                return;
            }
            parent.mapPlugin.locateTool.locateToCoord([lng, lat], "EPSG:4326", true, labelText);
            parent.map.getView().setZoom(13);
        }
        function locateByTWD97() {
            var coordX = parseFloat($("#txtTWD97X").val());
            var coordY = parseFloat($("#txtTWD97Y").val());
            var labelText = coordX + ", " + coordY;
            if (isNaN(coordX) || isNaN(coordY)) {
                alert("坐標必須是數字");
                return;
            }
            parent.mapPlugin.locateTool.locateToCoord([coordX, coordY], "EPSG:3826", true, labelText);
            parent.map.getView().setZoom(13);
        }
        function locateByTWD67() {
            var coordX = parseFloat($("#txtTWD67X").val());
            var coordY = parseFloat($("#txtTWD67Y").val());
            var labelText = coordX + ", " + coordY;
            if (isNaN(coordX) || isNaN(coordY)) {
                alert("坐標必須是數字");
                return;
            }
            parent.mapPlugin.locateTool.locateToCoord([coordX, coordY], "EPSG:3828", true, labelText);
            parent.map.getView().setZoom(13);
        }
        function switchCoordType(obj) {
            $("._coordTab").removeClass("BtnOrangeActive");
            $(obj).addClass("BtnOrangeActive");
            $("._coordPanel").hide();
            $("#" + obj.value + "Panel").show();
            resizeLayout();
        }
    </script>
    <!--- end coordinate --->
    <!--- for cadastre --->
    <script type="text/javascript">
    </script>
    <!--- end cadastre --->
    <!-- page event -->
    <script type="text/javascript">
        function page_active() {
            parent.useMisFunctonFrame.CloseFullDownFrame();
        }
        function page_leave() {
        }
        // 關閉全部時，此功能需做的動作
        function action_clear() {
            mapPlugin.locateTool.clearLocatedFeature();
        }
        helpHtml = "";
    </script>
</head>
<body>
    <!--關閉+說明-->
    <div class="BtnFunc">
        <ul>
            <li class="close"><a href="javascript:void(0);parent.toolSwitch()">關閉</a></li>
            <!--<li class="help"><a href="javascript:void(0);" onclick="parent.showHelp(helpHtml);">說明</a></li>-->
        </ul>
    </div>
    <!--頁籤-->
    <div class="TabBox">
        <input type="submit" onclick="switchLocateType(this,'district')" class="BtnTab TabActive"
            value="行政區" />
        <input type="submit" onclick="switchLocateType(this,'address')" class="BtnTab" value="地址" />
        <input type="submit" onclick="switchLocateType(this,'coordinate')" class="BtnTab"
            value="坐標" />
        <!--<input type="submit" onclick="switchLocateType(this,'cadastre')" class="BtnTab" value="地籍" />-->
    </div>
    <ul style="display: none">
        <li role="presentation"><a id="lnk_district" href="#district" role="tab"></a></li>
        <li role="presentation"><a id="lnk_address" href="#address" role="tab"></a></li>
        <li role="presentation"><a id="lnk_coordinate" href="#coordinate" role="tab"></a>
        </li>
        <li role="presentation"><a id="lnk_cadastre" href="#cadastre" role="tab"></a></li>
        <li role="presentation"><a id="lnk_roadkilometer" href="#roadkilometer" role="tab"></a>
        </li>
        <li role="presentation"><a id="lnk_eng" href="#eng" role="tab"></a></li>
        <li role="presentation"><a id="lnk_watershed" href="#watershed" role="tab"></a></li>
        <li role="presentation"><a id="lnk_structure" href="#structure" role="tab"></a></li>
        <li role="presentation"><a id="lnk_drainage" href="#drainage" role="tab"></a></li>
    </ul>
    <!--頁籤結尾-->
    <!--可捲動範圍-->
    <div class="nano">
        <div class="nano-content">
            <div class="tab-content">
                <input type="button" class="BtnClear" value="清除所有定位" style="float: right"
                    onclick="parent.mapPlugin.locateTool.clearLocatedFeature()" />
                <!-- 行政區定位 -->
                <div role="tabpanel" class="tab-pane active" id="district">
                    <div style="display: inline-block; width: 100%;">
                        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                            <tr>
                                <th width="20%">
                                    縣市
                                </th>
                                <td width="80%">
                                    <select id="ddlCounty" onchange="genTowns()">
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    鄉鎮區
                                </th>
                                <td>
                                    <select id="ddlTown" onchange="genVillages()">
                                        <option value="">全鄉鎮區</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    村里
                                </th>
                                <td>
                                    <select id="ddlVillage">
                                        <option value="">全村里</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;
                                    
                                </td>
                                <td>
                                    <input type="button" id="btnLocateToDistrict" class="BtnWhite" value="定位" onclick="locateToDistrict()" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <!-- 地址定位 -->
                <div role="tabpanel" class="tab-pane" id="address">
                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                        <tr>
                            <th width="56">
                                地址
                            </th>
                            <td>
                                <input type="text" id="txtAddress" style="width: 100%" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: center">
                                <input type="button" value="定位" class="BtnWhite" onclick="queryAddress();" />
                            </td>
                        </tr>
                    </table>
                </div>
                <!-- 坐標定位 -->
                <div role="tabpanel" class="tab-pane" id="coordinate">
                    <div style="display: inline-block; width: 100%; padding: 0px; margin: 0px;">
                        <p>&nbsp;
                            
                        </p>
                        <p>
                            <input type="button" name="button" class="BtnOrange _coordTab BtnOrangeActive" value="WGS84"
                                onclick="switchCoordType(this)" />
                            <input type="button" name="button" class="BtnOrange _coordTab" value="TWD97" onclick="switchCoordType(this)" />
                            <input type="button" name="button" class="BtnOrange _coordTab" value="TWD67" onclick="switchCoordType(this)" />
                        </p>
                        <!-- 經緯度定位介面 -->
                        <div id="WGS84Panel" class="_coordPanel Location">
                            <h4>
                                十進位</h4>
                            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                                <tr>
                                    <th width="56">
                                        經度
                                    </th>
                                    <td>
                                        <input type="text" id="txtLngCoord" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        緯度
                                    </th>
                                    <td>
                                        <input type="text" id="txtLatCoord" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <input type="button" name="button2" class="BtnWhite" value="定位" onclick="locateByWGS84Decimal()" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <span class="txt02">例如:<br />
                                            經度 120.453607<br />
                                            緯度 23.481530</span>
                                    </td>
                                </tr>
                            </table>
                            <h4>
                                度分秒</h4>
                            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                                <tr>
                                    <th>
                                        經度
                                    </th>
                                    <td>
                                        <input type="text" id="txtLngDegree" size="5" value="121" />
                                        度
                                        <input type="text" id="txtLngMinute" size="5" />
                                        分
                                        <input type="text" id="txtLngSecond" size="5" />
                                        秒
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        緯度
                                    </th>
                                    <td>
                                        <input type="text" id="txtLatDegree" size="5" value="23" />
                                        度
                                        <input type="text" id="txtLatMinute" size="5" />
                                        分
                                        <input type="text" id="txtLatSecond" size="5" />
                                        秒
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <input type="button" name="button2" id="button2" class="BtnWhite" value="定位" onclick="locateByWGS84DMS()" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <span class="txt02">例如:<br />
                                            經度 120度58分55.29秒<br />
                                            緯度 23度58分25.9秒</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!-- TWD97定位介面 -->
                        <div id="TWD97Panel" class="_coordPanel" style="display: none">
                            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                                <tr>
                                    <th width="60">
                                        X坐標
                                    </th>
                                    <td>
                                        <input type="text" id="txtTWD97X" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        Y坐標
                                    </th>
                                    <td>
                                        <input type="text" id="txtTWD97Y" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <input type="button" name="button2" class="BtnWhite" value="定位" onclick="locateByTWD97()" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <span class="txt02">例如:<br />
                                            X坐標 194188
                                            <br />
                                            Y坐標 2597712</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!-- TWD67定位介面 -->
                        <div id="TWD67Panel" class="_coordPanel" style="display: none">
                            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                                <tr>
                                    <th width="60">
                                        X坐標
                                    </th>
                                    <td>
                                        <input type="text" id="txtTWD67X" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        Y坐標
                                    </th>
                                    <td>
                                        <input type="text" id="txtTWD67Y" size="10" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <input type="button" name="button2" class="BtnWhite" value="定位" onclick="locateByTWD67()" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>&nbsp;
                                        
                                    </td>
                                    <td>
                                        <span class="txt02">例如:<br />
                                            X坐標 194188<br />
                                            Y坐標 2597712</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- 地籍定位 -->
                <div role="tabpanel" class="tab-pane" id="cadastre">
                    <div style="display: inline-block; width: 100%;">
                        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="ListGrey">
                            <tr>
                                <th width="20%">
                                    縣市
                                </th>
                                <td width="80%">
                                    <select id="ddlCadasterCounty" onchange="genTowns()">
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    鄉鎮區
                                </th>
                                <td>
                                    <select id="ddlCadasterTown" onchange="genVillages()">
                                        <option value="">全鄉鎮區</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    段
                                </th>
                                <td>
                                    <select id="ddlCadasterSection">
                                        <option value="">全村里</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    小段
                                </th>
                                <td>
                                    <select id="ddlCadasterSubSection">
                                        <option value="">全村里</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;
                                    
                                </td>
                                <td>
                                    <input type="button" class="BtnWhite" value="定位" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--可捲動範圍結尾-->
</body>
</html>
