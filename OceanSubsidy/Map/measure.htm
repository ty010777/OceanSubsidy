<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../script/map/jquery.js" type="text/javascript"></script>
    <link href="../App_Themes/map/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/map/css/map.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/Map/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="../App_Themes/map/css/nanoscroller.css" rel="stylesheet" type="text/css" />
    <script src="../script/map/AssessTools.js" type="text/javascript"></script>
    <script type="text/javascript">
        var resizeInterval = null;
        var totalLength, area;
        $(function () {
            resizeInterval = setInterval(resizeLayout, 500);
        });
        function resizeLayout() {
            var content = $(".nano-content > div");
            var height = 0;
            content.each(function () {
                if ($(this).parent().css("display") != "none") {
                    height = $(this).height();
                }
            });
            parent.resizeBox($(".nano").offset().top + height + 15);
            if ($(".nano").height() != ($("html").height() - $(".nano").offset().top)) {
                $(".nano").height($("html").height() - $(".nano").offset().top);
            }
            clearInterval(resizeInterval);
        }
        $(window).on("resize", function () {
            clearInterval(resizeInterval);
            resizeInterval = setInterval(resizeLayout, 500);
        });

        function fillLength(partNum, totalLength) {
            this.totalLength = totalLength;
            switchLengthUnit();
            $("#lengthPartNum").text(partNum);
        }
        function fillArea(area, perimeter) {
            this.area = area;
            $("#perimeter").text((perimeter + "").toMoney(2));
            switchAreaUnit();
        }
        function switchTo(target) {
            $(".BtnTab").each(function () {
                var $this = $(this);
                if (this == target) {
                    parent.mapPlugin.measureLengthTool.stop();
                    parent.mapPlugin.measureLengthTool.clear();
                    parent.mapPlugin.measureAreaTool.stop();
                    parent.mapPlugin.measureAreaTool.clear();
                    $this.addClass("TabActive");
                    $(".nano-content").hide();
                    switch ($this.val()) {
                        case "距離":
                            parent.mapPlugin.measureLengthTool.start(window.fillLength);
                            helpHtml = helpHtmls[0];
                            $("li.help").show();
                            $(".nano-content.length").show();
                            break;
                        case "面積":
                            parent.mapPlugin.measureAreaTool.start(window.fillArea);
                            helpHtml = helpHtmls[1];
                            $("li.help").show();
                            $(".nano-content.area").show();
                            break;
                    }
                } else {
                    $this.removeClass("TabActive");
                }
                clearInterval(resizeInterval);
                resizeInterval = setInterval(resizeLayout, 500);
            });
        }
        function stopMeasure() {
            parent.mapPlugin.measureLengthTool.clear();
            parent.mapPlugin.measureLengthTool.stop();
            parent.mapPlugin.measureAreaTool.clear();
            parent.mapPlugin.measureAreaTool.stop();
            $(".TabBox .BtnTab").removeClass("TabActive");
            $("li.help").hide();
        }
        function resetMeasure() {
            parent.mapPlugin.measureLengthTool.clear();
            parent.mapPlugin.measureLengthTool.stop();
            parent.mapPlugin.measureAreaTool.clear();
            parent.mapPlugin.measureAreaTool.stop();
            $(".BtnTab.TabActive").click();
            $("#totalLength").html(0);
            $("#lengthPartNum").text(0);
            $("#perimeter").text(0);
            $("#area").html(0);
            $("li.help").hide();
        }
        function switchLengthUnit() {
            var currUnitLength = totalLength;
            var unitDesc = "公尺(m)";
            switch ($("#lengthUnit").val()) {
                case "m":
                    break;
                case "km":
                    unitDesc = "公里(km)";
                    currUnitLength /= 1000;
                    break;
            }
            $("#totalLength").html(((currUnitLength) + "").toMoney(2));
            $("#spanLengthUnit").html(unitDesc);
        }
        function switchAreaUnit() {
            var currUnitArea = area;
            var unitDesc = "平方公尺(m<sup>2</sup>)";
            switch ($("#areaUnit").val()) {
                case "m2":
                    break;
                case "km2":
                    unitDesc = "平方公里(km<sup>2</sup>)";
                    currUnitArea /= 1000000;
                    break;
                case "Ha":
                    unitDesc = "公頃(Ha)";
                    currUnitArea /= 10000;
            }
            $("#area").html((currUnitArea + "").toMoney(2));
            $("#spanAreaUnit").html(unitDesc);
        }
    </script>
    <!-- page event -->
    <script type="text/javascript">
        function page_active() {
            parent.useMisFunctonFrame.CloseFullDownFrame();
            $("input[type='button'][value='距離']").click();
        }
        function page_leave() {
            stopMeasure();
        }
        // 關閉全部時，此功能需做的動作
        function action_clear() {
        }
        var helpHtmls = [
            "<p>• 於圖面上點擊量測範圍，並雙擊滑鼠左鍵結束。</p><p>• 可依需求選擇量測單位。</p>",
            "<p>• 於圖面上繪製量測線段/範圍，並雙擊滑鼠左鍵結束。</p><p>• 可依需求選擇量測單位。 </p>"];
        var helpHtml = "<p>• 於圖面上繪製量測線段/範圍，並雙擊滑鼠左鍵結束。</p>"
                     + "<p>• 可依需求選擇量測單位。 </p>";
    </script>
</head>
<body>
    <div class="BtnFunc">
        <ul>
            <li class="close"><a href="javascript:void(0);parent.toolSwitch()">關閉</a></li>
            <li class="help" style="display:none"><a href="javascript:void(0);" onclick="parent.showHelp(helpHtml);">說明</a></li>
        </ul>
    </div>
    <!--關閉+說明-->
    <div class="TabBox">
        <input type="button" class="BtnTab" value="距離" onclick="switchTo(this);"/>
        <input type="button" class="BtnTab" value="面積" onclick="switchTo(this);"/>
    </div>
    <!--頁籤結尾-->
    <!--可捲動範圍-->
    <div class="nano">
        <div class="nano-content length" style="display: none">
            <div>
                <input type="button" class="BtnClear" value="清除資料" style="float: right" onclick="resetMeasure()" />
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ListGrey">
                    <tr>
                        <td>
                            長度<span class="txt03" id="totalLength">0</span><span id="spanLengthUnit">公尺(m)</span>,共<span class="txt03" id="lengthPartNum">0</span>段
                        </td>
                    </tr>
                    <tr>
                        <td>
                            切換單位
                            <select id="lengthUnit" onchange="switchLengthUnit();">
                                <option value="m">公尺</option>
                                <option value="km">公里</option>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="nano-content area" style="display: none">
            <div>
                <input type="button" class="BtnClear" value="清除資料" style="float: right" onclick="resetMeasure()" />
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ListGrey">
                    <tr>
                        <td>
                            面積<span class="txt03" id="area">0</span><span id="spanAreaUnit">平方公尺(m<sup>2</sup>)</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            邊長<span class="txt03" id="perimeter">0</span>公尺(m)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            切換單位
                            <select id="areaUnit" onchange="switchAreaUnit()">
                                <option value="m2">平方公尺</option>
                                <option value="km2">平方公里</option>
                                <option value="Ha">公頃</option>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <!--可捲動範圍結尾-->
</body>
</html>
