(function(e,Q){typeof exports=="object"&&typeof module<"u"?module.exports=Q(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],Q):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=Q(e.Vue,e.Pinia))})(this,(function(e,Q){"use strict";const I=Q.defineStore("progress",{actions:{init(_,B,b){var c,p;this[_]={id:B.ProjectID,type:(c=B.SubsidyPlanType)==null?void 0:c.split(" ")[0],name:B.ProjectName,step:B.FormStep,status:B.Status,progress:B.ProgressStatus,changeStatus:(p=B.changeApply)==null?void 0:p.Status,reportStatus:b==null?void 0:b.Status,organizer:B.Organizer,organizerName:B.OrganizerName}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let ne=Date.now();const z=(_,B,b)=>{const c=I();if([1,14].includes(c[_].status)||[1,4].includes(c[_].changeStatus))return!0;if(c[_].status===42)switch(_){case"culture":if([2,3,5].includes(b))return!0;break;case"multiple":if([2,3,4,5].includes(b))return!0;break;case"accessibility":if([2,3,4,5].includes(b))return!0;break}return!1},re=()=>`id--${ne++}`,q=_=>parseInt(_)||0,v=Q.defineStore("message",{state:()=>({error:null})}),{ajax:ae}=rxjs.ajax,{map:se}=rxjs;let Z="";const de=(_,B={})=>H("Service/OFS/Accessibility.ashx",{method:_,param:B}),ce=(_,B={})=>H("Service/OFS/Culture.ashx",{method:_,param:B}),ie=_=>`${Z}/Service/OFS/Download.ashx?path=${_}`,me=(_,B={})=>H("Service/OFS/Education.ashx",{method:_,param:B}),pe=(_,B={})=>H("Service/OFS/Literacy.ashx",{method:_,param:B}),Ve=(_,B={})=>H("Service/OFS/Multiple.ashx",{method:_,param:B}),fe=({response:_,status:B})=>{if(B===200){if(_.success)return _.data;v().error=_.message}},H=(_,B={})=>{const b={};B.constructor!==FormData&&(b["Content-Type"]="application/json");const c={body:B,headers:b,method:"POST",url:`${Z}/${_}`};return ae(c).pipe(se(fe))},A=Object.assign(H,{accessibility:de,culture:ce,download:ie,education:me,literacy:pe,multiple:Ve,setBaseUrl:_=>Z=_,system:(_,B={})=>H("Service/OFS/System.ashx",{method:_,param:B}),toUrl:_=>`${Z}${_}`,upload:_=>{const B=new FormData;return B.append("file",_),H("Service/OFS/Upload.ashx",B)}});function Ne(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var W={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var Ee=W.exports,ee;function be(){return ee||(ee=1,(function(_,B){(function(b,c,p){var f=function(o,l,s){s=n.extend({},n.options,s);var y=n.runValidations(o,l,s);if(y.some(function(E){return n.isPromise(E.error)}))throw new Error("Use validate.async if you want support for promises");return f.processValidationResults(y,s)},n=f;n.extend=function(o){return[].slice.call(arguments,1).forEach(function(l){for(var s in l)o[s]=l[s]}),o},n.extend(f,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var o=n.format("%{major}.%{minor}.%{patch}",n.version);return n.isEmpty(n.version.metadata)||(o+="+"+n.version.metadata),o}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(o,l,s){var y=[],E,h,x,g,d,a,k;(n.isDomElement(o)||n.isJqueryElement(o))&&(o=n.collectFormValues(o));for(E in l){x=n.getDeepObjectValue(o,E),g=n.result(l[E],x,o,E,s,l);for(h in g){if(d=n.validators[h],!d)throw k=n.format("Unknown validator %{name}",{name:h}),new Error(k);a=g[h],a=n.result(a,x,o,E,s,l),a&&y.push({attribute:E,value:x,validator:h,globalOptions:s,attributes:o,options:a,error:d.call(d,x,a,E,o,s)})}}return y},processValidationResults:function(o,l){o=n.pruneEmptyErrors(o,l),o=n.expandMultipleErrors(o,l),o=n.convertErrorMessages(o,l);var s=l.format||"grouped";if(typeof n.formatters[s]=="function")o=n.formatters[s](o);else throw new Error(n.format("Unknown format %{format}",l));return n.isEmpty(o)?void 0:o},async:function(o,l,s){s=n.extend({},n.async.options,s);var y=s.wrapErrors||function(h){return h};s.cleanAttributes!==!1&&(o=n.cleanAttributes(o,l));var E=n.runValidations(o,l,s);return new n.Promise(function(h,x){n.waitForResults(E).then(function(){var g=n.processValidationResults(E,s);g?x(new y(g,s,o,l)):h(o)},function(g){x(g)})})},single:function(o,l,s){return s=n.extend({},n.single.options,s,{format:"flat",fullMessages:!1}),n({single:o},{single:l},s)},waitForResults:function(o){return o.reduce(function(l,s){return n.isPromise(s.error)?l.then(function(){return s.error.then(function(y){s.error=y||null})}):l},new n.Promise(function(l){l()}))},result:function(o){var l=[].slice.call(arguments,1);return typeof o=="function"&&(o=o.apply(null,l)),o},isNumber:function(o){return typeof o=="number"&&!isNaN(o)},isFunction:function(o){return typeof o=="function"},isInteger:function(o){return n.isNumber(o)&&o%1===0},isBoolean:function(o){return typeof o=="boolean"},isObject:function(o){return o===Object(o)},isDate:function(o){return o instanceof Date},isDefined:function(o){return o!=null},isPromise:function(o){return!!o&&n.isFunction(o.then)},isJqueryElement:function(o){return o&&n.isString(o.jquery)},isDomElement:function(o){return!o||!o.querySelectorAll||!o.querySelector?!1:n.isObject(document)&&o===document?!0:typeof HTMLElement=="object"?o instanceof HTMLElement:o&&typeof o=="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName=="string"},isEmpty:function(o){var l;if(!n.isDefined(o))return!0;if(n.isFunction(o))return!1;if(n.isString(o))return n.EMPTY_STRING_REGEXP.test(o);if(n.isArray(o))return o.length===0;if(n.isDate(o))return!1;if(n.isObject(o)){for(l in o)return!1;return!0}return!1},format:n.extend(function(o,l){return n.isString(o)?o.replace(n.format.FORMAT_REGEXP,function(s,y,E){return y==="%"?"%{"+E+"}":String(l[E])}):o},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(o){return n.isNumber(o)?o*100%1===0?""+o:parseFloat(Math.round(o*100)/100).toFixed(2):n.isArray(o)?o.map(function(l){return n.prettify(l)}).join(", "):n.isObject(o)?n.isDefined(o.toString)?o.toString():JSON.stringify(o):(o=""+o,o.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(l,s,y){return""+s+" "+y.toLowerCase()}).toLowerCase())},stringifyValue:function(o,l){var s=l&&l.prettify||n.prettify;return s(o)},isString:function(o){return typeof o=="string"},isArray:function(o){return{}.toString.call(o)==="[object Array]"},isHash:function(o){return n.isObject(o)&&!n.isArray(o)&&!n.isFunction(o)},contains:function(o,l){return n.isDefined(o)?n.isArray(o)?o.indexOf(l)!==-1:l in o:!1},unique:function(o){return n.isArray(o)?o.filter(function(l,s,y){return y.indexOf(l)==s}):o},forEachKeyInKeypath:function(o,l,s){if(n.isString(l)){var y="",E,h=!1;for(E=0;E<l.length;++E)switch(l[E]){case".":h?(h=!1,y+="."):(o=s(o,y,!1),y="");break;case"\\":h?(h=!1,y+="\\"):h=!0;break;default:h=!1,y+=l[E];break}return s(o,y,!0)}},getDeepObjectValue:function(o,l){if(n.isObject(o))return n.forEachKeyInKeypath(o,l,function(s,y){if(n.isObject(s))return s[y]})},collectFormValues:function(o,l){var s={},y,E,h,x,g,d;if(n.isJqueryElement(o)&&(o=o[0]),!o)return s;for(l=l||{},x=o.querySelectorAll("input[name], textarea[name]"),y=0;y<x.length;++y)if(h=x.item(y),!n.isDefined(h.getAttribute("data-ignored"))){var a=h.name.replace(/\./g,"\\\\.");d=n.sanitizeFormValue(h.value,l),h.type==="number"?d=d?+d:null:h.type==="checkbox"?h.attributes.value?h.checked||(d=s[a]||null):d=h.checked:h.type==="radio"&&(h.checked||(d=s[a]||null)),s[a]=d}for(x=o.querySelectorAll("select[name]"),y=0;y<x.length;++y)if(h=x.item(y),!n.isDefined(h.getAttribute("data-ignored"))){if(h.multiple){d=[];for(E in h.options)g=h.options[E],g&&g.selected&&d.push(n.sanitizeFormValue(g.value,l))}else{var k=typeof h.options[h.selectedIndex]<"u"?h.options[h.selectedIndex].value:"";d=n.sanitizeFormValue(k,l)}s[h.name]=d}return s},sanitizeFormValue:function(o,l){return l.trim&&n.isString(o)&&(o=o.trim()),l.nullify!==!1&&o===""?null:o},capitalize:function(o){return n.isString(o)?o[0].toUpperCase()+o.slice(1):o},pruneEmptyErrors:function(o){return o.filter(function(l){return!n.isEmpty(l.error)})},expandMultipleErrors:function(o){var l=[];return o.forEach(function(s){n.isArray(s.error)?s.error.forEach(function(y){l.push(n.extend({},s,{error:y}))}):l.push(s)}),l},convertErrorMessages:function(o,l){l=l||{};var s=[],y=l.prettify||n.prettify;return o.forEach(function(E){var h=n.result(E.error,E.value,E.attribute,E.options,E.attributes,E.globalOptions);if(!n.isString(h)){s.push(E);return}h[0]==="^"?h=h.slice(1):l.fullMessages!==!1&&(h=n.capitalize(y(E.attribute))+" "+h),h=h.replace(/\\\^/g,"^"),h=n.format(h,{value:n.stringifyValue(E.value,l)}),s.push(n.extend({},E,{error:h}))}),s},groupErrorsByAttribute:function(o){var l={};return o.forEach(function(s){var y=l[s.attribute];y?y.push(s):l[s.attribute]=[s]}),l},flattenErrorsToArray:function(o){return o.map(function(l){return l.error}).filter(function(l,s,y){return y.indexOf(l)===s})},cleanAttributes:function(o,l){function s(h,x,g){return n.isObject(h[x])?h[x]:h[x]=g?!0:{}}function y(h){var x={},g;for(g in h)h[g]&&n.forEachKeyInKeypath(x,g,s);return x}function E(h,x){if(!n.isObject(h))return h;var g=n.extend({},h),d,a;for(a in h)d=x[a],n.isObject(d)?g[a]=E(g[a],d):d||delete g[a];return g}return!n.isObject(l)||!n.isObject(o)?{}:(l=y(l),E(o,l))},exposeModule:function(o,l,s,y,E){s?(y&&y.exports&&(s=y.exports=o),s.validate=o):(l.validate=o,o.isFunction(E)&&E.amd&&E([],function(){return o}))},warn:function(o){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+o)},error:function(o){typeof console<"u"&&console.error&&console.error("[validate.js] "+o)}}),f.validators={presence:function(o,l){if(l=n.extend({},this.options,l),l.allowEmpty!==!1?!n.isDefined(o):n.isEmpty(o))return l.message||this.message||"can't be blank"},length:function(o,l,s){if(n.isDefined(o)){l=n.extend({},this.options,l);var y=l.is,E=l.maximum,h=l.minimum,x=l.tokenizer||function(k){return k},g,d=[];o=x(o);var a=o.length;if(!n.isNumber(a))return l.message||this.notValid||"has an incorrect length";if(n.isNumber(y)&&a!==y&&(g=l.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",d.push(n.format(g,{count:y}))),n.isNumber(h)&&a<h&&(g=l.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",d.push(n.format(g,{count:h}))),n.isNumber(E)&&a>E&&(g=l.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",d.push(n.format(g,{count:E}))),d.length>0)return l.message||d}},numericality:function(o,l,s,y,E){if(n.isDefined(o)){l=n.extend({},this.options,l);var h=[],x,g,d={greaterThan:function(m,N){return m>N},greaterThanOrEqualTo:function(m,N){return m>=N},equalTo:function(m,N){return m===N},lessThan:function(m,N){return m<N},lessThanOrEqualTo:function(m,N){return m<=N},divisibleBy:function(m,N){return m%N===0}},a=l.prettify||E&&E.prettify||n.prettify;if(n.isString(o)&&l.strict){var k="^-?(0|[1-9]\\d*)";if(l.onlyInteger||(k+="(\\.\\d+)?"),k+="$",!new RegExp(k).test(o))return l.message||l.notValid||this.notValid||this.message||"must be a valid number"}if(l.noStrings!==!0&&n.isString(o)&&!n.isEmpty(o)&&(o=+o),!n.isNumber(o))return l.message||l.notValid||this.notValid||this.message||"is not a number";if(l.onlyInteger&&!n.isInteger(o))return l.message||l.notInteger||this.notInteger||this.message||"must be an integer";for(x in d)if(g=l[x],n.isNumber(g)&&!d[x](o,g)){var i="not"+n.capitalize(x),r=l[i]||this[i]||this.message||"must be %{type} %{count}";h.push(n.format(r,{count:g,type:a(x)}))}if(l.odd&&o%2!==1&&h.push(l.notOdd||this.notOdd||this.message||"must be odd"),l.even&&o%2!==0&&h.push(l.notEven||this.notEven||this.message||"must be even"),h.length)return l.message||h}},datetime:n.extend(function(o,l){if(!n.isFunction(this.parse)||!n.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(n.isDefined(o)){l=n.extend({},this.options,l);var s,y=[],E=l.earliest?this.parse(l.earliest,l):NaN,h=l.latest?this.parse(l.latest,l):NaN;if(o=this.parse(o,l),isNaN(o)||l.dateOnly&&o%864e5!==0)return s=l.notValid||l.message||this.notValid||"must be a valid date",n.format(s,{value:arguments[0]});if(!isNaN(E)&&o<E&&(s=l.tooEarly||l.message||this.tooEarly||"must be no earlier than %{date}",s=n.format(s,{value:this.format(o,l),date:this.format(E,l)}),y.push(s)),!isNaN(h)&&o>h&&(s=l.tooLate||l.message||this.tooLate||"must be no later than %{date}",s=n.format(s,{date:this.format(h,l),value:this.format(o,l)}),y.push(s)),y.length)return n.unique(y)}},{parse:null,format:null}),date:function(o,l){return l=n.extend({},l,{dateOnly:!0}),n.validators.datetime.call(n.validators.datetime,o,l)},format:function(o,l){(n.isString(l)||l instanceof RegExp)&&(l={pattern:l}),l=n.extend({},this.options,l);var s=l.message||this.message||"is invalid",y=l.pattern,E;if(n.isDefined(o)&&(!n.isString(o)||(n.isString(y)&&(y=new RegExp(l.pattern,l.flags)),E=y.exec(o),!E||E[0].length!=o.length)))return s},inclusion:function(o,l){if(n.isDefined(o)&&(n.isArray(l)&&(l={within:l}),l=n.extend({},this.options,l),!n.contains(l.within,o))){var s=l.message||this.message||"^%{value} is not included in the list";return n.format(s,{value:o})}},exclusion:function(o,l){if(n.isDefined(o)&&(n.isArray(l)&&(l={within:l}),l=n.extend({},this.options,l),!!n.contains(l.within,o))){var s=l.message||this.message||"^%{value} is restricted";return n.isString(l.within[o])&&(o=l.within[o]),n.format(s,{value:o})}},email:n.extend(function(o,l){l=n.extend({},this.options,l);var s=l.message||this.message||"is not a valid email";if(n.isDefined(o)&&(!n.isString(o)||!this.PATTERN.exec(o)))return s},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(o,l,s,y,E){if(n.isDefined(o)){n.isString(l)&&(l={attribute:l}),l=n.extend({},this.options,l);var h=l.message||this.message||"is not equal to %{attribute}";if(n.isEmpty(l.attribute)||!n.isString(l.attribute))throw new Error("The attribute must be a non empty string");var x=n.getDeepObjectValue(y,l.attribute),g=l.comparator||function(a,k){return a===k},d=l.prettify||E&&E.prettify||n.prettify;if(!g(o,x,l,s,y))return n.format(h,{attribute:d(l.attribute)})}},url:function(o,l){if(n.isDefined(o)){l=n.extend({},this.options,l);var s=l.message||this.message||"is not a valid url",y=l.schemes||this.schemes||["http","https"],E=l.allowLocal||this.allowLocal||!1,h=l.allowDataUrl||this.allowDataUrl||!1;if(!n.isString(o))return s;var x="^(?:(?:"+y.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(E?g+="?":x+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",x+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+g+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",h){var d="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",a="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",k="data:(?:"+d+")?(?:;base64)?,"+a;x="(?:"+x+")|(?:^"+k+"$)"}var i=new RegExp(x,"i");if(!i.exec(o))return s}},type:n.extend(function(o,l,s,y,E){if(n.isString(l)&&(l={type:l}),!!n.isDefined(o)){var h=n.extend({},this.options,l),x=h.type;if(!n.isDefined(x))throw new Error("No type was specified");var g;if(n.isFunction(x)?g=x:g=this.types[x],!n.isFunction(g))throw new Error("validate.validators.type.types."+x+" must be a function.");if(!g(o,h,s,y,E)){var d=l.message||this.messages[x]||this.message||h.message||(n.isFunction(x)?"must be of the correct type":"must be of type %{type}");return n.isFunction(d)&&(d=d(o,l,s,y,E)),n.format(d,{attribute:n.prettify(s),type:x})}}},{types:{object:function(o){return n.isObject(o)&&!n.isArray(o)},array:n.isArray,integer:n.isInteger,number:n.isNumber,string:n.isString,date:n.isDate,boolean:n.isBoolean},messages:{}})},f.formatters={detailed:function(o){return o},flat:n.flattenErrorsToArray,grouped:function(o){var l;o=n.groupErrorsByAttribute(o);for(l in o)o[l]=n.flattenErrorsToArray(o[l]);return o},constraint:function(o){var l;o=n.groupErrorsByAttribute(o);for(l in o)o[l]=o[l].map(function(s){return s.validator}).sort();return o}},f.exposeModule(f,this,b,c,p)}).call(Ee,B,_,null)})(W,W.exports)),W.exports}var ge=be();const te=Ne(ge),P=(_,B,b="")=>{const c={};Object.keys(B).forEach(n=>{const o=B[n];te.isString(o)?c[n]={presence:{allowEmpty:!1,message:`^請輸入${o}`}}:c[n]=o});const p={},f=te(_,c);return f&&Object.keys(f).forEach(n=>p[`${b}${n}`]=f[n].join(",")),p},ye={class:"block"},ke={class:"mt-4"},ue={class:"table align-middle gray-table side-table"},he={key:0},xe={key:1,class:"text-light-gray"},$e={class:"d-flex flex-column gap-2"},Be={key:0},_e={class:"mt-4"},Ce={class:"table align-middle gray-table side-table"},Te={class:"row g-3"},we={class:"col-12 col-xl-2"},Se={class:"text-gray mb-2"},De={class:"col-12 col-xl-3"},Ae={class:"text-gray mb-2"},Fe={class:"col-12 col-xl-4"},Ue={class:"row g-1"},Me={class:"col-7"},Pe={class:"col-5"},je={class:"col-12 col-xl-3"},Ie={class:"text-gray mb-2"},Oe={class:"col-12"},Le={class:"text-gray mb-2"},Re={class:"mt-4"},qe={class:"table align-middle gray-table side-table"},ze={class:"mt-4"},Ge={class:"table align-middle gray-table side-table"},Je={key:0,class:"table-responsive mt-3 mb-0"},Ye={class:"table align-middle gray-table"},Qe={key:0},He={key:0},We={class:"d-flex gap-2"},Ke=["onClick"],Xe={class:"mt-4"},Ze={class:"table align-middle gray-table side-table"},ve={key:0,class:"block-bottom bg-light-teal"},et={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.ref(),n=e.computed(()=>z("accessibility",s.value.Status,1)),o=e.ref({}),l=e.computed(()=>y.value.filter(i=>!i.Deleted)),s=e.ref({}),y=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:i=>{i?h():y.value.forEach(r=>r.Deleted=!0)}}),h=()=>y.value.push({}),x=B,g=()=>{A.accessibility("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(i=>{s.value=i.Project,f.value=i.Contacts,y.value=i.ReceivedSubsidies,s.value.OrgCategory=s.value.OrgCategory||null,I().init("accessibility",s.value),p.value=s.value.changeApply,s.value.changeApply=void 0})},d=i=>i.Deleted=!0,a=i=>{var m,N;if(o.value={},i&&!k()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:s.value,Contacts:f.value,ReceivedSubsidies:y.value.filter(t=>t.ID||!t.Deleted),Before:(m=p.value)==null?void 0:m.Form1Before,After:(N=p.value)==null?void 0:N.Form1After,Submit:i?"true":"false"};A.accessibility("saveApplication",r).subscribe(t=>{i?x("next",t.ID):s.value.ID?g():window.location.href=`Application.aspx?ID=${t.ID}`})},k=()=>{let i={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return s.value.OrgCategory==="2"&&(i.RegisteredNum="立案登記證字號"),o.value=P(s.value,i),i={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((r,m)=>Object.assign(o.value,P(r,i,`contact-${m}-`))),i={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},y.value.forEach((r,m)=>Object.assign(o.value,P(r,i,`received-${m}-`))),p.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(p.value,i))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(i=>{c.value=i[0],b.id?g():A.accessibility("getEmptyApplication").subscribe(r=>{s.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},r),f.value=[{Role:"負責人"},{Role:"聯絡人"}],I().init("accessibility",s.value)})})}),e.provide("editable",n),(i,r)=>{const m=e.resolveComponent("required-label"),N=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),V=e.resolveComponent("input-textarea"),u=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ye,[r[42]||(r[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",ke,[e.createElementVNode("table",ue,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[15]||(r[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).Year),1)]),e.createElementVNode("tr",null,[r[16]||(r[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(s).ProjectID?(e.openBlock(),e.createElementBlock("span",he,e.toDisplayString(e.unref(s).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",xe,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[r[17]||(r[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[18]||(r[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).ProjectName,modelValue:e.unref(s).ProjectName,"onUpdate:modelValue":r[0]||(r[0]=C=>e.unref(s).ProjectName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[19]||(r[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(s).OrgName,"onUpdate:modelValue":r[1]||(r[1]=C=>e.unref(s).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[20]||(r[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",$e,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(s).OrgCategory,"onUpdate:modelValue":r[2]||(r[2]=C=>e.unref(s).OrgCategory=C)},null,8,["error","options","modelValue"])]),e.unref(s).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Be,[e.createVNode(N,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(s).RegisteredNum,"onUpdate:modelValue":r[3]||(r[3]=C=>e.unref(s).RegisteredNum=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[21]||(r[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(s).TaxID,"onUpdate:modelValue":r[4]||(r[4]=C=>e.unref(s).TaxID=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[22]||(r[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(s).Address,"onUpdate:modelValue":r[5]||(r[5]=C=>e.unref(s).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),r[43]||(r[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",_e,[e.createElementVNode("table",Ce,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Te,[e.createElementVNode("div",we,[e.createElementVNode("div",Se,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[23]||(r[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(o)[`contact-${D}-Name`],modelValue:C.Name,"onUpdate:modelValue":M=>C.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",De,[e.createElementVNode("div",Ae,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[24]||(r[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(o)[`contact-${D}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":M=>C.JobTitle=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Fe,[r[25]||(r[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Ue,[e.createElementVNode("div",Me,[e.createVNode(N,{modelValue:C.Phone,"onUpdate:modelValue":M=>C.Phone=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Pe,[e.createVNode(N,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":M=>C.PhoneExt=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",je,[e.createElementVNode("div",Ie,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[26]||(r[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(o)[`contact-${D}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":M=>C.MobilePhone=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Oe,[e.createElementVNode("div",Le,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[27]||(r[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(o)[`contact-${D}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":M=>C.EMail=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),r[44]||(r[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Re,[e.createElementVNode("table",qe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[28]||(r[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[r[29]||(r[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(V,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(s).Target,"onUpdate:modelValue":r[6]||(r[6]=C=>e.unref(s).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[30]||(r[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(s).Summary,"onUpdate:modelValue":r[7]||(r[7]=C=>e.unref(s).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[31]||(r[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(s).Quantified,"onUpdate:modelValue":r[8]||(r[8]=C=>e.unref(s).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[32]||(r[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(s).Qualitative,"onUpdate:modelValue":r[9]||(r[9]=C=>e.unref(s).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",ze,[e.createElementVNode("table",Ge,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[38]||(r[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(u,{modelValue:e.unref(E),"onUpdate:modelValue":r[10]||(r[10]=C=>e.isRef(E)?E.value=C:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Je,[e.createElementVNode("table",Ye,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[33]||(r[33]=e.createElementVNode("th",null,"計畫名稱",-1)),r[34]||(r[34]=e.createElementVNode("th",null,"補助單位",-1)),r[35]||(r[35]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Qe,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o)[`received-${D}-Name`],modelValue:C.Name,"onUpdate:modelValue":M=>C.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o)[`received-${D}-Unit`],modelValue:C.Unit,"onUpdate:modelValue":M=>C.Unit=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${D}-Amount`],modelValue:C.Amount,"onUpdate:modelValue":M=>C.Amount=M},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",He,[e.createElementVNode("div",We,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>d(C),type:"button"},[...r[36]||(r[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ke)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:h,type:"button"},[...r[37]||(r[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[41]||(r[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Xe,[e.createElementVNode("table",Ze,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[39]||(r[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(p).Form1Before,"onUpdate:modelValue":r[11]||(r[11]=C=>e.unref(p).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[40]||(r[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(p).Form1After,"onUpdate:modelValue":r[12]||(r[12]=C=>e.unref(p).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",ve,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[13]||(r[13]=C=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[14]||(r[14]=C=>a(!0)),type:"button"},[...r[45]||(r[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},tt={class:"block"},lt={key:0,class:"text-pink lh-base mt-4"},ot={class:"mt-4"},nt={class:"table align-middle gray-table"},rt={class:"text-center"},at={key:0,width:"180"},st={class:"text-center"},dt={key:0},ct=["innerHTML"],it=["href"],mt={key:0,class:"text-center"},pt={key:0},Vt={key:1,class:"text-pink"},ft={key:1,class:"tag-group mt-2 gap-1"},Nt={key:0,class:"tag tag-green-light"},Et=["download","href"],bt=["onClick"],gt={class:"mt-4"},yt={class:"table align-middle gray-table side-table"},kt={key:0,class:"block-bottom bg-light-teal"},ut=["disabled"],ht={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),p=e.ref(),f=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),n=e.computed(()=>z("accessibility",l.value.Status,2)),o=e.ref({}),l=e.ref({}),s=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},y=A.download,E=B,h=()=>{rxjs.forkJoin([A.accessibility("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=c.value.filter(k=>{var i;return!((i=k.Excludes)!=null&&i.includes(l.value.OrgCategory))}),c.value.forEach(k=>{k.Files=a.Attachments.filter(i=>i.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(i=>!i.Deleted).length)}),I().init("accessibility",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},x=d=>{var k,i;if(o.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Attachments:c.value.reduce((r,m)=>r.concat(m.Files),[]),Before:(k=p.value)==null?void 0:k.Form5Before,After:(i=p.value)==null?void 0:i.Form5After,Submit:d?"true":"false"};A.accessibility("saveAttachment",a).subscribe(()=>{d?E("next"):h()})},g=()=>{if(p.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(p.value,d))}return!Object.keys(o.value).length};return e.onMounted(h),e.provide("editable",n),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),r=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",tt,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",lt,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",ot,[e.createElementVNode("table",nt,[e.createElementVNode("thead",rt,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",at,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",st,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",dt,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,ct)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:m.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,it)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",mt,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",pt,"已上傳")):(e.openBlock(),e.createElementBlock("span",Vt,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>s(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",ft,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Nt,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(y)(t.Path)},e.toDisplayString(t.Name),9,Et),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,bt)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",gt,[e.createElementVNode("table",yt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(p).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(p).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(p).Form5After,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",kt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=m=>x(!0)),disabled:e.unref(f),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,ut)])):e.createCommentVNode("",!0)],64)}}},xt={class:"block"},$t={class:"mt-4"},Bt={class:"table-responsive mt-3 mb-0"},_t={class:"table align-middle gray-table"},Ct={key:0,width:"1"},Tt={key:0},wt={class:"d-flex gap-2"},St=["onClick"],Dt={class:"table-responsive mt-3 mb-0"},At={class:"table align-middle gray-table"},Ft={class:"mt-4"},Ut={class:"table align-middle gray-table side-table"},Mt={key:0,class:"block-bottom bg-light-teal"},Pt={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.computed(()=>z("accessibility",l.value.Status,4)),n=e.ref({}),o=e.computed(()=>c.value.filter(d=>!d.Deleted)),l=e.ref({}),s=()=>c.value.push({}),y=B,E=()=>{rxjs.forkJoin([A.accessibility("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=a.Benefits,c.value.length||s(),I().init("accessibility",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},h=d=>d.Deleted=!0,x=d=>{var k,i;if(n.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(k=p.value)==null?void 0:k.Form4Before,After:(i=p.value)==null?void 0:i.Form4After,Submit:d?"true":"false"};A.accessibility("saveBenefit",a).subscribe(()=>{d?y("next"):E()})},g=()=>{let d={Benefit:"不可量化成果"};return n.value=P(l.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,k)=>Object.assign(n.value,P(a,d,`item-${k}-`))),p.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,P(p.value,d))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",f),(d,a)=>{const k=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",xt,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",$t,[e.createElementVNode("div",Bt,[e.createElementVNode("table",_t,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Ct,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n)[`item-${N}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Tt,[e.createElementVNode("div",wt,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>h(m),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,St)):e.createCommentVNode("",!0),N+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Dt,[e.createElementVNode("table",At,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(l).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Ft,[e.createElementVNode("table",Ut,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(p).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(p).Form4After,"onUpdate:modelValue":a[2]||(a[2]=m=>e.unref(p).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Mt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=m=>x(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},jt={class:"block"},It={class:"mt-4"},Ot={class:"table-responsive mt-3 mb-0"},Lt={class:"table align-middle gray-table"},Rt={class:"text-end"},qt={class:"text-end"},zt={class:"table-responsive"},Gt={class:"table align-middle gray-table"},Jt=["colspan"],Yt={key:0,width:"1"},Qt={class:"text-end"},Ht={key:0},Wt={class:"d-flex gap-2"},Kt=["onClick"],Xt={class:"mt-4"},Zt={class:"table-responsive mt-3 mb-0"},vt={class:"table align-middle gray-table"},el={key:0,width:"1"},tl={class:"text-end"},ll={key:0},ol={class:"d-flex gap-2"},nl=["onClick"],rl={class:"mt-4"},al={class:"table align-middle gray-table side-table"},sl={key:0,class:"block-bottom bg-light-teal"},dl={class:"text-center"},cl={class:"mb-5"},il={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("accessibility",l.value.Status,3)),f=e.ref({}),n=e.computed(()=>y.value.filter(N=>!N.Deleted)),o=e.computed(()=>E.value.filter(N=>!N.Deleted)),l=e.ref({}),s=e.ref(),y=e.ref([]),E=e.ref([]),h=e.ref({}),x=e.ref(0),g=()=>y.value.push({}),d=()=>E.value.push({}),a=B,k=()=>{rxjs.forkJoin([A.accessibility("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];l.value=t.Project,y.value=t.OtherSubsidies,E.value=t.BudgetPlans,h.value=t.GrantTargetSetting,E.value.length||d(),I().init("accessibility",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=(N,t)=>{var u,w;if(f.value={},N&&!m()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>h.value.GrantLimit*1e4){s.value.show(()=>r(N,!0));return}const V={Project:l.value,OtherSubsidies:y.value,BudgetPlans:E.value,Before:(u=c.value)==null?void 0:u.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:N?"true":"false"};A.accessibility("saveFunding",V).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=P(l.value,N),N={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},n.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`other-${V}-`))),N={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`plan-${V}-`))),c.value&&(N={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,P(c.value,N))),!Object.keys(f.value).length};return e.onMounted(k),e.provide("editable",p),e.watchEffect(()=>{l.value.OtherAmount=n.value.reduce((N,t)=>N+q(t.Amount),0),x.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),n.value.forEach(N=>N.percent=Math.round(q(N.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(N=>N.sum=q(N.Amount)+q(N.OtherAmount))}),(N,t)=>{var M;const V=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",jt,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",It,[e.createElementVNode("div",Ot,[e.createElementVNode("table",Lt,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",Rt,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",qt,e.toDisplayString(e.unref(x).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",zt,[e.createElementVNode("table",Gt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(p)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Jt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",Yt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":S=>F.Unit=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Qt,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":S=>F.Content=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Ht,[e.createElementVNode("div",Wt,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Kt)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Xt,[e.createElementVNode("div",Zt,[e.createElementVNode("table",vt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",el,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":S=>F.Title=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":S=>F.OtherAmount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",tl,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":S=>F.Description=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",ll,[e.createElementVNode("div",ol,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,nl)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",rl,[e.createElementVNode("table",al,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",sl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:s},{default:e.withCtx(()=>[e.createElementVNode("div",dl,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",cl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(h).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Y=Q.defineStore("payment",{actions:{init(_,B=0){this.stage=_==null?void 0:_.Stage,this.amount=_==null?void 0:_.CurrentRequestAmount,this.paid=B,this.status=_==null?void 0:_.Status}},state:()=>({stage:null,amount:null,paid:null,status:null})}),ml={class:"block"},pl={class:"square-title"},Vl={class:"text-teal fw-bold py-3"},fl={class:"table-responsive mb-0"},Nl={class:"table align-middle gray-table"},El={class:"text-end"},bl={class:"text-end"},gl={class:"text-end"},yl={class:"text-teal fw-bold pb-3"},kl={class:"text-teal fw-bold pb-3"},ul={class:"mt-4"},hl={class:"table align-middle gray-table"},xl={class:"text-center"},$l={key:0,width:"180"},Bl={class:"text-center"},_l=["href"],Cl={key:0,class:"text-center"},Tl={key:0},wl={key:1,class:"text-pink"},Sl={key:1,class:"tag-group mt-2 gap-1"},Dl={key:0,class:"tag tag-green-light"},Al=["download","href"],Fl=["onClick"],Ul={class:"block-bottom bg-light-teal"},Ml=["disabled"],Pl={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>h.value.some(i=>!i.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),n=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),s=e.ref({}),y=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(c.value*100/s.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>n.value?Math.min(Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),h=e.ref([{Type:11,Title:"領據",Files:[]}]),x=(i,r)=>{r.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:r.Path,Name:`${s.value.ProjectID}_第一期請款_${i.Title}.pdf`})},g=A.download,d=B,a=()=>{A.accessibility("getPayment",{ID:b.id}).subscribe(i=>{s.value=i.Project,I().init("accessibility",s.value),h.value=h.value.filter(r=>{var m;return!((m=r.Excludes)!=null&&m.includes(s.value.OrgCategory))}),h.value.forEach(r=>{r.Files=i.Attachments.filter(m=>m.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(m=>!m.Deleted).length)}),l.value=i.Payments.find(r=>r.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=Math.round(s.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),Y().init(l.value)})},k=i=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:h.value.reduce((m,N)=>m.concat(N.Files),[]),Submit:i?"true":"false"};A.accessibility("savePayment",r).subscribe(()=>{i?d("next"):a()})};return e.onMounted(a),e.provide("editable",f),(i,r)=>{var V;const m=e.resolveComponent("input-integer"),N=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ml,[e.createElementVNode("h5",pl,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",Vl,"核定經費: "+e.toDisplayString((V=e.unref(s).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("div",fl,[e.createElementVNode("table",Nl,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",El,e.toDisplayString(e.unref(c)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(m,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":r[0]||(r[0]=u=>e.isRef(c)?c.value=u:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",bl,e.toDisplayString(e.unref(y))+"%",1),e.createElementVNode("td",gl,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",yl,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",kl,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",ul,[e.createElementVNode("table",hl,[e.createElementVNode("thead",xl,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",$l,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(u,w)=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Bl,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.Title),1)]),_:2},1024)]),e.unref(f)&&u.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:u.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,_l)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Cl,[u.Uploaded?(e.openBlock(),e.createElementBlock("span",Tl,"已上傳")):(e.openBlock(),e.createElementBlock("span",wl,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!u.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>x(u,C)},null,8,["onFile"])):e.createCommentVNode("",!0),u.Uploaded?(e.openBlock(),e.createElementBlock("div",Sl,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Dl,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(g)(C.Path)},e.toDisplayString(C.Name),9,Al),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>C.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Fl)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Ul,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=u=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=u=>k(!0)),disabled:e.unref(p),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ml)])],64)}}},jl={class:"block"},Il={class:"square-title"},Ol={class:"text-teal fw-bold py-3"},Ll={class:"text-teal fw-bold pb-3"},Rl={class:"table-responsive mb-0"},ql={class:"table align-middle gray-table"},zl={class:"text-end"},Gl={class:"text-end"},Jl={class:"text-end"},Yl={class:"text-end"},Ql={class:"text-teal fw-bold pb-3"},Hl={class:"text-teal fw-bold pb-3"},Wl={class:"mt-4"},Kl={class:"table align-middle gray-table"},Xl={class:"text-center"},Zl={key:0,width:"180"},vl={class:"text-center"},eo=["href"],to={key:0,class:"text-center"},lo={key:0},oo={key:1,class:"text-pink"},no={key:1,class:"tag-group mt-2 gap-1"},ro={key:0,class:"tag tag-green-light"},ao=["download","href"],so=["onClick"],co={class:"block-bottom bg-light-teal"},io=["disabled"],mo={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>d.value.some(N=>!N.Files.filter(t=>!t.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),n=e.computed(()=>{var N;return((N=l.value)==null?void 0:N.Status)==="通過"}),o=e.ref(0),l=e.ref(),s=e.ref(0),y=e.ref(0),E=e.ref({}),h=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(c.value*100/E.value.ApprovedAmount*100)/100,100):0),x=e.computed(()=>g.value?Math.min(Math.round(c.value*100/g.value*100)/100,100):0),g=e.computed(()=>y.value+(n.value?l.value.CurrentActualPaidAmount:0)),d=e.ref([{Type:21,Title:"領據",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/ACC/1-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/ACC/2-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/ACC/3-補助清單.docx",Files:[]},{Type:25,Title:"其他",Files:[]}]),a=(N,t)=>{t.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${N.Title}.pdf`})},k=A.download,i=B,r=()=>{A.accessibility("getPayment",{ID:b.id}).subscribe(N=>{E.value=N.Project,I().init("accessibility",E.value),d.value=d.value.filter(V=>{var u;return!((u=V.Excludes)!=null&&u.includes(E.value.OrgCategory))}),d.value.forEach(V=>{V.Files=N.Attachments.filter(u=>u.Type===V.Type),V.Uploaded=e.computed(()=>V.Files.filter(u=>!u.Deleted).length)}),l.value=N.Payments.find(V=>V.Stage===2),l.value&&(c.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=N.Payments.filter(V=>V.Stage<2&&V.Status==="通過");s.value=t.reduce((V,u)=>V+u.CurrentRequestAmount,0),y.value=t.reduce((V,u)=>V+u.CurrentActualPaidAmount,0),Y().init(l.value,y.value)})},m=N=>{const t={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:d.value.reduce((V,u)=>V.concat(u.Files),[]),Submit:N?"true":"false"};A.accessibility("savePayment",t).subscribe(()=>{N?i("next"):r()})};return e.onMounted(r),e.provide("editable",f),(N,t)=>{var C;const V=e.resolveComponent("input-integer"),u=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",jl,[e.createElementVNode("h5",Il,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",Ol,"核定經費: "+e.toDisplayString((C=e.unref(E).ApprovedAmount)==null?void 0:C.toLocaleString())+"元",1),e.createElementVNode("p",Ll,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Rl,[e.createElementVNode("table",ql,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",zl,e.toDisplayString(e.unref(c)-e.unref(s)),1),e.createElementVNode("td",Gl,e.toDisplayString(e.unref(y)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":t[0]||(t[0]=D=>e.isRef(c)?c.value=D:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Jl,e.toDisplayString(e.unref(h))+"%",1),e.createElementVNode("td",Yl,e.toDisplayString(e.unref(x))+"%",1)])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Ql,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Hl,"累積實際撥款: "+e.toDisplayString(e.unref(g).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Wl,[e.createElementVNode("table",Kl,[e.createElementVNode("thead",Xl,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Zl,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(D,M)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",vl,e.toDisplayString(M+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(u,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Title),1)]),_:2},1024)]),e.unref(f)&&D.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:D.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,eo)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",to,[D.Uploaded?(e.openBlock(),e.createElementBlock("span",lo,"已上傳")):(e.openBlock(),e.createElementBlock("span",oo,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!D.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:F=>a(D,F)},null,8,["onFile"])):e.createCommentVNode("",!0),D.Uploaded?(e.openBlock(),e.createElementBlock("div",no,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.Files,F=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:F},[F.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ro,[e.createElementVNode("a",{class:"tag-link my-1",download:F.Name,href:e.unref(k)(F.Path)},e.toDisplayString(F.Name),9,ao),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>F.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,so)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",co,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=D=>m()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=D=>m(!0)),disabled:e.unref(p),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,io)])],64)}}},po={__name:"ProgressBar",setup(_){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,c)=>{const p=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(p,{steps:B,type:"accessibility"})}}},Vo={class:"block"},fo={class:"mt-4"},No={class:"table align-middle gray-table side-table"},Eo={key:0,class:"d-flex align-items-center gap-2"},bo={class:"input-group w-auto"},go={class:"text-teal-dark"},yo={key:1,class:"invalid mt-0"},ko={class:"table-responsive mt-4"},uo={class:"table align-middle gray-table"},ho={key:0},xo={class:"input-group"},$o={key:0,class:"invalid mt-0"},Bo={key:0},_o={class:"d-flex gap-2"},Co=["onClick"],To={class:"mt-4"},wo={class:"table align-middle gray-table"},So={key:0},Do=["value"],Ao={key:0},Fo={class:"d-flex gap-2"},Uo=["onClick"],Mo={class:"mt-4"},Po={class:"table align-middle gray-table side-table"},jo={key:0,class:"block-bottom bg-light-teal"},Io={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=[{value:1,text:"50%"},{value:2,text:"100%"}],p=e.ref(),f=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("accessibility",y.value.Status,2)),o=e.ref({}),l=e.computed(()=>h.value.filter(N=>!N.Deleted)),s=e.computed(()=>x.value.filter(N=>!N.Deleted)),y=e.ref({}),E=e.ref({}),h=e.ref([]),x=e.ref([]),g=()=>A.accessibility("createItem",{ID:b.id}).subscribe(N=>h.value.push(N)),d=()=>x.value.push({Type:0,ItemID:0}),a=B,k=()=>{rxjs.forkJoin([A.accessibility("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];y.value=t.Project,E.value=t.GrantType,h.value=t.Items,x.value=t.Schedules,h.value.length||g(),x.value.length||d(),I().init("accessibility",y.value),p.value=y.value.changeApply,y.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=N=>{var V,u;if(o.value={},N&&!m()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:y.value,Items:h.value,Schedules:x.value,Before:(V=p.value)==null?void 0:V.Form2Before,After:(u=p.value)==null?void 0:u.Form2After,Submit:N?"true":"false"};A.accessibility("saveWorkSchedule",t).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(y.value,N),N={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`item-${V}-`))),N={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},s.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`schedule-${V}-`))),p.value&&(N={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(p.value,N))),!Object.keys(o.value).length};return e.onMounted(k),e.provide("editable",n),(N,t)=>{const V=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Vo,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",fo,[e.createElementVNode("table",No,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Eo,[e.createElementVNode("div",bo,[e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(y).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(y).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",go,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",yo,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",ko,[e.createElementVNode("table",uo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",ho,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+S)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${S}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",xo,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]?(e.openBlock(),e.createElementBlock("div",$o,e.toDisplayString(e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`item-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Bo,[e.createElementVNode("div",_o,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Co)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",To,[e.createElementVNode("table",wo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",So,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:j})=>[e.createElementVNode("option",{value:j.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(j.Title),9,Do)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`schedule-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Ao,[e.createElementVNode("div",Fo,[e.unref(s).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Uo)):e.createCommentVNode("",!0),S+1===e.unref(s).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Mo,[e.createElementVNode("table",Po,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(p).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(p).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(p).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(p).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",jo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Oo={class:"block rounded-bottom-4"},Lo={class:"mt-4"},Ro={class:"table align-middle gray-table side-table"},qo={class:"text-pink"},zo={class:"table-responsive",style:{"min-height":"400px"}},Go={class:"table teal-table"},Jo={"data-th":"計畫編號／計畫名稱:",class:"text-start"},Yo=["href"],Qo={"data-th":"查核日期／人員:",class:"text-start"},Ho={"data-th":"風險評估:"},Wo={"data-th":"查核意見:",class:"text-start"},Ko={"data-th":"執行單位回覆:",class:"text-start"},Xo={__name:"AuditHistory",props:{name:{type:String}},setup(_){const B=_,b=e.ref([]),c=e.ref(0),p=["無","低風險","中風險","高風險"];return e.onMounted(()=>{A.system("getAuditHistory",{Name:B.name}).subscribe(f=>{b.value=f.List,b.value.forEach(n=>{switch(n.Risk){case"Low":n.lv=1,c.value<1&&(c.value=1);break;case"Medium":n.lv=2,c.value<2&&(c.value=2);break;case"High":n.lv=3,c.value<3&&(c.value=3);break}})})}),(f,n)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock("div",Oo,[n[3]||(n[3]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"查核紀錄")])])],-1)),e.createElementVNode("div",Lo,[e.createElementVNode("table",Ro,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[0]||(n[0]=e.createElementVNode("th",null,"執行單位",-1)),e.createElementVNode("td",null,e.toDisplayString(_.name),1)]),e.createElementVNode("tr",null,[n[1]||(n[1]=e.createElementVNode("th",null,"風險評估",-1)),e.createElementVNode("td",null,[e.createElementVNode("span",qo,e.toDisplayString(p[e.unref(c)]),1)])])])])]),e.createElementVNode("div",zo,[e.createElementVNode("table",Go,[n[2]||(n[2]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫編號／計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核日期／人員")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"風險評估")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核意見")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"執行單位回覆")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",Jo,[e.createElementVNode("a",{class:"link-black",href:`AuditRecords.aspx?ProjectID=${l.ProjectID}`,target:"_blank"},e.toDisplayString(l.ProjectID)+"／"+e.toDisplayString(l.ProjectName),9,Yo)]),e.createElementVNode("td",Qo,[e.createVNode(o,{value:l.CheckDate},null,8,["value"]),e.createTextVNode("／"+e.toDisplayString(l.ReviewerName),1)]),e.createElementVNode("td",Ho,e.toDisplayString(p[l.lv]),1),e.createElementVNode("td",Wo,e.toDisplayString(l.ReviewerComment),1),e.createElementVNode("td",Ko,e.toDisplayString(l.ExecutorComment),1)]))),128))])])])])}}},Zo={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},vo={class:"modal-content"},en={class:"modal-body"},tn={class:"d-flex justify-content-center mt-4 gap-4"},ln={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},on={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(_,{expose:B}){let b;const c=e.ref(),p=_,f=()=>{b&&b()};return B({show:o=>{b=o,bootstrap.Modal.getOrCreateInstance(c.value).show()}}),(o,l)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",Zo,[e.createElementVNode("div",vo,[l[0]||(l[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",en,[e.renderSlot(o.$slots,"default"),e.createElementVNode("div",tn,[e.createElementVNode("button",ln,e.toDisplayString(p.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:f,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(p.confirm),1)])])])])],512)]))}},nn={class:"application-step"},rn=["onClick"],an={class:"step-content"},sn={class:"step-label"},dn={key:0,class:"step-status edit"},cn={key:1,class:"step-status"},mn={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(_,{emit:B}){const b=e.computed(()=>z(p.type,c[p.type].status,p.step)),c=I(),p=_,f=o=>{p.review?n("click",o.step):o.step<=c[p.type].step&&(location.href=`${o.url}.aspx?ID=${p.id}`)},n=B;return(o,l)=>(e.openBlock(),e.createElementBlock("div",nn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.steps,s=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(b)&&(s.step<e.unref(c)[_.type].step||s.step===_.step)}]),onClick:y=>f(s),key:s,role:"button"},[e.createElementVNode("div",an,[e.createElementVNode("div",sn,e.toDisplayString(s.title),1),e.unref(b)&&s.step===_.step?(e.openBlock(),e.createElementBlock("div",dn,"編輯中")):s.step<e.unref(c)[_.type].step?(e.openBlock(),e.createElementBlock("div",cn,"已完成")):e.createCommentVNode("",!0)])],10,rn))),128))]))}},pn={class:"block"},Vn={class:"mt-4"},fn={class:"table align-middle gray-table side-table"},Nn={key:0},En={key:1,class:"text-light-gray"},bn={class:"d-flex gap-2"},gn={key:0,class:"invalid mt-0"},yn={class:"d-flex flex-column gap-2"},kn={key:0},un={class:"mt-4"},hn={class:"table align-middle gray-table side-table"},xn={class:"row g-3"},$n={class:"col-12 col-xl-2"},Bn={class:"text-gray mb-2"},_n={class:"col-12 col-xl-3"},Cn={class:"text-gray mb-2"},Tn={class:"col-12 col-xl-4"},wn={class:"row g-1"},Sn={class:"col-7"},Dn={class:"col-5"},An={class:"col-12 col-xl-3"},Fn={class:"text-gray mb-2"},Un={class:"col-12"},Mn={class:"text-gray mb-2"},Pn={class:"mt-4"},jn={class:"table align-middle gray-table side-table"},In={class:"mt-4"},On={class:"table align-middle gray-table side-table"},Ln={key:0,class:"table-responsive mt-3 mb-0"},Rn={class:"table align-middle gray-table"},qn={key:0},zn={key:0},Gn={class:"d-flex gap-2"},Jn=["onClick"],Yn={class:"mt-4"},Qn={class:"table align-middle gray-table side-table"},Hn={key:0,class:"block-bottom bg-light-teal"},Wn={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.ref(),n=e.computed(()=>z("culture",E.value.Status,1)),o=e.ref({}),l=e.ref(null),s=e.ref([]),y=e.computed(()=>x.value.filter(t=>!t.Deleted)),E=e.ref({}),h=e.computed(()=>s.value.filter(t=>!t.ParentCode)),x=e.ref([]),g=e.computed(()=>s.value.filter(t=>t.ParentCode===l.value)),d=e.computed({get:()=>!!y.value.length,set:t=>{t?a():x.value.forEach(V=>V.Deleted=!0)}}),a=()=>x.value.push({}),k=B,i=()=>{A.culture("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(t=>{var V;E.value=t.Project,f.value=t.Contacts,x.value=t.ReceivedSubsidies,l.value=((V=s.value.find(u=>u.Code===E.value.Field))==null?void 0:V.ParentCode)||null,E.value.OrgCategory=E.value.OrgCategory||null,I().init("culture",E.value),p.value=E.value.changeApply,E.value.changeApply=void 0})},r=t=>t.Deleted=!0,m=t=>{var u,w;if(o.value={},t&&!N()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}const V={Project:E.value,Contacts:f.value,ReceivedSubsidies:x.value.filter(C=>C.ID||!C.Deleted),Before:(u=p.value)==null?void 0:u.Form1Before,After:(w=p.value)==null?void 0:w.Form1After,Submit:t?"true":"false"};A.culture("saveApplication",V).subscribe(C=>{t?k("next",C.ID):E.value.ID?i():window.location.href=`Application.aspx?ID=${C.ID}`})},N=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return E.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),o.value=P(E.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((V,u)=>Object.assign(o.value,P(V,t,`contact-${u}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},x.value.forEach((V,u)=>Object.assign(o.value,P(V,t,`received-${u}-`))),p.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(p.value,t))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.culture("getZgsCodes",{CodeGroup:"CULField"}),A.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{s.value=t[0],c.value=t[1],b.id?i():A.culture("getEmptyApplication").subscribe(V=>{l.value=null,E.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},V),f.value=[{Role:"負責人"},{Role:"聯絡人"}],I().init("culture",E.value)})})}),e.provide("editable",n),e.watch(l,()=>{l.value?g.value.find(t=>E.value.Field===t.Code)||(E.value.Field=g.value[0].Code):E.value.Field=null}),(t,V)=>{const u=e.resolveComponent("required-label"),w=e.resolveComponent("input-text"),C=e.resolveComponent("input-select"),D=e.resolveComponent("input-textarea"),M=e.resolveComponent("input-boolean"),F=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",pn,[V[45]||(V[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Vn,[e.createElementVNode("table",fn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[17]||(V[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[V[18]||(V[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",Nn,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",En,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[V[19]||(V[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[20]||(V[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":V[0]||(V[0]=T=>e.unref(E).ProjectName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[21]||(V[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",bn,[e.createVNode(C,{"empty-value":null,options:e.unref(h),"text-name":"Descname","value-name":"Code",modelValue:e.unref(l),"onUpdate:modelValue":V[1]||(V[1]=T=>e.isRef(l)?l.value=T:null)},null,8,["options","modelValue"]),e.createVNode(C,{"empty-value":null,disabled:!e.unref(l),options:e.unref(g),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).Field,"onUpdate:modelValue":V[2]||(V[2]=T=>e.unref(E).Field=T)},null,8,["disabled","options","modelValue"])]),e.unref(o).Field?(e.openBlock(),e.createElementBlock("div",gn,e.toDisplayString(e.unref(o).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[22]||(V[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":V[3]||(V[3]=T=>e.unref(E).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[23]||(V[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",yn,[e.createElementVNode("div",null,[e.createVNode(C,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":V[4]||(V[4]=T=>e.unref(E).OrgCategory=T)},null,8,["error","options","modelValue"])]),e.unref(E).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",kn,[e.createVNode(w,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(E).RegisteredNum,"onUpdate:modelValue":V[5]||(V[5]=T=>e.unref(E).RegisteredNum=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[24]||(V[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":V[6]||(V[6]=T=>e.unref(E).TaxID=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[25]||(V[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":V[7]||(V[7]=T=>e.unref(E).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),V[46]||(V[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",un,[e.createElementVNode("table",hn,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",xn,[e.createElementVNode("div",$n,[e.createElementVNode("div",Bn,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[26]||(V[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${S}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",_n,[e.createElementVNode("div",Cn,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[27]||(V[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${S}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":U=>T.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Tn,[V[28]||(V[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",wn,[e.createElementVNode("div",Sn,[e.createVNode(w,{modelValue:T.Phone,"onUpdate:modelValue":U=>T.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Dn,[e.createVNode(w,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":U=>T.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",An,[e.createElementVNode("div",Fn,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[29]||(V[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${S}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":U=>T.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Un,[e.createElementVNode("div",Mn,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[30]||(V[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${S}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":U=>T.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),V[47]||(V[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Pn,[e.createElementVNode("table",jn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[31]||(V[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[V[32]||(V[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(D,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(E).Target,"onUpdate:modelValue":V[8]||(V[8]=T=>e.unref(E).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[33]||(V[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":V[9]||(V[9]=T=>e.unref(E).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[34]||(V[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":V[10]||(V[10]=T=>e.unref(E).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[35]||(V[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Qualitative,"onUpdate:modelValue":V[11]||(V[11]=T=>e.unref(E).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",In,[e.createElementVNode("table",On,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[41]||(V[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(M,{modelValue:e.unref(d),"onUpdate:modelValue":V[12]||(V[12]=T=>e.isRef(d)?d.value=T:null)},null,8,["modelValue"]),e.unref(d)?(e.openBlock(),e.createElementBlock("div",Ln,[e.createElementVNode("table",Rn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[V[36]||(V[36]=e.createElementVNode("th",null,"計畫名稱",-1)),V[37]||(V[37]=e.createElementVNode("th",null,"補助單位",-1)),V[38]||(V[38]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",qn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${S}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${S}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":U=>T.Unit=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(o)[`received-${S}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":U=>T.Amount=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",zn,[e.createElementVNode("div",Gn,[e.unref(y).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>r(T),type:"button"},[...V[39]||(V[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Jn)):e.createCommentVNode("",!0),S+1===e.unref(y).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...V[40]||(V[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[V[44]||(V[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Yn,[e.createElementVNode("table",Qn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[42]||(V[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(p).Form1Before,"onUpdate:modelValue":V[13]||(V[13]=T=>e.unref(p).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...V[43]||(V[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(p).Form1After,"onUpdate:modelValue":V[14]||(V[14]=T=>e.unref(p).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Hn,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[15]||(V[15]=T=>m()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[16]||(V[16]=T=>m(!0)),type:"button"},[...V[48]||(V[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Kn={class:"block"},Xn={key:0,class:"text-pink lh-base mt-4"},Zn={class:"mt-4"},vn={class:"table align-middle gray-table"},er={class:"text-center"},tr={key:0,width:"180"},lr={class:"text-center"},or={key:0},nr=["innerHTML"],rr=["href"],ar={key:0,class:"text-center"},sr={key:0},dr={key:1,class:"text-pink"},cr={key:1,class:"tag-group mt-2 gap-1"},ir={key:0,class:"tag tag-green-light"},mr=["download","href"],pr=["onClick"],Vr={class:"mt-4"},fr={class:"table align-middle gray-table side-table"},Nr={key:0,class:"block-bottom bg-light-teal"},Er=["disabled"],br={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=3&id=${b.id}`,Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),p=e.ref(),f=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),n=e.computed(()=>z("culture",l.value.Status,5)),o=e.ref({}),l=e.ref({}),s=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},y=A.download,E=B,h=()=>{rxjs.forkJoin([A.culture("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=c.value.filter(k=>{var i;return!((i=k.Excludes)!=null&&i.includes(l.value.OrgCategory))}),l.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/LIT/5-著作權授權同意書.docx",Files:[]}),c.value.forEach(k=>{k.Files=a.Attachments.filter(i=>i.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(i=>!i.Deleted).length)}),I().init("culture",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},x=d=>{var k,i;if(o.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Attachments:c.value.reduce((r,m)=>r.concat(m.Files),[]),Before:(k=p.value)==null?void 0:k.Form5Before,After:(i=p.value)==null?void 0:i.Form5After,Submit:d?"true":"false"};A.culture("saveAttachment",a).subscribe(()=>{d?E("next"):h()})},g=()=>{if(p.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(p.value,d))}return!Object.keys(o.value).length};return e.onMounted(h),e.provide("editable",n),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),r=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Kn,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",Xn,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Zn,[e.createElementVNode("table",vn,[e.createElementVNode("thead",er,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",tr,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",lr,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",or,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,nr)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:m.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,rr)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",ar,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",sr,"已上傳")):(e.openBlock(),e.createElementBlock("span",dr,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>s(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",cr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ir,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(y)(t.Path)},e.toDisplayString(t.Name),9,mr),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,pr)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Vr,[e.createElementVNode("table",fr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(p).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(p).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(p).Form5After,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Nr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=m=>x(!0)),disabled:e.unref(f),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Er)])):e.createCommentVNode("",!0)],64)}}},gr={class:"block"},yr={class:"mt-4"},kr={class:"table-responsive mt-3 mb-0"},ur={class:"table align-middle gray-table"},hr={class:"text-end"},xr={class:"text-end"},$r={class:"table-responsive"},Br={class:"table align-middle gray-table"},_r=["colspan"],Cr={key:0,width:"1"},Tr={key:0},wr={class:"d-flex gap-2"},Sr=["onClick"],Dr={class:"mt-4"},Ar={class:"table-responsive mt-3 mb-0"},Fr={class:"table align-middle gray-table"},Ur={key:0,width:"1"},Mr={class:"text-end"},Pr={key:0},jr={class:"d-flex gap-2"},Ir=["onClick"],Or={class:"mt-4"},Lr={class:"table align-middle gray-table side-table"},Rr={key:0,class:"block-bottom bg-light-teal"},qr={class:"text-center"},zr={class:"mb-5"},Gr={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("culture",l.value.Status,3)),f=e.ref({}),n=e.computed(()=>E.value.filter(V=>!V.Deleted)),o=e.computed(()=>h.value.filter(V=>!V.Deleted)),l=e.ref({}),s=e.ref([]),y=e.ref(),E=e.ref([]),h=e.ref([]),x=e.ref({}),g=e.ref(0),d=()=>E.value.push({}),a=()=>h.value.push({ItemID:0}),k=B,i=()=>{rxjs.forkJoin([A.culture("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(V=>{const u=V[0];l.value=u.Project,E.value=u.OtherSubsidies,h.value=u.BudgetPlans,s.value=u.Items,x.value=u.GrantTargetSetting,h.value.length||a(),I().init("culture",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},r=V=>V.Deleted=!0,m=V=>V.Deleted=!0,N=(V,u)=>{var C,D;if(f.value={},V&&!t()){e.nextTick(()=>{var M;return(M=document.querySelector(".invalid"))==null?void 0:M.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!u&&l.value.ApplyAmount>x.value.GrantLimit*1e4){y.value.show(()=>N(V,!0));return}const w={Project:l.value,OtherSubsidies:E.value,BudgetPlans:h.value,Before:(C=c.value)==null?void 0:C.Form3Before,After:(D=c.value)==null?void 0:D.Form3After,Submit:V?"true":"false"};A.culture("saveFunding",w).subscribe(()=>{V?k("next"):i()})},t=()=>{let V={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=P(l.value,V),V={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},n.value.forEach((u,w)=>Object.assign(f.value,P(u,V,`other-${w}-`))),V={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((u,w)=>Object.assign(f.value,P(u,V,`plan-${w}-`))),c.value&&(V={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,P(c.value,V))),!Object.keys(f.value).length};return e.onMounted(i),e.provide("editable",p),e.watchEffect(()=>{l.value.OtherAmount=E.value.reduce((V,u)=>V+(u.Deleted?0:q(u.Amount)),0),g.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),h.value.forEach(V=>V.sum=q(V.Amount)+q(V.OtherAmount))}),(V,u)=>{var S;const w=e.resolveComponent("input-integer"),C=e.resolveComponent("input-text"),D=e.resolveComponent("input-select"),M=e.resolveComponent("input-textarea"),F=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",gr,[u[25]||(u[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",yr,[e.createElementVNode("div",kr,[e.createElementVNode("table",ur,[u[6]||(u[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":u[0]||(u[0]=U=>e.unref(l).ApplyAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":u[1]||(u[1]=U=>e.unref(l).SelfAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",hr,e.toDisplayString((S=e.unref(l).OtherAmount)==null?void 0:S.toLocaleString()),1),e.createElementVNode("td",xr,e.toDisplayString(e.unref(g).toLocaleString()),1)])])])]),u[12]||(u[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",$r,[e.createElementVNode("table",Br,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(p)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,_r)]),e.createElementVNode("tr",null,[u[7]||(u[7]=e.createElementVNode("th",{width:"1"},null,-1)),u[8]||(u[8]=e.createElementVNode("th",null,"單位名稱",-1)),u[9]||(u[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",Cr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(U,j)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,e.toDisplayString(j+1),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(f)[`other-${j}-Unit`],modelValue:U.Unit,"onUpdate:modelValue":O=>U.Unit=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`other-${j}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Tr,[e.createElementVNode("div",wr,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:O=>r(U),type:"button"},[...u[10]||(u[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Sr)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...u[11]||(u[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),u[26]||(u[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Dr,[e.createElementVNode("div",Ar,[e.createElementVNode("table",Fr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[u[13]||(u[13]=e.createElementVNode("th",null,"重要工作項目",-1)),u[14]||(u[14]=e.createElementVNode("th",null,"預算項目",-1)),u[15]||(u[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),u[16]||(u[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),u[17]||(u[17]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),u[18]||(u[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",Ur,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,j)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,[e.createVNode(D,{"empty-value":0,error:e.unref(f)[`plan-${j}-ItemID`],options:e.unref(s),"text-name":"Title","value-name":"ID",modelValue:U.ItemID,"onUpdate:modelValue":O=>U.ItemID=O},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(f)[`plan-${j}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${j}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${j}-OtherAmount`],modelValue:U.OtherAmount,"onUpdate:modelValue":O=>U.OtherAmount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Mr,e.toDisplayString(U.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(f)[`plan-${j}-Description`],rows:"1",modelValue:U.Description,"onUpdate:modelValue":O=>U.Description=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Pr,[e.createElementVNode("div",jr,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>m(U),type:"button"},[...u[19]||(u[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ir)):e.createCommentVNode("",!0),j+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...u[20]||(u[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),u[21]||(u[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[u[24]||(u[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Or,[e.createElementVNode("table",Lr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(F,null,{default:e.withCtx(()=>[...u[22]||(u[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":u[2]||(u[2]=U=>e.unref(c).Form3Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(F,null,{default:e.withCtx(()=>[...u[23]||(u[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":u[3]||(u[3]=U=>e.unref(c).Form3After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",Rr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:u[4]||(u[4]=U=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:u[5]||(u[5]=U=>N(!0)),type:"button"},[...u[27]||(u[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:y},{default:e.withCtx(()=>[e.createElementVNode("div",qr,[u[28]||(u[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",zr,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(x).GrantLimit)+"萬",1),u[29]||(u[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),u[30]||(u[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Jr={class:"block"},Yr={key:0,class:"text-pink lh-base mt-3"},Qr={class:"border"},Hr={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Wr={class:"d-flex gap-2 align-items-center flex-grow-1"},Kr={class:"text-nowrap"},Xr={class:"flex-grow-1"},Zr={class:"d-flex gap-2"},vr=["onClick"],ea=["href"],ta=["id"],la={class:"table align-middle gray-table side-table mb-0"},oa={class:"mt-4"},na={class:"table align-middle gray-table side-table"},ra={key:0,class:"block-bottom bg-light-teal"},aa={__name:"Other",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("culture",n.value.Status,4)),f=e.ref({}),n=e.ref({}),o=e.ref([]),l=e.computed(()=>o.value.filter(d=>!d.Deleted)),s=()=>o.value.push({}),y=B,E=()=>{rxjs.forkJoin([A.culture("getRelatedProject",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];n.value=a.Project,o.value=a.Projects,I().init("culture",n.value),c.value=n.value.changeApply,n.value.changeApply=void 0})},h=d=>d.Deleted=!0,x=d=>{var k,i;if(f.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Projects:o.value,Before:(k=c.value)==null?void 0:k.Form4Before,After:(i=c.value)==null?void 0:i.Form4After,Submit:d?"true":"false"};A.culture("saveRelatedProject",a).subscribe(()=>{d?y("next"):E()})},g=()=>{let d={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return l.value.forEach((a,k)=>Object.assign(f.value,P(a,d,`project-${k}-`))),c.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(f.value,P(c.value,d))),!Object.keys(f.value).length};return e.onMounted(E),e.provide("editable",p),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),r=e.resolveComponent("input-integer"),m=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jr,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("p",Yr," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(N,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:N},[e.createElementVNode("div",Qr,[e.createElementVNode("div",Hr,[e.createElementVNode("div",Wr,[e.createElementVNode("label",Kr,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[4]||(a[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",Xr,[e.createVNode(i,{error:e.unref(f)[`project-${t}-Title`],modelValue:N.Title,"onUpdate:modelValue":V=>N.Title=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Zr,[e.unref(p)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(V=>h(N),["prevent"]),href:"#"},"刪除",8,vr)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,ea)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",la,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[5]||(a[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{class:"text-start w-auto",error:e.unref(f)[`project-${t}-Year`],modelValue:N.Year,"onUpdate:modelValue":V=>N.Year=V},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[6]||(a[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(f)[`project-${t}-OrgName`],modelValue:N.OrgName,"onUpdate:modelValue":V=>N.OrgName=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[7]||(a[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{class:"w-auto",error:e.unref(f)[`project-${t}-Amount`],modelValue:N.Amount,"onUpdate:modelValue":V=>N.Amount=V},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[8]||(a[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(f)[`project-${t}-Description`],rows:"4",modelValue:N.Description,"onUpdate:modelValue":V=>N.Description=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[9]||(a[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(f)[`project-${t}-Benefit`],rows:"4",modelValue:N.Benefit,"onUpdate:modelValue":V=>N.Benefit=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,ta)])]))),128)),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:s,type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",oa,[e.createElementVNode("table",na,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(f).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":a[0]||(a[0]=N=>e.unref(c).Form4Before=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(f).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":a[1]||(a[1]=N=>e.unref(c).Form4After=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",ra,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=N=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=N=>x(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},sa={class:"block"},da={class:"square-title"},ca={class:"text-teal fw-bold py-3"},ia={class:"table-responsive mb-0"},ma={class:"table align-middle gray-table"},pa={class:"text-end"},Va={class:"text-end"},fa={class:"text-end"},Na={class:"text-teal fw-bold pb-3"},Ea={class:"text-teal fw-bold pb-3"},ba={class:"mt-4"},ga={class:"table align-middle gray-table"},ya={class:"text-center"},ka={key:0,width:"180"},ua={class:"text-center"},ha=["href"],xa={key:0,class:"text-center"},$a={key:0},Ba={key:1,class:"text-pink"},_a={key:1,class:"tag-group mt-2 gap-1"},Ca={key:0,class:"tag tag-green-light"},Ta=["download","href"],wa=["onClick"],Sa={class:"block-bottom bg-light-teal"},Da=["disabled"],Aa={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>c.value<=0||h.value.some(i=>!i.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),n=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),s=e.ref({}),y=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(c.value*100/s.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>n.value?Math.min(Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),h=e.ref([{Type:11,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:12,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),x=(i,r)=>{r.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:r.Path,Name:`${s.value.ProjectID}_第一期請款_${i.Title}.pdf`})},g=A.download,d=B,a=()=>{A.culture("getPayment",{ID:b.id}).subscribe(i=>{s.value=i.Project,I().init("culture",s.value),h.value=h.value.filter(r=>{var m;return!((m=r.Excludes)!=null&&m.includes(s.value.OrgCategory))}),h.value.forEach(r=>{r.Files=i.Attachments.filter(m=>m.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(m=>!m.Deleted).length)}),l.value=i.Payments.find(r=>r.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=Math.round(s.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),Y().init(l.value)})},k=i=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:h.value.reduce((m,N)=>m.concat(N.Files),[]),Submit:i?"true":"false"};A.culture("savePayment",r).subscribe(()=>{i?d("next"):a()})};return e.onMounted(a),e.provide("editable",f),(i,r)=>{var V;const m=e.resolveComponent("input-integer"),N=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",sa,[e.createElementVNode("h5",da,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",ca,"核定經費: "+e.toDisplayString((V=e.unref(s).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("div",ia,[e.createElementVNode("table",ma,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",pa,e.toDisplayString(e.unref(c)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(m,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":r[0]||(r[0]=u=>e.isRef(c)?c.value=u:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Va,e.toDisplayString(e.unref(y))+"%",1),e.createElementVNode("td",fa,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Na,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ea,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",ba,[e.createElementVNode("table",ga,[e.createElementVNode("thead",ya,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",ka,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(u,w)=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",ua,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.Title),1)]),_:2},1024)]),e.unref(f)&&u.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:u.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ha)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",xa,[u.Uploaded?(e.openBlock(),e.createElementBlock("span",$a,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ba,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!u.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>x(u,C)},null,8,["onFile"])):e.createCommentVNode("",!0),u.Uploaded?(e.openBlock(),e.createElementBlock("div",_a,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ca,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(g)(C.Path)},e.toDisplayString(C.Name),9,Ta),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>C.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,wa)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Sa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=u=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=u=>k(!0)),disabled:e.unref(p),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Da)])],64)}}},Fa={class:"block"},Ua={class:"square-title"},Ma={class:"text-teal fw-bold py-3"},Pa={class:"text-teal fw-bold pb-3"},ja={class:"table-responsive mb-0"},Ia={class:"table align-middle gray-table"},Oa={class:"text-end"},La={class:"text-end"},Ra={class:"text-end"},qa={class:"text-end"},za={class:"text-teal fw-bold pb-3"},Ga={class:"text-teal fw-bold pb-3"},Ja={class:"mt-4"},Ya={class:"table align-middle gray-table"},Qa={class:"text-center"},Ha={key:0,width:"180"},Wa={class:"text-center"},Ka=["href"],Xa={key:0,class:"text-center"},Za={key:0},va={key:1,class:"text-pink"},es={key:1,class:"tag-group mt-2 gap-1"},ts={key:0,class:"tag tag-green-light"},ls=["download","href"],os=["onClick"],ns={class:"block-bottom bg-light-teal"},rs=["disabled"],as={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>c.value<=0||d.value.some(N=>!N.Files.filter(t=>!t.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),n=e.computed(()=>{var N;return((N=l.value)==null?void 0:N.Status)==="通過"}),o=e.ref(0),l=e.ref(),s=e.ref(0),y=e.ref(0),E=e.ref({}),h=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(c.value*100/E.value.ApprovedAmount*100)/100,100):0),x=e.computed(()=>g.value?Math.min(Math.round(c.value*100/g.value*100)/100,100):0),g=e.computed(()=>y.value+(n.value?l.value.CurrentActualPaidAmount:0)),d=e.ref([{Type:21,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:22,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:23,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:24,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),a=(N,t)=>{t.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${N.Title}.pdf`})},k=A.download,i=B,r=()=>{A.culture("getPayment",{ID:b.id}).subscribe(N=>{E.value=N.Project,I().init("culture",E.value),d.value=d.value.filter(V=>{var u;return!((u=V.Excludes)!=null&&u.includes(E.value.OrgCategory))}),d.value.forEach(V=>{V.Files=N.Attachments.filter(u=>u.Type===V.Type),V.Uploaded=e.computed(()=>V.Files.filter(u=>!u.Deleted).length)}),l.value=N.Payments.find(V=>V.Stage===2),l.value&&(c.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=N.Payments.filter(V=>V.Stage<2&&V.Status==="通過");s.value=t.reduce((V,u)=>V+u.CurrentRequestAmount,0),y.value=t.reduce((V,u)=>V+u.CurrentActualPaidAmount,0),Y().init(l.value,y.value)})},m=N=>{const t={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:d.value.reduce((V,u)=>V.concat(u.Files),[]),Submit:N?"true":"false"};A.culture("savePayment",t).subscribe(()=>{N?i("next"):r()})};return e.onMounted(r),e.provide("editable",f),(N,t)=>{var C;const V=e.resolveComponent("input-integer"),u=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Fa,[e.createElementVNode("h5",Ua,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",Ma,"核定經費: "+e.toDisplayString((C=e.unref(E).ApprovedAmount)==null?void 0:C.toLocaleString())+"元",1),e.createElementVNode("p",Pa,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",ja,[e.createElementVNode("table",Ia,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Oa,e.toDisplayString(e.unref(c)-e.unref(s)),1),e.createElementVNode("td",La,e.toDisplayString(e.unref(y)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":t[0]||(t[0]=D=>e.isRef(c)?c.value=D:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Ra,e.toDisplayString(e.unref(h))+"%",1),e.createElementVNode("td",qa,e.toDisplayString(e.unref(x))+"%",1)])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",za,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ga,"累積實際撥款: "+e.toDisplayString(e.unref(g).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Ja,[e.createElementVNode("table",Ya,[e.createElementVNode("thead",Qa,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Ha,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(D,M)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",Wa,e.toDisplayString(M+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(u,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Title),1)]),_:2},1024)]),e.unref(f)&&D.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:D.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ka)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Xa,[D.Uploaded?(e.openBlock(),e.createElementBlock("span",Za,"已上傳")):(e.openBlock(),e.createElementBlock("span",va,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!D.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:F=>a(D,F)},null,8,["onFile"])):e.createCommentVNode("",!0),D.Uploaded?(e.openBlock(),e.createElementBlock("div",es,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.Files,F=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:F},[F.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ts,[e.createElementVNode("a",{class:"tag-link my-1",download:F.Name,href:e.unref(k)(F.Path)},e.toDisplayString(F.Name),9,ls),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>F.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,os)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",ns,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=D=>m()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=D=>m(!0)),disabled:e.unref(p),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,rs)])],64)}}},ss={class:"block rounded-top-4"},ds={class:"horizontal-scrollable"},cs={class:"timeline"},is={class:"year"},ms={class:"month"},ps=["onClick"],Vs={class:"square-title"},fs={class:"table-responsive mt-4"},Ns={class:"table align-middle gray-table"},Es={class:"text-end"},bs={class:"table-responsive"},gs={class:"table align-middle gray-table"},ys={class:"text-end"},ks={key:0,class:"invalid mt-0"},us={class:"mt-3"},hs={class:"mt-3"},xs=["rowspan"],$s={key:0,class:"block-bottom bg-light-teal"},Bs={__name:"Progress",props:{id:{type:[Number,String]}},setup(_){const B=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],b=_,c=e.ref(),p=e.ref({}),f=e.ref(0),n=e.ref({}),o=e.ref([]),l=e.ref({}),s=e.computed(()=>Math.round((f.value+o.value.filter(a=>a.Status===3).length)*100/y.value.length*10)/10),y=e.ref([]),E=e.ref([]),h=a=>{c.value=a,x()},x=()=>{A.culture("getMonthlyProgress",{ID:b.id,Year:c.value.year-1911,Month:c.value.month}).subscribe(a=>{const k=a.Logs,i=a.Items,r=a.Steps;let m=!1;f.value=0,l.value=a.Progress,y.value=a.Schedules,o.value=[],E.value.forEach(N=>{N.months.forEach(t=>{m||(t===c.value&&(m=!0),y.value.forEach(V=>{var u,w;if(V.Month===t.month)if(m||V.Status!==3){const C=k.find(D=>D.ScheduleID===V.ID)||{ScheduleID:V.ID,Status:V.Status};o.value.push(Object.assign(C,{Year:N.year,Month:V.Month,ItemTitle:(u=i.find(D=>D.ID===V.ItemID))==null?void 0:u.Title,Type:V.Type,StepTitle:(w=r.find(D=>D.ID===V.StepID))==null?void 0:w.Title}))}else f.value++}))})})})},g=a=>{if(p.value={},a&&!d()){e.nextTick(()=>{var i;return(i=document.querySelector(".invalid"))==null?void 0:i.scrollIntoView({behavior:"smooth",block:"center"})});return}const k={ID:l.value.ID,Description:l.value.Description||"",Status:a?1:0,Logs:o.value.map(i=>({ID:i.ID||0,ScheduleID:i.ScheduleID,Status:i.Status,DelayReason:i.DelayReason||"",ImprovedWay:i.ImprovedWay||""}))};A.culture("saveMonthlyProgress",k).subscribe(i=>{i&&(window.location.href="../inprogressList.aspx")})},d=()=>{let a={Description:"實際工作執行情形"};return p.value=P(l.value,a),o.value.forEach((k,i)=>{a={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(k.Status)&&(a.DelayReason="落後原因",a.ImprovedWay="改善措施"),Object.assign(p.value,P(k,a,`item-${i}-`))}),!Object.keys(p.value).length};return e.onMounted(()=>{A.culture("getApplication",{ID:b.id}).subscribe(a=>{n.value=a.Project,I().init("culture",n.value);const k=new Date(n.value.StartTime),i=new Date(n.value.EndTime),r=Date.now();for(;;){const m=k.getFullYear(),N=k.getMonth(),t={year:m,month:N+1,disabled:new Date(m,N,20).getTime()>r};let V=E.value.find(u=>u.year===m);if(V?V.months.push(t):E.value.push({year:m,months:[t]}),m*100+N>=i.getFullYear()*100+i.getMonth())break;k.setMonth(N+1)}})}),(a,k)=>{const i=e.resolveComponent("input-textarea"),r=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ss,[e.createElementVNode("div",ds,[k[3]||(k[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",cs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(E),m=>(e.openBlock(),e.createElementBlock("li",{key:m},[e.createElementVNode("span",is,e.toDisplayString(m.year-1911)+"年",1),e.createElementVNode("ul",ms,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.months,N=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(c)===N,disabled:N.disabled}),key:N},[e.createElementVNode("a",{onClick:t=>h(N),href:"javascript:void(0)"},e.toDisplayString(N.month)+"月",9,ps)],2))),128))])]))),128))]),k[4]||(k[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",Vs,e.toDisplayString(e.unref(c).year-1911)+"年"+e.toDisplayString(e.unref(c).month)+"月 實際進度",1),e.createElementVNode("div",fs,[e.createElementVNode("table",Ns,[k[5]||(k[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Es,e.toDisplayString(e.unref(c).year-1911)+"年"+e.toDisplayString(e.unref(c).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(p).Description,rows:"4",modelValue:e.unref(l).Description,"onUpdate:modelValue":k[0]||(k[0]=m=>e.unref(l).Description=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",bs,[e.createElementVNode("table",gs,[k[8]||(k[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("th",ys,e.toDisplayString(m.Year-1911)+"年"+e.toDisplayString(m.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(m.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(m.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(m.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(r,{options:B,modelValue:m.Status,"onUpdate:modelValue":t=>m.Status=t},null,8,["modelValue","onUpdate:modelValue"]),e.unref(p)[`item-${N}-Status`]?(e.openBlock(),e.createElementBlock("div",ks,e.toDisplayString(e.unref(p)[`item-${N}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(m.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",us,[k[6]||(k[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(i,{error:e.unref(p)[`item-${N}-DelayReason`],rows:"1",modelValue:m.DelayReason,"onUpdate:modelValue":t=>m.DelayReason=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",hs,[k[7]||(k[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(i,{error:e.unref(p)[`item-${N}-ImprovedWay`],rows:"1",modelValue:m.ImprovedWay,"onUpdate:modelValue":t=>m.ImprovedWay=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),N?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(o).length},e.toDisplayString(e.unref(s))+"% ",9,xs))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",$s,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[1]||(k[1]=m=>g()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[2]||(k[2]=m=>g(!0)),type:"button"},[...k[9]||(k[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},_s={__name:"ProgressBar",setup(_){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,c)=>{const p=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(p,{steps:B,type:"culture"})}}},le=(_,B)=>{const b=_.__vccOpts||_;for(const[c,p]of B)b[c]=p;return b},Cs={class:"block"},Ts={class:"mt-4"},ws={class:"table align-middle gray-table side-table"},Ss={key:0,class:"d-flex align-items-center gap-2"},Ds={class:"input-group w-auto"},As={class:"text-teal-dark"},Fs={key:1,class:"invalid mt-0"},Us={class:"square-title mt-4"},Ms={class:"mt-4"},Ps=["onClick"],js={class:"d-flex flex-column gap-2"},Is={class:"mt-4 d-flex flex-column gap-2"},Os={class:"d-flex flex-column gap-3 mt-4"},Ls={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Rs={class:"d-flex gap-2 align-items-center flex-grow-1"},qs={class:"text-nowrap"},zs={class:"flex-grow-1"},Gs={class:"d-flex gap-2"},Js=["onClick"],Ys=["href"],Qs=["id"],Hs={class:"table align-middle gray-table side-table mb-0"},Ws={class:"p-0"},Ks={class:"item-list"},Xs={class:"mt-2 align-self-start text-center"},Zs={class:"input-group"},vs={key:0,class:"invalid mt-0"},ed={key:0,class:"d-flex gap-2 mt-1 align-self-start"},td=["onClick"],ld=["onClick"],od={class:"row"},nd={class:"col"},rd=["value"],ad={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},sd=["onClick"],dd=["onClick"],cd={class:"col"},id=["value"],md={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},pd=["onClick"],Vd=["onClick"],fd=["onClick"],Nd={class:"mt-4"},Ed={class:"table align-middle gray-table side-table"},bd={key:0,class:"block-bottom bg-light-teal"},gd=le({__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("culture",l.value.Status,2)),f=e.computed(()=>y.value.EndDate),n=e.ref({}),o=e.computed(()=>s.value.filter(V=>!V.Deleted)),l=e.ref({}),s=e.ref([]),y=e.ref({}),E=()=>{A.culture("createGoal",{ID:b.id}).subscribe(V=>{s.value.push(Object.assign(V,{Items:[]}));const u=s.value[s.value.length-1];h(u)})},h=V=>{A.culture("createGoalItem",{ID:b.id,GoalID:V.ID}).subscribe(u=>{V.Items.push(Object.assign(u,{Steps:[],Schedules:[]}));const w=V.Items[V.Items.length-1];g(w),g(w),g(w),x(w,1),x(w,2)})},x=(V,u)=>A.culture("createGoalSchedule",{ID:b.id,ItemID:V.ID,Type:u}).subscribe(w=>V.Schedules.push(w)),g=V=>A.culture("createGoalStep",{ID:b.id,ItemID:V.ID}).subscribe(u=>V.Steps.push(u)),d=B,a=()=>{rxjs.forkJoin([A.culture("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(V=>{const u=V[0];l.value=u.Project,s.value=u.Goals,y.value=u.GrantType,s.value.length||E(),I().init("culture",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},k=V=>V.Deleted=!0,i=V=>V.Deleted=!0,r=V=>V.Deleted=!0,m=V=>V.Deleted=!0,N=V=>{var w,C;if(n.value={},V&&!t()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}const u={Project:l.value,Goals:s.value,Before:(w=c.value)==null?void 0:w.Form2Before,After:(C=c.value)==null?void 0:C.Form2After,Submit:V?"true":"false"};A.culture("saveWorkSchedule",u).subscribe(()=>{V?d("next"):a()})},t=()=>{let V={StartTime:"計畫期程",EndTime:"計畫期程"};n.value=P(l.value,V);const u={Title:"計畫目標",Content:"預期效益"},w={Title:"重要工作項目",Indicator:"績效指標"},C={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},D={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return s.value.filter(M=>!M.Deleted).forEach((M,F)=>{Object.assign(n.value,P(M,u,`goal-${F}-`)),M.Items.filter(T=>!T.Deleted).forEach((T,S)=>{Object.assign(n.value,P(T,w,`item-${F}-${S}-`)),T.Steps.filter(U=>!U.Deleted).forEach((U,j)=>Object.assign(n.value,P(U,C,`step-${F}-${S}-${j}-`))),T.Schedules.filter(U=>U.Type===1&&!U.Deleted).forEach((U,j)=>Object.assign(n.value,P(U,D,`schedule-${F}-${S}-1-${j}-`))),T.Schedules.filter(U=>U.Type===2&&!U.Deleted).forEach((U,j)=>Object.assign(n.value,P(U,D,`schedule-${F}-${S}-2-${j}-`)))})}),c.value&&(V={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(n.value,P(c.value,V))),!Object.keys(n.value).length};return e.onMounted(a),e.provide("editable",p),(V,u)=>{const w=e.resolveComponent("required-label"),C=e.resolveComponent("input-tw-date"),D=e.resolveComponent("tw-date"),M=e.resolveComponent("input-text"),F=e.resolveComponent("input-textarea"),T=e.resolveComponent("input-month"),S=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Cs,[u[30]||(u[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Ts,[e.createElementVNode("table",ws,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[6]||(u[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Ss,[e.createElementVNode("div",Ds,[e.createVNode(C,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(l).StartTime,"onUpdate:modelValue":u[0]||(u[0]=U=>e.unref(l).StartTime=U)},null,8,["max-date","modelValue"]),u[7]||(u[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(l).EndTime,"onUpdate:modelValue":u[1]||(u[1]=U=>e.unref(l).EndTime=U)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",As,[u[8]||(u[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(D,{value:e.unref(f)},null,8,["value"]),u[9]||(u[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(n).StartTime||e.unref(n).EndTime?(e.openBlock(),e.createElementBlock("div",Fs,e.toDisplayString(e.unref(n).StartTime||e.unref(n).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",Us,[u[11]||(u[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:E,type:"button"},[...u[10]||(u[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Ms,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,j)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:U},[e.unref(p)&&e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:O=>k(U),type:"button"},"刪除",8,Ps)):e.createCommentVNode("",!0),e.createElementVNode("div",js,[u[12]||(u[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(M,{error:e.unref(n)[`goal-${j}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Is,[u[13]||(u[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(F,{error:e.unref(n)[`goal-${j}-Content`],rows:"4",modelValue:U.Content,"onUpdate:modelValue":O=>U.Content=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Os,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(U.Items.filter(O=>!O.Deleted),(O,G)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:O},[e.createElementVNode("div",Ls,[e.createElementVNode("div",Rs,[e.createElementVNode("label",qs,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[14]||(u[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",zs,[e.createVNode(M,{error:e.unref(n)[`item-${j}-${G}-Title`],modelValue:O.Title,"onUpdate:modelValue":L=>O.Title=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Gs,[e.unref(p)&&U.Items.filter(L=>!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(L=>i(O),["prevent"]),href:"#"},"刪除",8,Js)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${G}`,role:"button"},"收合",8,Ys)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${G}`},[e.createElementVNode("table",Hs,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[15]||(u[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",Ws,[e.createElementVNode("ul",Ks,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Steps.filter(L=>!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(p)}]),key:L},[e.createElementVNode("div",Xs,e.toDisplayString(String.fromCharCode(65+J)),1),e.createElementVNode("div",null,[e.createVNode(M,{error:e.unref(n)[`step-${j}-${G}-${J}-Title`],placeholder:"如:進行口訪紀錄",modelValue:L.Title,"onUpdate:modelValue":R=>L.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",Zs,[e.createVNode(T,{"empty-value":0,modelValue:L.Begin,"onUpdate:modelValue":R=>L.Begin=R},null,8,["modelValue","onUpdate:modelValue"]),u[16]||(u[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(T,{"empty-value":0,modelValue:L.End,"onUpdate:modelValue":R=>L.End=R},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(n)[`step-${j}-${G}-${J}-Begin`]||e.unref(n)[`step-${j}-${G}-${J}-End`]?(e.openBlock(),e.createElementBlock("div",vs,e.toDisplayString(e.unref(n)[`step-${j}-${G}-${J}-Begin`]||e.unref(n)[`step-${j}-${G}-${J}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",ed,[O.Steps.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>m(L),type:"button"},[...u[17]||(u[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,td)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>g(O),type:"button"},[...u[18]||(u[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,ld)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[19]||(u[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(n)[`item-${j}-${G}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:O.Indicator,"onUpdate:modelValue":L=>O.Indicator=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[20]||(u[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",od,[e.createElementVNode("div",nd,[u[23]||(u[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===1&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(p)?3:4}`])},[e.createVNode(T,{error:e.unref(n)[`schedule-${j}-${G}-1-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(p)?7:8}`])},[e.createVNode(S,{"empty-value":0,error:e.unref(n)[`schedule-${j}-${G}-1-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:X})=>[e.createElementVNode("option",{value:X.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(X.Title),9,rd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(p)?(e.openBlock(),e.createElementBlock("div",ad,[O.Schedules.filter(R=>R.Type===1&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>r(L),type:"button"},[...u[21]||(u[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,sd)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>x(O,1),type:"button"},[...u[22]||(u[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,dd)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",cd,[u[26]||(u[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===2&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(p)?3:4}`])},[e.createVNode(T,{error:e.unref(n)[`schedule-${j}-${G}-2-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(p)?7:8}`])},[e.createVNode(S,{"empty-value":0,error:e.unref(n)[`schedule-${j}-${G}-2-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:X})=>[e.createElementVNode("option",{value:X.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(X.Title),9,id)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(p)?(e.openBlock(),e.createElementBlock("div",md,[O.Schedules.filter(R=>R.Type===2&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>r(L),type:"button"},[...u[24]||(u[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pd)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>x(O,2),type:"button"},[...u[25]||(u[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Vd)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,Qs)]))),128))]),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:O=>h(U),type:"button"},"新增工作項目",8,fd)):e.createCommentVNode("",!0)]))),128))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[u[29]||(u[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Nd,[e.createElementVNode("table",Ed,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[27]||(u[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(n).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":u[2]||(u[2]=U=>e.unref(c).Form2Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...u[28]||(u[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(n).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":u[3]||(u[3]=U=>e.unref(c).Form2After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",bd,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:u[4]||(u[4]=U=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:u[5]||(u[5]=U=>N(!0)),type:"button"},[...u[31]||(u[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-3149c8a8"]]),yd={class:"block"},kd={class:"mt-4"},ud={class:"table align-middle gray-table side-table"},hd={key:0},xd={key:1,class:"text-light-gray"},$d={class:"d-flex flex-column gap-2"},Bd={key:0},_d={class:"mt-4"},Cd={class:"table align-middle gray-table side-table"},Td={class:"row g-3"},wd={class:"col-12 col-xl-2"},Sd={class:"text-gray mb-2"},Dd={class:"col-12 col-xl-3"},Ad={class:"text-gray mb-2"},Fd={key:0,class:"col-12 col-xl-4"},Ud={class:"row g-1"},Md={class:"col-7"},Pd={class:"col-5"},jd={key:1,class:"col-12 col-xl-3"},Id={class:"text-gray mb-2"},Od={class:"mt-4"},Ld={class:"table align-middle gray-table side-table"},Rd={class:"d-flex align-items-center gap-2"},qd={class:"input-group w-auto"},zd={key:0,class:"invalid mt-0"},Gd={class:"mt-4"},Jd={class:"table-responsive mt-3 mb-0"},Yd={class:"table align-middle gray-table"},Qd={class:"text-end"},Hd={class:"text-end"},Wd={class:"text-end"},Kd={class:"text-end"},Xd={class:"text-end"},Zd={class:"table align-middle gray-table side-table"},vd={key:0,class:"table-responsive mt-3 mb-0"},ec={class:"table align-middle gray-table"},tc={key:0},lc={key:0},oc={class:"d-flex gap-2"},nc=["onClick"],rc={class:"mt-4"},ac={class:"table align-middle gray-table side-table"},sc={key:0,class:"block-bottom bg-light-teal"},dc={class:"text-center"},cc={class:"mb-5"},ic={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.ref(),n=e.computed(()=>z("education",s.value.Status,1)),o=e.ref({}),l=e.computed(()=>E.value.filter(N=>!N.Deleted)),s=e.ref({}),y=e.ref(),E=e.ref([]),h=e.ref(),x=e.ref(0),g=e.computed({get:()=>!!l.value.length,set:N=>{N?d():E.value.forEach(t=>t.Deleted=!0)}}),d=()=>E.value.push({}),a=B,k=()=>{A.education("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(N=>{s.value=N.Project,f.value=N.Contacts,E.value=N.ReceivedSubsidies,s.value.OrgCategory=s.value.OrgCategory||null,I().init("education",s.value),p.value=s.value.changeApply,s.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=(N,t)=>{var u,w;if(o.value={},N&&!m()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&h.value&&s.value.ApplyAmount>h.value.GrantLimit*1e4){y.value.show(()=>r(N,!0));return}const V={Project:s.value,Contacts:f.value,ReceivedSubsidies:E.value.filter(C=>C.ID||!C.Deleted),Before:(u=p.value)==null?void 0:u.Form1Before,After:(w=p.value)==null?void 0:w.Form1After,Submit:N?"true":"false"};A.education("saveApplication",V).subscribe(C=>{N?a("next",C.ID):s.value.ID?k():window.location.href=`Application.aspx?ID=${C.ID}`})},m=()=>{let N={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return s.value.OrgCategory==="2"&&(N.RegisteredNum="立案登記證字號"),o.value=P(s.value,N),N={Name:"姓名",JobTitle:"職稱"},Object.assign(o.value,P(f.value[0],N,"contact-0-")),N.MobilePhone="手機號碼",Object.assign(o.value,P(f.value[1],N,"contact-1-")),N={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},E.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`received-${V}-`))),p.value&&(N={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(p.value,N))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(N=>{c.value=N[0],b.id?k():A.education("getEmptyApplication").subscribe(t=>{s.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},t),f.value=[{Role:"負責人"},{Role:"聯絡人"}],I().init("education",s.value)})})}),e.provide("editable",n),e.watch(()=>s.value.OrgCategory,()=>{A.education("getGrantTargetSetting",{TargetTypeID:`EDC${s.value.OrgCategory}`}).subscribe(N=>{h.value=N})}),e.watchEffect(()=>{x.value=q(s.value.ApplyAmount)+q(s.value.SelfAmount)+q(s.value.OtherGovAmount)+q(s.value.OtherUnitAmount)}),(N,t)=>{const V=e.resolveComponent("required-label"),u=e.resolveComponent("input-text"),w=e.resolveComponent("input-select"),C=e.resolveComponent("input-tw-date"),D=e.resolveComponent("input-textarea"),M=e.resolveComponent("input-integer"),F=e.resolveComponent("input-boolean"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yd,[t[52]||(t[52]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",kd,[e.createElementVNode("table",ud,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[20]||(t[20]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).Year),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(s).ProjectID?(e.openBlock(),e.createElementBlock("span",hd,e.toDisplayString(e.unref(s).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",xd,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).ProjectName,modelValue:e.unref(s).ProjectName,"onUpdate:modelValue":t[0]||(t[0]=S=>e.unref(s).ProjectName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",$d,[e.createElementVNode("div",null,[e.createVNode(w,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(s).OrgCategory,"onUpdate:modelValue":t[1]||(t[1]=S=>e.unref(s).OrgCategory=S)},null,8,["error","options","modelValue"])]),e.unref(s).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Bd,[e.createVNode(u,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(s).RegisteredNum,"onUpdate:modelValue":t[2]||(t[2]=S=>e.unref(s).RegisteredNum=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(s).OrgName,"onUpdate:modelValue":t[3]||(t[3]=S=>e.unref(s).OrgName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[26]||(t[26]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(s).TaxID,"onUpdate:modelValue":t[4]||(t[4]=S=>e.unref(s).TaxID=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[27]||(t[27]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(s).Address,"onUpdate:modelValue":t[5]||(t[5]=S=>e.unref(s).Address=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[53]||(t[53]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",_d,[e.createElementVNode("table",Cd,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(S,U)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Td,[e.createElementVNode("div",wd,[e.createElementVNode("div",Sd,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[28]||(t[28]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(o)[`contact-${U}-Name`],modelValue:S.Name,"onUpdate:modelValue":j=>S.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Dd,[e.createElementVNode("div",Ad,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[29]||(t[29]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(o)[`contact-${U}-JobTitle`],modelValue:S.JobTitle,"onUpdate:modelValue":j=>S.JobTitle=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),U?(e.openBlock(),e.createElementBlock("div",Fd,[t[30]||(t[30]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Ud,[e.createElementVNode("div",Md,[e.createVNode(u,{modelValue:S.Phone,"onUpdate:modelValue":j=>S.Phone=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Pd,[e.createVNode(u,{placeholder:"請輸入分機",size:"4",modelValue:S.PhoneExt,"onUpdate:modelValue":j=>S.PhoneExt=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),U?(e.openBlock(),e.createElementBlock("div",jd,[e.createElementVNode("div",Id,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[31]||(t[31]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(o)[`contact-${U}-MobilePhone`],modelValue:S.MobilePhone,"onUpdate:modelValue":j=>S.MobilePhone=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),t[54]||(t[54]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Od,[e.createElementVNode("table",Ld,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[32]||(t[32]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Rd,[e.createElementVNode("div",qd,[e.createVNode(C,{class:"w-auto",modelValue:e.unref(s).StartTime,"onUpdate:modelValue":t[6]||(t[6]=S=>e.unref(s).StartTime=S)},null,8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto",modelValue:e.unref(s).EndTime,"onUpdate:modelValue":t[7]||(t[7]=S=>e.unref(s).EndTime=S)},null,8,["modelValue"])]),t[34]||(t[34]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",zd,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[35]||(t[35]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Target,modelValue:e.unref(s).Target,"onUpdate:modelValue":t[8]||(t[8]=S=>e.unref(s).Target=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[36]||(t[36]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(s).Summary,"onUpdate:modelValue":t[9]||(t[9]=S=>e.unref(s).Summary=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[37]||(t[37]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(s).Quantified,"onUpdate:modelValue":t[10]||(t[10]=S=>e.unref(s).Quantified=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[55]||(t[55]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",Gd,[t[43]||(t[43]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",Jd,[e.createElementVNode("table",Yd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Qd,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[38]||(t[38]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Hd,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[39]||(t[39]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款",-1)])]),_:1})]),e.createElementVNode("th",Wd,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[40]||(t[40]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Kd,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[41]||(t[41]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費（含總收費）",-1)])]),_:1})]),t[42]||(t[42]=e.createElementVNode("th",{class:"text-end"},"計畫總經費",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).ApplyAmount,modelValue:e.unref(s).ApplyAmount,"onUpdate:modelValue":t[11]||(t[11]=S=>e.unref(s).ApplyAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).SelfAmount,modelValue:e.unref(s).SelfAmount,"onUpdate:modelValue":t[12]||(t[12]=S=>e.unref(s).SelfAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).OtherGovAmount,modelValue:e.unref(s).OtherGovAmount,"onUpdate:modelValue":t[13]||(t[13]=S=>e.unref(s).OtherGovAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).OtherUnitAmount,modelValue:e.unref(s).OtherUnitAmount,"onUpdate:modelValue":t[14]||(t[14]=S=>e.unref(s).OtherUnitAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",Xd,e.toDisplayString(e.unref(x).toLocaleString()),1)])])])])]),e.createElementVNode("table",Zd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[44]||(t[44]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{modelValue:e.unref(g),"onUpdate:modelValue":t[15]||(t[15]=S=>e.isRef(g)?g.value=S:null)},null,8,["modelValue"]),e.unref(g)?(e.openBlock(),e.createElementBlock("div",vd,[e.createElementVNode("table",ec,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[45]||(t[45]=e.createElementVNode("th",null,"計畫名稱",-1)),t[46]||(t[46]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",tc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(S,U)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`received-${U}-Name`],modelValue:S.Name,"onUpdate:modelValue":j=>S.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`received-${U}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":j=>S.Amount=j},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",lc,[e.createElementVNode("div",oc,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:j=>i(S),type:"button"},[...t[47]||(t[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,nc)):e.createCommentVNode("",!0),U+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[48]||(t[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[51]||(t[51]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",rc,[e.createElementVNode("table",ac,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[49]||(t[49]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(p).Form1Before,"onUpdate:modelValue":t[16]||(t[16]=S=>e.unref(p).Form1Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[50]||(t[50]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(p).Form1After,"onUpdate:modelValue":t[17]||(t[17]=S=>e.unref(p).Form1After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",sc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[18]||(t[18]=S=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[19]||(t[19]=S=>r(!0)),type:"button"},[...t[56]||(t[56]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:y},{default:e.withCtx(()=>{var S;return[e.createElementVNode("div",dc,[t[57]||(t[57]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",cc,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((S=e.unref(h))==null?void 0:S.GrantLimit)+"萬",1),t[58]||(t[58]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[59]||(t[59]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},mc={class:"block"},pc={key:0,class:"text-pink lh-base mt-4"},Vc={class:"mt-4"},fc={class:"table align-middle gray-table"},Nc={class:"text-center"},Ec={key:0,width:"180"},bc={class:"text-center"},gc={key:0},yc=["innerHTML"],kc=["href"],uc={key:0,class:"text-center"},hc={key:0},xc={key:1,class:"text-pink"},$c={key:1,class:"tag-group mt-2 gap-1"},Bc={key:0,class:"tag tag-green-light"},_c=["download","href"],Cc=["onClick"],Tc={class:"mt-4"},wc={class:"table align-middle gray-table side-table"},Sc={key:0,class:"block-bottom bg-light-teal"},Dc=["disabled"],Ac={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=3&id=${b.id}`,Files:[]}]),p=e.ref(),f=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),n=e.computed(()=>z("education",l.value.Status,2)),o=e.ref({}),l=e.ref({}),s=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},y=A.download,E=B,h=()=>{rxjs.forkJoin([A.education("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=c.value.filter(k=>{var i;return!((i=k.Excludes)!=null&&i.includes(l.value.OrgCategory))}),c.value.forEach(k=>{k.Files=a.Attachments.filter(i=>i.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(i=>!i.Deleted).length)}),I().init("education",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},x=d=>{var k,i;if(o.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Attachments:c.value.reduce((r,m)=>r.concat(m.Files),[]),Before:(k=p.value)==null?void 0:k.Form5Before,After:(i=p.value)==null?void 0:i.Form5After,Submit:d?"true":"false"};A.education("saveAttachment",a).subscribe(()=>{d?E("next"):h()})},g=()=>{if(p.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(p.value,d))}return!Object.keys(o.value).length};return e.onMounted(h),e.provide("editable",n),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),r=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",mc,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",pc,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如社團成立證明、社團運作證明、有效期間內之當選證書、登記證書等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Vc,[e.createElementVNode("table",fc,[e.createElementVNode("thead",Nc,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Ec,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",bc,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",gc,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,yc)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:m.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,kc)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",uc,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",hc,"已上傳")):(e.openBlock(),e.createElementBlock("span",xc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>s(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",$c,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Bc,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(y)(t.Path)},e.toDisplayString(t.Name),9,_c),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Cc)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Tc,[e.createElementVNode("table",wc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(p).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(p).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(p).Form5After,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Sc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=m=>x(!0)),disabled:e.unref(f),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Dc)])):e.createCommentVNode("",!0)],64)}}},Fc={class:"block"},Uc={class:"square-title"},Mc={class:"text-teal fw-bold py-3"},Pc={class:"text-teal fw-bold pb-3"},jc={class:"table-responsive mb-0"},Ic={class:"table align-middle gray-table"},Oc={class:"text-end"},Lc={class:"text-end"},Rc={class:"text-end"},qc={class:"text-teal fw-bold pb-3"},zc={class:"text-teal fw-bold pb-3"},Gc={class:"mt-4"},Jc={class:"table align-middle gray-table"},Yc={class:"text-center"},Qc={key:0,width:"180"},Hc={class:"text-center"},Wc=["href"],Kc={key:0,class:"text-center"},Xc={key:0},Zc={key:1,class:"text-pink"},vc={key:1,class:"tag-group mt-2 gap-1"},ei={key:0,class:"tag tag-green-light"},ti=["download","href"],li=["onClick"],oi={class:"block-bottom bg-light-teal"},ni=["disabled"],ri={__name:"Payment",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>c.value<=0||h.value.some(i=>!i.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),n=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),s=e.ref({}),y=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(c.value*100/s.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>n.value?Math.min(Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),h=e.ref([{Type:11,Title:"收支明細表",Template:"../../Template/EDC/1-收支明細表.docx",Files:[]},{Type:12,Title:"受補助清單",Template:"../../Template/EDC/2-受補助清單.docx",Files:[]},{Type:13,Title:"經費分攤表",Template:"../../Template/EDC/3-經費分攤表.docx",Files:[]},{Type:14,Title:"憑證",Template:"../../Template/EDC/4-憑證.docx",Files:[]},{Type:15,Title:"領據",Template:"../../Template/EDC/5-領據.docx",Files:[]}]),x=(i,r)=>{r.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:r.Path,Name:`${s.value.ProjectID}_${i.Title}.pdf`})},g=A.download,d=B,a=()=>{A.education("getPayment",{ID:b.id}).subscribe(i=>{s.value=i.Project,I().init("education",s.value),h.value=h.value.filter(r=>{var m;return!((m=r.Excludes)!=null&&m.includes(s.value.OrgCategory))}),h.value.forEach(r=>{r.Files=i.Attachments.filter(m=>m.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(m=>!m.Deleted).length)}),l.value=i.Payments.find(r=>r.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=s.value.ApprovedAmount,Y().init(l.value)})},k=i=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:h.value.reduce((m,N)=>m.concat(N.Files),[]),Submit:i?"true":"false"};A.education("savePayment",r).subscribe(()=>{i?d("next"):a()})};return e.onMounted(a),e.provide("editable",f),(i,r)=>{var V;const m=e.resolveComponent("input-integer"),N=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Fc,[e.createElementVNode("h5",Uc,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",Mc,"核定經費: "+e.toDisplayString((V=e.unref(s).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("p",Pc,"賸餘款: "+e.toDisplayString((e.unref(s).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",jc,[e.createElementVNode("table",Ic,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Oc,e.toDisplayString(e.unref(c)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(m,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":r[0]||(r[0]=u=>e.isRef(c)?c.value=u:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Lc,e.toDisplayString(e.unref(y))+"%",1),e.createElementVNode("td",Rc,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",qc,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",zc,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Gc,[e.createElementVNode("table",Jc,[e.createElementVNode("thead",Yc,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Qc,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(u,w)=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Hc,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.Title),1)]),_:2},1024)]),e.unref(f)&&u.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:u.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Wc)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Kc,[u.Uploaded?(e.openBlock(),e.createElementBlock("span",Xc,"已上傳")):(e.openBlock(),e.createElementBlock("span",Zc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!u.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>x(u,C)},null,8,["onFile"])):e.createCommentVNode("",!0),u.Uploaded?(e.openBlock(),e.createElementBlock("div",vc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ei,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(g)(C.Path)},e.toDisplayString(C.Name),9,ti),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>C.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,li)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",oi,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=u=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=u=>k(!0)),disabled:e.unref(p),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ni)])],64)}}},ai={__name:"ProgressBar",setup(_){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(b,c)=>{const p=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(p,{steps:B,type:"education"})}}},si={class:"modal-dialog modal-dialog-centered modal-md"},di={class:"modal-content"},ci={class:"modal-body"},ii={class:"d-flex flex-column align-items-center mb-5 gap-3"},mi={class:"fs-18"},pi={__name:"ErrorModal",setup(_){const B=v(),b=e.ref();return e.onMounted(()=>b.value.addEventListener("hidden.bs.modal",()=>B.error=null)),e.watch(()=>B.error,()=>{B.error&&bootstrap.Modal.getOrCreateInstance(b.value).show()}),(c,p)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:b,tabindex:"-1"},[e.createElementVNode("div",si,[e.createElementVNode("div",di,[p[2]||(p[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",ci,[e.createElementVNode("div",ii,[p[0]||(p[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",mi,e.toDisplayString(e.unref(B).error),1)]),p[1]||(p[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},K=Q.defineStore("grant",{actions:{init(_){this.type=_}},state:()=>({type:null,typeList:[{code:"SCI",title:"科專"},{code:"CUL",title:"文化"},{code:"EDC",title:"學校／民間"},{code:"CLB",title:"學校社團"},{code:"MUL",title:"多元"},{code:"LIT",title:"素養"},{code:"ACC",title:"無障礙"}]})}),Vi={class:"search bg-gray rounded-4 mt-4"},fi={class:"search-form",action:""},Ni={class:"row g-3"},Ei={class:"col-12 col-lg-6"},bi={key:0,class:"rounded-4 bg-white mt-4 p-4"},gi={class:"row"},yi={class:"col-12"},ki={class:"row"},ui={class:"col-12 col-lg-6 d-flex justify-content-between pe-4"},hi={class:"fw-bold text-primary fs-2"},xi={key:1,class:"rounded-4 bg-white mt-4 py-4"},$i={class:"row"},Bi={class:"col-12 col-lg-3"},_i={class:"col-12 col-lg-3"},Ci={class:"col-12 col-lg-6"},Ti={key:2,class:"row"},wi={class:"col-12 col-lg-6 pt-4"},Si={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Di={class:"fw-bold text-primary fs-2"},Ai={class:"col-12 col-lg-6 pt-4"},Fi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Ui={class:"fw-bold text-primary fs-2"},Mi={class:"col-12 col-lg-6 pt-4"},Pi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},ji={class:"fw-bold text-primary fs-2"},Ii={class:"col-12 col-lg-6 pt-4"},Oi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Li={class:"fw-bold text-primary fs-2"},Ri={class:"rounded-4 bg-white p-4 mt-4 d-flex flex-column gap-5"},qi={class:"mt-4"},zi={class:"table-responsive"},Gi={class:"table align-middle gray-table"},Ji={class:"text-center"},Yi={class:"text-center"},Qi={href:"Report/ApprovedList.aspx"},Hi={class:"text-end"},Wi={class:"text-end"},Ki={class:"block rounded-4 mt-4"},Xi={class:"table-responsive",style:{"min-height":"400px"}},Zi={class:"row"},vi={class:"col"},em=["value"],tm={class:"table teal-table","aria-label":"申請計畫列表"},lm={"data-th":"年度:"},om={"data-th":"類別:",class:"text-start"},nm={"data-th":"補助計畫:"},rm={"data-th":"補助對象:"},am={"data-th":"相關檔案:"},sm=["download","href"],dm={"data-th":"我要申請:"},cm=["href"],im={class:"total-list mt-4"},mm=["href"],pm={class:"total-item-title"},Vm={class:"total-item-content"},fm={class:"count"},Nm={__name:"HomeDashboard",setup(_){const B=K().typeList,b=[{title:"申請中尚未提送",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(k=>[1,14].includes(k.Status)).length)},{title:"申請審查中",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(k=>[11,12,21,22,31,32,41,42,43,44].includes(k.Status)).length)},{title:"審查意見待回覆",url:"ApplicationChecklist.aspx",count:e.computed(()=>0)},{title:"執行中計畫",url:"inprogressList.aspx",count:e.computed(()=>c.value.filter(k=>[51,52].includes(k.Status)).length)},{title:"執行階段待回覆",url:"inprogressList.aspx",count:e.computed(()=>0)}],c=e.ref([]),p=e.ref([]),f=e.ref(""),n=e.ref([]),o=e.ref([]),l=e.ref([]),s=e.ref(),y=e.computed(()=>{let k=p.value;return f.value&&(k=k.filter(i=>i.tags.includes(f.value))),k}),E=e.computed(()=>s.value?l.value.filter(k=>k.Category===s.value):l.value),h=e.computed(()=>({ApprovedAmount:E.value.reduce((k,i)=>k+i.ApprovedAmount,0),RemainingAmount:E.value.reduce((k,i)=>k+i.ApprovedAmount-i.SpendAmount,0),SpendAmount:E.value.reduce((k,i)=>k+i.SpendAmount,0),PaymentAmount:E.value.reduce((k,i)=>k+i.PaymentAmount,0),BudgetFees:E.value.reduce((k,i)=>k+i.BudgetFees,0)})),x=A.download,g=k=>o.value.filter(i=>i.GrantTypeID===k.TypeCode).map((i,r)=>`${r+1}.${i.Note}`).join("<br>"),d=k=>{switch(k.TypeCode){case"SCI":return"SCI/SciApplication.aspx?GrantTypeID=SCI";case"CLB":return"CLB/ClbApplication.aspx?GrantTypeID=CLB";default:return`${k.TypeCode}/Application.aspx`}},a=(k,i,r=2)=>{if(i){const m=10**r;return Math.round(k*100/i*m)/m}return 0};return e.onMounted(()=>{A.system("dashboard").subscribe(k=>{p.value=k.GrantTypes,o.value=k.Settings,c.value=k.ApplyList,l.value=k.StatList,p.value.forEach(i=>{var r;i.tags=(r=i.TargetTags)==null?void 0:r.split(`
`).map(m=>m.trim()),i.tags.forEach(m=>{n.value.includes(m)||n.value.push(m)})})})}),(k,i)=>{const r=e.resolveComponent("input-select"),m=e.resolveComponent("report-pie-chart"),N=e.resolveComponent("report-mix-chart"),t=e.resolveComponent("tooltip");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Vi,[i[20]||(i[20]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",fi,[e.createElementVNode("div",Ni,[i[3]||(i[3]=e.createElementVNode("div",{class:"col-12 col-lg-6"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",{value:""},"114")])],-1)),e.createElementVNode("div",Ei,[i[2]||(i[2]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"全部類別",-1)),e.createVNode(r,{options:e.unref(B),placeholder:"全部","text-name":"title","value-name":"code",modelValue:e.unref(s),"onUpdate:modelValue":i[0]||(i[0]=V=>e.isRef(s)?s.value=V:null)},null,8,["options","modelValue"])])]),i[4]||(i[4]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))]),e.unref(h)?(e.openBlock(),e.createElementBlock("div",bi,[e.createElementVNode("div",gi,[e.createElementVNode("div",yi,[e.createElementVNode("div",ki,[e.createElementVNode("div",ui,[i[6]||(i[6]=e.createElementVNode("div",{class:"fw-bold fs-4"},"總預算經費",-1)),e.createElementVNode("div",hi,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(h).BudgetFees/1e3).toLocaleString())+" ",1),i[5]||(i[5]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])])])):e.createCommentVNode("",!0),e.unref(h)?(e.openBlock(),e.createElementBlock("div",xi,[e.createElementVNode("div",$i,[e.createElementVNode("div",Bi,[i[7]||(i[7]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"經費執行率",-1)),e.createVNode(m,{active:"已執行",color:9323693,inactive:"未執行",percent:a(e.unref(h).SpendAmount,e.unref(h).ApprovedAmount,1),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",_i,[i[8]||(i[8]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"支用比",-1)),e.createVNode(m,{active:"已支用",color:3447003,inactive:"未支用",percent:Math.min(a(e.unref(h).SpendAmount,e.unref(h).PaymentAmount,1),100),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",Ci,[i[9]||(i[9]=e.createElementVNode("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e.createElementVNode("span",{class:"fs-4 fw-bold"},"各類經費執行情形")],-1)),i[10]||(i[10]=e.createElementVNode("div",{class:"fs-6 text-end text-secondary me-5"},"單位：千元",-1)),e.createVNode(N,{list:e.unref(l),style:{width:"100%",height:"300px"}},null,8,["list"])])])])):e.createCommentVNode("",!0),e.unref(h)?(e.openBlock(),e.createElementBlock("div",Ti,[e.createElementVNode("div",wi,[e.createElementVNode("div",Si,[i[12]||(i[12]=e.createElementVNode("div",{class:"fw-bold fs-4"},"核定補助經費",-1)),e.createElementVNode("div",Di,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(h).ApprovedAmount/1e3).toLocaleString())+" ",1),i[11]||(i[11]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Ai,[e.createElementVNode("div",Fi,[i[14]||(i[14]=e.createElementVNode("div",{class:"fw-bold fs-4"},"賸餘款",-1)),e.createElementVNode("div",Ui,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(h).RemainingAmount/1e3).toLocaleString())+" ",1),i[13]||(i[13]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Mi,[e.createElementVNode("div",Pi,[i[16]||(i[16]=e.createElementVNode("div",{class:"fw-bold fs-4"},"實支金額",-1)),e.createElementVNode("div",ji,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(h).SpendAmount/1e3).toLocaleString())+" ",1),i[15]||(i[15]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Ii,[e.createElementVNode("div",Oi,[i[18]||(i[18]=e.createElementVNode("div",{class:"fw-bold fs-4"},"已撥付",-1)),e.createElementVNode("div",Li,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(h).PaymentAmount/1e3).toLocaleString())+" ",1),i[17]||(i[17]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ri,[e.createElementVNode("div",null,[e.createElementVNode("div",qi,[e.createElementVNode("div",zi,[e.createElementVNode("table",Gi,[i[19]||(i[19]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-center"},"類別"),e.createElementVNode("th",{class:"text-center"},"核定件數"),e.createElementVNode("th",{class:"text-end"},"核定補助經費"),e.createElementVNode("th",{class:"text-end"},"經費執行率")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),V=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",Ji,e.toDisplayString(e.unref(B).find(u=>u.code===V.Category).title),1),e.createElementVNode("td",Yi,[e.createElementVNode("a",Qi,e.toDisplayString(V.Count),1)]),e.createElementVNode("td",Hi,e.toDisplayString(V.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Wi,e.toDisplayString(a(V.SpendAmount,V.ApprovedAmount))+"%",1)]))),128))])])])])])])]),e.createElementVNode("div",Ki,[e.createElementVNode("div",Xi,[e.createElementVNode("div",Zi,[e.createElementVNode("div",vi,[i[22]||(i[22]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"依身分篩選適用規定",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":i[1]||(i[1]=V=>e.isRef(f)?f.value=V:null)},[i[21]||(i[21]=e.createElementVNode("option",{value:""},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),V=>(e.openBlock(),e.createElementBlock("option",{key:V,value:V},e.toDisplayString(V),9,em))),128))],512),[[e.vModelSelect,e.unref(f)]])])]),e.createElementVNode("table",tm,[i[25]||(i[25]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"類別"),e.createElementVNode("th",{scope:"col"},"補助計畫"),e.createElementVNode("th",{scope:"col"},"補助對象"),e.createElementVNode("th",{scope:"col"},"相關檔案"),e.createElementVNode("th",{scope:"col"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),V=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",lm,e.toDisplayString(V.Year),1),e.createElementVNode("td",om,e.toDisplayString(V.ShortName),1),e.createElementVNode("td",nm,e.toDisplayString(V.FullName),1),e.createElementVNode("td",rm,[e.createVNode(t,{"data-bs-html":"true",title:g(V)},null,8,["title"])]),e.createElementVNode("td",am,[V.Path?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark",download:V.Filename,href:e.unref(x)(V.Path),style:{display:"inline"}},[...i[23]||(i[23]=[e.createElementVNode("i",{class:"fas fa-file-alt"},null,-1)])],8,sm)):e.createCommentVNode("",!0)]),e.createElementVNode("td",dm,[e.createElementVNode("a",{class:"btn btn-teal-dark",href:d(V),target:"_blank"},[...i[24]||(i[24]=[e.createElementVNode("i",{class:"fa-solid"},null,-1),e.createTextVNode("我要申請",-1)])],8,cm)])]))),128))])])])]),e.createElementVNode("ul",im,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(b,V=>e.createElementVNode("li",{class:"total-item",key:V},[e.createElementVNode("a",{href:V.url},[e.createElementVNode("div",pm,e.toDisplayString(V.title),1),e.createElementVNode("div",Vm,[e.createElementVNode("span",fm,e.toDisplayString(V.count),1),i[26]||(i[26]=e.createElementVNode("span",{class:"unit"},"件",-1))])],8,mm)])),64))])],64)}}},Em={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(_){const B=e.useModel(_,"modelValue"),b=[{value:!0,text:"是"},{value:!1,text:"否"}];return(c,p)=>{const f=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(f,{options:b,modelValue:B.value,"onUpdate:modelValue":p[0]||(p[0]=n=>B.value=n)},null,8,["modelValue"])}}},bm=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(_,{emit:B}){const b=e.ref(),c=()=>{Array.from(b.value.files).forEach(f=>A.upload(f).subscribe(n=>p("file",n))),b.value.value=""},p=B;return(f,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:n[0]||(n[0]=o=>e.unref(b).click()),type:"button"},[...n[1]||(n[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:c,class:"d-none",ref_key:"input",ref:b,type:"file"},f.$attrs),null,16)],64))}}),gm=["disabled","placeholder","type"],ym={key:0,class:"invalid mt-0"},km=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},max:{type:Number},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const B=e.inject("editable",!0),b=e.useModel(_,"modelValue"),c=_;return e.watch(b,p=>{if(p){const f=(parseInt(p)||0).toString();p.toString()!==f?b.value=f:c.max&&Number(f)>c.max&&(b.value=c.max)}}),(p,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?_.placeholder:"",style:{"text-align":"right"},type:_.type},p.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=n=>b.value=n)}),null,16,gm),[[e.vModelDynamic,b.value]]),_.error?(e.openBlock(),e.createElementBlock("div",ym,e.toDisplayString(_.error),1)):e.createCommentVNode("",!0)],64))}}),um={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(_){const B=e.useModel(_,"modelValue"),b=[];for(let c=1;c<=12;c++)b.push({value:c,text:`${c}月`});return(c,p)=>{const f=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(f,{options:b,modelValue:B.value,"onUpdate:modelValue":p[0]||(p[0]=n=>B.value=n)},null,8,["modelValue"])}}},hm=["onChange","checked","disabled","id","value"],xm=["for"],$m={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>re(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const B=e.inject("editable",!0),b=e.useModel(_,"modelValue"),c=p=>{b.value=p};return(p,f)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.options,n=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:n},[e.createElementVNode("input",{onChange:o=>c(n[_.valueName]),checked:n[_.valueName]===b.value,class:"form-check-input",disabled:!e.unref(B),id:`${_.id}-${n[_.valueName]}`,type:"radio",value:n[_.valueName]},null,40,hm),e.createElementVNode("label",{class:"form-check-label",for:`${_.id}-${n[_.valueName]}`},e.toDisplayString(n[_.textName]),9,xm)]))),128))}},Bm=["disabled"],_m=["value"],Cm=["value"],Tm={key:0,class:"invalid mt-0"},wm=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const B=e.inject("editable",!0),b=e.useModel(_,"modelValue");return(c,p)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:_.disabled||!e.unref(B)},c.$attrs,{"onUpdate:modelValue":p[0]||(p[0]=f=>b.value=f)}),[e.unref(B)&&!b.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:_.emptyValue},e.toDisplayString(_.placeholder),9,_m)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.options,(f,n)=>e.renderSlot(c.$slots,"default",{key:f,index:n,option:f},()=>[e.createElementVNode("option",{value:f[_.valueName]},e.toDisplayString(f[_.textName]),9,Cm)])),128))],16,Bm),[[e.vModelSelect,b.value]]),_.error?(e.openBlock(),e.createElementBlock("div",Tm,e.toDisplayString(_.error),1)):e.createCommentVNode("",!0)],64))}}),Sm={class:"input-group"},Dm={key:0,class:"input-group-text"},Am=["disabled","placeholder","type"],Fm={key:0,class:"invalid mt-0"},Um=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const B=e.inject("editable",!0),b=e.useModel(_,"modelValue"),c=_;return c.maxLength&&e.watch(b,()=>{var p;((p=b.value)==null?void 0:p.length)>c.maxLength&&(b.value=b.value.substring(0,c.maxLength))}),(p,f)=>{const n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Sm,[_.prefix?(e.openBlock(),e.createElementBlock("span",Dm,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?_.placeholder:"",type:_.type},p.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=o=>b.value=o)}),null,16,Am),[[e.vModelDynamic,b.value]])]),_.error?(e.openBlock(),e.createElementBlock("div",Fm,e.toDisplayString(_.error),1)):e.createCommentVNode("",!0)],64)}}}),Mm=["disabled","placeholder"],Pm={key:0,class:"fs-14 text-gray mt-2"},jm={class:"text-pink"},Im={key:1,class:"invalid mt-0"},Om=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const B=e.inject("editable",!0),b=e.useModel(_,"modelValue"),c=_;return c.maxLength&&e.watch(b,()=>{var p;((p=b.value)==null?void 0:p.length)>c.maxLength&&(b.value=b.value.substring(0,c.maxLength))}),(p,f)=>{var n;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?_.placeholder:""},p.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=o=>b.value=o)}),null,16,Mm),[[e.vModelText,b.value]]),e.unref(B)&&_.maxLength?(e.openBlock(),e.createElementBlock("div",Pm,[f[1]||(f[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",jm,e.toDisplayString(((n=b.value)==null?void 0:n.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(_.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),_.error?(e.openBlock(),e.createElementBlock("div",Im,e.toDisplayString(_.error),1)):e.createCommentVNode("",!0)],64)}}}),Lm=["disabled","placeholder"],Rm={key:0,class:"invalid"},qm=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean},placeholder:{default:"請輸入",type:String}},emits:["update:modelValue"],setup(_,{emit:B}){let b;const c=_,p=e.ref(),f=e.inject("editable",!0),n=e.ref(),o=B,l=s=>{!s&&c.modelValue&&(s=moment(new Date(c.modelValue))),s?(p.value=s.format(c.displayFormat),o("update:modelValue",s.format(c.format))):(p.value="",o("update:modelValue","")),b.setStartDate(p.value||void 0)};return e.onMounted(()=>{const s=$(n.value);s.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:c.drops,locale:{format:c.displayFormat},maxDate:c.maxDate?new Date(c.maxDate):c.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(y,E)=>l(E.startDate)),b=s.data("daterangepicker"),l()}),e.onUnmounted(()=>b.remove()),e.watch(()=>c.modelValue,()=>l()),(s,y)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(f),placeholder:e.unref(f)?_.placeholder:"",ref_key:"element",ref:n,type:"text"},s.$attrs,{"onUpdate:modelValue":y[0]||(y[0]=E=>e.isRef(p)?p.value=E:null)}),null,16,Lm),[[e.vModelText,e.unref(p)]]),_.error?(e.openBlock(),e.createElementBlock("div",Rm,e.toDisplayString(_.error),1)):e.createCommentVNode("",!0)],64))}}),zm={key:0,class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},Gm={class:"pagination","aria-label":"Pagination"},Jm=["disabled"],Ym={key:1,class:"pagination-item ellipsis",type:"button"},Qm=["onClick"],Hm={class:"page-number"},Wm={key:2,class:"pagination-item ellipsis",type:"button"},Km={class:"page-number"},Xm=["disabled"],Zm={class:"page-number-control"},vm={class:"page-number-control-item"},ep=["selected","value"],tp={class:"page-number-control-item"},lp=["value","selected"],op={__name:"ListPager",props:{count:{required:!0,type:Number},page:{required:!0,type:Number},pageSize:{required:!0,type:Number},slots:{default:3,type:Number}},emits:["change"],setup(_,{emit:B}){const b={},c=_,p=e.computed(()=>Math.ceil(c.count/c.pageSize)),f=(o,l)=>{l&&(o=Math.min(o,Math.ceil(c.count/l))),1<=o&&o<=p.value&&n("change",o,l||c.pageSize)},n=B;return e.watchEffect(()=>{b.from=c.page-parseInt(c.slots/2),b.to=c.page+parseInt((c.slots-1)/2),b.pages=[];for(let o=b.from;o<=b.to;o++)0<o&&o<=p.value&&b.pages.push(o)}),(o,l)=>c.count?(e.openBlock(),e.createElementBlock("div",zm,[e.createElementVNode("nav",Gm,[e.createElementVNode("button",{"aria-label":"Previous page",class:"nav-button",onClick:l[0]||(l[0]=s=>f(_.page-1)),disabled:_.page===1,type:"button"},[...l[6]||(l[6]=[e.createElementVNode("i",{class:"fas fa-chevron-left"},null,-1)])],8,Jm),b.from>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pagination-item",onClick:l[1]||(l[1]=s=>f(1)),type:"button"},[...l[7]||(l[7]=[e.createElementVNode("span",{class:"page-number"},"1",-1)])])):e.createCommentVNode("",!0),b.from>2?(e.openBlock(),e.createElementBlock("button",Ym,[...l[8]||(l[8]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.pages,s=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["pagination-item",{active:_.page===s}]),onClick:y=>f(s),key:s,type:"button"},[e.createElementVNode("span",Hm,e.toDisplayString(s),1)],10,Qm))),128)),e.unref(p)>b.to+1?(e.openBlock(),e.createElementBlock("button",Wm,[...l[9]||(l[9]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),e.unref(p)>b.to?(e.openBlock(),e.createElementBlock("button",{key:3,class:"pagination-item",onClick:l[2]||(l[2]=s=>f(e.unref(p))),type:"button"},[e.createElementVNode("span",Km,e.toDisplayString(e.unref(p)),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{"aria-label":"Next page",class:"nav-button",onClick:l[3]||(l[3]=s=>f(_.page+1)),type:"button",disabled:_.page===e.unref(p)},[...l[10]||(l[10]=[e.createElementVNode("i",{class:"fas fa-chevron-right"},null,-1)])],8,Xm)]),e.createElementVNode("div",Zm,[e.createElementVNode("div",vm,[l[11]||(l[11]=e.createElementVNode("span",null,"跳到",-1)),e.createElementVNode("select",{onChange:l[4]||(l[4]=s=>f(s.target.value)),class:"form-select jump-to-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),s=>(e.openBlock(),e.createElementBlock("option",{key:s,selected:s===_.page,value:s},e.toDisplayString(s),9,ep))),128))],32),l[12]||(l[12]=e.createElementVNode("span",null,"頁",-1)),l[13]||(l[13]=e.createElementVNode("span",null,",",-1))]),e.createElementVNode("div",tp,[l[14]||(l[14]=e.createElementVNode("span",null,"每頁顯示",-1)),e.createElementVNode("select",{onChange:l[5]||(l[5]=s=>f(_.page,s.target.value)),class:"form-select"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([10,20,30],s=>e.createElementVNode("option",{value:s,selected:s===_.pageSize},e.toDisplayString(s),9,lp)),64))],32),l[15]||(l[15]=e.createElementVNode("span",null,"筆",-1))])])])):e.createCommentVNode("",!0)}},np={class:"block"},rp={class:"mt-4"},ap={class:"table align-middle gray-table side-table"},sp={key:0},dp={key:1,class:"text-light-gray"},cp={class:"mt-4"},ip={class:"table align-middle gray-table side-table"},mp={class:"row g-3"},pp={class:"col-12 col-xl-2"},Vp={class:"text-gray mb-2"},fp={class:"col-12 col-xl-3"},Np={class:"text-gray mb-2"},Ep={class:"col-12 col-xl-4"},bp={class:"row g-1"},gp={class:"col-7"},yp={class:"col-5"},kp={class:"col-12 col-xl-3"},up={class:"text-gray mb-2"},hp={class:"col-12"},xp={class:"text-gray mb-2"},$p={class:"mt-4"},Bp={class:"table align-middle gray-table side-table"},_p={class:"mt-4"},Cp={class:"table align-middle gray-table side-table"},Tp={key:0,class:"table-responsive mt-3 mb-0"},wp={class:"table align-middle gray-table"},Sp={key:0},Dp={key:0},Ap={class:"d-flex gap-2"},Fp=["onClick"],Up={class:"mt-4"},Mp={class:"table align-middle gray-table side-table"},Pp={key:0,class:"block-bottom bg-light-teal"},jp={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.ref(),f=e.computed(()=>z("literacy",s.value.Status,1)),n=e.ref({}),o=e.ref([]),l=e.computed(()=>y.value.filter(i=>!i.Deleted)),s=e.ref({}),y=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:i=>{i?h():y.value.forEach(r=>r.Deleted=!0)}}),h=()=>y.value.push({}),x=B,g=()=>{A.literacy("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(i=>{s.value=i.Project,c.value=i.Contacts,y.value=i.PreviousStudies,I().init("literacy",s.value),p.value=s.value.changeApply,s.value.changeApply=void 0})},d=i=>i.Deleted=!0,a=i=>{var m,N;if(n.value={},i&&!k()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:s.value,Contacts:c.value,PreviousStudies:y.value.filter(t=>t.ID||!t.Deleted),Before:(m=p.value)==null?void 0:m.Form1Before,After:(N=p.value)==null?void 0:N.Form1After,Submit:i?"true":"false"};A.literacy("saveApplication",r).subscribe(t=>{i?x("next",t.ID):s.value.ID?g():window.location.href=`Application.aspx?ID=${t.ID}`})},k=()=>{let i={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return n.value=P(s.value,i),i={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},c.value.forEach((r,m)=>Object.assign(n.value,P(r,i,`contact-${m}-`))),i={Title:"研習/課程名稱",TheDate:"辦理日期"},y.value.forEach((r,m)=>Object.assign(n.value,P(r,i,`study-${m}-`))),p.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(n.value,P(p.value,i))),!Object.keys(n.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(i=>{o.value=i[0],b.id?g():A.literacy("getEmptyApplication").subscribe(r=>{s.value=Object.assign({Field:null,FormStep:1,Status:1},r),c.value=[{Role:"申請人"}],I().init("literacy",s.value)})})}),e.provide("editable",f),e.watch(()=>[s.value.Field,s.value.OrgName],()=>{var i;if(f.value){const r=[];s.value.Field&&r.push((i=o.value.find(m=>m.Code===s.value.Field))==null?void 0:i.Descname),s.value.OrgName&&r.push(s.value.OrgName),s.value.ProjectName=r.join("-")}}),(i,r)=>{const m=e.resolveComponent("required-label"),N=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),V=e.resolveComponent("input-textarea"),u=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",np,[r[40]||(r[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",rp,[e.createElementVNode("table",ap,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[14]||(r[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).Year),1)]),e.createElementVNode("tr",null,[r[15]||(r[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(s).ProjectID?(e.openBlock(),e.createElementBlock("span",sp,e.toDisplayString(e.unref(s).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",dp,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[r[16]||(r[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(s).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[17]||(r[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{disabled:"",modelValue:e.unref(s).ProjectName,"onUpdate:modelValue":r[0]||(r[0]=C=>e.unref(s).ProjectName=C),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[18]||(r[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(n).Field,options:e.unref(o),"text-name":"Descname","value-name":"Code",modelValue:e.unref(s).Field,"onUpdate:modelValue":r[1]||(r[1]=C=>e.unref(s).Field=C)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[19]||(r[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(n).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(s).OrgName,"onUpdate:modelValue":r[2]||(r[2]=C=>e.unref(s).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[20]||(r[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(n).OrgLeader,modelValue:e.unref(s).OrgLeader,"onUpdate:modelValue":r[3]||(r[3]=C=>e.unref(s).OrgLeader=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[21]||(r[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(n).Address,placeholder:"請輸入地址",modelValue:e.unref(s).Address,"onUpdate:modelValue":r[4]||(r[4]=C=>e.unref(s).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),r[41]||(r[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",cp,[e.createElementVNode("table",ip,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",mp,[e.createElementVNode("div",pp,[e.createElementVNode("div",Vp,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[22]||(r[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(n)[`contact-${D}-Name`],modelValue:C.Name,"onUpdate:modelValue":M=>C.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",fp,[e.createElementVNode("div",Np,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[23]||(r[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(n)[`contact-${D}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":M=>C.JobTitle=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ep,[r[24]||(r[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",bp,[e.createElementVNode("div",gp,[e.createVNode(N,{modelValue:C.Phone,"onUpdate:modelValue":M=>C.Phone=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",yp,[e.createVNode(N,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":M=>C.PhoneExt=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",kp,[e.createElementVNode("div",up,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[25]||(r[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(n)[`contact-${D}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":M=>C.MobilePhone=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",hp,[e.createElementVNode("div",xp,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[26]||(r[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(N,{error:e.unref(n)[`contact-${D}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":M=>C.EMail=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),r[42]||(r[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",$p,[e.createElementVNode("table",Bp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[27]||(r[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[r[28]||(r[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(V,{error:e.unref(n).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(s).Target,"onUpdate:modelValue":r[5]||(r[5]=C=>e.unref(s).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[29]||(r[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(s).Summary,"onUpdate:modelValue":r[6]||(r[6]=C=>e.unref(s).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[30]||(r[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(s).Quantified,"onUpdate:modelValue":r[7]||(r[7]=C=>e.unref(s).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[31]||(r[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(s).Qualitative,"onUpdate:modelValue":r[8]||(r[8]=C=>e.unref(s).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",_p,[e.createElementVNode("table",Cp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[36]||(r[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(u,{modelValue:e.unref(E),"onUpdate:modelValue":r[9]||(r[9]=C=>e.isRef(E)?E.value=C:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Tp,[e.createElementVNode("table",wp,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[32]||(r[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),r[33]||(r[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Sp,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(n)[`study-${D}-Title`],modelValue:C.Title,"onUpdate:modelValue":M=>C.Title=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(n)[`study-${D}-TheDate`],modelValue:C.TheDate,"onUpdate:modelValue":M=>C.TheDate=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Dp,[e.createElementVNode("div",Ap,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>d(C),type:"button"},[...r[34]||(r[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Fp)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:h,type:"button"},[...r[35]||(r[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[39]||(r[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Up,[e.createElementVNode("table",Mp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[37]||(r[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).Form1Before,rows:"4",modelValue:e.unref(p).Form1Before,"onUpdate:modelValue":r[10]||(r[10]=C=>e.unref(p).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...r[38]||(r[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).Form1After,rows:"4",modelValue:e.unref(p).Form1After,"onUpdate:modelValue":r[11]||(r[11]=C=>e.unref(p).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Pp,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[12]||(r[12]=C=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[13]||(r[13]=C=>a(!0)),type:"button"},[...r[43]||(r[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ip={class:"block"},Op={key:0,class:"text-pink lh-base mt-4"},Lp={class:"mt-4"},Rp={class:"table align-middle gray-table"},qp={class:"text-center"},zp={key:0,width:"180"},Gp={class:"text-center"},Jp={key:0},Yp=["innerHTML"],Qp=["href"],Hp={key:0,class:"text-center"},Wp={key:0},Kp={key:1,class:"text-pink"},Xp={key:1,class:"tag-group mt-2 gap-1"},Zp={key:0,class:"tag tag-green-light"},vp=["download","href"],eV=["onClick"],tV={class:"mt-4"},lV={class:"table align-middle gray-table side-table"},oV={key:0,class:"block-bottom bg-light-teal"},nV=["disabled"],rV={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"著作權授權同意書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=5&id=${b.id}`,Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),p=e.ref(),f=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),n=e.computed(()=>z("literacy",l.value.Status,2)),o=e.ref({}),l=e.ref({}),s=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},y=A.download,E=B,h=()=>{rxjs.forkJoin([A.literacy("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=c.value.filter(k=>{var i;return!((i=k.Excludes)!=null&&i.includes(l.value.OrgCategory))}),c.value.forEach(k=>{k.Files=a.Attachments.filter(i=>i.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(i=>!i.Deleted).length)}),I().init("literacy",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},x=d=>{var k,i;if(o.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Attachments:c.value.reduce((r,m)=>r.concat(m.Files),[]),Before:(k=p.value)==null?void 0:k.Form5Before,After:(i=p.value)==null?void 0:i.Form5After,Submit:d?"true":"false"};A.literacy("saveAttachment",a).subscribe(()=>{d?E("next"):h()})},g=()=>{if(p.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(p.value,d))}return!Object.keys(o.value).length};return e.onMounted(h),e.provide("editable",n),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),r=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ip,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",Op,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Lp,[e.createElementVNode("table",Rp,[e.createElementVNode("thead",qp,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",zp,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",Gp,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",Jp,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,Yp)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:m.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Qp)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Hp,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",Wp,"已上傳")):(e.openBlock(),e.createElementBlock("span",Kp,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>s(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",Xp,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Zp,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(y)(t.Path)},e.toDisplayString(t.Name),9,vp),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,eV)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",tV,[e.createElementVNode("table",lV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(p).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(p).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(p).Form5After,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",oV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=m=>x(!0)),disabled:e.unref(f),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,nV)])):e.createCommentVNode("",!0)],64)}}},aV={class:"block"},sV={class:"mt-4"},dV={class:"table-responsive mt-3 mb-0"},cV={class:"table align-middle gray-table"},iV={key:0,width:"1"},mV={key:0},pV={class:"d-flex gap-2"},VV=["onClick"],fV={class:"table-responsive mt-3 mb-0"},NV={class:"table align-middle gray-table"},EV={class:"mt-4"},bV={class:"table align-middle gray-table side-table"},gV={key:0,class:"block-bottom bg-light-teal"},yV={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.computed(()=>z("literacy",l.value.Status,4)),n=e.ref({}),o=e.computed(()=>c.value.filter(d=>!d.Deleted)),l=e.ref({}),s=()=>c.value.push({}),y=B,E=()=>{rxjs.forkJoin([A.literacy("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=a.Benefits,c.value.length||s(),I().init("literacy",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},h=d=>d.Deleted=!0,x=d=>{var k,i;if(n.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(k=p.value)==null?void 0:k.Form4Before,After:(i=p.value)==null?void 0:i.Form4After,Submit:d?"true":"false"};A.literacy("saveBenefit",a).subscribe(()=>{d?y("next"):E()})},g=()=>{let d={Benefit:"不可量化成果"};return n.value=P(l.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,k)=>Object.assign(n.value,P(a,d,`item-${k}-`))),p.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,P(p.value,d))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",f),(d,a)=>{const k=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",aV,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",sV,[e.createElementVNode("div",dV,[e.createElementVNode("table",cV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",iV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n)[`item-${N}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",mV,[e.createElementVNode("div",pV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>h(m),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,VV)):e.createCommentVNode("",!0),N+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",fV,[e.createElementVNode("table",NV,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(l).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",EV,[e.createElementVNode("table",bV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(p).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(p).Form4After,"onUpdate:modelValue":a[2]||(a[2]=m=>e.unref(p).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",gV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=m=>x(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},kV={class:"block"},uV={class:"mt-4"},hV={class:"table-responsive mt-3 mb-0"},xV={class:"table align-middle gray-table"},$V={class:"text-end"},BV={class:"text-end"},_V={class:"table-responsive"},CV={class:"table align-middle gray-table"},TV=["colspan"],wV={key:0,width:"1"},SV={class:"text-end"},DV={key:0},AV={class:"d-flex gap-2"},FV=["onClick"],UV={class:"mt-4"},MV={class:"table-responsive mt-3 mb-0"},PV={class:"table align-middle gray-table"},jV={key:0,width:"1"},IV={class:"text-end"},OV={key:0},LV={class:"d-flex gap-2"},RV=["onClick"],qV={class:"mt-4"},zV={class:"table align-middle gray-table side-table"},GV={key:0,class:"block-bottom bg-light-teal"},JV={class:"text-center"},YV={class:"mb-5"},QV={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("literacy",l.value.Status,3)),f=e.ref({}),n=e.computed(()=>y.value.filter(N=>!N.Deleted)),o=e.computed(()=>E.value.filter(N=>!N.Deleted)),l=e.ref({}),s=e.ref(),y=e.ref([]),E=e.ref([]),h=e.ref({}),x=e.ref(0),g=()=>y.value.push({}),d=()=>E.value.push({}),a=B,k=()=>{rxjs.forkJoin([A.literacy("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];l.value=t.Project,y.value=t.OtherSubsidies,E.value=t.BudgetPlans,h.value=t.GrantTargetSetting,E.value.length||d(),I().init("literacy",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=(N,t)=>{var u,w;if(f.value={},N&&!m()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>h.value.GrantLimit*1e4){s.value.show(()=>r(N,!0));return}const V={Project:l.value,OtherSubsidies:y.value,BudgetPlans:E.value,Before:(u=c.value)==null?void 0:u.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:N?"true":"false"};A.literacy("saveFunding",V).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=P(l.value,N),N={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},n.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`other-${V}-`))),N={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`plan-${V}-`))),c.value&&(N={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,P(c.value,N))),!Object.keys(f.value).length};return e.onMounted(k),e.provide("editable",p),e.watchEffect(()=>{l.value.OtherAmount=n.value.reduce((N,t)=>N+q(t.Amount),0),x.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),n.value.forEach(N=>N.percent=Math.round(q(N.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(N=>N.sum=q(N.Amount)+q(N.OtherAmount))}),(N,t)=>{var M;const V=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kV,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",uV,[e.createElementVNode("div",hV,[e.createElementVNode("table",xV,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",$V,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",BV,e.toDisplayString(e.unref(x).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",_V,[e.createElementVNode("table",CV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(p)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,TV)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",wV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":S=>F.Unit=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",SV,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":S=>F.Content=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",DV,[e.createElementVNode("div",AV,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,FV)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",UV,[e.createElementVNode("div",MV,[e.createElementVNode("table",PV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",jV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":S=>F.Title=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":S=>F.OtherAmount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",IV,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":S=>F.Description=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",OV,[e.createElementVNode("div",LV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,RV)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",qV,[e.createElementVNode("table",zV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",GV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:s},{default:e.withCtx(()=>[e.createElementVNode("div",JV,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",YV,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(h).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},HV={class:"block"},WV={class:"square-title"},KV={class:"text-teal fw-bold py-3"},XV={class:"table-responsive mb-0"},ZV={class:"table align-middle gray-table"},vV={class:"text-end"},ef={class:"text-teal fw-bold pb-3"},tf={class:"text-teal fw-bold pb-3"},lf={class:"mt-4"},of={class:"table align-middle gray-table"},nf={class:"text-center"},rf={key:0,width:"180"},af={class:"text-center"},sf=["href"],df={key:0,class:"text-center"},cf={key:0},mf={key:1,class:"text-pink"},pf={key:1,class:"tag-group mt-2 gap-1"},Vf={key:0,class:"tag tag-green-light"},ff=["download","href"],Nf=["onClick"],Ef={class:"block-bottom bg-light-teal"},bf=["disabled"],gf={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.computed(()=>l.value.some(g=>!g.Files.filter(d=>!d.Deleted).length)),p=e.computed(()=>!n.value||n.value.Status==="請款中"),f=e.computed(()=>{var g;return((g=n.value)==null?void 0:g.Status)==="通過"}),n=e.ref(),o=e.ref({}),l=e.ref([{Type:11,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]}]),s=(g,d)=>{d.Type==="application/pdf"&&g.Files.push({Type:g.Type,Path:d.Path,Name:`${o.value.ProjectID}_請款_${g.Title}.pdf`})},y=A.download,E=B,h=()=>{A.literacy("getPayment",{ID:b.id}).subscribe(g=>{o.value=g.Project,I().init("literacy",o.value),l.value=l.value.filter(d=>{var a;return!((a=d.Excludes)!=null&&a.includes(o.value.OrgCategory))}),l.value.forEach(d=>{d.Files=g.Attachments.filter(a=>a.Type===d.Type),d.Uploaded=e.computed(()=>d.Files.filter(a=>!a.Deleted).length)}),n.value=g.Payments.find(d=>d.Stage===1),Y().init(n.value)})},x=g=>{const d={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:o.value.ApprovedAmount},Attachments:l.value.reduce((a,k)=>a.concat(k.Files),[]),Submit:g?"true":"false"};A.literacy("savePayment",d).subscribe(()=>{g?E("next"):h()})};return e.onMounted(h),e.provide("editable",p),(g,d)=>{var i;const a=e.resolveComponent("required-label"),k=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",HV,[e.createElementVNode("h5",WV,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",KV,"核定經費: "+e.toDisplayString((i=e.unref(o).ApprovedAmount)==null?void 0:i.toLocaleString())+"元",1),e.createElementVNode("div",XV,[e.createElementVNode("table",ZV,[d[6]||(d[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",vV,e.toDisplayString(e.unref(o).ApprovedAmount),1),d[2]||(d[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[3]||(d[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[4]||(d[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[5]||(d[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",ef,"本期實際撥款: "+e.toDisplayString(e.unref(n).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",tf,"累積實際撥款: "+e.toDisplayString(e.unref(n).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),d[12]||(d[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),d[13]||(d[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",lf,[e.createElementVNode("table",of,[e.createElementVNode("thead",nf,[e.createElementVNode("tr",null,[d[7]||(d[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),d[8]||(d[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",rf,"狀態")):e.createCommentVNode("",!0),d[9]||(d[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(r,m)=>(e.openBlock(),e.createElementBlock("tr",{key:r},[e.createElementVNode("td",af,e.toDisplayString(m+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.Title),1)]),_:2},1024)]),e.unref(p)&&r.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:r.Template,style:{width:"140px"},type:"button"},[...d[10]||(d[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,sf)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",df,[r.Uploaded?(e.openBlock(),e.createElementBlock("span",cf,"已上傳")):(e.openBlock(),e.createElementBlock("span",mf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(p)&&!r.Uploaded?(e.openBlock(),e.createBlock(k,{key:0,accept:".pdf",onFile:N=>s(r,N)},null,8,["onFile"])):e.createCommentVNode("",!0),r.Uploaded?(e.openBlock(),e.createElementBlock("div",pf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.Files,N=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:N},[N.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Vf,[e.createElementVNode("a",{class:"tag-link my-1",download:N.Name,href:e.unref(y)(N.Path)},e.toDisplayString(N.Name),9,ff),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:t=>N.Deleted=!0,type:"button"},[...d[11]||(d[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Nf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Ef,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:d[0]||(d[0]=r=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:d[1]||(d[1]=r=>x(!0)),disabled:e.unref(c),type:"button"},[...d[14]||(d[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,bf)])],64)}}},yf={class:"block"},kf={class:"square-title"},uf={class:"text-teal fw-bold py-3"},hf={class:"text-teal fw-bold pb-3"},xf={class:"table-responsive"},$f={class:"table align-middle gray-table"},Bf={class:"text-end"},_f={class:"text-end"},Cf={class:"text-end"},Tf={class:"mt-4"},wf={class:"table align-middle gray-table"},Sf={class:"text-center"},Df={key:0,width:"180"},Af={class:"text-center"},Ff=["href"],Uf={key:0,class:"text-center"},Mf={key:0},Pf={key:1,class:"text-pink"},jf={key:1,class:"tag-group mt-2 gap-1"},If={key:0,class:"tag tag-green-light"},Of=["download","href"],Lf=["onClick"],Rf={class:"block-bottom bg-light-teal"},qf=["disabled"],zf={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>c.value<=0||h.value.some(i=>!i.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),n=e.ref(0),o=e.ref(),l=e.ref(0),s=e.ref({}),y=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(c.value*100/s.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.min(Math.round(c.value*100/l.value*100)/100,100):0),h=e.ref([{Type:21,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/LIT/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/LIT/3-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/LIT/4-補助清單.docx",Files:[]}]),x=(i,r)=>{r.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:r.Path,Name:`${s.value.ProjectID}_結案核銷_${i.Title}.pdf`})},g=A.download,d=B,a=()=>{A.literacy("getPayment",{ID:b.id}).subscribe(i=>{s.value=i.Project,I().init("literacy",s.value),h.value=h.value.filter(r=>{var m;return!((m=r.Excludes)!=null&&m.includes(s.value.OrgCategory))}),h.value.forEach(r=>{r.Files=i.Attachments.filter(m=>m.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(m=>!m.Deleted).length)}),o.value=i.Payments.find(r=>r.Stage===2),o.value&&(c.value=o.value.TotalSpentAmount),l.value=i.Payments.filter(r=>r.Stage<2&&r.Status==="通過").reduce((r,m)=>r+m.CurrentActualPaidAmount,0),n.value=l.value,Y().init(o.value,l.value)})},k=i=>{const r={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:h.value.reduce((m,N)=>m.concat(N.Files),[]),Submit:i?"true":"false"};A.literacy("savePayment",r).subscribe(()=>{i?d("next"):a()})};return e.onMounted(a),e.provide("editable",f),(i,r)=>{var V;const m=e.resolveComponent("input-integer"),N=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yf,[e.createElementVNode("h5",kf,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",uf,"核定經費: "+e.toDisplayString((V=e.unref(s).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("p",hf,"賸餘款: "+e.toDisplayString((e.unref(s).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",xf,[e.createElementVNode("table",$f,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",Bf,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(m,{max:e.unref(n),modelValue:e.unref(c),"onUpdate:modelValue":r[0]||(r[0]=u=>e.isRef(c)?c.value=u:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",_f,e.toDisplayString(e.unref(y))+"%",1),e.createElementVNode("td",Cf,e.toDisplayString(e.unref(E))+"%",1)])])])]),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Tf,[e.createElementVNode("table",wf,[e.createElementVNode("thead",Sf,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Df,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(u,w)=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Af,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.Title),1)]),_:2},1024)]),e.unref(f)&&u.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:u.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ff)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Uf,[u.Uploaded?(e.openBlock(),e.createElementBlock("span",Mf,"已上傳")):(e.openBlock(),e.createElementBlock("span",Pf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!u.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>x(u,C)},null,8,["onFile"])):e.createCommentVNode("",!0),u.Uploaded?(e.openBlock(),e.createElementBlock("div",jf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",If,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(g)(C.Path)},e.toDisplayString(C.Name),9,Of),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>C.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Lf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Rf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=u=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=u=>k(!0)),disabled:e.unref(p),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,qf)])],64)}}},Gf={__name:"ProgressBar",setup(_){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,c)=>{const p=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(p,{steps:B,type:"literacy"})}}},Jf={class:"block"},Yf={class:"mt-4"},Qf={class:"table align-middle gray-table side-table"},Hf={key:0,class:"d-flex align-items-center gap-2"},Wf={class:"input-group w-auto"},Kf={class:"text-teal-dark"},Xf={key:1,class:"invalid mt-0"},Zf={class:"table-responsive mt-4"},vf={class:"table align-middle gray-table"},eN={key:0},tN={class:"input-group"},lN={key:0,class:"invalid mt-0"},oN={key:0},nN={class:"d-flex gap-2"},rN=["onClick"],aN={class:"mt-4"},sN={class:"table align-middle gray-table"},dN={key:0},cN=["value"],iN={key:0},mN={class:"d-flex gap-2"},pN=["onClick"],VN={class:"mt-4"},fN={class:"table align-middle gray-table side-table"},NN={key:0,class:"block-bottom bg-light-teal"},EN={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=[{value:1,text:"50%"},{value:2,text:"100%"}],p=e.ref(),f=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("literacy",y.value.Status,2)),o=e.ref({}),l=e.computed(()=>h.value.filter(N=>!N.Deleted)),s=e.computed(()=>x.value.filter(N=>!N.Deleted)),y=e.ref({}),E=e.ref({}),h=e.ref([]),x=e.ref([]),g=()=>A.literacy("createItem",{ID:b.id}).subscribe(N=>h.value.push(N)),d=()=>x.value.push({Type:0,ItemID:0}),a=B,k=()=>{rxjs.forkJoin([A.literacy("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];y.value=t.Project,E.value=t.GrantType,h.value=t.Items,x.value=t.Schedules,h.value.length||g(),x.value.length||d(),I().init("literacy",y.value),p.value=y.value.changeApply,y.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=N=>{var V,u;if(o.value={},N&&!m()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:y.value,Items:h.value,Schedules:x.value,Before:(V=p.value)==null?void 0:V.Form2Before,After:(u=p.value)==null?void 0:u.Form2After,Submit:N?"true":"false"};A.literacy("saveWorkSchedule",t).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(y.value,N),N={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`item-${V}-`))),N={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},s.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`schedule-${V}-`))),p.value&&(N={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(p.value,N))),!Object.keys(o.value).length};return e.onMounted(k),e.provide("editable",n),(N,t)=>{const V=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jf,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Yf,[e.createElementVNode("table",Qf,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Hf,[e.createElementVNode("div",Wf,[e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(y).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(y).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Kf,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Xf,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Zf,[e.createElementVNode("table",vf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",eN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+S)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${S}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",tN,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]?(e.openBlock(),e.createElementBlock("div",lN,e.toDisplayString(e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`item-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",oN,[e.createElementVNode("div",nN,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,rN)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",aN,[e.createElementVNode("table",sN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",dN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:j})=>[e.createElementVNode("option",{value:j.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(j.Title),9,cN)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`schedule-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",iN,[e.createElementVNode("div",mN,[e.unref(s).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pN)):e.createCommentVNode("",!0),S+1===e.unref(s).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",VN,[e.createElementVNode("table",fN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(p).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(p).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(p).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(p).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",NN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},bN={class:"block"},gN={class:"mt-4"},yN={class:"table align-middle gray-table side-table"},kN={key:0},uN={key:1,class:"text-light-gray"},hN={class:"mt-4"},xN={class:"table align-middle gray-table side-table"},$N={class:"row g-3"},BN={class:"col-12 col-xl-2"},_N={class:"text-gray mb-2"},CN={class:"col-12 col-xl-3"},TN={class:"text-gray mb-2"},wN={class:"col-12 col-xl-4"},SN={class:"row g-1"},DN={class:"col-7"},AN={class:"col-5"},FN={class:"col-12 col-xl-3"},UN={class:"text-gray mb-2"},MN={class:"col-12"},PN={class:"text-gray mb-2"},jN={class:"mt-4"},IN={class:"table align-middle gray-table side-table"},ON={class:"mt-4"},LN={class:"table align-middle gray-table side-table"},RN={key:0,class:"table-responsive mt-3 mb-0"},qN={class:"table align-middle gray-table"},zN={key:0},GN={key:0},JN={class:"d-flex gap-2"},YN=["onClick"],QN={class:"mt-4"},HN={class:"table align-middle gray-table side-table"},WN={key:0,class:"block-bottom bg-light-teal"},KN={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.ref(),n=e.computed(()=>z("multiple",y.value.Status,1)),o=e.ref({}),l=e.ref([]),s=e.computed(()=>E.value.filter(r=>!r.Deleted)),y=e.ref({}),E=e.ref([]),h=e.computed({get:()=>!!s.value.length,set:r=>{r?x():E.value.forEach(m=>m.Deleted=!0)}}),x=()=>E.value.push({}),g=B,d=()=>{A.multiple("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(r=>{y.value=r.Project,f.value=r.Contacts,E.value=r.ReceivedSubsidies,y.value.OrgCategory=y.value.OrgCategory||null,I().init("multiple",y.value),p.value=y.value.changeApply,y.value.changeApply=void 0})},a=r=>r.Deleted=!0,k=r=>{var N,t;if(o.value={},r&&!i()){e.nextTick(()=>{var V;return(V=document.querySelector(".invalid"))==null?void 0:V.scrollIntoView({behavior:"smooth",block:"center"})});return}const m={Project:y.value,Contacts:f.value,ReceivedSubsidies:E.value.filter(V=>V.ID||!V.Deleted),Before:(N=p.value)==null?void 0:N.Form1Before,After:(t=p.value)==null?void 0:t.Form1After,Submit:r?"true":"false"};A.multiple("saveApplication",m).subscribe(V=>{r?g("next",V.ID):y.value.ID?d():window.location.href=`Application.aspx?ID=${V.ID}`})},i=()=>{let r={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return o.value=P(y.value,r),r={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((m,N)=>Object.assign(o.value,P(m,r,`contact-${N}-`))),r={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},E.value.forEach((m,N)=>Object.assign(o.value,P(m,r,`received-${N}-`))),p.value&&(r={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(p.value,r))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.multiple("getZgsCodes",{CodeGroup:"MULField"}),A.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(r=>{l.value=r[0],c.value=r[1],b.id?d():A.multiple("getEmptyApplication").subscribe(m=>{y.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},m),f.value=[{Role:"負責人"},{Role:"聯絡人"}],I().init("multiple",y.value)})})}),e.provide("editable",n),(r,m)=>{const N=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),V=e.resolveComponent("input-select"),u=e.resolveComponent("input-textarea"),w=e.resolveComponent("input-boolean"),C=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",bN,[m[43]||(m[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",gN,[e.createElementVNode("table",yN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[15]||(m[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(y).Year),1)]),e.createElementVNode("tr",null,[m[16]||(m[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(y).ProjectID?(e.openBlock(),e.createElementBlock("span",kN,e.toDisplayString(e.unref(y).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",uN,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[m[17]||(m[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(y).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[18]||(m[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).ProjectName,modelValue:e.unref(y).ProjectName,"onUpdate:modelValue":m[0]||(m[0]=D=>e.unref(y).ProjectName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[19]||(m[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{"empty-value":null,error:e.unref(o).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(y).Field,"onUpdate:modelValue":m[1]||(m[1]=D=>e.unref(y).Field=D)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[20]||(m[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(y).OrgName,"onUpdate:modelValue":m[2]||(m[2]=D=>e.unref(y).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[21]||(m[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(y).OrgCategory,"onUpdate:modelValue":m[3]||(m[3]=D=>e.unref(y).OrgCategory=D)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[22]||(m[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(y).TaxID,"onUpdate:modelValue":m[4]||(m[4]=D=>e.unref(y).TaxID=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[23]||(m[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(y).Address,"onUpdate:modelValue":m[5]||(m[5]=D=>e.unref(y).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),m[44]||(m[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",hN,[e.createElementVNode("table",xN,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(D,M)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",$N,[e.createElementVNode("div",BN,[e.createElementVNode("div",_N,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[24]||(m[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-Name`],modelValue:D.Name,"onUpdate:modelValue":F=>D.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",CN,[e.createElementVNode("div",TN,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[25]||(m[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":F=>D.JobTitle=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",wN,[m[26]||(m[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",SN,[e.createElementVNode("div",DN,[e.createVNode(t,{modelValue:D.Phone,"onUpdate:modelValue":F=>D.Phone=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",AN,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":F=>D.PhoneExt=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",FN,[e.createElementVNode("div",UN,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[27]||(m[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":F=>D.MobilePhone=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",MN,[e.createElementVNode("div",PN,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[28]||(m[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-EMail`],modelValue:D.EMail,"onUpdate:modelValue":F=>D.EMail=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),m[45]||(m[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",jN,[e.createElementVNode("table",IN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[29]||(m[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[m[30]||(m[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(u,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(y).Target,"onUpdate:modelValue":m[6]||(m[6]=D=>e.unref(y).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[31]||(m[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(y).Summary,"onUpdate:modelValue":m[7]||(m[7]=D=>e.unref(y).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[32]||(m[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(y).Quantified,"onUpdate:modelValue":m[8]||(m[8]=D=>e.unref(y).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[33]||(m[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(y).Qualitative,"onUpdate:modelValue":m[9]||(m[9]=D=>e.unref(y).Qualitative=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",ON,[e.createElementVNode("table",LN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[39]||(m[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(w,{modelValue:e.unref(h),"onUpdate:modelValue":m[10]||(m[10]=D=>e.isRef(h)?h.value=D:null)},null,8,["modelValue"]),e.unref(h)?(e.openBlock(),e.createElementBlock("div",RN,[e.createElementVNode("table",qN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[m[34]||(m[34]=e.createElementVNode("th",null,"計畫名稱",-1)),m[35]||(m[35]=e.createElementVNode("th",null,"補助單位",-1)),m[36]||(m[36]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",zN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(D,M)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${M}-Name`],modelValue:D.Name,"onUpdate:modelValue":F=>D.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${M}-Unit`],modelValue:D.Unit,"onUpdate:modelValue":F=>D.Unit=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`received-${M}-Amount`],modelValue:D.Amount,"onUpdate:modelValue":F=>D.Amount=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",GN,[e.createElementVNode("div",JN,[e.unref(s).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>a(D),type:"button"},[...m[37]||(m[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,YN)):e.createCommentVNode("",!0),M+1===e.unref(s).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:x,type:"button"},[...m[38]||(m[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[m[42]||(m[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",QN,[e.createElementVNode("table",HN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[40]||(m[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(p).Form1Before,"onUpdate:modelValue":m[11]||(m[11]=D=>e.unref(p).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...m[41]||(m[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(p).Form1After,"onUpdate:modelValue":m[12]||(m[12]=D=>e.unref(p).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",WN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:m[13]||(m[13]=D=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:m[14]||(m[14]=D=>k(!0)),type:"button"},[...m[46]||(m[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},XN={class:"block"},ZN={key:0,class:"text-pink lh-base mt-4"},vN={class:"mt-4"},e1={class:"table align-middle gray-table"},t1={class:"text-center"},l1={key:0,width:"180"},o1={class:"text-center"},n1={key:0},r1=["innerHTML"],a1=["href"],s1={key:0,class:"text-center"},d1={key:0},c1={key:1,class:"text-pink"},i1={key:1,class:"tag-group mt-2 gap-1"},m1={key:0,class:"tag tag-green-light"},p1=["download","href"],V1=["onClick"],f1={class:"mt-4"},N1={class:"table align-middle gray-table side-table"},E1={key:0,class:"block-bottom bg-light-teal"},b1=["disabled"],g1={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?tpe=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),p=e.ref(),f=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),n=e.computed(()=>z("multiple",l.value.Status,2)),o=e.ref({}),l=e.ref({}),s=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},y=A.download,E=B,h=()=>{rxjs.forkJoin([A.multiple("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=c.value.filter(k=>{var i;return!((i=k.Excludes)!=null&&i.includes(l.value.OrgCategory))}),l.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),c.value.forEach(k=>{k.Files=a.Attachments.filter(i=>i.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(i=>!i.Deleted).length)}),I().init("multiple",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},x=d=>{var k,i;if(o.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:b.id,Attachments:c.value.reduce((r,m)=>r.concat(m.Files),[]),Before:(k=p.value)==null?void 0:k.Form5Before,After:(i=p.value)==null?void 0:i.Form5After,Submit:d?"true":"false"};A.multiple("saveAttachment",a).subscribe(()=>{d?E("next"):h()})},g=()=>{if(p.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(p.value,d))}return!Object.keys(o.value).length};return e.onMounted(h),e.provide("editable",n),(d,a)=>{const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),r=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",XN,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",ZN,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",vN,[e.createElementVNode("table",e1,[e.createElementVNode("thead",t1,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",l1,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",o1,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",n1,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,r1)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:m.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,a1)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",s1,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",d1,"已上傳")):(e.openBlock(),e.createElementBlock("span",c1,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>s(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",i1,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",m1,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(y)(t.Path)},e.toDisplayString(t.Name),9,p1),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,V1)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",f1,[e.createElementVNode("table",N1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(p).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(p).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(p).Form5After,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",E1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=m=>x(!0)),disabled:e.unref(f),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,b1)])):e.createCommentVNode("",!0)],64)}}},y1={class:"block"},k1={class:"mt-4"},u1={class:"table-responsive mt-3 mb-0"},h1={class:"table align-middle gray-table"},x1={key:0,width:"1"},$1={key:0},B1={class:"d-flex gap-2"},_1=["onClick"],C1={class:"table-responsive mt-3 mb-0"},T1={class:"table align-middle gray-table"},w1={class:"mt-4"},S1={class:"table align-middle gray-table side-table"},D1={key:0,class:"block-bottom bg-light-teal"},A1={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=e.ref(),f=e.computed(()=>z("multiple",l.value.Status,4)),n=e.ref({}),o=e.computed(()=>c.value.filter(d=>!d.Deleted)),l=e.ref({}),s=()=>c.value.push({}),y=B,E=()=>{rxjs.forkJoin([A.multiple("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const a=d[0];l.value=a.Project,c.value=a.Benefits,c.value.length||s(),I().init("multiple",l.value),p.value=l.value.changeApply,l.value.changeApply=void 0})},h=d=>d.Deleted=!0,x=d=>{var k,i;if(n.value={},d&&!g()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(k=p.value)==null?void 0:k.Form4Before,After:(i=p.value)==null?void 0:i.Form4After,Submit:d?"true":"false"};A.multiple("saveBenefit",a).subscribe(()=>{d?y("next"):E()})},g=()=>{let d={Benefit:"不可量化成果"};return n.value=P(l.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,k)=>Object.assign(n.value,P(a,d,`item-${k}-`))),p.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,P(p.value,d))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",f),(d,a)=>{const k=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",y1,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",k1,[e.createElementVNode("div",u1,[e.createElementVNode("table",h1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",x1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${N}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n)[`item-${N}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",$1,[e.createElementVNode("div",B1,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>h(m),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_1)):e.createCommentVNode("",!0),N+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",C1,[e.createElementVNode("table",T1,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(l).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",w1,[e.createElementVNode("table",S1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(p).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(p).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(p).Form4After,"onUpdate:modelValue":a[2]||(a[2]=m=>e.unref(p).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",D1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=m=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=m=>x(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},F1={class:"block"},U1={class:"mt-4"},M1={class:"table-responsive mt-3 mb-0"},P1={class:"table align-middle gray-table"},j1={class:"text-end"},I1={class:"text-end"},O1={class:"table-responsive"},L1={class:"table align-middle gray-table"},R1=["colspan"],q1={key:0,width:"1"},z1={class:"text-end"},G1={key:0},J1={class:"d-flex gap-2"},Y1=["onClick"],Q1={class:"mt-4"},H1={class:"table-responsive mt-3 mb-0"},W1={class:"table align-middle gray-table"},K1={key:0,width:"1"},X1={class:"text-end"},Z1={key:0},v1={class:"d-flex gap-2"},eE=["onClick"],tE={class:"mt-4"},lE={class:"table align-middle gray-table side-table"},oE={key:0,class:"block-bottom bg-light-teal"},nE={class:"text-center"},rE={class:"mb-5"},aE={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(),p=e.computed(()=>z("multiple",l.value.Status,3)),f=e.ref({}),n=e.computed(()=>y.value.filter(N=>!N.Deleted)),o=e.computed(()=>E.value.filter(N=>!N.Deleted)),l=e.ref({}),s=e.ref(),y=e.ref([]),E=e.ref([]),h=e.ref({}),x=e.ref(0),g=()=>y.value.push({}),d=()=>E.value.push({}),a=B,k=()=>{rxjs.forkJoin([A.multiple("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];l.value=t.Project,y.value=t.OtherSubsidies,E.value=t.BudgetPlans,h.value=t.GrantTargetSetting,E.value.length||d(),I().init("multiple",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=(N,t)=>{var u,w;if(f.value={},N&&!m()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>h.value.GrantLimit*1e4){s.value.show(()=>r(N,!0));return}const V={Project:l.value,OtherSubsidies:y.value,BudgetPlans:E.value,Before:(u=c.value)==null?void 0:u.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:N?"true":"false"};A.multiple("saveFunding",V).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=P(l.value,N),N={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},n.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`other-${V}-`))),N={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,P(t,N,`plan-${V}-`))),c.value&&(N={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,P(c.value,N))),!Object.keys(f.value).length};return e.onMounted(k),e.provide("editable",p),e.watchEffect(()=>{l.value.OtherAmount=n.value.reduce((N,t)=>N+q(t.Amount),0),x.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),n.value.forEach(N=>N.percent=Math.round(q(N.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(N=>N.sum=q(N.Amount)+q(N.OtherAmount))}),(N,t)=>{var M;const V=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",F1,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",U1,[e.createElementVNode("div",M1,[e.createElementVNode("table",P1,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",j1,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",I1,e.toDisplayString(e.unref(x).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",O1,[e.createElementVNode("table",L1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(p)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,R1)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",q1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":S=>F.Unit=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",z1,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":S=>F.Content=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",G1,[e.createElementVNode("div",J1,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Y1)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(p)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Q1,[e.createElementVNode("div",H1,[e.createElementVNode("table",W1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",K1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(f)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":S=>F.Title=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":S=>F.OtherAmount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",X1,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":S=>F.Description=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Z1,[e.createElementVNode("div",v1,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:S=>i(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,eE)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",tE,[e.createElementVNode("table",lE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",oE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:s},{default:e.withCtx(()=>[e.createElementVNode("div",nE,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",rE,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(h).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},sE={class:"block"},dE={class:"square-title"},cE={class:"text-teal fw-bold py-3"},iE={class:"table-responsive mb-0"},mE={class:"table align-middle gray-table"},pE={class:"text-end"},VE={class:"text-teal fw-bold pb-3"},fE={class:"text-teal fw-bold pb-3"},NE={class:"mt-4"},EE={class:"table align-middle gray-table"},bE={class:"text-center"},gE={key:0,width:"180"},yE={class:"text-center"},kE=["href"],uE={key:0,class:"text-center"},hE={key:0},xE={key:1,class:"text-pink"},$E={key:1,class:"tag-group mt-2 gap-1"},BE={key:0,class:"tag tag-green-light"},_E=["download","href"],CE=["onClick"],TE={class:"block-bottom bg-light-teal"},wE=["disabled"],SE={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>s.value.some(d=>!d.Files.filter(a=>!a.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),n=e.computed(()=>{var d;return((d=o.value)==null?void 0:d.Status)==="通過"}),o=e.ref(),l=e.ref({}),s=e.ref([{Type:11,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]}]),y=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:`${l.value.ProjectID}_第一期_${d.Title}.pdf`})},E=A.download,h=B,x=()=>{A.multiple("getPayment",{ID:b.id}).subscribe(d=>{l.value=d.Project,I().init("multiple",l.value),s.value=s.value.filter(a=>{var k;return!((k=a.Excludes)!=null&&k.includes(l.value.OrgCategory))}),s.value.forEach(a=>{a.Files=d.Attachments.filter(k=>k.Type===a.Type),a.Uploaded=e.computed(()=>a.Files.filter(k=>!k.Deleted).length)}),o.value=d.Payments.find(a=>a.Stage===1),o.value?c.value=o.value.CurrentRequestAmount:c.value=Math.round(l.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),Y().init(o.value)})},g=d=>{const a={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:c.value},Attachments:s.value.reduce((k,i)=>k.concat(i.Files),[]),Submit:d?"true":"false"};A.multiple("savePayment",a).subscribe(()=>{d?h("next"):x()})};return e.onMounted(x),e.provide("editable",f),(d,a)=>{var r;const k=e.resolveComponent("required-label"),i=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",sE,[e.createElementVNode("h5",dE,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",cE,"核定經費: "+e.toDisplayString((r=e.unref(l).ApprovedAmount)==null?void 0:r.toLocaleString())+"元",1),e.createElementVNode("div",iE,[e.createElementVNode("table",mE,[a[6]||(a[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",pE,e.toDisplayString(e.unref(c)),1),a[2]||(a[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[3]||(a[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[4]||(a[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[5]||(a[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",VE,"本期實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",fE,"累積實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),a[13]||(a[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",NE,[e.createElementVNode("table",EE,[e.createElementVNode("thead",bE,[e.createElementVNode("tr",null,[a[7]||(a[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[8]||(a[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",gE,"狀態")):e.createCommentVNode("",!0),a[9]||(a[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",yE,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024)]),e.unref(f)&&m.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:m.Template,style:{width:"140px"},type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,kE)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",uE,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",hE,"已上傳")):(e.openBlock(),e.createElementBlock("span",xE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!m.Uploaded?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>y(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",$E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",BE,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,_E),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...a[11]||(a[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,CE)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",TE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[0]||(a[0]=m=>g()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[1]||(a[1]=m=>g(!0)),disabled:e.unref(p),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,wE)])],64)}}},DE={class:"block"},AE={class:"square-title"},FE={class:"text-teal fw-bold py-3"},UE={class:"table-responsive mb-0"},ME={class:"table align-middle gray-table"},PE={class:"text-end"},jE={class:"text-end"},IE={class:"text-end"},OE={class:"text-end"},LE={class:"text-teal fw-bold pb-3"},RE={class:"text-teal fw-bold pb-3"},qE={class:"mt-4"},zE={class:"table align-middle gray-table"},GE={class:"text-center"},JE={key:0,width:"180"},YE={class:"text-center"},QE=["href"],HE={key:0,class:"text-center"},WE={key:0},KE={key:1,class:"text-pink"},XE={key:1,class:"tag-group mt-2 gap-1"},ZE={key:0,class:"tag tag-green-light"},vE=["download","href"],eb=["onClick"],tb={class:"block-bottom bg-light-teal"},lb=["disabled"],ob={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.ref(0),f=e.computed(()=>c.value<=0||a.value.some(t=>!t.Files.filter(V=>!V.Deleted).length)),n=e.computed(()=>!s.value||s.value.Status==="請款中"),o=e.computed(()=>{var t;return((t=s.value)==null?void 0:t.Status)==="通過"}),l=e.ref(0),s=e.ref(),y=e.ref(0),E=e.ref(0),h=e.ref({}),x=e.computed(()=>h.value.ApprovedAmount?Math.min(Math.round(c.value*100/h.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>d.value?Math.min(Math.round(c.value*100/d.value*100)/100,100):0),d=e.computed(()=>E.value+(o.value?s.value.CurrentActualPaidAmount:0)),a=e.ref([{Type:21,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:24,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),k=(t,V)=>{V.Type==="application/pdf"&&t.Files.push({Type:t.Type,Path:V.Path,Name:`${h.value.ProjectID}_第二期_${t.Title}.pdf`})},i=A.download,r=B,m=()=>{A.multiple("getPayment",{ID:b.id}).subscribe(t=>{h.value=t.Project,I().init("multiple",h.value),a.value=a.value.filter(u=>{var w;return!((w=u.Excludes)!=null&&w.includes(h.value.OrgCategory))}),a.value.forEach(u=>{u.Files=t.Attachments.filter(w=>w.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(w=>!w.Deleted).length)}),s.value=t.Payments.find(u=>u.Stage===2),s.value?p.value=s.value.CurrentRequestAmount:p.value=Math.round(h.value.ApprovedAmount*b.setting.DisbursementRatioPct/100);const V=t.Payments.filter(u=>u.Stage<2&&u.Status==="通過");y.value=V.reduce((u,w)=>u+w.CurrentRequestAmount,0),E.value=V.reduce((u,w)=>u+w.CurrentActualPaidAmount,0),l.value=h.value.ApprovedAmount,Y().init(s.value,E.value)})},N=t=>{const V={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:p.value,TotalSpentAmount:c.value},Attachments:a.value.reduce((u,w)=>u.concat(w.Files),[]),Submit:t?"true":"false"};A.multiple("savePayment",V).subscribe(()=>{t?r("next"):m()})};return e.onMounted(m),e.provide("editable",n),(t,V)=>{var D;const u=e.resolveComponent("input-integer"),w=e.resolveComponent("required-label"),C=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",DE,[e.createElementVNode("h5",AE,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",FE,"核定經費: "+e.toDisplayString((D=e.unref(h).ApprovedAmount)==null?void 0:D.toLocaleString())+"元",1),e.createElementVNode("div",UE,[e.createElementVNode("table",ME,[V[3]||(V[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",PE,e.toDisplayString(e.unref(p)),1),e.createElementVNode("td",jE,e.toDisplayString(e.unref(E)),1),e.createElementVNode("td",null,[e.createVNode(u,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":V[0]||(V[0]=M=>e.isRef(c)?c.value=M:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",IE,e.toDisplayString(e.unref(x))+"%",1),e.createElementVNode("td",OE,e.toDisplayString(e.unref(g))+"%",1)])])])]),e.unref(o)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",LE,"本期實際撥款: "+e.toDisplayString(e.unref(s).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",RE,"累積實際撥款: "+e.toDisplayString(e.unref(d).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),V[9]||(V[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),V[10]||(V[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",qE,[e.createElementVNode("table",zE,[e.createElementVNode("thead",GE,[e.createElementVNode("tr",null,[V[4]||(V[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),V[5]||(V[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",JE,"狀態")):e.createCommentVNode("",!0),V[6]||(V[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(M,F)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",YE,e.toDisplayString(F+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(M.Title),1)]),_:2},1024)]),e.unref(n)&&M.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:M.Template,style:{width:"140px"},type:"button"},[...V[7]||(V[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,QE)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",HE,[M.Uploaded?(e.openBlock(),e.createElementBlock("span",WE,"已上傳")):(e.openBlock(),e.createElementBlock("span",KE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&!M.Uploaded?(e.openBlock(),e.createBlock(C,{key:0,accept:".pdf",onFile:T=>k(M,T)},null,8,["onFile"])):e.createCommentVNode("",!0),M.Uploaded?(e.openBlock(),e.createElementBlock("div",XE,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(M.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ZE,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(i)(T.Path)},e.toDisplayString(T.Name),9,vE),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>T.Deleted=!0,type:"button"},[...V[8]||(V[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,eb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",tb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[1]||(V[1]=M=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[2]||(V[2]=M=>N(!0)),disabled:e.unref(f),type:"button"},[...V[11]||(V[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,lb)])],64)}}},nb={class:"block"},rb={class:"square-title"},ab={class:"text-teal fw-bold py-3"},sb={class:"text-teal fw-bold pb-3"},db={class:"table-responsive"},cb={class:"table align-middle gray-table"},ib={class:"text-end"},mb={class:"text-end"},pb={class:"text-end"},Vb={class:"mt-4"},fb={class:"table align-middle gray-table"},Nb={class:"text-center"},Eb={key:0,width:"180"},bb={class:"text-center"},gb=["href"],yb={key:0,class:"text-center"},kb={key:0},ub={key:1,class:"text-pink"},hb={key:1,class:"tag-group mt-2 gap-1"},xb={key:0,class:"tag tag-green-light"},$b=["download","href"],Bb=["onClick"],_b={class:"text-center"},Cb={colspan:"2"},Tb={class:"block-bottom bg-light-teal"},wb=["disabled"],Sb={__name:"Payment3",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref(0),p=e.computed(()=>c.value<=0||h.value.some(i=>!i.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),n=e.ref(0),o=e.ref(),l=e.ref(0),s=e.ref({}),y=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(c.value*100/s.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.min(Math.round(c.value*100/l.value*100)/100,100):0),h=e.ref([{Type:31,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:32,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:33,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:34,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),x=(i,r)=>{r.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:r.Path,Name:`${s.value.ProjectID}_結案核銷_${i.Title}.pdf`})},g=A.download,d=B,a=()=>{A.multiple("getPayment",{ID:b.id}).subscribe(i=>{s.value=i.Project,I().init("multiple",s.value),h.value=h.value.filter(r=>{var m;return!((m=r.Excludes)!=null&&m.includes(s.value.OrgCategory))}),h.value.forEach(r=>{r.Files=i.Attachments.filter(m=>m.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(m=>!m.Deleted).length)}),o.value=i.Payments.find(r=>r.Stage===3),l.value=i.Payments.filter(r=>r.Stage<3&&r.Status==="通過").reduce((r,m)=>r+m.CurrentActualPaidAmount,0),n.value=s.value.ApprovedAmount,Y().init(o.value,l.value)})},k=i=>{const r={Payment:{ProjectID:b.id,Stage:3,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:h.value.reduce((m,N)=>m.concat(N.Files),[]),Submit:i?"true":"false"};A.multiple("savePayment",r).subscribe(()=>{i?d("next"):a()})};return e.onMounted(a),e.provide("editable",f),(i,r)=>{var u;const m=e.resolveComponent("input-integer"),N=e.resolveComponent("required-label"),t=e.resolveComponent("input-file"),V=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nb,[e.createElementVNode("h5",rb,e.toDisplayString(_.setting.DisbursementType)+e.toDisplayString(_.setting.Note),1),e.createElementVNode("p",ab,"核定經費: "+e.toDisplayString((u=e.unref(s).ApprovedAmount)==null?void 0:u.toLocaleString())+"元",1),e.createElementVNode("p",sb,"賸餘款: "+e.toDisplayString((e.unref(s).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",db,[e.createElementVNode("table",cb,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",ib,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(m,{max:e.unref(n),modelValue:e.unref(c),"onUpdate:modelValue":r[0]||(r[0]=w=>e.isRef(c)?c.value=w:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",mb,e.toDisplayString(e.unref(y))+"%",1),e.createElementVNode("td",pb,e.toDisplayString(e.unref(E))+"%",1)])])])]),r[11]||(r[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[12]||(r[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Vb,[e.createElementVNode("table",fb,[e.createElementVNode("thead",Nb,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Eb,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(w,C)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",bb,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Title),1)]),_:2},1024)]),e.unref(f)&&w.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:w.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,gb)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",yb,[w.Uploaded?(e.openBlock(),e.createElementBlock("span",kb,"已上傳")):(e.openBlock(),e.createElementBlock("span",ub,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!w.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:D=>x(w,D)},null,8,["onFile"])):e.createCommentVNode("",!0),w.Uploaded?(e.openBlock(),e.createElementBlock("div",hb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",xb,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(g)(D.Path)},e.toDisplayString(D.Name),9,$b),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:M=>D.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Bb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128)),e.createElementVNode("tr",null,[e.createElementVNode("td",_b,e.toDisplayString(e.unref(h).length+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("其他資料（5分鐘精華影片）",-1)])]),_:1})])]),e.createElementVNode("td",Cb,[e.createVNode(V)])])])])])]),e.createElementVNode("div",Tb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=w=>k()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=w=>k(!0)),disabled:e.unref(p),type:"button"},[...r[13]||(r[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,wb)])],64)}}},Db={__name:"ProgressBar",setup(_){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,c)=>{const p=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(p,{steps:B,type:"multiple"})}}},Ab={class:"block"},Fb={class:"mt-4"},Ub={class:"table align-middle gray-table side-table"},Mb={key:0,class:"d-flex align-items-center gap-2"},Pb={class:"input-group w-auto"},jb={class:"text-teal-dark"},Ib={key:1,class:"invalid mt-0"},Ob={class:"table-responsive mt-4"},Lb={class:"table align-middle gray-table"},Rb={key:0},qb={class:"input-group"},zb={key:0,class:"invalid mt-0"},Gb={key:0},Jb={class:"d-flex gap-2"},Yb=["onClick"],Qb={class:"mt-4"},Hb={class:"table align-middle gray-table"},Wb={key:0},Kb=["value"],Xb={key:0},Zb={class:"d-flex gap-2"},vb=["onClick"],eg={class:"mt-4"},tg={class:"table align-middle gray-table side-table"},lg={key:0,class:"block-bottom bg-light-teal"},og={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=[{value:1,text:"50%"},{value:2,text:"100%"}],p=e.ref(),f=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("multiple",y.value.Status,2)),o=e.ref({}),l=e.computed(()=>h.value.filter(N=>!N.Deleted)),s=e.computed(()=>x.value.filter(N=>!N.Deleted)),y=e.ref({}),E=e.ref({}),h=e.ref([]),x=e.ref([]),g=()=>A.multiple("createItem",{ID:b.id}).subscribe(N=>h.value.push(N)),d=()=>x.value.push({Type:0,ItemID:0}),a=B,k=()=>{rxjs.forkJoin([A.multiple("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(N=>{const t=N[0];y.value=t.Project,E.value=t.GrantType,h.value=t.Items,x.value=t.Schedules,h.value.length||g(),x.value.length||d(),I().init("multiple",y.value),p.value=y.value.changeApply,y.value.changeApply=void 0})},i=N=>N.Deleted=!0,r=N=>{var V,u;if(o.value={},N&&!m()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:y.value,Items:h.value,Schedules:x.value,Before:(V=p.value)==null?void 0:V.Form2Before,After:(u=p.value)==null?void 0:u.Form2After,Submit:N?"true":"false"};A.multiple("saveWorkSchedule",t).subscribe(()=>{N?a("next"):k()})},m=()=>{let N={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(y.value,N),N={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`item-${V}-`))),N={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},s.value.forEach((t,V)=>Object.assign(o.value,P(t,N,`schedule-${V}-`))),p.value&&(N={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(p.value,N))),!Object.keys(o.value).length};return e.onMounted(k),e.provide("editable",n),(N,t)=>{const V=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ab,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Fb,[e.createElementVNode("table",Ub,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Mb,[e.createElementVNode("div",Pb,[e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(y).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(y).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(y).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",jb,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Ib,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Ob,[e.createElementVNode("table",Lb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Rb,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+S)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${S}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",qb,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]?(e.openBlock(),e.createElementBlock("div",zb,e.toDisplayString(e.unref(o)[`item-${S}-Begin`]||e.unref(o)[`item-${S}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`item-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Gb,[e.createElementVNode("div",Jb,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Yb)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Qb,[e.createElementVNode("table",Hb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Wb,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${S}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:j})=>[e.createElementVNode("option",{value:j.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(j.Title),9,Kb)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(o)[`schedule-${S}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${S}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Xb,[e.createElementVNode("div",Zb,[e.unref(s).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>i(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vb)):e.createCommentVNode("",!0),S+1===e.unref(s).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",eg,[e.createElementVNode("table",tg,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(p).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(p).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(p).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(p).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",lg,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},ng={class:"block bg-light-teal-100 rounded-4 py-4"},rg={class:"fw-bold"},ag={class:"d-flex align-items-center gap-3 text-teal-dark mt-3"},sg={class:"block rounded-4 mt-4"},dg=["innerHTML"],cg={class:"mt-3 d-flex flex-column gap-2"},ig=["download","href"],mg={class:"mt-3"},pg=["data-caption","href"],Vg=["alt","src"],fg={class:"mt-3 d-flex flex-column gap-2"},Ng=["href"],Eg={__name:"NewsDetail",props:{id:{type:[Number,String]}},setup(_){const B=_,b=e.ref(),c=e.ref([]),p=e.ref({}),f=e.ref([]),n=e.ref([]),o=A.download;return e.onMounted(()=>{A.system("getNews",{ID:B.id}).subscribe(l=>{p.value=l.News,c.value=l.Files,f.value=l.Images,n.value=l.Videos,e.nextTick(()=>{Fancybox.bind(b.value,"[data-fancybox]")})})}),(l,s)=>{const y=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ng,[e.createElementVNode("h5",rg,e.toDisplayString(e.unref(p).Title),1),e.createElementVNode("ul",ag,[e.createElementVNode("li",null,[s[0]||(s[0]=e.createTextVNode("公告日期：",-1)),e.createVNode(y,{value:e.unref(p).EnableTime},null,8,["value"])]),e.createElementVNode("li",null,"公告單位："+e.toDisplayString(e.unref(p).UserOrg),1)])]),e.createElementVNode("div",sg,[e.createElementVNode("div",{class:"mb-5",style:{"white-space":"pre-line"},innerHTML:e.unref(p).Content},null,8,dg),e.unref(c).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[s[2]||(s[2]=e.createElementVNode("h5",{class:"square-title"},"相關附件",-1)),e.createElementVNode("ul",cg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",download:E.Name,href:e.unref(o)(E.Path)},[e.createTextVNode(e.toDisplayString(E.Name)+" ",1),s[1]||(s[1]=e.createElementVNode("i",{class:"fa-solid fa-file-arrow-down text-teal-dark ms-1"},null,-1))],8,ig)]))),128))])],64)):e.createCommentVNode("",!0),e.unref(f).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[s[4]||(s[4]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關照片",-1)),e.createElementVNode("div",mg,[e.createElementVNode("div",{class:"image-preview mt-3",ref_key:"container",ref:b},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(E,h)=>(e.openBlock(),e.createElementBlock("div",{class:"image-preview__item",key:E},[e.createElementVNode("a",{"data-fancybox":"gallery","data-caption":`相片 ${h}`,href:e.unref(o)(E.Path)},[e.createElementVNode("img",{alt:`相片 ${h}`,src:e.unref(o)(E.Path)},null,8,Vg),s[3]||(s[3]=e.createElementVNode("div",{class:"image-preview__item-overlay"},[e.createElementVNode("button",{"aria-label":"檢視圖片",class:"btn btn-view-image",tabindex:"-1",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"})])],-1))],8,pg)]))),128))],512)])],64)):e.createCommentVNode("",!0),e.unref(n).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[s[6]||(s[6]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關影片",-1)),e.createElementVNode("ul",fg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",href:E.URL,target:"_blank"},[e.createTextVNode(e.toDisplayString(E.Title)+" ",1),s[5]||(s[5]=e.createStaticVNode('<svg class="ms-1" xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19 24" fill="none"><g clip-path="url(#clip0_1051_6167)"><path d="M17.7333 0.5H12.6667C11.913 0.5 11.4 1.12067 11.4 1.76667C11.4 2.05167 11.4887 2.36833 11.7673 2.65967L13.4077 4.3L9.87367 7.834C9.60767 8.1 9.5 8.423 9.5 8.727C9.5 9.43633 10.0573 9.99367 10.7667 9.99367C11.096 9.99367 11.4127 9.87333 11.6597 9.62L15.1937 6.086L16.834 7.72633C17.1253 8.005 17.442 8.09367 17.727 8.09367C18.373 8.09367 18.9937 7.58067 18.9937 6.827V1.76667C18.9937 1.12067 18.4807 0.5 17.727 0.5H17.7333ZM15.2 7.88467L12.559 10.5257C12.084 11.0007 11.4443 11.2667 10.7667 11.2667C9.348 11.2667 8.23333 10.152 8.23333 8.73333C8.23333 8.05567 8.49933 7.42233 8.97433 6.941L11.6153 4.3L10.8743 3.559C10.716 3.39433 10.5957 3.217 10.488 3.03333H1.26667C0.563667 3.03333 0 3.597 0 4.3V18.2333C0 18.93 0.563667 19.5 1.26667 19.5H15.2C15.8967 19.5 16.4667 18.93 16.4667 18.2333V9.01833C16.2893 8.917 16.1183 8.79667 15.9663 8.651L15.2 7.88467Z" fill="#037F72"></path></g><defs><clipPath id="clip0_1051_6167"><rect width="19" height="19" fill="white" transform="translate(0 0.5)"></rect></clipPath></defs></svg>',1))],8,Ng)]))),128))])],64)):e.createCommentVNode("",!0)])],64)}}},bg={class:"block rounded-4 mt-4"},gg={class:"table-responsive",style:{"min-height":"400px"}},yg={class:"table teal-table","aria-label":"公告列表"},kg={"data-th":"公告時間:"},ug={"data-th":"公告標題:",class:"text-start"},hg=["href"],xg={"data-th":"發布單位:",class:"text-start"},$g={__name:"NewsList",setup(_){const B=e.ref([]),b=e.ref(1),c=e.ref(10),p=e.computed(()=>B.value.slice((b.value-1)*c.value,b.value*c.value)),f=(n,o)=>{b.value=parseInt(n),c.value=parseInt(o)};return e.onMounted(()=>{A.system("getPublishedNewsList").subscribe(n=>B.value=n.List)}),(n,o)=>{const l=e.resolveComponent("tw-date"),s=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",bg,[o[1]||(o[1]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")])])],-1)),e.createElementVNode("div",gg,[e.createElementVNode("table",yg,[o[0]||(o[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告時間"),e.createElementVNode("th",{scope:"col",class:"text-start"},"標題"),e.createElementVNode("th",{scope:"col",style:{width:"300px"}},"發布單位")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),y=>(e.openBlock(),e.createElementBlock("tr",{key:y},[e.createElementVNode("td",kg,[e.createVNode(l,{value:y.EnableTime},null,8,["value"])]),e.createElementVNode("td",ug,[e.createElementVNode("a",{class:"link-black",href:`NewsDetail.aspx?ID=${y.ID}`},e.toDisplayString(y.Title),9,hg)]),e.createElementVNode("td",xg,e.toDisplayString(y.UserOrg)+" "+e.toDisplayString(y.UserName),1)]))),128))])])]),e.createVNode(s,{count:e.unref(B).length,onChange:f,page:e.unref(b),"page-size":e.unref(c)},null,8,["count","page","page-size"])])}}},Bg={key:0,class:"notice mb-3"},_g={class:"notice-content"},Cg=["onClick"],Tg={class:"notice-action"},wg=["href"],Sg=le({__name:"NewsMarquee",setup(_){let B=0;const b=e.ref([]),c=e.ref(),p=e.computed(()=>A.toUrl("/OFS/Information/NewsList.aspx")),f=n=>{window.open(A.toUrl(`/OFS/Information/NewsDetail.aspx?ID=${n.ID}`),"_blank")};return e.onMounted(()=>{A.system("getPublishedNewsList").subscribe(n=>{b.value=n.List,b.value.length>1&&setInterval(()=>{B++,c.value.style.transition="transform 1s ease-in-out",c.value.style.transform=`translateY(-${B*1.5}rem)`,B===b.value.length&&setTimeout(()=>{c.value.style.transition="none",c.value.style.transform="translateY(0)",B=0},1e3)},5e3)})}),(n,o)=>{const l=e.resolveComponent("tw-date");return e.unref(b).length?(e.openBlock(),e.createElementBlock("div",Bg,[e.createElementVNode("div",_g,[e.createElementVNode("div",{class:"notice-list",ref_key:"marquee",ref:c},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),s=>(e.openBlock(),e.createElementBlock("h3",{class:"notice-title",onClick:y=>f(s),style:{"margin-bottom":"0.5rem",cursor:"pointer"},key:s},[e.createVNode(l,{value:s.EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(s.Title),1)],8,Cg))),128)),e.unref(b).length>1?(e.openBlock(),e.createElementBlock("h3",{key:0,class:"notice-title",onClick:o[0]||(o[0]=s=>f(e.unref(b)[0])),style:{cursor:"pointer"}},[e.createVNode(l,{value:e.unref(b)[0].EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(e.unref(b)[0].Title),1)])):e.createCommentVNode("",!0)],512)]),e.createElementVNode("div",Tg,[e.createElementVNode("a",{class:"btn-link",href:e.unref(p)},"全部公告",8,wg)])])):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-8802a1c0"]]),Dg={key:0,class:"scroll-bottom-panel"},Ag={class:"d-flex flex-column gap-3 mb-3"},Fg={class:"d-flex gap-2"},Ug={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Mg={class:"text-nowrap my-2 d-flex align-items-center"},Pg={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(_){const B=_,b=I(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],p=e.ref({}),f=e.ref({ID:B.id,Result:1}),n=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),p.value=P(f.value,l),Object.keys(p.value).length){o();return}A[B.type]("reviewApplicationChange",f.value).subscribe(s=>{s&&(window.location.href="../ReviewChecklist.aspx?type=5")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,s)=>{const y=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[_.type].organizer?(e.openBlock(),e.createElementBlock("div",Dg,[s[3]||(s[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ag,[e.createElementVNode("li",Fg,[s[2]||(s[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Ug,[e.createElementVNode("div",Mg,[e.createVNode(y,{options:c,modelValue:e.unref(f).Result,"onUpdate:modelValue":s[0]||(s[0]=h=>e.unref(f).Result=h)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(p).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":s[1]||(s[1]=h=>e.unref(f).Reason=h)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},jg={key:0,class:"scroll-bottom-panel"},Ig={class:"d-flex flex-column gap-3 mb-3"},Og={class:"d-flex gap-2"},Lg={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Rg={class:"text-nowrap my-2 d-flex align-items-center"},qg={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(_){const B=_,b=I(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],p=e.ref({}),f=e.ref({ID:B.id,Result:1}),n=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),p.value=P(f.value,l),Object.keys(p.value).length){o();return}A[B.type]("reviewApplication",f.value).subscribe(s=>{s&&(window.location.href="../ReviewChecklist.aspx?type=4")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,s)=>{const y=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[_.type].organizer?(e.openBlock(),e.createElementBlock("div",jg,[s[3]||(s[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ig,[e.createElementVNode("li",Og,[s[2]||(s[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Lg,[e.createElementVNode("div",Rg,[e.createVNode(y,{options:c,modelValue:e.unref(f).Result,"onUpdate:modelValue":s[0]||(s[0]=h=>e.unref(f).Result=h)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(p).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":s[1]||(s[1]=h=>e.unref(f).Reason=h)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},zg={class:"d-flex align-items-center gap-3"},Gg={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Jg={class:"modal-content"},Yg={class:"modal-header"},Qg={class:"fs-24 fw-bold text-green-light"},Hg={class:"modal-body"},Wg={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},Kg=["disabled"],Xg={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(_){const B=_,b=e.computed(()=>!f.value||f.value===o[B.type].organizer),c=e.ref(),p=e.computed(()=>o[B.type].organizerName),f=e.ref(0),n=e.computed(()=>{var x;return(x=y.value.find(g=>g.UnitID===s.value))==null?void 0:x.reviewers}),o=I(),l=e.computed(()=>p.value?"移轉案件":"認領案件"),s=e.ref(0),y=e.ref([]),E=()=>{A[B.type]("queryReviewUnits").subscribe(x=>{y.value=x,rxjs.forkJoin(y.value.map(g=>A[B.type]("queryReviewersByUnit",{ID:g.UnitID}))).subscribe(g=>{g.forEach((d,a)=>{y.value[a].reviewers=d,d.some(k=>k.UserID===f.value)&&(s.value=y.value[a].UnitID)}),bootstrap.Modal.getOrCreateInstance(c.value).show()})})},h=()=>{A[B.type]("saveOrganizer",{ID:B.id,Organizer:f.value}).subscribe(x=>{x&&window.location.reload()})};return e.watch(p,()=>f.value=o[B.type].organizer),e.watch(s,()=>{n.value.some(x=>x.UserID===f.value)||(f.value=0)}),(x,g)=>{const d=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",zg,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(p)||"尚無"),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:E,type:"button"},e.toDisplayString(e.unref(l)),1)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",Gg,[e.createElementVNode("div",Jg,[e.createElementVNode("div",Yg,[e.createElementVNode("h4",Qg,e.toDisplayString(e.unref(l)),1),g[2]||(g[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",Hg,[e.createElementVNode("div",null,[g[3]||(g[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(d,{"empty-value":0,options:e.unref(y),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(s),"onUpdate:modelValue":g[0]||(g[0]=a=>e.isRef(s)?s.value=a:null)},null,8,["options","modelValue"]),e.createVNode(d,{class:"mt-2","empty-value":0,options:e.unref(n),"text-name":"Name","value-name":"UserID",modelValue:e.unref(f),"onUpdate:modelValue":g[1]||(g[1]=a=>e.isRef(f)?f.value=a:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",Wg,[g[4]||(g[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:h,disabled:e.unref(b),type:"button"},"確認",8,Kg)])])])])],512)]))],64)}}},Zg={key:0,class:"scroll-bottom-panel"},vg={class:"d-flex flex-column gap-3 mb-3"},ey={key:0,class:"d-flex gap-2 align-items-center"},ty={key:1,class:"d-flex gap-2 align-items-center"},ly={class:"d-flex gap-2"},oy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},ny={class:"text-nowrap my-2 d-flex align-items-center"},ry=["disabled"],ay={__name:"ProjectPaymentReview",props:{id:{type:[Number,String]},type:{type:String}},setup(_){const B=_,b=Y(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],p=e.computed(()=>!b.stage),f=e.ref({}),n=e.ref({ID:B.id,Result:1,Reason:""}),o=e.computed(()=>n.value.Result===1?["culture","literacy","accessibility"].includes(B.type)&&b.stage===2||B.type==="education"||B.type==="multiple"&&b.stage===3?"確定撥款及結案核銷":"確定撥款":"確定退回"),l=()=>{const y={};if(n.value.Result>1&&(y.Reason="原因"),f.value=P(n.value,y),Object.keys(f.value).length){s();return}n.value.Stage=b.stage,A[B.type]("reviewPayment",n.value).subscribe(E=>{E&&(window.location.href="../ReviewChecklist.aspx?type=5")})},s=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>n.value.Result,y=>{y>1&&s()}),e.watch(()=>b.amount,y=>n.value.Amount=y),(y,E)=>{const h=e.resolveComponent("input-integer"),x=e.resolveComponent("input-radio-group"),g=e.resolveComponent("input-textarea");return e.unref(b).status==="審核中"?(e.openBlock(),e.createElementBlock("div",Zg,[E[6]||(E[6]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",vg,[e.unref(b).amount?(e.openBlock(),e.createElementBlock("li",ey,[E[3]||(E[3]=e.createElementVNode("span",{class:"text-gray"},"本期撥付：",-1)),e.createVNode(h,{class:"w-auto",max:e.unref(b).amount,modelValue:e.unref(n).Amount,"onUpdate:modelValue":E[0]||(E[0]=d=>e.unref(n).Amount=d)},null,8,["max","modelValue"])])):e.createCommentVNode("",!0),e.unref(b).paid?(e.openBlock(),e.createElementBlock("li",ty,[E[4]||(E[4]=e.createElementVNode("span",{class:"text-gray"},"前期累積撥付：",-1)),e.createTextVNode(" "+e.toDisplayString(e.unref(b).paid.toLocaleString()),1)])):e.createCommentVNode("",!0),e.createElementVNode("li",ly,[E[5]||(E[5]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",oy,[e.createElementVNode("div",ny,[e.createVNode(x,{options:c,modelValue:e.unref(n).Result,"onUpdate:modelValue":E[1]||(E[1]=d=>e.unref(n).Result=d)},null,8,["modelValue"])]),e.unref(n).Result>1?(e.openBlock(),e.createBlock(g,{key:0,error:e.unref(f).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(n).Reason,"onUpdate:modelValue":E[2]||(E[2]=d=>e.unref(n).Reason=d)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:l,disabled:e.unref(p),type:"button"},e.toDisplayString(e.unref(o)),9,ry)])):e.createCommentVNode("",!0)}}},sy={class:"step-line-wrapper"},dy={class:"step-line"},cy={key:0,class:"tag tag-white"},iy={key:1,class:"tag tag-white"},my={key:0,class:"step-line"},py={key:0,class:"tag tag-white"},Vy={class:"step-line"},fy={key:0,class:"tag tag-white"},Ny={key:0,class:"tag tag-white"},Ey={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(_){const B=I(),b=_,c=p=>{location.href=`${p}.aspx?ID=${b.id}`};return(p,f)=>(e.openBlock(),e.createElementBlock("div",sy,[e.createElementVNode("div",dy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:_.step===1}]),onClick:f[0]||(f[0]=n=>c("Audit")),role:"button"},[f[4]||(f[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),_.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(B)[b.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",cy,"編輯中")):e.unref(B)[b.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",iy,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),_.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",my,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:_.step===4}]),onClick:f[1]||(f[1]=n=>c("Progress")),role:"button"},[f[5]||(f[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),_.step===4?(e.openBlock(),e.createElementBlock("div",py,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",Vy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:_.step===5}]),onClick:f[2]||(f[2]=n=>c("Report")),role:"button"},[f[6]||(f[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),_.step===5?(e.openBlock(),e.createElementBlock("div",fy,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:_.step===6}]),onClick:f[3]||(f[3]=n=>c("Payment")),role:"button"},[f[7]||(f[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),_.step===6?(e.openBlock(),e.createElementBlock("div",Ny,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},by={class:"block"},gy={class:"square-title"},yy=["innerHTML"],ky={class:"table-responsive mt-3"},uy={class:"table align-middle gray-table"},hy={key:0,class:"text-center"},xy={class:"text-center"},$y=["href"],By={key:0,class:"text-center"},_y={key:0},Cy={key:1,class:"text-pink"},Ty={key:1,class:"tag-group mt-2 gap-1"},wy={key:0,class:"tag tag-green-light"},Sy=["download","href"],Dy=["onClick"],Ay={key:0,class:"block-bottom bg-light-teal"},Fy=["disabled"],Uy={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]},type:{type:String}},emits:["next"],setup(_,{emit:B}){let b;const c=_,p=e.computed(()=>f.value.some(x=>!x.Optional&&!x.Files.filter(g=>!g.Deleted).length)),f=e.ref(c.data.docs.map(x=>({...x,Files:[]}))),n=e.ref(),o=e.ref({}),l=(x,g)=>{(g.Type==="application/zip"||g.Type==="application/x-zip-compressed")&&x.Files.push({Type:x.Type,Path:g.Path,Name:`${c.id}_${x.Title}_${b}.zip`})},s=A.download,y=B,E=()=>{A[c.type]("getReport",{ID:c.id,Stage:c.data.id}).subscribe(x=>{var g;o.value=x.Report,f.value.forEach(d=>{d.Files=x.Attachments.filter(a=>a.Type===d.Type),d.Uploaded=e.computed(()=>d.Files.filter(a=>!a.Deleted).length)}),n.value=!o.value.Status||o.value.Status==="暫存"||o.value.Status==="退回修正",b=(g=o.value)!=null&&g.Reviewer?"修訂版":"初版",I().init(c.type,x.Project,o.value)})},h=x=>{const g={ID:c.id,Stage:c.data.id,Attachments:f.value.reduce((d,a)=>d.concat(a.Files),[]),Submit:x?"true":"false"};A[c.type]("saveReport",g).subscribe(()=>{x?y("next"):E()})};return e.onMounted(E),e.provide("editable",n),(x,g)=>{const d=e.resolveComponent("required-label"),a=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",by,[e.createElementVNode("h5",gy,e.toDisplayString(_.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:_.data.description},null,8,yy),e.createElementVNode("div",ky,[e.createElementVNode("table",uy,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[g[2]||(g[2]=e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號",-1)),g[3]||(g[3]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",hy,"狀態")):e.createCommentVNode("",!0),g[4]||(g[4]=e.createElementVNode("th",null,"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(k,i)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",xy,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(n)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...g[5]||(g[5]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,$y)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",By,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",_y,"已上傳")):(e.openBlock(),e.createElementBlock("span",Cy,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&!k.Uploaded?(e.openBlock(),e.createBlock(a,{key:0,accept:".zip",onFile:r=>l(k,r)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",Ty,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,r=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:r},[r.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",wy,[e.createElementVNode("a",{class:"tag-link my-1",download:r.Name,href:e.unref(s)(r.Path)},e.toDisplayString(r.Name),9,Sy),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>r.Deleted=!0,type:"button"},[...g[6]||(g[6]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Dy)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ay,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:g[0]||(g[0]=k=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:g[1]||(g[1]=k=>h(!0)),disabled:e.unref(p),type:"button"},[...g[7]||(g[7]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Fy)])):e.createCommentVNode("",!0)],64)}}},My={key:0,class:"scroll-bottom-panel"},Py={class:"d-flex flex-column gap-3 mb-3"},jy={class:"d-flex gap-2"},Iy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Oy={class:"text-nowrap my-2 d-flex align-items-center"},Ly={__name:"ProjectReportReview",props:{id:{type:[Number,String]},stage:{type:Number},type:{type:String}},setup(_){const B=_,b=I(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],p=e.ref({}),f=e.ref({ID:B.id,Result:1}),n=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),p.value=P(f.value,l),Object.keys(p.value).length){o();return}f.value.Stage=B.stage,A[B.type]("reviewReport",f.value).subscribe(s=>{s&&(window.location.href="../ReviewChecklist.aspx?type=6")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,s)=>{const y=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[_.type].organizer?(e.openBlock(),e.createElementBlock("div",My,[s[3]||(s[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Py,[e.createElementVNode("li",jy,[s[2]||(s[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Iy,[e.createElementVNode("div",Oy,[e.createVNode(y,{options:c,modelValue:e.unref(f).Result,"onUpdate:modelValue":s[0]||(s[0]=h=>e.unref(f).Result=h)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(p).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":s[1]||(s[1]=h=>e.unref(f).Reason=h)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Ry={key:0,class:"scroll-bottom-panel"},qy={class:"d-flex flex-column gap-3 mb-3"},zy={class:"d-flex gap-2"},Gy={class:"d-flex gap-2"},Jy={class:"text-pink"},Yy={class:"d-flex gap-2"},Qy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Hy={class:"text-nowrap mb-2 d-flex align-items-center"},Wy={key:0,class:"invalid mt-0"},Ky={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(_){const B=_,b=I(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],p=["無","低風險","中風險","高風險"],f=e.ref({}),n=e.ref({ID:B.id,Result:1}),o=e.ref({}),l=e.ref(0),s=()=>{window.open(A.toUrl(`/OFS/ApplicationChecklist.aspx?Year=${o.value.Year}&OrgName=${encodeURIComponent(o.value.OrgName)}`),"_blank")},y=()=>{window.open(A.toUrl(`/OFS/AuditHistory.aspx?Name=${encodeURIComponent(o.value.OrgName)}`),"_blank")},E=()=>{const x={};if(n.value.Result>1&&(x.Reason="原因"),n.value.Result===3&&(x.CorrectionDeadline="補正期限"),f.value=P(n.value,x),Object.keys(f.value).length){h();return}A[B.type]("reviewApplication",n.value).subscribe(g=>{g&&(window.location.href="../ReviewChecklist.aspx?type=1")})},h=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.onMounted(()=>{A[B.type]("getReviewInfo",{ID:B.id}).subscribe(x=>{o.value=x,o.value.AuditRecords.forEach(g=>{switch(g.Risk){case"Low":l.value<1&&(l.value=1);break;case"Medium":l.value<2&&(l.value=2);break;case"High":l.value<3&&(l.value=3);break}})})}),e.watch(()=>n.value.Result,x=>{x>1&&h()}),(x,g)=>{const d=e.resolveComponent("input-radio-group"),a=e.resolveComponent("input-tw-date"),k=e.resolveComponent("input-textarea");return e.unref(b)[_.type].organizer?(e.openBlock(),e.createElementBlock("div",Ry,[g[8]||(g[8]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",qy,[e.createElementVNode("li",zy,[g[3]||(g[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:s,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).OtherCount),1)]),e.createElementVNode("li",Gy,[g[6]||(g[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),e.createElementVNode("span",Jy,e.toDisplayString(p[e.unref(l)]),1),e.createElementVNode("span",null,[g[4]||(g[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:y,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).AuditRecords.length),1),g[5]||(g[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",Yy,[g[7]||(g[7]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Qy,[e.createElementVNode("div",Hy,[e.createVNode(d,{options:c,modelValue:e.unref(n).Result,"onUpdate:modelValue":g[0]||(g[0]=i=>e.unref(n).Result=i)},null,8,["modelValue"]),e.createVNode(a,{class:"form-control",drops:"up",modelValue:e.unref(n).CorrectionDeadline,"onUpdate:modelValue":g[1]||(g[1]=i=>e.unref(n).CorrectionDeadline=i)},null,8,["modelValue"])]),e.unref(f).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",Wy,e.toDisplayString(e.unref(f).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(n).Result>1?(e.openBlock(),e.createBlock(k,{key:1,error:e.unref(f).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(n).Reason,"onUpdate:modelValue":g[2]||(g[2]=i=>e.unref(n).Reason=i)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:E,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Xy={class:"top-wrapper"},Zy={class:"top-block"},vy={class:"d-flex align-items-center gap-3"},ek=["href"],tk={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(_){const B=_,b=I();return(c,p)=>(e.openBlock(),e.createElementBlock("div",Xy,[e.createElementVNode("div",Zy,[e.createElementVNode("div",vy,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(b)[B.type].type)+"］"+e.toDisplayString(e.unref(b)[B.type].id)+"/"+e.toDisplayString(e.unref(b)[B.type].name),1)]),e.createElementVNode("a",{class:"btn btn-teal-dark",href:`../AuditRecords.aspx?ProjectID=${_.id}`,target:"_blank"}," 查核紀錄 ",8,ek)])]))}},lk={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},ok={class:"d-flex gap-2"},nk={key:0,class:"btn text-teal-dark",type:"button"},rk=["href"],ak=["href"],sk={class:"d-flex gap-2"},dk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},ck={class:"modal-content"},ik={class:"modal-body"},mk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},pk={class:"modal-content"},Vk={class:"modal-body"},fk={class:"d-flex flex-column gap-4 mb-5"},Nk={class:"d-flex align-items-center"},Ek={class:"flex-grow-1"},bk={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(_){const B=I(),b=_,c=e.ref({}),p=e.ref(),f=e.ref({}),n=e.ref(),o=e.ref({}),l=e.ref(),s=e.computed(()=>{let d="";switch(b.type){case"culture":d="CUL";break;case"education":d="EDC";break;case"multiple":d="MUL";break;case"literacy":d="LIT";break;case"accessibility":d="ACC";break}return`../../Service/OFS/DownloadPdf.ashx?Type=${d}&ProjectID=${b.id}&Version=2`}),y=e.computed(()=>A.toUrl(`/OFS/PlanChangeRecords.aspx?ProjectID=${b.id}`)),E=()=>{const d={Reason:"計畫變更原因"};f.value=P(c.value,d),!Object.keys(f.value).length&&A[b.type]("applyChange",c.value).subscribe(a=>{a&&location.reload()})},h=()=>{c.value={ID:b.id},bootstrap.Modal.getOrCreateInstance(p.value).show()},x=()=>{o.value={ID:b.id},bootstrap.Modal.getOrCreateInstance(l.value).show()},g=()=>{const d={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};f.value=P(o.value,d),!Object.keys(f.value).length&&A[b.type]("terminate",o.value).subscribe(a=>{a&&(location.href="../ApplicationChecklist.aspx")})};return(d,a)=>{const k=e.resolveComponent("project-organizer"),i=e.resolveComponent("input-textarea"),r=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",lk,[e.createElementVNode("div",ok,[e.unref(B)[b.type].changeStatus?(e.openBlock(),e.createElementBlock("button",nk," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:h,type:"button"}," 計畫變更申請 ")),e.createElementVNode("a",{class:"btn btn-teal-dark",href:e.unref(y),target:"_blank"},[...a[3]||(a[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])],8,rk),e.createElementVNode("a",{class:"btn btn-teal-dark",download:"",href:e.unref(s)},[...a[4]||(a[4]=[e.createElementVNode("i",{class:"fa-solid fa-download"},null,-1),e.createTextVNode(" 下載核定計畫書 ",-1)])],8,ak)]),e.createElementVNode("div",sk,[e.createVNode(k,{id:_.id,type:_.type},null,8,["id","type"]),e.createElementVNode("button",{class:"btn btn-pink",onClick:x,type:"button"}," 計畫終止 ")])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:p,tabindex:"-1"},[e.createElementVNode("div",dk,[e.createElementVNode("div",ck,[a[8]||(a[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",ik,[a[6]||(a[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),a[7]||(a[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(i,{error:e.unref(f).Reason,modelValue:e.unref(c).Reason,"onUpdate:modelValue":a[0]||(a[0]=m=>e.unref(c).Reason=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[5]||(a[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:E},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:n,tabindex:"-1"},[...a[9]||(a[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:l,tabindex:"-1"},[e.createElementVNode("div",mk,[e.createElementVNode("div",pk,[a[14]||(a[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Vk,[e.createElementVNode("div",fk,[e.createElementVNode("div",null,[a[10]||(a[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(i,{error:e.unref(f).RejectReason,modelValue:e.unref(o).RejectReason,"onUpdate:modelValue":a[1]||(a[1]=m=>e.unref(o).RejectReason=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),a[12]||(a[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",Nk,[a[11]||(a[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",Ek,[e.createVNode(r,{error:e.unref(f).RecoveryAmount,modelValue:e.unref(o).RecoveryAmount,"onUpdate:modelValue":a[2]||(a[2]=m=>e.unref(o).RecoveryAmount=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[13]||(a[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:g},"送出")])])])])],512)]))],64)}}},gk={class:"search bg-gray mt-4"},yk={class:"search-form"},kk={class:"row g-3"},uk={class:"col-12 col-lg-4"},hk=["value"],xk={class:"col-12 col-lg-4"},$k=["value"],Bk={class:"row g-3"},_k={class:"col-12 col-lg-6"},Ck={class:"col-12 col-lg-6"},Tk={class:"total-list multiple-option"},wk={class:"all-total"},Sk={class:"total-item-content"},Dk={class:"count"},Ak=["for"],Fk={class:"total-item-title"},Uk={class:"total-item-content"},Mk={class:"count"},Pk=["id","onUpdate:modelValue"],jk={class:"block rounded-bottom-4"},Ik={class:"title border-teal"},Ok={class:"d-flex align-items-center gap-2"},Lk={class:"text-teal"},Rk={class:"table-responsive",style:{"min-height":"400px"}},qk={class:"table teal-table"},zk={class:"total-row"},Gk={class:"text-end"},Jk={class:"text-end"},Yk={class:"text-end"},Qk={"data-th":"年度:"},Hk={"data-th":"類別:"},Wk={"data-th":"計畫名稱:",style:{"text-align":"left"}},Kk=["href"],Xk={"data-th":"申請單位:",style:{"text-align":"left"}},Zk={"data-th":"申請本會補助:",class:"text-end"},vk={"data-th":"配合款:",class:"text-end"},eu={"data-th":"總經費:",class:"text-end"},tu={"data-th":"狀態:",style:{"text-align":"center",width:"100px"}},lu={class:"text-teal"},ou={__name:"ApplyList",setup(_){const B=e.ref([{id:1,title:"申請中",checked:!0},{id:2,title:"審查中",checked:!0},{id:3,title:"已核定",checked:!0},{id:4,title:"未通過",checked:!0}]),b=e.ref([]),c=e.ref({}),p=e.ref([]),f=e.ref(1),n=e.ref(10),o=e.ref([]),l=e.computed(()=>y.value.filter(x=>B.value.find(g=>g.checked&&x.type===g.id))),s=e.computed(()=>l.value.slice((f.value-1)*n.value,f.value*n.value)),y=e.computed(()=>{let x=p.value;return c.value.category&&(x=x.filter(g=>g.Category===c.value.category)),c.value.unit&&(x=x.filter(g=>g.SupervisoryUnit===c.value.unit)),c.value.org&&(x=x.filter(g=>{var d;return(d=g.UserOrg)==null?void 0:d.includes(c.value.org)})),c.value.name&&(x=x.filter(g=>{var d;return g.ProjectID.includes(c.value.name)||((d=g.ProjectName)==null?void 0:d.includes(c.value.name))})),x}),E=(x,g)=>{f.value=parseInt(x),n.value=parseInt(g)},h=x=>{if(x.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${x.ProjectID}`;if(x.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${x.ProjectID}`;if(x.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${x.ProjectID}`;if(x.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${x.ProjectID}`;if(x.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${x.ProjectID}`};return e.onMounted(()=>{A.system("getApplyList").subscribe(x=>{p.value=x.List,p.value.forEach(g=>{[1,14].includes(g.Status)?g.type=1:[11,12,21,22,31,32,41,42,43,44].includes(g.Status)?g.type=2:[45,51,52,91].includes(g.Status)?g.type=3:g.type=4,b.value.includes(g.Category)||b.value.push(g.Category),o.value.includes(g.SupervisoryUnit)||o.value.push(g.SupervisoryUnit)})})}),(x,g)=>{const d=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",gk,[g[12]||(g[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",yk,[e.createElementVNode("div",kk,[g[8]||(g[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",uk,[g[5]||(g[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":g[0]||(g[0]=k=>e.unref(c).category=k)},[g[4]||(g[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),k=>(e.openBlock(),e.createElementBlock("option",{key:k,value:k},e.toDisplayString(k),9,hk))),128))],512),[[e.vModelSelect,e.unref(c).category]])]),e.createElementVNode("div",xk,[g[7]||(g[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":g[1]||(g[1]=k=>e.unref(c).unit=k)},[g[6]||(g[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),k=>(e.openBlock(),e.createElementBlock("option",{key:k,value:k},e.toDisplayString(k),9,$k))),128))],512),[[e.vModelSelect,e.unref(c).unit]])])]),e.createElementVNode("div",Bk,[e.createElementVNode("div",_k,[g[9]||(g[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(d,{modelValue:e.unref(c).org,"onUpdate:modelValue":g[2]||(g[2]=k=>e.unref(c).org=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Ck,[g[10]||(g[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(d,{modelValue:e.unref(c).name,"onUpdate:modelValue":g[3]||(g[3]=k=>e.unref(c).name=k),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),g[11]||(g[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("ul",Tk,[e.createElementVNode("li",wk,[g[14]||(g[14]=e.createElementVNode("div",{class:"total-item-title"},"總申請",-1)),e.createElementVNode("div",Sk,[e.createElementVNode("span",Dk,e.toDisplayString(e.unref(y).length),1),g[13]||(g[13]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),k=>(e.openBlock(),e.createElementBlock("li",{class:"total-item",key:k},[e.createElementVNode("label",{class:"checke-total",for:`apply-${k.id}`},[e.createElementVNode("div",null,[e.createElementVNode("div",Fk,e.toDisplayString(k.title),1),e.createElementVNode("div",Uk,[e.createElementVNode("span",Mk,e.toDisplayString(e.unref(y).filter(i=>i.type===k.id).length),1),g[15]||(g[15]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),g[16]||(g[16]=e.createElementVNode("img",{class:"check-icon",src:"../../assets/img/check-white.svg"},null,-1))],8,Ak),e.withDirectives(e.createElementVNode("input",{class:"total-checkbox",id:`apply-${k.id}`,type:"checkbox","onUpdate:modelValue":i=>k.checked=i},null,8,Pk),[[e.vModelCheckbox,k.checked]])]))),128))]),e.createElementVNode("div",jk,[e.createElementVNode("div",Ik,[e.createElementVNode("div",Ok,[g[19]||(g[19]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[g[17]||(g[17]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Lk,e.toDisplayString(e.unref(l).length),1),g[18]||(g[18]=e.createTextVNode(" 筆資料",-1))])]),g[20]||(g[20]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Rk,[e.createElementVNode("table",qk,[e.createElementVNode("thead",null,[g[23]||(g[23]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"申請本會補助")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"總經費")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"狀態")])])],-1)),e.createElementVNode("tr",zk,[g[21]||(g[21]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Gk,e.toDisplayString(e.unref(l).reduce((k,i)=>k+i.ApplyAmount,0).toLocaleString()),1),e.createElementVNode("td",Jk,e.toDisplayString(e.unref(l).reduce((k,i)=>k+i.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Yk,e.toDisplayString(e.unref(l).reduce((k,i)=>k+i.ApplyAmount+i.OtherAmount,0).toLocaleString()),1),g[22]||(g[22]=e.createElementVNode("td",null,null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),k=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Qk,e.toDisplayString(k.Year),1),e.createElementVNode("td",Hk,e.toDisplayString(k.Category),1),e.createElementVNode("td",Wk,[e.createElementVNode("a",{class:"link-black",href:h(k),target:"_blank"},e.toDisplayString(k.ProjectName||"[未設定]"),9,Kk)]),e.createElementVNode("td",Xk,e.toDisplayString(k.UserOrg),1),e.createElementVNode("td",Zk,e.toDisplayString(k.ApplyAmount.toLocaleString()),1),e.createElementVNode("td",vk,e.toDisplayString(k.OtherAmount.toLocaleString()),1),e.createElementVNode("td",eu,e.toDisplayString((k.ApplyAmount+k.OtherAmount).toLocaleString()),1),e.createElementVNode("td",tu,[e.createElementVNode("span",lu,e.toDisplayString(e.unref(B).find(i=>i.id===k.type).title),1)])]))),128))])])]),e.createVNode(a,{count:e.unref(l).length,onChange:E,page:e.unref(f),"page-size":e.unref(n)},null,8,["count","page","page-size"])])],64)}}},nu={class:"search bg-gray mt-4"},ru={class:"search-form"},au={class:"row g-3"},su={class:"col-12 col-lg-4"},du=["value"],cu={class:"col-12 col-lg-4"},iu=["value"],mu={class:"row g-3"},pu={class:"col-12 col-lg-6"},Vu={class:"col-12 col-lg-6"},fu={class:"block rounded-bottom-4"},Nu={class:"title border-teal"},Eu={class:"d-flex align-items-center gap-2"},bu={class:"text-teal"},gu={class:"table-responsive",style:{"min-height":"400px"}},yu={class:"table teal-table"},ku={class:"total-row"},uu={class:"text-end"},hu={class:"text-end"},xu={"data-th":"年度:"},$u={"data-th":"類別:"},Bu={"data-th":"計畫名稱:",style:{"text-align":"left"}},_u=["href"],Cu={"data-th":"申請單位:",style:{"text-align":"left"}},Tu={"data-th":"本會補助金額:",class:"text-end"},wu={"data-th":"配合款:",class:"text-end"},Su={__name:"ApprovedList",setup(_){const B=e.ref([]),b=e.ref({}),c=e.ref([]),p=e.ref(1),f=e.ref(10),n=e.ref([]),o=e.computed(()=>l.value.slice((p.value-1)*f.value,p.value*f.value)),l=e.computed(()=>{let E=c.value;return b.value.category&&(E=E.filter(h=>h.Category===b.value.category)),b.value.unit&&(E=E.filter(h=>h.SupervisoryUnit===b.value.unit)),b.value.org&&(E=E.filter(h=>{var x;return(x=h.UserOrg)==null?void 0:x.includes(b.value.org)})),b.value.name&&(E=E.filter(h=>{var x;return h.ProjectID.includes(b.value.name)||((x=h.ProjectName)==null?void 0:x.includes(b.value.name))})),E}),s=(E,h)=>{p.value=parseInt(E),f.value=parseInt(h)},y=E=>{if(E.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${E.ProjectID}`};return e.onMounted(()=>{A.system("getApprovedList").subscribe(E=>{c.value=E.List,c.value.forEach(h=>{B.value.includes(h.Category)||B.value.push(h.Category),n.value.includes(h.SupervisoryUnit)||n.value.push(h.SupervisoryUnit)})})}),(E,h)=>{const x=e.resolveComponent("input-text"),g=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nu,[h[12]||(h[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",ru,[e.createElementVNode("div",au,[h[8]||(h[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",su,[h[5]||(h[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":h[0]||(h[0]=d=>e.unref(b).category=d)},[h[4]||(h[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),d=>(e.openBlock(),e.createElementBlock("option",{key:d,value:d},e.toDisplayString(d),9,du))),128))],512),[[e.vModelSelect,e.unref(b).category]])]),e.createElementVNode("div",cu,[h[7]||(h[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":h[1]||(h[1]=d=>e.unref(b).unit=d)},[h[6]||(h[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),d=>(e.openBlock(),e.createElementBlock("option",{key:d,value:d},e.toDisplayString(d),9,iu))),128))],512),[[e.vModelSelect,e.unref(b).unit]])])]),e.createElementVNode("div",mu,[e.createElementVNode("div",pu,[h[9]||(h[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(x,{modelValue:e.unref(b).org,"onUpdate:modelValue":h[2]||(h[2]=d=>e.unref(b).org=d),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Vu,[h[10]||(h[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(x,{modelValue:e.unref(b).name,"onUpdate:modelValue":h[3]||(h[3]=d=>e.unref(b).name=d),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),h[11]||(h[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",fu,[e.createElementVNode("div",Nu,[e.createElementVNode("div",Eu,[h[15]||(h[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[h[13]||(h[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",bu,e.toDisplayString(e.unref(l).length),1),h[14]||(h[14]=e.createTextVNode(" 筆資料",-1))])]),h[16]||(h[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",gu,[e.createElementVNode("table",yu,[e.createElementVNode("thead",null,[h[18]||(h[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])])],-1)),e.createElementVNode("tr",ku,[h[17]||(h[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",uu,e.toDisplayString(e.unref(l).reduce((d,a)=>d+a.ApprovedAmount,0).toLocaleString()),1),e.createElementVNode("td",hu,e.toDisplayString(e.unref(l).reduce((d,a)=>d+a.OtherAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),d=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",xu,e.toDisplayString(d.Year),1),e.createElementVNode("td",$u,e.toDisplayString(d.Category),1),e.createElementVNode("td",Bu,[e.createElementVNode("a",{class:"link-black",href:y(d),target:"_blank"},e.toDisplayString(d.ProjectName),9,_u)]),e.createElementVNode("td",Cu,e.toDisplayString(d.UserOrg),1),e.createElementVNode("td",Tu,e.toDisplayString(d.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",wu,e.toDisplayString(d.OtherAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(g,{count:e.unref(l).length,onChange:s,page:e.unref(p),"page-size":e.unref(f)},null,8,["count","page","page-size"])])],64)}}},Du={class:"search bg-gray mt-4"},Au={class:"search-form"},Fu={class:"row g-3"},Uu={class:"col-12 col-lg-4"},Mu=["value"],Pu={class:"col-12 col-lg-4"},ju=["value"],Iu={class:"row g-3"},Ou={class:"col-12 col-lg-6"},Lu={class:"col-12 col-lg-6"},Ru={class:"block rounded-bottom-4"},qu={class:"title border-teal"},zu={class:"d-flex align-items-center gap-2"},Gu={class:"text-teal"},Ju={class:"table-responsive",style:{"min-height":"400px"}},Yu={class:"table teal-table"},Qu={class:"total-row"},Hu={class:"text-end"},Wu={class:"text-end"},Ku={class:"text-end"},Xu={class:"text-end"},Zu={class:"text-end"},vu={"data-th":"年度:"},eh={"data-th":"類別:"},th={"data-th":"計畫名稱:",style:{"text-align":"left"}},lh=["href"],oh={"data-th":"申請單位:",style:{"text-align":"left"}},nh={"data-th":"本會補助金額:",class:"text-end"},rh={"data-th":"配合款:",class:"text-end"},ah={"data-th":"實支金額:",class:"text-end"},sh={"data-th":"累積經費執行率:",class:"text-end"},dh={"data-th":"本會已撥金額:",class:"text-end"},ch={__name:"InprogressList",setup(_){const B=e.ref([]),b=e.ref({}),c=e.ref([]),p=e.ref(1),f=e.ref(10),n=e.ref([]),o=e.computed(()=>y.value.reduce((g,d)=>g+d.ApprovedAmount,0)),l=e.computed(()=>y.value.slice((p.value-1)*f.value,p.value*f.value)),s=e.computed(()=>y.value.reduce((g,d)=>g+d.SpendAmount,0)),y=e.computed(()=>{let g=c.value;return b.value.category&&(g=g.filter(d=>d.Category===b.value.category)),b.value.unit&&(g=g.filter(d=>d.SupervisoryUnit===b.value.unit)),b.value.org&&(g=g.filter(d=>{var a;return(a=d.UserOrg)==null?void 0:a.includes(b.value.org)})),b.value.name&&(g=g.filter(d=>{var a;return d.ProjectID.includes(b.value.name)||((a=d.ProjectName)==null?void 0:a.includes(b.value.name))})),g}),E=(g,d)=>{p.value=parseInt(g),f.value=parseInt(d)},h=g=>{if(g.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${g.ProjectID}`},x=(g,d)=>d?Math.round(g*100/d*100)/100:0;return e.onMounted(()=>{A.system("getInprogressList").subscribe(g=>{c.value=g.List,c.value.forEach(d=>{B.value.includes(d.Category)||B.value.push(d.Category),n.value.includes(d.SupervisoryUnit)||n.value.push(d.SupervisoryUnit)})})}),(g,d)=>{const a=e.resolveComponent("input-text"),k=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Du,[d[12]||(d[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Au,[e.createElementVNode("div",Fu,[d[8]||(d[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",Uu,[d[5]||(d[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":d[0]||(d[0]=i=>e.unref(b).category=i)},[d[4]||(d[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,Mu))),128))],512),[[e.vModelSelect,e.unref(b).category]])]),e.createElementVNode("div",Pu,[d[7]||(d[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":d[1]||(d[1]=i=>e.unref(b).unit=i)},[d[6]||(d[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,ju))),128))],512),[[e.vModelSelect,e.unref(b).unit]])])]),e.createElementVNode("div",Iu,[e.createElementVNode("div",Ou,[d[9]||(d[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(a,{modelValue:e.unref(b).org,"onUpdate:modelValue":d[2]||(d[2]=i=>e.unref(b).org=i),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Lu,[d[10]||(d[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(a,{modelValue:e.unref(b).name,"onUpdate:modelValue":d[3]||(d[3]=i=>e.unref(b).name=i),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),d[11]||(d[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Ru,[e.createElementVNode("div",qu,[e.createElementVNode("div",zu,[d[15]||(d[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[d[13]||(d[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Gu,e.toDisplayString(e.unref(y).length),1),d[14]||(d[14]=e.createTextVNode(" 筆資料",-1))])]),d[16]||(d[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Ju,[e.createElementVNode("table",Yu,[e.createElementVNode("thead",null,[d[18]||(d[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"實支金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"累積經費執行率")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會已撥金額")])])],-1)),e.createElementVNode("tr",Qu,[d[17]||(d[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Hu,e.toDisplayString(e.unref(o).toLocaleString()),1),e.createElementVNode("td",Wu,e.toDisplayString(e.unref(y).reduce((i,r)=>i+r.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Ku,e.toDisplayString(e.unref(s).toLocaleString()),1),e.createElementVNode("td",Xu,e.toDisplayString(x(e.unref(s),e.unref(o)).toLocaleString())+"%",1),e.createElementVNode("td",Zu,e.toDisplayString(e.unref(y).reduce((i,r)=>i+r.PaymentAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),i=>(e.openBlock(),e.createElementBlock("tr",{key:i},[e.createElementVNode("td",vu,e.toDisplayString(i.Year),1),e.createElementVNode("td",eh,e.toDisplayString(i.Category),1),e.createElementVNode("td",th,[e.createElementVNode("a",{class:"link-black",href:h(i),target:"_blank"},e.toDisplayString(i.ProjectName),9,lh)]),e.createElementVNode("td",oh,e.toDisplayString(i.UserOrg),1),e.createElementVNode("td",nh,e.toDisplayString(i.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",rh,e.toDisplayString(i.OtherAmount.toLocaleString()),1),e.createElementVNode("td",ah,e.toDisplayString(i.SpendAmount.toLocaleString()),1),e.createElementVNode("td",sh,e.toDisplayString(x(i.SpendAmount,i.ApprovedAmount).toLocaleString())+"%",1),e.createElementVNode("td",dh,e.toDisplayString(i.PaymentAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(k,{count:e.unref(y).length,onChange:E,page:e.unref(p),"page-size":e.unref(f)},null,8,["count","page","page-size"])])],64)}}},ih={__name:"MixChart",props:{list:{required:!0,type:Array}},setup(_){let B;const b=K().typeList,c=_,p=e.ref(),f=o=>{am5.ready(()=>{B=am5.Root.new(p.value),B.setThemes([am5themes_Animated.new(B)]);const l=B.container.children.push(am5xy.XYChart.new(B,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,layout:B.verticalLayout})),s=am5xy.AxisRendererX.new(B,{minGridDistance:30});s.labels.template.setAll({rotation:-45,centerY:am5.p50,centerX:am5.p100,textAlign:"right"});var y=l.xAxes.push(am5xy.CategoryAxis.new(B,{categoryField:"category",renderer:s,tooltip:am5.Tooltip.new(B,{})}));y.data.setAll(o);var E=l.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{})})),h=l.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{opposite:!0}),min:0,max:1,numberFormat:"#.0%",extraMax:.1,strictMinMax:!0}));const x=(i,r,m)=>{var N=l.series.push(am5xy.ColumnSeries.new(B,{name:r,xAxis:y,yAxis:E,valueYField:i,categoryXField:"category",clustered:!0,tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY}"})}));return N.data.setAll(o),N.columns.template.setAll({fillOpacity:1,strokeOpacity:0,fill:am5.color(m),cornerRadiusTL:0,cornerRadiusTR:0,width:am5.percent(70)}),N};x("核定經費","核定經費",4946924),x("實支金額","實支金額",9323693),x("已撥付","已撥付",3447003);const g=(i,r,m)=>{var N=l.series.push(am5xy.LineSeries.new(B,{name:r,xAxis:y,yAxis:h,valueYField:i,categoryXField:"category",stroke:am5.color(m),fill:am5.color(m),tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY.formatNumber('#.0%')}"})}));return N.strokes.template.setAll({strokeWidth:3}),N.bullets.push(()=>am5.Bullet.new(B,{sprite:am5.Circle.new(B,{radius:5,fill:N.get("stroke")})})),N.data.setAll(o),N};g("經費執行率(%)","經費執行率(%)",15105570),g("支用比(%)","支用比(%)",2600544),l.children.push(am5.Legend.new(B,{centerX:am5.p50,x:am5.p50,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300})).labels.template.setAll({fontSize:12,paddingLeft:4,paddingRight:4,marginTop:4,marginBottom:4,marginLeft:4,marginRight:4});var a=l.children.push(am5.Legend.new(B,{centerX:am5.p0,x:am5.p0,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));a.data.setAll([l.series.getIndex(0),l.series.getIndex(1),l.series.getIndex(2)]);var k=l.children.push(am5.Legend.new(B,{centerX:am5.p100,x:am5.p100,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));k.data.setAll([l.series.getIndex(3),l.series.getIndex(4)]),l.set("cursor",am5xy.XYCursor.new(B,{}))})},n=(o,l,s=2)=>{if(l){const y=10**s;return Math.round(o*100/l*y)/y}return 0};return e.watch(()=>c.list,()=>{f(b.map(o=>{const l={category:o.title,核定經費:0,實支金額:0,已撥付:0,"經費執行率(%)":0,"支用比(%)":0},s=c.list.find(y=>y.Category===o.code);return s&&(l.核定經費=Math.floor(s.ApprovedAmount/1e3),l.實支金額=Math.floor(s.SpendAmount/1e3),l.已撥付=Math.floor(s.PaymentAmount/1e3),l["經費執行率(%)"]=n(l.實支金額,l.核定經費,1),l["支用比(%)"]=n(l.實支金額,l.已撥付,1)),l}))}),(o,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:p},null,512))}},mh={__name:"PieChart",props:{active:{required:!0,type:String},color:{required:!0,type:Number},inactive:{required:!0,type:String},percent:{required:!0,type:Number}},setup(_){let B,b,c;const p=_,f=e.ref();return e.onMounted(()=>{am5.ready(()=>{b=am5.Root.new(f.value),b.setThemes([am5themes_Animated.new(b)]);const n=b.container.children.push(am5percent.PieChart.new(b,{innerRadius:95,width:158,x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,layout:b.verticalLayout}));c=n.series.push(am5percent.PieSeries.new(b,{valueField:"size",categoryField:"sector"})),c.set("colors",am5.ColorSet.new(b,{colors:[am5.color(p.color),am5.color(16119285)]})),c.labels.template.set("visible",!1),c.ticks.template.set("visible",!1),c.data.setAll([{sector:p.active,size:p.percent},{sector:p.inactive,size:100-p.percent}]),c.appear(1e3,100),B=b.tooltipContainer.children.push(am5.Label.new(b,{x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,fill:am5.color(p.color),fontSize:28,fontWeight:"bold"})),B.set("text",`${p.percent}%`);const o=()=>{var l=window.innerWidth>=768&&window.innerWidth<=1024,s=l?105:158,y=l?55:95,E=l?20:28;n.set("width",s),n.set("innerRadius",y),B.set("fontSize",E)};o(),window.addEventListener("resize",o)})}),e.watch(()=>p.percent,n=>{B.set("text",`${n}%`),c.data.setAll([{sector:p.active,size:n},{sector:p.inactive,size:100-n}])}),(n,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:f},null,512))}},ph={class:"search bg-gray mt-4"},Vh={class:"search-form"},fh={class:"row g-3"},Nh={class:"col-12 col-lg-4"},Eh={class:"col-12 col-lg-4"},bh={class:"col-12 col-lg-4"},gh={class:"row g-3"},yh={class:"col-12"},kh={class:"block rounded-bottom-4"},uh={class:"title border-teal"},hh={class:"d-flex align-items-center gap-2"},xh={class:"text-teal"},$h={class:"table-responsive",style:{"min-height":"400px"}},Bh={class:"table teal-table"},_h={"data-th":"年度:"},Ch={"data-th":"計畫名稱:",class:"text-start"},Th=["href"],wh={"data-th":"計畫申請單位:",class:"text-start"},Sh={"data-th":"委員姓名:"},Dh={"data-th":"任職單位:",class:"text-start"},Ah={"data-th":"職稱:"},Fh={"data-th":"應迴避之具體理由及事證:",class:"text-start"},Uh={__name:"RecusedList",setup(_){const B=e.ref({Year:0,Keyword:"",Name:"",Org:""}),b=e.ref([]),c=e.ref(1),p=e.ref(10),f=[],n=e.computed(()=>b.value.slice((c.value-1)*p.value,c.value*p.value)),o=(y,E)=>{c.value=parseInt(y),p.value=parseInt(E)},l=()=>{A.system("downloadRecusedList",B.value).subscribe(y=>{const E=document.createElement("a");E.download="迴避審查委員名單.xlsx",E.href=A.download(y.filename),E.click()})},s=()=>{A.system("getRecusedList",B.value).subscribe(y=>{b.value=y.List,c.value=1})};for(let y=new Date().getFullYear()-1911;y>=114;y--)f.push({text:`${y} 年`,value:y});return e.onMounted(s),(y,E)=>{const h=e.resolveComponent("input-select"),x=e.resolveComponent("input-text"),g=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ph,[E[9]||(E[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Vh,[e.createElementVNode("div",fh,[e.createElementVNode("div",Nh,[E[4]||(E[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.createVNode(h,{"empty-value":0,options:f,modelValue:e.unref(B).Year,"onUpdate:modelValue":E[0]||(E[0]=d=>e.unref(B).Year=d)},null,8,["modelValue"])]),e.createElementVNode("div",Eh,[E[5]||(E[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, 任職單位, 職稱",-1)),e.createVNode(x,{placeholder:"請輸入委員姓名, 任職單位, 職稱",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":E[1]||(E[1]=d=>e.unref(B).Keyword=d),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",bh,[E[6]||(E[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫名稱",-1)),e.createVNode(x,{placeholder:"請輸入計畫名稱",modelValue:e.unref(B).Name,"onUpdate:modelValue":E[2]||(E[2]=d=>e.unref(B).Name=d),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("div",gh,[e.createElementVNode("div",yh,[E[7]||(E[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫申請單位",-1)),e.createVNode(x,{placeholder:"請輸入計畫申請單位",modelValue:e.unref(B).Org,"onUpdate:modelValue":E[3]||(E[3]=d=>e.unref(B).Org=d),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:s,type:"button"},[...E[8]||(E[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",kh,[e.createElementVNode("div",uh,[e.createElementVNode("div",hh,[E[12]||(E[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[E[10]||(E[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",xh,e.toDisplayString(e.unref(b).length),1),E[11]||(E[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...E[13]||(E[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",$h,[e.createElementVNode("table",Bh,[E[14]||(E[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"任職單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"職稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"應迴避之具體理由及事證")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),d=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",_h,e.toDisplayString(d.Year),1),e.createElementVNode("td",Ch,[e.createElementVNode("a",{class:"link-black",href:`../SCI/SciApplication.aspx?ProjectID=${d.ProjectID}`,target:"_blank"},e.toDisplayString(d.ProjectNameTw),9,Th)]),e.createElementVNode("td",wh,e.toDisplayString(d.OrgName),1),e.createElementVNode("td",Sh,e.toDisplayString(d.RecusedName),1),e.createElementVNode("td",Dh,e.toDisplayString(d.EmploymentUnit),1),e.createElementVNode("td",Ah,e.toDisplayString(d.JobTitle),1),e.createElementVNode("td",Fh,e.toDisplayString(d.RecusedReason),1)]))),128))])])]),e.createVNode(g,{count:e.unref(b).length,onChange:o,page:e.unref(c),"page-size":e.unref(p)},null,8,["count","page","page-size"])])],64)}}},Mh={class:"block rounded-bottom-4"},Ph={class:"title border-teal"},jh={class:"d-flex align-items-center gap-2"},Ih={class:"text-teal"},Oh={class:"table-responsive",style:{"min-height":"400px"}},Lh={class:"table teal-table"},Rh={"data-th":"委員姓名:",class:"text-start"},qh={"data-th":"審查階段:",class:"text-start"},zh={"data-th":"類別:",class:"text-start"},Gh={"data-th":"計畫編號:"},Jh={"data-th":"計畫名稱:",class:"text-start"},Yh={__name:"ReviewerDetails",props:{id:{type:String},type:{type:String}},setup(_){const B=_,b=e.ref({ID:B.id,Type:B.type}),c=e.ref([]),p=e.ref(1),f=e.ref(10),n=e.computed(()=>c.value.slice((p.value-1)*f.value,p.value*f.value)),o=(s,y)=>{p.value=parseInt(s),f.value=parseInt(y)},l=()=>{A.system("downloadReviewerDetails",b.value).subscribe(s=>{const y=document.createElement("a");y.download="審查計畫.xlsx",y.href=A.download(s.filename),y.click()})};return e.onMounted(()=>{A.system("getReviewerDetails",b.value).subscribe(s=>{c.value=s.List,p.value=1})}),(s,y)=>{const E=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",Mh,[e.createElementVNode("div",Ph,[e.createElementVNode("div",jh,[y[2]||(y[2]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"審查計畫")],-1)),e.createElementVNode("span",null,[y[0]||(y[0]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Ih,e.toDisplayString(e.unref(c).length),1),y[1]||(y[1]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...y[3]||(y[3]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",Oh,[e.createElementVNode("table",Lh,[y[4]||(y[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"計畫編號")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫名稱")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),h=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",Rh,e.toDisplayString(h.CommitteeUser),1),e.createElementVNode("td",qh,e.toDisplayString(_.type==1?"申請計畫":"執行計畫")+"／"+e.toDisplayString(h.ReviewStage),1),e.createElementVNode("td",zh,e.toDisplayString(h.FieldName),1),e.createElementVNode("td",Gh,e.toDisplayString(h.ProjectID),1),e.createElementVNode("td",Jh,e.toDisplayString(h.ProjectName),1)]))),128))])])]),e.createVNode(E,{count:e.unref(c).length,onChange:o,page:e.unref(p),"page-size":e.unref(f)},null,8,["count","page","page-size"])])}}},Qh={class:"search bg-gray mt-4"},Hh={class:"search-form"},Wh={class:"row g-3"},Kh={class:"col-3"},Xh={class:"col-3"},Zh={class:"col-3"},vh={class:"col-3"},ex={class:"block rounded-bottom-4"},tx={class:"title border-teal"},lx={class:"d-flex align-items-center gap-2"},ox={class:"text-teal"},nx={class:"table-responsive",style:{"min-height":"400px"}},rx={class:"table teal-table"},ax={"data-th":"委員姓名:"},sx={"data-th":"Email:",class:"text-start"},dx={"data-th":"審查階段:"},cx={"data-th":"審查計畫件數:"},ix=["href"],mx={"data-th":"銀行帳戶:",class:"text-start"},px={"data-th":"戶籍地址:",class:"text-start"},Vx={"data-th":"更新時間:",class:"text-start"},fx={__name:"ReviewerList",setup(_){const B=e.ref({Type:0,Keyword:"",Begin:"",End:""}),b=e.ref([]),c=e.ref(1),p=e.ref(10),f=[{text:"申請計畫審查",value:1},{text:"執行計畫審查",value:2}],n=e.computed(()=>b.value.slice((c.value-1)*p.value,c.value*p.value)),o=(y,E)=>{c.value=parseInt(y),p.value=parseInt(E)},l=()=>{A.system("downloadReviewerList",B.value).subscribe(y=>{const E=document.createElement("a");E.download="審查委員名單.xlsx",E.href=A.download(y.filename),E.click()})},s=()=>{A.system("getReviewerList",B.value).subscribe(y=>{b.value=y.List,c.value=1})};return e.onMounted(s),(y,E)=>{const h=e.resolveComponent("input-select"),x=e.resolveComponent("input-text"),g=e.resolveComponent("input-tw-date"),d=e.resolveComponent("tw-date-time"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qh,[E[9]||(E[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Hh,[e.createElementVNode("div",Wh,[e.createElementVNode("div",Kh,[E[4]||(E[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"審查階段",-1)),e.createVNode(h,{"empty-value":0,options:f,modelValue:e.unref(B).Type,"onUpdate:modelValue":E[0]||(E[0]=k=>e.unref(B).Type=k)},null,8,["modelValue"])]),e.createElementVNode("div",Xh,[E[5]||(E[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, Email",-1)),e.createVNode(x,{placeholder:"請輸入委員姓名, Email",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":E[1]||(E[1]=k=>e.unref(B).Keyword=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Zh,[E[6]||(E[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"開始時間",-1)),e.createVNode(g,{modelValue:e.unref(B).Begin,"onUpdate:modelValue":E[2]||(E[2]=k=>e.unref(B).Begin=k)},null,8,["modelValue"])]),e.createElementVNode("div",vh,[E[7]||(E[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"結束時間",-1)),e.createVNode(g,{modelValue:e.unref(B).End,"onUpdate:modelValue":E[3]||(E[3]=k=>e.unref(B).End=k)},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:s,type:"button"},[...E[8]||(E[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",ex,[e.createElementVNode("div",tx,[e.createElementVNode("div",lx,[E[12]||(E[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[E[10]||(E[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",ox,e.toDisplayString(e.unref(b).length),1),E[11]||(E[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...E[13]||(E[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",nx,[e.createElementVNode("table",rx,[E[14]||(E[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"Email")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查計畫件數")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"銀行帳戶")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"戶籍地址")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"更新時間")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),k=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",ax,e.toDisplayString(k.CommitteeUser),1),e.createElementVNode("td",sx,e.toDisplayString(k.Email),1),e.createElementVNode("td",dx,e.toDisplayString(k.Type===1?"申請計畫":"執行計畫"),1),e.createElementVNode("td",cx,[e.createElementVNode("a",{class:"link-black",href:`ReviewerList${k.Type}.aspx?ID=${k.ID}`,target:"_blank"},e.toDisplayString(k.Count),9,ix)]),e.createElementVNode("td",mx,e.toDisplayString(k.BankCode)+" "+e.toDisplayString(k.BankName)+" "+e.toDisplayString(k.BankAccount),1),e.createElementVNode("td",px,e.toDisplayString(k.RegistrationAddress),1),e.createElementVNode("td",Vx,[e.createVNode(d,{value:k.UpdateTime},null,8,["value"])])]))),128))])])]),e.createVNode(a,{count:e.unref(b).length,onChange:o,page:e.unref(c),"page-size":e.unref(p)},null,8,["count","page","page-size"])])],64)}}},Nx={key:0,class:"text-pink"},Ex={__name:"RequiredLabel",setup(_){const B=e.inject("editable",!0);return(b,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(B)?(e.openBlock(),e.createElementBlock("span",Nx,"* ")):e.createCommentVNode("",!0),e.renderSlot(b.$slots,"default")],64))}},bx={class:"block"},gx={class:"mt-4"},yx={class:"table align-middle gray-table side-table"},kx={class:"d-flex gap-2"},ux={__name:"ReviewCommitteeInfo",props:{token:{type:String}},setup(_){const B=_,b=e.ref([]),c=e.ref({}),p=e.ref({BankCode:""}),f=()=>{if(c.value={},!n()){e.nextTick(()=>{var o;return(o=document.querySelector(".invalid"))==null?void 0:o.scrollIntoView({behavior:"smooth",block:"center"})});return}A.system("saveReviewCommittee",{Token:B.token,BankCode:p.value.BankCode,BankAccount:p.value.BankAccount,RegistrationAddress:p.value.RegistrationAddress}).subscribe(o=>{alert("儲存成功")})},n=()=>{let o={BankCode:"銀行",BankAccount:"帳戶號碼",RegistrationAddress:"戶籍地址"};return c.value=P(p.value,o),!Object.keys(c.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.system("getZgsCodes",{CodeGroup:"BankCode"}),A.system("getReviewCommittee",{Token:B.token})]).subscribe(o=>{b.value=o[0],p.value=o[1].Data})}),(o,l)=>{const s=e.resolveComponent("required-label"),y=e.resolveComponent("input-select"),E=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",bx,[l[6]||(l[6]=e.createElementVNode("h5",{class:"square-title"},"委員資料",-1)),e.createElementVNode("div",gx,[e.createElementVNode("table",yx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[l[3]||(l[3]=e.createElementVNode("th",null,"審查委員",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(p).CommitteeUser)+" ("+e.toDisplayString(e.unref(p).Email)+") ",1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...l[4]||(l[4]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",kx,[e.createElementVNode("div",null,[e.createVNode(y,{"empty-value":"",error:e.unref(c).BankCode,options:e.unref(b),placeholder:"請選擇銀行","text-name":"Descname","value-name":"Code",modelValue:e.unref(p).BankCode,"onUpdate:modelValue":l[0]||(l[0]=h=>e.unref(p).BankCode=h)},null,8,["error","options","modelValue"])]),e.createElementVNode("div",null,[e.createVNode(E,{error:e.unref(c).BankAccount,placeholder:"帳戶號碼",modelValue:e.unref(p).BankAccount,"onUpdate:modelValue":l[1]||(l[1]=h=>e.unref(p).BankAccount=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...l[5]||(l[5]=[e.createTextVNode("戶籍地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(c).RegistrationAddress,placeholder:"(郵遞區號)完整地址",modelValue:e.unref(p).RegistrationAddress,"onUpdate:modelValue":l[2]||(l[2]=h=>e.unref(p).RegistrationAddress=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:f,type:"button"},[...l[7]||(l[7]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定送出",-1)])])])],64)}}},hx={class:"block"},xx={class:"table align-middle gray-table side-table"},$x=["value"],Bx={class:"table align-middle gray-table"},_x={width:"1%"},Cx={width:"1%"},Tx={class:"d-flex gap-2"},wx=["onClick"],Sx={class:"d-flex align-items-center flex-wrap"},Dx={class:"d-flex align-items-center text-nowrap me-3"},Ax={class:"d-flex align-items-center text-nowrap"},Fx={key:0,class:"invalid mt-0"},Ux={key:0,class:"table align-middle gray-table"},Mx={width:"1%"},Px={class:"row"},jx={class:"col"},Ix={class:"col"},Ox={width:"1%"},Lx={class:"d-flex gap-2"},Rx=["onClick"],qx={key:0,class:"tag-group mt-2 gap-1"},zx={class:"tag tag-green-light"},Gx=["download","href"],Jx={key:1},Yx={key:2,class:"invalid mt-0"},Qx={key:0},Hx={class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},Wx={__name:"GrantForm1",props:{id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=K().typeList,p=e.ref(!1),f=e.ref({}),n=e.ref({}),o=e.ref(),l=e.computed(()=>h.value.filter(k=>!k.Deleted)),s=e.computed(()=>E.value.filter(k=>!k.Deleted)),y=e.ref({}),E=e.ref([]),h=e.ref([]),x=A.download,g=B,d=k=>{var r,m,N;if(n.value={},f.value.Path=(r=o.value)==null?void 0:r.Path,f.value.Filename=(m=o.value)==null?void 0:m.Name,k){if(!a()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}switch(f.Status){case 0:f.Status=1;break;case 1:p.value&&(f.Status=2);break}}y.value.ShortName=(N=c.find(t=>t.code===y.value.TypeCode))==null?void 0:N.title;const i={GrantType:y.value,Content:f.value,Procedures:h.value,Links:E.value,Submit:k?"true":"false"};A.system("saveGrantTypeContent",i).subscribe(t=>{t&&g("next")})},a=()=>{let k={ServiceContent:"內容",ContactPerson:"聯絡電話及分機",ContactTel:"聯絡人",Filename:"相關檔案"};return p.value&&(k.StatusReason="下架原因"),n.value=P(f.value,k),b.id||(k={TypeCode:"補助類別",Year:"年度",FullName:"補助類別全稱"},Object.assign(n.value,P(y.value,k))),l.value.length&&(k={Content:"內容"},l.value.forEach((i,r)=>Object.assign(n.value,P(i,k,`procedure-${r}-`)))),s.value.length&&(k={Title:"參考資料名稱",URL:"網址"},s.value.forEach((i,r)=>Object.assign(n.value,P(i,k,`link-${r}-`)))),!Object.keys(n.value).length};return e.onMounted(()=>{b.id?A.system("getGrantTypeContent",{ID:b.id}).subscribe(k=>{y.value=k.GrantType,f.value=k.Content,h.value=k.Procedures,E.value=k.Links,f.value.Filename&&(o.value={Name:f.value.Filename,Path:f.value.Path}),h.value.length||h.value.push({}),K().init(y.value.TypeCode)}):h.value.push({})}),(k,i)=>{const r=e.resolveComponent("required-label"),m=e.resolveComponent("input-select"),N=e.resolveComponent("input-integer"),t=e.resolveComponent("input-text"),V=e.resolveComponent("input-textarea"),u=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock("div",hx,[e.createElementVNode("table",xx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[17]||(i[17]=[e.createTextVNode("補助類別(代碼)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{class:"w-auto",error:e.unref(n).TypeCode,options:e.unref(c),modelValue:e.unref(y).TypeCode,"onUpdate:modelValue":i[0]||(i[0]=w=>e.unref(y).TypeCode=w)},{default:e.withCtx(({option:w})=>[e.createElementVNode("option",{value:w.code},e.toDisplayString(w.title)+" ("+e.toDisplayString(w.code)+")",9,$x)]),_:1},8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[18]||(i[18]=[e.createTextVNode("年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{class:"w-auto",error:e.unref(n).Year,modelValue:e.unref(y).Year,"onUpdate:modelValue":i[1]||(i[1]=w=>e.unref(y).Year=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[19]||(i[19]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(n).FullName,modelValue:e.unref(y).FullName,"onUpdate:modelValue":i[2]||(i[2]=w=>e.unref(y).FullName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[20]||(i[20]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n).ServiceContent,modelValue:e.unref(f).ServiceContent,"onUpdate:modelValue":i[3]||(i[3]=w=>e.unref(f).ServiceContent=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[i[21]||(i[21]=e.createElementVNode("th",null,"關鍵字",-1)),e.createElementVNode("td",null,[e.createVNode(t,{modelValue:e.unref(f).Keywords,"onUpdate:modelValue":i[4]||(i[4]=w=>e.unref(f).Keywords=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[i[22]||(i[22]=e.createElementVNode("th",null,"申辦資格",-1)),e.createElementVNode("td",null,[e.createVNode(V,{modelValue:e.unref(f).Criteria,"onUpdate:modelValue":i[5]||(i[5]=w=>e.unref(f).Criteria=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[23]||(i[23]=[e.createTextVNode("申辦流程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("table",Bx,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(w,C)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",_x,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(n)[`procedure-${C}-Content`],modelValue:w.Content,"onUpdate:modelValue":D=>w.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Cx,[e.createElementVNode("div",Tx,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>w.Deleted=!0,type:"button"},[...i[24]||(i[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,wx)):e.createCommentVNode("",!0),C+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i[6]||(i[6]=D=>e.unref(h).push({})),type:"button"},[...i[25]||(i[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("tr",null,[i[26]||(i[26]=e.createElementVNode("th",null,"應備物品",-1)),e.createElementVNode("td",null,[e.createVNode(V,{modelValue:e.unref(f).Documentary,"onUpdate:modelValue":i[7]||(i[7]=w=>e.unref(f).Documentary=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[27]||(i[27]=[e.createTextVNode("聯絡窗口",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Sx,[e.createElementVNode("div",Dx,[i[28]||(i[28]=e.createElementVNode("label",{class:"me-2"},"聯絡電話及分機",-1)),e.createVNode(t,{modelValue:e.unref(f).ContactTel,"onUpdate:modelValue":i[8]||(i[8]=w=>e.unref(f).ContactTel=w),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Ax,[i[29]||(i[29]=e.createElementVNode("label",{class:"me-2"},"聯絡人",-1)),e.createVNode(t,{modelValue:e.unref(f).ContactPerson,"onUpdate:modelValue":i[9]||(i[9]=w=>e.unref(f).ContactPerson=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.unref(n).ContactTel||e.unref(n).ContactPerson?(e.openBlock(),e.createElementBlock("div",Fx,e.toDisplayString(e.unref(n).ContactTel||e.unref(n).ContactPerson),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[i[32]||(i[32]=e.createElementVNode("th",null,[e.createTextVNode("線上申辦"),e.createElementVNode("br"),e.createTextVNode("參考資料")],-1)),e.createElementVNode("td",null,[e.unref(s).length?(e.openBlock(),e.createElementBlock("table",Ux,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(w,C)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",Mx,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",Px,[e.createElementVNode("div",jx,[e.createVNode(t,{error:e.unref(n)[`link-${C}-Title`],placeholder:"參考資料名稱",modelValue:w.Title,"onUpdate:modelValue":D=>w.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ix,[e.createVNode(t,{error:e.unref(n)[`link-${C}-URL`],placeholder:"網址",modelValue:w.URL,"onUpdate:modelValue":D=>w.URL=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("td",Ox,[e.createElementVNode("div",Lx,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:D=>w.Deleted=!0,type:"button"},[...i[30]||(i[30]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Rx)])])]))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:i[10]||(i[10]=w=>e.unref(E).push({})),type:"button"},[...i[31]||(i[31]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...i[33]||(i[33]=[e.createTextVNode("相關檔案",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(顯示於首頁)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",qx,[e.createElementVNode("span",zx,[e.createElementVNode("a",{class:"tag-link my-1",download:e.unref(o).Name,href:e.unref(x)(e.unref(o).Path)},e.toDisplayString(e.unref(o).Name),9,Gx),e.createElementVNode("button",{class:"tag-btn",onClick:i[11]||(i[11]=w=>o.value=null),type:"button"},[...i[34]||(i[34]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])])])])):(e.openBlock(),e.createElementBlock("div",Jx,[e.createVNode(u,{onFile:i[12]||(i[12]=w=>o.value=w)})])),e.unref(n).Filename?(e.openBlock(),e.createElementBlock("div",Yx,e.toDisplayString(e.unref(n).Filename),1)):e.createCommentVNode("",!0)])]),e.unref(f).Status===1?(e.openBlock(),e.createElementBlock("tr",Qx,[i[36]||(i[36]=e.createElementVNode("th",null,"申請下架",-1)),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"status-checkbox",type:"checkbox","onUpdate:modelValue":i[13]||(i[13]=w=>e.isRef(p)?p.value=w:null)},null,512),[[e.vModelCheckbox,e.unref(p)]]),i[35]||(i[35]=e.createElementVNode("label",{class:"form-check-label ms-1 mb-2",for:"status-checkbox"},"申請E政府下架（請輸入原因）",-1)),e.createVNode(V,{error:e.unref(n).StatusReason,modelValue:e.unref(f).StatusReason,"onUpdate:modelValue":i[14]||(i[14]=w=>e.unref(f).StatusReason=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",Hx,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:i[15]||(i[15]=w=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:i[16]||(i[16]=w=>d(!0)),type:"button"},[...i[37]||(i[37]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定發布",-1)])])])])}}},Kx={class:"block"},Xx={class:"table align-middle gray-table side-table"},Zx={class:"p-0"},vx={class:"row align-items-center mb-0"},e$={class:"col p-4"},t$={class:"col p-4"},l$={class:"col p-4"},o$={class:"d-flex align-items-center flex-wrap gap-2"},n$={class:"input-group",style:{width:"360px"}},r$={class:"d-flex align-items-center flex-wrap gap-2"},a$={class:"input-group",style:{width:"360px"}},s$={style:{width:"360px"}},d$={class:"d-flex align-items-center mb-2"},c$={class:"d-flex align-items-center mb-2"},i$={class:"d-flex align-items-center mb-2"},m$={class:"d-flex align-items-center mb-2"},p$={class:"d-flex align-items-center gap-2"},V$={class:"d-flex align-items-center flex-wrap gap-2"},f$={class:"input-group",style:{width:"360px"}},N$={class:"d-flex align-items-center flex-wrap gap-2"},E$={class:"input-group",style:{width:"360px"}},b$={__name:"GrantForm2",props:{id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref({}),p=e.ref(!1),f=B,n=()=>{const o={};p.value||(c.value.OverduePeriod=null),A.system("saveGrantType",{GrantType:Object.assign(c.value,o)}).subscribe(l=>{l&&f("next")})};return e.onMounted(()=>{A.system("getGrantType",{ID:b.id}).subscribe(o=>{c.value=o.GrantType,c.value.OverduePeriod&&(p.value=!0)})}),(o,l)=>{const s=e.resolveComponent("input-integer"),y=e.resolveComponent("input-textarea"),E=e.resolveComponent("input-tw-date"),h=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock("div",Kx,[e.createElementVNode("table",Xx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[l[18]||(l[18]=e.createElementVNode("th",null,"補助類別 全稱",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).FullName),1)]),e.createElementVNode("tr",null,[l[21]||(l[21]=e.createElementVNode("th",null,"補助類別 簡稱",-1)),e.createElementVNode("td",Zx,[e.createElementVNode("div",vx,[e.createElementVNode("div",e$,e.toDisplayString(e.unref(c).ShortName),1),l[19]||(l[19]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"代碼",-1)),e.createElementVNode("div",t$,e.toDisplayString(e.unref(c).TypeCode),1),l[20]||(l[20]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"年度",-1)),e.createElementVNode("div",l$,e.toDisplayString(e.unref(c).Year),1)])])]),e.createElementVNode("tr",null,[l[22]||(l[22]=e.createElementVNode("th",null,"總預算經費(元)",-1)),e.createElementVNode("td",null,[e.createVNode(s,{class:"w-auto",modelValue:e.unref(c).BudgetFees,"onUpdate:modelValue":l[0]||(l[0]=x=>e.unref(c).BudgetFees=x),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[23]||(l[23]=e.createElementVNode("th",null,"身分標籤",-1)),e.createElementVNode("td",null,[e.createVNode(y,{rows:"5",modelValue:e.unref(c).TargetTags,"onUpdate:modelValue":l[1]||(l[1]=x=>e.unref(c).TargetTags=x),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[25]||(l[25]=e.createElementVNode("th",null,"申請期間",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",o$,[e.createElementVNode("div",n$,[e.createVNode(E,{modelValue:e.unref(c).ApplyStartDate,"onUpdate:modelValue":l[2]||(l[2]=x=>e.unref(c).ApplyStartDate=x)},null,8,["modelValue"]),l[24]||(l[24]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(E,{modelValue:e.unref(c).ApplyEndDate,"onUpdate:modelValue":l[3]||(l[3]=x=>e.unref(c).ApplyEndDate=x)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[26]||(l[26]=e.createElementVNode("th",null,"計畫期程迄日",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",r$,[e.createElementVNode("div",a$,[e.createVNode(E,{modelValue:e.unref(c).PlanEndDate,"onUpdate:modelValue":l[4]||(l[4]=x=>e.unref(c).PlanEndDate=x)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[31]||(l[31]=e.createElementVNode("th",null,"申請階段審查",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",s$,[e.createElementVNode("div",d$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-1",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[5]||(l[5]=x=>e.unref(c).Review1Enabled=x)},null,512),[[e.vModelCheckbox,e.unref(c).Review1Enabled]]),l[27]||(l[27]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-1"},"1.",-1)),e.createVNode(h,{class:"w-auto","aria-label":"資格審查",placeholder:"資格審查",modelValue:e.unref(c).Review1Title,"onUpdate:modelValue":l[6]||(l[6]=x=>e.unref(c).Review1Title=x),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",c$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-2",type:"checkbox","onUpdate:modelValue":l[7]||(l[7]=x=>e.unref(c).Review2Enabled=x)},null,512),[[e.vModelCheckbox,e.unref(c).Review2Enabled]]),l[28]||(l[28]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-2"},"2.",-1)),e.createVNode(h,{class:"w-auto","aria-label":"初審",placeholder:"初審",modelValue:e.unref(c).Review2Title,"onUpdate:modelValue":l[8]||(l[8]=x=>e.unref(c).Review2Title=x),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",i$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-3",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=x=>e.unref(c).Review3Enabled=x)},null,512),[[e.vModelCheckbox,e.unref(c).Review3Enabled]]),l[29]||(l[29]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-3"},"3.",-1)),e.createVNode(h,{class:"w-auto","aria-label":"複審",placeholder:"複審",modelValue:e.unref(c).Review3Title,"onUpdate:modelValue":l[10]||(l[10]=x=>e.unref(c).Review3Title=x),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",m$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-4",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[11]||(l[11]=x=>e.unref(c).Review4Enabled=x)},null,512),[[e.vModelCheckbox,e.unref(c).Review4Enabled]]),l[30]||(l[30]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-4"},"4.",-1)),e.createVNode(h,{class:"w-auto","aria-label":"決審核定",placeholder:"決審核定",modelValue:e.unref(c).Review4Title,"onUpdate:modelValue":l[12]||(l[12]=x=>e.unref(c).Review4Title=x),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[34]||(l[34]=e.createElementVNode("th",null,"補正補件期限",-1)),e.createElementVNode("td",p$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"overdue-period",type:"checkbox","onUpdate:modelValue":l[13]||(l[13]=x=>e.isRef(p)?p.value=x:null)},null,512),[[e.vModelCheckbox,e.unref(p)]]),l[33]||(l[33]=e.createElementVNode("label",{class:"form-check-label",for:"overdue-period"},"有期限",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(s,{class:"w-auto",modelValue:e.unref(c).OverduePeriod,"onUpdate:modelValue":l[14]||(l[14]=x=>e.unref(c).OverduePeriod=x),modelModifiers:{trim:!0}},null,8,["modelValue"]),l[32]||(l[32]=e.createTextVNode("天 ",-1))],64)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[l[35]||(l[35]=e.createElementVNode("th",null,[e.createTextVNode("期中報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("span",V$,[e.createElementVNode("span",f$,[e.createVNode(E,{modelValue:e.unref(c).MidtermDeadline,"onUpdate:modelValue":l[15]||(l[15]=x=>e.unref(c).MidtermDeadline=x)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[38]||(l[38]=e.createElementVNode("th",null,[e.createTextVNode("期末/成果報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("div",N$,[e.createElementVNode("div",E$,[e.createVNode(E,{disabled:e.unref(c).FinalOneMonth,modelValue:e.unref(c).FinalDeadline,"onUpdate:modelValue":l[16]||(l[16]=x=>e.unref(c).FinalDeadline=x)},null,8,["disabled","modelValue"])]),l[36]||(l[36]=e.createElementVNode("span",{class:"p-2"},"或",-1)),e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"final-one-month",type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=x=>e.unref(c).FinalOneMonth=x)},null,512),[[e.vModelCheckbox,e.unref(c).FinalOneMonth]]),l[37]||(l[37]=e.createElementVNode("label",{class:"form-check-label",for:"final-one-month"},"計畫結束一個月後",-1))])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:n,type:"button"},"儲存")])])}}},g$={class:"block"},y$={class:"mt-4"},k$={class:"table-responsive"},u$={class:"table align-middle gray-table"},h$={class:"d-flex align-items-center gap-2"},x$=["id","onUpdate:modelValue"],$$=["for"],B$={__name:"GrantForm3",props:{id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref([]),p=B,f=()=>{const n=c.value.map(o=>({...o,MatchingFund:o.checked?o.MatchingFund:null}));A.system("saveGrantTargetSettings",{List:n}).subscribe(o=>{o&&p("next")})};return e.onMounted(()=>{A.system("getGrantTargetSettings",{ID:b.id}).subscribe(n=>{c.value=n.List,c.value.forEach(o=>{typeof o.MatchingFund=="number"&&(o.checked=!0)})})}),(n,o)=>{const l=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock("div",g$,[e.createElementVNode("div",y$,[e.createElementVNode("div",k$,[e.createElementVNode("table",u$,[o[1]||(o[1]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th"),e.createElementVNode("th",null,"適用申請單位類別"),e.createElementVNode("th",null,"補助經費上限(萬)"),e.createElementVNode("th",null,"配合款")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,y)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",null,e.toDisplayString(y+1),1),e.createElementVNode("td",null,e.toDisplayString(s.TargetName),1),e.createElementVNode("td",null,[e.createVNode(l,{modelValue:s.GrantLimit,"onUpdate:modelValue":E=>s.GrantLimit=E},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",h$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:`checkbox-${y}`,type:"checkbox","onUpdate:modelValue":E=>s.checked=E},null,8,x$),[[e.vModelCheckbox,s.checked]]),e.createElementVNode("label",{class:"form-check-label ms-1",for:`checkbox-${y}`},"配合款分攤比例",8,$$),s.checked?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(l,{class:"w-auto",modelValue:s.MatchingFund,"onUpdate:modelValue":E=>s.MatchingFund=E},null,8,["modelValue","onUpdate:modelValue"]),o[0]||(o[0]=e.createTextVNode("(%) ",-1))],64)):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:f,type:"button"},"儲存")])])}}},_$={class:"block"},C$={class:"mt-4"},T$={class:"table-responsive"},w$={class:"table align-middle gray-table side-table"},S$={class:"input-group",style:{width:"400px"}},D$={class:"teal-dark-tabs"},A$={key:0,class:"table-responsive sub-table"},F$={class:"table align-middle gray-table"},U$={class:"d-flex gap-2"},M$=["onClick"],P$={key:1},j$={class:"d-flex gap-2"},I$={__name:"GrantForm4",props:{id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref({}),p=e.ref(),f=e.ref([]),n=e.ref({}),o=e.ref(1),l=e.ref(""),s=()=>{const x=/^(.*?)\s*<([^>]+)>$/;l.value.split(`
`).forEach(g=>{const d=g.trim().match(x);d&&n.value[p.value].push({CommitteeUser:d[1],Email:d[2]})}),o.value=1,l.value=""},y=B,E=()=>{if(!h()){e.nextTick(()=>{var x;return(x=document.querySelector(".invalid"))==null?void 0:x.scrollIntoView({behavior:"smooth",block:"center"})});return}A.system("saveReviewCommitteeList",{ID:p.value,List:n.value[p.value]}).subscribe(x=>{x&&y("next")})},h=()=>{const x={CommitteeUser:"姓名",Email:{presence:{message:"^請輸入 Email"},email:{message:"格式錯誤"}}};return c.value={},n.value[p.value].filter(g=>!g.Deleted).forEach((g,d)=>Object.assign(c.value,P(g,x,`item-${d}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{A.system("getReviewGroups",{ID:b.id}).subscribe(x=>{f.value=x.List,p.value=f.value[0].Value})}),e.watch(p,x=>{n.value[x]||A.system("getReviewCommitteeList",{ID:x}).subscribe(g=>{n.value[x]=g.List})}),(x,g)=>{var r;const d=e.resolveComponent("required-label"),a=e.resolveComponent("input-select"),k=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",_$,[e.createElementVNode("div",C$,[e.createElementVNode("div",T$,[e.createElementVNode("table",w$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...g[5]||(g[5]=[e.createTextVNode("審查組別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",S$,[e.createVNode(a,{options:e.unref(f),"text-name":"Text","value-name":"Value",modelValue:e.unref(p),"onUpdate:modelValue":g[0]||(g[0]=m=>e.isRef(p)?p.value=m:null)},null,8,["options","modelValue"])])])]),e.createElementVNode("tr",null,[g[11]||(g[11]=e.createElementVNode("th",null,"審查委員名單",-1)),e.createElementVNode("td",null,[e.createElementVNode("ul",D$,[e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===1})},[e.createElementVNode("a",{class:"tab-link",onClick:g[1]||(g[1]=m=>o.value=1),href:"javascript:void(0)"},"逐筆輸入")],2),e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===2})},[e.createElementVNode("a",{class:"tab-link",onClick:g[2]||(g[2]=m=>o.value=2),href:"javascript:void(0)"},"批次輸入")],2)]),e.unref(o)===1?(e.openBlock(),e.createElementBlock("div",A$,[e.createElementVNode("table",F$,[g[7]||(g[7]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"1%"}),e.createElementVNode("th",null,"姓名"),e.createElementVNode("th",null,"Email"),e.createElementVNode("th",{width:"1%"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((r=e.unref(n)[e.unref(p)])==null?void 0:r.filter(m=>!m.Deleted),(m,N)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(c)[`item-${N}-CommitteeUser`],modelValue:m.CommitteeUser,"onUpdate:modelValue":t=>m.CommitteeUser=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(c)[`item-${N}-Email`],modelValue:m.Email,"onUpdate:modelValue":t=>m.Email=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",U$,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:t=>m.Deleted=!0,type:"button"},[...g[6]||(g[6]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,M$)])])]))),128))])]),e.createElementVNode("button",{class:"btn btn-sm btn-teal",onClick:g[3]||(g[3]=m=>{var N;return(N=e.unref(n)[e.unref(p)])==null?void 0:N.push({})}),type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])):e.createCommentVNode("",!0),e.unref(o)===2?(e.openBlock(),e.createElementBlock("div",P$,[e.createElementVNode("div",j$,[e.createVNode(i,{placeholder:`張曉明 <aming@gmail.com>
陳小華 <hwahchen@xxx.edu.tw>`,rows:"5",modelValue:e.unref(l),"onUpdate:modelValue":g[4]||(g[4]=m=>e.isRef(l)?l.value=m:null),modelModifiers:{trim:!0}},null,8,["modelValue"]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:s,type:"button"},[...g[9]||(g[9]=[e.createElementVNode("i",{class:"fa-solid fa-plus"},null,-1),e.createTextVNode("新增",-1)])])]),g[10]||(g[10]=e.createElementVNode("label",{class:"form-text"},"輸入格式範例「姓名 <xxx@email.com>」，多筆請斷行輸入",-1))])):e.createCommentVNode("",!0)])])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:E,type:"button"},"儲存")])])}}},O$={class:"search-form"},L$={class:"row g-3"},R$={class:"col-3"},q$=["value"],z$={class:"block rounded-4 mt-4"},G$={class:"table-responsive",style:{"min-height":"400px"}},J$={"aria-label":"公告列表",class:"table teal-table"},Y$={"data-th":"年度:"},Q$={"data-th":"補助類別全稱:",class:"text-start"},H$={"data-th":"簡稱:",class:"text-start"},W$={"data-th":"代碼:",class:"text-start"},K$={"data-th":"申請期間:",class:"text-start"},X$={"data-th":"管理:",class:"text-center"},Z$={class:"d-inline-flex gap-2"},v$=["href"],e2={__name:"GrantList",setup(_){const B=e.ref([]),b=e.ref(),c=e.ref([]),p=e.computed(()=>B.value.filter(f=>f.Year===b.value));return e.onMounted(()=>{A.system("getGrantTypeList").subscribe(f=>{B.value=f.List,c.value=[],B.value.forEach(n=>{c.value.includes(n.Year)||c.value.push(n.Year)}),b.value=c.value.length?c.value[0]:null})}),(f,n)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",O$,[e.createElementVNode("div",L$,[e.createElementVNode("div",R$,[n[1]||(n[1]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":n[0]||(n[0]=l=>e.isRef(b)?b.value=l:null)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l)+"年",9,q$))),128))],512),[[e.vModelSelect,e.unref(b)]])])])]),e.createElementVNode("div",z$,[n[5]||(n[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="GrantEdit.aspx"><i class="fa-solid fa-plus"></i> 新增類別 </a></div>',1)),e.createElementVNode("div",G$,[e.createElementVNode("table",J$,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"補助類別全稱"),e.createElementVNode("th",{scope:"col",class:"text-start"},"簡稱"),e.createElementVNode("th",{scope:"col"},"代碼"),e.createElementVNode("th",{scope:"col"},"申請期間"),e.createElementVNode("th",{scope:"col"},"管理")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",Y$,e.toDisplayString(l.Year),1),e.createElementVNode("td",Q$,e.toDisplayString(l.FullName),1),e.createElementVNode("td",H$,e.toDisplayString(l.ShortName),1),e.createElementVNode("td",W$,e.toDisplayString(l.TypeCode),1),e.createElementVNode("td",K$,[e.createVNode(o,{"default-value":"未設定",value:l.ApplyStartDate},null,8,["value"]),n[2]||(n[2]=e.createTextVNode(" ~ ",-1)),e.createVNode(o,{"default-value":"未設定",value:l.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",X$,[e.createElementVNode("div",Z$,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`GrantEdit.aspx?ID=${l.TypeID}`},[...n[3]||(n[3]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,v$)])])]))),128))])])])])],64)}}},t2={class:"block rounded-4 mt-4"},l2={class:"table-responsive",style:{"min-height":"400px"}},o2={class:"table teal-table","aria-label":"公告列表"},n2={"data-th":"公告期間:"},r2={key:1},a2={"data-th":"公告標題:",class:"text-start"},s2={"data-th":"發布者:",class:"text-start"},d2={"data-th":"功能:",class:"text-center"},c2={class:"d-inline-flex gap-2"},i2=["href"],m2=["onClick"],p2={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},V2={class:"modal-content"},f2={class:"modal-body"},N2={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},E2={__name:"NewsList",setup(_){let B;const b=e.ref([]),c=e.ref(),p=e.ref(1),f=e.ref(10),n=e.computed(()=>b.value.slice((p.value-1)*f.value,p.value*f.value)),o=(s,y)=>{p.value=parseInt(s),f.value=parseInt(y)},l=(s,y)=>{y||(B=s,bootstrap.Modal.getOrCreateInstance(c.value).show()),A.system("deleteNews",{ID:s.ID}).subscribe(E=>{E&&(b.value=b.value.filter(h=>h!==s),bootstrap.Modal.getOrCreateInstance(c.value).hide())})};return e.onMounted(()=>{A.system("getNewsList").subscribe(s=>b.value=s.List)}),(s,y)=>{const E=e.resolveComponent("tw-date"),h=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",t2,[y[5]||(y[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="NewsEdit.aspx"><i class="fa-solid fa-plus"></i> 新增公告 </a></div>',1)),e.createElementVNode("div",l2,[e.createElementVNode("table",o2,[y[4]||(y[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告期間"),e.createElementVNode("th",{class:"text-start",scope:"col"},"公告標題"),e.createElementVNode("th",{class:"text-start",scope:"col",style:{width:"200px"}},"發布者"),e.createElementVNode("th",{scope:"col",style:{width:"180px"}},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),x=>(e.openBlock(),e.createElementBlock("tr",{key:x},[e.createElementVNode("td",n2,[e.createVNode(E,{value:x.EnableTime},null,8,["value"]),y[1]||(y[1]=e.createTextVNode(" ~ ",-1)),x.DisableTime?(e.openBlock(),e.createBlock(E,{key:0,value:x.DisableTime},null,8,["value"])):(e.openBlock(),e.createElementBlock("span",r2,"未設定"))]),e.createElementVNode("td",a2,e.toDisplayString(x.Title),1),e.createElementVNode("td",s2,e.toDisplayString(x.UserOrg)+" "+e.toDisplayString(x.UserName),1),e.createElementVNode("td",d2,[e.createElementVNode("div",c2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`NewsEdit.aspx?id=${x.ID}`},[...y[2]||(y[2]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,i2),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:g=>l(x),type:"button"},[...y[3]||(y[3]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,m2)])])]))),128))])])]),e.createVNode(h,{count:e.unref(b).length,onChange:o,page:e.unref(p),"page-size":e.unref(f)},null,8,["count","page","page-size"])]),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",p2,[e.createElementVNode("div",V2,[y[7]||(y[7]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 fw-bold text-green-light"},"確定刪除公告資料？"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",f2,[e.createElementVNode("div",N2,[y[6]||(y[6]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:y[0]||(y[0]=x=>l(e.unref(B),!0)),type:"button"},"確認刪除")])])])])],512)],64)}}},b2={class:"block rounded-top-4 mt-4 d-flex flex-column gap-5"},g2={class:"table-responsive mt-3 mb-0"},y2={class:"table align-middle gray-table side-table"},k2={class:"d-flex align-items-center gap-2"},u2={class:"input-group w-auto"},h2={key:0,class:"invalid mt-0"},x2={class:"d-flex mb-2 gap-3"},$2={class:"tag-group mt-3"},B2={key:0,class:"tag tag-green-light"},_2=["download","href"],C2=["onClick"],T2={class:"d-flex mb-2 gap-3"},w2={class:"image-preview mt-3"},S2={key:0,class:"image-preview__item"},D2=["src"],A2={class:"image-preview__item-overlay"},F2=["onClick"],U2={class:"d-flex mb-2 gap-3"},M2={key:0,class:"table-responsive mt-3"},P2={class:"table align-middle gray-table"},j2={class:"text-center"},I2={class:"d-flex gap-1"},O2=["onClick"],oe={AccessibilityApplication:et,AccessibilityAttachment:ht,AccessibilityBenefit:Pt,AccessibilityFunding:il,AccessibilityPayment1:Pl,AccessibilityPayment2:mo,AccessibilityProgressBar:po,AccessibilityWorkSchedule:Io,AuditHistory:Xo,ConfirmModal:on,CommonProgressBar:mn,CultureApplication:Wn,CultureAttachment:br,CultureFunding:Gr,CultureOther:aa,CulturePayment1:Aa,CulturePayment2:as,CultureProgress:Bs,CultureProgressBar:_s,CultureWorkSchedule:gd,EducationApplication:ic,EducationAttachment:Ac,EducationPayment:ri,EducationProgressBar:ai,ErrorModal:pi,HomeDashboard:Nm,InputBoolean:Em,InputFile:bm,InputInteger:km,InputMonth:um,InputRadioGroup:$m,InputSelect:wm,InputText:Um,InputTextarea:Om,InputTwDate:qm,ListPager:op,LiteracyApplication:jp,LiteracyAttachment:rV,LiteracyBenefit:yV,LiteracyFunding:QV,LiteracyPayment1:gf,LiteracyPayment2:zf,LiteracyProgressBar:Gf,LiteracyWorkSchedule:EN,MultipleApplication:KN,MultipleAttachment:g1,MultipleBenefit:A1,MultipleFunding:aE,MultiplePayment1:SE,MultiplePayment2:ob,MultiplePayment3:Sb,MultipleProgressBar:Db,MultipleWorkSchedule:og,NewsDetail:Eg,NewsList:$g,NewsMarquee:Sg,ProjectChangeReview:Pg,ProjectCorrectionReview:qg,ProjectOrganizer:Xg,ProjectPaymentReview:ay,ProjectProgress:Ey,ProjectReport:Uy,ProjectReportReview:Ly,ProjectReview:Ky,ProjectTitle:tk,ProjectToolbar:bk,ReportApplyList:ou,ReportApprovedList:Su,ReportInprogressList:ch,ReportMixChart:ih,ReportPieChart:mh,ReportRecusedList:Uh,ReportReviewerDetails:Yh,ReportReviewerList:fx,RequiredLabel:Ex,ReviewCommitteeInfo:ux,SystemGrantForm1:Wx,SystemGrantForm2:b$,SystemGrantForm3:B$,SystemGrantForm4:I$,SystemGrantList:e2,SystemNewsList:E2,SystemNewsForm:{__name:"NewsForm",props:{id:{type:[Number,String]}},emits:["next"],setup(_,{emit:B}){const b=_,c=e.ref({}),p=e.ref([]),f=e.computed(()=>l.value.filter(g=>!g.Deleted)),n=e.ref({}),o=e.ref([]),l=e.ref([]),s=(g,d)=>g.push({Path:d.Path,Name:d.Name}),y=A.download,E=B,h=()=>{if(!x()){e.nextTick(()=>{var d;return(d=document.querySelector(".invalid"))==null?void 0:d.scrollIntoView({behavior:"smooth",block:"center"})});return}const g={News:n.value,Files:p.value,Images:o.value,Videos:l.value};A.system("saveNews",g).subscribe(d=>{d&&E("next")})},x=()=>{let g={Title:"公告標題",EnableTime:"公告期間",Content:"內容"};return c.value=P(n.value,g),g={Title:"影片名稱",URL:"影片網址"},f.value.forEach((d,a)=>Object.assign(c.value,P(d,g,`video-${a}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{b.id?A.system("getNews",{ID:b.id}).subscribe(g=>{n.value=g.News,p.value=g.Files,o.value=g.Images,l.value=g.Videos}):A.system("getEmptyNews").subscribe(g=>n.value=g)}),(g,d)=>{const a=e.resolveComponent("required-label"),k=e.resolveComponent("input-text"),i=e.resolveComponent("input-tw-date"),r=e.resolveComponent("input-textarea"),m=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",b2,[e.createElementVNode("div",null,[d[12]||(d[12]=e.createElementVNode("h5",{class:"square-title"},"公告內容",-1)),e.createElementVNode("div",g2,[e.createElementVNode("table",y2,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[7]||(d[7]=e.createElementVNode("th",null,"發佈者",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(n).UserOrg)+"    "+e.toDisplayString(e.unref(n).UserName),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[8]||(d[8]=[e.createTextVNode("公告標題",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(c).Title,modelValue:e.unref(n).Title,"onUpdate:modelValue":d[0]||(d[0]=N=>e.unref(n).Title=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[9]||(d[9]=[e.createTextVNode("公告期間",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",k2,[e.createElementVNode("div",u2,[e.createVNode(i,{class:"w-auto",modelValue:e.unref(n).EnableTime,"onUpdate:modelValue":d[1]||(d[1]=N=>e.unref(n).EnableTime=N)},null,8,["modelValue"]),d[10]||(d[10]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(i,{class:"w-auto",modelValue:e.unref(n).DisableTime,"onUpdate:modelValue":d[2]||(d[2]=N=>e.unref(n).DisableTime=N)},null,8,["modelValue"])])]),e.unref(c).EnableTime?(e.openBlock(),e.createElementBlock("div",h2,e.toDisplayString(e.unref(c).EnableTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[11]||(d[11]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(c).Content,modelValue:e.unref(n).Content,"onUpdate:modelValue":d[3]||(d[3]=N=>e.unref(n).Content=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",null,[e.createElementVNode("div",x2,[d[13]||(d[13]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關附件")],-1)),e.createVNode(m,{accept:".pdf,.odt,.doc,.docx,.zip",onFile:d[4]||(d[4]=N=>s(e.unref(p),N))})]),d[15]||(d[15]=e.createElementVNode("span",{class:"text-pink"},"支援文件 pdf, odt, doc, docx (10MB以內)、ZIP 壓縮檔 (50MB以內)",-1)),e.createElementVNode("div",$2,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),N=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:N},[N.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",B2,[e.createElementVNode("a",{class:"tag-link my-1",download:N.Name,href:e.unref(y)(N.Path)},e.toDisplayString(N.Name),9,_2),e.createElementVNode("button",{class:"tag-btn",onClick:t=>N.Deleted=!0,type:"button"},[...d[14]||(d[14]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,C2)]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",T2,[d[16]||(d[16]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關圖片")],-1)),e.createVNode(m,{accept:".jpg,.png",onFile:d[5]||(d[5]=N=>s(e.unref(o),N))})]),d[18]||(d[18]=e.createElementVNode("span",{class:"text-pink"},"支援 JPG, PNG，檔案大小 10MB以內",-1)),e.createElementVNode("div",w2,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),N=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:N},[N.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",S2,[e.createElementVNode("img",{alt:"picture",src:e.unref(y)(N.Path)},null,8,D2),e.createElementVNode("div",A2,[e.createElementVNode("button",{"aria-label":"移除圖片",class:"btn btn-remove-image",onClick:t=>N.Deleted=!0,type:"button"},[...d[17]||(d[17]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,F2)])]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",U2,[d[20]||(d[20]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關影片")],-1)),e.createElementVNode("button",{"aria-label":"新增影片",class:"btn btn-teal-dark",onClick:d[6]||(d[6]=N=>e.unref(l).push({})),type:"button"},[...d[19]||(d[19]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增 ",-1)])])]),e.unref(f).length?(e.openBlock(),e.createElementBlock("div",M2,[e.createElementVNode("table",P2,[d[22]||(d[22]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80",class:"text-center"},"項次"),e.createElementVNode("th",null,"影片名稱"),e.createElementVNode("th",null,"影片網址"),e.createElementVNode("th",{width:"120"},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(N,t)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",j2,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(c)[`video-${t}-Title`],modelValue:N.Title,"onUpdate:modelValue":V=>N.Title=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(c)[`video-${t}-URL`],modelValue:N.URL,"onUpdate:modelValue":V=>N.URL=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",I2,[e.createElementVNode("button",{"aria-label":"刪除影片",class:"btn btn-sm btn-teal-dark",onClick:V=>N.Deleted=!0,type:"button"},[...d[21]||(d[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,O2)])])]))),128))])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:h,type:"button"},[...d[23]||(d[23]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確認送出",-1)])])])],64)}}},Tooltip:{__name:"Tooltip",setup(_){const B=e.ref();let b;return e.onMounted(()=>{b=new bootstrap.Tooltip(B.value)}),e.onUnmounted(()=>{b&&b.dispose()}),(c,p)=>(e.openBlock(),e.createElementBlock("button",{class:"btn-tooltip",ref_key:"element",ref:B,style:{color:"#027f72"},type:"button"},[...p[0]||(p[0]=[e.createElementVNode("i",{class:"fa-solid fa-circle-info"},null,-1)])],512))}},TwDate:{__name:"TwDate",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(_){const B=_,b=p=>{const f=p==null?void 0:p.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return f?`${parseInt(f[1],10)-1911}/${f[2]}/${f[3]}`:""},c=e.ref(b(B.value));return e.watch(()=>B.value,p=>c.value=b(p)),(p,f)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||_.defaultValue),1))}},TwDateTime:{__name:"TwDateTime",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(_){const B=_,b=p=>{const f=p==null?void 0:p.match(/^(\d+)[\/-](\d+)[\/-](\d+) (\d+:\d+(:\d+)?)$/);return f?`${parseInt(f[1],10)-1911}/${f[2]}/${f[3]} ${f[4]}`:""},c=e.ref(b(B.value));return e.watch(()=>B.value,p=>c.value=b(p)),(p,f)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||_.defaultValue),1))}}};return{api:A,install:_=>{for(const B in oe)_.component(B,oe[B])},useGrantStore:K,useProgressStore:I}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
