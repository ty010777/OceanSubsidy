(function(e,Q){typeof exports=="object"&&typeof module<"u"?module.exports=Q(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],Q):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=Q(e.Vue,e.Pinia))})(this,(function(e,Q){"use strict";const j=Q.defineStore("progress",{actions:{init(x,B,y){var c,m;this[x]={id:B.ProjectID,type:(c=B.SubsidyPlanType)==null?void 0:c.split(" ")[0],name:B.ProjectName,step:B.FormStep,status:B.Status,progress:B.ProgressStatus,changeStatus:(m=B.changeApply)==null?void 0:m.Status,reportStatus:y==null?void 0:y.Status,organizer:B.Organizer,organizerName:B.OrganizerName,isOrganizer:B.isOrganizer}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let re=Date.now();const z=(x,B,y)=>{const c=j();if([1,14].includes(c[x].status)||[1,4].includes(c[x].changeStatus))return!0;if(c[x].status===42)switch(x){case"culture":if([2,3,5].includes(y))return!0;break;case"multiple":if([2,3,4,5].includes(y))return!0;break;case"accessibility":if([2,3,4,5].includes(y))return!0;break}return!1},ae=()=>`id--${re++}`,q=x=>parseInt(x)||0,v=Q.defineStore("message",{state:()=>({error:null})}),{ajax:se}=rxjs.ajax,{catchError:de,map:ce}=rxjs;let Z="";const ie=(x,B={})=>H("Service/OFS/Accessibility.ashx",{method:x,param:B}),me=(x,B={})=>H("Service/OFS/Culture.ashx",{method:x,param:B}),pe=x=>`${Z}/Service/OFS/Download.ashx?path=${x}`,Ve=(x,B={})=>H("Service/OFS/Education.ashx",{method:x,param:B}),fe=x=>{if(x.status===403){let B="/OFS/Home.aspx";/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Application|Attachment|Benefit|Funding|Other|WorkSchedule)\.aspx/.test(window.location.href)?B="/OFS/ApplicationChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Review)\.aspx/.test(window.location.href)?B="/OFS/ReviewChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Audit|Payment|Progress|Report)\.aspx/.test(window.location.href)&&(B="/OFS/inprogressList.aspx"),window.location.href=ee(B)}},Ne=(x,B={})=>H("Service/OFS/Literacy.ashx",{method:x,param:B}),Ee=(x,B={})=>H("Service/OFS/Multiple.ashx",{method:x,param:B}),be=({response:x,status:B})=>{if(B===200){if(x.success)return x.data;v().error=x.message}},H=(x,B={})=>{const y={};B.constructor!==FormData&&(y["Content-Type"]="application/json");const c={body:B,headers:y,method:"POST",url:`${Z}/${x}`};return se(c).pipe(ce(be),de(fe))},ge=x=>Z=x,ye=(x,B={})=>H("Service/OFS/System.ashx",{method:x,param:B}),ee=x=>`${Z}${x}`,A=Object.assign(H,{accessibility:ie,culture:me,download:pe,education:Ve,literacy:Ne,multiple:Ee,setBaseUrl:ge,system:ye,toUrl:ee,upload:x=>{const B=new FormData;return B.append("file",x),H("Service/OFS/Upload.ashx",B)}});function ke(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var W={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var ue=W.exports,te;function he(){return te||(te=1,(function(x,B){(function(y,c,m){var V=function(o,l,d){d=r.extend({},r.options,d);var b=r.runValidations(o,l,d);if(b.some(function(g){return r.isPromise(g.error)}))throw new Error("Use validate.async if you want support for promises");return V.processValidationResults(b,d)},r=V;r.extend=function(o){return[].slice.call(arguments,1).forEach(function(l){for(var d in l)o[d]=l[d]}),o},r.extend(V,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var o=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(o+="+"+r.version.metadata),o}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(o,l,d){var b=[],g,_,h,f,i,a,u;(r.isDomElement(o)||r.isJqueryElement(o))&&(o=r.collectFormValues(o));for(g in l){h=r.getDeepObjectValue(o,g),f=r.result(l[g],h,o,g,d,l);for(_ in f){if(i=r.validators[_],!i)throw u=r.format("Unknown validator %{name}",{name:_}),new Error(u);a=f[_],a=r.result(a,h,o,g,d,l),a&&b.push({attribute:g,value:h,validator:_,globalOptions:d,attributes:o,options:a,error:i.call(i,h,a,g,o,d)})}}return b},processValidationResults:function(o,l){o=r.pruneEmptyErrors(o,l),o=r.expandMultipleErrors(o,l),o=r.convertErrorMessages(o,l);var d=l.format||"grouped";if(typeof r.formatters[d]=="function")o=r.formatters[d](o);else throw new Error(r.format("Unknown format %{format}",l));return r.isEmpty(o)?void 0:o},async:function(o,l,d){d=r.extend({},r.async.options,d);var b=d.wrapErrors||function(_){return _};d.cleanAttributes!==!1&&(o=r.cleanAttributes(o,l));var g=r.runValidations(o,l,d);return new r.Promise(function(_,h){r.waitForResults(g).then(function(){var f=r.processValidationResults(g,d);f?h(new b(f,d,o,l)):_(o)},function(f){h(f)})})},single:function(o,l,d){return d=r.extend({},r.single.options,d,{format:"flat",fullMessages:!1}),r({single:o},{single:l},d)},waitForResults:function(o){return o.reduce(function(l,d){return r.isPromise(d.error)?l.then(function(){return d.error.then(function(b){d.error=b||null})}):l},new r.Promise(function(l){l()}))},result:function(o){var l=[].slice.call(arguments,1);return typeof o=="function"&&(o=o.apply(null,l)),o},isNumber:function(o){return typeof o=="number"&&!isNaN(o)},isFunction:function(o){return typeof o=="function"},isInteger:function(o){return r.isNumber(o)&&o%1===0},isBoolean:function(o){return typeof o=="boolean"},isObject:function(o){return o===Object(o)},isDate:function(o){return o instanceof Date},isDefined:function(o){return o!=null},isPromise:function(o){return!!o&&r.isFunction(o.then)},isJqueryElement:function(o){return o&&r.isString(o.jquery)},isDomElement:function(o){return!o||!o.querySelectorAll||!o.querySelector?!1:r.isObject(document)&&o===document?!0:typeof HTMLElement=="object"?o instanceof HTMLElement:o&&typeof o=="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName=="string"},isEmpty:function(o){var l;if(!r.isDefined(o))return!0;if(r.isFunction(o))return!1;if(r.isString(o))return r.EMPTY_STRING_REGEXP.test(o);if(r.isArray(o))return o.length===0;if(r.isDate(o))return!1;if(r.isObject(o)){for(l in o)return!1;return!0}return!1},format:r.extend(function(o,l){return r.isString(o)?o.replace(r.format.FORMAT_REGEXP,function(d,b,g){return b==="%"?"%{"+g+"}":String(l[g])}):o},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(o){return r.isNumber(o)?o*100%1===0?""+o:parseFloat(Math.round(o*100)/100).toFixed(2):r.isArray(o)?o.map(function(l){return r.prettify(l)}).join(", "):r.isObject(o)?r.isDefined(o.toString)?o.toString():JSON.stringify(o):(o=""+o,o.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(l,d,b){return""+d+" "+b.toLowerCase()}).toLowerCase())},stringifyValue:function(o,l){var d=l&&l.prettify||r.prettify;return d(o)},isString:function(o){return typeof o=="string"},isArray:function(o){return{}.toString.call(o)==="[object Array]"},isHash:function(o){return r.isObject(o)&&!r.isArray(o)&&!r.isFunction(o)},contains:function(o,l){return r.isDefined(o)?r.isArray(o)?o.indexOf(l)!==-1:l in o:!1},unique:function(o){return r.isArray(o)?o.filter(function(l,d,b){return b.indexOf(l)==d}):o},forEachKeyInKeypath:function(o,l,d){if(r.isString(l)){var b="",g,_=!1;for(g=0;g<l.length;++g)switch(l[g]){case".":_?(_=!1,b+="."):(o=d(o,b,!1),b="");break;case"\\":_?(_=!1,b+="\\"):_=!0;break;default:_=!1,b+=l[g];break}return d(o,b,!0)}},getDeepObjectValue:function(o,l){if(r.isObject(o))return r.forEachKeyInKeypath(o,l,function(d,b){if(r.isObject(d))return d[b]})},collectFormValues:function(o,l){var d={},b,g,_,h,f,i;if(r.isJqueryElement(o)&&(o=o[0]),!o)return d;for(l=l||{},h=o.querySelectorAll("input[name], textarea[name]"),b=0;b<h.length;++b)if(_=h.item(b),!r.isDefined(_.getAttribute("data-ignored"))){var a=_.name.replace(/\./g,"\\\\.");i=r.sanitizeFormValue(_.value,l),_.type==="number"?i=i?+i:null:_.type==="checkbox"?_.attributes.value?_.checked||(i=d[a]||null):i=_.checked:_.type==="radio"&&(_.checked||(i=d[a]||null)),d[a]=i}for(h=o.querySelectorAll("select[name]"),b=0;b<h.length;++b)if(_=h.item(b),!r.isDefined(_.getAttribute("data-ignored"))){if(_.multiple){i=[];for(g in _.options)f=_.options[g],f&&f.selected&&i.push(r.sanitizeFormValue(f.value,l))}else{var u=typeof _.options[_.selectedIndex]<"u"?_.options[_.selectedIndex].value:"";i=r.sanitizeFormValue(u,l)}d[_.name]=i}return d},sanitizeFormValue:function(o,l){return l.trim&&r.isString(o)&&(o=o.trim()),l.nullify!==!1&&o===""?null:o},capitalize:function(o){return r.isString(o)?o[0].toUpperCase()+o.slice(1):o},pruneEmptyErrors:function(o){return o.filter(function(l){return!r.isEmpty(l.error)})},expandMultipleErrors:function(o){var l=[];return o.forEach(function(d){r.isArray(d.error)?d.error.forEach(function(b){l.push(r.extend({},d,{error:b}))}):l.push(d)}),l},convertErrorMessages:function(o,l){l=l||{};var d=[],b=l.prettify||r.prettify;return o.forEach(function(g){var _=r.result(g.error,g.value,g.attribute,g.options,g.attributes,g.globalOptions);if(!r.isString(_)){d.push(g);return}_[0]==="^"?_=_.slice(1):l.fullMessages!==!1&&(_=r.capitalize(b(g.attribute))+" "+_),_=_.replace(/\\\^/g,"^"),_=r.format(_,{value:r.stringifyValue(g.value,l)}),d.push(r.extend({},g,{error:_}))}),d},groupErrorsByAttribute:function(o){var l={};return o.forEach(function(d){var b=l[d.attribute];b?b.push(d):l[d.attribute]=[d]}),l},flattenErrorsToArray:function(o){return o.map(function(l){return l.error}).filter(function(l,d,b){return b.indexOf(l)===d})},cleanAttributes:function(o,l){function d(_,h,f){return r.isObject(_[h])?_[h]:_[h]=f?!0:{}}function b(_){var h={},f;for(f in _)_[f]&&r.forEachKeyInKeypath(h,f,d);return h}function g(_,h){if(!r.isObject(_))return _;var f=r.extend({},_),i,a;for(a in _)i=h[a],r.isObject(i)?f[a]=g(f[a],i):i||delete f[a];return f}return!r.isObject(l)||!r.isObject(o)?{}:(l=b(l),g(o,l))},exposeModule:function(o,l,d,b,g){d?(b&&b.exports&&(d=b.exports=o),d.validate=o):(l.validate=o,o.isFunction(g)&&g.amd&&g([],function(){return o}))},warn:function(o){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+o)},error:function(o){typeof console<"u"&&console.error&&console.error("[validate.js] "+o)}}),V.validators={presence:function(o,l){if(l=r.extend({},this.options,l),l.allowEmpty!==!1?!r.isDefined(o):r.isEmpty(o))return l.message||this.message||"can't be blank"},length:function(o,l,d){if(r.isDefined(o)){l=r.extend({},this.options,l);var b=l.is,g=l.maximum,_=l.minimum,h=l.tokenizer||function(u){return u},f,i=[];o=h(o);var a=o.length;if(!r.isNumber(a))return l.message||this.notValid||"has an incorrect length";if(r.isNumber(b)&&a!==b&&(f=l.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",i.push(r.format(f,{count:b}))),r.isNumber(_)&&a<_&&(f=l.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",i.push(r.format(f,{count:_}))),r.isNumber(g)&&a>g&&(f=l.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",i.push(r.format(f,{count:g}))),i.length>0)return l.message||i}},numericality:function(o,l,d,b,g){if(r.isDefined(o)){l=r.extend({},this.options,l);var _=[],h,f,i={greaterThan:function(s,p){return s>p},greaterThanOrEqualTo:function(s,p){return s>=p},equalTo:function(s,p){return s===p},lessThan:function(s,p){return s<p},lessThanOrEqualTo:function(s,p){return s<=p},divisibleBy:function(s,p){return s%p===0}},a=l.prettify||g&&g.prettify||r.prettify;if(r.isString(o)&&l.strict){var u="^-?(0|[1-9]\\d*)";if(l.onlyInteger||(u+="(\\.\\d+)?"),u+="$",!new RegExp(u).test(o))return l.message||l.notValid||this.notValid||this.message||"must be a valid number"}if(l.noStrings!==!0&&r.isString(o)&&!r.isEmpty(o)&&(o=+o),!r.isNumber(o))return l.message||l.notValid||this.notValid||this.message||"is not a number";if(l.onlyInteger&&!r.isInteger(o))return l.message||l.notInteger||this.notInteger||this.message||"must be an integer";for(h in i)if(f=l[h],r.isNumber(f)&&!i[h](o,f)){var N="not"+r.capitalize(h),n=l[N]||this[N]||this.message||"must be %{type} %{count}";_.push(r.format(n,{count:f,type:a(h)}))}if(l.odd&&o%2!==1&&_.push(l.notOdd||this.notOdd||this.message||"must be odd"),l.even&&o%2!==0&&_.push(l.notEven||this.notEven||this.message||"must be even"),_.length)return l.message||_}},datetime:r.extend(function(o,l){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(o)){l=r.extend({},this.options,l);var d,b=[],g=l.earliest?this.parse(l.earliest,l):NaN,_=l.latest?this.parse(l.latest,l):NaN;if(o=this.parse(o,l),isNaN(o)||l.dateOnly&&o%864e5!==0)return d=l.notValid||l.message||this.notValid||"must be a valid date",r.format(d,{value:arguments[0]});if(!isNaN(g)&&o<g&&(d=l.tooEarly||l.message||this.tooEarly||"must be no earlier than %{date}",d=r.format(d,{value:this.format(o,l),date:this.format(g,l)}),b.push(d)),!isNaN(_)&&o>_&&(d=l.tooLate||l.message||this.tooLate||"must be no later than %{date}",d=r.format(d,{date:this.format(_,l),value:this.format(o,l)}),b.push(d)),b.length)return r.unique(b)}},{parse:null,format:null}),date:function(o,l){return l=r.extend({},l,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,o,l)},format:function(o,l){(r.isString(l)||l instanceof RegExp)&&(l={pattern:l}),l=r.extend({},this.options,l);var d=l.message||this.message||"is invalid",b=l.pattern,g;if(r.isDefined(o)&&(!r.isString(o)||(r.isString(b)&&(b=new RegExp(l.pattern,l.flags)),g=b.exec(o),!g||g[0].length!=o.length)))return d},inclusion:function(o,l){if(r.isDefined(o)&&(r.isArray(l)&&(l={within:l}),l=r.extend({},this.options,l),!r.contains(l.within,o))){var d=l.message||this.message||"^%{value} is not included in the list";return r.format(d,{value:o})}},exclusion:function(o,l){if(r.isDefined(o)&&(r.isArray(l)&&(l={within:l}),l=r.extend({},this.options,l),!!r.contains(l.within,o))){var d=l.message||this.message||"^%{value} is restricted";return r.isString(l.within[o])&&(o=l.within[o]),r.format(d,{value:o})}},email:r.extend(function(o,l){l=r.extend({},this.options,l);var d=l.message||this.message||"is not a valid email";if(r.isDefined(o)&&(!r.isString(o)||!this.PATTERN.exec(o)))return d},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(o,l,d,b,g){if(r.isDefined(o)){r.isString(l)&&(l={attribute:l}),l=r.extend({},this.options,l);var _=l.message||this.message||"is not equal to %{attribute}";if(r.isEmpty(l.attribute)||!r.isString(l.attribute))throw new Error("The attribute must be a non empty string");var h=r.getDeepObjectValue(b,l.attribute),f=l.comparator||function(a,u){return a===u},i=l.prettify||g&&g.prettify||r.prettify;if(!f(o,h,l,d,b))return r.format(_,{attribute:i(l.attribute)})}},url:function(o,l){if(r.isDefined(o)){l=r.extend({},this.options,l);var d=l.message||this.message||"is not a valid url",b=l.schemes||this.schemes||["http","https"],g=l.allowLocal||this.allowLocal||!1,_=l.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(o))return d;var h="^(?:(?:"+b.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",f="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(g?f+="?":h+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",h+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+f+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",_){var i="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",a="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",u="data:(?:"+i+")?(?:;base64)?,"+a;h="(?:"+h+")|(?:^"+u+"$)"}var N=new RegExp(h,"i");if(!N.exec(o))return d}},type:r.extend(function(o,l,d,b,g){if(r.isString(l)&&(l={type:l}),!!r.isDefined(o)){var _=r.extend({},this.options,l),h=_.type;if(!r.isDefined(h))throw new Error("No type was specified");var f;if(r.isFunction(h)?f=h:f=this.types[h],!r.isFunction(f))throw new Error("validate.validators.type.types."+h+" must be a function.");if(!f(o,_,d,b,g)){var i=l.message||this.messages[h]||this.message||_.message||(r.isFunction(h)?"must be of the correct type":"must be of type %{type}");return r.isFunction(i)&&(i=i(o,l,d,b,g)),r.format(i,{attribute:r.prettify(d),type:h})}}},{types:{object:function(o){return r.isObject(o)&&!r.isArray(o)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},V.formatters={detailed:function(o){return o},flat:r.flattenErrorsToArray,grouped:function(o){var l;o=r.groupErrorsByAttribute(o);for(l in o)o[l]=r.flattenErrorsToArray(o[l]);return o},constraint:function(o){var l;o=r.groupErrorsByAttribute(o);for(l in o)o[l]=o[l].map(function(d){return d.validator}).sort();return o}},V.exposeModule(V,this,y,c,m)}).call(ue,B,x,null)})(W,W.exports)),W.exports}var xe=he();const le=ke(xe),M=(x,B,y="")=>{const c={};Object.keys(B).forEach(r=>{const o=B[r];le.isString(o)?c[r]={presence:{allowEmpty:!1,message:o.startsWith("^")?o:`^請輸入${o}`}}:c[r]=o});const m={},V=le(x,c);return V&&Object.keys(V).forEach(r=>m[`${y}${r}`]=V[r].join(",")),m},$e={class:"block"},Be={class:"mt-4"},_e={class:"table align-middle gray-table side-table"},Ce={key:0},Te={key:1,class:"text-light-gray"},we={class:"d-flex flex-column gap-2"},De={key:0},Se={class:"mt-4"},Ae={class:"table align-middle gray-table side-table"},Fe={class:"row g-3"},Ue={class:"col-12 col-xl-2"},Pe={class:"text-gray mb-2"},Me={class:"col-12 col-xl-3"},Ie={class:"text-gray mb-2"},je={class:"col-12 col-xl-4"},Oe={class:"row g-1"},Le={class:"col-7"},Re={class:"col-5"},qe={class:"col-12 col-xl-3"},ze={class:"text-gray mb-2"},Ge={class:"col-12"},Je={class:"text-gray mb-2"},Ye={class:"mt-4"},Qe={class:"table align-middle gray-table side-table"},He={class:"mt-4"},We={class:"table align-middle gray-table side-table"},Ke={key:0,class:"table-responsive mt-3 mb-0"},Xe={class:"table align-middle gray-table"},Ze={key:0},ve={key:0},et={class:"d-flex gap-2"},tt=["onClick"],lt={class:"mt-4"},ot={class:"table align-middle gray-table side-table"},nt={key:0,class:"block-bottom bg-light-teal"},rt={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.ref(),r=e.computed(()=>z("accessibility",d.value.Status,1)),o=e.ref({}),l=e.computed(()=>b.value.filter(N=>!N.Deleted)),d=e.ref({}),b=e.ref([]),g=e.computed({get:()=>!!l.value.length,set:N=>{N?_():b.value.forEach(n=>n.Deleted=!0)}}),_=()=>b.value.push({}),h=B,f=()=>{A.accessibility("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(N=>{d.value=N.Project,V.value=N.Contacts,b.value=N.ReceivedSubsidies,d.value.OrgCategory=d.value.OrgCategory||null,j().init("accessibility",d.value),m.value=d.value.changeApply,d.value.changeApply=void 0})},i=N=>N.Deleted=!0,a=N=>{var s,p;if(o.value={},N&&!u()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:d.value,Contacts:V.value,ReceivedSubsidies:b.value.filter(t=>t.ID||!t.Deleted),Before:(s=m.value)==null?void 0:s.Form1Before,After:(p=m.value)==null?void 0:p.Form1After,Submit:N?"true":"false"};A.accessibility("saveApplication",n).subscribe(t=>{N?h("next",t.ID):d.value.ID?f():window.location.href=`Application.aspx?ID=${t.ID}`})},u=()=>{let N={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return d.value.OrgCategory==="2"&&(N.RegisteredNum="立案登記證字號"),o.value=M(d.value,N),N={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((n,s)=>Object.assign(o.value,M(n,N,`contact-${s}-`))),N={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},b.value.forEach((n,s)=>Object.assign(o.value,M(n,N,`received-${s}-`))),m.value&&(N={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,M(m.value,N))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(N=>{c.value=N[0],y.id?f():A.accessibility("getEmptyApplication").subscribe(n=>{d.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},n),V.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("accessibility",d.value)})})}),e.provide("editable",r),(N,n)=>{const s=e.resolveComponent("required-label"),p=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),E=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$e,[n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Be,[e.createElementVNode("table",_e,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",Ce,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Te,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[17]||(n[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).ProjectName,modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=C=>e.unref(d).ProjectName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":n[1]||(n[1]=C=>e.unref(d).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",we,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).OrgCategory,"onUpdate:modelValue":n[2]||(n[2]=C=>e.unref(d).OrgCategory=C)},null,8,["error","options","modelValue"])]),e.unref(d).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",De,[e.createVNode(p,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(d).RegisteredNum,"onUpdate:modelValue":n[3]||(n[3]=C=>e.unref(d).RegisteredNum=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(d).TaxID,"onUpdate:modelValue":n[4]||(n[4]=C=>e.unref(d).TaxID=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":n[5]||(n[5]=C=>e.unref(d).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[43]||(n[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Se,[e.createElementVNode("table",Ae,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(C,S)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Fe,[e.createElementVNode("div",Ue,[e.createElementVNode("div",Pe,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(o)[`contact-${S}-Name`],modelValue:C.Name,"onUpdate:modelValue":P=>C.Name=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Me,[e.createElementVNode("div",Ie,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[24]||(n[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(o)[`contact-${S}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":P=>C.JobTitle=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",je,[n[25]||(n[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Oe,[e.createElementVNode("div",Le,[e.createVNode(p,{modelValue:C.Phone,"onUpdate:modelValue":P=>C.Phone=P,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Re,[e.createVNode(p,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":P=>C.PhoneExt=P,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",qe,[e.createElementVNode("div",ze,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(o)[`contact-${S}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":P=>C.MobilePhone=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ge,[e.createElementVNode("div",Je,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(o)[`contact-${S}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":P=>C.EMail=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[44]||(n[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Ye,[e.createElementVNode("table",Qe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[28]||(n[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[29]||(n[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(E,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(d).Target,"onUpdate:modelValue":n[6]||(n[6]=C=>e.unref(d).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":n[7]||(n[7]=C=>e.unref(d).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":n[8]||(n[8]=C=>e.unref(d).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[32]||(n[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Qualitative,"onUpdate:modelValue":n[9]||(n[9]=C=>e.unref(d).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",He,[e.createElementVNode("table",We,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[38]||(n[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(g),"onUpdate:modelValue":n[10]||(n[10]=C=>e.isRef(g)?g.value=C:null)},null,8,["modelValue"]),e.unref(g)?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("table",Xe,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[33]||(n[33]=e.createElementVNode("th",null,"計畫名稱",-1)),n[34]||(n[34]=e.createElementVNode("th",null,"補助單位",-1)),n[35]||(n[35]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Ze,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,S)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o)[`received-${S}-Name`],modelValue:C.Name,"onUpdate:modelValue":P=>C.Name=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o)[`received-${S}-Unit`],modelValue:C.Unit,"onUpdate:modelValue":P=>C.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${S}-Amount`],modelValue:C.Amount,"onUpdate:modelValue":P=>C.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",ve,[e.createElementVNode("div",et,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>i(C),type:"button"},[...n[36]||(n[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,tt)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:_,type:"button"},[...n[37]||(n[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",lt,[e.createElementVNode("table",ot,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[39]||(n[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":n[11]||(n[11]=C=>e.unref(m).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[40]||(n[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":n[12]||(n[12]=C=>e.unref(m).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",nt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[13]||(n[13]=C=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[14]||(n[14]=C=>a(!0)),type:"button"},[...n[45]||(n[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},at={class:"block"},st={key:0,class:"text-pink lh-base mt-4"},dt={class:"mt-4"},ct={class:"table align-middle gray-table"},it={class:"text-center"},mt={key:0,width:"180"},pt={class:"text-center"},Vt={key:0},ft=["innerHTML"],Nt=["href"],Et={key:0,class:"text-center"},bt={key:0},gt={key:1,class:"text-pink"},yt={key:1,class:"tag-group mt-2 gap-1"},kt={key:0,class:"tag tag-green-light"},ut=["download","href"],ht=["onClick"],xt={class:"mt-4"},$t={class:"table align-middle gray-table side-table"},Bt={key:0,class:"block-bottom bg-light-teal"},_t=["disabled"],Ct={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),V=e.computed(()=>c.value.some(i=>!i.Optional&&!i.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("accessibility",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(i.Multiple?a.Name:`${i.Title}.pdf`)})},b=A.download,g=B,_=()=>{rxjs.forkJoin([A.accessibility("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=c.value.filter(u=>{var N;return!((N=u.Excludes)!=null&&N.includes(l.value.OrgCategory))}),c.value.forEach(u=>{u.Files=a.Attachments.filter(N=>N.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(N=>!N.Deleted).length)}),j().init("accessibility",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},h=i=>{var u,N;if(o.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,s)=>n.concat(s.Files),[]),Before:(u=m.value)==null?void 0:u.Form5Before,After:(N=m.value)==null?void 0:N.Form5After,Submit:i?"true":"false"};A.accessibility("saveAttachment",a).subscribe(()=>{i?g("next"):_()})},f=()=>{if(m.value){const i={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,M(m.value,i))}return!Object.keys(o.value).length};return e.onMounted(_),e.provide("editable",r),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",at,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",st,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",dt,[e.createElementVNode("table",ct,[e.createElementVNode("thead",it,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",mt,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",pt,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",Vt,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(u,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,ft)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Nt)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Et,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",bt,"已上傳")):(e.openBlock(),e.createElementBlock("span",gt,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>d(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",yt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",kt,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(b)(t.Path)},e.toDisplayString(t.Name),9,ut),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ht)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",xt,[e.createElementVNode("table",$t,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(m).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Bt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>h(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,_t)])):e.createCommentVNode("",!0)],64)}}},Tt={class:"block"},wt={class:"mt-4"},Dt={class:"table-responsive mt-3 mb-0"},St={class:"table align-middle gray-table"},At={key:0,width:"1"},Ft={key:0},Ut={class:"d-flex gap-2"},Pt=["onClick"],Mt={class:"table-responsive mt-3 mb-0"},It={class:"table align-middle gray-table"},jt={class:"mt-4"},Ot={class:"table align-middle gray-table side-table"},Lt={key:0,class:"block-bottom bg-light-teal"},Rt={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.computed(()=>z("accessibility",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>c.value.filter(i=>!i.Deleted)),l=e.ref({}),d=()=>c.value.push({}),b=B,g=()=>{rxjs.forkJoin([A.accessibility("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=a.Benefits,c.value.length||d(),j().init("accessibility",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=i=>i.Deleted=!0,h=i=>{var u,N;if(r.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(u=m.value)==null?void 0:u.Form4Before,After:(N=m.value)==null?void 0:N.Form4After,Submit:i?"true":"false"};A.accessibility("saveBenefit",a).subscribe(()=>{i?b("next"):g()})},f=()=>{let i={Benefit:"不可量化成果"};return r.value=M(l.value,i),i={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,u)=>Object.assign(r.value,M(a,i,`item-${u}-`))),m.value&&(i={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,M(m.value,i))),!Object.keys(r.value).length};return e.onMounted(g),e.provide("editable",V),(i,a)=>{const u=e.resolveComponent("input-text"),N=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Tt,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",wt,[e.createElementVNode("div",Dt,[e.createElementVNode("table",St,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",At,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Title`],modelValue:s.Title,"onUpdate:modelValue":t=>s.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Target`],modelValue:s.Target,"onUpdate:modelValue":t=>s.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r)[`item-${p}-Description`],rows:"1",modelValue:s.Description,"onUpdate:modelValue":t=>s.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Ft,[e.createElementVNode("div",Ut,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>_(s),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Pt)):e.createCommentVNode("",!0),p+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Mt,[e.createElementVNode("table",It,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(l).Benefit=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",jt,[e.createElementVNode("table",Ot,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form4Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":a[2]||(a[2]=s=>e.unref(m).Form4After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Lt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=s=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},qt={class:"block"},zt={class:"mt-4"},Gt={class:"table-responsive mt-3 mb-0"},Jt={class:"table align-middle gray-table"},Yt={class:"text-end"},Qt={class:"text-end"},Ht={class:"table-responsive"},Wt={class:"table align-middle gray-table"},Kt=["colspan"],Xt={key:0,width:"1"},Zt={class:"text-end"},vt={key:0},el={class:"d-flex gap-2"},tl=["onClick"],ll={class:"mt-4"},ol={class:"table-responsive mt-3 mb-0"},nl={class:"table align-middle gray-table"},rl={key:0,width:"1"},al={class:"text-end"},sl={key:0},dl={class:"d-flex gap-2"},cl=["onClick"],il={class:"mt-4"},ml={class:"table align-middle gray-table side-table"},pl={key:0,class:"block-bottom bg-light-teal"},Vl={class:"text-center"},fl={class:"mb-5"},Nl={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("accessibility",l.value.Status,3)),V=e.ref({}),r=e.computed(()=>b.value.filter(p=>!p.Deleted)),o=e.computed(()=>g.value.filter(p=>!p.Deleted)),l=e.ref({}),d=e.ref(),b=e.ref([]),g=e.ref([]),_=e.ref({}),h=e.ref(0),f=()=>b.value.push({}),i=()=>g.value.push({}),a=B,u=()=>{rxjs.forkJoin([A.accessibility("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];l.value=t.Project,b.value=t.OtherSubsidies,g.value=t.BudgetPlans,_.value=t.GrantTargetSetting,g.value.length||i(),j().init("accessibility",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=(p,t)=>{var k,w;if(V.value={},p&&!s()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>_.value.GrantLimit*1e4){d.value.show(()=>n(p,!0));return}const E={Project:l.value,OtherSubsidies:b.value,BudgetPlans:g.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:p?"true":"false"};A.accessibility("saveFunding",E).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(l.value,p),p={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`other-${E}-`))),p={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`plan-${E}-`))),c.value&&(p={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(c.value,p))),!Object.keys(V.value).length};return e.onMounted(u),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((p,t)=>p+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(p=>p.percent=Math.round(q(p.Amount)/l.value.OtherAmount*1e4)/100),g.value.forEach(p=>p.sum=q(p.Amount)+q(p.OtherAmount))}),(p,t)=>{var P;const E=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",qt,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",zt,[e.createElementVNode("div",Gt,[e.createElementVNode("table",Jt,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",Yt,e.toDisplayString((P=e.unref(l).OtherAmount)==null?void 0:P.toLocaleString()),1),e.createElementVNode("td",Qt,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",Ht,[e.createElementVNode("table",Wt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Kt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Xt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":D=>F.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Zt,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":D=>F.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",vt,[e.createElementVNode("div",el,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,tl)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",ll,[e.createElementVNode("div",ol,[e.createElementVNode("table",nl,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",rl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":D=>F.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":D=>F.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",al,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":D=>F.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",sl,[e.createElementVNode("div",dl,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,cl)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",il,[e.createElementVNode("table",ml,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",pl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",Vl,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",fl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Y=Q.defineStore("payment",{actions:{init(x,B=0){this.stage=x==null?void 0:x.Stage,this.amount=x==null?void 0:x.CurrentRequestAmount,this.paid=B,this.status=x==null?void 0:x.Status}},state:()=>({stage:null,amount:null,paid:null,status:null})}),El={class:"block"},bl={class:"square-title"},gl={class:"text-teal fw-bold py-3"},yl={class:"table-responsive mb-0"},kl={class:"table align-middle gray-table"},ul={class:"text-end"},hl={class:"text-end"},xl={class:"text-end"},$l={class:"text-teal fw-bold pb-3"},Bl={class:"text-teal fw-bold pb-3"},_l={class:"mt-4"},Cl={class:"table align-middle gray-table"},Tl={class:"text-center"},wl={key:0,width:"180"},Dl={class:"text-center"},Sl=["href"],Al={key:0,class:"text-center"},Fl={key:0},Ul={key:1,class:"text-pink"},Pl={key:1,class:"tag-group mt-2 gap-1"},Ml={key:0,class:"tag tag-green-light"},Il=["download","href"],jl=["onClick"],Ol={class:"block-bottom bg-light-teal"},Ll=["disabled"],Rl={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>_.value.some(N=>!N.Files.filter(n=>!n.Deleted).length)),V=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var N;return((N=l.value)==null?void 0:N.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),b=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(c.value*100/d.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>r.value?Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"領據",Files:[]}]),h=(N,n)=>{n.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:n.Path,Name:`${d.value.ProjectID}_第一期請款_${N.Title}.pdf`})},f=A.download,i=B,a=()=>{A.accessibility("getPayment",{ID:y.id}).subscribe(N=>{d.value=N.Project,j().init("accessibility",d.value),_.value=_.value.filter(n=>{var s;return!((s=n.Excludes)!=null&&s.includes(d.value.OrgCategory))}),_.value.forEach(n=>{n.Files=N.Attachments.filter(s=>s.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(s=>!s.Deleted).length)}),l.value=N.Payments.find(n=>n.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=Math.round(d.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),Y().init(l.value)})},u=N=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((s,p)=>s.concat(p.Files),[]),Submit:N?"true":"false"};A.accessibility("savePayment",n).subscribe(()=>{N?i("next"):a()})};return e.onMounted(a),e.provide("editable",V),(N,n)=>{var E;const s=e.resolveComponent("input-integer"),p=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",El,[e.createElementVNode("h5",bl,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",gl,"核定經費: "+e.toDisplayString((E=e.unref(d).ApprovedAmount)==null?void 0:E.toLocaleString())+"元",1),e.createElementVNode("div",yl,[e.createElementVNode("table",kl,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",ul,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(s,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",hl,e.toDisplayString(e.unref(b))+"%",1),e.createElementVNode("td",xl,e.toDisplayString(e.unref(g)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",$l,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Bl,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",_l,[e.createElementVNode("table",Cl,[e.createElementVNode("thead",Tl,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",wl,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,w)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Dl,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(V)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Sl)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Al,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Fl,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ul,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>h(k,C)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",Pl,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ml,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(f)(C.Path)},e.toDisplayString(C.Name),9,Il),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>C.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,jl)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Ol,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>u(!0)),disabled:e.unref(m),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ll)])],64)}}},ql={class:"block"},zl={class:"square-title"},Gl={class:"text-teal fw-bold py-3"},Jl={class:"text-teal fw-bold pb-3"},Yl={class:"table-responsive mb-0"},Ql={class:"table align-middle gray-table"},Hl={class:"text-end"},Wl={class:"text-end"},Kl={class:"text-end"},Xl={class:"text-end"},Zl={class:"text-teal fw-bold pb-3"},vl={class:"text-teal fw-bold pb-3"},eo={class:"mt-4"},to={class:"table align-middle gray-table"},lo={class:"text-center"},oo={key:0,width:"180"},no={class:"text-center"},ro=["href"],ao={key:0,class:"text-center"},so={key:0},co={key:1,class:"text-pink"},io={key:1,class:"tag-group mt-2 gap-1"},mo={key:0,class:"tag tag-green-light"},po=["download","href"],Vo=["onClick"],fo={class:"block-bottom bg-light-teal"},No=["disabled"],Eo={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>i.value.some(p=>!p.Files.filter(t=>!t.Deleted).length)),V=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var p;return((p=l.value)==null?void 0:p.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref(0),b=e.ref(0),g=e.ref({}),_=e.computed(()=>g.value.ApprovedAmount?Math.min(Math.round(c.value*100/g.value.ApprovedAmount*100)/100,100):0),h=e.computed(()=>f.value?Math.round(c.value*100/f.value*100)/100:0),f=e.computed(()=>b.value+(r.value?l.value.CurrentActualPaidAmount:0)),i=e.ref([{Type:21,Title:"領據",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/ACC/1-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/ACC/2-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/ACC/3-補助清單.docx",Files:[]},{Type:25,Title:"其他",Files:[]}]),a=(p,t)=>{t.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:t.Path,Name:`${g.value.ProjectID}_第二期請款_${p.Title}.pdf`})},u=A.download,N=B,n=()=>{A.accessibility("getPayment",{ID:y.id}).subscribe(p=>{g.value=p.Project,j().init("accessibility",g.value),i.value=i.value.filter(E=>{var k;return!((k=E.Excludes)!=null&&k.includes(g.value.OrgCategory))}),i.value.forEach(E=>{E.Files=p.Attachments.filter(k=>k.Type===E.Type),E.Uploaded=e.computed(()=>E.Files.filter(k=>!k.Deleted).length)}),l.value=p.Payments.find(E=>E.Stage===2),l.value&&(c.value=l.value.TotalSpentAmount),o.value=g.value.ApprovedAmount;const t=p.Payments.filter(E=>E.Stage<2&&E.Status==="通過");d.value=t.reduce((E,k)=>E+k.CurrentRequestAmount,0),b.value=t.reduce((E,k)=>E+k.CurrentActualPaidAmount,0),Y().init(l.value,b.value)})},s=p=>{const t={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:i.value.reduce((E,k)=>E.concat(k.Files),[]),Submit:p?"true":"false"};A.accessibility("savePayment",t).subscribe(()=>{p?N("next"):n()})};return e.onMounted(n),e.provide("editable",V),(p,t)=>{var C;const E=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ql,[e.createElementVNode("h5",zl,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Gl,"核定經費: "+e.toDisplayString((C=e.unref(g).ApprovedAmount)==null?void 0:C.toLocaleString())+"元",1),e.createElementVNode("p",Jl,"賸餘款: "+e.toDisplayString((e.unref(g).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Yl,[e.createElementVNode("table",Ql,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Hl,e.toDisplayString(e.unref(c)-e.unref(d)),1),e.createElementVNode("td",Wl,e.toDisplayString(e.unref(b)),1),e.createElementVNode("td",null,[e.createVNode(E,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":t[0]||(t[0]=S=>e.isRef(c)?c.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Kl,e.toDisplayString(e.unref(_))+"%",1),e.createElementVNode("td",Xl,e.toDisplayString(e.unref(h))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Zl,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",vl,"累積實際撥款: "+e.toDisplayString(e.unref(f).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",eo,[e.createElementVNode("table",to,[e.createElementVNode("thead",lo,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",oo,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(S,P)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",no,e.toDisplayString(P+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(V)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ro)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",ao,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",so,"已上傳")):(e.openBlock(),e.createElementBlock("span",co,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!S.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:F=>a(S,F)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",io,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,F=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:F},[F.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",mo,[e.createElementVNode("a",{class:"tag-link my-1",download:F.Name,href:e.unref(u)(F.Path)},e.toDisplayString(F.Name),9,po),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>F.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Vo)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",fo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=S=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=S=>s(!0)),disabled:e.unref(m),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,No)])],64)}}},bo={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:B,type:"accessibility"})}}},go={class:"block"},yo={class:"mt-4"},ko={class:"table align-middle gray-table side-table"},uo={key:0,class:"d-flex align-items-center gap-2"},ho={class:"input-group w-auto"},xo={class:"text-teal-dark"},$o={key:1,class:"invalid mt-0"},Bo={class:"table-responsive mt-4"},_o={class:"table align-middle gray-table"},Co={key:0},To={class:"input-group"},wo={key:0,class:"invalid mt-0"},Do={key:0},So={class:"d-flex gap-2"},Ao=["onClick"],Fo={class:"mt-4"},Uo={class:"table align-middle gray-table"},Po={key:0},Mo=["value"],Io={key:0},jo={class:"d-flex gap-2"},Oo=["onClick"],Lo={class:"mt-4"},Ro={class:"table align-middle gray-table side-table"},qo={key:0,class:"block-bottom bg-light-teal"},zo={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),V=e.computed(()=>g.value.EndDate),r=e.computed(()=>z("accessibility",b.value.Status,2)),o=e.ref({}),l=e.computed(()=>_.value.filter(p=>!p.Deleted)),d=e.computed(()=>h.value.filter(p=>!p.Deleted)),b=e.ref({}),g=e.ref({}),_=e.ref([]),h=e.ref([]),f=()=>A.accessibility("createItem",{ID:y.id}).subscribe(p=>_.value.push(p)),i=()=>h.value.push({Type:0,ItemID:0}),a=B,u=()=>{rxjs.forkJoin([A.accessibility("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];b.value=t.Project,g.value=t.GrantType,_.value=t.Items,h.value=t.Schedules,_.value.length||f(),h.value.length||i(),j().init("accessibility",b.value),m.value=b.value.changeApply,b.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=p=>{var E,k;if(o.value={},p&&!s()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:b.value,Items:_.value,Schedules:h.value,Before:(E=m.value)==null?void 0:E.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:p?"true":"false"};A.accessibility("saveWorkSchedule",t).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=M(b.value,p),p={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`item-${E}-`))),p={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`schedule-${E}-`))),m.value&&(p={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,M(m.value,p))),!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(p,t)=>{const E=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),P=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",go,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",yo,[e.createElementVNode("table",ko,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",uo,[e.createElementVNode("div",ho,[e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(b).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(b).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",xo,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",$o,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Bo,[e.createElementVNode("table",_o,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Co,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${D}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",To,[e.createVNode(S,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",wo,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Do,[e.createElementVNode("div",So,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ao)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Fo,[e.createElementVNode("table",Uo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Po,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(I.Title),9,Mo)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Io,[e.createElementVNode("div",jo,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Oo)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Lo,[e.createElementVNode("table",Ro,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",qo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Go={class:"block rounded-bottom-4"},Jo={class:"mt-4"},Yo={class:"table align-middle gray-table side-table"},Qo={class:"text-pink"},Ho={class:"table-responsive",style:{"min-height":"400px"}},Wo={class:"table teal-table"},Ko={"data-th":"計畫編號／計畫名稱:",class:"text-start"},Xo=["href"],Zo={"data-th":"查核日期／人員:",class:"text-start"},vo={"data-th":"風險評估:"},en={"data-th":"查核意見:",class:"text-start"},tn={"data-th":"執行單位回覆:",class:"text-start"},ln={__name:"AuditHistory",props:{name:{type:String}},setup(x){const B=x,y=e.ref([]),c=e.ref(0),m=["無","低風險","中風險","高風險"];return e.onMounted(()=>{A.system("getAuditHistory",{Name:B.name}).subscribe(V=>{y.value=V.List,y.value.forEach(r=>{switch(r.Risk){case"Low":r.lv=1,c.value<1&&(c.value=1);break;case"Medium":r.lv=2,c.value<2&&(c.value=2);break;case"High":r.lv=3,c.value<3&&(c.value=3);break}})})}),(V,r)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock("div",Go,[r[3]||(r[3]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"查核紀錄")])])],-1)),e.createElementVNode("div",Jo,[e.createElementVNode("table",Yo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("th",null,"執行單位",-1)),e.createElementVNode("td",null,e.toDisplayString(x.name),1)]),e.createElementVNode("tr",null,[r[1]||(r[1]=e.createElementVNode("th",null,"風險評估",-1)),e.createElementVNode("td",null,[e.createElementVNode("span",Qo,e.toDisplayString(m[e.unref(c)]),1)])])])])]),e.createElementVNode("div",Ho,[e.createElementVNode("table",Wo,[r[2]||(r[2]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫編號／計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核日期／人員")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"風險評估")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核意見")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"執行單位回覆")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",Ko,[e.createElementVNode("a",{class:"link-black",href:`AuditRecords.aspx?ProjectID=${l.ProjectID}`,target:"_blank"},e.toDisplayString(l.ProjectID)+"／"+e.toDisplayString(l.ProjectName),9,Xo)]),e.createElementVNode("td",Zo,[e.createVNode(o,{value:l.CheckDate},null,8,["value"]),e.createTextVNode("／"+e.toDisplayString(l.ReviewerName),1)]),e.createElementVNode("td",vo,e.toDisplayString(m[l.lv]),1),e.createElementVNode("td",en,e.toDisplayString(l.ReviewerComment),1),e.createElementVNode("td",tn,e.toDisplayString(l.ExecutorComment),1)]))),128))])])])])}}},on={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},nn={class:"modal-content"},rn={class:"modal-body"},an={class:"d-flex justify-content-center mt-4 gap-4"},sn={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},dn={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(x,{expose:B}){let y;const c=e.ref(),m=x,V=()=>{y&&y()};return B({show:o=>{y=o,bootstrap.Modal.getOrCreateInstance(c.value).show()}}),(o,l)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",on,[e.createElementVNode("div",nn,[l[0]||(l[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",rn,[e.renderSlot(o.$slots,"default"),e.createElementVNode("div",an,[e.createElementVNode("button",sn,e.toDisplayString(m.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:V,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(m.confirm),1)])])])])],512)]))}},cn={class:"application-step"},mn=["onClick"],pn={class:"step-content"},Vn={class:"step-label"},fn={key:0,class:"step-status edit"},Nn={key:1,class:"step-status"},En={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(x,{emit:B}){const y=e.computed(()=>z(m.type,c[m.type].status,m.step)),c=j(),m=x,V=o=>{m.review?r("click",o.step):o.step<=c[m.type].step&&(location.href=`${o.url}.aspx?ID=${m.id}`)},r=B;return(o,l)=>(e.openBlock(),e.createElementBlock("div",cn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.steps,d=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(y)&&(d.step<e.unref(c)[x.type].step||d.step===x.step)}]),onClick:b=>V(d),key:d,role:"button"},[e.createElementVNode("div",pn,[e.createElementVNode("div",Vn,e.toDisplayString(d.title),1),e.unref(y)&&d.step===x.step?(e.openBlock(),e.createElementBlock("div",fn,"編輯中")):d.step<e.unref(c)[x.type].step?(e.openBlock(),e.createElementBlock("div",Nn,"已完成")):e.createCommentVNode("",!0)])],10,mn))),128))]))}},bn={class:"block"},gn={class:"mt-4"},yn={class:"table align-middle gray-table side-table"},kn={key:0},un={key:1,class:"text-light-gray"},hn={class:"d-flex gap-2"},xn={key:0,class:"invalid mt-0"},$n={class:"d-flex flex-column gap-2"},Bn={key:0},_n={class:"mt-4"},Cn={class:"table align-middle gray-table side-table"},Tn={class:"row g-3"},wn={class:"col-12 col-xl-2"},Dn={class:"text-gray mb-2"},Sn={class:"col-12 col-xl-3"},An={class:"text-gray mb-2"},Fn={class:"col-12 col-xl-4"},Un={class:"row g-1"},Pn={class:"col-7"},Mn={class:"col-5"},In={class:"col-12 col-xl-3"},jn={class:"text-gray mb-2"},On={class:"col-12"},Ln={class:"text-gray mb-2"},Rn={class:"mt-4"},qn={class:"table align-middle gray-table side-table"},zn={class:"mt-4"},Gn={class:"table align-middle gray-table side-table"},Jn={key:0,class:"table-responsive mt-3 mb-0"},Yn={class:"table align-middle gray-table"},Qn={key:0},Hn={key:0},Wn={class:"d-flex gap-2"},Kn=["onClick"],Xn={class:"mt-4"},Zn={class:"table align-middle gray-table side-table"},vn={key:0,class:"block-bottom bg-light-teal"},er={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.ref(),r=e.computed(()=>z("culture",g.value.Status,1)),o=e.ref({}),l=e.ref(null),d=e.ref([]),b=e.computed(()=>h.value.filter(t=>!t.Deleted)),g=e.ref({}),_=e.computed(()=>d.value.filter(t=>!t.ParentCode)),h=e.ref([]),f=e.computed(()=>d.value.filter(t=>t.ParentCode===l.value)),i=e.computed({get:()=>!!b.value.length,set:t=>{t?a():h.value.forEach(E=>E.Deleted=!0)}}),a=()=>h.value.push({}),u=B,N=()=>{A.culture("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(t=>{var E;g.value=t.Project,V.value=t.Contacts,h.value=t.ReceivedSubsidies,l.value=((E=d.value.find(k=>k.Code===g.value.Field))==null?void 0:E.ParentCode)||null,g.value.OrgCategory=g.value.OrgCategory||null,j().init("culture",g.value),m.value=g.value.changeApply,g.value.changeApply=void 0})},n=t=>t.Deleted=!0,s=t=>{var k,w;if(o.value={},t&&!p()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}const E={Project:g.value,Contacts:V.value,ReceivedSubsidies:h.value.filter(C=>C.ID||!C.Deleted),Before:(k=m.value)==null?void 0:k.Form1Before,After:(w=m.value)==null?void 0:w.Form1After,Submit:t?"true":"false"};A.culture("saveApplication",E).subscribe(C=>{t?u("next",C.ID):g.value.ID?N():window.location.href=`Application.aspx?ID=${C.ID}`})},p=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return g.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),o.value=M(g.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((E,k)=>Object.assign(o.value,M(E,t,`contact-${k}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},h.value.forEach((E,k)=>Object.assign(o.value,M(E,t,`received-${k}-`))),m.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,M(m.value,t))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.culture("getZgsCodes",{CodeGroup:"CULField"}),A.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{d.value=t[0],c.value=t[1],y.id?N():A.culture("getEmptyApplication").subscribe(E=>{l.value=null,g.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},E),V.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("culture",g.value)})})}),e.provide("editable",r),e.watch(l,()=>{l.value?f.value.find(t=>g.value.Field===t.Code)||(g.value.Field=f.value[0].Code):g.value.Field=null}),(t,E)=>{const k=e.resolveComponent("required-label"),w=e.resolveComponent("input-text"),C=e.resolveComponent("input-select"),S=e.resolveComponent("input-textarea"),P=e.resolveComponent("input-boolean"),F=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",bn,[E[45]||(E[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",gn,[e.createElementVNode("table",yn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[E[17]||(E[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).Year),1)]),e.createElementVNode("tr",null,[E[18]||(E[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(g).ProjectID?(e.openBlock(),e.createElementBlock("span",kn,e.toDisplayString(e.unref(g).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",un,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[E[19]||(E[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[20]||(E[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).ProjectName,modelValue:e.unref(g).ProjectName,"onUpdate:modelValue":E[0]||(E[0]=T=>e.unref(g).ProjectName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[21]||(E[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",hn,[e.createVNode(C,{"empty-value":null,options:e.unref(_),"text-name":"Descname","value-name":"Code",modelValue:e.unref(l),"onUpdate:modelValue":E[1]||(E[1]=T=>e.isRef(l)?l.value=T:null)},null,8,["options","modelValue"]),e.createVNode(C,{"empty-value":null,disabled:!e.unref(l),options:e.unref(f),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).Field,"onUpdate:modelValue":E[2]||(E[2]=T=>e.unref(g).Field=T)},null,8,["disabled","options","modelValue"])]),e.unref(o).Field?(e.openBlock(),e.createElementBlock("div",xn,e.toDisplayString(e.unref(o).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[22]||(E[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(g).OrgName,"onUpdate:modelValue":E[3]||(E[3]=T=>e.unref(g).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[23]||(E[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",$n,[e.createElementVNode("div",null,[e.createVNode(C,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).OrgCategory,"onUpdate:modelValue":E[4]||(E[4]=T=>e.unref(g).OrgCategory=T)},null,8,["error","options","modelValue"])]),e.unref(g).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",Bn,[e.createVNode(w,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(g).RegisteredNum,"onUpdate:modelValue":E[5]||(E[5]=T=>e.unref(g).RegisteredNum=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[24]||(E[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(g).TaxID,"onUpdate:modelValue":E[6]||(E[6]=T=>e.unref(g).TaxID=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[25]||(E[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(g).Address,"onUpdate:modelValue":E[7]||(E[7]=T=>e.unref(g).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),E[46]||(E[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",_n,[e.createElementVNode("table",Cn,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Tn,[e.createElementVNode("div",wn,[e.createElementVNode("div",Dn,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[26]||(E[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Sn,[e.createElementVNode("div",An,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[27]||(E[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":U=>T.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Fn,[E[28]||(E[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Un,[e.createElementVNode("div",Pn,[e.createVNode(w,{modelValue:T.Phone,"onUpdate:modelValue":U=>T.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Mn,[e.createVNode(w,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":U=>T.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",In,[e.createElementVNode("div",jn,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[29]||(E[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":U=>T.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",On,[e.createElementVNode("div",Ln,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[30]||(E[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":U=>T.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),E[47]||(E[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Rn,[e.createElementVNode("table",qn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[31]||(E[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[E[32]||(E[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(S,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(g).Target,"onUpdate:modelValue":E[8]||(E[8]=T=>e.unref(g).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[33]||(E[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(g).Summary,"onUpdate:modelValue":E[9]||(E[9]=T=>e.unref(g).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[34]||(E[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Quantified,"onUpdate:modelValue":E[10]||(E[10]=T=>e.unref(g).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[35]||(E[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Qualitative,"onUpdate:modelValue":E[11]||(E[11]=T=>e.unref(g).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",zn,[e.createElementVNode("table",Gn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[E[41]||(E[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(P,{modelValue:e.unref(i),"onUpdate:modelValue":E[12]||(E[12]=T=>e.isRef(i)?i.value=T:null)},null,8,["modelValue"]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Jn,[e.createElementVNode("table",Yn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[E[36]||(E[36]=e.createElementVNode("th",null,"計畫名稱",-1)),E[37]||(E[37]=e.createElementVNode("th",null,"補助單位",-1)),E[38]||(E[38]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Qn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${D}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${D}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":U=>T.Unit=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(o)[`received-${D}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":U=>T.Amount=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Hn,[e.createElementVNode("div",Wn,[e.unref(b).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>n(T),type:"button"},[...E[39]||(E[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Kn)):e.createCommentVNode("",!0),D+1===e.unref(b).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...E[40]||(E[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[E[44]||(E[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Xn,[e.createElementVNode("table",Zn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[42]||(E[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":E[13]||(E[13]=T=>e.unref(m).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...E[43]||(E[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":E[14]||(E[14]=T=>e.unref(m).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",vn,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:E[15]||(E[15]=T=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:E[16]||(E[16]=T=>s(!0)),type:"button"},[...E[48]||(E[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},tr={class:"block"},lr={key:0,class:"text-pink lh-base mt-4"},or={class:"mt-4"},nr={class:"table align-middle gray-table"},rr={class:"text-center"},ar={key:0,width:"180"},sr={class:"text-center"},dr={key:0},cr=["innerHTML"],ir=["href"],mr={key:0,class:"text-center"},pr={key:0},Vr={key:1,class:"text-pink"},fr={key:1,class:"tag-group mt-2 gap-1"},Nr={key:0,class:"tag tag-green-light"},Er=["download","href"],br=["onClick"],gr={class:"mt-4"},yr={class:"table align-middle gray-table side-table"},kr={key:0,class:"block-bottom bg-light-teal"},ur=["disabled"],hr={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=3&id=${y.id}`,Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),m=e.ref(),V=e.computed(()=>c.value.some(i=>!i.Optional&&!i.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("culture",l.value.Status,5)),o=e.ref({}),l=e.ref({}),d=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(i.Multiple?a.Name:`${i.Title}.pdf`)})},b=A.download,g=B,_=()=>{rxjs.forkJoin([A.culture("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=c.value.filter(u=>{var N;return!((N=u.Excludes)!=null&&N.includes(l.value.OrgCategory))}),l.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/CUL/5.海洋委員會補助計畫著作權授權同意書.docx",Files:[]}),c.value.forEach(u=>{u.Files=a.Attachments.filter(N=>N.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(N=>!N.Deleted).length)}),j().init("culture",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},h=i=>{var u,N;if(o.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,s)=>n.concat(s.Files),[]),Before:(u=m.value)==null?void 0:u.Form5Before,After:(N=m.value)==null?void 0:N.Form5After,Submit:i?"true":"false"};A.culture("saveAttachment",a).subscribe(()=>{i?g("next"):_()})},f=()=>{if(m.value){const i={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,M(m.value,i))}return!Object.keys(o.value).length};return e.onMounted(_),e.provide("editable",r),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",tr,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",lr,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",or,[e.createElementVNode("table",nr,[e.createElementVNode("thead",rr,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",ar,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",sr,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",dr,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(u,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,cr)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ir)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",mr,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",pr,"已上傳")):(e.openBlock(),e.createElementBlock("span",Vr,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>d(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",fr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Nr,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(b)(t.Path)},e.toDisplayString(t.Name),9,Er),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,br)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",gr,[e.createElementVNode("table",yr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(m).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",kr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>h(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,ur)])):e.createCommentVNode("",!0)],64)}}},xr={class:"block"},$r={class:"mt-4"},Br={class:"table-responsive mt-3 mb-0"},_r={class:"table align-middle gray-table"},Cr={class:"text-end"},Tr={class:"text-end"},wr={class:"table-responsive"},Dr={class:"table align-middle gray-table"},Sr=["colspan"],Ar={key:0,width:"1"},Fr={key:0},Ur={class:"d-flex gap-2"},Pr=["onClick"],Mr={class:"mt-4"},Ir={class:"table-responsive mt-3 mb-0"},jr={class:"table align-middle gray-table"},Or={key:0,width:"1"},Lr={class:"text-end"},Rr={key:0},qr={class:"d-flex gap-2"},zr=["onClick"],Gr={class:"mt-4"},Jr={class:"table align-middle gray-table side-table"},Yr={key:0,class:"block-bottom bg-light-teal"},Qr={class:"text-center"},Hr={class:"mb-5"},Wr={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("culture",l.value.Status,3)),V=e.ref({}),r=e.computed(()=>g.value.filter(E=>!E.Deleted)),o=e.computed(()=>_.value.filter(E=>!E.Deleted)),l=e.ref({}),d=e.ref([]),b=e.ref(),g=e.ref([]),_=e.ref([]),h=e.ref({}),f=e.ref(0),i=()=>g.value.push({}),a=()=>_.value.push({ItemID:0}),u=B,N=()=>{rxjs.forkJoin([A.culture("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(E=>{const k=E[0];l.value=k.Project,g.value=k.OtherSubsidies,_.value=k.BudgetPlans,d.value=k.Items,h.value=k.GrantTargetSetting,_.value.length||a(),j().init("culture",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},n=E=>E.Deleted=!0,s=E=>E.Deleted=!0,p=(E,k)=>{var C,S;if(V.value={},E&&!t()){e.nextTick(()=>{var P;return(P=document.querySelector(".invalid"))==null?void 0:P.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!k&&l.value.ApplyAmount>h.value.GrantLimit*1e4){b.value.show(()=>p(E,!0));return}const w={Project:l.value,OtherSubsidies:g.value,BudgetPlans:_.value,Before:(C=c.value)==null?void 0:C.Form3Before,After:(S=c.value)==null?void 0:S.Form3After,Submit:E?"true":"false"};A.culture("saveFunding",w).subscribe(()=>{E?u("next"):N()})},t=()=>{let E={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(l.value,E),E={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},r.value.forEach((k,w)=>Object.assign(V.value,M(k,E,`other-${w}-`))),E={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((k,w)=>Object.assign(V.value,M(k,E,`plan-${w}-`))),c.value&&(E={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(c.value,E))),!Object.keys(V.value).length};return e.onMounted(N),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=g.value.reduce((E,k)=>E+(k.Deleted?0:q(k.Amount)),0),f.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),_.value.forEach(E=>E.sum=q(E.Amount)+q(E.OtherAmount))}),(E,k)=>{var D;const w=e.resolveComponent("input-integer"),C=e.resolveComponent("input-text"),S=e.resolveComponent("input-select"),P=e.resolveComponent("input-textarea"),F=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",xr,[k[25]||(k[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",$r,[e.createElementVNode("div",Br,[e.createElementVNode("table",_r,[k[6]||(k[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(l).ApplyAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(l).SelfAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",Cr,e.toDisplayString((D=e.unref(l).OtherAmount)==null?void 0:D.toLocaleString()),1),e.createElementVNode("td",Tr,e.toDisplayString(e.unref(f).toLocaleString()),1)])])])]),k[12]||(k[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",wr,[e.createElementVNode("table",Dr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Sr)]),e.createElementVNode("tr",null,[k[7]||(k[7]=e.createElementVNode("th",{width:"1"},null,-1)),k[8]||(k[8]=e.createElementVNode("th",null,"單位名稱",-1)),k[9]||(k[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Ar,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(U,I)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,e.toDisplayString(I+1),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(V)[`other-${I}-Unit`],modelValue:U.Unit,"onUpdate:modelValue":O=>U.Unit=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`other-${I}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Fr,[e.createElementVNode("div",Ur,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:O=>n(U),type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Pr)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...k[11]||(k[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),k[26]||(k[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Mr,[e.createElementVNode("div",Ir,[e.createElementVNode("table",jr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[k[13]||(k[13]=e.createElementVNode("th",null,"重要工作項目",-1)),k[14]||(k[14]=e.createElementVNode("th",null,"預算項目",-1)),k[15]||(k[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),k[16]||(k[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),k[17]||(k[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),k[18]||(k[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Or,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,I)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(V)[`plan-${I}-ItemID`],options:e.unref(d),"text-name":"Title","value-name":"ID",modelValue:U.ItemID,"onUpdate:modelValue":O=>U.ItemID=O},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(V)[`plan-${I}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`plan-${I}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`plan-${I}-OtherAmount`],modelValue:U.OtherAmount,"onUpdate:modelValue":O=>U.OtherAmount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Lr,e.toDisplayString(U.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(V)[`plan-${I}-Description`],rows:"1",modelValue:U.Description,"onUpdate:modelValue":O=>U.Description=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Rr,[e.createElementVNode("div",qr,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>s(U),type:"button"},[...k[19]||(k[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,zr)):e.createCommentVNode("",!0),I+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...k[20]||(k[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),k[21]||(k[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[24]||(k[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Gr,[e.createElementVNode("table",Jr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(F,null,{default:e.withCtx(()=>[...k[22]||(k[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(c).Form3Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(F,null,{default:e.withCtx(()=>[...k[23]||(k[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(c).Form3After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Yr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>p()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>p(!0)),type:"button"},[...k[27]||(k[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:b},{default:e.withCtx(()=>[e.createElementVNode("div",Qr,[k[28]||(k[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Hr,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(h).GrantLimit)+"萬",1),k[29]||(k[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),k[30]||(k[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Kr={class:"block"},Xr={key:0,class:"text-pink lh-base mt-3"},Zr={class:"border"},vr={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},ea={class:"d-flex gap-2 align-items-center flex-grow-1"},ta={class:"text-nowrap"},la={class:"flex-grow-1"},oa={class:"d-flex gap-2"},na=["onClick"],ra=["href"],aa=["id"],sa={class:"table align-middle gray-table side-table mb-0"},da={class:"mt-4"},ca={class:"table align-middle gray-table side-table"},ia={key:0,class:"block-bottom bg-light-teal"},ma={__name:"Other",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("culture",r.value.Status,4)),V=e.ref({}),r=e.ref({}),o=e.ref([]),l=e.computed(()=>o.value.filter(i=>!i.Deleted)),d=()=>o.value.push({}),b=B,g=()=>{rxjs.forkJoin([A.culture("getRelatedProject",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];r.value=a.Project,o.value=a.Projects,j().init("culture",r.value),c.value=r.value.changeApply,r.value.changeApply=void 0})},_=i=>i.Deleted=!0,h=i=>{var u,N;if(V.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Projects:o.value,Before:(u=c.value)==null?void 0:u.Form4Before,After:(N=c.value)==null?void 0:N.Form4After,Submit:i?"true":"false"};A.culture("saveRelatedProject",a).subscribe(()=>{i?b("next"):g()})},f=()=>{let i={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return l.value.forEach((a,u)=>Object.assign(V.value,M(a,i,`project-${u}-`))),c.value&&(i={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(V.value,M(c.value,i))),!Object.keys(V.value).length};return e.onMounted(g),e.provide("editable",m),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-text"),n=e.resolveComponent("input-integer"),s=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Kr,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("p",Xr," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(p,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:p},[e.createElementVNode("div",Zr,[e.createElementVNode("div",vr,[e.createElementVNode("div",ea,[e.createElementVNode("label",ta,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[4]||(a[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",la,[e.createVNode(N,{error:e.unref(V)[`project-${t}-Title`],modelValue:p.Title,"onUpdate:modelValue":E=>p.Title=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",oa,[e.unref(m)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(E=>_(p),["prevent"]),href:"#"},"刪除",8,na)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,ra)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",sa,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[5]||(a[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"text-start w-auto",error:e.unref(V)[`project-${t}-Year`],modelValue:p.Year,"onUpdate:modelValue":E=>p.Year=E},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[6]||(a[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(V)[`project-${t}-OrgName`],modelValue:p.OrgName,"onUpdate:modelValue":E=>p.OrgName=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[7]||(a[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"w-auto",error:e.unref(V)[`project-${t}-Amount`],modelValue:p.Amount,"onUpdate:modelValue":E=>p.Amount=E},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[8]||(a[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(V)[`project-${t}-Description`],rows:"4",modelValue:p.Description,"onUpdate:modelValue":E=>p.Description=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[9]||(a[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(V)[`project-${t}-Benefit`],rows:"4",modelValue:p.Benefit,"onUpdate:modelValue":E=>p.Benefit=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,aa)])]))),128)),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:d,type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",da,[e.createElementVNode("table",ca,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(V).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":a[0]||(a[0]=p=>e.unref(c).Form4Before=p),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(V).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":a[1]||(a[1]=p=>e.unref(c).Form4After=p),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",ia,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=p=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=p=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},pa={class:"block"},Va={class:"square-title"},fa={class:"text-teal fw-bold py-3"},Na={class:"table-responsive mb-0"},Ea={class:"table align-middle gray-table"},ba={class:"text-end"},ga={class:"text-end"},ya={class:"text-end"},ka={class:"text-teal fw-bold pb-3"},ua={class:"text-teal fw-bold pb-3"},ha={class:"mt-4"},xa={class:"table align-middle gray-table"},$a={class:"text-center"},Ba={key:0,width:"180"},_a={class:"text-center"},Ca=["href"],Ta={key:0,class:"text-center"},wa={key:0},Da={key:1,class:"text-pink"},Sa={key:1,class:"tag-group mt-2 gap-1"},Aa={key:0,class:"tag tag-green-light"},Fa=["download","href"],Ua=["onClick"],Pa={class:"block-bottom bg-light-teal"},Ma=["disabled"],Ia={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>c.value<=0||_.value.some(N=>!N.Files.filter(n=>!n.Deleted).length)),V=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var N;return((N=l.value)==null?void 0:N.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),b=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(c.value*100/d.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>r.value?Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:12,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),h=(N,n)=>{n.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:n.Path,Name:`${d.value.ProjectID}_第一期請款_${N.Title}.pdf`})},f=A.download,i=B,a=()=>{A.culture("getPayment",{ID:y.id}).subscribe(N=>{d.value=N.Project,j().init("culture",d.value),_.value=_.value.filter(n=>{var s;return!((s=n.Excludes)!=null&&s.includes(d.value.OrgCategory))}),_.value.forEach(n=>{n.Files=N.Attachments.filter(s=>s.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(s=>!s.Deleted).length)}),l.value=N.Payments.find(n=>n.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=Math.round(d.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),Y().init(l.value)})},u=N=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((s,p)=>s.concat(p.Files),[]),Submit:N?"true":"false"};A.culture("savePayment",n).subscribe(()=>{N?i("next"):a()})};return e.onMounted(a),e.provide("editable",V),(N,n)=>{var E;const s=e.resolveComponent("input-integer"),p=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",pa,[e.createElementVNode("h5",Va,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",fa,"核定經費: "+e.toDisplayString((E=e.unref(d).ApprovedAmount)==null?void 0:E.toLocaleString())+"元",1),e.createElementVNode("div",Na,[e.createElementVNode("table",Ea,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",ba,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(s,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",ga,e.toDisplayString(e.unref(b))+"%",1),e.createElementVNode("td",ya,e.toDisplayString(e.unref(g)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",ka,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",ua,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",ha,[e.createElementVNode("table",xa,[e.createElementVNode("thead",$a,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Ba,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,w)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",_a,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(V)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ca)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Ta,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",wa,"已上傳")):(e.openBlock(),e.createElementBlock("span",Da,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>h(k,C)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",Sa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Aa,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(f)(C.Path)},e.toDisplayString(C.Name),9,Fa),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>C.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Ua)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Pa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>u(!0)),disabled:e.unref(m),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ma)])],64)}}},ja={class:"block"},Oa={class:"square-title"},La={class:"text-teal fw-bold py-3"},Ra={class:"text-teal fw-bold pb-3"},qa={class:"table-responsive mb-0"},za={class:"table align-middle gray-table"},Ga={class:"text-end"},Ja={class:"text-end"},Ya={class:"text-end"},Qa={class:"text-end"},Ha={class:"text-teal fw-bold pb-3"},Wa={class:"text-teal fw-bold pb-3"},Ka={class:"mt-4"},Xa={class:"table align-middle gray-table"},Za={class:"text-center"},va={key:0,width:"180"},es={class:"text-center"},ts=["href"],ls={key:0,class:"text-center"},os={key:0},ns={key:1,class:"text-pink"},rs={key:1,class:"tag-group mt-2 gap-1"},as={key:0,class:"tag tag-green-light"},ss=["download","href"],ds=["onClick"],cs={class:"block-bottom bg-light-teal"},is=["disabled"],ms={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>c.value<=0||i.value.some(p=>!p.Files.filter(t=>!t.Deleted).length)),V=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var p;return((p=l.value)==null?void 0:p.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref(0),b=e.ref(0),g=e.ref({}),_=e.computed(()=>g.value.ApprovedAmount?Math.min(Math.round(c.value*100/g.value.ApprovedAmount*100)/100,100):0),h=e.computed(()=>f.value?Math.round(c.value*100/f.value*100)/100:0),f=e.computed(()=>b.value+(r.value?l.value.CurrentActualPaidAmount:0)),i=e.ref([{Type:21,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:22,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:23,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:24,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),a=(p,t)=>{t.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:t.Path,Name:`${g.value.ProjectID}_第二期請款_${p.Title}.pdf`})},u=A.download,N=B,n=()=>{A.culture("getPayment",{ID:y.id}).subscribe(p=>{g.value=p.Project,j().init("culture",g.value),i.value=i.value.filter(E=>{var k;return!((k=E.Excludes)!=null&&k.includes(g.value.OrgCategory))}),i.value.forEach(E=>{E.Files=p.Attachments.filter(k=>k.Type===E.Type),E.Uploaded=e.computed(()=>E.Files.filter(k=>!k.Deleted).length)}),l.value=p.Payments.find(E=>E.Stage===2),l.value&&(c.value=l.value.TotalSpentAmount),o.value=g.value.ApprovedAmount;const t=p.Payments.filter(E=>E.Stage<2&&E.Status==="通過");d.value=t.reduce((E,k)=>E+k.CurrentRequestAmount,0),b.value=t.reduce((E,k)=>E+k.CurrentActualPaidAmount,0),Y().init(l.value,b.value)})},s=p=>{const t={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:i.value.reduce((E,k)=>E.concat(k.Files),[]),Submit:p?"true":"false"};A.culture("savePayment",t).subscribe(()=>{p?N("next"):n()})};return e.onMounted(n),e.provide("editable",V),(p,t)=>{var C;const E=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ja,[e.createElementVNode("h5",Oa,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",La,"核定經費: "+e.toDisplayString((C=e.unref(g).ApprovedAmount)==null?void 0:C.toLocaleString())+"元",1),e.createElementVNode("p",Ra,"賸餘款: "+e.toDisplayString((e.unref(g).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",qa,[e.createElementVNode("table",za,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Ga,e.toDisplayString(e.unref(c)-e.unref(d)),1),e.createElementVNode("td",Ja,e.toDisplayString(e.unref(b)),1),e.createElementVNode("td",null,[e.createVNode(E,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":t[0]||(t[0]=S=>e.isRef(c)?c.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Ya,e.toDisplayString(e.unref(_))+"%",1),e.createElementVNode("td",Qa,e.toDisplayString(e.unref(h))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Ha,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Wa,"累積實際撥款: "+e.toDisplayString(e.unref(f).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Ka,[e.createElementVNode("table",Xa,[e.createElementVNode("thead",Za,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",va,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(S,P)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",es,e.toDisplayString(P+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(V)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ts)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",ls,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",os,"已上傳")):(e.openBlock(),e.createElementBlock("span",ns,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!S.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:F=>a(S,F)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",rs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,F=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:F},[F.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",as,[e.createElementVNode("a",{class:"tag-link my-1",download:F.Name,href:e.unref(u)(F.Path)},e.toDisplayString(F.Name),9,ss),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>F.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ds)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",cs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=S=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=S=>s(!0)),disabled:e.unref(m),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,is)])],64)}}},ps={class:"block rounded-top-4"},Vs={class:"horizontal-scrollable"},fs={class:"timeline"},Ns={class:"year"},Es={class:"month"},bs=["onClick"],gs={class:"square-title"},ys={class:"table-responsive mt-4"},ks={class:"table align-middle gray-table"},us={class:"text-end"},hs={class:"table-responsive"},xs={class:"table align-middle gray-table"},$s={class:"text-end"},Bs={key:0,class:"invalid mt-0"},_s={class:"mt-3"},Cs={class:"mt-3"},Ts=["rowspan"],ws={key:0,class:"block-bottom bg-light-teal"},Ds={__name:"Progress",props:{id:{type:[Number,String]}},setup(x){const B=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],y=x,c=e.ref(),m=e.ref({}),V=e.ref(0),r=e.ref({}),o=e.ref([]),l=e.ref({}),d=e.computed(()=>Math.round((V.value+o.value.filter(a=>a.Status===3).length)*100/b.value.length*10)/10),b=e.ref([]),g=e.ref([]),_=a=>{c.value=a,h()},h=()=>{A.culture("getMonthlyProgress",{ID:y.id,Year:c.value.year-1911,Month:c.value.month}).subscribe(a=>{const u=a.Logs,N=a.Items,n=a.Steps;let s=!1;V.value=0,l.value=a.Progress,b.value=a.Schedules,o.value=[],g.value.forEach(p=>{p.months.forEach(t=>{s||(t===c.value&&(s=!0),b.value.forEach(E=>{var k,w;if(E.Month===t.month)if(s||E.Status!==3){const C=u.find(S=>S.ScheduleID===E.ID)||{ScheduleID:E.ID,Status:E.Status};o.value.push(Object.assign(C,{Year:p.year,Month:E.Month,ItemTitle:(k=N.find(S=>S.ID===E.ItemID))==null?void 0:k.Title,Type:E.Type,StepTitle:(w=n.find(S=>S.ID===E.StepID))==null?void 0:w.Title}))}else V.value++}))})})})},f=a=>{if(m.value={},a&&!i()){e.nextTick(()=>{var N;return(N=document.querySelector(".invalid"))==null?void 0:N.scrollIntoView({behavior:"smooth",block:"center"})});return}const u={ID:l.value.ID,Description:l.value.Description||"",Status:a?1:0,Logs:o.value.map(N=>({ID:N.ID||0,ScheduleID:N.ScheduleID,Status:N.Status,DelayReason:N.DelayReason||"",ImprovedWay:N.ImprovedWay||""}))};A.culture("saveMonthlyProgress",u).subscribe(N=>{N&&(window.location.href="../inprogressList.aspx")})},i=()=>{let a={Description:"實際工作執行情形"};return m.value=M(l.value,a),o.value.forEach((u,N)=>{a={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(u.Status)&&(a.DelayReason="落後原因",a.ImprovedWay="改善措施"),Object.assign(m.value,M(u,a,`item-${N}-`))}),!Object.keys(m.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.culture("getApplication",{ID:y.id}),A.culture("getSubmitedMonthlyProgress",{ID:y.id})]).subscribe(a=>{r.value=a[0].Project,j().init("culture",r.value);const u=new Date(r.value.StartTime),N=new Date(r.value.EndTime),n=Date.now();for(;;){const t=u.getFullYear(),E=u.getMonth(),k={year:t,month:E+1,disabled:new Date(t,E,20).getTime()>n};let w=g.value.find(C=>C.year===t);if(w?w.months.push(k):g.value.push({year:t,months:[k]}),t*100+E>=N.getFullYear()*100+N.getMonth())break;u.setMonth(E+1)}let s=!1;const p=a[1].List;g.value.forEach(t=>{t.months.forEach(E=>{!s&&!p.some(k=>k.Year===E.year-1911&&k.Month===E.month)&&(s=!0,_(E))})}),s||_(g.value[0].months[0])})}),(a,u)=>{const N=e.resolveComponent("input-textarea"),n=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ps,[e.createElementVNode("div",Vs,[u[3]||(u[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",fs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),s=>(e.openBlock(),e.createElementBlock("li",{key:s},[e.createElementVNode("span",Ns,e.toDisplayString(s.year-1911)+"年",1),e.createElementVNode("ul",Es,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.months,p=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(c)===p,disabled:p.disabled}),key:p},[e.createElementVNode("a",{onClick:t=>_(p),href:"javascript:void(0)"},e.toDisplayString(p.month)+"月",9,bs)],2))),128))])]))),128))]),u[4]||(u[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",gs,e.toDisplayString(e.unref(c).year-1911)+"年"+e.toDisplayString(e.unref(c).month)+"月 實際進度",1),e.createElementVNode("div",ys,[e.createElementVNode("table",ks,[u[5]||(u[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",us,e.toDisplayString(e.unref(c).year-1911)+"年"+e.toDisplayString(e.unref(c).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(m).Description,rows:"4",modelValue:e.unref(l).Description,"onUpdate:modelValue":u[0]||(u[0]=s=>e.unref(l).Description=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",hs,[e.createElementVNode("table",xs,[u[8]||(u[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("th",$s,e.toDisplayString(s.Year-1911)+"年"+e.toDisplayString(s.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(s.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(s.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(s.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(n,{options:B,modelValue:s.Status,"onUpdate:modelValue":t=>s.Status=t},null,8,["modelValue","onUpdate:modelValue"]),e.unref(m)[`item-${p}-Status`]?(e.openBlock(),e.createElementBlock("div",Bs,e.toDisplayString(e.unref(m)[`item-${p}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(s.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",_s,[u[6]||(u[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(N,{error:e.unref(m)[`item-${p}-DelayReason`],rows:"1",modelValue:s.DelayReason,"onUpdate:modelValue":t=>s.DelayReason=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Cs,[u[7]||(u[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(N,{error:e.unref(m)[`item-${p}-ImprovedWay`],rows:"1",modelValue:s.ImprovedWay,"onUpdate:modelValue":t=>s.ImprovedWay=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),p?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(o).length},e.toDisplayString(e.unref(d))+"% ",9,Ts))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",ws,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:u[1]||(u[1]=s=>f()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:u[2]||(u[2]=s=>f(!0)),type:"button"},[...u[9]||(u[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ss={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:B,type:"culture"})}}},oe=(x,B)=>{const y=x.__vccOpts||x;for(const[c,m]of B)y[c]=m;return y},As={class:"block"},Fs={class:"mt-4"},Us={class:"table align-middle gray-table side-table"},Ps={key:0,class:"d-flex align-items-center gap-2"},Ms={class:"input-group w-auto"},Is={class:"text-teal-dark"},js={key:1,class:"invalid mt-0"},Os={class:"square-title mt-4"},Ls={class:"mt-4"},Rs=["onClick"],qs={class:"d-flex flex-column gap-2"},zs={class:"mt-4 d-flex flex-column gap-2"},Gs={class:"d-flex flex-column gap-3 mt-4"},Js={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Ys={class:"d-flex gap-2 align-items-center flex-grow-1"},Qs={class:"text-nowrap"},Hs={class:"flex-grow-1"},Ws={class:"d-flex gap-2"},Ks=["onClick"],Xs=["href"],Zs=["id"],vs={class:"table align-middle gray-table side-table mb-0"},ed={class:"p-0"},td={class:"item-list"},ld={class:"mt-2 align-self-start text-center"},od={class:"input-group"},nd={key:0,class:"invalid mt-0"},rd={key:0,class:"d-flex gap-2 mt-1 align-self-start"},ad=["onClick"],sd=["onClick"],dd={class:"row"},cd={class:"col"},id=["value"],md={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},pd=["onClick"],Vd=["onClick"],fd={class:"col"},Nd=["value"],Ed={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},bd=["onClick"],gd=["onClick"],yd=["onClick"],kd={class:"mt-4"},ud={class:"table align-middle gray-table side-table"},hd={key:0,class:"block-bottom bg-light-teal"},xd=oe({__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("culture",l.value.Status,2)),V=e.computed(()=>b.value.EndDate),r=e.ref({}),o=e.computed(()=>d.value.filter(E=>!E.Deleted)),l=e.ref({}),d=e.ref([]),b=e.ref({}),g=()=>{A.culture("createGoal",{ID:y.id}).subscribe(E=>{d.value.push(Object.assign(E,{Items:[]}));const k=d.value[d.value.length-1];_(k)})},_=E=>{A.culture("createGoalItem",{ID:y.id,GoalID:E.ID}).subscribe(k=>{E.Items.push(Object.assign(k,{Steps:[],Schedules:[]}));const w=E.Items[E.Items.length-1];f(w),f(w),f(w),h(w,1),h(w,2)})},h=(E,k)=>A.culture("createGoalSchedule",{ID:y.id,ItemID:E.ID,Type:k}).subscribe(w=>E.Schedules.push(w)),f=E=>A.culture("createGoalStep",{ID:y.id,ItemID:E.ID}).subscribe(k=>E.Steps.push(k)),i=B,a=()=>{rxjs.forkJoin([A.culture("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(E=>{const k=E[0];l.value=k.Project,d.value=k.Goals,b.value=k.GrantType,d.value.length||g(),j().init("culture",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},u=E=>E.Deleted=!0,N=E=>E.Deleted=!0,n=E=>E.Deleted=!0,s=E=>E.Deleted=!0,p=E=>{var w,C;if(r.value={},E&&!t()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const k={Project:l.value,Goals:d.value,Before:(w=c.value)==null?void 0:w.Form2Before,After:(C=c.value)==null?void 0:C.Form2After,Submit:E?"true":"false"};A.culture("saveWorkSchedule",k).subscribe(()=>{E?i("next"):a()})},t=()=>{let E={StartTime:"計畫期程",EndTime:"計畫期程"};r.value=M(l.value,E);const k={Title:"計畫目標",Content:"預期效益"},w={Title:"重要工作項目",Indicator:"績效指標"},C={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},S={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return d.value.filter(P=>!P.Deleted).forEach((P,F)=>{Object.assign(r.value,M(P,k,`goal-${F}-`)),P.Items.filter(T=>!T.Deleted).forEach((T,D)=>{Object.assign(r.value,M(T,w,`item-${F}-${D}-`)),T.Steps.filter(U=>!U.Deleted).forEach((U,I)=>Object.assign(r.value,M(U,C,`step-${F}-${D}-${I}-`))),T.Schedules.filter(U=>U.Type===1&&!U.Deleted).forEach((U,I)=>Object.assign(r.value,M(U,S,`schedule-${F}-${D}-1-${I}-`))),T.Schedules.filter(U=>U.Type===2&&!U.Deleted).forEach((U,I)=>Object.assign(r.value,M(U,S,`schedule-${F}-${D}-2-${I}-`)))})}),c.value&&(E={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(r.value,M(c.value,E))),!Object.keys(r.value).length};return e.onMounted(a),e.provide("editable",m),(E,k)=>{const w=e.resolveComponent("required-label"),C=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),P=e.resolveComponent("input-text"),F=e.resolveComponent("input-textarea"),T=e.resolveComponent("input-month"),D=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",As,[k[30]||(k[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Fs,[e.createElementVNode("table",Us,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[6]||(k[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Ps,[e.createElementVNode("div",Ms,[e.createVNode(C,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(l).StartTime,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(l).StartTime=U)},null,8,["max-date","modelValue"]),k[7]||(k[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(l).EndTime,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(l).EndTime=U)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Is,[k[8]||(k[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(V)},null,8,["value"]),k[9]||(k[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(r).StartTime||e.unref(r).EndTime?(e.openBlock(),e.createElementBlock("div",js,e.toDisplayString(e.unref(r).StartTime||e.unref(r).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",Os,[k[11]||(k[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:g,type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Ls,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,I)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:U},[e.unref(m)&&e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:O=>u(U),type:"button"},"刪除",8,Rs)):e.createCommentVNode("",!0),e.createElementVNode("div",qs,[k[12]||(k[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(P,{error:e.unref(r)[`goal-${I}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",zs,[k[13]||(k[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(F,{error:e.unref(r)[`goal-${I}-Content`],rows:"4",modelValue:U.Content,"onUpdate:modelValue":O=>U.Content=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(U.Items.filter(O=>!O.Deleted),(O,G)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:O},[e.createElementVNode("div",Js,[e.createElementVNode("div",Ys,[e.createElementVNode("label",Qs,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[14]||(k[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",Hs,[e.createVNode(P,{error:e.unref(r)[`item-${I}-${G}-Title`],modelValue:O.Title,"onUpdate:modelValue":L=>O.Title=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Ws,[e.unref(m)&&U.Items.filter(L=>!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(L=>N(O),["prevent"]),href:"#"},"刪除",8,Ks)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${G}`,role:"button"},"收合",8,Xs)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${G}`},[e.createElementVNode("table",vs,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[15]||(k[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",ed,[e.createElementVNode("ul",td,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Steps.filter(L=>!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(m)}]),key:L},[e.createElementVNode("div",ld,e.toDisplayString(String.fromCharCode(65+J)),1),e.createElementVNode("div",null,[e.createVNode(P,{error:e.unref(r)[`step-${I}-${G}-${J}-Title`],placeholder:"如:進行口訪紀錄",modelValue:L.Title,"onUpdate:modelValue":R=>L.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",od,[e.createVNode(T,{"empty-value":0,modelValue:L.Begin,"onUpdate:modelValue":R=>L.Begin=R},null,8,["modelValue","onUpdate:modelValue"]),k[16]||(k[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(T,{"empty-value":0,modelValue:L.End,"onUpdate:modelValue":R=>L.End=R},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(r)[`step-${I}-${G}-${J}-Begin`]||e.unref(r)[`step-${I}-${G}-${J}-End`]?(e.openBlock(),e.createElementBlock("div",nd,e.toDisplayString(e.unref(r)[`step-${I}-${G}-${J}-Begin`]||e.unref(r)[`step-${I}-${G}-${J}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",rd,[O.Steps.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>s(L),type:"button"},[...k[17]||(k[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ad)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>f(O),type:"button"},[...k[18]||(k[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,sd)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[19]||(k[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(r)[`item-${I}-${G}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:O.Indicator,"onUpdate:modelValue":L=>O.Indicator=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[20]||(k[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",dd,[e.createElementVNode("div",cd,[k[23]||(k[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===1&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?3:4}`])},[e.createVNode(T,{error:e.unref(r)[`schedule-${I}-${G}-1-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?7:8}`])},[e.createVNode(D,{"empty-value":0,error:e.unref(r)[`schedule-${I}-${G}-1-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:X})=>[e.createElementVNode("option",{value:X.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(X.Title),9,id)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(m)?(e.openBlock(),e.createElementBlock("div",md,[O.Schedules.filter(R=>R.Type===1&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>n(L),type:"button"},[...k[21]||(k[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pd)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>h(O,1),type:"button"},[...k[22]||(k[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Vd)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",fd,[k[26]||(k[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===2&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?3:4}`])},[e.createVNode(T,{error:e.unref(r)[`schedule-${I}-${G}-2-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?7:8}`])},[e.createVNode(D,{"empty-value":0,error:e.unref(r)[`schedule-${I}-${G}-2-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:X})=>[e.createElementVNode("option",{value:X.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(X.Title),9,Nd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Ed,[O.Schedules.filter(R=>R.Type===2&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>n(L),type:"button"},[...k[24]||(k[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,bd)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>h(O,2),type:"button"},[...k[25]||(k[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,gd)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,Zs)]))),128))]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:O=>_(U),type:"button"},"新增工作項目",8,yd)):e.createCommentVNode("",!0)]))),128))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[29]||(k[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",kd,[e.createElementVNode("table",ud,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[27]||(k[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(r).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(c).Form2Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...k[28]||(k[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(r).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(c).Form2After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",hd,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>p()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>p(!0)),type:"button"},[...k[31]||(k[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-3149c8a8"]]),$d={class:"block"},Bd={class:"mt-4"},_d={class:"table align-middle gray-table side-table"},Cd={key:0},Td={key:1,class:"text-light-gray"},wd={class:"d-flex flex-column gap-2"},Dd={key:0},Sd={class:"mt-4"},Ad={class:"table align-middle gray-table side-table"},Fd={class:"row g-3"},Ud={class:"col-12 col-xl-2"},Pd={class:"text-gray mb-2"},Md={class:"col-12 col-xl-3"},Id={class:"text-gray mb-2"},jd={key:0,class:"col-12 col-xl-4"},Od={class:"row g-1"},Ld={class:"col-7"},Rd={class:"col-5"},qd={key:1,class:"col-12 col-xl-3"},zd={class:"text-gray mb-2"},Gd={class:"mt-4"},Jd={class:"table align-middle gray-table side-table"},Yd={class:"d-flex align-items-center gap-2"},Qd={class:"input-group w-auto"},Hd={key:0,class:"invalid mt-0"},Wd={class:"mt-4"},Kd={class:"table-responsive mt-3 mb-0"},Xd={class:"table align-middle gray-table"},Zd={class:"text-end"},vd={class:"text-end"},ec={class:"text-end"},tc={class:"text-end"},lc={class:"text-end"},oc={class:"table align-middle gray-table side-table"},nc={key:0,class:"table-responsive mt-3 mb-0"},rc={class:"table align-middle gray-table"},ac={key:0},sc={key:0},dc={class:"d-flex gap-2"},cc=["onClick"],ic={class:"mt-4"},mc={class:"table align-middle gray-table side-table"},pc={key:0,class:"block-bottom bg-light-teal"},Vc={class:"text-center"},fc={class:"mb-5"},Nc={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.ref(),r=e.computed(()=>z("education",d.value.Status,1)),o=e.ref({}),l=e.computed(()=>g.value.filter(p=>!p.Deleted)),d=e.ref({}),b=e.ref(),g=e.ref([]),_=e.ref(),h=e.ref(0),f=e.computed({get:()=>!!l.value.length,set:p=>{p?i():g.value.forEach(t=>t.Deleted=!0)}}),i=()=>g.value.push({}),a=B,u=()=>{A.education("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(p=>{d.value=p.Project,V.value=p.Contacts,g.value=p.ReceivedSubsidies,d.value.OrgCategory=d.value.OrgCategory||null,j().init("education",d.value),m.value=d.value.changeApply,d.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=(p,t)=>{var k,w;if(o.value={},p&&!s()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&_.value&&d.value.ApplyAmount>_.value.GrantLimit*1e4){b.value.show(()=>n(p,!0));return}const E={Project:d.value,Contacts:V.value,ReceivedSubsidies:g.value.filter(C=>C.ID||!C.Deleted),Before:(k=m.value)==null?void 0:k.Form1Before,After:(w=m.value)==null?void 0:w.Form1After,Submit:p?"true":"false"};A.education("saveApplication",E).subscribe(C=>{p?a("next",C.ID):d.value.ID?u():window.location.href=`Application.aspx?ID=${C.ID}`})},s=()=>{let p={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return d.value.OrgCategory==="2"&&(p.RegisteredNum="立案登記證字號"),o.value=M(d.value,p),p={Name:"姓名",JobTitle:"職稱"},Object.assign(o.value,M(V.value[0],p,"contact-0-")),p.MobilePhone="手機號碼",Object.assign(o.value,M(V.value[1],p,"contact-1-")),p={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},g.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`received-${E}-`))),m.value&&(p={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,M(m.value,p))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(p=>{c.value=p[0],y.id?u():A.education("getEmptyApplication").subscribe(t=>{d.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},t),V.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("education",d.value)})})}),e.provide("editable",r),e.watch(()=>d.value.OrgCategory,()=>{A.education("getGrantTargetSetting",{TargetTypeID:`EDC${d.value.OrgCategory}`}).subscribe(p=>{_.value=p})}),e.watchEffect(()=>{h.value=q(d.value.ApplyAmount)+q(d.value.SelfAmount)+q(d.value.OtherGovAmount)+q(d.value.OtherUnitAmount)}),(p,t)=>{const E=e.resolveComponent("required-label"),k=e.resolveComponent("input-text"),w=e.resolveComponent("input-select"),C=e.resolveComponent("input-tw-date"),S=e.resolveComponent("input-textarea"),P=e.resolveComponent("input-integer"),F=e.resolveComponent("input-boolean"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$d,[t[52]||(t[52]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Bd,[e.createElementVNode("table",_d,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[20]||(t[20]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",Cd,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Td,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).ProjectName,modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":t[0]||(t[0]=D=>e.unref(d).ProjectName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",wd,[e.createElementVNode("div",null,[e.createVNode(w,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).OrgCategory,"onUpdate:modelValue":t[1]||(t[1]=D=>e.unref(d).OrgCategory=D)},null,8,["error","options","modelValue"])]),e.unref(d).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Dd,[e.createVNode(k,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(d).RegisteredNum,"onUpdate:modelValue":t[2]||(t[2]=D=>e.unref(d).RegisteredNum=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).OrgName,placeholder:"請輸入單位全銜",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":t[3]||(t[3]=D=>e.unref(d).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[26]||(t[26]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(d).TaxID,"onUpdate:modelValue":t[4]||(t[4]=D=>e.unref(d).TaxID=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[27]||(t[27]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":t[5]||(t[5]=D=>e.unref(d).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[53]||(t[53]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Sd,[e.createElementVNode("table",Ad,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(D,U)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Fd,[e.createElementVNode("div",Ud,[e.createElementVNode("div",Pd,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[28]||(t[28]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(k,{error:e.unref(o)[`contact-${U}-Name`],modelValue:D.Name,"onUpdate:modelValue":I=>D.Name=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Md,[e.createElementVNode("div",Id,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[29]||(t[29]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(k,{error:e.unref(o)[`contact-${U}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":I=>D.JobTitle=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),U?(e.openBlock(),e.createElementBlock("div",jd,[t[30]||(t[30]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Od,[e.createElementVNode("div",Ld,[e.createVNode(k,{modelValue:D.Phone,"onUpdate:modelValue":I=>D.Phone=I,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Rd,[e.createVNode(k,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":I=>D.PhoneExt=I,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),U?(e.openBlock(),e.createElementBlock("div",qd,[e.createElementVNode("div",zd,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[31]||(t[31]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(k,{error:e.unref(o)[`contact-${U}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":I=>D.MobilePhone=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),t[54]||(t[54]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Gd,[e.createElementVNode("table",Jd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[32]||(t[32]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Yd,[e.createElementVNode("div",Qd,[e.createVNode(C,{class:"w-auto",modelValue:e.unref(d).StartTime,"onUpdate:modelValue":t[6]||(t[6]=D=>e.unref(d).StartTime=D)},null,8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto",modelValue:e.unref(d).EndTime,"onUpdate:modelValue":t[7]||(t[7]=D=>e.unref(d).EndTime=D)},null,8,["modelValue"])]),t[34]||(t[34]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Hd,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[35]||(t[35]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Target,modelValue:e.unref(d).Target,"onUpdate:modelValue":t[8]||(t[8]=D=>e.unref(d).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[36]||(t[36]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":t[9]||(t[9]=D=>e.unref(d).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[37]||(t[37]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":t[10]||(t[10]=D=>e.unref(d).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[55]||(t[55]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",Wd,[t[43]||(t[43]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",Kd,[e.createElementVNode("table",Xd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Zd,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[38]||(t[38]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",vd,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[39]||(t[39]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款(元)",-1)])]),_:1})]),e.createElementVNode("th",ec,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[40]||(t[40]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",tc,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[41]||(t[41]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元) (含總收費)",-1)])]),_:1})]),t[42]||(t[42]=e.createElementVNode("th",{class:"text-end"},"計畫總經費(元)",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).ApplyAmount,modelValue:e.unref(d).ApplyAmount,"onUpdate:modelValue":t[11]||(t[11]=D=>e.unref(d).ApplyAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).SelfAmount,modelValue:e.unref(d).SelfAmount,"onUpdate:modelValue":t[12]||(t[12]=D=>e.unref(d).SelfAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).OtherGovAmount,modelValue:e.unref(d).OtherGovAmount,"onUpdate:modelValue":t[13]||(t[13]=D=>e.unref(d).OtherGovAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).OtherUnitAmount,modelValue:e.unref(d).OtherUnitAmount,"onUpdate:modelValue":t[14]||(t[14]=D=>e.unref(d).OtherUnitAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",lc,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])])]),e.createElementVNode("table",oc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[44]||(t[44]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{modelValue:e.unref(f),"onUpdate:modelValue":t[15]||(t[15]=D=>e.isRef(f)?f.value=D:null)},null,8,["modelValue"]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",nc,[e.createElementVNode("table",rc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[45]||(t[45]=e.createElementVNode("th",null,"計畫名稱",-1)),t[46]||(t[46]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",ac,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(D,U)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`received-${U}-Name`],modelValue:D.Name,"onUpdate:modelValue":I=>D.Name=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`received-${U}-Amount`],modelValue:D.Amount,"onUpdate:modelValue":I=>D.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",sc,[e.createElementVNode("div",dc,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>N(D),type:"button"},[...t[47]||(t[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,cc)):e.createCommentVNode("",!0),U+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[48]||(t[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[51]||(t[51]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ic,[e.createElementVNode("table",mc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[49]||(t[49]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":t[16]||(t[16]=D=>e.unref(m).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[50]||(t[50]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":t[17]||(t[17]=D=>e.unref(m).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",pc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[18]||(t[18]=D=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[19]||(t[19]=D=>n(!0)),type:"button"},[...t[56]||(t[56]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:b},{default:e.withCtx(()=>{var D;return[e.createElementVNode("div",Vc,[t[57]||(t[57]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",fc,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((D=e.unref(_))==null?void 0:D.GrantLimit)+"萬",1),t[58]||(t[58]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[59]||(t[59]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},Ec={class:"block"},bc={key:0,class:"text-pink lh-base mt-4"},gc={class:"mt-4"},yc={class:"table align-middle gray-table"},kc={class:"text-center"},uc={key:0,width:"180"},hc={class:"text-center"},xc={key:0},$c=["innerHTML"],Bc=["href"],_c={key:0,class:"text-center"},Cc={key:0},Tc={key:1,class:"text-pink"},wc={key:1,class:"tag-group mt-2 gap-1"},Dc={key:0,class:"tag tag-green-light"},Sc=["download","href"],Ac=["onClick"],Fc={class:"mt-4"},Uc={class:"table align-middle gray-table side-table"},Pc={key:0,class:"block-bottom bg-light-teal"},Mc=["disabled"],Ic={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=3&id=${y.id}`,Files:[]}]),m=e.ref(),V=e.computed(()=>c.value.some(i=>!i.Optional&&!i.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("education",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(i.Multiple?a.Name:`${i.Title}.pdf`)})},b=A.download,g=B,_=()=>{rxjs.forkJoin([A.education("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=c.value.filter(u=>{var N;return!((N=u.Excludes)!=null&&N.includes(l.value.OrgCategory))}),c.value.forEach(u=>{u.Files=a.Attachments.filter(N=>N.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(N=>!N.Deleted).length)}),j().init("education",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},h=i=>{var u,N;if(o.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,s)=>n.concat(s.Files),[]),Before:(u=m.value)==null?void 0:u.Form5Before,After:(N=m.value)==null?void 0:N.Form5After,Submit:i?"true":"false"};A.education("saveAttachment",a).subscribe(()=>{i?g("next"):_()})},f=()=>{if(m.value){const i={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,M(m.value,i))}return!Object.keys(o.value).length};return e.onMounted(_),e.provide("editable",r),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ec,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",bc,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如社團成立證明、社團運作證明、有效期間內之當選證書、登記證書等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",gc,[e.createElementVNode("table",yc,[e.createElementVNode("thead",kc,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",uc,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",hc,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",xc,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(u,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,$c)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Bc)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",_c,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",Cc,"已上傳")):(e.openBlock(),e.createElementBlock("span",Tc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>d(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",wc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Dc,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(b)(t.Path)},e.toDisplayString(t.Name),9,Sc),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Ac)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Fc,[e.createElementVNode("table",Uc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(m).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Pc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>h(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Mc)])):e.createCommentVNode("",!0)],64)}}},jc={class:"block"},Oc={class:"square-title"},Lc={class:"text-teal fw-bold py-3"},Rc={class:"text-teal fw-bold pb-3"},qc={class:"table-responsive mb-0"},zc={class:"table align-middle gray-table"},Gc={class:"text-end"},Jc={class:"text-end"},Yc={class:"text-end"},Qc={class:"text-teal fw-bold pb-3"},Hc={class:"text-teal fw-bold pb-3"},Wc={class:"mt-4"},Kc={class:"table align-middle gray-table"},Xc={class:"text-center"},Zc={key:0,width:"180"},vc={class:"text-center"},ei=["href"],ti={key:0,class:"text-center"},li={key:0},oi={key:1,class:"text-pink"},ni={key:1,class:"tag-group mt-2 gap-1"},ri={key:0,class:"tag tag-green-light"},ai=["download","href"],si=["onClick"],di={class:"block-bottom bg-light-teal"},ci=["disabled"],ii={__name:"Payment",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>c.value<=0||_.value.some(N=>!N.Files.filter(n=>!n.Deleted).length)),V=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var N;return((N=l.value)==null?void 0:N.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),b=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(c.value*100/d.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>r.value?Math.round(c.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"收支明細表",Template:"../../Template/EDC/1-收支明細表.docx",Files:[]},{Type:12,Title:"受補助清單",Template:"../../Template/EDC/2-受補助清單.docx",Files:[]},{Type:13,Title:"經費分攤表",Template:"../../Template/EDC/3-經費分攤表.docx",Files:[]},{Type:14,Title:"憑證",Template:"../../Template/EDC/4-憑證.docx",Files:[]},{Type:15,Title:"領據",Template:"../../Template/EDC/5-領據.docx",Files:[]}]),h=(N,n)=>{n.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:n.Path,Name:`${d.value.ProjectID}_${N.Title}.pdf`})},f=A.download,i=B,a=()=>{A.education("getPayment",{ID:y.id}).subscribe(N=>{d.value=N.Project,j().init("education",d.value),_.value=_.value.filter(n=>{var s;return!((s=n.Excludes)!=null&&s.includes(d.value.OrgCategory))}),_.value.forEach(n=>{n.Files=N.Attachments.filter(s=>s.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(s=>!s.Deleted).length)}),l.value=N.Payments.find(n=>n.Stage===1),l.value&&(c.value=l.value.TotalSpentAmount),o.value=d.value.ApprovedAmount,Y().init(l.value)})},u=N=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((s,p)=>s.concat(p.Files),[]),Submit:N?"true":"false"};A.education("savePayment",n).subscribe(()=>{N?i("next"):a()})};return e.onMounted(a),e.provide("editable",V),(N,n)=>{var E;const s=e.resolveComponent("input-integer"),p=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",jc,[e.createElementVNode("h5",Oc,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Lc,"核定經費: "+e.toDisplayString((E=e.unref(d).ApprovedAmount)==null?void 0:E.toLocaleString())+"元",1),e.createElementVNode("p",Rc,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",qc,[e.createElementVNode("table",zc,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Gc,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(s,{max:e.unref(o),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Jc,e.toDisplayString(e.unref(b))+"%",1),e.createElementVNode("td",Yc,e.toDisplayString(e.unref(g)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Qc,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Hc,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Wc,[e.createElementVNode("table",Kc,[e.createElementVNode("thead",Xc,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Zc,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,w)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",vc,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(V)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ei)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",ti,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",li,"已上傳")):(e.openBlock(),e.createElementBlock("span",oi,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>h(k,C)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",ni,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ri,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(f)(C.Path)},e.toDisplayString(C.Name),9,ai),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>C.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,si)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",di,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>u(!0)),disabled:e.unref(m),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ci)])],64)}}},mi={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:B,type:"education"})}}},pi={class:"modal-dialog modal-dialog-centered modal-md"},Vi={class:"modal-content"},fi={class:"modal-body"},Ni={class:"d-flex flex-column align-items-center mb-5 gap-3"},Ei={class:"fs-18"},bi={__name:"ErrorModal",setup(x){const B=v(),y=e.ref();return e.onMounted(()=>y.value.addEventListener("hidden.bs.modal",()=>B.error=null)),e.watch(()=>B.error,()=>{B.error&&bootstrap.Modal.getOrCreateInstance(y.value).show()}),(c,m)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:y,tabindex:"-1"},[e.createElementVNode("div",pi,[e.createElementVNode("div",Vi,[m[2]||(m[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",fi,[e.createElementVNode("div",Ni,[m[0]||(m[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",Ei,e.toDisplayString(e.unref(B).error),1)]),m[1]||(m[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},K=Q.defineStore("grant",{actions:{init(x){this.type=x}},state:()=>({type:null,typeList:[{code:"SCI",title:"科專"},{code:"CUL",title:"文化"},{code:"EDC",title:"學校／民間"},{code:"CLB",title:"學校社團"},{code:"MUL",title:"多元"},{code:"LIT",title:"素養"},{code:"ACC",title:"無障礙"}]})}),gi={key:0,class:"search bg-gray rounded-4 mt-4"},yi={class:"search-form"},ki={class:"row g-3"},ui={class:"col-12 col-lg-6"},hi={key:0,class:"rounded-4 bg-white mt-4 p-4"},xi={class:"row"},$i={class:"col-12"},Bi={class:"row"},_i={class:"col-12 col-lg-6 d-flex justify-content-between pe-4"},Ci={class:"fw-bold text-primary fs-2"},Ti={key:1,class:"rounded-4 bg-white mt-4 py-4"},wi={class:"row"},Di={class:"col-12 col-lg-4"},Si={class:"col-12 col-lg-8"},Ai={key:2,class:"row"},Fi={class:"col-12 col-lg-6 pt-4"},Ui={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Pi={class:"fw-bold text-primary fs-2"},Mi={class:"col-12 col-lg-6 pt-4"},Ii={class:"d-flex justify-content-between rounded-4 bg-white p-4"},ji={class:"fw-bold text-primary fs-2"},Oi={class:"col-12 col-lg-6 pt-4"},Li={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Ri={class:"fw-bold text-primary fs-2"},qi={class:"col-12 col-lg-6 pt-4"},zi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Gi={class:"fw-bold text-primary fs-2"},Ji={class:"rounded-4 bg-white p-4 mt-4 d-flex flex-column gap-5"},Yi={class:"mt-4"},Qi={class:"table-responsive"},Hi={class:"table align-middle gray-table"},Wi={class:"text-center"},Ki={class:"text-center"},Xi=["href"],Zi={class:"text-end"},vi={class:"text-end"},em={class:"block rounded-4 mt-4"},tm={class:"table-responsive"},lm={class:"row"},om={class:"col"},nm=["value"],rm={class:"table teal-table","aria-label":"申請計畫列表"},am={"data-th":"年度:"},sm={"data-th":"類別:",class:"text-start"},dm={"data-th":"補助計畫:"},cm={"data-th":"申請期限:"},im={"data-th":"補助對象:"},mm={"data-th":"相關檔案:"},pm=["download","href"],Vm={"data-th":"我要申請:"},fm=["href"],Nm={key:1,class:"total-list mt-4"},Em=["href"],bm={class:"total-item-title"},gm={class:"total-item-content"},ym={class:"count"},km={__name:"HomeDashboard",setup(x){const B=K().typeList,y=[{title:"申請中尚未提送",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(n=>[1,14].includes(n.Status)).length)},{title:"申請審查中",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(n=>[11,12,21,22,31,32,41,42,43,44].includes(n.Status)).length)},{title:"審查意見待回覆",url:"ApplicationChecklist.aspx",count:e.computed(()=>0)},{title:"執行中計畫",url:"inprogressList.aspx",count:e.computed(()=>c.value.filter(n=>[51,52].includes(n.Status)).length)},{title:"執行階段待回覆",url:"inprogressList.aspx",count:e.computed(()=>0)}],c=e.ref([]),m=e.ref([]),V=e.ref(),r=e.ref(),o=e.ref(""),l=e.ref([]),d=e.ref([]),b=e.ref([]),g=e.ref(),_=e.computed(()=>{let n=m.value;return o.value&&(n=n.filter(s=>s.tags.includes(o.value))),n}),h=e.computed(()=>g.value?b.value.filter(n=>n.Category===g.value):b.value),f=e.computed(()=>({ApprovedAmount:h.value.reduce((n,s)=>n+s.ApprovedAmount,0),RemainingAmount:h.value.reduce((n,s)=>n+s.ApprovedAmount-s.SpendAmount,0),SpendAmount:h.value.reduce((n,s)=>n+s.SpendAmount,0),PaymentAmount:h.value.reduce((n,s)=>n+s.PaymentAmount,0),BudgetFees:h.value.reduce((n,s)=>n+s.BudgetFees,0)})),i=A.download,a=n=>d.value.filter(s=>s.GrantTypeID===n.TypeCode).map((s,p)=>`${p+1}.${s.Note}`).join("<br>"),u=n=>{switch(n.TypeCode){case"SCI":return"SCI/SciApplication.aspx?GrantTypeID=SCI";case"CLB":return"CLB/ClbApplication.aspx?GrantTypeID=CLB";default:return`${n.TypeCode}/Application.aspx`}},N=(n,s,p=2)=>{if(s){const t=10**p;return Math.round(n*100/s*t)/t}return 0};return e.onMounted(()=>{A.system("dashboard").subscribe(n=>{m.value=n.GrantTypes,d.value=n.Settings,c.value=n.ApplyList,b.value=n.StatList,V.value=n.IsOrganizer,r.value=n.IsUser,m.value.forEach(s=>{var p;s.tags=((p=s.TargetTags)==null?void 0:p.split(`
`).map(t=>t.trim()).filter(t=>t))||[],s.tags.forEach(t=>{l.value.includes(t)||l.value.push(t)})})})}),(n,s)=>{const p=e.resolveComponent("input-select"),t=e.resolveComponent("report-pie-chart"),E=e.resolveComponent("report-mix-chart"),k=e.resolveComponent("tw-date"),w=e.resolveComponent("tooltip");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",gi,[s[19]||(s[19]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",yi,[e.createElementVNode("div",ki,[s[3]||(s[3]=e.createElementVNode("div",{class:"col-12 col-lg-6"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",{value:""},"114")])],-1)),e.createElementVNode("div",ui,[s[2]||(s[2]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"全部類別",-1)),e.createVNode(p,{"allow-empty":"",options:e.unref(B),placeholder:"全部","text-name":"title","value-name":"code",modelValue:e.unref(g),"onUpdate:modelValue":s[0]||(s[0]=C=>e.isRef(g)?g.value=C:null)},null,8,["options","modelValue"])])]),s[4]||(s[4]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",hi,[e.createElementVNode("div",xi,[e.createElementVNode("div",$i,[e.createElementVNode("div",Bi,[e.createElementVNode("div",_i,[s[6]||(s[6]=e.createElementVNode("div",{class:"fw-bold fs-4"},"總預算經費",-1)),e.createElementVNode("div",Ci,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(f).BudgetFees/1e3).toLocaleString())+" ",1),s[5]||(s[5]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])])])):e.createCommentVNode("",!0),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Ti,[e.createElementVNode("div",wi,[e.createElementVNode("div",Di,[s[7]||(s[7]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"經費執行率",-1)),e.createVNode(t,{active:"已執行",color:9323693,inactive:"未執行",percent:N(e.unref(f).SpendAmount,e.unref(f).ApprovedAmount,1),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",Si,[s[8]||(s[8]=e.createElementVNode("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e.createElementVNode("span",{class:"fs-4 fw-bold"},"各類經費執行情形")],-1)),s[9]||(s[9]=e.createElementVNode("div",{class:"fs-6 text-end text-secondary me-5"},"單位：千元",-1)),e.unref(b).length?(e.openBlock(),e.createBlock(E,{key:0,list:e.unref(b),style:{width:"100%",height:"300px"}},null,8,["list"])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Ai,[e.createElementVNode("div",Fi,[e.createElementVNode("div",Ui,[s[11]||(s[11]=e.createElementVNode("div",{class:"fw-bold fs-4"},"核定補助經費",-1)),e.createElementVNode("div",Pi,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(f).ApprovedAmount/1e3).toLocaleString())+" ",1),s[10]||(s[10]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Mi,[e.createElementVNode("div",Ii,[s[13]||(s[13]=e.createElementVNode("div",{class:"fw-bold fs-4"},"賸餘款",-1)),e.createElementVNode("div",ji,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(f).RemainingAmount/1e3).toLocaleString())+" ",1),s[12]||(s[12]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Oi,[e.createElementVNode("div",Li,[s[15]||(s[15]=e.createElementVNode("div",{class:"fw-bold fs-4"},"實支金額",-1)),e.createElementVNode("div",Ri,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(f).SpendAmount/1e3).toLocaleString())+" ",1),s[14]||(s[14]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",qi,[e.createElementVNode("div",zi,[s[17]||(s[17]=e.createElementVNode("div",{class:"fw-bold fs-4"},"已撥付",-1)),e.createElementVNode("div",Gi,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(f).PaymentAmount/1e3).toLocaleString())+" ",1),s[16]||(s[16]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ji,[e.createElementVNode("div",null,[e.createElementVNode("div",Yi,[e.createElementVNode("div",Qi,[e.createElementVNode("table",Hi,[s[18]||(s[18]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-center"},"類別"),e.createElementVNode("th",{class:"text-center"},"核定件數"),e.createElementVNode("th",{class:"text-end"},"核定補助經費"),e.createElementVNode("th",{class:"text-end"},"經費執行率")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),C=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",Wi,e.toDisplayString(e.unref(B).find(S=>S.code===C.Category).title),1),e.createElementVNode("td",Ki,[e.createElementVNode("a",{href:`Report/ApprovedList.aspx?category=${C.Category}`},e.toDisplayString(C.Count),9,Xi)]),e.createElementVNode("td",Zi,e.toDisplayString(C.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",vi,e.toDisplayString(N(C.SpendAmount,C.ApprovedAmount))+"%",1)]))),128))])])])])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",em,[e.createElementVNode("div",tm,[e.createElementVNode("div",lm,[e.createElementVNode("div",om,[s[21]||(s[21]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"依身分篩選適用規定",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=C=>e.isRef(o)?o.value=C:null)},[s[20]||(s[20]=e.createElementVNode("option",{value:""},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),C=>(e.openBlock(),e.createElementBlock("option",{key:C,value:C},e.toDisplayString(C),9,nm))),128))],512),[[e.vModelSelect,e.unref(o)]])])]),e.createElementVNode("table",rm,[s[24]||(s[24]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"類別"),e.createElementVNode("th",{scope:"col"},"補助計畫"),e.createElementVNode("th",{scope:"col"},"申請期限"),e.createElementVNode("th",{scope:"col"},"補助對象"),e.createElementVNode("th",{scope:"col"},"相關檔案"),e.createElementVNode("th",{scope:"col"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),C=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",am,e.toDisplayString(C.Year),1),e.createElementVNode("td",sm,e.toDisplayString(C.ShortName),1),e.createElementVNode("td",dm,e.toDisplayString(C.FullName),1),e.createElementVNode("td",cm,[e.createVNode(k,{value:C.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",im,[e.createVNode(w,{"data-bs-html":"true",title:a(C)},null,8,["title"])]),e.createElementVNode("td",mm,[C.Path?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark",download:C.Filename,href:e.unref(i)(C.Path),style:{display:"inline"}},[...s[22]||(s[22]=[e.createElementVNode("i",{class:"fas fa-file-alt"},null,-1)])],8,pm)):e.createCommentVNode("",!0)]),e.createElementVNode("td",Vm,[e.createElementVNode("a",{class:"btn btn-teal-dark",href:u(C),target:"_blank"},[...s[23]||(s[23]=[e.createElementVNode("i",{class:"fa-solid"},null,-1),e.createTextVNode("我要申請",-1)])],8,fm)])]))),128))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock("ul",Nm,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(y,C=>e.createElementVNode("li",{class:"total-item",key:C},[e.createElementVNode("a",{href:C.url},[e.createElementVNode("div",bm,e.toDisplayString(C.title),1),e.createElementVNode("div",gm,[e.createElementVNode("span",ym,e.toDisplayString(C.count),1),s[25]||(s[25]=e.createElementVNode("span",{class:"unit"},"件",-1))])],8,Em)])),64))])):e.createCommentVNode("",!0)],64)}}},um={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const B=e.useModel(x,"modelValue"),y=[{value:!0,text:"是"},{value:!1,text:"否"}];return(c,m)=>{const V=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(V,{options:y,modelValue:B.value,"onUpdate:modelValue":m[0]||(m[0]=r=>B.value=r)},null,8,["modelValue"])}}},hm=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(x,{emit:B}){const y=e.ref(),c=()=>{Array.from(y.value.files).forEach(V=>A.upload(V).subscribe(r=>m("file",r))),y.value.value=""},m=B;return(V,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:r[0]||(r[0]=o=>e.unref(y).click()),type:"button"},[...r[1]||(r[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:c,class:"d-none",ref_key:"input",ref:y,type:"file"},V.$attrs),null,16)],64))}}),xm=["disabled","placeholder","type"],$m={key:0,class:"invalid mt-0"},Bm=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},max:{type:Number},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return e.watch(y,m=>{if(m){const V=(parseInt(m)||0).toString();m.toString()!==V?y.value=V:c.max&&Number(V)>c.max&&(y.value=c.max)}}),(m,V)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:"",style:{"text-align":"right"},type:x.type},m.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=r=>y.value=r)}),null,16,xm),[[e.vModelDynamic,y.value]]),x.error?(e.openBlock(),e.createElementBlock("div",$m,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),_m={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const B=e.useModel(x,"modelValue"),y=[];for(let c=1;c<=12;c++)y.push({value:c,text:`${c}月`});return(c,m)=>{const V=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(V,{options:y,modelValue:B.value,"onUpdate:modelValue":m[0]||(m[0]=r=>B.value=r)},null,8,["modelValue"])}}},Cm=["onChange","checked","disabled","id","value"],Tm=["for"],wm={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>ae(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=m=>{y.value=m};return(m,V)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,r=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:r},[e.createElementVNode("input",{onChange:o=>c(r[x.valueName]),checked:r[x.valueName]===y.value,class:"form-check-input",disabled:!e.unref(B),id:`${x.id}-${r[x.valueName]}`,type:"radio",value:r[x.valueName]},null,40,Cm),e.createElementVNode("label",{class:"form-check-label",for:`${x.id}-${r[x.valueName]}`},e.toDisplayString(r[x.textName]),9,Tm)]))),128))}},Dm=["disabled"],Sm=["value"],Am=["value"],Fm={key:0,class:"invalid mt-0"},Um=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({allowEmpty:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue");return(c,m)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:x.disabled||!e.unref(B)},c.$attrs,{"onUpdate:modelValue":m[0]||(m[0]=V=>y.value=V)}),[x.allowEmpty||e.unref(B)&&!y.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:x.emptyValue},e.toDisplayString(x.placeholder),9,Sm)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,(V,r)=>e.renderSlot(c.$slots,"default",{key:V,index:r,option:V},()=>[e.createElementVNode("option",{value:V[x.valueName]},e.toDisplayString(V[x.textName]),9,Am)])),128))],16,Dm),[[e.vModelSelect,y.value]]),x.error?(e.openBlock(),e.createElementBlock("div",Fm,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Pm={class:"input-group"},Mm={key:0,class:"input-group-text"},Im=["disabled","placeholder","type"],jm={key:0,class:"invalid mt-0"},Om=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return c.maxLength&&e.watch(y,()=>{var m;((m=y.value)==null?void 0:m.length)>c.maxLength&&(y.value=y.value.substring(0,c.maxLength))}),(m,V)=>{const r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pm,[x.prefix?(e.openBlock(),e.createElementBlock("span",Mm,[e.createVNode(r,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:"",type:x.type},m.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=o=>y.value=o)}),null,16,Im),[[e.vModelDynamic,y.value]])]),x.error?(e.openBlock(),e.createElementBlock("div",jm,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),Lm=["disabled","placeholder"],Rm={key:0,class:"fs-14 text-gray mt-2"},qm={class:"text-pink"},zm={key:1,class:"invalid mt-0"},Gm=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return c.maxLength&&e.watch(y,()=>{var m;((m=y.value)==null?void 0:m.length)>c.maxLength&&(y.value=y.value.substring(0,c.maxLength))}),(m,V)=>{var r;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:""},m.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=o=>y.value=o)}),null,16,Lm),[[e.vModelText,y.value]]),e.unref(B)&&x.maxLength?(e.openBlock(),e.createElementBlock("div",Rm,[V[1]||(V[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",qm,e.toDisplayString(((r=y.value)==null?void 0:r.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(x.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),x.error?(e.openBlock(),e.createElementBlock("div",zm,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),Jm=["disabled","placeholder"],Ym={key:0,class:"invalid"},Qm=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean},placeholder:{default:"請輸入",type:String}},emits:["update:modelValue"],setup(x,{emit:B}){let y;const c=x,m=e.ref(),V=e.inject("editable",!0),r=e.ref(),o=B,l=d=>{!d&&c.modelValue&&(d=moment(new Date(c.modelValue))),d?(m.value=d.format(c.displayFormat),o("update:modelValue",d.format(c.format))):(m.value="",o("update:modelValue","")),y.setStartDate(m.value||void 0)};return e.onMounted(()=>{const d=$(r.value);d.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:c.drops,locale:{format:c.displayFormat},maxDate:c.maxDate?new Date(c.maxDate):c.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(b,g)=>l(g.startDate)),y=d.data("daterangepicker"),l()}),e.onUnmounted(()=>y.remove()),e.watch(()=>c.modelValue,()=>l()),(d,b)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(V),placeholder:e.unref(V)?x.placeholder:"",ref_key:"element",ref:r,type:"text"},d.$attrs,{"onUpdate:modelValue":b[0]||(b[0]=g=>e.isRef(m)?m.value=g:null)}),null,16,Jm),[[e.vModelText,e.unref(m)]]),x.error?(e.openBlock(),e.createElementBlock("div",Ym,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Hm={key:0,class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},Wm={class:"pagination","aria-label":"Pagination"},Km=["disabled"],Xm={key:1,class:"pagination-item ellipsis",type:"button"},Zm=["onClick"],vm={class:"page-number"},ep={key:2,class:"pagination-item ellipsis",type:"button"},tp={class:"page-number"},lp=["disabled"],op={class:"page-number-control"},np={class:"page-number-control-item"},rp=["selected","value"],ap={class:"page-number-control-item"},sp=["value","selected"],dp={__name:"ListPager",props:{count:{required:!0,type:Number},page:{required:!0,type:Number},pageSize:{required:!0,type:Number},slots:{default:3,type:Number}},emits:["change"],setup(x,{emit:B}){const y={},c=x,m=e.computed(()=>Math.ceil(c.count/c.pageSize)),V=(o,l)=>{l&&(o=Math.min(o,Math.ceil(c.count/l))),1<=o&&o<=m.value&&r("change",o,l||c.pageSize)},r=B;return e.watchEffect(()=>{y.from=c.page-parseInt(c.slots/2),y.to=c.page+parseInt((c.slots-1)/2),y.pages=[];for(let o=y.from;o<=y.to;o++)0<o&&o<=m.value&&y.pages.push(o)}),(o,l)=>c.count?(e.openBlock(),e.createElementBlock("div",Hm,[e.createElementVNode("nav",Wm,[e.createElementVNode("button",{"aria-label":"Previous page",class:"nav-button",onClick:l[0]||(l[0]=d=>V(x.page-1)),disabled:x.page===1,type:"button"},[...l[6]||(l[6]=[e.createElementVNode("i",{class:"fas fa-chevron-left"},null,-1)])],8,Km),y.from>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pagination-item",onClick:l[1]||(l[1]=d=>V(1)),type:"button"},[...l[7]||(l[7]=[e.createElementVNode("span",{class:"page-number"},"1",-1)])])):e.createCommentVNode("",!0),y.from>2?(e.openBlock(),e.createElementBlock("button",Xm,[...l[8]||(l[8]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.pages,d=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["pagination-item",{active:x.page===d}]),onClick:b=>V(d),key:d,type:"button"},[e.createElementVNode("span",vm,e.toDisplayString(d),1)],10,Zm))),128)),e.unref(m)>y.to+1?(e.openBlock(),e.createElementBlock("button",ep,[...l[9]||(l[9]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),e.unref(m)>y.to?(e.openBlock(),e.createElementBlock("button",{key:3,class:"pagination-item",onClick:l[2]||(l[2]=d=>V(e.unref(m))),type:"button"},[e.createElementVNode("span",tp,e.toDisplayString(e.unref(m)),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{"aria-label":"Next page",class:"nav-button",onClick:l[3]||(l[3]=d=>V(x.page+1)),type:"button",disabled:x.page===e.unref(m)},[...l[10]||(l[10]=[e.createElementVNode("i",{class:"fas fa-chevron-right"},null,-1)])],8,lp)]),e.createElementVNode("div",op,[e.createElementVNode("div",np,[l[11]||(l[11]=e.createElementVNode("span",null,"跳到",-1)),e.createElementVNode("select",{onChange:l[4]||(l[4]=d=>V(d.target.value)),class:"form-select jump-to-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),d=>(e.openBlock(),e.createElementBlock("option",{key:d,selected:d===x.page,value:d},e.toDisplayString(d),9,rp))),128))],32),l[12]||(l[12]=e.createElementVNode("span",null,"頁",-1)),l[13]||(l[13]=e.createElementVNode("span",null,",",-1))]),e.createElementVNode("div",ap,[l[14]||(l[14]=e.createElementVNode("span",null,"每頁顯示",-1)),e.createElementVNode("select",{onChange:l[5]||(l[5]=d=>V(x.page,d.target.value)),class:"form-select"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([10,20,30],d=>e.createElementVNode("option",{value:d,selected:d===x.pageSize},e.toDisplayString(d),9,sp)),64))],32),l[15]||(l[15]=e.createElementVNode("span",null,"筆",-1))])])])):e.createCommentVNode("",!0)}},cp={class:"block"},ip={class:"mt-4"},mp={class:"table align-middle gray-table side-table"},pp={key:0},Vp={key:1,class:"text-light-gray"},fp={class:"mt-4"},Np={class:"table align-middle gray-table side-table"},Ep={class:"row g-3"},bp={class:"col-12 col-xl-2"},gp={class:"text-gray mb-2"},yp={class:"col-12 col-xl-3"},kp={class:"text-gray mb-2"},up={class:"col-12 col-xl-4"},hp={class:"row g-1"},xp={class:"col-7"},$p={class:"col-5"},Bp={class:"col-12 col-xl-3"},_p={class:"text-gray mb-2"},Cp={class:"col-12"},Tp={class:"text-gray mb-2"},wp={class:"mt-4"},Dp={class:"table align-middle gray-table side-table"},Sp={class:"mt-4"},Ap={class:"table align-middle gray-table side-table"},Fp={key:0,class:"table-responsive mt-3 mb-0"},Up={class:"table align-middle gray-table"},Pp={key:0},Mp={key:0},Ip={class:"d-flex gap-2"},jp=["onClick"],Op={class:"mt-4"},Lp={class:"table align-middle gray-table side-table"},Rp={key:0,class:"block-bottom bg-light-teal"},qp={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.ref(),V=e.computed(()=>z("literacy",d.value.Status,1)),r=e.ref({}),o=e.ref([]),l=e.computed(()=>b.value.filter(N=>!N.Deleted)),d=e.ref({}),b=e.ref([]),g=e.computed({get:()=>!!l.value.length,set:N=>{N?_():b.value.forEach(n=>n.Deleted=!0)}}),_=()=>b.value.push({}),h=B,f=()=>{A.literacy("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(N=>{d.value=N.Project,c.value=N.Contacts,b.value=N.PreviousStudies,j().init("literacy",d.value),m.value=d.value.changeApply,d.value.changeApply=void 0})},i=N=>N.Deleted=!0,a=N=>{var s,p;if(r.value={},N&&!u()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:d.value,Contacts:c.value,PreviousStudies:b.value.filter(t=>t.ID||!t.Deleted),Before:(s=m.value)==null?void 0:s.Form1Before,After:(p=m.value)==null?void 0:p.Form1After,Submit:N?"true":"false"};A.literacy("saveApplication",n).subscribe(t=>{N?h("next",t.ID):d.value.ID?f():window.location.href=`Application.aspx?ID=${t.ID}`})},u=()=>{let N={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return r.value=M(d.value,N),N={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},c.value.forEach((n,s)=>Object.assign(r.value,M(n,N,`contact-${s}-`))),N={Title:"研習/課程名稱",TheDate:"辦理日期"},b.value.forEach((n,s)=>Object.assign(r.value,M(n,N,`study-${s}-`))),m.value&&(N={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(r.value,M(m.value,N))),!Object.keys(r.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(N=>{o.value=N[0],y.id?f():A.literacy("getEmptyApplication").subscribe(n=>{d.value=Object.assign({Field:null,FormStep:1,Status:1},n),c.value=[{Role:"申請人"}],j().init("literacy",d.value)})})}),e.provide("editable",V),e.watch(()=>[d.value.Field,d.value.OrgName],()=>{var N;if(V.value){const n=[];d.value.Field&&n.push((N=o.value.find(s=>s.Code===d.value.Field))==null?void 0:N.Descname),d.value.OrgName&&n.push(d.value.OrgName),d.value.ProjectName=n.join("-")}}),(N,n)=>{const s=e.resolveComponent("required-label"),p=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),E=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cp,[n[40]||(n[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",ip,[e.createElementVNode("table",mp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[14]||(n[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",pp,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Vp,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[17]||(n[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{disabled:"",modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=C=>e.unref(d).ProjectName=C),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(r).Field,options:e.unref(o),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).Field,"onUpdate:modelValue":n[1]||(n[1]=C=>e.unref(d).Field=C)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":n[2]||(n[2]=C=>e.unref(d).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).OrgLeader,modelValue:e.unref(d).OrgLeader,"onUpdate:modelValue":n[3]||(n[3]=C=>e.unref(d).OrgLeader=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":n[4]||(n[4]=C=>e.unref(d).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",fp,[e.createElementVNode("table",Np,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(C,S)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Ep,[e.createElementVNode("div",bp,[e.createElementVNode("div",gp,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(r)[`contact-${S}-Name`],modelValue:C.Name,"onUpdate:modelValue":P=>C.Name=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",yp,[e.createElementVNode("div",kp,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(r)[`contact-${S}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":P=>C.JobTitle=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",up,[n[24]||(n[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",hp,[e.createElementVNode("div",xp,[e.createVNode(p,{modelValue:C.Phone,"onUpdate:modelValue":P=>C.Phone=P,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",$p,[e.createVNode(p,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":P=>C.PhoneExt=P,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Bp,[e.createElementVNode("div",_p,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[25]||(n[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(r)[`contact-${S}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":P=>C.MobilePhone=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Cp,[e.createElementVNode("div",Tp,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(p,{error:e.unref(r)[`contact-${S}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":P=>C.EMail=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",wp,[e.createElementVNode("table",Dp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[28]||(n[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(E,{error:e.unref(r).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(d).Target,"onUpdate:modelValue":n[5]||(n[5]=C=>e.unref(d).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[29]||(n[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":n[6]||(n[6]=C=>e.unref(d).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":n[7]||(n[7]=C=>e.unref(d).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Qualitative,"onUpdate:modelValue":n[8]||(n[8]=C=>e.unref(d).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Sp,[e.createElementVNode("table",Ap,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[36]||(n[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(g),"onUpdate:modelValue":n[9]||(n[9]=C=>e.isRef(g)?g.value=C:null)},null,8,["modelValue"]),e.unref(g)?(e.openBlock(),e.createElementBlock("div",Fp,[e.createElementVNode("table",Up,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[32]||(n[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),n[33]||(n[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Pp,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,S)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r)[`study-${S}-Title`],modelValue:C.Title,"onUpdate:modelValue":P=>C.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(r)[`study-${S}-TheDate`],modelValue:C.TheDate,"onUpdate:modelValue":P=>C.TheDate=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Mp,[e.createElementVNode("div",Ip,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>i(C),type:"button"},[...n[34]||(n[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,jp)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:_,type:"button"},[...n[35]||(n[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[39]||(n[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Op,[e.createElementVNode("table",Lp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[37]||(n[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":n[10]||(n[10]=C=>e.unref(m).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[38]||(n[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":n[11]||(n[11]=C=>e.unref(m).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Rp,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[12]||(n[12]=C=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[13]||(n[13]=C=>a(!0)),type:"button"},[...n[43]||(n[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},zp={class:"block"},Gp={key:0,class:"text-pink lh-base mt-4"},Jp={class:"mt-4"},Yp={class:"table align-middle gray-table"},Qp={class:"text-center"},Hp={key:0,width:"180"},Wp={class:"text-center"},Kp={key:0},Xp=["innerHTML"],Zp=["href"],vp={key:0,class:"text-center"},eV={key:0},tV={key:1,class:"text-pink"},lV={key:1,class:"tag-group mt-2 gap-1"},oV={key:0,class:"tag tag-green-light"},nV=["download","href"],rV=["onClick"],aV={class:"mt-4"},sV={class:"table align-middle gray-table side-table"},dV={key:0,class:"block-bottom bg-light-teal"},cV=["disabled"],iV={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"著作權授權同意書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=5&id=${y.id}`,Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),V=e.computed(()=>c.value.some(i=>!i.Optional&&!i.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("literacy",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(i.Multiple?a.Name:`${i.Title}.pdf`)})},b=A.download,g=B,_=()=>{rxjs.forkJoin([A.literacy("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=c.value.filter(u=>{var N;return!((N=u.Excludes)!=null&&N.includes(l.value.OrgCategory))}),c.value.forEach(u=>{u.Files=a.Attachments.filter(N=>N.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(N=>!N.Deleted).length)}),j().init("literacy",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},h=i=>{var u,N;if(o.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,s)=>n.concat(s.Files),[]),Before:(u=m.value)==null?void 0:u.Form5Before,After:(N=m.value)==null?void 0:N.Form5After,Submit:i?"true":"false"};A.literacy("saveAttachment",a).subscribe(()=>{i?g("next"):_()})},f=()=>{if(m.value){const i={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,M(m.value,i))}return!Object.keys(o.value).length};return e.onMounted(_),e.provide("editable",r),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",zp,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",Gp,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Jp,[e.createElementVNode("table",Yp,[e.createElementVNode("thead",Qp,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Hp,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",Wp,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",Kp,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(u,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,Xp)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Zp)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",vp,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",eV,"已上傳")):(e.openBlock(),e.createElementBlock("span",tV,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>d(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",lV,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",oV,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(b)(t.Path)},e.toDisplayString(t.Name),9,nV),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,rV)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",aV,[e.createElementVNode("table",sV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(m).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",dV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>h(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,cV)])):e.createCommentVNode("",!0)],64)}}},mV={class:"block"},pV={class:"mt-4"},VV={class:"table-responsive mt-3 mb-0"},fV={class:"table align-middle gray-table"},NV={key:0,width:"1"},EV={key:0},bV={class:"d-flex gap-2"},gV=["onClick"],yV={class:"table-responsive mt-3 mb-0"},kV={class:"table align-middle gray-table"},uV={class:"mt-4"},hV={class:"table align-middle gray-table side-table"},xV={key:0,class:"block-bottom bg-light-teal"},$V={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.computed(()=>z("literacy",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>c.value.filter(i=>!i.Deleted)),l=e.ref({}),d=()=>c.value.push({}),b=B,g=()=>{rxjs.forkJoin([A.literacy("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=a.Benefits,c.value.length||d(),j().init("literacy",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=i=>i.Deleted=!0,h=i=>{var u,N;if(r.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(u=m.value)==null?void 0:u.Form4Before,After:(N=m.value)==null?void 0:N.Form4After,Submit:i?"true":"false"};A.literacy("saveBenefit",a).subscribe(()=>{i?b("next"):g()})},f=()=>{let i={Benefit:"不可量化成果"};return r.value=M(l.value,i),i={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,u)=>Object.assign(r.value,M(a,i,`item-${u}-`))),m.value&&(i={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,M(m.value,i))),!Object.keys(r.value).length};return e.onMounted(g),e.provide("editable",V),(i,a)=>{const u=e.resolveComponent("input-text"),N=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",mV,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",pV,[e.createElementVNode("div",VV,[e.createElementVNode("table",fV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",NV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Title`],modelValue:s.Title,"onUpdate:modelValue":t=>s.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Target`],modelValue:s.Target,"onUpdate:modelValue":t=>s.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r)[`item-${p}-Description`],rows:"1",modelValue:s.Description,"onUpdate:modelValue":t=>s.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",EV,[e.createElementVNode("div",bV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>_(s),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,gV)):e.createCommentVNode("",!0),p+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",yV,[e.createElementVNode("table",kV,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(l).Benefit=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",uV,[e.createElementVNode("table",hV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form4Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":a[2]||(a[2]=s=>e.unref(m).Form4After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",xV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=s=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},BV={class:"block"},_V={class:"mt-4"},CV={class:"table-responsive mt-3 mb-0"},TV={class:"table align-middle gray-table"},wV={class:"text-end"},DV={class:"text-end"},SV={class:"table-responsive"},AV={class:"table align-middle gray-table"},FV=["colspan"],UV={key:0,width:"1"},PV={class:"text-end"},MV={key:0},IV={class:"d-flex gap-2"},jV=["onClick"],OV={class:"mt-4"},LV={class:"table-responsive mt-3 mb-0"},RV={class:"table align-middle gray-table"},qV={key:0,width:"1"},zV={class:"text-end"},GV={key:0},JV={class:"d-flex gap-2"},YV=["onClick"],QV={class:"mt-4"},HV={class:"table align-middle gray-table side-table"},WV={key:0,class:"block-bottom bg-light-teal"},KV={class:"text-center"},XV={class:"mb-5"},ZV={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("literacy",l.value.Status,3)),V=e.ref({}),r=e.computed(()=>b.value.filter(p=>!p.Deleted)),o=e.computed(()=>g.value.filter(p=>!p.Deleted)),l=e.ref({}),d=e.ref(),b=e.ref([]),g=e.ref([]),_=e.ref({}),h=e.ref(0),f=()=>b.value.push({}),i=()=>g.value.push({}),a=B,u=()=>{rxjs.forkJoin([A.literacy("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];l.value=t.Project,b.value=t.OtherSubsidies,g.value=t.BudgetPlans,_.value=t.GrantTargetSetting,g.value.length||i(),j().init("literacy",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=(p,t)=>{var k,w;if(V.value={},p&&!s()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>_.value.GrantLimit*1e4){d.value.show(()=>n(p,!0));return}const E={Project:l.value,OtherSubsidies:b.value,BudgetPlans:g.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:p?"true":"false"};A.literacy("saveFunding",E).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(l.value,p),p={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`other-${E}-`))),p={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`plan-${E}-`))),c.value&&(p={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(c.value,p))),!Object.keys(V.value).length};return e.onMounted(u),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((p,t)=>p+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(p=>p.percent=Math.round(q(p.Amount)/l.value.OtherAmount*1e4)/100),g.value.forEach(p=>p.sum=q(p.Amount)+q(p.OtherAmount))}),(p,t)=>{var P;const E=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",BV,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",_V,[e.createElementVNode("div",CV,[e.createElementVNode("table",TV,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",wV,e.toDisplayString((P=e.unref(l).OtherAmount)==null?void 0:P.toLocaleString()),1),e.createElementVNode("td",DV,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",SV,[e.createElementVNode("table",AV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,FV)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",UV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":D=>F.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",PV,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":D=>F.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",MV,[e.createElementVNode("div",IV,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,jV)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",OV,[e.createElementVNode("div",LV,[e.createElementVNode("table",RV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",qV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":D=>F.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":D=>F.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",zV,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":D=>F.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",GV,[e.createElementVNode("div",JV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,YV)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",QV,[e.createElementVNode("table",HV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",WV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",KV,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",XV,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},vV={class:"block"},ef={class:"square-title"},tf={class:"text-teal fw-bold py-3"},lf={class:"table-responsive mb-0"},of={class:"table align-middle gray-table"},nf={class:"text-end"},rf={class:"text-teal fw-bold pb-3"},af={class:"text-teal fw-bold pb-3"},sf={class:"mt-4"},df={class:"table align-middle gray-table"},cf={class:"text-center"},mf={key:0,width:"180"},pf={class:"text-center"},Vf=["href"],ff={key:0,class:"text-center"},Nf={key:0},Ef={key:1,class:"text-pink"},bf={key:1,class:"tag-group mt-2 gap-1"},gf={key:0,class:"tag tag-green-light"},yf=["download","href"],kf=["onClick"],uf={class:"block-bottom bg-light-teal"},hf=["disabled"],xf={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.computed(()=>l.value.some(f=>!f.Files.filter(i=>!i.Deleted).length)),m=e.computed(()=>!r.value||r.value.Status==="請款中"),V=e.computed(()=>{var f;return((f=r.value)==null?void 0:f.Status)==="通過"}),r=e.ref(),o=e.ref({}),l=e.ref([{Type:11,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]}]),d=(f,i)=>{i.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:i.Path,Name:`${o.value.ProjectID}_請款_${f.Title}.pdf`})},b=A.download,g=B,_=()=>{A.literacy("getPayment",{ID:y.id}).subscribe(f=>{o.value=f.Project,j().init("literacy",o.value),l.value=l.value.filter(i=>{var a;return!((a=i.Excludes)!=null&&a.includes(o.value.OrgCategory))}),l.value.forEach(i=>{i.Files=f.Attachments.filter(a=>a.Type===i.Type),i.Uploaded=e.computed(()=>i.Files.filter(a=>!a.Deleted).length)}),r.value=f.Payments.find(i=>i.Stage===1),Y().init(r.value)})},h=f=>{const i={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:o.value.ApprovedAmount},Attachments:l.value.reduce((a,u)=>a.concat(u.Files),[]),Submit:f?"true":"false"};A.literacy("savePayment",i).subscribe(()=>{f?g("next"):_()})};return e.onMounted(_),e.provide("editable",m),(f,i)=>{var N;const a=e.resolveComponent("required-label"),u=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",vV,[e.createElementVNode("h5",ef,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",tf,"核定經費: "+e.toDisplayString((N=e.unref(o).ApprovedAmount)==null?void 0:N.toLocaleString())+"元",1),e.createElementVNode("div",lf,[e.createElementVNode("table",of,[i[6]||(i[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",nf,e.toDisplayString(e.unref(o).ApprovedAmount),1),i[2]||(i[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),i[3]||(i[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),i[4]||(i[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),i[5]||(i[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",rf,"本期實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",af,"累積實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),i[12]||(i[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),i[13]||(i[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",sf,[e.createElementVNode("table",df,[e.createElementVNode("thead",cf,[e.createElementVNode("tr",null,[i[7]||(i[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),i[8]||(i[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",mf,"狀態")):e.createCommentVNode("",!0),i[9]||(i[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(n,s)=>(e.openBlock(),e.createElementBlock("tr",{key:n},[e.createElementVNode("td",pf,e.toDisplayString(s+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(n.Title),1)]),_:2},1024)]),e.unref(m)&&n.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:n.Template,style:{width:"140px"},type:"button"},[...i[10]||(i[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Vf)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",ff,[n.Uploaded?(e.openBlock(),e.createElementBlock("span",Nf,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ef,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(m)&&!n.Uploaded?(e.openBlock(),e.createBlock(u,{key:0,accept:".pdf",onFile:p=>d(n,p)},null,8,["onFile"])):e.createCommentVNode("",!0),n.Uploaded?(e.openBlock(),e.createElementBlock("div",bf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.Files,p=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:p},[p.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",gf,[e.createElementVNode("a",{class:"tag-link my-1",download:p.Name,href:e.unref(b)(p.Path)},e.toDisplayString(p.Name),9,yf),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:t=>p.Deleted=!0,type:"button"},[...i[11]||(i[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,kf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",uf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:i[0]||(i[0]=n=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:i[1]||(i[1]=n=>h(!0)),disabled:e.unref(c),type:"button"},[...i[14]||(i[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,hf)])],64)}}},$f={class:"block"},Bf={class:"square-title"},_f={class:"text-teal fw-bold py-3"},Cf={class:"text-teal fw-bold pb-3"},Tf={class:"table-responsive"},wf={class:"table align-middle gray-table"},Df={class:"text-end"},Sf={class:"text-end"},Af={class:"text-end"},Ff={class:"mt-4"},Uf={class:"table align-middle gray-table"},Pf={class:"text-center"},Mf={key:0,width:"180"},If={class:"text-center"},jf=["href"],Of={key:0,class:"text-center"},Lf={key:0},Rf={key:1,class:"text-pink"},qf={key:1,class:"tag-group mt-2 gap-1"},zf={key:0,class:"tag tag-green-light"},Gf=["download","href"],Jf=["onClick"],Yf={class:"block-bottom bg-light-teal"},Qf=["disabled"],Hf={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>c.value<=0||_.value.some(N=>!N.Files.filter(n=>!n.Deleted).length)),V=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.ref(0),o=e.ref(),l=e.ref(0),d=e.ref({}),b=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(c.value*100/d.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>l.value?Math.round(c.value*100/l.value*100)/100:0),_=e.ref([{Type:21,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/LIT/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/LIT/3-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/LIT/4-補助清單.docx",Files:[]}]),h=(N,n)=>{n.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:n.Path,Name:`${d.value.ProjectID}_結案核銷_${N.Title}.pdf`})},f=A.download,i=B,a=()=>{A.literacy("getPayment",{ID:y.id}).subscribe(N=>{d.value=N.Project,j().init("literacy",d.value),_.value=_.value.filter(n=>{var s;return!((s=n.Excludes)!=null&&s.includes(d.value.OrgCategory))}),_.value.forEach(n=>{n.Files=N.Attachments.filter(s=>s.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(s=>!s.Deleted).length)}),o.value=N.Payments.find(n=>n.Stage===2),o.value&&(c.value=o.value.TotalSpentAmount),l.value=N.Payments.filter(n=>n.Stage<2&&n.Status==="通過").reduce((n,s)=>n+s.CurrentActualPaidAmount,0),r.value=l.value,Y().init(o.value,l.value)})},u=N=>{const n={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((s,p)=>s.concat(p.Files),[]),Submit:N?"true":"false"};A.literacy("savePayment",n).subscribe(()=>{N?i("next"):a()})};return e.onMounted(a),e.provide("editable",V),(N,n)=>{var E;const s=e.resolveComponent("input-integer"),p=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$f,[e.createElementVNode("h5",Bf,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",_f,"核定經費: "+e.toDisplayString((E=e.unref(d).ApprovedAmount)==null?void 0:E.toLocaleString())+"元",1),e.createElementVNode("p",Cf,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Tf,[e.createElementVNode("table",wf,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",Df,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(s,{max:e.unref(r),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Sf,e.toDisplayString(e.unref(b))+"%",1),e.createElementVNode("td",Af,e.toDisplayString(e.unref(g))+"%",1)])])])]),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Ff,[e.createElementVNode("table",Uf,[e.createElementVNode("thead",Pf,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Mf,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,w)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",If,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(V)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,jf)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Of,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Lf,"已上傳")):(e.openBlock(),e.createElementBlock("span",Rf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:C=>h(k,C)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",qf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",zf,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(f)(C.Path)},e.toDisplayString(C.Name),9,Gf),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>C.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Jf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Yf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>u(!0)),disabled:e.unref(m),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Qf)])],64)}}},Wf={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:B,type:"literacy"})}}},Kf={class:"block"},Xf={class:"mt-4"},Zf={class:"table align-middle gray-table side-table"},vf={key:0,class:"d-flex align-items-center gap-2"},eN={class:"input-group w-auto"},tN={class:"text-teal-dark"},lN={key:1,class:"invalid mt-0"},oN={class:"table-responsive mt-4"},nN={class:"table align-middle gray-table"},rN={key:0},aN={class:"input-group"},sN={key:0,class:"invalid mt-0"},dN={key:0},cN={class:"d-flex gap-2"},iN=["onClick"],mN={class:"mt-4"},pN={class:"table align-middle gray-table"},VN={key:0},fN=["value"],NN={key:0},EN={class:"d-flex gap-2"},bN=["onClick"],gN={class:"mt-4"},yN={class:"table align-middle gray-table side-table"},kN={key:0,class:"block-bottom bg-light-teal"},uN={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),V=e.computed(()=>g.value.EndDate),r=e.computed(()=>z("literacy",b.value.Status,2)),o=e.ref({}),l=e.computed(()=>_.value.filter(p=>!p.Deleted)),d=e.computed(()=>h.value.filter(p=>!p.Deleted)),b=e.ref({}),g=e.ref({}),_=e.ref([]),h=e.ref([]),f=()=>A.literacy("createItem",{ID:y.id}).subscribe(p=>_.value.push(p)),i=()=>h.value.push({Type:0,ItemID:0}),a=B,u=()=>{rxjs.forkJoin([A.literacy("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];b.value=t.Project,g.value=t.GrantType,_.value=t.Items,h.value=t.Schedules,_.value.length||f(),h.value.length||i(),j().init("literacy",b.value),m.value=b.value.changeApply,b.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=p=>{var E,k;if(o.value={},p&&!s()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:b.value,Items:_.value,Schedules:h.value,Before:(E=m.value)==null?void 0:E.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:p?"true":"false"};A.literacy("saveWorkSchedule",t).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=M(b.value,p),p={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`item-${E}-`))),p={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`schedule-${E}-`))),m.value&&(p={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,M(m.value,p))),!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(p,t)=>{const E=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),P=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Kf,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Xf,[e.createElementVNode("table",Zf,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",vf,[e.createElementVNode("div",eN,[e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(b).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(b).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",tN,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",lN,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",oN,[e.createElementVNode("table",nN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",rN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${D}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",aN,[e.createVNode(S,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",sN,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",dN,[e.createElementVNode("div",cN,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,iN)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",mN,[e.createElementVNode("table",pN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",VN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(I.Title),9,fN)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",NN,[e.createElementVNode("div",EN,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,bN)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",gN,[e.createElementVNode("table",yN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",kN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},hN={class:"block"},xN={class:"mt-4"},$N={class:"table align-middle gray-table side-table"},BN={key:0},_N={key:1,class:"text-light-gray"},CN={class:"mt-4"},TN={class:"table align-middle gray-table side-table"},wN={class:"row g-3"},DN={class:"col-12 col-xl-2"},SN={class:"text-gray mb-2"},AN={class:"col-12 col-xl-3"},FN={class:"text-gray mb-2"},UN={class:"col-12 col-xl-4"},PN={class:"row g-1"},MN={class:"col-7"},IN={class:"col-5"},jN={class:"col-12 col-xl-3"},ON={class:"text-gray mb-2"},LN={class:"col-12"},RN={class:"text-gray mb-2"},qN={class:"mt-4"},zN={class:"table align-middle gray-table side-table"},GN={class:"mt-4"},JN={class:"table align-middle gray-table side-table"},YN={key:0,class:"table-responsive mt-3 mb-0"},QN={class:"table align-middle gray-table"},HN={key:0},WN={key:0},KN={class:"d-flex gap-2"},XN=["onClick"],ZN={class:"mt-4"},vN={class:"table align-middle gray-table side-table"},e1={key:0,class:"block-bottom bg-light-teal"},t1={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.ref(),r=e.computed(()=>z("multiple",b.value.Status,1)),o=e.ref({}),l=e.ref([]),d=e.computed(()=>g.value.filter(n=>!n.Deleted)),b=e.ref({}),g=e.ref([]),_=e.computed({get:()=>!!d.value.length,set:n=>{n?h():g.value.forEach(s=>s.Deleted=!0)}}),h=()=>g.value.push({}),f=B,i=()=>{A.multiple("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(n=>{b.value=n.Project,V.value=n.Contacts,g.value=n.ReceivedSubsidies,b.value.OrgCategory=b.value.OrgCategory||null,j().init("multiple",b.value),m.value=b.value.changeApply,b.value.changeApply=void 0})},a=n=>n.Deleted=!0,u=n=>{var p,t;if(o.value={},n&&!N()){e.nextTick(()=>{var E;return(E=document.querySelector(".invalid"))==null?void 0:E.scrollIntoView({behavior:"smooth",block:"center"})});return}const s={Project:b.value,Contacts:V.value,ReceivedSubsidies:g.value.filter(E=>E.ID||!E.Deleted),Before:(p=m.value)==null?void 0:p.Form1Before,After:(t=m.value)==null?void 0:t.Form1After,Submit:n?"true":"false"};A.multiple("saveApplication",s).subscribe(E=>{n?f("next",E.ID):b.value.ID?i():window.location.href=`Application.aspx?ID=${E.ID}`})},N=()=>{let n={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return o.value=M(b.value,n),n={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((s,p)=>Object.assign(o.value,M(s,n,`contact-${p}-`))),n={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},g.value.forEach((s,p)=>Object.assign(o.value,M(s,n,`received-${p}-`))),m.value&&(n={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,M(m.value,n))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.multiple("getZgsCodes",{CodeGroup:"MULField"}),A.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(n=>{l.value=n[0],c.value=n[1],y.id?i():A.multiple("getEmptyApplication").subscribe(s=>{b.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},s),V.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("multiple",b.value)})})}),e.provide("editable",r),(n,s)=>{const p=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),E=e.resolveComponent("input-select"),k=e.resolveComponent("input-textarea"),w=e.resolveComponent("input-boolean"),C=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",hN,[s[43]||(s[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",xN,[e.createElementVNode("table",$N,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[15]||(s[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).Year),1)]),e.createElementVNode("tr",null,[s[16]||(s[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(b).ProjectID?(e.openBlock(),e.createElementBlock("span",BN,e.toDisplayString(e.unref(b).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",_N,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[s[17]||(s[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[18]||(s[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).ProjectName,modelValue:e.unref(b).ProjectName,"onUpdate:modelValue":s[0]||(s[0]=S=>e.unref(b).ProjectName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[19]||(s[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{"empty-value":null,error:e.unref(o).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(b).Field,"onUpdate:modelValue":s[1]||(s[1]=S=>e.unref(b).Field=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[20]||(s[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(b).OrgName,"onUpdate:modelValue":s[2]||(s[2]=S=>e.unref(b).OrgName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[21]||(s[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(b).OrgCategory,"onUpdate:modelValue":s[3]||(s[3]=S=>e.unref(b).OrgCategory=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[22]||(s[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(b).TaxID,"onUpdate:modelValue":s[4]||(s[4]=S=>e.unref(b).TaxID=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[23]||(s[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(b).Address,"onUpdate:modelValue":s[5]||(s[5]=S=>e.unref(b).Address=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),s[44]||(s[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",CN,[e.createElementVNode("table",TN,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(S,P)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",wN,[e.createElementVNode("div",DN,[e.createElementVNode("div",SN,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[24]||(s[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${P}-Name`],modelValue:S.Name,"onUpdate:modelValue":F=>S.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",AN,[e.createElementVNode("div",FN,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[25]||(s[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${P}-JobTitle`],modelValue:S.JobTitle,"onUpdate:modelValue":F=>S.JobTitle=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",UN,[s[26]||(s[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",PN,[e.createElementVNode("div",MN,[e.createVNode(t,{modelValue:S.Phone,"onUpdate:modelValue":F=>S.Phone=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",IN,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:S.PhoneExt,"onUpdate:modelValue":F=>S.PhoneExt=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",jN,[e.createElementVNode("div",ON,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[27]||(s[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${P}-MobilePhone`],modelValue:S.MobilePhone,"onUpdate:modelValue":F=>S.MobilePhone=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",LN,[e.createElementVNode("div",RN,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[28]||(s[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${P}-EMail`],modelValue:S.EMail,"onUpdate:modelValue":F=>S.EMail=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),s[45]||(s[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",qN,[e.createElementVNode("table",zN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[29]||(s[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[s[30]||(s[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(k,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(b).Target,"onUpdate:modelValue":s[6]||(s[6]=S=>e.unref(b).Target=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[31]||(s[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(b).Summary,"onUpdate:modelValue":s[7]||(s[7]=S=>e.unref(b).Summary=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[32]||(s[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(b).Quantified,"onUpdate:modelValue":s[8]||(s[8]=S=>e.unref(b).Quantified=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[33]||(s[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(b).Qualitative,"onUpdate:modelValue":s[9]||(s[9]=S=>e.unref(b).Qualitative=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",GN,[e.createElementVNode("table",JN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[39]||(s[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(w,{modelValue:e.unref(_),"onUpdate:modelValue":s[10]||(s[10]=S=>e.isRef(_)?_.value=S:null)},null,8,["modelValue"]),e.unref(_)?(e.openBlock(),e.createElementBlock("div",YN,[e.createElementVNode("table",QN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[s[34]||(s[34]=e.createElementVNode("th",null,"計畫名稱",-1)),s[35]||(s[35]=e.createElementVNode("th",null,"補助單位",-1)),s[36]||(s[36]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",HN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(S,P)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${P}-Name`],modelValue:S.Name,"onUpdate:modelValue":F=>S.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${P}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":F=>S.Unit=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`received-${P}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":F=>S.Amount=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",WN,[e.createElementVNode("div",KN,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>a(S),type:"button"},[...s[37]||(s[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,XN)):e.createCommentVNode("",!0),P+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:h,type:"button"},[...s[38]||(s[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[s[42]||(s[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ZN,[e.createElementVNode("table",vN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[40]||(s[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":s[11]||(s[11]=S=>e.unref(m).Form1Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...s[41]||(s[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":s[12]||(s[12]=S=>e.unref(m).Form1After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",e1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:s[13]||(s[13]=S=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:s[14]||(s[14]=S=>u(!0)),type:"button"},[...s[46]||(s[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},l1={class:"block"},o1={key:0,class:"text-pink lh-base mt-4"},n1={class:"mt-4"},r1={class:"table align-middle gray-table"},a1={class:"text-center"},s1={key:0,width:"180"},d1={class:"text-center"},c1={key:0},i1=["innerHTML"],m1=["href"],p1={key:0,class:"text-center"},V1={key:0},f1={key:1,class:"text-pink"},N1={key:1,class:"tag-group mt-2 gap-1"},E1={key:0,class:"tag tag-green-light"},b1=["download","href"],g1=["onClick"],y1={class:"mt-4"},k1={class:"table align-middle gray-table side-table"},u1={key:0,class:"block-bottom bg-light-teal"},h1=["disabled"],x1={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),V=e.computed(()=>c.value.some(i=>!i.Optional&&!i.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("multiple",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(i.Multiple?a.Name:`${i.Title}.pdf`)})},b=A.download,g=B,_=()=>{rxjs.forkJoin([A.multiple("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=c.value.filter(u=>{var N;return!((N=u.Excludes)!=null&&N.includes(l.value.OrgCategory))}),l.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),c.value.forEach(u=>{u.Files=a.Attachments.filter(N=>N.Type===u.Type),u.Uploaded=e.computed(()=>u.Files.filter(N=>!N.Deleted).length)}),j().init("multiple",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},h=i=>{var u,N;if(o.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,s)=>n.concat(s.Files),[]),Before:(u=m.value)==null?void 0:u.Form5Before,After:(N=m.value)==null?void 0:N.Form5After,Submit:i?"true":"false"};A.multiple("saveAttachment",a).subscribe(()=>{i?g("next"):_()})},f=()=>{if(m.value){const i={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,M(m.value,i))}return!Object.keys(o.value).length};return e.onMounted(_),e.provide("editable",r),(i,a)=>{const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",l1,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",o1,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",n1,[e.createElementVNode("table",r1,[e.createElementVNode("thead",a1,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",s1,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",d1,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",c1,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(u,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,i1)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,m1)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",p1,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",V1,"已上傳")):(e.openBlock(),e.createElementBlock("span",f1,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>d(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",N1,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",E1,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(b)(t.Path)},e.toDisplayString(t.Name),9,b1),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,g1)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",y1,[e.createElementVNode("table",k1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(m).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",u1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>h(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,h1)])):e.createCommentVNode("",!0)],64)}}},$1={class:"block"},B1={class:"mt-4"},_1={class:"table-responsive mt-3 mb-0"},C1={class:"table align-middle gray-table"},T1={key:0,width:"1"},w1={key:0},D1={class:"d-flex gap-2"},S1=["onClick"],A1={class:"table-responsive mt-3 mb-0"},F1={class:"table align-middle gray-table"},U1={class:"mt-4"},P1={class:"table align-middle gray-table side-table"},M1={key:0,class:"block-bottom bg-light-teal"},I1={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=e.ref(),V=e.computed(()=>z("multiple",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>c.value.filter(i=>!i.Deleted)),l=e.ref({}),d=()=>c.value.push({}),b=B,g=()=>{rxjs.forkJoin([A.multiple("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(i=>{const a=i[0];l.value=a.Project,c.value=a.Benefits,c.value.length||d(),j().init("multiple",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=i=>i.Deleted=!0,h=i=>{var u,N;if(r.value={},i&&!f()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:c.value,Before:(u=m.value)==null?void 0:u.Form4Before,After:(N=m.value)==null?void 0:N.Form4After,Submit:i?"true":"false"};A.multiple("saveBenefit",a).subscribe(()=>{i?b("next"):g()})},f=()=>{let i={Benefit:"不可量化成果"};return r.value=M(l.value,i),i={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,u)=>Object.assign(r.value,M(a,i,`item-${u}-`))),m.value&&(i={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,M(m.value,i))),!Object.keys(r.value).length};return e.onMounted(g),e.provide("editable",V),(i,a)=>{const u=e.resolveComponent("input-text"),N=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$1,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",B1,[e.createElementVNode("div",_1,[e.createElementVNode("table",C1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",T1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Title`],modelValue:s.Title,"onUpdate:modelValue":t=>s.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(r)[`item-${p}-Target`],modelValue:s.Target,"onUpdate:modelValue":t=>s.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r)[`item-${p}-Description`],rows:"1",modelValue:s.Description,"onUpdate:modelValue":t=>s.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",w1,[e.createElementVNode("div",D1,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>_(s),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,S1)):e.createCommentVNode("",!0),p+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",A1,[e.createElementVNode("table",F1,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(l).Benefit=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",U1,[e.createElementVNode("table",P1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(m).Form4Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":a[2]||(a[2]=s=>e.unref(m).Form4After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",M1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=s=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=s=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},j1={class:"block"},O1={class:"mt-4"},L1={class:"table-responsive mt-3 mb-0"},R1={class:"table align-middle gray-table"},q1={class:"text-end"},z1={class:"text-end"},G1={class:"table-responsive"},J1={class:"table align-middle gray-table"},Y1=["colspan"],Q1={key:0,width:"1"},H1={class:"text-end"},W1={key:0},K1={class:"d-flex gap-2"},X1=["onClick"],Z1={class:"mt-4"},v1={class:"table-responsive mt-3 mb-0"},eE={class:"table align-middle gray-table"},tE={key:0,width:"1"},lE={class:"text-end"},oE={key:0},nE={class:"d-flex gap-2"},rE=["onClick"],aE={class:"mt-4"},sE={class:"table align-middle gray-table side-table"},dE={key:0,class:"block-bottom bg-light-teal"},cE={class:"text-center"},iE={class:"mb-5"},mE={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),m=e.computed(()=>z("multiple",l.value.Status,3)),V=e.ref({}),r=e.computed(()=>b.value.filter(p=>!p.Deleted)),o=e.computed(()=>g.value.filter(p=>!p.Deleted)),l=e.ref({}),d=e.ref(),b=e.ref([]),g=e.ref([]),_=e.ref({}),h=e.ref(0),f=()=>b.value.push({}),i=()=>g.value.push({}),a=B,u=()=>{rxjs.forkJoin([A.multiple("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];l.value=t.Project,b.value=t.OtherSubsidies,g.value=t.BudgetPlans,_.value=t.GrantTargetSetting,g.value.length||i(),j().init("multiple",l.value),c.value=l.value.changeApply,l.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=(p,t)=>{var k,w;if(V.value={},p&&!s()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>_.value.GrantLimit*1e4){d.value.show(()=>n(p,!0));return}const E={Project:l.value,OtherSubsidies:b.value,BudgetPlans:g.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(w=c.value)==null?void 0:w.Form3After,Submit:p?"true":"false"};A.multiple("saveFunding",E).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(l.value,p),p={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`other-${E}-`))),p={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,E)=>Object.assign(V.value,M(t,p,`plan-${E}-`))),c.value&&(p={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(c.value,p))),!Object.keys(V.value).length};return e.onMounted(u),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((p,t)=>p+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(p=>p.percent=Math.round(q(p.Amount)/l.value.OtherAmount*1e4)/100),g.value.forEach(p=>p.sum=q(p.Amount)+q(p.OtherAmount))}),(p,t)=>{var P;const E=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",j1,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",O1,[e.createElementVNode("div",L1,[e.createElementVNode("table",R1,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",q1,e.toDisplayString((P=e.unref(l).OtherAmount)==null?void 0:P.toLocaleString()),1),e.createElementVNode("td",z1,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",G1,[e.createElementVNode("table",J1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Y1)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Q1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`other-${T}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":D=>F.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`other-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",H1,e.toDisplayString(F.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`other-${T}-Content`],rows:"1",modelValue:F.Content,"onUpdate:modelValue":D=>F.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",W1,[e.createElementVNode("div",K1,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,X1)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Z1,[e.createElementVNode("div",v1,[e.createElementVNode("table",eE,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",tE,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,T)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`plan-${T}-Title`],modelValue:F.Title,"onUpdate:modelValue":D=>F.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":D=>F.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(V)[`plan-${T}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":D=>F.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",lE,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V)[`plan-${T}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":D=>F.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",oE,[e.createElementVNode("div",nE,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>N(F),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,rE)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",aE,[e.createElementVNode("table",sE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=F=>e.unref(c).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":t[3]||(t[3]=F=>e.unref(c).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",dE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=F=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=F=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",cE,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",iE,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},pE={class:"block"},VE={class:"square-title"},fE={class:"text-teal fw-bold py-3"},NE={class:"table-responsive mb-0"},EE={class:"table align-middle gray-table"},bE={class:"text-end"},gE={class:"text-teal fw-bold pb-3"},yE={class:"text-teal fw-bold pb-3"},kE={class:"mt-4"},uE={class:"table align-middle gray-table"},hE={class:"text-center"},xE={key:0,width:"180"},$E={class:"text-center"},BE=["href"],_E={key:0,class:"text-center"},CE={key:0},TE={key:1,class:"text-pink"},wE={key:1,class:"tag-group mt-2 gap-1"},DE={key:0,class:"tag tag-green-light"},SE=["download","href"],AE=["onClick"],FE={class:"block-bottom bg-light-teal"},UE=["disabled"],PE={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>d.value.some(i=>!i.Files.filter(a=>!a.Deleted).length)),V=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.computed(()=>{var i;return((i=o.value)==null?void 0:i.Status)==="通過"}),o=e.ref(),l=e.ref({}),d=e.ref([{Type:11,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]}]),b=(i,a)=>{a.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:a.Path,Name:`${l.value.ProjectID}_第一期_${i.Title}.pdf`})},g=A.download,_=B,h=()=>{A.multiple("getPayment",{ID:y.id}).subscribe(i=>{l.value=i.Project,j().init("multiple",l.value),d.value=d.value.filter(a=>{var u;return!((u=a.Excludes)!=null&&u.includes(l.value.OrgCategory))}),d.value.forEach(a=>{a.Files=i.Attachments.filter(u=>u.Type===a.Type),a.Uploaded=e.computed(()=>a.Files.filter(u=>!u.Deleted).length)}),o.value=i.Payments.find(a=>a.Stage===1),o.value?c.value=o.value.CurrentRequestAmount:c.value=Math.round(l.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),Y().init(o.value)})},f=i=>{const a={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:c.value},Attachments:d.value.reduce((u,N)=>u.concat(N.Files),[]),Submit:i?"true":"false"};A.multiple("savePayment",a).subscribe(()=>{i?_("next"):h()})};return e.onMounted(h),e.provide("editable",V),(i,a)=>{var n;const u=e.resolveComponent("required-label"),N=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",pE,[e.createElementVNode("h5",VE,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",fE,"核定經費: "+e.toDisplayString((n=e.unref(l).ApprovedAmount)==null?void 0:n.toLocaleString())+"元",1),e.createElementVNode("div",NE,[e.createElementVNode("table",EE,[a[6]||(a[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",bE,e.toDisplayString(e.unref(c)),1),a[2]||(a[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[3]||(a[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[4]||(a[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[5]||(a[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",gE,"本期實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",yE,"累積實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),a[13]||(a[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",kE,[e.createElementVNode("table",uE,[e.createElementVNode("thead",hE,[e.createElementVNode("tr",null,[a[7]||(a[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[8]||(a[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",xE,"狀態")):e.createCommentVNode("",!0),a[9]||(a[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",$E,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(u,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024)]),e.unref(V)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:s.Template,style:{width:"140px"},type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,BE)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",_E,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",CE,"已上傳")):(e.openBlock(),e.createElementBlock("span",TE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!s.Uploaded?(e.openBlock(),e.createBlock(N,{key:0,accept:".pdf",onFile:t=>b(s,t)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",wE,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",DE,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(g)(t.Path)},e.toDisplayString(t.Name),9,SE),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:E=>t.Deleted=!0,type:"button"},[...a[11]||(a[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,AE)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",FE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[0]||(a[0]=s=>f()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[1]||(a[1]=s=>f(!0)),disabled:e.unref(m),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,UE)])],64)}}},ME={class:"block"},IE={class:"square-title"},jE={class:"text-teal fw-bold py-3"},OE={class:"table-responsive mb-0"},LE={class:"table align-middle gray-table"},RE={class:"text-end"},qE={class:"text-end"},zE={class:"text-end"},GE={class:"text-end"},JE={class:"text-teal fw-bold pb-3"},YE={class:"text-teal fw-bold pb-3"},QE={class:"mt-4"},HE={class:"table align-middle gray-table"},WE={class:"text-center"},KE={key:0,width:"180"},XE={class:"text-center"},ZE=["href"],vE={key:0,class:"text-center"},eb={key:0},tb={key:1,class:"text-pink"},lb={key:1,class:"tag-group mt-2 gap-1"},ob={key:0,class:"tag tag-green-light"},nb=["download","href"],rb=["onClick"],ab={class:"block-bottom bg-light-teal"},sb=["disabled"],db={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.ref(0),V=e.computed(()=>c.value<=0||a.value.some(t=>!t.Files.filter(E=>!E.Deleted).length)),r=e.computed(()=>!d.value||d.value.Status==="請款中"),o=e.computed(()=>{var t;return((t=d.value)==null?void 0:t.Status)==="通過"}),l=e.ref(0),d=e.ref(),b=e.ref(0),g=e.ref(0),_=e.ref({}),h=e.computed(()=>_.value.ApprovedAmount?Math.min(Math.round(c.value*100/_.value.ApprovedAmount*100)/100,100):0),f=e.computed(()=>i.value?Math.round(c.value*100/i.value*100)/100:0),i=e.computed(()=>g.value+(o.value?d.value.CurrentActualPaidAmount:0)),a=e.ref([{Type:21,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:24,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),u=(t,E)=>{E.Type==="application/pdf"&&t.Files.push({Type:t.Type,Path:E.Path,Name:`${_.value.ProjectID}_第二期_${t.Title}.pdf`})},N=A.download,n=B,s=()=>{A.multiple("getPayment",{ID:y.id}).subscribe(t=>{_.value=t.Project,j().init("multiple",_.value),a.value=a.value.filter(k=>{var w;return!((w=k.Excludes)!=null&&w.includes(_.value.OrgCategory))}),a.value.forEach(k=>{k.Files=t.Attachments.filter(w=>w.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(w=>!w.Deleted).length)}),d.value=t.Payments.find(k=>k.Stage===2),d.value?m.value=d.value.CurrentRequestAmount:m.value=Math.round(_.value.ApprovedAmount*y.setting.DisbursementRatioPct/100);const E=t.Payments.filter(k=>k.Stage<2&&k.Status==="通過");b.value=E.reduce((k,w)=>k+w.CurrentRequestAmount,0),g.value=E.reduce((k,w)=>k+w.CurrentActualPaidAmount,0),l.value=_.value.ApprovedAmount,Y().init(d.value,g.value)})},p=t=>{const E={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:m.value,TotalSpentAmount:c.value},Attachments:a.value.reduce((k,w)=>k.concat(w.Files),[]),Submit:t?"true":"false"};A.multiple("savePayment",E).subscribe(()=>{t?n("next"):s()})};return e.onMounted(s),e.provide("editable",r),(t,E)=>{var S;const k=e.resolveComponent("input-integer"),w=e.resolveComponent("required-label"),C=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ME,[e.createElementVNode("h5",IE,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",jE,"核定經費: "+e.toDisplayString((S=e.unref(_).ApprovedAmount)==null?void 0:S.toLocaleString())+"元",1),e.createElementVNode("div",OE,[e.createElementVNode("table",LE,[E[3]||(E[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",RE,e.toDisplayString(e.unref(m)),1),e.createElementVNode("td",qE,e.toDisplayString(e.unref(g)),1),e.createElementVNode("td",null,[e.createVNode(k,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":E[0]||(E[0]=P=>e.isRef(c)?c.value=P:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",zE,e.toDisplayString(e.unref(h))+"%",1),e.createElementVNode("td",GE,e.toDisplayString(e.unref(f))+"%",1)])])])]),e.unref(o)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",JE,"本期實際撥款: "+e.toDisplayString(e.unref(d).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",YE,"累積實際撥款: "+e.toDisplayString(e.unref(i).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),E[9]||(E[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),E[10]||(E[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",QE,[e.createElementVNode("table",HE,[e.createElementVNode("thead",WE,[e.createElementVNode("tr",null,[E[4]||(E[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),E[5]||(E[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",KE,"狀態")):e.createCommentVNode("",!0),E[6]||(E[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(P,F)=>(e.openBlock(),e.createElementBlock("tr",{key:P},[e.createElementVNode("td",XE,e.toDisplayString(F+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(P.Title),1)]),_:2},1024)]),e.unref(r)&&P.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:P.Template,style:{width:"140px"},type:"button"},[...E[7]||(E[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ZE)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",vE,[P.Uploaded?(e.openBlock(),e.createElementBlock("span",eb,"已上傳")):(e.openBlock(),e.createElementBlock("span",tb,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!P.Uploaded?(e.openBlock(),e.createBlock(C,{key:0,accept:".pdf",onFile:T=>u(P,T)},null,8,["onFile"])):e.createCommentVNode("",!0),P.Uploaded?(e.openBlock(),e.createElementBlock("div",lb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(P.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ob,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(N)(T.Path)},e.toDisplayString(T.Name),9,nb),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>T.Deleted=!0,type:"button"},[...E[8]||(E[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,rb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",ab,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:E[1]||(E[1]=P=>p()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:E[2]||(E[2]=P=>p(!0)),disabled:e.unref(V),type:"button"},[...E[11]||(E[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,sb)])],64)}}},cb={class:"block"},ib={class:"square-title"},mb={class:"text-teal fw-bold py-3"},pb={class:"text-teal fw-bold pb-3"},Vb={class:"table-responsive"},fb={class:"table align-middle gray-table"},Nb={class:"text-end"},Eb={class:"text-end"},bb={class:"text-end"},gb={class:"mt-4"},yb={class:"table align-middle gray-table"},kb={class:"text-center"},ub={key:0,width:"180"},hb={class:"text-center"},xb=["href"],$b={key:0,class:"text-center"},Bb={key:0},_b={key:1,class:"text-pink"},Cb={key:1,class:"tag-group mt-2 gap-1"},Tb={key:0,class:"tag tag-green-light"},wb=["download","href"],Db=["onClick"],Sb={class:"text-center"},Ab={colspan:"2"},Fb={class:"block-bottom bg-light-teal"},Ub=["disabled"],Pb={__name:"Payment3",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),m=e.computed(()=>c.value<=0||_.value.some(N=>!N.Files.filter(n=>!n.Deleted).length)),V=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.ref(0),o=e.ref(),l=e.ref(0),d=e.ref({}),b=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(c.value*100/d.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>l.value?Math.round(c.value*100/l.value*100)/100:0),_=e.ref([{Type:31,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:32,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:33,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:34,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),h=(N,n)=>{n.Type==="application/pdf"&&N.Files.push({Type:N.Type,Path:n.Path,Name:`${d.value.ProjectID}_結案核銷_${N.Title}.pdf`})},f=A.download,i=B,a=()=>{A.multiple("getPayment",{ID:y.id}).subscribe(N=>{d.value=N.Project,j().init("multiple",d.value),_.value=_.value.filter(n=>{var s;return!((s=n.Excludes)!=null&&s.includes(d.value.OrgCategory))}),_.value.forEach(n=>{n.Files=N.Attachments.filter(s=>s.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(s=>!s.Deleted).length)}),o.value=N.Payments.find(n=>n.Stage===3),l.value=N.Payments.filter(n=>n.Stage<3&&n.Status==="通過").reduce((n,s)=>n+s.CurrentActualPaidAmount,0),r.value=d.value.ApprovedAmount,Y().init(o.value,l.value)})},u=N=>{const n={Payment:{ProjectID:y.id,Stage:3,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((s,p)=>s.concat(p.Files),[]),Submit:N?"true":"false"};A.multiple("savePayment",n).subscribe(()=>{N?i("next"):a()})};return e.onMounted(a),e.provide("editable",V),(N,n)=>{var k;const s=e.resolveComponent("input-integer"),p=e.resolveComponent("required-label"),t=e.resolveComponent("input-file"),E=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cb,[e.createElementVNode("h5",ib,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",mb,"核定經費: "+e.toDisplayString((k=e.unref(d).ApprovedAmount)==null?void 0:k.toLocaleString())+"元",1),e.createElementVNode("p",pb,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Vb,[e.createElementVNode("table",fb,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",Nb,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(s,{max:e.unref(r),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=w=>e.isRef(c)?c.value=w:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Eb,e.toDisplayString(e.unref(b))+"%",1),e.createElementVNode("td",bb,e.toDisplayString(e.unref(g))+"%",1)])])])]),n[11]||(n[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[12]||(n[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",gb,[e.createElementVNode("table",yb,[e.createElementVNode("thead",kb,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",ub,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(w,C)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",hb,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Title),1)]),_:2},1024)]),e.unref(V)&&w.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:w.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,xb)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",$b,[w.Uploaded?(e.openBlock(),e.createElementBlock("span",Bb,"已上傳")):(e.openBlock(),e.createElementBlock("span",_b,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!w.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:S=>h(w,S)},null,8,["onFile"])):e.createCommentVNode("",!0),w.Uploaded?(e.openBlock(),e.createElementBlock("div",Cb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.Files,S=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:S},[S.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Tb,[e.createElementVNode("a",{class:"tag-link my-1",download:S.Name,href:e.unref(f)(S.Path)},e.toDisplayString(S.Name),9,wb),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:P=>S.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Db)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128)),e.createElementVNode("tr",null,[e.createElementVNode("td",Sb,e.toDisplayString(e.unref(_).length+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...n[10]||(n[10]=[e.createTextVNode("其他資料（5分鐘精華影片）",-1)])]),_:1})])]),e.createElementVNode("td",Ab,[e.createVNode(E)])])])])])]),e.createElementVNode("div",Fb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=w=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=w=>u(!0)),disabled:e.unref(m),type:"button"},[...n[13]||(n[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ub)])],64)}}},Mb={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:B,type:"multiple"})}}},Ib={class:"block"},jb={class:"mt-4"},Ob={class:"table align-middle gray-table side-table"},Lb={key:0,class:"d-flex align-items-center gap-2"},Rb={class:"input-group w-auto"},qb={class:"text-teal-dark"},zb={key:1,class:"invalid mt-0"},Gb={class:"table-responsive mt-4"},Jb={class:"table align-middle gray-table"},Yb={key:0},Qb={class:"input-group"},Hb={key:0,class:"invalid mt-0"},Wb={key:0},Kb={class:"d-flex gap-2"},Xb=["onClick"],Zb={class:"mt-4"},vb={class:"table align-middle gray-table"},eg={key:0},tg=["value"],lg={key:0},og={class:"d-flex gap-2"},ng=["onClick"],rg={class:"mt-4"},ag={class:"table align-middle gray-table side-table"},sg={key:0,class:"block-bottom bg-light-teal"},dg={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),V=e.computed(()=>g.value.EndDate),r=e.computed(()=>z("multiple",b.value.Status,2)),o=e.ref({}),l=e.computed(()=>_.value.filter(p=>!p.Deleted)),d=e.computed(()=>h.value.filter(p=>!p.Deleted)),b=e.ref({}),g=e.ref({}),_=e.ref([]),h=e.ref([]),f=()=>A.multiple("createItem",{ID:y.id}).subscribe(p=>_.value.push(p)),i=()=>h.value.push({Type:0,ItemID:0}),a=B,u=()=>{rxjs.forkJoin([A.multiple("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(p=>{const t=p[0];b.value=t.Project,g.value=t.GrantType,_.value=t.Items,h.value=t.Schedules,_.value.length||f(),h.value.length||i(),j().init("multiple",b.value),m.value=b.value.changeApply,b.value.changeApply=void 0})},N=p=>p.Deleted=!0,n=p=>{var E,k;if(o.value={},p&&!s()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:b.value,Items:_.value,Schedules:h.value,Before:(E=m.value)==null?void 0:E.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:p?"true":"false"};A.multiple("saveWorkSchedule",t).subscribe(()=>{p?a("next"):u()})},s=()=>{let p={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=M(b.value,p),p={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`item-${E}-`))),p={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,E)=>Object.assign(o.value,M(t,p,`schedule-${E}-`))),m.value&&(p={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,M(m.value,p))),!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(p,t)=>{const E=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),P=e.resolveComponent("input-textarea"),F=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ib,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",jb,[e.createElementVNode("table",Ob,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Lb,[e.createElementVNode("div",Rb,[e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(b).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(b).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(b).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",qb,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",zb,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Gb,[e.createElementVNode("table",Jb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Yb,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(o)[`item-${D}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Qb,[e.createVNode(S,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",Hb,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Wb,[e.createElementVNode("div",Kb,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Xb)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Zb,[e.createElementVNode("table",vb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",eg,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(T,D)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:c,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(I.Title),9,tg)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",lg,[e.createElementVNode("div",og,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>N(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ng)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",rg,[e.createElementVNode("table",ag,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(P,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",sg,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},cg={class:"block bg-light-teal-100 rounded-4 py-4"},ig={class:"fw-bold"},mg={class:"d-flex align-items-center gap-3 text-teal-dark mt-3"},pg={class:"block rounded-4 mt-4"},Vg=["innerHTML"],fg={class:"mt-3 d-flex flex-column gap-2"},Ng=["download","href"],Eg={class:"mt-3"},bg=["data-caption","href"],gg=["alt","src"],yg={class:"mt-3 d-flex flex-column gap-2"},kg=["href"],ug={__name:"NewsDetail",props:{id:{type:[Number,String]}},setup(x){const B=x,y=e.ref(),c=e.ref([]),m=e.ref({}),V=e.ref([]),r=e.ref([]),o=A.download;return e.onMounted(()=>{A.system("getNews",{ID:B.id}).subscribe(l=>{m.value=l.News,c.value=l.Files,V.value=l.Images,r.value=l.Videos,e.nextTick(()=>{Fancybox.bind(y.value,"[data-fancybox]")})})}),(l,d)=>{const b=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cg,[e.createElementVNode("h5",ig,e.toDisplayString(e.unref(m).Title),1),e.createElementVNode("ul",mg,[e.createElementVNode("li",null,[d[0]||(d[0]=e.createTextVNode("公告日期：",-1)),e.createVNode(b,{value:e.unref(m).EnableTime},null,8,["value"])]),e.createElementVNode("li",null,"公告單位："+e.toDisplayString(e.unref(m).UserOrg),1)])]),e.createElementVNode("div",pg,[e.createElementVNode("div",{class:"mb-5",style:{"white-space":"pre-line"},innerHTML:e.unref(m).Content},null,8,Vg),e.unref(c).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[d[2]||(d[2]=e.createElementVNode("h5",{class:"square-title"},"相關附件",-1)),e.createElementVNode("ul",fg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),g=>(e.openBlock(),e.createElementBlock("li",{key:g},[e.createElementVNode("a",{class:"link-black",download:g.Name,href:e.unref(o)(g.Path)},[e.createTextVNode(e.toDisplayString(g.Name)+" ",1),d[1]||(d[1]=e.createElementVNode("i",{class:"fa-solid fa-file-arrow-down text-teal-dark ms-1"},null,-1))],8,Ng)]))),128))])],64)):e.createCommentVNode("",!0),e.unref(V).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[d[4]||(d[4]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關照片",-1)),e.createElementVNode("div",Eg,[e.createElementVNode("div",{class:"image-preview mt-3",ref_key:"container",ref:y},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(g,_)=>(e.openBlock(),e.createElementBlock("div",{class:"image-preview__item",key:g},[e.createElementVNode("a",{"data-fancybox":"gallery","data-caption":`相片 ${_}`,href:e.unref(o)(g.Path)},[e.createElementVNode("img",{alt:`相片 ${_}`,src:e.unref(o)(g.Path)},null,8,gg),d[3]||(d[3]=e.createElementVNode("div",{class:"image-preview__item-overlay"},[e.createElementVNode("button",{"aria-label":"檢視圖片",class:"btn btn-view-image",tabindex:"-1",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"})])],-1))],8,bg)]))),128))],512)])],64)):e.createCommentVNode("",!0),e.unref(r).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[d[6]||(d[6]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關影片",-1)),e.createElementVNode("ul",yg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),g=>(e.openBlock(),e.createElementBlock("li",{key:g},[e.createElementVNode("a",{class:"link-black",href:g.URL,target:"_blank"},[e.createTextVNode(e.toDisplayString(g.Title)+" ",1),d[5]||(d[5]=e.createStaticVNode('<svg class="ms-1" xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19 24" fill="none"><g clip-path="url(#clip0_1051_6167)"><path d="M17.7333 0.5H12.6667C11.913 0.5 11.4 1.12067 11.4 1.76667C11.4 2.05167 11.4887 2.36833 11.7673 2.65967L13.4077 4.3L9.87367 7.834C9.60767 8.1 9.5 8.423 9.5 8.727C9.5 9.43633 10.0573 9.99367 10.7667 9.99367C11.096 9.99367 11.4127 9.87333 11.6597 9.62L15.1937 6.086L16.834 7.72633C17.1253 8.005 17.442 8.09367 17.727 8.09367C18.373 8.09367 18.9937 7.58067 18.9937 6.827V1.76667C18.9937 1.12067 18.4807 0.5 17.727 0.5H17.7333ZM15.2 7.88467L12.559 10.5257C12.084 11.0007 11.4443 11.2667 10.7667 11.2667C9.348 11.2667 8.23333 10.152 8.23333 8.73333C8.23333 8.05567 8.49933 7.42233 8.97433 6.941L11.6153 4.3L10.8743 3.559C10.716 3.39433 10.5957 3.217 10.488 3.03333H1.26667C0.563667 3.03333 0 3.597 0 4.3V18.2333C0 18.93 0.563667 19.5 1.26667 19.5H15.2C15.8967 19.5 16.4667 18.93 16.4667 18.2333V9.01833C16.2893 8.917 16.1183 8.79667 15.9663 8.651L15.2 7.88467Z" fill="#037F72"></path></g><defs><clipPath id="clip0_1051_6167"><rect width="19" height="19" fill="white" transform="translate(0 0.5)"></rect></clipPath></defs></svg>',1))],8,kg)]))),128))])],64)):e.createCommentVNode("",!0)])],64)}}},hg={class:"block rounded-4 mt-4"},xg={class:"table-responsive",style:{"min-height":"400px"}},$g={class:"table teal-table","aria-label":"公告列表"},Bg={"data-th":"公告時間:"},_g={"data-th":"公告標題:",class:"text-start"},Cg=["href"],Tg={"data-th":"發布單位:",class:"text-start"},wg={__name:"NewsList",setup(x){const B=e.ref([]),y=e.ref(1),c=e.ref(10),m=e.computed(()=>B.value.slice((y.value-1)*c.value,y.value*c.value)),V=(r,o)=>{y.value=parseInt(r),c.value=parseInt(o)};return e.onMounted(()=>{A.system("getPublishedNewsList").subscribe(r=>B.value=r.List)}),(r,o)=>{const l=e.resolveComponent("tw-date"),d=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",hg,[o[1]||(o[1]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")])])],-1)),e.createElementVNode("div",xg,[e.createElementVNode("table",$g,[o[0]||(o[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告時間"),e.createElementVNode("th",{scope:"col",class:"text-start"},"標題"),e.createElementVNode("th",{scope:"col",style:{width:"300px"}},"發布單位")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),b=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",Bg,[e.createVNode(l,{value:b.EnableTime},null,8,["value"])]),e.createElementVNode("td",_g,[e.createElementVNode("a",{class:"link-black",href:`NewsDetail.aspx?ID=${b.ID}`},e.toDisplayString(b.Title),9,Cg)]),e.createElementVNode("td",Tg,e.toDisplayString(b.UserOrg)+" "+e.toDisplayString(b.UserName),1)]))),128))])])]),e.createVNode(d,{count:e.unref(B).length,onChange:V,page:e.unref(y),"page-size":e.unref(c)},null,8,["count","page","page-size"])])}}},Dg={key:0,class:"notice mb-3"},Sg={class:"notice-content"},Ag=["onClick"],Fg={class:"notice-action"},Ug=["href"],Pg=oe({__name:"NewsMarquee",setup(x){let B=0;const y=e.ref([]),c=e.ref(),m=e.computed(()=>A.toUrl("/OFS/Information/NewsList.aspx")),V=r=>{window.open(A.toUrl(`/OFS/Information/NewsDetail.aspx?ID=${r.ID}`),"_blank")};return e.onMounted(()=>{A.system("getPublishedNewsList").subscribe(r=>{y.value=r.List,y.value.length>1&&setInterval(()=>{B++,c.value.style.transition="transform 1s ease-in-out",c.value.style.transform=`translateY(-${B*1.5}rem)`,B===y.value.length&&setTimeout(()=>{c.value.style.transition="none",c.value.style.transform="translateY(0)",B=0},1e3)},5e3)})}),(r,o)=>{const l=e.resolveComponent("tw-date");return e.unref(y).length?(e.openBlock(),e.createElementBlock("div",Dg,[e.createElementVNode("div",Sg,[e.createElementVNode("div",{class:"notice-list",ref_key:"marquee",ref:c},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),d=>(e.openBlock(),e.createElementBlock("h3",{class:"notice-title",onClick:b=>V(d),style:{"margin-bottom":"0.5rem",cursor:"pointer"},key:d},[e.createVNode(l,{value:d.EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(d.Title),1)],8,Ag))),128)),e.unref(y).length>1?(e.openBlock(),e.createElementBlock("h3",{key:0,class:"notice-title",onClick:o[0]||(o[0]=d=>V(e.unref(y)[0])),style:{cursor:"pointer"}},[e.createVNode(l,{value:e.unref(y)[0].EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(e.unref(y)[0].Title),1)])):e.createCommentVNode("",!0)],512)]),e.createElementVNode("div",Fg,[e.createElementVNode("a",{class:"btn-link",href:e.unref(m)},"全部公告",8,Ug)])])):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-8802a1c0"]]),Mg={key:0,class:"scroll-bottom-panel"},Ig={class:"d-flex flex-column gap-3 mb-3"},jg={class:"d-flex gap-2"},Og={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Lg={class:"text-nowrap my-2 d-flex align-items-center"},Rg={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],m=e.ref({}),V=e.ref({ID:B.id,Result:1}),r=()=>{const l={};if(V.value.Result>1&&(l.Reason="原因"),m.value=M(V.value,l),Object.keys(m.value).length){o();return}A[B.type]("reviewApplicationChange",V.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=5")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,l=>{l>1&&o()}),(l,d)=>{const b=e.resolveComponent("input-radio-group"),g=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",Mg,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ig,[e.createElementVNode("li",jg,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Og,[e.createElementVNode("div",Lg,[e.createVNode(b,{options:c,modelValue:e.unref(V).Result,"onUpdate:modelValue":d[0]||(d[0]=_=>e.unref(V).Result=_)},null,8,["modelValue"])]),e.unref(V).Result>1?(e.openBlock(),e.createBlock(g,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":d[1]||(d[1]=_=>e.unref(V).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},qg={key:0,class:"scroll-bottom-panel"},zg={class:"d-flex flex-column gap-3 mb-3"},Gg={class:"d-flex gap-2"},Jg={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Yg={class:"text-nowrap my-2 d-flex align-items-center"},Qg={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],m=e.ref({}),V=e.ref({ID:B.id,Result:1}),r=()=>{const l={};if(V.value.Result>1&&(l.Reason="原因"),m.value=M(V.value,l),Object.keys(m.value).length){o();return}A[B.type]("reviewApplication",V.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=4")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,l=>{l>1&&o()}),(l,d)=>{const b=e.resolveComponent("input-radio-group"),g=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",qg,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",zg,[e.createElementVNode("li",Gg,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Jg,[e.createElementVNode("div",Yg,[e.createVNode(b,{options:c,modelValue:e.unref(V).Result,"onUpdate:modelValue":d[0]||(d[0]=_=>e.unref(V).Result=_)},null,8,["modelValue"])]),e.unref(V).Result>1?(e.openBlock(),e.createBlock(g,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":d[1]||(d[1]=_=>e.unref(V).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Hg={class:"d-flex align-items-center gap-3"},Wg={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Kg={class:"modal-content"},Xg={class:"modal-header"},Zg={class:"fs-24 fw-bold text-green-light"},vg={class:"modal-body"},ey={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},ty=["disabled"],ly={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=e.computed(()=>!r.value||r.value===l[B.type].organizer),c=e.ref(),m=e.ref(),V=e.computed(()=>l[B.type].organizerName),r=e.ref(0),o=e.computed(()=>{var f;return(f=g.value.find(i=>i.UnitID===b.value))==null?void 0:f.reviewers}),l=j(),d=e.computed(()=>V.value?"移轉案件":"認領案件"),b=e.ref(0),g=e.ref([]),_=()=>{A[B.type]("queryReviewUnits").subscribe(f=>{g.value=f,rxjs.forkJoin(g.value.map(i=>A[B.type]("queryReviewersByUnit",{ID:i.UnitID}))).subscribe(i=>{i.forEach((a,u)=>{g.value[u].reviewers=a,a.some(N=>N.UserID===r.value)&&(b.value=g.value[u].UnitID)}),bootstrap.Modal.getOrCreateInstance(m.value).show()})})},h=()=>{A[B.type]("saveOrganizer",{ID:B.id,Organizer:r.value}).subscribe(f=>{f&&window.location.reload()})};return e.onMounted(()=>{A.system("getRoles").subscribe(f=>{c.value=f.IsOrganizer||f.IsSupervisor||f.IsSysAdmin})}),e.watch(V,()=>r.value=l[B.type].organizer),e.watch(b,()=>{o.value.some(f=>f.UserID===r.value)||(r.value=0)}),(f,i)=>{const a=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Hg,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(V)||"尚無"),1),e.unref(c)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal",onClick:_,type:"button"},e.toDisplayString(e.unref(d)),1)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:m,tabindex:"-1"},[e.createElementVNode("div",Wg,[e.createElementVNode("div",Kg,[e.createElementVNode("div",Xg,[e.createElementVNode("h4",Zg,e.toDisplayString(e.unref(d)),1),i[2]||(i[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",vg,[e.createElementVNode("div",null,[i[3]||(i[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(a,{"empty-value":0,options:e.unref(g),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(b),"onUpdate:modelValue":i[0]||(i[0]=u=>e.isRef(b)?b.value=u:null)},null,8,["options","modelValue"]),e.createVNode(a,{class:"mt-2","empty-value":0,options:e.unref(o),"text-name":"Name","value-name":"UserID",modelValue:e.unref(r),"onUpdate:modelValue":i[1]||(i[1]=u=>e.isRef(r)?r.value=u:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",ey,[i[4]||(i[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:h,disabled:e.unref(y),type:"button"},"確認",8,ty)])])])])],512)]))],64)}}},oy={key:0,class:"scroll-bottom-panel"},ny={class:"d-flex flex-column gap-3 mb-3"},ry={key:0,class:"d-flex gap-2 align-items-center"},ay={key:1,class:"d-flex gap-2 align-items-center"},sy={class:"d-flex gap-2"},dy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},cy={class:"text-nowrap my-2 d-flex align-items-center"},iy=["disabled"],my={__name:"ProjectPaymentReview",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j(),c=Y(),m=[{value:1,text:"通過"},{value:2,text:"退回修改"}],V=e.computed(()=>!c.stage),r=e.ref({}),o=e.ref({ID:B.id,Result:1,Reason:""}),l=e.computed(()=>o.value.Result===1?B.type==="culture"&&c.stage===2||B.type==="education"||B.type==="accessibility"&&c.stage===2?"確定撥款及結案":B.type==="multiple"&&c.stage===3||B.type==="literacy"&&c.stage===2?"確定核銷及結案":"確定撥款":"確定退回"),d=()=>{const g={};if(o.value.Result>1&&(g.Reason="原因"),r.value=M(o.value,g),Object.keys(r.value).length){b();return}o.value.Stage=c.stage,A[B.type]("reviewPayment",o.value).subscribe(_=>{_&&(window.location.href="../ReviewChecklist.aspx?type=5")})},b=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>o.value.Result,g=>{g>1&&b()}),e.watch(()=>c.amount,g=>o.value.Amount=g),(g,_)=>{const h=e.resolveComponent("input-integer"),f=e.resolveComponent("input-radio-group"),i=e.resolveComponent("input-textarea");return e.unref(c).status==="審核中"&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",oy,[_[6]||(_[6]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",ny,[e.unref(c).amount?(e.openBlock(),e.createElementBlock("li",ry,[_[3]||(_[3]=e.createElementVNode("span",{class:"text-gray"},"本期撥付：",-1)),e.createVNode(h,{class:"w-auto",max:e.unref(c).amount,modelValue:e.unref(o).Amount,"onUpdate:modelValue":_[0]||(_[0]=a=>e.unref(o).Amount=a)},null,8,["max","modelValue"])])):e.createCommentVNode("",!0),e.unref(c).paid?(e.openBlock(),e.createElementBlock("li",ay,[_[4]||(_[4]=e.createElementVNode("span",{class:"text-gray"},"前期累積撥付：",-1)),e.createTextVNode(" "+e.toDisplayString(e.unref(c).paid.toLocaleString()),1)])):e.createCommentVNode("",!0),e.createElementVNode("li",sy,[_[5]||(_[5]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",dy,[e.createElementVNode("div",cy,[e.createVNode(f,{options:m,modelValue:e.unref(o).Result,"onUpdate:modelValue":_[1]||(_[1]=a=>e.unref(o).Result=a)},null,8,["modelValue"])]),e.unref(o).Result>1?(e.openBlock(),e.createBlock(i,{key:0,error:e.unref(r).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(o).Reason,"onUpdate:modelValue":_[2]||(_[2]=a=>e.unref(o).Reason=a)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:d,disabled:e.unref(V),type:"button"},e.toDisplayString(e.unref(l)),9,iy)])):e.createCommentVNode("",!0)}}},py={class:"step-line-wrapper"},Vy={class:"step-line"},fy={key:0,class:"tag tag-white"},Ny={key:1,class:"tag tag-white"},Ey={key:0,class:"step-line"},by={key:0,class:"tag tag-white"},gy={class:"step-line"},yy={key:0,class:"tag tag-white"},ky={key:0,class:"tag tag-white"},uy={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(x){const B=j(),y=x,c=m=>{location.href=`${m}.aspx?ID=${y.id}`};return(m,V)=>(e.openBlock(),e.createElementBlock("div",py,[e.createElementVNode("div",Vy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===1}]),onClick:V[0]||(V[0]=r=>c("Audit")),role:"button"},[V[4]||(V[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),x.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(B)[y.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",fy,"編輯中")):e.unref(B)[y.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",Ny,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),x.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ey,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===4}]),onClick:V[1]||(V[1]=r=>c("Progress")),role:"button"},[V[5]||(V[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),x.step===4?(e.openBlock(),e.createElementBlock("div",by,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",gy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===5}]),onClick:V[2]||(V[2]=r=>c("Report")),role:"button"},[V[6]||(V[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),x.step===5?(e.openBlock(),e.createElementBlock("div",yy,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===6}]),onClick:V[3]||(V[3]=r=>c("Payment")),role:"button"},[V[7]||(V[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),x.step===6?(e.openBlock(),e.createElementBlock("div",ky,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},hy={class:"block"},xy={class:"square-title"},$y=["innerHTML"],By={class:"table-responsive mt-3"},_y={class:"table align-middle gray-table"},Cy={key:0,class:"text-center"},Ty={class:"text-center"},wy=["href"],Dy={key:0,class:"text-center"},Sy={key:0},Ay={key:1,class:"text-pink"},Fy={key:1,class:"tag-group mt-2 gap-1"},Uy={key:0,class:"tag tag-green-light"},Py=["download","href"],My=["onClick"],Iy={key:0,class:"block-bottom bg-light-teal"},jy=["disabled"],Oy={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]},type:{type:String}},emits:["next"],setup(x,{emit:B}){let y;const c=x,m=e.computed(()=>V.value.some(h=>!h.Optional&&!h.Files.filter(f=>!f.Deleted).length)),V=e.ref(c.data.docs.map(h=>({...h,Files:[]}))),r=e.ref(),o=e.ref({}),l=(h,f)=>{(f.Type==="application/zip"||f.Type==="application/x-zip-compressed")&&h.Files.push({Type:h.Type,Path:f.Path,Name:`${c.id}_${h.Title}_${y}.zip`})},d=A.download,b=B,g=()=>{A[c.type]("getReport",{ID:c.id,Stage:c.data.id}).subscribe(h=>{var f;o.value=h.Report,V.value.forEach(i=>{i.Files=h.Attachments.filter(a=>a.Type===i.Type),i.Uploaded=e.computed(()=>i.Files.filter(a=>!a.Deleted).length)}),r.value=!o.value.Status||o.value.Status==="暫存"||o.value.Status==="退回修正",y=(f=o.value)!=null&&f.Reviewer?"修訂版":"初版",j().init(c.type,h.Project,o.value)})},_=h=>{const f={ID:c.id,Stage:c.data.id,Attachments:V.value.reduce((i,a)=>i.concat(a.Files),[]),Submit:h?"true":"false"};A[c.type]("saveReport",f).subscribe(()=>{h?b("next"):g()})};return e.onMounted(g),e.provide("editable",r),(h,f)=>{const i=e.resolveComponent("required-label"),a=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",hy,[e.createElementVNode("h5",xy,e.toDisplayString(x.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:x.data.description},null,8,$y),e.createElementVNode("div",By,[e.createElementVNode("table",_y,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[f[2]||(f[2]=e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號",-1)),f[3]||(f[3]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Cy,"狀態")):e.createCommentVNode("",!0),f[4]||(f[4]=e.createElementVNode("th",null,"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(u,N)=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Ty,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(i,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.Title),1)]),_:2},1024)]),e.unref(r)&&u.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:u.Template,style:{width:"140px"},type:"button"},[...f[5]||(f[5]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,wy)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Dy,[u.Uploaded?(e.openBlock(),e.createElementBlock("span",Sy,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ay,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!u.Uploaded?(e.openBlock(),e.createBlock(a,{key:0,accept:".zip",onFile:n=>l(u,n)},null,8,["onFile"])):e.createCommentVNode("",!0),u.Uploaded?(e.openBlock(),e.createElementBlock("div",Fy,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.Files,n=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:n},[n.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Uy,[e.createElementVNode("a",{class:"tag-link my-1",download:n.Name,href:e.unref(d)(n.Path)},e.toDisplayString(n.Name),9,Py),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:s=>n.Deleted=!0,type:"button"},[...f[6]||(f[6]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,My)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Iy,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:f[0]||(f[0]=u=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:f[1]||(f[1]=u=>_(!0)),disabled:e.unref(m),type:"button"},[...f[7]||(f[7]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,jy)])):e.createCommentVNode("",!0)],64)}}},Ly={key:0,class:"scroll-bottom-panel"},Ry={class:"d-flex flex-column gap-3 mb-3"},qy={class:"d-flex gap-2"},zy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Gy={class:"text-nowrap my-2 d-flex align-items-center"},Jy={__name:"ProjectReportReview",props:{id:{type:[Number,String]},stage:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],m=e.ref({}),V=e.ref({ID:B.id,Result:1}),r=()=>{const l={};if(V.value.Result>1&&(l.Reason="原因"),m.value=M(V.value,l),Object.keys(m.value).length){o();return}V.value.Stage=B.stage,A[B.type]("reviewReport",V.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=6")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,l=>{l>1&&o()}),(l,d)=>{const b=e.resolveComponent("input-radio-group"),g=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",Ly,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ry,[e.createElementVNode("li",qy,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",zy,[e.createElementVNode("div",Gy,[e.createVNode(b,{options:c,modelValue:e.unref(V).Result,"onUpdate:modelValue":d[0]||(d[0]=_=>e.unref(V).Result=_)},null,8,["modelValue"])]),e.unref(V).Result>1?(e.openBlock(),e.createBlock(g,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":d[1]||(d[1]=_=>e.unref(V).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Yy={key:0,class:"scroll-bottom-panel"},Qy={class:"d-flex flex-column gap-3 mb-3"},Hy={class:"d-flex gap-2"},Wy={class:"d-flex gap-2"},Ky={class:"text-pink"},Xy={class:"d-flex gap-2"},Zy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},vy={class:"text-nowrap mb-2 d-flex align-items-center"},ek={key:0,class:"invalid mt-0"},tk={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],m=["無","低風險","中風險","高風險"],V=e.ref({}),r=e.ref({ID:B.id,Result:1}),o=e.ref({}),l=e.ref(0),d=()=>{window.open(A.toUrl(`/OFS/ApplicationChecklist.aspx?Year=${o.value.Year}&OrgName=${encodeURIComponent(o.value.OrgName)}`),"_blank")},b=()=>{window.open(A.toUrl(`/OFS/AuditHistory.aspx?Name=${encodeURIComponent(o.value.OrgName)}`),"_blank")},g=()=>{const h={};if(r.value.Result>1&&(h.Reason="原因"),r.value.Result===3&&(h.CorrectionDeadline="補正期限"),V.value=M(r.value,h),Object.keys(V.value).length){_();return}A[B.type]("reviewApplication",r.value).subscribe(f=>{f&&(window.location.href="../ReviewChecklist.aspx?type=1")})},_=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.onMounted(()=>{A[B.type]("getReviewInfo",{ID:B.id}).subscribe(h=>{o.value=h,o.value.AuditRecords.forEach(f=>{switch(f.Risk){case"Low":l.value<1&&(l.value=1);break;case"Medium":l.value<2&&(l.value=2);break;case"High":l.value<3&&(l.value=3);break}})})}),e.watch(()=>r.value.Result,h=>{h>1&&_()}),(h,f)=>{const i=e.resolveComponent("input-radio-group"),a=e.resolveComponent("input-tw-date"),u=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",Yy,[f[8]||(f[8]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Qy,[e.createElementVNode("li",Hy,[f[3]||(f[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:d,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).OtherCount),1)]),e.createElementVNode("li",Wy,[f[6]||(f[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),e.createElementVNode("span",Ky,e.toDisplayString(m[e.unref(l)]),1),e.createElementVNode("span",null,[f[4]||(f[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:b,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).AuditRecords.length),1),f[5]||(f[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",Xy,[f[7]||(f[7]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Zy,[e.createElementVNode("div",vy,[e.createVNode(i,{options:c,modelValue:e.unref(r).Result,"onUpdate:modelValue":f[0]||(f[0]=N=>e.unref(r).Result=N)},null,8,["modelValue"]),e.createVNode(a,{class:"form-control",drops:"up",modelValue:e.unref(r).CorrectionDeadline,"onUpdate:modelValue":f[1]||(f[1]=N=>e.unref(r).CorrectionDeadline=N)},null,8,["modelValue"])]),e.unref(V).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",ek,e.toDisplayString(e.unref(V).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(r).Result>1?(e.openBlock(),e.createBlock(u,{key:1,error:e.unref(V).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(r).Reason,"onUpdate:modelValue":f[2]||(f[2]=N=>e.unref(r).Reason=N)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:g,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},lk={class:"top-wrapper"},ok={class:"top-block"},nk={class:"d-flex align-items-center gap-3"},rk=["href"],ak={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j();return(c,m)=>(e.openBlock(),e.createElementBlock("div",lk,[e.createElementVNode("div",ok,[e.createElementVNode("div",nk,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(y)[B.type].type)+"］"+e.toDisplayString(e.unref(y)[B.type].id)+"/"+e.toDisplayString(e.unref(y)[B.type].name),1)]),e.createElementVNode("a",{class:"btn btn-teal-dark",href:`../AuditRecords.aspx?ProjectID=${x.id}`,target:"_blank"}," 查核紀錄 ",8,rk)])]))}},sk={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},dk={class:"d-flex gap-2"},ck={key:0,class:"btn text-teal-dark",type:"button"},ik=["href"],mk=["href"],pk={class:"d-flex gap-2"},Vk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},fk={class:"modal-content"},Nk={class:"modal-body"},Ek={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},bk={class:"modal-content"},gk={class:"modal-body"},yk={class:"d-flex flex-column gap-4 mb-5"},kk={class:"d-flex align-items-center"},uk={class:"flex-grow-1"},hk={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=j(),y=x,c=e.ref({}),m=e.ref(),V=e.ref({}),r=e.ref(),o=e.ref({}),l=e.ref(),d=e.computed(()=>{let i="";switch(y.type){case"culture":i="CUL";break;case"education":i="EDC";break;case"multiple":i="MUL";break;case"literacy":i="LIT";break;case"accessibility":i="ACC";break}return`../../Service/OFS/DownloadPdf.ashx?Type=${i}&ProjectID=${y.id}&Version=2`}),b=e.computed(()=>A.toUrl(`/OFS/PlanChangeRecords.aspx?ProjectID=${y.id}`)),g=()=>{const i={Reason:"計畫變更原因"};V.value=M(c.value,i),!Object.keys(V.value).length&&A[y.type]("applyChange",c.value).subscribe(a=>{a&&location.reload()})},_=()=>{c.value={ID:y.id},bootstrap.Modal.getOrCreateInstance(m.value).show()},h=()=>{o.value={ID:y.id},bootstrap.Modal.getOrCreateInstance(l.value).show()},f=()=>{const i={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};V.value=M(o.value,i),!Object.keys(V.value).length&&A[y.type]("terminate",o.value).subscribe(a=>{a&&(location.href="../ApplicationChecklist.aspx")})};return(i,a)=>{const u=e.resolveComponent("project-organizer"),N=e.resolveComponent("input-textarea"),n=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",sk,[e.createElementVNode("div",dk,[e.unref(B)[x.type].changeStatus?(e.openBlock(),e.createElementBlock("button",ck," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:_,type:"button"}," 計畫變更申請 ")),e.createElementVNode("a",{class:"btn btn-teal-dark",href:e.unref(b),target:"_blank"},[...a[3]||(a[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])],8,ik),e.createElementVNode("a",{class:"btn btn-teal-dark",download:"",href:e.unref(d)},[...a[4]||(a[4]=[e.createElementVNode("i",{class:"fa-solid fa-download"},null,-1),e.createTextVNode(" 下載核定計畫書 ",-1)])],8,mk)]),e.createElementVNode("div",pk,[e.createVNode(u,{id:x.id,type:x.type},null,8,["id","type"]),e.unref(B)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-pink",onClick:h,type:"button"}," 計畫終止 ")):e.createCommentVNode("",!0)])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:m,tabindex:"-1"},[e.createElementVNode("div",Vk,[e.createElementVNode("div",fk,[a[8]||(a[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Nk,[a[6]||(a[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),a[7]||(a[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(N,{error:e.unref(V).Reason,modelValue:e.unref(c).Reason,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(c).Reason=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[5]||(a[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:g},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:r,tabindex:"-1"},[...a[9]||(a[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:l,tabindex:"-1"},[e.createElementVNode("div",Ek,[e.createElementVNode("div",bk,[a[14]||(a[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",gk,[e.createElementVNode("div",yk,[e.createElementVNode("div",null,[a[10]||(a[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(N,{error:e.unref(V).RejectReason,modelValue:e.unref(o).RejectReason,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(o).RejectReason=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),a[12]||(a[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",kk,[a[11]||(a[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",uk,[e.createVNode(n,{error:e.unref(V).RecoveryAmount,modelValue:e.unref(o).RecoveryAmount,"onUpdate:modelValue":a[2]||(a[2]=s=>e.unref(o).RecoveryAmount=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[13]||(a[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:f},"送出")])])])])],512)]))],64)}}},xk={class:"search bg-gray mt-4"},$k={class:"search-form"},Bk={class:"row g-3"},_k={class:"col-12 col-lg-4"},Ck=["value"],Tk={class:"col-12 col-lg-4"},wk=["value"],Dk={class:"row g-3"},Sk={class:"col-12 col-lg-6"},Ak={class:"col-12 col-lg-6"},Fk={class:"total-list multiple-option"},Uk={class:"all-total"},Pk={class:"total-item-content"},Mk={class:"count"},Ik=["for"],jk={class:"total-item-title"},Ok={class:"total-item-content"},Lk={class:"count"},Rk=["id","onUpdate:modelValue"],qk={class:"block rounded-bottom-4"},zk={class:"title border-teal"},Gk={class:"d-flex align-items-center gap-2"},Jk={class:"text-teal"},Yk={class:"table-responsive",style:{"min-height":"400px"}},Qk={class:"table teal-table"},Hk={class:"total-row"},Wk={class:"text-end"},Kk={class:"text-end"},Xk={class:"text-end"},Zk={"data-th":"年度:"},vk={"data-th":"類別:"},eu={"data-th":"計畫名稱:",style:{"text-align":"left"}},tu=["href"],lu={"data-th":"申請單位:",style:{"text-align":"left"}},ou={"data-th":"申請本會補助:",class:"text-end"},nu={"data-th":"配合款:",class:"text-end"},ru={"data-th":"總經費:",class:"text-end"},au={"data-th":"狀態:",style:{"text-align":"center",width:"100px"}},su={class:"text-teal"},du={__name:"ApplyList",setup(x){const B=e.ref([{id:1,title:"申請中",checked:!0},{id:2,title:"審查中",checked:!0},{id:3,title:"已核定",checked:!0},{id:4,title:"未通過",checked:!0}]),y=e.ref([]),c=e.ref({}),m=e.ref([]),V=e.ref(1),r=e.ref(10),o=e.ref([]),l=e.computed(()=>b.value.filter(h=>B.value.find(f=>f.checked&&h.type===f.id))),d=e.computed(()=>l.value.slice((V.value-1)*r.value,V.value*r.value)),b=e.computed(()=>{let h=m.value;return c.value.category&&(h=h.filter(f=>f.Category===c.value.category)),c.value.unit&&(h=h.filter(f=>f.SupervisoryUnit===c.value.unit)),c.value.org&&(h=h.filter(f=>{var i;return(i=f.OrgName)==null?void 0:i.includes(c.value.org)})),c.value.name&&(h=h.filter(f=>{var i;return f.ProjectID.includes(c.value.name)||((i=f.ProjectName)==null?void 0:i.includes(c.value.name))})),h}),g=(h,f)=>{V.value=parseInt(h),r.value=parseInt(f)},_=h=>{if(h.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("CLB"))return`../CLB/ClbApplication.aspx?ProjectID=${h.ProjectID}`;if(h.ProjectID.includes("SCI"))return`../SCI/SciApplication.aspx?ProjectID=${h.ProjectID}`};return e.onMounted(()=>{A.system("getApplyList").subscribe(h=>{m.value=h.List,m.value.forEach(f=>{[1,14].includes(f.Status)?f.type=1:[11,12,21,22,31,32,41,42,43,44].includes(f.Status)?f.type=2:[45,51,52,91].includes(f.Status)?f.type=3:f.type=4,y.value.includes(f.Category)||y.value.push(f.Category),o.value.includes(f.SupervisoryUnit)||o.value.push(f.SupervisoryUnit)})})}),(h,f)=>{const i=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",xk,[f[12]||(f[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",$k,[e.createElementVNode("div",Bk,[f[8]||(f[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",_k,[f[5]||(f[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":f[0]||(f[0]=u=>e.unref(c).category=u)},[f[4]||(f[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),u=>(e.openBlock(),e.createElementBlock("option",{key:u,value:u},e.toDisplayString(u),9,Ck))),128))],512),[[e.vModelSelect,e.unref(c).category]])]),e.createElementVNode("div",Tk,[f[7]||(f[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":f[1]||(f[1]=u=>e.unref(c).unit=u)},[f[6]||(f[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),u=>(e.openBlock(),e.createElementBlock("option",{key:u,value:u},e.toDisplayString(u),9,wk))),128))],512),[[e.vModelSelect,e.unref(c).unit]])])]),e.createElementVNode("div",Dk,[e.createElementVNode("div",Sk,[f[9]||(f[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(i,{modelValue:e.unref(c).org,"onUpdate:modelValue":f[2]||(f[2]=u=>e.unref(c).org=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Ak,[f[10]||(f[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(i,{modelValue:e.unref(c).name,"onUpdate:modelValue":f[3]||(f[3]=u=>e.unref(c).name=u),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),f[11]||(f[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("ul",Fk,[e.createElementVNode("li",Uk,[f[14]||(f[14]=e.createElementVNode("div",{class:"total-item-title"},"總申請",-1)),e.createElementVNode("div",Pk,[e.createElementVNode("span",Mk,e.toDisplayString(e.unref(b).length),1),f[13]||(f[13]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),u=>(e.openBlock(),e.createElementBlock("li",{class:"total-item",key:u},[e.createElementVNode("label",{class:"checke-total",for:`apply-${u.id}`},[e.createElementVNode("div",null,[e.createElementVNode("div",jk,e.toDisplayString(u.title),1),e.createElementVNode("div",Ok,[e.createElementVNode("span",Lk,e.toDisplayString(e.unref(b).filter(N=>N.type===u.id).length),1),f[15]||(f[15]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),f[16]||(f[16]=e.createElementVNode("img",{class:"check-icon",src:"../../assets/img/check-white.svg"},null,-1))],8,Ik),e.withDirectives(e.createElementVNode("input",{class:"total-checkbox",id:`apply-${u.id}`,type:"checkbox","onUpdate:modelValue":N=>u.checked=N},null,8,Rk),[[e.vModelCheckbox,u.checked]])]))),128))]),e.createElementVNode("div",qk,[e.createElementVNode("div",zk,[e.createElementVNode("div",Gk,[f[19]||(f[19]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[f[17]||(f[17]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Jk,e.toDisplayString(e.unref(l).length),1),f[18]||(f[18]=e.createTextVNode(" 筆資料",-1))])]),f[20]||(f[20]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Yk,[e.createElementVNode("table",Qk,[e.createElementVNode("thead",null,[f[23]||(f[23]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"申請本會補助")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"總經費")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"狀態")])])],-1)),e.createElementVNode("tr",Hk,[f[21]||(f[21]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Wk,e.toDisplayString(e.unref(l).reduce((u,N)=>u+N.ApplyAmount,0).toLocaleString()),1),e.createElementVNode("td",Kk,e.toDisplayString(e.unref(l).reduce((u,N)=>u+N.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Xk,e.toDisplayString(e.unref(l).reduce((u,N)=>u+N.ApplyAmount+N.OtherAmount,0).toLocaleString()),1),f[22]||(f[22]=e.createElementVNode("td",null,null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),u=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Zk,e.toDisplayString(u.Year),1),e.createElementVNode("td",vk,e.toDisplayString(u.Category),1),e.createElementVNode("td",eu,[e.createElementVNode("a",{class:"link-black",href:_(u),target:"_blank"},e.toDisplayString(u.ProjectName||"[未設定]"),9,tu)]),e.createElementVNode("td",lu,e.toDisplayString(u.OrgName),1),e.createElementVNode("td",ou,e.toDisplayString(u.ApplyAmount.toLocaleString()),1),e.createElementVNode("td",nu,e.toDisplayString(u.OtherAmount.toLocaleString()),1),e.createElementVNode("td",ru,e.toDisplayString((u.ApplyAmount+u.OtherAmount).toLocaleString()),1),e.createElementVNode("td",au,[e.createElementVNode("span",su,e.toDisplayString(e.unref(B).find(N=>N.id===u.type).title),1)])]))),128))])])]),e.createVNode(a,{count:e.unref(l).length,onChange:g,page:e.unref(V),"page-size":e.unref(r)},null,8,["count","page","page-size"])])],64)}}},cu={class:"search bg-gray mt-4"},iu={class:"search-form"},mu={class:"row g-3"},pu={class:"col-12 col-lg-4"},Vu=["value"],fu={class:"col-12 col-lg-4"},Nu=["value"],Eu={class:"row g-3"},bu={class:"col-12 col-lg-6"},gu={class:"col-12 col-lg-6"},yu={class:"block rounded-bottom-4"},ku={class:"title border-teal"},uu={class:"d-flex align-items-center gap-2"},hu={class:"text-teal"},xu={class:"table-responsive",style:{"min-height":"400px"}},$u={class:"table teal-table"},Bu={class:"total-row"},_u={class:"text-end"},Cu={class:"text-end"},Tu={"data-th":"年度:"},wu={"data-th":"類別:"},Du={"data-th":"計畫名稱:",style:{"text-align":"left"}},Su=["href"],Au={"data-th":"申請單位:",style:{"text-align":"left"}},Fu={"data-th":"本會補助金額:",class:"text-end"},Uu={"data-th":"配合款:",class:"text-end"},Pu={__name:"ApprovedList",props:{category:{type:String}},setup(x){const B=x,y={ACC:"無障礙",CLB:"學校社團",CUL:"文化",EDC:"學校／民間",LIT:"素養",MUL:"多元",SCI:"科專"},c=e.ref([]),m=e.ref({}),V=e.ref([]),r=e.ref(1),o=e.ref(10),l=e.ref([]),d=e.computed(()=>b.value.slice((r.value-1)*o.value,r.value*o.value)),b=e.computed(()=>{let h=V.value;return m.value.category&&(h=h.filter(f=>f.Category===m.value.category)),m.value.unit&&(h=h.filter(f=>f.SupervisoryUnit===m.value.unit)),m.value.org&&(h=h.filter(f=>{var i;return(i=f.OrgName)==null?void 0:i.includes(m.value.org)})),m.value.name&&(h=h.filter(f=>{var i;return f.ProjectID.includes(m.value.name)||((i=f.ProjectName)==null?void 0:i.includes(m.value.name))})),h}),g=(h,f)=>{r.value=parseInt(h),o.value=parseInt(f)},_=h=>{if(h.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${h.ProjectID}`;if(h.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${h.ProjectID}`};return e.onMounted(()=>{A.system("getApprovedList").subscribe(h=>{if(V.value=h.List,V.value.forEach(f=>{c.value.includes(f.Category)||c.value.push(f.Category),l.value.includes(f.SupervisoryUnit)||l.value.push(f.SupervisoryUnit)}),B.category){const f=y[B.category];c.value.includes(f)&&(m.value.category=f)}})}),(h,f)=>{const i=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cu,[f[12]||(f[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",iu,[e.createElementVNode("div",mu,[f[8]||(f[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",pu,[f[5]||(f[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":f[0]||(f[0]=u=>e.unref(m).category=u)},[f[4]||(f[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),u=>(e.openBlock(),e.createElementBlock("option",{key:u,value:u},e.toDisplayString(u),9,Vu))),128))],512),[[e.vModelSelect,e.unref(m).category]])]),e.createElementVNode("div",fu,[f[7]||(f[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":f[1]||(f[1]=u=>e.unref(m).unit=u)},[f[6]||(f[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),u=>(e.openBlock(),e.createElementBlock("option",{key:u,value:u},e.toDisplayString(u),9,Nu))),128))],512),[[e.vModelSelect,e.unref(m).unit]])])]),e.createElementVNode("div",Eu,[e.createElementVNode("div",bu,[f[9]||(f[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(i,{modelValue:e.unref(m).org,"onUpdate:modelValue":f[2]||(f[2]=u=>e.unref(m).org=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",gu,[f[10]||(f[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(i,{modelValue:e.unref(m).name,"onUpdate:modelValue":f[3]||(f[3]=u=>e.unref(m).name=u),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),f[11]||(f[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",yu,[e.createElementVNode("div",ku,[e.createElementVNode("div",uu,[f[15]||(f[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[f[13]||(f[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",hu,e.toDisplayString(e.unref(b).length),1),f[14]||(f[14]=e.createTextVNode(" 筆資料",-1))])]),f[16]||(f[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",xu,[e.createElementVNode("table",$u,[e.createElementVNode("thead",null,[f[18]||(f[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])])],-1)),e.createElementVNode("tr",Bu,[f[17]||(f[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",_u,e.toDisplayString(e.unref(b).reduce((u,N)=>u+N.ApprovedAmount,0).toLocaleString()),1),e.createElementVNode("td",Cu,e.toDisplayString(e.unref(b).reduce((u,N)=>u+N.OtherAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),u=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",Tu,e.toDisplayString(u.Year),1),e.createElementVNode("td",wu,e.toDisplayString(u.Category),1),e.createElementVNode("td",Du,[e.createElementVNode("a",{class:"link-black",href:_(u),target:"_blank"},e.toDisplayString(u.ProjectName),9,Su)]),e.createElementVNode("td",Au,e.toDisplayString(u.OrgName),1),e.createElementVNode("td",Fu,e.toDisplayString(u.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Uu,e.toDisplayString(u.OtherAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(a,{count:e.unref(b).length,onChange:g,page:e.unref(r),"page-size":e.unref(o)},null,8,["count","page","page-size"])])],64)}}},Mu={class:"search bg-gray mt-4"},Iu={class:"search-form"},ju={class:"row g-3"},Ou={class:"col-12 col-lg-4"},Lu=["value"],Ru={class:"col-12 col-lg-4"},qu=["value"],zu={class:"row g-3"},Gu={class:"col-12 col-lg-6"},Ju={class:"col-12 col-lg-6"},Yu={class:"block rounded-bottom-4"},Qu={class:"title border-teal"},Hu={class:"d-flex align-items-center gap-2"},Wu={class:"text-teal"},Ku={class:"table-responsive",style:{"min-height":"400px"}},Xu={class:"table teal-table"},Zu={class:"total-row"},vu={class:"text-end"},eh={class:"text-end"},th={class:"text-end"},lh={class:"text-end"},oh={class:"text-end"},nh={"data-th":"年度:"},rh={"data-th":"類別:"},ah={"data-th":"計畫名稱:",style:{"text-align":"left"}},sh=["href"],dh={"data-th":"申請單位:",style:{"text-align":"left"}},ch={"data-th":"本會補助金額:",class:"text-end"},ih={"data-th":"配合款:",class:"text-end"},mh={"data-th":"實支金額:",class:"text-end"},ph={"data-th":"累積經費執行率:",class:"text-end"},Vh={"data-th":"本會已撥金額:",class:"text-end"},fh={__name:"InprogressList",setup(x){const B=e.ref([]),y=e.ref({}),c=e.ref([]),m=e.ref(1),V=e.ref(10),r=e.ref([]),o=e.computed(()=>b.value.reduce((f,i)=>f+i.ApprovedAmount,0)),l=e.computed(()=>b.value.slice((m.value-1)*V.value,m.value*V.value)),d=e.computed(()=>b.value.reduce((f,i)=>f+i.SpendAmount,0)),b=e.computed(()=>{let f=c.value;return y.value.category&&(f=f.filter(i=>i.Category===y.value.category)),y.value.unit&&(f=f.filter(i=>i.SupervisoryUnit===y.value.unit)),y.value.org&&(f=f.filter(i=>{var a;return(a=i.OrgName)==null?void 0:a.includes(y.value.org)})),y.value.name&&(f=f.filter(i=>{var a;return i.ProjectID.includes(y.value.name)||((a=i.ProjectName)==null?void 0:a.includes(y.value.name))})),f}),g=(f,i)=>{m.value=parseInt(f),V.value=parseInt(i)},_=f=>{if(f.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${f.ProjectID}`;if(f.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${f.ProjectID}`;if(f.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${f.ProjectID}`;if(f.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${f.ProjectID}`;if(f.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${f.ProjectID}`;if(f.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${f.ProjectID}`;if(f.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${f.ProjectID}`},h=(f,i)=>i?Math.round(f*100/i*100)/100:0;return e.onMounted(()=>{A.system("getInprogressList").subscribe(f=>{c.value=f.List,c.value.forEach(i=>{B.value.includes(i.Category)||B.value.push(i.Category),r.value.includes(i.SupervisoryUnit)||r.value.push(i.SupervisoryUnit)})})}),(f,i)=>{const a=e.resolveComponent("input-text"),u=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Mu,[i[12]||(i[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Iu,[e.createElementVNode("div",ju,[i[8]||(i[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",Ou,[i[5]||(i[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":i[0]||(i[0]=N=>e.unref(y).category=N)},[i[4]||(i[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),N=>(e.openBlock(),e.createElementBlock("option",{key:N,value:N},e.toDisplayString(N),9,Lu))),128))],512),[[e.vModelSelect,e.unref(y).category]])]),e.createElementVNode("div",Ru,[i[7]||(i[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":i[1]||(i[1]=N=>e.unref(y).unit=N)},[i[6]||(i[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),N=>(e.openBlock(),e.createElementBlock("option",{key:N,value:N},e.toDisplayString(N),9,qu))),128))],512),[[e.vModelSelect,e.unref(y).unit]])])]),e.createElementVNode("div",zu,[e.createElementVNode("div",Gu,[i[9]||(i[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(a,{modelValue:e.unref(y).org,"onUpdate:modelValue":i[2]||(i[2]=N=>e.unref(y).org=N),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Ju,[i[10]||(i[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(a,{modelValue:e.unref(y).name,"onUpdate:modelValue":i[3]||(i[3]=N=>e.unref(y).name=N),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),i[11]||(i[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Yu,[e.createElementVNode("div",Qu,[e.createElementVNode("div",Hu,[i[15]||(i[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[i[13]||(i[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Wu,e.toDisplayString(e.unref(b).length),1),i[14]||(i[14]=e.createTextVNode(" 筆資料",-1))])]),i[16]||(i[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Ku,[e.createElementVNode("table",Xu,[e.createElementVNode("thead",null,[i[18]||(i[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"實支金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"累積經費執行率")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會已撥金額")])])],-1)),e.createElementVNode("tr",Zu,[i[17]||(i[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",vu,e.toDisplayString(e.unref(o).toLocaleString()),1),e.createElementVNode("td",eh,e.toDisplayString(e.unref(b).reduce((N,n)=>N+n.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",th,e.toDisplayString(e.unref(d).toLocaleString()),1),e.createElementVNode("td",lh,e.toDisplayString(h(e.unref(d),e.unref(o)).toLocaleString())+"%",1),e.createElementVNode("td",oh,e.toDisplayString(e.unref(b).reduce((N,n)=>N+n.PaymentAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),N=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",nh,e.toDisplayString(N.Year),1),e.createElementVNode("td",rh,e.toDisplayString(N.Category),1),e.createElementVNode("td",ah,[e.createElementVNode("a",{class:"link-black",href:_(N),target:"_blank"},e.toDisplayString(N.ProjectName),9,sh)]),e.createElementVNode("td",dh,e.toDisplayString(N.OrgName),1),e.createElementVNode("td",ch,e.toDisplayString(N.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",ih,e.toDisplayString(N.OtherAmount.toLocaleString()),1),e.createElementVNode("td",mh,e.toDisplayString(N.SpendAmount.toLocaleString()),1),e.createElementVNode("td",ph,e.toDisplayString(h(N.SpendAmount,N.ApprovedAmount).toLocaleString())+"%",1),e.createElementVNode("td",Vh,e.toDisplayString(N.PaymentAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(u,{count:e.unref(b).length,onChange:g,page:e.unref(m),"page-size":e.unref(V)},null,8,["count","page","page-size"])])],64)}}},Nh={__name:"MixChart",props:{list:{required:!0,type:Array}},setup(x){let B;const y=K().typeList,c=x,m=e.ref(),V=o=>{am5.ready(()=>{B=am5.Root.new(m.value),B.setThemes([am5themes_Animated.new(B)]);const l=B.container.children.push(am5xy.XYChart.new(B,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,layout:B.verticalLayout})),d=am5xy.AxisRendererX.new(B,{minGridDistance:30});d.labels.template.setAll({rotation:-45,centerY:am5.p50,centerX:am5.p100,textAlign:"right"});var b=l.xAxes.push(am5xy.CategoryAxis.new(B,{categoryField:"category",renderer:d,tooltip:am5.Tooltip.new(B,{})}));b.data.setAll(o);var g=l.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{})})),_=l.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{opposite:!0}),min:0,max:1,numberFormat:"#.0%",extraMax:.1,strictMinMax:!0}));const h=(N,n,s)=>{var p=l.series.push(am5xy.ColumnSeries.new(B,{name:n,xAxis:b,yAxis:g,valueYField:N,categoryXField:"category",clustered:!0,tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY}"})}));return p.data.setAll(o),p.columns.template.setAll({fillOpacity:1,strokeOpacity:0,fill:am5.color(s),cornerRadiusTL:0,cornerRadiusTR:0,width:am5.percent(70)}),p};h("核定經費","核定經費",4946924),h("實支金額","實支金額",9323693),h("已撥付","已撥付",3447003);const f=(N,n,s)=>{var p=l.series.push(am5xy.LineSeries.new(B,{name:n,xAxis:b,yAxis:_,valueYField:N,categoryXField:"category",stroke:am5.color(s),fill:am5.color(s),tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY.formatNumber('#.0%')}"})}));return p.strokes.template.setAll({strokeWidth:3}),p.bullets.push(()=>am5.Bullet.new(B,{sprite:am5.Circle.new(B,{radius:5,fill:p.get("stroke")})})),p.data.setAll(o),p};f("經費執行率(%)","經費執行率(%)",15105570),f("支用比(%)","支用比(%)",2600544),l.children.push(am5.Legend.new(B,{centerX:am5.p50,x:am5.p50,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300})).labels.template.setAll({fontSize:12,paddingLeft:4,paddingRight:4,marginTop:4,marginBottom:4,marginLeft:4,marginRight:4});var a=l.children.push(am5.Legend.new(B,{centerX:am5.p0,x:am5.p0,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));a.data.setAll([l.series.getIndex(0),l.series.getIndex(1),l.series.getIndex(2)]);var u=l.children.push(am5.Legend.new(B,{centerX:am5.p100,x:am5.p100,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));u.data.setAll([l.series.getIndex(3),l.series.getIndex(4)]),l.set("cursor",am5xy.XYCursor.new(B,{}))})},r=(o,l,d=2)=>{if(l){const b=10**d;return Math.round(o*100/l*b)/b}return 0};return e.onMounted(()=>{V(y.map(o=>{const l={category:o.title,核定經費:0,實支金額:0,已撥付:0,"經費執行率(%)":0,"支用比(%)":0},d=c.list.find(b=>b.Category===o.code);return d&&(l.核定經費=Math.floor(d.ApprovedAmount/1e3),l.實支金額=Math.floor(d.SpendAmount/1e3),l.已撥付=Math.floor(d.PaymentAmount/1e3),l["經費執行率(%)"]=r(l.實支金額,l.核定經費,1),l["支用比(%)"]=r(l.實支金額,l.已撥付,1)),l}))}),(o,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:m},null,512))}},Eh={__name:"PieChart",props:{active:{required:!0,type:String},color:{required:!0,type:Number},inactive:{required:!0,type:String},percent:{required:!0,type:Number}},setup(x){let B,y,c;const m=x,V=e.ref();return e.onMounted(()=>{am5.ready(()=>{y=am5.Root.new(V.value),y.setThemes([am5themes_Animated.new(y)]);const r=y.container.children.push(am5percent.PieChart.new(y,{innerRadius:95,width:158,x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,layout:y.verticalLayout}));c=r.series.push(am5percent.PieSeries.new(y,{valueField:"size",categoryField:"sector"})),c.set("colors",am5.ColorSet.new(y,{colors:[am5.color(m.color),am5.color(16119285)]})),c.labels.template.set("visible",!1),c.ticks.template.set("visible",!1),c.data.setAll([{sector:m.active,size:m.percent},{sector:m.inactive,size:100-m.percent}]),c.appear(1e3,100),B=y.tooltipContainer.children.push(am5.Label.new(y,{x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,fill:am5.color(m.color),fontSize:28,fontWeight:"bold"})),B.set("text",`${m.percent}%`);const o=()=>{var l=window.innerWidth>=768&&window.innerWidth<=1024,d=l?105:158,b=l?55:95,g=l?20:28;r.set("width",d),r.set("innerRadius",b),B.set("fontSize",g)};o(),window.addEventListener("resize",o)})}),e.watch(()=>m.percent,r=>{B.set("text",`${r}%`),c.data.setAll([{sector:m.active,size:r},{sector:m.inactive,size:100-r}])}),(r,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:V},null,512))}},bh={class:"search bg-gray mt-4"},gh={class:"search-form"},yh={class:"row g-3"},kh={class:"col-12 col-lg-4"},uh={class:"col-12 col-lg-4"},hh={class:"col-12 col-lg-4"},xh={class:"row g-3"},$h={class:"col-12"},Bh={class:"block rounded-bottom-4"},_h={class:"title border-teal"},Ch={class:"d-flex align-items-center gap-2"},Th={class:"text-teal"},wh={class:"table-responsive",style:{"min-height":"400px"}},Dh={class:"table teal-table"},Sh={"data-th":"年度:"},Ah={"data-th":"計畫名稱:",class:"text-start"},Fh=["href"],Uh={"data-th":"計畫申請單位:",class:"text-start"},Ph={"data-th":"委員姓名:"},Mh={"data-th":"任職單位:",class:"text-start"},Ih={"data-th":"職稱:"},jh={"data-th":"應迴避之具體理由及事證:",class:"text-start"},Oh={__name:"RecusedList",setup(x){const B=e.ref({Year:0,Keyword:"",Name:"",Org:""}),y=e.ref([]),c=e.ref(1),m=e.ref(10),V=[],r=e.computed(()=>y.value.slice((c.value-1)*m.value,c.value*m.value)),o=(b,g)=>{c.value=parseInt(b),m.value=parseInt(g)},l=()=>{A.system("downloadRecusedList",B.value).subscribe(b=>{const g=document.createElement("a");g.download="迴避審查委員名單.xlsx",g.href=A.download(b.filename),g.click()})},d=()=>{A.system("getRecusedList",B.value).subscribe(b=>{y.value=b.List,c.value=1})};for(let b=new Date().getFullYear()-1911;b>=114;b--)V.push({text:`${b} 年`,value:b});return e.onMounted(d),(b,g)=>{const _=e.resolveComponent("input-select"),h=e.resolveComponent("input-text"),f=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",bh,[g[9]||(g[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",gh,[e.createElementVNode("div",yh,[e.createElementVNode("div",kh,[g[4]||(g[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.createVNode(_,{"empty-value":0,options:V,modelValue:e.unref(B).Year,"onUpdate:modelValue":g[0]||(g[0]=i=>e.unref(B).Year=i)},null,8,["modelValue"])]),e.createElementVNode("div",uh,[g[5]||(g[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, 任職單位, 職稱",-1)),e.createVNode(h,{placeholder:"請輸入委員姓名, 任職單位, 職稱",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":g[1]||(g[1]=i=>e.unref(B).Keyword=i),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",hh,[g[6]||(g[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫名稱",-1)),e.createVNode(h,{placeholder:"請輸入計畫名稱",modelValue:e.unref(B).Name,"onUpdate:modelValue":g[2]||(g[2]=i=>e.unref(B).Name=i),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("div",xh,[e.createElementVNode("div",$h,[g[7]||(g[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫申請單位",-1)),e.createVNode(h,{placeholder:"請輸入計畫申請單位",modelValue:e.unref(B).Org,"onUpdate:modelValue":g[3]||(g[3]=i=>e.unref(B).Org=i),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:d,type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",Bh,[e.createElementVNode("div",_h,[e.createElementVNode("div",Ch,[g[12]||(g[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[g[10]||(g[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Th,e.toDisplayString(e.unref(y).length),1),g[11]||(g[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...g[13]||(g[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",wh,[e.createElementVNode("table",Dh,[g[14]||(g[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"任職單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"職稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"應迴避之具體理由及事證")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),i=>(e.openBlock(),e.createElementBlock("tr",{key:i},[e.createElementVNode("td",Sh,e.toDisplayString(i.Year),1),e.createElementVNode("td",Ah,[e.createElementVNode("a",{class:"link-black",href:`../SCI/SciApplication.aspx?ProjectID=${i.ProjectID}`,target:"_blank"},e.toDisplayString(i.ProjectNameTw),9,Fh)]),e.createElementVNode("td",Uh,e.toDisplayString(i.OrgName),1),e.createElementVNode("td",Ph,e.toDisplayString(i.RecusedName),1),e.createElementVNode("td",Mh,e.toDisplayString(i.EmploymentUnit),1),e.createElementVNode("td",Ih,e.toDisplayString(i.JobTitle),1),e.createElementVNode("td",jh,e.toDisplayString(i.RecusedReason),1)]))),128))])])]),e.createVNode(f,{count:e.unref(y).length,onChange:o,page:e.unref(c),"page-size":e.unref(m)},null,8,["count","page","page-size"])])],64)}}},Lh={class:"block rounded-bottom-4"},Rh={class:"title border-teal"},qh={class:"d-flex align-items-center gap-2"},zh={class:"text-teal"},Gh={class:"table-responsive",style:{"min-height":"400px"}},Jh={class:"table teal-table"},Yh={"data-th":"委員姓名:",class:"text-start"},Qh={"data-th":"審查階段:",class:"text-start"},Hh={"data-th":"類別:",class:"text-start"},Wh={"data-th":"計畫編號:"},Kh={"data-th":"計畫名稱:",class:"text-start"},Xh={__name:"ReviewerDetails",props:{id:{type:String},type:{type:String}},setup(x){const B=x,y=e.ref({ID:B.id,Type:B.type}),c=e.ref([]),m=e.ref(1),V=e.ref(10),r=e.computed(()=>c.value.slice((m.value-1)*V.value,m.value*V.value)),o=(d,b)=>{m.value=parseInt(d),V.value=parseInt(b)},l=()=>{A.system("downloadReviewerDetails",y.value).subscribe(d=>{const b=document.createElement("a");b.download="審查計畫.xlsx",b.href=A.download(d.filename),b.click()})};return e.onMounted(()=>{A.system("getReviewerDetails",y.value).subscribe(d=>{c.value=d.List,m.value=1})}),(d,b)=>{const g=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",Lh,[e.createElementVNode("div",Rh,[e.createElementVNode("div",qh,[b[2]||(b[2]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"審查計畫")],-1)),e.createElementVNode("span",null,[b[0]||(b[0]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",zh,e.toDisplayString(e.unref(c).length),1),b[1]||(b[1]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...b[3]||(b[3]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",Gh,[e.createElementVNode("table",Jh,[b[4]||(b[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"計畫編號")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫名稱")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),_=>(e.openBlock(),e.createElementBlock("tr",{key:_},[e.createElementVNode("td",Yh,e.toDisplayString(_.CommitteeUser),1),e.createElementVNode("td",Qh,e.toDisplayString(x.type==1?"申請計畫":"執行計畫")+"／"+e.toDisplayString(_.ReviewStage),1),e.createElementVNode("td",Hh,e.toDisplayString(_.FieldName),1),e.createElementVNode("td",Wh,e.toDisplayString(_.ProjectID),1),e.createElementVNode("td",Kh,e.toDisplayString(_.ProjectName),1)]))),128))])])]),e.createVNode(g,{count:e.unref(c).length,onChange:o,page:e.unref(m),"page-size":e.unref(V)},null,8,["count","page","page-size"])])}}},Zh={class:"search bg-gray mt-4"},vh={class:"search-form"},ex={class:"row g-3"},tx={class:"col-3"},lx={class:"col-3"},ox={class:"col-3"},nx={class:"col-3"},rx={class:"block rounded-bottom-4"},ax={class:"title border-teal"},sx={class:"d-flex align-items-center gap-2"},dx={class:"text-teal"},cx={class:"table-responsive",style:{"min-height":"400px"}},ix={class:"table teal-table"},mx={"data-th":"委員姓名:"},px={"data-th":"Email:",class:"text-start"},Vx={"data-th":"審查階段:"},fx={"data-th":"審查計畫件數:"},Nx=["href"],Ex={"data-th":"銀行帳戶:",class:"text-start"},bx={"data-th":"戶籍地址:",class:"text-start"},gx={"data-th":"更新時間:",class:"text-start"},yx={__name:"ReviewerList",setup(x){const B=e.ref({Type:0,Keyword:"",Begin:"",End:""}),y=e.ref([]),c=e.ref(1),m=e.ref(10),V=[{text:"申請計畫審查",value:1},{text:"執行計畫審查",value:2}],r=e.computed(()=>y.value.slice((c.value-1)*m.value,c.value*m.value)),o=(b,g)=>{c.value=parseInt(b),m.value=parseInt(g)},l=()=>{A.system("downloadReviewerList",B.value).subscribe(b=>{const g=document.createElement("a");g.download="審查委員名單.xlsx",g.href=A.download(b.filename),g.click()})},d=()=>{A.system("getReviewerList",B.value).subscribe(b=>{y.value=b.List,c.value=1})};return e.onMounted(d),(b,g)=>{const _=e.resolveComponent("input-select"),h=e.resolveComponent("input-text"),f=e.resolveComponent("input-tw-date"),i=e.resolveComponent("tw-date-time"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zh,[g[9]||(g[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",vh,[e.createElementVNode("div",ex,[e.createElementVNode("div",tx,[g[4]||(g[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"審查階段",-1)),e.createVNode(_,{"empty-value":0,options:V,modelValue:e.unref(B).Type,"onUpdate:modelValue":g[0]||(g[0]=u=>e.unref(B).Type=u)},null,8,["modelValue"])]),e.createElementVNode("div",lx,[g[5]||(g[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, Email",-1)),e.createVNode(h,{placeholder:"請輸入委員姓名, Email",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":g[1]||(g[1]=u=>e.unref(B).Keyword=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",ox,[g[6]||(g[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"開始時間",-1)),e.createVNode(f,{modelValue:e.unref(B).Begin,"onUpdate:modelValue":g[2]||(g[2]=u=>e.unref(B).Begin=u)},null,8,["modelValue"])]),e.createElementVNode("div",nx,[g[7]||(g[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"結束時間",-1)),e.createVNode(f,{modelValue:e.unref(B).End,"onUpdate:modelValue":g[3]||(g[3]=u=>e.unref(B).End=u)},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:d,type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",rx,[e.createElementVNode("div",ax,[e.createElementVNode("div",sx,[g[12]||(g[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[g[10]||(g[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",dx,e.toDisplayString(e.unref(y).length),1),g[11]||(g[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...g[13]||(g[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",cx,[e.createElementVNode("table",ix,[g[14]||(g[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"Email")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查計畫件數")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"銀行帳戶")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"戶籍地址")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"更新時間")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),u=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",mx,e.toDisplayString(u.CommitteeUser),1),e.createElementVNode("td",px,e.toDisplayString(u.Email),1),e.createElementVNode("td",Vx,e.toDisplayString(u.Type===1?"申請計畫":"執行計畫"),1),e.createElementVNode("td",fx,[e.createElementVNode("a",{class:"link-black",href:`ReviewerList${u.Type}.aspx?ID=${u.ID}`,target:"_blank"},e.toDisplayString(u.Count),9,Nx)]),e.createElementVNode("td",Ex,e.toDisplayString(u.BankCode)+" "+e.toDisplayString(u.BankName)+" "+e.toDisplayString(u.BankAccount),1),e.createElementVNode("td",bx,e.toDisplayString(u.RegistrationAddress),1),e.createElementVNode("td",gx,[e.createVNode(i,{value:u.UpdateTime},null,8,["value"])])]))),128))])])]),e.createVNode(a,{count:e.unref(y).length,onChange:o,page:e.unref(c),"page-size":e.unref(m)},null,8,["count","page","page-size"])])],64)}}},kx={key:0,class:"text-pink"},ux={__name:"RequiredLabel",setup(x){const B=e.inject("editable",!0);return(y,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(B)?(e.openBlock(),e.createElementBlock("span",kx,"* ")):e.createCommentVNode("",!0),e.renderSlot(y.$slots,"default")],64))}},hx={class:"block"},xx={class:"mt-4"},$x={class:"table align-middle gray-table side-table"},Bx={class:"d-flex gap-2"},_x=["src"],Cx={key:0,class:"invalid mt-0"},Tx={__name:"ReviewCommitteeInfo",props:{token:{type:String}},setup(x){const B=x,y=e.ref([]),c=e.ref({}),m=e.ref({}),V=d=>{m.value.BankPhoto=d.Path},r=A.download,o=()=>{if(c.value={},!l()){e.nextTick(()=>{var b;return(b=document.querySelector(".invalid"))==null?void 0:b.scrollIntoView({behavior:"smooth",block:"center"})});return}const d={Token:B.token,BankCode:m.value.BankCode,BankAccount:m.value.BankAccount,BankPhoto:m.value.BankPhoto,RegistrationAddress:m.value.RegistrationAddress};A.system("saveReviewCommittee",d).subscribe(b=>{b&&alert("儲存成功")})},l=()=>{let d={BankCode:"^請選擇銀行",BankAccount:"帳戶號碼",BankPhoto:"^請上傳存摺影本",RegistrationAddress:"戶籍地址"};return c.value=M(m.value,d),!Object.keys(c.value).length};return e.onMounted(()=>{rxjs.forkJoin([A.system("getZgsCodes",{CodeGroup:"BankCode"}),A.system("getReviewCommittee",{Token:B.token})]).subscribe(d=>{y.value=d[0],m.value=d[1].Data})}),(d,b)=>{const g=e.resolveComponent("required-label"),_=e.resolveComponent("input-select"),h=e.resolveComponent("input-text"),f=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",hx,[b[7]||(b[7]=e.createElementVNode("h5",{class:"square-title"},"委員資料",-1)),e.createElementVNode("div",xx,[e.createElementVNode("table",$x,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[b[3]||(b[3]=e.createElementVNode("th",null,"審查委員",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).CommitteeUser)+" ("+e.toDisplayString(e.unref(m).Email)+") ",1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...b[4]||(b[4]=[e.createTextVNode("銀行帳戶",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Bx,[e.createElementVNode("div",null,[e.createVNode(_,{"empty-value":null,error:e.unref(c).BankCode,options:e.unref(y),placeholder:"請選擇銀行","text-name":"Descname","value-name":"Code",modelValue:e.unref(m).BankCode,"onUpdate:modelValue":b[0]||(b[0]=i=>e.unref(m).BankCode=i)},null,8,["error","options","modelValue"])]),e.createElementVNode("div",null,[e.createVNode(h,{error:e.unref(c).BankAccount,placeholder:"帳戶號碼",modelValue:e.unref(m).BankAccount,"onUpdate:modelValue":b[1]||(b[1]=i=>e.unref(m).BankAccount=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...b[5]||(b[5]=[e.createTextVNode("存摺影本",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,{accept:".jpg,.png",onFile:V}),e.unref(m).BankPhoto?(e.openBlock(),e.createElementBlock("img",{key:0,class:"img-fluid mt-2",src:e.unref(r)(e.unref(m).BankPhoto)},null,8,_x)):e.createCommentVNode("",!0)]),e.unref(c).BankPhoto?(e.openBlock(),e.createElementBlock("div",Cx,e.toDisplayString(e.unref(c).BankPhoto),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...b[6]||(b[6]=[e.createTextVNode("戶籍地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c).RegistrationAddress,placeholder:"(郵遞區號)完整地址",modelValue:e.unref(m).RegistrationAddress,"onUpdate:modelValue":b[2]||(b[2]=i=>e.unref(m).RegistrationAddress=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:o,type:"button"},[...b[8]||(b[8]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定送出",-1)])])])],64)}}},wx={class:"block"},Dx={class:"table align-middle gray-table side-table mt-4"},Sx=["value"],Ax={key:0,class:"tag-group mt-2 gap-1"},Fx={class:"tag tag-green-light"},Ux=["download","href"],Px={key:1},Mx={key:2,class:"invalid mt-0"},Ix={class:"table align-middle gray-table side-table mt-4"},jx={class:"d-flex align-items-center flex-wrap"},Ox={class:"d-flex align-items-center text-nowrap me-3"},Lx={class:"d-flex align-items-center text-nowrap"},Rx={key:0,class:"invalid mt-0"},qx={key:0,class:"table align-middle gray-table"},zx={width:"1%"},Gx={class:"row"},Jx={class:"col"},Yx={class:"col"},Qx={width:"1%"},Hx={class:"d-flex gap-2"},Wx=["onClick"],Kx={key:0},Xx={class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},Zx={__name:"GrantForm1",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=K().typeList,m=e.ref(!1),V=e.ref({}),r=e.ref({}),o=e.ref(),l=e.computed(()=>_.value.filter(u=>!u.Deleted)),d=e.computed(()=>g.value.filter(u=>!u.Deleted)),b=e.ref({}),g=e.ref([]),_=e.ref([]),h=A.download,f=B,i=u=>{var n,s,p;if(r.value={},V.value.Path=(n=o.value)==null?void 0:n.Path,V.value.Filename=(s=o.value)==null?void 0:s.Name,u){if(!a()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}V.value.Status=m.value?2:1}b.value.ShortName=(p=c.find(t=>t.code===b.value.TypeCode))==null?void 0:p.title;const N={GrantType:b.value,Content:V.value,Procedures:_.value,Links:g.value,Submit:u?"true":"false"};A.system("saveGrantTypeContent",N).subscribe(t=>{t&&f("next")})},a=()=>{let u={ServiceContent:"內容",ContactPerson:"聯絡電話及分機",ContactTel:"聯絡人",Filename:"相關檔案"};return m.value&&(u.StatusReason="下架原因"),r.value=M(V.value,u),y.id||(u={TypeCode:"補助類別",Year:"年度",FullName:"補助類別全稱"},Object.assign(r.value,M(b.value,u))),l.value.length&&(u={Content:"內容"},l.value.forEach((N,n)=>Object.assign(r.value,M(N,u,`procedure-${n}-`)))),d.value.length&&(u={Title:"參考資料名稱",URL:"網址"},d.value.forEach((N,n)=>Object.assign(r.value,M(N,u,`link-${n}-`)))),!Object.keys(r.value).length};return e.onMounted(()=>{y.id?A.system("getGrantTypeContent",{ID:y.id}).subscribe(u=>{b.value=u.GrantType,V.value=u.Content,_.value=u.Procedures,g.value=u.Links,V.value.Filename&&(o.value={Name:V.value.Filename,Path:V.value.Path}),_.value.length?_.value.forEach((N,n)=>{n&&(N.Deleted=!0)}):_.value.push({}),K().init(b.value.TypeCode)}):_.value.push({})}),(u,N)=>{const n=e.resolveComponent("required-label"),s=e.resolveComponent("input-select"),p=e.resolveComponent("input-integer"),t=e.resolveComponent("input-text"),E=e.resolveComponent("input-file"),k=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",wx,[N[37]||(N[37]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("table",Dx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[17]||(N[17]=[e.createTextVNode("補助類別(代碼)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{class:"w-auto",error:e.unref(r).TypeCode,options:e.unref(c),modelValue:e.unref(b).TypeCode,"onUpdate:modelValue":N[0]||(N[0]=w=>e.unref(b).TypeCode=w)},{default:e.withCtx(({option:w})=>[e.createElementVNode("option",{value:w.code},e.toDisplayString(w.title)+" ("+e.toDisplayString(w.code)+")",9,Sx)]),_:1},8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[18]||(N[18]=[e.createTextVNode("年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{class:"w-auto",error:e.unref(r).Year,modelValue:e.unref(b).Year,"onUpdate:modelValue":N[1]||(N[1]=w=>e.unref(b).Year=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[19]||(N[19]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(r).FullName,modelValue:e.unref(b).FullName,"onUpdate:modelValue":N[2]||(N[2]=w=>e.unref(b).FullName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[20]||(N[20]=[e.createTextVNode("相關檔案",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(顯示於首頁)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",Ax,[e.createElementVNode("span",Fx,[e.createElementVNode("a",{class:"tag-link my-1",download:e.unref(o).Name,href:e.unref(h)(e.unref(o).Path)},e.toDisplayString(e.unref(o).Name),9,Ux),e.createElementVNode("button",{class:"tag-btn",onClick:N[3]||(N[3]=w=>o.value=null),type:"button"},[...N[21]||(N[21]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])])])])):(e.openBlock(),e.createElementBlock("div",Px,[e.createVNode(E,{onFile:N[4]||(N[4]=w=>o.value=w)})])),e.unref(r).Filename?(e.openBlock(),e.createElementBlock("div",Mx,e.toDisplayString(e.unref(r).Filename),1)):e.createCommentVNode("",!0)])])])]),N[38]||(N[38]=e.createElementVNode("h5",{class:"square-title mt-4"},"我的E政府",-1)),e.createElementVNode("table",Ix,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[22]||(N[22]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{disabled:"",modelValue:e.unref(b).FullName,"onUpdate:modelValue":N[5]||(N[5]=w=>e.unref(b).FullName=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[23]||(N[23]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(r).ServiceContent,modelValue:e.unref(V).ServiceContent,"onUpdate:modelValue":N[6]||(N[6]=w=>e.unref(V).ServiceContent=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[N[24]||(N[24]=e.createElementVNode("th",null,"關鍵字",-1)),e.createElementVNode("td",null,[e.createVNode(t,{modelValue:e.unref(V).Keywords,"onUpdate:modelValue":N[7]||(N[7]=w=>e.unref(V).Keywords=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[N[25]||(N[25]=e.createElementVNode("th",null,"申辦資格",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(V).Criteria,"onUpdate:modelValue":N[8]||(N[8]=w=>e.unref(V).Criteria=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[26]||(N[26]=[e.createTextVNode("申辦流程",-1)])]),_:1})]),e.createElementVNode("td",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(w,C)=>(e.openBlock(),e.createBlock(k,{key:w,error:e.unref(r)[`procedure-${C}-Content`],modelValue:w.Content,"onUpdate:modelValue":S=>w.Content=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"]))),128))])]),e.createElementVNode("tr",null,[N[27]||(N[27]=e.createElementVNode("th",null,"應備物品",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(V).Documentary,"onUpdate:modelValue":N[9]||(N[9]=w=>e.unref(V).Documentary=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...N[28]||(N[28]=[e.createTextVNode("聯絡窗口",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",jx,[e.createElementVNode("div",Ox,[N[29]||(N[29]=e.createElementVNode("label",{class:"me-2"},"聯絡電話及分機",-1)),e.createVNode(t,{modelValue:e.unref(V).ContactTel,"onUpdate:modelValue":N[10]||(N[10]=w=>e.unref(V).ContactTel=w),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Lx,[N[30]||(N[30]=e.createElementVNode("label",{class:"me-2"},"聯絡人",-1)),e.createVNode(t,{modelValue:e.unref(V).ContactPerson,"onUpdate:modelValue":N[11]||(N[11]=w=>e.unref(V).ContactPerson=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.unref(r).ContactTel||e.unref(r).ContactPerson?(e.openBlock(),e.createElementBlock("div",Rx,e.toDisplayString(e.unref(r).ContactTel||e.unref(r).ContactPerson),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[N[33]||(N[33]=e.createElementVNode("th",null,[e.createTextVNode("線上申辦"),e.createElementVNode("br"),e.createTextVNode("參考資料")],-1)),e.createElementVNode("td",null,[e.unref(d).length?(e.openBlock(),e.createElementBlock("table",qx,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(w,C)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",zx,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",Gx,[e.createElementVNode("div",Jx,[e.createVNode(t,{error:e.unref(r)[`link-${C}-Title`],placeholder:"參考資料名稱",modelValue:w.Title,"onUpdate:modelValue":S=>w.Title=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Yx,[e.createVNode(t,{error:e.unref(r)[`link-${C}-URL`],placeholder:"網址",modelValue:w.URL,"onUpdate:modelValue":S=>w.URL=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("td",Qx,[e.createElementVNode("div",Hx,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:S=>w.Deleted=!0,type:"button"},[...N[31]||(N[31]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Wx)])])]))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:N[12]||(N[12]=w=>e.unref(g).push({})),type:"button"},[...N[32]||(N[32]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])]),e.unref(V).Status===1?(e.openBlock(),e.createElementBlock("tr",Kx,[N[35]||(N[35]=e.createElementVNode("th",null,"申請下架",-1)),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"status-checkbox",type:"checkbox","onUpdate:modelValue":N[13]||(N[13]=w=>e.isRef(m)?m.value=w:null)},null,512),[[e.vModelCheckbox,e.unref(m)]]),N[34]||(N[34]=e.createElementVNode("label",{class:"form-check-label ms-1 mb-2",for:"status-checkbox"},"申請E政府下架（請輸入原因）",-1)),e.createVNode(k,{error:e.unref(r).StatusReason,modelValue:e.unref(V).StatusReason,"onUpdate:modelValue":N[14]||(N[14]=w=>e.unref(V).StatusReason=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",Xx,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:N[15]||(N[15]=w=>i()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:N[16]||(N[16]=w=>i(!0)),type:"button"},[...N[36]||(N[36]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定發布",-1)])])])])}}},vx={class:"block"},e$={class:"table align-middle gray-table side-table"},t$={class:"p-0"},l$={class:"row align-items-center mb-0"},o$={class:"col p-4"},n$={class:"col p-4"},r$={class:"col p-4"},a$={class:"d-flex align-items-center flex-wrap gap-2"},s$={class:"input-group",style:{width:"360px"}},d$={class:"d-flex align-items-center flex-wrap gap-2"},c$={class:"input-group",style:{width:"360px"}},i$={style:{width:"360px"}},m$={class:"d-flex align-items-center mb-2"},p$={class:"d-flex align-items-center mb-2"},V$={class:"d-flex align-items-center mb-2"},f$={class:"d-flex align-items-center mb-2"},N$={class:"d-flex align-items-center gap-2"},E$={class:"d-flex align-items-center flex-wrap gap-2"},b$={class:"input-group",style:{width:"360px"}},g$={class:"d-flex align-items-center flex-wrap gap-2"},y$={class:"input-group",style:{width:"360px"}},k$={__name:"GrantForm2",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),m=e.ref(!1),V=B,r=()=>{const o={};m.value||(c.value.OverduePeriod=null),A.system("saveGrantType",{GrantType:Object.assign(c.value,o)}).subscribe(l=>{l&&V("next")})};return e.onMounted(()=>{A.system("getGrantType",{ID:y.id}).subscribe(o=>{c.value=o.GrantType,c.value.OverduePeriod&&(m.value=!0)})}),(o,l)=>{const d=e.resolveComponent("input-integer"),b=e.resolveComponent("input-textarea"),g=e.resolveComponent("input-tw-date"),_=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock("div",vx,[e.createElementVNode("table",e$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[l[18]||(l[18]=e.createElementVNode("th",null,"補助類別 全稱",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).FullName),1)]),e.createElementVNode("tr",null,[l[21]||(l[21]=e.createElementVNode("th",null,"補助類別 簡稱",-1)),e.createElementVNode("td",t$,[e.createElementVNode("div",l$,[e.createElementVNode("div",o$,e.toDisplayString(e.unref(c).ShortName),1),l[19]||(l[19]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"代碼",-1)),e.createElementVNode("div",n$,e.toDisplayString(e.unref(c).TypeCode),1),l[20]||(l[20]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"年度",-1)),e.createElementVNode("div",r$,e.toDisplayString(e.unref(c).Year),1)])])]),e.createElementVNode("tr",null,[l[22]||(l[22]=e.createElementVNode("th",null,"總預算經費(元)",-1)),e.createElementVNode("td",null,[e.createVNode(d,{class:"w-auto",modelValue:e.unref(c).BudgetFees,"onUpdate:modelValue":l[0]||(l[0]=h=>e.unref(c).BudgetFees=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[23]||(l[23]=e.createElementVNode("th",null,"身分標籤",-1)),e.createElementVNode("td",null,[e.createVNode(b,{rows:"5",modelValue:e.unref(c).TargetTags,"onUpdate:modelValue":l[1]||(l[1]=h=>e.unref(c).TargetTags=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[25]||(l[25]=e.createElementVNode("th",null,"申請期間",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",a$,[e.createElementVNode("div",s$,[e.createVNode(g,{modelValue:e.unref(c).ApplyStartDate,"onUpdate:modelValue":l[2]||(l[2]=h=>e.unref(c).ApplyStartDate=h)},null,8,["modelValue"]),l[24]||(l[24]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(g,{modelValue:e.unref(c).ApplyEndDate,"onUpdate:modelValue":l[3]||(l[3]=h=>e.unref(c).ApplyEndDate=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[26]||(l[26]=e.createElementVNode("th",null,"計畫期程迄日",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",d$,[e.createElementVNode("div",c$,[e.createVNode(g,{modelValue:e.unref(c).PlanEndDate,"onUpdate:modelValue":l[4]||(l[4]=h=>e.unref(c).PlanEndDate=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[31]||(l[31]=e.createElementVNode("th",null,"申請階段審查",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",i$,[e.createElementVNode("div",m$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-1",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[5]||(l[5]=h=>e.unref(c).Review1Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(c).Review1Enabled]]),l[27]||(l[27]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-1"},"1.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"資格審查",placeholder:"資格審查",modelValue:e.unref(c).Review1Title,"onUpdate:modelValue":l[6]||(l[6]=h=>e.unref(c).Review1Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",p$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-2",type:"checkbox","onUpdate:modelValue":l[7]||(l[7]=h=>e.unref(c).Review2Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(c).Review2Enabled]]),l[28]||(l[28]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-2"},"2.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"初審",placeholder:"初審",modelValue:e.unref(c).Review2Title,"onUpdate:modelValue":l[8]||(l[8]=h=>e.unref(c).Review2Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",V$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-3",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=h=>e.unref(c).Review3Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(c).Review3Enabled]]),l[29]||(l[29]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-3"},"3.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"複審",placeholder:"複審",modelValue:e.unref(c).Review3Title,"onUpdate:modelValue":l[10]||(l[10]=h=>e.unref(c).Review3Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",f$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-4",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[11]||(l[11]=h=>e.unref(c).Review4Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(c).Review4Enabled]]),l[30]||(l[30]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-4"},"4.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"決審核定",placeholder:"決審核定",modelValue:e.unref(c).Review4Title,"onUpdate:modelValue":l[12]||(l[12]=h=>e.unref(c).Review4Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[34]||(l[34]=e.createElementVNode("th",null,"補正補件期限",-1)),e.createElementVNode("td",N$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"overdue-period",type:"checkbox","onUpdate:modelValue":l[13]||(l[13]=h=>e.isRef(m)?m.value=h:null)},null,512),[[e.vModelCheckbox,e.unref(m)]]),l[33]||(l[33]=e.createElementVNode("label",{class:"form-check-label",for:"overdue-period"},"有期限",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(d,{class:"w-auto",modelValue:e.unref(c).OverduePeriod,"onUpdate:modelValue":l[14]||(l[14]=h=>e.unref(c).OverduePeriod=h),modelModifiers:{trim:!0}},null,8,["modelValue"]),l[32]||(l[32]=e.createTextVNode("天 ",-1))],64)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[l[35]||(l[35]=e.createElementVNode("th",null,[e.createTextVNode("期中報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("span",E$,[e.createElementVNode("span",b$,[e.createVNode(g,{modelValue:e.unref(c).MidtermDeadline,"onUpdate:modelValue":l[15]||(l[15]=h=>e.unref(c).MidtermDeadline=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[38]||(l[38]=e.createElementVNode("th",null,[e.createTextVNode("期末/成果報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("div",g$,[e.createElementVNode("div",y$,[e.createVNode(g,{disabled:e.unref(c).FinalOneMonth,modelValue:e.unref(c).FinalDeadline,"onUpdate:modelValue":l[16]||(l[16]=h=>e.unref(c).FinalDeadline=h)},null,8,["disabled","modelValue"])]),l[36]||(l[36]=e.createElementVNode("span",{class:"p-2"},"或",-1)),e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"final-one-month",type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=h=>e.unref(c).FinalOneMonth=h)},null,512),[[e.vModelCheckbox,e.unref(c).FinalOneMonth]]),l[37]||(l[37]=e.createElementVNode("label",{class:"form-check-label",for:"final-one-month"},"計畫結束一個月後",-1))])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:r,type:"button"},"儲存")])])}}},u$={class:"block"},h$={class:"mt-4"},x$={class:"table-responsive"},$$={class:"table align-middle gray-table"},B$={class:"d-flex align-items-center gap-2"},_$=["id","onUpdate:modelValue"],C$=["for"],T$={__name:"GrantForm3",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),m=B,V=()=>{const r=c.value.map(o=>({...o,MatchingFund:o.checked?o.MatchingFund:null}));A.system("saveGrantTargetSettings",{List:r}).subscribe(o=>{o&&m("next")})};return e.onMounted(()=>{A.system("getGrantTargetSettings",{ID:y.id}).subscribe(r=>{c.value=r.List,c.value.forEach(o=>{typeof o.MatchingFund=="number"&&(o.checked=!0)})})}),(r,o)=>{const l=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock("div",u$,[e.createElementVNode("div",h$,[e.createElementVNode("div",x$,[e.createElementVNode("table",$$,[o[1]||(o[1]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th"),e.createElementVNode("th",null,"適用申請單位類別"),e.createElementVNode("th",null,"補助經費上限(萬)"),e.createElementVNode("th",null,"配合款")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(d,b)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",null,e.toDisplayString(b+1),1),e.createElementVNode("td",null,e.toDisplayString(d.TargetName),1),e.createElementVNode("td",null,[e.createVNode(l,{modelValue:d.GrantLimit,"onUpdate:modelValue":g=>d.GrantLimit=g},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",B$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:`checkbox-${b}`,type:"checkbox","onUpdate:modelValue":g=>d.checked=g},null,8,_$),[[e.vModelCheckbox,d.checked]]),e.createElementVNode("label",{class:"form-check-label ms-1",for:`checkbox-${b}`},"配合款分攤比例",8,C$),d.checked?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(l,{class:"w-auto",modelValue:d.MatchingFund,"onUpdate:modelValue":g=>d.MatchingFund=g},null,8,["modelValue","onUpdate:modelValue"]),o[0]||(o[0]=e.createTextVNode("(%) ",-1))],64)):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:V,type:"button"},"儲存")])])}}},w$={class:"block"},D$={class:"mt-4"},S$={class:"table-responsive"},A$={class:"table align-middle gray-table side-table"},F$={class:"input-group",style:{width:"400px"}},U$={class:"teal-dark-tabs"},P$={key:0,class:"table-responsive sub-table"},M$={class:"table align-middle gray-table"},I$={class:"d-flex gap-2"},j$=["onClick"],O$={key:1},L$={class:"d-flex gap-2"},R$={__name:"GrantForm4",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),m=e.ref(),V=e.ref([]),r=e.ref({}),o=e.ref(1),l=e.ref(""),d=()=>{const h=/^(.*?)\s*<([^>]+)>$/;l.value.split(`
`).forEach(f=>{const i=f.trim().match(h);i&&r.value[m.value].push({CommitteeUser:i[1],Email:i[2]})}),o.value=1,l.value=""},b=B,g=()=>{if(!_()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}A.system("saveReviewCommitteeList",{ID:m.value,List:r.value[m.value]}).subscribe(h=>{h&&b("next")})},_=()=>{const h={CommitteeUser:"姓名",Email:{presence:{message:"^請輸入 Email"},email:{message:"格式錯誤"}}};return c.value={},r.value[m.value].filter(f=>!f.Deleted).forEach((f,i)=>Object.assign(c.value,M(f,h,`item-${i}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{A.system("getReviewGroups",{ID:y.id}).subscribe(h=>{V.value=h.List,m.value=V.value[0].Value})}),e.watch(m,h=>{r.value[h]||A.system("getReviewCommitteeList",{ID:h}).subscribe(f=>{r.value[h]=f.List})}),(h,f)=>{var n;const i=e.resolveComponent("required-label"),a=e.resolveComponent("input-select"),u=e.resolveComponent("input-text"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",w$,[e.createElementVNode("div",D$,[e.createElementVNode("div",S$,[e.createElementVNode("table",A$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...f[5]||(f[5]=[e.createTextVNode("審查組別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",F$,[e.createVNode(a,{options:e.unref(V),"text-name":"Text","value-name":"Value",modelValue:e.unref(m),"onUpdate:modelValue":f[0]||(f[0]=s=>e.isRef(m)?m.value=s:null)},null,8,["options","modelValue"])])])]),e.createElementVNode("tr",null,[f[11]||(f[11]=e.createElementVNode("th",null,"審查委員名單",-1)),e.createElementVNode("td",null,[e.createElementVNode("ul",U$,[e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===1})},[e.createElementVNode("a",{class:"tab-link",onClick:f[1]||(f[1]=s=>o.value=1),href:"javascript:void(0)"},"逐筆輸入")],2),e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===2})},[e.createElementVNode("a",{class:"tab-link",onClick:f[2]||(f[2]=s=>o.value=2),href:"javascript:void(0)"},"批次輸入")],2)]),e.unref(o)===1?(e.openBlock(),e.createElementBlock("div",P$,[e.createElementVNode("table",M$,[f[7]||(f[7]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"1%"}),e.createElementVNode("th",null,"姓名"),e.createElementVNode("th",null,"Email"),e.createElementVNode("th",{width:"1%"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((n=e.unref(r)[e.unref(m)])==null?void 0:n.filter(s=>!s.Deleted),(s,p)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",null,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c)[`item-${p}-CommitteeUser`],modelValue:s.CommitteeUser,"onUpdate:modelValue":t=>s.CommitteeUser=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c)[`item-${p}-Email`],modelValue:s.Email,"onUpdate:modelValue":t=>s.Email=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",I$,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:t=>s.Deleted=!0,type:"button"},[...f[6]||(f[6]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,j$)])])]))),128))])]),e.createElementVNode("button",{class:"btn btn-sm btn-teal",onClick:f[3]||(f[3]=s=>{var p;return(p=e.unref(r)[e.unref(m)])==null?void 0:p.push({})}),type:"button"},[...f[8]||(f[8]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])):e.createCommentVNode("",!0),e.unref(o)===2?(e.openBlock(),e.createElementBlock("div",O$,[e.createElementVNode("div",L$,[e.createVNode(N,{placeholder:`張曉明 <aming@gmail.com>
陳小華 <hwahchen@xxx.edu.tw>`,rows:"5",modelValue:e.unref(l),"onUpdate:modelValue":f[4]||(f[4]=s=>e.isRef(l)?l.value=s:null),modelModifiers:{trim:!0}},null,8,["modelValue"]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:d,type:"button"},[...f[9]||(f[9]=[e.createElementVNode("i",{class:"fa-solid fa-plus"},null,-1),e.createTextVNode("新增",-1)])])]),f[10]||(f[10]=e.createElementVNode("label",{class:"form-text"},"輸入格式範例「姓名 <xxx@email.com>」，多筆請斷行輸入",-1))])):e.createCommentVNode("",!0)])])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:g,type:"button"},"儲存")])])}}},q$={class:"search-form"},z$={class:"row g-3"},G$={class:"col-3"},J$=["value"],Y$={class:"block rounded-4 mt-4"},Q$={class:"table-responsive",style:{"min-height":"400px"}},H$={"aria-label":"公告列表",class:"table teal-table"},W$={"data-th":"年度:"},K$={"data-th":"補助類別全稱:",class:"text-start"},X$={"data-th":"簡稱:",class:"text-start"},Z$={"data-th":"代碼:",class:"text-start"},v$={"data-th":"申請期間:",class:"text-start"},e2={"data-th":"管理:",class:"text-center"},t2={class:"d-inline-flex gap-2"},l2=["href"],o2={__name:"GrantList",setup(x){const B=e.ref([]),y=e.ref(),c=e.ref([]),m=e.computed(()=>B.value.filter(V=>V.Year===y.value));return e.onMounted(()=>{A.system("getGrantTypeList").subscribe(V=>{B.value=V.List,c.value=[],B.value.forEach(r=>{c.value.includes(r.Year)||c.value.push(r.Year)}),y.value=c.value.length?c.value[0]:null})}),(V,r)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",q$,[e.createElementVNode("div",z$,[e.createElementVNode("div",G$,[r[1]||(r[1]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":r[0]||(r[0]=l=>e.isRef(y)?y.value=l:null)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l)+"年",9,J$))),128))],512),[[e.vModelSelect,e.unref(y)]])])])]),e.createElementVNode("div",Y$,[r[5]||(r[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="GrantEdit.aspx"><i class="fa-solid fa-plus"></i> 新增類別 </a></div>',1)),e.createElementVNode("div",Q$,[e.createElementVNode("table",H$,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"補助類別全稱"),e.createElementVNode("th",{scope:"col",class:"text-start"},"簡稱"),e.createElementVNode("th",{scope:"col"},"代碼"),e.createElementVNode("th",{scope:"col"},"申請期間"),e.createElementVNode("th",{scope:"col"},"管理")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",W$,e.toDisplayString(l.Year),1),e.createElementVNode("td",K$,e.toDisplayString(l.FullName),1),e.createElementVNode("td",X$,e.toDisplayString(l.ShortName),1),e.createElementVNode("td",Z$,e.toDisplayString(l.TypeCode),1),e.createElementVNode("td",v$,[e.createVNode(o,{"default-value":"未設定",value:l.ApplyStartDate},null,8,["value"]),r[2]||(r[2]=e.createTextVNode(" ~ ",-1)),e.createVNode(o,{"default-value":"未設定",value:l.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",e2,[e.createElementVNode("div",t2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`GrantEdit.aspx?ID=${l.TypeID}`},[...r[3]||(r[3]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,l2)])])]))),128))])])])])],64)}}},n2={class:"block rounded-4 mt-4"},r2={class:"table-responsive",style:{"min-height":"400px"}},a2={class:"table teal-table","aria-label":"公告列表"},s2={"data-th":"公告期間:"},d2={key:1},c2={"data-th":"公告標題:",class:"text-start"},i2={"data-th":"發布者:",class:"text-start"},m2={"data-th":"功能:",class:"text-center"},p2={class:"d-inline-flex gap-2"},V2=["href"],f2=["onClick"],N2={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},E2={class:"modal-content"},b2={class:"modal-body"},g2={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},y2={__name:"NewsList",setup(x){let B;const y=e.ref([]),c=e.ref(),m=e.ref(1),V=e.ref(10),r=e.computed(()=>y.value.slice((m.value-1)*V.value,m.value*V.value)),o=(d,b)=>{m.value=parseInt(d),V.value=parseInt(b)},l=(d,b)=>{b||(B=d,bootstrap.Modal.getOrCreateInstance(c.value).show()),A.system("deleteNews",{ID:d.ID}).subscribe(g=>{g&&(y.value=y.value.filter(_=>_!==d),bootstrap.Modal.getOrCreateInstance(c.value).hide())})};return e.onMounted(()=>{A.system("getNewsList").subscribe(d=>y.value=d.List)}),(d,b)=>{const g=e.resolveComponent("tw-date"),_=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",n2,[b[5]||(b[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="NewsEdit.aspx"><i class="fa-solid fa-plus"></i> 新增公告 </a></div>',1)),e.createElementVNode("div",r2,[e.createElementVNode("table",a2,[b[4]||(b[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告期間"),e.createElementVNode("th",{class:"text-start",scope:"col"},"公告標題"),e.createElementVNode("th",{class:"text-start",scope:"col",style:{width:"200px"}},"發布者"),e.createElementVNode("th",{scope:"col",style:{width:"180px"}},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),h=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",s2,[e.createVNode(g,{value:h.EnableTime},null,8,["value"]),b[1]||(b[1]=e.createTextVNode(" ~ ",-1)),h.DisableTime?(e.openBlock(),e.createBlock(g,{key:0,value:h.DisableTime},null,8,["value"])):(e.openBlock(),e.createElementBlock("span",d2,"未設定"))]),e.createElementVNode("td",c2,e.toDisplayString(h.Title),1),e.createElementVNode("td",i2,e.toDisplayString(h.UserOrg)+" "+e.toDisplayString(h.UserName),1),e.createElementVNode("td",m2,[e.createElementVNode("div",p2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`NewsEdit.aspx?id=${h.ID}`},[...b[2]||(b[2]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,V2),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:f=>l(h),type:"button"},[...b[3]||(b[3]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,f2)])])]))),128))])])]),e.createVNode(_,{count:e.unref(y).length,onChange:o,page:e.unref(m),"page-size":e.unref(V)},null,8,["count","page","page-size"])]),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",N2,[e.createElementVNode("div",E2,[b[7]||(b[7]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 fw-bold text-green-light"},"確定刪除公告資料？"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",b2,[e.createElementVNode("div",g2,[b[6]||(b[6]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:b[0]||(b[0]=h=>l(e.unref(B),!0)),type:"button"},"確認刪除")])])])])],512)],64)}}},k2={class:"block rounded-top-4 mt-4 d-flex flex-column gap-5"},u2={class:"table-responsive mt-3 mb-0"},h2={class:"table align-middle gray-table side-table"},x2={class:"d-flex align-items-center gap-2"},$2={class:"input-group w-auto"},B2={key:0,class:"invalid mt-0"},_2={class:"d-flex mb-2 gap-3"},C2={class:"tag-group mt-3"},T2={key:0,class:"tag tag-green-light"},w2=["download","href"],D2=["onClick"],S2={class:"d-flex mb-2 gap-3"},A2={class:"image-preview mt-3"},F2={key:0,class:"image-preview__item"},U2=["src"],P2={class:"image-preview__item-overlay"},M2=["onClick"],I2={class:"d-flex mb-2 gap-3"},j2={key:0,class:"table-responsive mt-3"},O2={class:"table align-middle gray-table"},L2={class:"text-center"},R2={class:"d-flex gap-1"},q2=["onClick"],ne={AccessibilityApplication:rt,AccessibilityAttachment:Ct,AccessibilityBenefit:Rt,AccessibilityFunding:Nl,AccessibilityPayment1:Rl,AccessibilityPayment2:Eo,AccessibilityProgressBar:bo,AccessibilityWorkSchedule:zo,AuditHistory:ln,ConfirmModal:dn,CommonProgressBar:En,CultureApplication:er,CultureAttachment:hr,CultureFunding:Wr,CultureOther:ma,CulturePayment1:Ia,CulturePayment2:ms,CultureProgress:Ds,CultureProgressBar:Ss,CultureWorkSchedule:xd,EducationApplication:Nc,EducationAttachment:Ic,EducationPayment:ii,EducationProgressBar:mi,ErrorModal:bi,HomeDashboard:km,InputBoolean:um,InputFile:hm,InputInteger:Bm,InputMonth:_m,InputRadioGroup:wm,InputSelect:Um,InputText:Om,InputTextarea:Gm,InputTwDate:Qm,ListPager:dp,LiteracyApplication:qp,LiteracyAttachment:iV,LiteracyBenefit:$V,LiteracyFunding:ZV,LiteracyPayment1:xf,LiteracyPayment2:Hf,LiteracyProgressBar:Wf,LiteracyWorkSchedule:uN,MultipleApplication:t1,MultipleAttachment:x1,MultipleBenefit:I1,MultipleFunding:mE,MultiplePayment1:PE,MultiplePayment2:db,MultiplePayment3:Pb,MultipleProgressBar:Mb,MultipleWorkSchedule:dg,NewsDetail:ug,NewsList:wg,NewsMarquee:Pg,ProjectChangeReview:Rg,ProjectCorrectionReview:Qg,ProjectOrganizer:ly,ProjectPaymentReview:my,ProjectProgress:uy,ProjectReport:Oy,ProjectReportReview:Jy,ProjectReview:tk,ProjectTitle:ak,ProjectToolbar:hk,ReportApplyList:du,ReportApprovedList:Pu,ReportInprogressList:fh,ReportMixChart:Nh,ReportPieChart:Eh,ReportRecusedList:Oh,ReportReviewerDetails:Xh,ReportReviewerList:yx,RequiredLabel:ux,ReviewCommitteeInfo:Tx,SystemGrantForm1:Zx,SystemGrantForm2:k$,SystemGrantForm3:T$,SystemGrantForm4:R$,SystemGrantList:o2,SystemNewsList:y2,SystemNewsForm:{__name:"NewsForm",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),m=e.ref([]),V=e.computed(()=>l.value.filter(f=>!f.Deleted)),r=e.ref({}),o=e.ref([]),l=e.ref([]),d=(f,i)=>f.push({Path:i.Path,Name:i.Name}),b=A.download,g=B,_=()=>{if(!h()){e.nextTick(()=>{var i;return(i=document.querySelector(".invalid"))==null?void 0:i.scrollIntoView({behavior:"smooth",block:"center"})});return}const f={News:r.value,Files:m.value,Images:o.value,Videos:l.value};A.system("saveNews",f).subscribe(i=>{i&&g("next")})},h=()=>{let f={Title:"公告標題",EnableTime:"公告期間",Content:"內容"};return c.value=M(r.value,f),f={Title:"影片名稱",URL:"影片網址"},V.value.forEach((i,a)=>Object.assign(c.value,M(i,f,`video-${a}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{y.id?A.system("getNews",{ID:y.id}).subscribe(f=>{r.value=f.News,m.value=f.Files,o.value=f.Images,l.value=f.Videos}):A.system("getEmptyNews").subscribe(f=>r.value=f)}),(f,i)=>{const a=e.resolveComponent("required-label"),u=e.resolveComponent("input-text"),N=e.resolveComponent("input-tw-date"),n=e.resolveComponent("input-textarea"),s=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",k2,[e.createElementVNode("div",null,[i[12]||(i[12]=e.createElementVNode("h5",{class:"square-title"},"公告內容",-1)),e.createElementVNode("div",u2,[e.createElementVNode("table",h2,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[i[7]||(i[7]=e.createElementVNode("th",null,"發佈者",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(r).UserOrg)+"    "+e.toDisplayString(e.unref(r).UserName),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...i[8]||(i[8]=[e.createTextVNode("公告標題",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c).Title,modelValue:e.unref(r).Title,"onUpdate:modelValue":i[0]||(i[0]=p=>e.unref(r).Title=p),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...i[9]||(i[9]=[e.createTextVNode("公告期間",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",x2,[e.createElementVNode("div",$2,[e.createVNode(N,{class:"w-auto",modelValue:e.unref(r).EnableTime,"onUpdate:modelValue":i[1]||(i[1]=p=>e.unref(r).EnableTime=p)},null,8,["modelValue"]),i[10]||(i[10]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(N,{class:"w-auto",modelValue:e.unref(r).DisableTime,"onUpdate:modelValue":i[2]||(i[2]=p=>e.unref(r).DisableTime=p)},null,8,["modelValue"])])]),e.unref(c).EnableTime?(e.openBlock(),e.createElementBlock("div",B2,e.toDisplayString(e.unref(c).EnableTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...i[11]||(i[11]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(c).Content,modelValue:e.unref(r).Content,"onUpdate:modelValue":i[3]||(i[3]=p=>e.unref(r).Content=p),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",null,[e.createElementVNode("div",_2,[i[13]||(i[13]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關附件")],-1)),e.createVNode(s,{accept:".pdf,.odt,.doc,.docx,.zip",onFile:i[4]||(i[4]=p=>d(e.unref(m),p))})]),i[15]||(i[15]=e.createElementVNode("span",{class:"text-pink"},"支援文件 pdf, odt, doc, docx (10MB以內)、ZIP 壓縮檔 (50MB以內)",-1)),e.createElementVNode("div",C2,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),p=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:p},[p.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",T2,[e.createElementVNode("a",{class:"tag-link my-1",download:p.Name,href:e.unref(b)(p.Path)},e.toDisplayString(p.Name),9,w2),e.createElementVNode("button",{class:"tag-btn",onClick:t=>p.Deleted=!0,type:"button"},[...i[14]||(i[14]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,D2)]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",S2,[i[16]||(i[16]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關圖片")],-1)),e.createVNode(s,{accept:".jpg,.png",onFile:i[5]||(i[5]=p=>d(e.unref(o),p))})]),i[18]||(i[18]=e.createElementVNode("span",{class:"text-pink"},"支援 JPG, PNG，檔案大小 10MB以內",-1)),e.createElementVNode("div",A2,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),p=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:p},[p.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",F2,[e.createElementVNode("img",{alt:"picture",src:e.unref(b)(p.Path)},null,8,U2),e.createElementVNode("div",P2,[e.createElementVNode("button",{"aria-label":"移除圖片",class:"btn btn-remove-image",onClick:t=>p.Deleted=!0,type:"button"},[...i[17]||(i[17]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,M2)])]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",I2,[i[20]||(i[20]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關影片")],-1)),e.createElementVNode("button",{"aria-label":"新增影片",class:"btn btn-teal-dark",onClick:i[6]||(i[6]=p=>e.unref(l).push({})),type:"button"},[...i[19]||(i[19]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增 ",-1)])])]),e.unref(V).length?(e.openBlock(),e.createElementBlock("div",j2,[e.createElementVNode("table",O2,[i[22]||(i[22]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80",class:"text-center"},"項次"),e.createElementVNode("th",null,"影片名稱"),e.createElementVNode("th",null,"影片網址"),e.createElementVNode("th",{width:"120"},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(p,t)=>(e.openBlock(),e.createElementBlock("tr",{key:p},[e.createElementVNode("td",L2,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c)[`video-${t}-Title`],modelValue:p.Title,"onUpdate:modelValue":E=>p.Title=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c)[`video-${t}-URL`],modelValue:p.URL,"onUpdate:modelValue":E=>p.URL=E,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",R2,[e.createElementVNode("button",{"aria-label":"刪除影片",class:"btn btn-sm btn-teal-dark",onClick:E=>p.Deleted=!0,type:"button"},[...i[21]||(i[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,q2)])])]))),128))])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:_,type:"button"},[...i[23]||(i[23]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確認送出",-1)])])])],64)}}},Tooltip:{__name:"Tooltip",setup(x){const B=e.ref();let y;return e.onMounted(()=>{y=new bootstrap.Tooltip(B.value)}),e.onUnmounted(()=>{y&&y.dispose()}),(c,m)=>(e.openBlock(),e.createElementBlock("button",{class:"btn-tooltip",ref_key:"element",ref:B,style:{color:"#027f72"},type:"button"},[...m[0]||(m[0]=[e.createElementVNode("i",{class:"fa-solid fa-circle-info"},null,-1)])],512))}},TwDate:{__name:"TwDate",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(x){const B=x,y=m=>{const V=m==null?void 0:m.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return V?`${parseInt(V[1],10)-1911}/${V[2]}/${V[3]}`:""},c=e.ref(y(B.value));return e.watch(()=>B.value,m=>c.value=y(m)),(m,V)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||x.defaultValue),1))}},TwDateTime:{__name:"TwDateTime",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(x){const B=x,y=m=>{const V=m==null?void 0:m.match(/^(\d+)[\/-](\d+)[\/-](\d+) (\d+:\d+(:\d+)?)$/);return V?`${parseInt(V[1],10)-1911}/${V[2]}/${V[3]} ${V[4]}`:""},c=e.ref(y(B.value));return e.watch(()=>B.value,m=>c.value=y(m)),(m,V)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||x.defaultValue),1))}}};return{api:A,install:x=>{for(const B in ne)x.component(B,ne[B])},useGrantStore:K,useProgressStore:j}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
