(function(e,W){typeof exports=="object"&&typeof module<"u"?module.exports=W(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],W):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=W(e.Vue,e.Pinia))})(this,(function(e,W){"use strict";const q=W.defineStore("progress",{actions:{init(B,_){var C,N;this[B]={id:_.ProjectID,type:(C=_.SubsidyPlanType)==null?void 0:C.split(" ")[0],name:_.ProjectName,step:_.FormStep,status:_.Status,progress:_.ProgressStatus,changeStatus:(N=_.changeApply)==null?void 0:N.Status,organizer:_.Organizer,organizerName:_.OrganizerName}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let te=Date.now();const z=(B,_,C)=>{const N=q();if([1,3].includes(N[B].status)||[1,4].includes(N[B].changeStatus))return!0;if(N[B].status===10)switch(B){case"culture":if([2,3,5].includes(C))return!0;break;case"multiple":if([2,3,4,5].includes(C))return!0;break;case"accessibility":if([2,3,4,5].includes(C))return!0;break}return!1},le=()=>`id--${te++}`,L=B=>parseInt(B)||0,Z=W.defineStore("message",{state:()=>({error:null})}),{ajax:oe}=rxjs.ajax,{map:ne}=rxjs;let K="";const re=(B,_={})=>Q("Service/OFS/Accessibility.ashx",{method:B,param:_}),ae=(B,_={})=>Q("Service/OFS/Culture.ashx",{method:B,param:_}),de=B=>`${K}/Service/OFS/Download.ashx?path=${B}`,se=(B,_={})=>Q("Service/OFS/Education.ashx",{method:B,param:_}),me=(B,_={})=>Q("Service/OFS/Literacy.ashx",{method:B,param:_}),ie=(B,_={})=>Q("Service/OFS/Multiple.ashx",{method:B,param:_}),ce=({response:B,status:_})=>{if(_===200){if(B.success)return B.data;Z().error=B.message}},Q=(B,_={})=>{const C={};_.constructor!==FormData&&(C["Content-Type"]="application/json");const N={body:_,headers:C,method:"POST",url:`${K}/${B}`};return oe(N).pipe(ne(ce))},O=Object.assign(Q,{accessibility:re,culture:ae,download:de,education:se,literacy:me,multiple:ie,upload:B=>{const _=new FormData;return _.append("file",B),Q("Service/OFS/Upload.ashx",_)}});function Ve(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var Y={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var pe=Y.exports,X;function fe(){return X||(X=1,(function(B,_){(function(C,N,c){var V=function(l,o,a){a=n.extend({},n.options,a);var u=n.runValidations(l,o,a);if(u.some(function(E){return n.isPromise(E.error)}))throw new Error("Use validate.async if you want support for promises");return V.processValidationResults(u,a)},n=V;n.extend=function(l){return[].slice.call(arguments,1).forEach(function(o){for(var a in o)l[a]=o[a]}),l},n.extend(V,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var l=n.format("%{major}.%{minor}.%{patch}",n.version);return n.isEmpty(n.version.metadata)||(l+="+"+n.version.metadata),l}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(l,o,a){var u=[],E,y,w,F,p,r,g;(n.isDomElement(l)||n.isJqueryElement(l))&&(l=n.collectFormValues(l));for(E in o){w=n.getDeepObjectValue(l,E),F=n.result(o[E],w,l,E,a,o);for(y in F){if(p=n.validators[y],!p)throw g=n.format("Unknown validator %{name}",{name:y}),new Error(g);r=F[y],r=n.result(r,w,l,E,a,o),r&&u.push({attribute:E,value:w,validator:y,globalOptions:a,attributes:l,options:r,error:p.call(p,w,r,E,l,a)})}}return u},processValidationResults:function(l,o){l=n.pruneEmptyErrors(l,o),l=n.expandMultipleErrors(l,o),l=n.convertErrorMessages(l,o);var a=o.format||"grouped";if(typeof n.formatters[a]=="function")l=n.formatters[a](l);else throw new Error(n.format("Unknown format %{format}",o));return n.isEmpty(l)?void 0:l},async:function(l,o,a){a=n.extend({},n.async.options,a);var u=a.wrapErrors||function(y){return y};a.cleanAttributes!==!1&&(l=n.cleanAttributes(l,o));var E=n.runValidations(l,o,a);return new n.Promise(function(y,w){n.waitForResults(E).then(function(){var F=n.processValidationResults(E,a);F?w(new u(F,a,l,o)):y(l)},function(F){w(F)})})},single:function(l,o,a){return a=n.extend({},n.single.options,a,{format:"flat",fullMessages:!1}),n({single:l},{single:o},a)},waitForResults:function(l){return l.reduce(function(o,a){return n.isPromise(a.error)?o.then(function(){return a.error.then(function(u){a.error=u||null})}):o},new n.Promise(function(o){o()}))},result:function(l){var o=[].slice.call(arguments,1);return typeof l=="function"&&(l=l.apply(null,o)),l},isNumber:function(l){return typeof l=="number"&&!isNaN(l)},isFunction:function(l){return typeof l=="function"},isInteger:function(l){return n.isNumber(l)&&l%1===0},isBoolean:function(l){return typeof l=="boolean"},isObject:function(l){return l===Object(l)},isDate:function(l){return l instanceof Date},isDefined:function(l){return l!=null},isPromise:function(l){return!!l&&n.isFunction(l.then)},isJqueryElement:function(l){return l&&n.isString(l.jquery)},isDomElement:function(l){return!l||!l.querySelectorAll||!l.querySelector?!1:n.isObject(document)&&l===document?!0:typeof HTMLElement=="object"?l instanceof HTMLElement:l&&typeof l=="object"&&l!==null&&l.nodeType===1&&typeof l.nodeName=="string"},isEmpty:function(l){var o;if(!n.isDefined(l))return!0;if(n.isFunction(l))return!1;if(n.isString(l))return n.EMPTY_STRING_REGEXP.test(l);if(n.isArray(l))return l.length===0;if(n.isDate(l))return!1;if(n.isObject(l)){for(o in l)return!1;return!0}return!1},format:n.extend(function(l,o){return n.isString(l)?l.replace(n.format.FORMAT_REGEXP,function(a,u,E){return u==="%"?"%{"+E+"}":String(o[E])}):l},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(l){return n.isNumber(l)?l*100%1===0?""+l:parseFloat(Math.round(l*100)/100).toFixed(2):n.isArray(l)?l.map(function(o){return n.prettify(o)}).join(", "):n.isObject(l)?n.isDefined(l.toString)?l.toString():JSON.stringify(l):(l=""+l,l.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(o,a,u){return""+a+" "+u.toLowerCase()}).toLowerCase())},stringifyValue:function(l,o){var a=o&&o.prettify||n.prettify;return a(l)},isString:function(l){return typeof l=="string"},isArray:function(l){return{}.toString.call(l)==="[object Array]"},isHash:function(l){return n.isObject(l)&&!n.isArray(l)&&!n.isFunction(l)},contains:function(l,o){return n.isDefined(l)?n.isArray(l)?l.indexOf(o)!==-1:o in l:!1},unique:function(l){return n.isArray(l)?l.filter(function(o,a,u){return u.indexOf(o)==a}):l},forEachKeyInKeypath:function(l,o,a){if(n.isString(o)){var u="",E,y=!1;for(E=0;E<o.length;++E)switch(o[E]){case".":y?(y=!1,u+="."):(l=a(l,u,!1),u="");break;case"\\":y?(y=!1,u+="\\"):y=!0;break;default:y=!1,u+=o[E];break}return a(l,u,!0)}},getDeepObjectValue:function(l,o){if(n.isObject(l))return n.forEachKeyInKeypath(l,o,function(a,u){if(n.isObject(a))return a[u]})},collectFormValues:function(l,o){var a={},u,E,y,w,F,p;if(n.isJqueryElement(l)&&(l=l[0]),!l)return a;for(o=o||{},w=l.querySelectorAll("input[name], textarea[name]"),u=0;u<w.length;++u)if(y=w.item(u),!n.isDefined(y.getAttribute("data-ignored"))){var r=y.name.replace(/\./g,"\\\\.");p=n.sanitizeFormValue(y.value,o),y.type==="number"?p=p?+p:null:y.type==="checkbox"?y.attributes.value?y.checked||(p=a[r]||null):p=y.checked:y.type==="radio"&&(y.checked||(p=a[r]||null)),a[r]=p}for(w=l.querySelectorAll("select[name]"),u=0;u<w.length;++u)if(y=w.item(u),!n.isDefined(y.getAttribute("data-ignored"))){if(y.multiple){p=[];for(E in y.options)F=y.options[E],F&&F.selected&&p.push(n.sanitizeFormValue(F.value,o))}else{var g=typeof y.options[y.selectedIndex]<"u"?y.options[y.selectedIndex].value:"";p=n.sanitizeFormValue(g,o)}a[y.name]=p}return a},sanitizeFormValue:function(l,o){return o.trim&&n.isString(l)&&(l=l.trim()),o.nullify!==!1&&l===""?null:l},capitalize:function(l){return n.isString(l)?l[0].toUpperCase()+l.slice(1):l},pruneEmptyErrors:function(l){return l.filter(function(o){return!n.isEmpty(o.error)})},expandMultipleErrors:function(l){var o=[];return l.forEach(function(a){n.isArray(a.error)?a.error.forEach(function(u){o.push(n.extend({},a,{error:u}))}):o.push(a)}),o},convertErrorMessages:function(l,o){o=o||{};var a=[],u=o.prettify||n.prettify;return l.forEach(function(E){var y=n.result(E.error,E.value,E.attribute,E.options,E.attributes,E.globalOptions);if(!n.isString(y)){a.push(E);return}y[0]==="^"?y=y.slice(1):o.fullMessages!==!1&&(y=n.capitalize(u(E.attribute))+" "+y),y=y.replace(/\\\^/g,"^"),y=n.format(y,{value:n.stringifyValue(E.value,o)}),a.push(n.extend({},E,{error:y}))}),a},groupErrorsByAttribute:function(l){var o={};return l.forEach(function(a){var u=o[a.attribute];u?u.push(a):o[a.attribute]=[a]}),o},flattenErrorsToArray:function(l){return l.map(function(o){return o.error}).filter(function(o,a,u){return u.indexOf(o)===a})},cleanAttributes:function(l,o){function a(y,w,F){return n.isObject(y[w])?y[w]:y[w]=F?!0:{}}function u(y){var w={},F;for(F in y)y[F]&&n.forEachKeyInKeypath(w,F,a);return w}function E(y,w){if(!n.isObject(y))return y;var F=n.extend({},y),p,r;for(r in y)p=w[r],n.isObject(p)?F[r]=E(F[r],p):p||delete F[r];return F}return!n.isObject(o)||!n.isObject(l)?{}:(o=u(o),E(l,o))},exposeModule:function(l,o,a,u,E){a?(u&&u.exports&&(a=u.exports=l),a.validate=l):(o.validate=l,l.isFunction(E)&&E.amd&&E([],function(){return l}))},warn:function(l){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+l)},error:function(l){typeof console<"u"&&console.error&&console.error("[validate.js] "+l)}}),V.validators={presence:function(l,o){if(o=n.extend({},this.options,o),o.allowEmpty!==!1?!n.isDefined(l):n.isEmpty(l))return o.message||this.message||"can't be blank"},length:function(l,o,a){if(n.isDefined(l)){o=n.extend({},this.options,o);var u=o.is,E=o.maximum,y=o.minimum,w=o.tokenizer||function(g){return g},F,p=[];l=w(l);var r=l.length;if(!n.isNumber(r))return o.message||this.notValid||"has an incorrect length";if(n.isNumber(u)&&r!==u&&(F=o.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",p.push(n.format(F,{count:u}))),n.isNumber(y)&&r<y&&(F=o.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",p.push(n.format(F,{count:y}))),n.isNumber(E)&&r>E&&(F=o.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",p.push(n.format(F,{count:E}))),p.length>0)return o.message||p}},numericality:function(l,o,a,u,E){if(n.isDefined(l)){o=n.extend({},this.options,o);var y=[],w,F,p={greaterThan:function(m,i){return m>i},greaterThanOrEqualTo:function(m,i){return m>=i},equalTo:function(m,i){return m===i},lessThan:function(m,i){return m<i},lessThanOrEqualTo:function(m,i){return m<=i},divisibleBy:function(m,i){return m%i===0}},r=o.prettify||E&&E.prettify||n.prettify;if(n.isString(l)&&o.strict){var g="^-?(0|[1-9]\\d*)";if(o.onlyInteger||(g+="(\\.\\d+)?"),g+="$",!new RegExp(g).test(l))return o.message||o.notValid||this.notValid||this.message||"must be a valid number"}if(o.noStrings!==!0&&n.isString(l)&&!n.isEmpty(l)&&(l=+l),!n.isNumber(l))return o.message||o.notValid||this.notValid||this.message||"is not a number";if(o.onlyInteger&&!n.isInteger(l))return o.message||o.notInteger||this.notInteger||this.message||"must be an integer";for(w in p)if(F=o[w],n.isNumber(F)&&!p[w](l,F)){var k="not"+n.capitalize(w),s=o[k]||this[k]||this.message||"must be %{type} %{count}";y.push(n.format(s,{count:F,type:r(w)}))}if(o.odd&&l%2!==1&&y.push(o.notOdd||this.notOdd||this.message||"must be odd"),o.even&&l%2!==0&&y.push(o.notEven||this.notEven||this.message||"must be even"),y.length)return o.message||y}},datetime:n.extend(function(l,o){if(!n.isFunction(this.parse)||!n.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(n.isDefined(l)){o=n.extend({},this.options,o);var a,u=[],E=o.earliest?this.parse(o.earliest,o):NaN,y=o.latest?this.parse(o.latest,o):NaN;if(l=this.parse(l,o),isNaN(l)||o.dateOnly&&l%864e5!==0)return a=o.notValid||o.message||this.notValid||"must be a valid date",n.format(a,{value:arguments[0]});if(!isNaN(E)&&l<E&&(a=o.tooEarly||o.message||this.tooEarly||"must be no earlier than %{date}",a=n.format(a,{value:this.format(l,o),date:this.format(E,o)}),u.push(a)),!isNaN(y)&&l>y&&(a=o.tooLate||o.message||this.tooLate||"must be no later than %{date}",a=n.format(a,{date:this.format(y,o),value:this.format(l,o)}),u.push(a)),u.length)return n.unique(u)}},{parse:null,format:null}),date:function(l,o){return o=n.extend({},o,{dateOnly:!0}),n.validators.datetime.call(n.validators.datetime,l,o)},format:function(l,o){(n.isString(o)||o instanceof RegExp)&&(o={pattern:o}),o=n.extend({},this.options,o);var a=o.message||this.message||"is invalid",u=o.pattern,E;if(n.isDefined(l)&&(!n.isString(l)||(n.isString(u)&&(u=new RegExp(o.pattern,o.flags)),E=u.exec(l),!E||E[0].length!=l.length)))return a},inclusion:function(l,o){if(n.isDefined(l)&&(n.isArray(o)&&(o={within:o}),o=n.extend({},this.options,o),!n.contains(o.within,l))){var a=o.message||this.message||"^%{value} is not included in the list";return n.format(a,{value:l})}},exclusion:function(l,o){if(n.isDefined(l)&&(n.isArray(o)&&(o={within:o}),o=n.extend({},this.options,o),!!n.contains(o.within,l))){var a=o.message||this.message||"^%{value} is restricted";return n.isString(o.within[l])&&(l=o.within[l]),n.format(a,{value:l})}},email:n.extend(function(l,o){o=n.extend({},this.options,o);var a=o.message||this.message||"is not a valid email";if(n.isDefined(l)&&(!n.isString(l)||!this.PATTERN.exec(l)))return a},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(l,o,a,u,E){if(n.isDefined(l)){n.isString(o)&&(o={attribute:o}),o=n.extend({},this.options,o);var y=o.message||this.message||"is not equal to %{attribute}";if(n.isEmpty(o.attribute)||!n.isString(o.attribute))throw new Error("The attribute must be a non empty string");var w=n.getDeepObjectValue(u,o.attribute),F=o.comparator||function(r,g){return r===g},p=o.prettify||E&&E.prettify||n.prettify;if(!F(l,w,o,a,u))return n.format(y,{attribute:p(o.attribute)})}},url:function(l,o){if(n.isDefined(l)){o=n.extend({},this.options,o);var a=o.message||this.message||"is not a valid url",u=o.schemes||this.schemes||["http","https"],E=o.allowLocal||this.allowLocal||!1,y=o.allowDataUrl||this.allowDataUrl||!1;if(!n.isString(l))return a;var w="^(?:(?:"+u.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",F="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(E?F+="?":w+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",w+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+F+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",y){var p="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",r="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",g="data:(?:"+p+")?(?:;base64)?,"+r;w="(?:"+w+")|(?:^"+g+"$)"}var k=new RegExp(w,"i");if(!k.exec(l))return a}},type:n.extend(function(l,o,a,u,E){if(n.isString(o)&&(o={type:o}),!!n.isDefined(l)){var y=n.extend({},this.options,o),w=y.type;if(!n.isDefined(w))throw new Error("No type was specified");var F;if(n.isFunction(w)?F=w:F=this.types[w],!n.isFunction(F))throw new Error("validate.validators.type.types."+w+" must be a function.");if(!F(l,y,a,u,E)){var p=o.message||this.messages[w]||this.message||y.message||(n.isFunction(w)?"must be of the correct type":"must be of type %{type}");return n.isFunction(p)&&(p=p(l,o,a,u,E)),n.format(p,{attribute:n.prettify(a),type:w})}}},{types:{object:function(l){return n.isObject(l)&&!n.isArray(l)},array:n.isArray,integer:n.isInteger,number:n.isNumber,string:n.isString,date:n.isDate,boolean:n.isBoolean},messages:{}})},V.formatters={detailed:function(l){return l},flat:n.flattenErrorsToArray,grouped:function(l){var o;l=n.groupErrorsByAttribute(l);for(o in l)l[o]=n.flattenErrorsToArray(l[o]);return l},constraint:function(l){var o;l=n.groupErrorsByAttribute(l);for(o in l)l[o]=l[o].map(function(a){return a.validator}).sort();return l}},V.exposeModule(V,this,C,N,c)}).call(pe,_,B,null)})(Y,Y.exports)),Y.exports}var Ne=fe();const v=Ve(Ne),M=(B,_,C="")=>{const N={};Object.keys(_).forEach(n=>{const l=_[n];v.isString(l)?N[n]={presence:{allowEmpty:!1,message:`^請輸入${l}`}}:N[n]=l});const c={},V=v(B,N);return V&&Object.keys(V).forEach(n=>c[`${C}${n}`]=V[n].join(",")),c},ue={class:"block"},Ee={class:"mt-4"},be={class:"table align-middle gray-table side-table"},ge={key:0},ke={key:1,class:"text-light-gray"},ye={class:"d-flex flex-column gap-2"},xe={key:0},Be={class:"mt-4"},he={class:"table align-middle gray-table side-table"},$e={class:"row g-3"},Ce={class:"col-12 col-xl-2"},Te={class:"text-gray mb-2"},_e={class:"col-12 col-xl-3"},we={class:"text-gray mb-2"},Ae={class:"col-12 col-xl-4"},Fe={class:"row g-1"},Se={class:"col-7"},De={class:"col-5"},Ue={class:"col-12 col-xl-3"},Me={class:"text-gray mb-2"},Oe={class:"col-12"},je={class:"text-gray mb-2"},Ie={class:"mt-4"},Pe={class:"table align-middle gray-table side-table"},qe={class:"mt-4"},Re={class:"table align-middle gray-table side-table"},Le={key:0,class:"table-responsive mt-3 mb-0"},ze={class:"table align-middle gray-table"},Je={key:0},Ge={key:0},Qe={class:"d-flex gap-2"},We=["onClick"],Ye={class:"mt-4"},He={class:"table align-middle gray-table side-table"},Ze={key:0,class:"block-bottom bg-light-teal"},Ke={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.ref(),n=e.computed(()=>z("accessibility",a.value.Status,1)),l=e.ref({}),o=e.computed(()=>u.value.filter(k=>!k.Deleted)),a=e.ref({}),u=e.ref([]),E=e.computed({get:()=>!!o.value.length,set:k=>{k?y():u.value.forEach(s=>s.Deleted=!0)}}),y=()=>u.value.push({}),w=_,F=()=>{O.accessibility("getApplication",{ID:C.id}).subscribe(k=>{a.value=k.Project,V.value=k.Contacts,u.value=k.ReceivedSubsidies,a.value.OrgCategory=a.value.OrgCategory||null,q().init("accessibility",a.value),c.value=a.value.changeApply,a.value.changeApply=void 0})},p=k=>k.Deleted=!0,r=k=>{var m,i;if(l.value={},k&&!g()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const s={Project:a.value,Contacts:V.value,ReceivedSubsidies:u.value.filter(t=>t.ID||!t.Deleted),Before:(m=c.value)==null?void 0:m.Form1Before,After:(i=c.value)==null?void 0:i.Form1After,Submit:k?"true":"false"};O.accessibility("saveApplication",s).subscribe(t=>{k?w("next"):a.value.ID?F():window.location.href=`Application.aspx?ID=${t.ID}`})},g=()=>{let k={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return a.value.OrgCategory==="2"&&(k.RegisteredNum="立案登記證字號"),l.value=M(a.value,k),k={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((s,m)=>Object.assign(l.value,M(s,k,`contact-${m}-`))),k={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},u.value.forEach((s,m)=>Object.assign(l.value,M(s,k,`received-${m}-`))),c.value&&(k={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,M(c.value,k))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([O.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(k=>{N.value=k[0],C.id?F():O.accessibility("getEmptyApplication").subscribe(s=>{a.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},s),V.value=[{Role:"負責人"},{Role:"聯絡人"}],q().init("accessibility",a.value)})})}),e.provide("editable",n),(k,s)=>{const m=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),d=e.resolveComponent("input-textarea"),f=e.resolveComponent("input-boolean"),U=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ue,[s[42]||(s[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Ee,[e.createElementVNode("table",be,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[15]||(s[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[s[16]||(s[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",ge,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",ke,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[s[17]||(s[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[18]||(s[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).ProjectName,modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":s[0]||(s[0]=h=>e.unref(a).ProjectName=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[19]||(s[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":s[1]||(s[1]=h=>e.unref(a).OrgName=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[20]||(s[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",ye,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).OrgCategory,"onUpdate:modelValue":s[2]||(s[2]=h=>e.unref(a).OrgCategory=h)},null,8,["error","options","modelValue"])]),e.unref(a).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(i,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(a).RegisteredNum,"onUpdate:modelValue":s[3]||(s[3]=h=>e.unref(a).RegisteredNum=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[21]||(s[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(a).TaxID,"onUpdate:modelValue":s[4]||(s[4]=h=>e.unref(a).TaxID=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[22]||(s[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":s[5]||(s[5]=h=>e.unref(a).Address=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),s[43]||(s[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Be,[e.createElementVNode("table",he,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(h,S)=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",$e,[e.createElementVNode("div",Ce,[e.createElementVNode("div",Te,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[23]||(s[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${S}-Name`],modelValue:h.Name,"onUpdate:modelValue":D=>h.Name=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",_e,[e.createElementVNode("div",we,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[24]||(s[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${S}-JobTitle`],modelValue:h.JobTitle,"onUpdate:modelValue":D=>h.JobTitle=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ae,[s[25]||(s[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Fe,[e.createElementVNode("div",Se,[e.createVNode(i,{modelValue:h.Phone,"onUpdate:modelValue":D=>h.Phone=D,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",De,[e.createVNode(i,{placeholder:"請輸入分機",size:"4",modelValue:h.PhoneExt,"onUpdate:modelValue":D=>h.PhoneExt=D,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Ue,[e.createElementVNode("div",Me,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[26]||(s[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${S}-MobilePhone`],modelValue:h.MobilePhone,"onUpdate:modelValue":D=>h.MobilePhone=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Oe,[e.createElementVNode("div",je,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[27]||(s[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${S}-EMail`],modelValue:h.EMail,"onUpdate:modelValue":D=>h.EMail=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),s[44]||(s[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Ie,[e.createElementVNode("table",Pe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[28]||(s[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[s[29]||(s[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(d,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(a).Target,"onUpdate:modelValue":s[6]||(s[6]=h=>e.unref(a).Target=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[30]||(s[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":s[7]||(s[7]=h=>e.unref(a).Summary=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[31]||(s[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":s[8]||(s[8]=h=>e.unref(a).Quantified=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[32]||(s[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Qualitative,"onUpdate:modelValue":s[9]||(s[9]=h=>e.unref(a).Qualitative=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",qe,[e.createElementVNode("table",Re,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[38]||(s[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(f,{modelValue:e.unref(E),"onUpdate:modelValue":s[10]||(s[10]=h=>e.isRef(E)?E.value=h:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Le,[e.createElementVNode("table",ze,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[s[33]||(s[33]=e.createElementVNode("th",null,"計畫名稱",-1)),s[34]||(s[34]=e.createElementVNode("th",null,"補助單位",-1)),s[35]||(s[35]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Je,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(h,S)=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l)[`received-${S}-Name`],modelValue:h.Name,"onUpdate:modelValue":D=>h.Name=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l)[`received-${S}-Unit`],modelValue:h.Unit,"onUpdate:modelValue":D=>h.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`received-${S}-Amount`],modelValue:h.Amount,"onUpdate:modelValue":D=>h.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Ge,[e.createElementVNode("div",Qe,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>p(h),type:"button"},[...s[36]||(s[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,We)):e.createCommentVNode("",!0),S+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...s[37]||(s[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[s[41]||(s[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Ye,[e.createElementVNode("table",He,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[39]||(s[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(c).Form1Before,"onUpdate:modelValue":s[11]||(s[11]=h=>e.unref(c).Form1Before=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[40]||(s[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(c).Form1After,"onUpdate:modelValue":s[12]||(s[12]=h=>e.unref(c).Form1After=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ze,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:s[13]||(s[13]=h=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:s[14]||(s[14]=h=>r(!0)),type:"button"},[...s[45]||(s[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Xe={class:"block"},ve={key:0,class:"text-pink lh-base mt-4"},et={class:"mt-4"},tt={class:"table align-middle gray-table"},lt={class:"text-center"},ot={key:0,width:"180"},nt={class:"text-center"},rt={key:0},at=["innerHTML"],dt={key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",type:"button"},st={key:0,class:"text-center"},mt={key:0},it={key:1,class:"text-pink"},ct={key:1,class:"tag-group mt-2 gap-1"},Vt={key:0,class:"tag tag-green-light"},pt=["download","href"],ft=["onClick"],Nt={class:"mt-4"},ut={class:"table align-middle gray-table side-table"},Et={key:0,class:"block-bottom bg-light-teal"},bt=["disabled"],gt={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([{Type:1,Title:"申請表",Template:!0,Files:[]},{Type:2,Title:"計畫書",Template:!0,Files:[]},{Type:3,Title:"執行承諾書",Template:!0,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:!0,Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),c=e.ref(),V=e.computed(()=>N.value.some(p=>!p.Optional&&!p.Files.filter(r=>!r.Deleted).length)),n=e.computed(()=>z("accessibility",o.value.Status,2)),l=e.ref({}),o=e.ref({}),a=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:o.value.ProjectID+"_"+(p.Multiple?r.Name:`${p.Title}.pdf`)})},u=O.download,E=_,y=()=>{rxjs.forkJoin([O.accessibility("getAttachment",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=N.value.filter(g=>{var k;return!((k=g.Excludes)!=null&&k.includes(o.value.OrgCategory))}),N.value.forEach(g=>{g.Files=r.Attachments.filter(k=>k.Type===g.Type),g.Uploaded=e.computed(()=>g.Files.filter(k=>!k.Deleted).length)}),q().init("accessibility",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},w=p=>{var g,k;if(l.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:C.id,Attachments:N.value.reduce((s,m)=>s.concat(m.Files),[]),Before:(g=c.value)==null?void 0:g.Form5Before,After:(k=c.value)==null?void 0:k.Form5After,Submit:p?"true":"false"};O.accessibility("saveAttachment",r).subscribe(()=>{p?E("next"):y()})},F=()=>{if(c.value){const p={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,M(c.value,p))}return!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",n),(p,r)=>{const g=e.resolveComponent("required-label"),k=e.resolveComponent("input-file"),s=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Xe,[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",ve,[...r[4]||(r[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",et,[e.createElementVNode("table",tt,[e.createElementVNode("thead",lt,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",ot,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",nt,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",rt,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(g,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,at)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("button",dt,[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])])):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",st,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",mt,"已上傳")):(e.openBlock(),e.createElementBlock("span",it,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(k,{key:0,accept:".pdf",onFile:t=>a(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",ct,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Vt,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(u)(t.Path)},e.toDisplayString(t.Name),9,pt),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:d=>t.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ft)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[r[12]||(r[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Nt,[e.createElementVNode("table",ut,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(c).Form5Before,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(c).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(c).Form5After,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Et,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[2]||(r[2]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[3]||(r[3]=m=>w(!0)),disabled:e.unref(V),type:"button"},[...r[14]||(r[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,bt)])):e.createCommentVNode("",!0)],64)}}},kt={class:"block"},yt={class:"mt-4"},xt={class:"table-responsive mt-3 mb-0"},Bt={class:"table align-middle gray-table"},ht={key:0,width:"1"},$t={key:0},Ct={class:"d-flex gap-2"},Tt=["onClick"],_t={class:"table-responsive mt-3 mb-0"},wt={class:"table align-middle gray-table"},At={class:"mt-4"},Ft={class:"table align-middle gray-table side-table"},St={key:0,class:"block-bottom bg-light-teal"},Dt={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.computed(()=>z("accessibility",o.value.Status,4)),n=e.ref({}),l=e.computed(()=>N.value.filter(p=>!p.Deleted)),o=e.ref({}),a=()=>N.value.push({}),u=_,E=()=>{rxjs.forkJoin([O.accessibility("getBenefit",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=r.Benefits,N.value.length||a(),q().init("accessibility",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},y=p=>p.Deleted=!0,w=p=>{var g,k;if(n.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:o.value,Benefits:N.value,Before:(g=c.value)==null?void 0:g.Form4Before,After:(k=c.value)==null?void 0:k.Form4After,Submit:p?"true":"false"};O.accessibility("saveBenefit",r).subscribe(()=>{p?u("next"):E()})},F=()=>{let p={Benefit:"不可量化成果"};return n.value=M(o.value,p),p={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((r,g)=>Object.assign(n.value,M(r,p,`item-${g}-`))),c.value&&(p={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,M(c.value,p))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",V),(p,r)=>{const g=e.resolveComponent("input-text"),k=e.resolveComponent("input-textarea"),s=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kt,[r[14]||(r[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",yt,[e.createElementVNode("div",xt,[e.createElementVNode("table",Bt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"目標值",-1)),r[7]||(r[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",ht,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${i}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",$t,[e.createElementVNode("div",Ct,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>y(m),type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Tt)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",_t,[e.createElementVNode("table",wt,[r[10]||(r[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(o).Benefit,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(o).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",At,[e.createElementVNode("table",Ft,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[12]||(r[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":r[2]||(r[2]=m=>e.unref(c).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",St,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[3]||(r[3]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[4]||(r[4]=m=>w(!0)),type:"button"},[...r[15]||(r[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ut={class:"block"},Mt={class:"mt-4"},Ot={class:"table-responsive mt-3 mb-0"},jt={class:"table align-middle gray-table"},It={class:"text-end"},Pt={class:"text-end"},qt={class:"table-responsive"},Rt={class:"table align-middle gray-table"},Lt=["colspan"],zt={key:0,width:"1"},Jt={class:"text-end"},Gt={key:0},Qt={class:"d-flex gap-2"},Wt=["onClick"],Yt={class:"mt-4"},Ht={class:"table-responsive mt-3 mb-0"},Zt={class:"table align-middle gray-table"},Kt={key:0,width:"1"},Xt={class:"text-end"},vt={key:0},el={class:"d-flex gap-2"},tl=["onClick"],ll={class:"mt-4"},ol={class:"table align-middle gray-table side-table"},nl={key:0,class:"block-bottom bg-light-teal"},rl={class:"text-center"},al={class:"mb-5"},dl={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("accessibility",o.value.Status,3)),V=e.ref({}),n=e.computed(()=>u.value.filter(i=>!i.Deleted)),l=e.computed(()=>E.value.filter(i=>!i.Deleted)),o=e.ref({}),a=e.ref(),u=e.ref([]),E=e.ref([]),y=e.ref({}),w=e.ref(0),F=()=>u.value.push({}),p=()=>E.value.push({}),r=_,g=()=>{rxjs.forkJoin([O.accessibility("getFunding",{ID:C.id})]).subscribe(i=>{const t=i[0];o.value=t.Project,u.value=t.OtherSubsidies,E.value=t.BudgetPlans,y.value=t.GrantTargetSetting,u.value.length||F(),E.value.length||p(),q().init("accessibility",o.value),N.value=o.value.changeApply,o.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=(i,t)=>{var f,U;if(V.value={},i&&!m()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&o.value.ApplyAmount>y.value.GrantLimit*1e4){a.value.show(()=>s(i,!0));return}const d={Project:o.value,OtherSubsidies:u.value,BudgetPlans:E.value,Before:(f=N.value)==null?void 0:f.Form3Before,After:(U=N.value)==null?void 0:U.Form3After,Submit:i?"true":"false"};O.accessibility("saveFunding",d).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(o.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},u.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`other-${d}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`plan-${d}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(N.value,i))),!Object.keys(V.value).length};return e.onMounted(g),e.provide("editable",c),e.watchEffect(()=>{o.value.OtherAmount=n.value.reduce((i,t)=>i+L(t.Amount),0),w.value=L(o.value.ApplyAmount)+L(o.value.SelfAmount)+L(o.value.OtherAmount),n.value.forEach(i=>i.percent=Math.round(L(i.Amount)/o.value.OtherAmount*1e4)/100),E.value.forEach(i=>i.sum=L(i.Amount)+L(i.OtherAmount))}),(i,t)=>{var D;const d=e.resolveComponent("input-integer"),f=e.resolveComponent("input-text"),U=e.resolveComponent("input-textarea"),h=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ut,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Mt,[e.createElementVNode("div",Ot,[e.createElementVNode("table",jt,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).ApplyAmount,modelValue:e.unref(o).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(o).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).SelfAmount,modelValue:e.unref(o).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(o).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",It,e.toDisplayString((D=e.unref(o).OtherAmount)==null?void 0:D.toLocaleString()),1),e.createElementVNode("td",Pt,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",qt,[e.createElementVNode("table",Rt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(c)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Lt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",zt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(b+1),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`other-${b}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":x=>A.Unit=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`other-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Jt,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`other-${b}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":x=>A.Content=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",Gt,[e.createElementVNode("div",Qt,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Wt)):e.createCommentVNode("",!0),b+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Yt,[e.createElementVNode("div",Ht,[e.createElementVNode("table",Zt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",Kt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`plan-${b}-Title`],modelValue:A.Title,"onUpdate:modelValue":x=>A.Title=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":x=>A.OtherAmount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Xt,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`plan-${b}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":x=>A.Description=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",vt,[e.createElementVNode("div",el,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,tl)):e.createCommentVNode("",!0),b+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ll,[e.createElementVNode("table",ol,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(N).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(N).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",nl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>s(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",rl,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",al,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(y).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},sl={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(C,N)=>{const c=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(c,{steps:_,type:"accessibility"})}}},ml={class:"block"},il={class:"mt-4"},cl={class:"table align-middle gray-table side-table"},Vl={key:0,class:"d-flex align-items-center gap-2"},pl={class:"input-group w-auto"},fl={class:"text-teal-dark"},Nl={key:1,class:"invalid mt-0"},ul={class:"table-responsive mt-4"},El={class:"table align-middle gray-table"},bl={key:0},gl={class:"input-group"},kl={key:0,class:"invalid mt-0"},yl={key:0},xl={class:"d-flex gap-2"},Bl=["onClick"],hl={class:"mt-4"},$l={class:"table align-middle gray-table"},Cl={key:0},Tl={key:0},_l={class:"d-flex gap-2"},wl=["onClick"],Al={class:"mt-4"},Fl={class:"table align-middle gray-table side-table"},Sl={key:0,class:"block-bottom bg-light-teal"},Dl={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=[{value:1,text:"50%"},{value:2,text:"100%"}],c=e.ref(),V=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("accessibility",u.value.Status,2)),l=e.ref({}),o=e.computed(()=>y.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),u=e.ref({}),E=e.ref({}),y=e.ref([]),w=e.ref([]),F=()=>O.accessibility("createItem",{ID:C.id}).subscribe(i=>y.value.push(i)),p=()=>w.value.push({Type:0,ItemID:0}),r=_,g=()=>{rxjs.forkJoin([O.accessibility("getWorkSchedule",{ID:C.id})]).subscribe(i=>{const t=i[0];u.value=t.Project,E.value=t.GrantType,y.value=t.Items,w.value=t.Schedules,y.value.length||F(),w.value.length||p(),q().init("accessibility",u.value),c.value=u.value.changeApply,u.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=i=>{var d,f;if(l.value={},i&&!m()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:u.value,Items:y.value,Schedules:w.value,Before:(d=c.value)==null?void 0:d.Form2Before,After:(f=c.value)==null?void 0:f.Form2After,Submit:i?"true":"false"};O.accessibility("saveWorkSchedule",t).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=M(u.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},o.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`item-${d}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`schedule-${d}-`))),c.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,M(c.value,i))),!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",n),(i,t)=>{const d=e.resolveComponent("required-label"),f=e.resolveComponent("input-tw-date"),U=e.resolveComponent("tw-date"),h=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),D=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ml,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",il,[e.createElementVNode("table",cl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Vl,[e.createElementVNode("div",pl,[e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).StartTime,"onUpdate:modelValue":t[0]||(t[0]=b=>e.unref(u).StartTime=b)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).EndTime,"onUpdate:modelValue":t[1]||(t[1]=b=>e.unref(u).EndTime=b)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",fl,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(U,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",Nl,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",ul,[e.createElementVNode("table",El,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",bl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+x)),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(l)[`item-${x}-Title`],modelValue:b.Title,"onUpdate:modelValue":T=>b.Title=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",gl,[e.createVNode(S,{"empty-value":0,modelValue:b.Begin,"onUpdate:modelValue":T=>b.Begin=T},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:b.End,"onUpdate:modelValue":T=>b.End=T},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]?(e.openBlock(),e.createElementBlock("div",kl,e.toDisplayString(e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`item-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",yl,[e.createElementVNode("div",xl,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Bl)):e.createCommentVNode("",!0),x+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",hl,[e.createElementVNode("table",$l,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Cl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-Type`],options:N,modelValue:b.Type,"onUpdate:modelValue":T=>b.Type=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-ItemID`],options:e.unref(o),"text-name":"Title","value-name":"ID",modelValue:b.ItemID,"onUpdate:modelValue":T=>b.ItemID=T,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(b.ItemID?String.fromCharCode(65+e.unref(o).findIndex(T=>T.ID===b.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`schedule-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`schedule-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Tl,[e.createElementVNode("div",_l,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,wl)):e.createCommentVNode("",!0),x+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Al,[e.createElementVNode("table",Fl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=b=>e.unref(c).Form2Before=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":t[3]||(t[3]=b=>e.unref(c).Form2After=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Sl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=b=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=b=>s(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ul={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Ml={class:"modal-content"},Ol={class:"modal-body"},jl={class:"d-flex justify-content-center mt-4 gap-4"},Il={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},Pl={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(B,{expose:_}){let C;const N=e.ref(),c=B,V=()=>{C&&C()};return _({show:l=>{C=l,bootstrap.Modal.getOrCreateInstance(N.value).show()}}),(l,o)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:N,tabindex:"-1"},[e.createElementVNode("div",Ul,[e.createElementVNode("div",Ml,[o[0]||(o[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Ol,[e.renderSlot(l.$slots,"default"),e.createElementVNode("div",jl,[e.createElementVNode("button",Il,e.toDisplayString(c.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:V,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(c.confirm),1)])])])])],512)]))}},ql={class:"application-step"},Rl=["onClick"],Ll={class:"step-content"},zl={class:"step-label"},Jl={key:0,class:"step-status edit"},Gl={key:1,class:"step-status"},Ql={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(B,{emit:_}){const C=e.computed(()=>z(c.type,N[c.type].status,c.step)),N=q(),c=B,V=l=>{c.review?n("click",l.step):l.step<=N[c.type].step&&(location.href=`${l.url}.aspx?ID=${c.id}`)},n=_;return(l,o)=>(e.openBlock(),e.createElementBlock("div",ql,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.steps,a=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(C)&&(a.step<e.unref(N)[B.type].step||a.step===B.step)}]),onClick:u=>V(a),key:a,role:"button"},[e.createElementVNode("div",Ll,[e.createElementVNode("div",zl,e.toDisplayString(a.title),1),e.unref(C)&&a.step===B.step?(e.openBlock(),e.createElementBlock("div",Jl,"編輯中")):a.step<e.unref(N)[B.type].step?(e.openBlock(),e.createElementBlock("div",Gl,"已完成")):e.createCommentVNode("",!0)])],10,Rl))),128))]))}},Wl={class:"block"},Yl={class:"mt-4"},Hl={class:"table align-middle gray-table side-table"},Zl={key:0},Kl={key:1,class:"text-light-gray"},Xl={class:"d-flex gap-2"},vl={key:0,class:"invalid mt-0"},eo={class:"d-flex flex-column gap-2"},to={key:0},lo={class:"mt-4"},oo={class:"table align-middle gray-table side-table"},no={class:"row g-3"},ro={class:"col-12 col-xl-2"},ao={class:"text-gray mb-2"},so={class:"col-12 col-xl-3"},mo={class:"text-gray mb-2"},io={class:"col-12 col-xl-4"},co={class:"row g-1"},Vo={class:"col-7"},po={class:"col-5"},fo={class:"col-12 col-xl-3"},No={class:"text-gray mb-2"},uo={class:"col-12"},Eo={class:"text-gray mb-2"},bo={class:"mt-4"},go={class:"table align-middle gray-table side-table"},ko={class:"mt-4"},yo={class:"table align-middle gray-table side-table"},xo={key:0,class:"table-responsive mt-3 mb-0"},Bo={class:"table align-middle gray-table"},ho={key:0},$o={key:0},Co={class:"d-flex gap-2"},To=["onClick"],_o={class:"mt-4"},wo={class:"table align-middle gray-table side-table"},Ao={key:0,class:"block-bottom bg-light-teal"},Fo={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.ref(),n=e.computed(()=>z("culture",E.value.Status,1)),l=e.ref({}),o=e.ref(null),a=e.ref([]),u=e.computed(()=>w.value.filter(t=>!t.Deleted)),E=e.ref({}),y=e.computed(()=>a.value.filter(t=>!t.ParentCode)),w=e.ref([]),F=e.computed(()=>a.value.filter(t=>t.ParentCode===o.value)),p=e.computed({get:()=>!!u.value.length,set:t=>{t?r():w.value.forEach(d=>d.Deleted=!0)}}),r=()=>w.value.push({}),g=_,k=()=>{O.culture("getApplication",{ID:C.id}).subscribe(t=>{var d;E.value=t.Project,V.value=t.Contacts,w.value=t.ReceivedSubsidies,o.value=((d=a.value.find(f=>f.Code===E.value.Field))==null?void 0:d.ParentCode)||null,E.value.OrgCategory=E.value.OrgCategory||null,q().init("culture",E.value),c.value=E.value.changeApply,E.value.changeApply=void 0})},s=t=>t.Deleted=!0,m=t=>{var f,U;if(l.value={},t&&!i()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}const d={Project:E.value,Contacts:V.value,ReceivedSubsidies:w.value.filter(h=>h.ID||!h.Deleted),Before:(f=c.value)==null?void 0:f.Form1Before,After:(U=c.value)==null?void 0:U.Form1After,Submit:t?"true":"false"};O.culture("saveApplication",d).subscribe(h=>{t?g("next"):E.value.ID?k():window.location.href=`Application.aspx?ID=${h.ID}`})},i=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return E.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),l.value=M(E.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((d,f)=>Object.assign(l.value,M(d,t,`contact-${f}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},w.value.forEach((d,f)=>Object.assign(l.value,M(d,t,`received-${f}-`))),c.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,M(c.value,t))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([O.culture("getZgsCodes",{CodeGroup:"CULField"}),O.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{a.value=t[0],N.value=t[1],C.id?k():O.culture("getEmptyApplication").subscribe(d=>{o.value=null,E.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},d),V.value=[{Role:"負責人"},{Role:"聯絡人"}],q().init("culture",E.value)})})}),e.provide("editable",n),e.watch(o,()=>{o.value?F.value.find(t=>E.value.Field===t.Code)||(E.value.Field=F.value[0].Code):E.value.Field=null}),(t,d)=>{const f=e.resolveComponent("required-label"),U=e.resolveComponent("input-text"),h=e.resolveComponent("input-select"),S=e.resolveComponent("input-textarea"),D=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Wl,[d[45]||(d[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Yl,[e.createElementVNode("table",Hl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[17]||(d[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[d[18]||(d[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",Zl,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Kl,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[d[19]||(d[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[20]||(d[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":d[0]||(d[0]=b=>e.unref(E).ProjectName=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[21]||(d[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Xl,[e.createVNode(h,{"empty-value":null,options:e.unref(y),"text-name":"Descname","value-name":"Code",modelValue:e.unref(o),"onUpdate:modelValue":d[1]||(d[1]=b=>e.isRef(o)?o.value=b:null)},null,8,["options","modelValue"]),e.createVNode(h,{"empty-value":null,disabled:!e.unref(o),options:e.unref(F),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).Field,"onUpdate:modelValue":d[2]||(d[2]=b=>e.unref(E).Field=b)},null,8,["disabled","options","modelValue"])]),e.unref(l).Field?(e.openBlock(),e.createElementBlock("div",vl,e.toDisplayString(e.unref(l).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[22]||(d[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":d[3]||(d[3]=b=>e.unref(E).OrgName=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[23]||(d[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",eo,[e.createElementVNode("div",null,[e.createVNode(h,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":d[4]||(d[4]=b=>e.unref(E).OrgCategory=b)},null,8,["error","options","modelValue"])]),e.unref(E).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",to,[e.createVNode(U,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(E).RegisteredNum,"onUpdate:modelValue":d[5]||(d[5]=b=>e.unref(E).RegisteredNum=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[24]||(d[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":d[6]||(d[6]=b=>e.unref(E).TaxID=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[25]||(d[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":d[7]||(d[7]=b=>e.unref(E).Address=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),d[46]||(d[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",lo,[e.createElementVNode("table",oo,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",no,[e.createElementVNode("div",ro,[e.createElementVNode("div",ao,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[26]||(d[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(U,{error:e.unref(l)[`contact-${x}-Name`],modelValue:b.Name,"onUpdate:modelValue":T=>b.Name=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",so,[e.createElementVNode("div",mo,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[27]||(d[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(U,{error:e.unref(l)[`contact-${x}-JobTitle`],modelValue:b.JobTitle,"onUpdate:modelValue":T=>b.JobTitle=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",io,[d[28]||(d[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",co,[e.createElementVNode("div",Vo,[e.createVNode(U,{modelValue:b.Phone,"onUpdate:modelValue":T=>b.Phone=T,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",po,[e.createVNode(U,{placeholder:"請輸入分機",size:"4",modelValue:b.PhoneExt,"onUpdate:modelValue":T=>b.PhoneExt=T,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",fo,[e.createElementVNode("div",No,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[29]||(d[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(U,{error:e.unref(l)[`contact-${x}-MobilePhone`],modelValue:b.MobilePhone,"onUpdate:modelValue":T=>b.MobilePhone=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",uo,[e.createElementVNode("div",Eo,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[30]||(d[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(U,{error:e.unref(l)[`contact-${x}-EMail`],modelValue:b.EMail,"onUpdate:modelValue":T=>b.EMail=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),d[47]||(d[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",bo,[e.createElementVNode("table",go,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[31]||(d[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[d[32]||(d[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(S,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(E).Target,"onUpdate:modelValue":d[8]||(d[8]=b=>e.unref(E).Target=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[33]||(d[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":d[9]||(d[9]=b=>e.unref(E).Summary=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[34]||(d[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":d[10]||(d[10]=b=>e.unref(E).Quantified=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[35]||(d[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Qualitative,"onUpdate:modelValue":d[11]||(d[11]=b=>e.unref(E).Qualitative=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",ko,[e.createElementVNode("table",yo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[41]||(d[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(D,{modelValue:e.unref(p),"onUpdate:modelValue":d[12]||(d[12]=b=>e.isRef(p)?p.value=b:null)},null,8,["modelValue"]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",xo,[e.createElementVNode("table",Bo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[d[36]||(d[36]=e.createElementVNode("th",null,"計畫名稱",-1)),d[37]||(d[37]=e.createElementVNode("th",null,"補助單位",-1)),d[38]||(d[38]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",ho,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`received-${x}-Name`],modelValue:b.Name,"onUpdate:modelValue":T=>b.Name=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`received-${x}-Unit`],modelValue:b.Unit,"onUpdate:modelValue":T=>b.Unit=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l)[`received-${x}-Amount`],modelValue:b.Amount,"onUpdate:modelValue":T=>b.Amount=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",$o,[e.createElementVNode("div",Co,[e.unref(u).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>s(b),type:"button"},[...d[39]||(d[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,To)):e.createCommentVNode("",!0),x+1===e.unref(u).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:r,type:"button"},[...d[40]||(d[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[d[44]||(d[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",_o,[e.createElementVNode("table",wo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[42]||(d[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(c).Form1Before,"onUpdate:modelValue":d[13]||(d[13]=b=>e.unref(c).Form1Before=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...d[43]||(d[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(c).Form1After,"onUpdate:modelValue":d[14]||(d[14]=b=>e.unref(c).Form1After=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ao,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:d[15]||(d[15]=b=>m()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:d[16]||(d[16]=b=>m(!0)),type:"button"},[...d[48]||(d[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},So={class:"block"},Do={key:0,class:"text-pink lh-base mt-4"},Uo={class:"mt-4"},Mo={class:"table align-middle gray-table"},Oo={class:"text-center"},jo={key:0,width:"180"},Io={class:"text-center"},Po={key:0},qo=["innerHTML"],Ro=["onClick"],Lo={key:0,class:"text-center"},zo={key:0},Jo={key:1,class:"text-pink"},Go={key:1,class:"tag-group mt-2 gap-1"},Qo={key:0,class:"tag tag-green-light"},Wo=["download","href"],Yo=["onClick"],Ho={class:"mt-4"},Zo={class:"table align-middle gray-table side-table"},Ko={key:0,class:"block-bottom bg-light-teal"},Xo=["disabled"],vo={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([{Type:1,Title:"申請表",Template:!0,Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:!0,Files:[]},{Type:3,Title:"執行承諾書",Template:!0,Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:!0,Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),c=e.ref(),V=e.computed(()=>N.value.some(r=>!r.Optional&&!r.Files.filter(g=>!g.Deleted).length)),n=e.computed(()=>z("culture",o.value.Status,5)),l=e.ref({}),o=e.ref({}),a=(r,g)=>{g.Type==="application/pdf"&&r.Files.push({Type:r.Type,Path:g.Path,Name:o.value.ProjectID+"_"+(r.Multiple?g.Name:`${r.Title}.pdf`)})},u=O.download,E=r=>{const g=N.value[r-1];g!=null&&g.Template&&window.open(`/Service/DownloadTemplateCUL.ashx?cate=CUL&type=${g.Type}&id=${C.id}`)},y=_,w=()=>{rxjs.forkJoin([O.culture("getAttachment",{ID:C.id})]).subscribe(r=>{const g=r[0];o.value=g.Project,N.value=N.value.filter(k=>{var s;return!((s=k.Excludes)!=null&&s.includes(o.value.OrgCategory))}),o.value.Status>=10&&N.value.push({Type:6,Title:"著作權授權同意書",Template:!0,Files:[]}),N.value.forEach(k=>{k.Files=g.Attachments.filter(s=>s.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(s=>!s.Deleted).length)}),q().init("culture",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},F=r=>{var k,s;if(l.value={},r&&!p()){e.nextTick(()=>{var m;return(m=document.querySelector(".invalid"))==null?void 0:m.scrollIntoView({behavior:"smooth",block:"center"})});return}const g={ID:C.id,Attachments:N.value.reduce((m,i)=>m.concat(i.Files),[]),Before:(k=c.value)==null?void 0:k.Form5Before,After:(s=c.value)==null?void 0:s.Form5After,Submit:r?"true":"false"};O.culture("saveAttachment",g).subscribe(()=>{r?y("next"):w()})},p=()=>{if(c.value){const r={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,M(c.value,r))}return!Object.keys(l.value).length};return e.onMounted(w),e.provide("editable",n),(r,g)=>{const k=e.resolveComponent("required-label"),s=e.resolveComponent("input-file"),m=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",So,[g[13]||(g[13]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",Do,[...g[4]||(g[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Uo,[e.createElementVNode("table",Mo,[e.createElementVNode("thead",Oo,[e.createElementVNode("tr",null,[g[5]||(g[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),g[6]||(g[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",jo,"狀態")):e.createCommentVNode("",!0),g[7]||(g[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(i,t)=>(e.openBlock(),e.createElementBlock("tr",{key:i},[e.createElementVNode("td",Io,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[i.Optional?(e.openBlock(),e.createElementBlock("span",Po,e.toDisplayString(i.Title),1)):(e.openBlock(),e.createBlock(k,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(i.Title),1)]),_:2},1024))]),e.unref(n)&&i.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:i.Comment},null,8,qo)):e.createCommentVNode("",!0),e.unref(n)&&i.Template?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",onClick:d=>E(t+1),type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ro)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Lo,[i.Uploaded?(e.openBlock(),e.createElementBlock("span",zo,"已上傳")):(e.openBlock(),e.createElementBlock("span",Jo,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(i.Multiple||!i.Uploaded)?(e.openBlock(),e.createBlock(s,{key:0,accept:".pdf",onFile:d=>a(i,d)},null,8,["onFile"])):e.createCommentVNode("",!0),i.Uploaded?(e.openBlock(),e.createElementBlock("div",Go,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.Files,d=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:d},[d.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Qo,[e.createElementVNode("a",{class:"tag-link my-1",download:d.Name,href:e.unref(u)(d.Path)},e.toDisplayString(d.Name),9,Wo),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:f=>d.Deleted=!0,type:"button"},[...g[9]||(g[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Yo)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[g[12]||(g[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Ho,[e.createElementVNode("table",Zo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...g[10]||(g[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(c).Form5Before,"onUpdate:modelValue":g[0]||(g[0]=i=>e.unref(c).Form5Before=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...g[11]||(g[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(c).Form5After,"onUpdate:modelValue":g[1]||(g[1]=i=>e.unref(c).Form5After=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ko,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:g[2]||(g[2]=i=>F()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:g[3]||(g[3]=i=>F(!0)),disabled:e.unref(V),type:"button"},[...g[14]||(g[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Xo)])):e.createCommentVNode("",!0)],64)}}},en={class:"block"},tn={class:"mt-4"},ln={class:"table-responsive mt-3 mb-0"},on={class:"table align-middle gray-table"},nn={class:"text-end"},rn={class:"text-end"},an={class:"table-responsive"},dn={class:"table align-middle gray-table"},sn=["colspan"],mn={key:0,width:"1"},cn={key:0},Vn={class:"d-flex gap-2"},pn=["onClick"],fn={class:"mt-4"},Nn={class:"table-responsive mt-3 mb-0"},un={class:"table align-middle gray-table"},En={key:0,width:"1"},bn={class:"text-end"},gn={key:0},kn={class:"d-flex gap-2"},yn=["onClick"],xn={class:"mt-4"},Bn={class:"table align-middle gray-table side-table"},hn={key:0,class:"block-bottom bg-light-teal"},$n={class:"text-center"},Cn={class:"mb-5"},Tn={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("culture",o.value.Status,3)),V=e.ref({}),n=e.computed(()=>E.value.filter(d=>!d.Deleted)),l=e.computed(()=>y.value.filter(d=>!d.Deleted)),o=e.ref({}),a=e.ref([]),u=e.ref(),E=e.ref([]),y=e.ref([]),w=e.ref({}),F=e.ref(0),p=()=>E.value.push({}),r=()=>y.value.push({ItemID:0}),g=_,k=()=>{rxjs.forkJoin([O.culture("getFunding",{ID:C.id})]).subscribe(d=>{const f=d[0];o.value=f.Project,E.value=f.OtherSubsidies,y.value=f.BudgetPlans,a.value=f.Items,w.value=f.GrantTargetSetting,E.value.length||p(),y.value.length||r(),q().init("culture",o.value),N.value=o.value.changeApply,o.value.changeApply=void 0})},s=d=>d.Deleted=!0,m=d=>d.Deleted=!0,i=(d,f)=>{var h,S;if(V.value={},d&&!t()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!f&&o.value.ApplyAmount>w.value.GrantLimit*1e4){u.value.show(()=>i(d,!0));return}const U={Project:o.value,OtherSubsidies:E.value,BudgetPlans:y.value,Before:(h=N.value)==null?void 0:h.Form3Before,After:(S=N.value)==null?void 0:S.Form3After,Submit:d?"true":"false"};O.culture("saveFunding",U).subscribe(()=>{d?g("next"):k()})},t=()=>{let d={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(o.value,d),d={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},E.value.forEach((f,U)=>Object.assign(V.value,M(f,d,`other-${U}-`))),d={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},y.value.forEach((f,U)=>Object.assign(V.value,M(f,d,`plan-${U}-`))),N.value&&(d={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(N.value,d))),!Object.keys(V.value).length};return e.onMounted(k),e.provide("editable",c),e.watchEffect(()=>{o.value.OtherAmount=E.value.reduce((d,f)=>d+(f.Deleted?0:L(f.Amount)),0),F.value=L(o.value.ApplyAmount)+L(o.value.SelfAmount)+L(o.value.OtherAmount),y.value.forEach(d=>d.sum=L(d.Amount)+L(d.OtherAmount))}),(d,f)=>{var x;const U=e.resolveComponent("input-integer"),h=e.resolveComponent("input-text"),S=e.resolveComponent("input-select"),D=e.resolveComponent("input-textarea"),A=e.resolveComponent("required-label"),b=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",en,[f[25]||(f[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",tn,[e.createElementVNode("div",ln,[e.createElementVNode("table",on,[f[6]||(f[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).ApplyAmount,modelValue:e.unref(o).ApplyAmount,"onUpdate:modelValue":f[0]||(f[0]=T=>e.unref(o).ApplyAmount=T)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).SelfAmount,modelValue:e.unref(o).SelfAmount,"onUpdate:modelValue":f[1]||(f[1]=T=>e.unref(o).SelfAmount=T)},null,8,["error","modelValue"])]),e.createElementVNode("td",nn,e.toDisplayString((x=e.unref(o).OtherAmount)==null?void 0:x.toLocaleString()),1),e.createElementVNode("td",rn,e.toDisplayString(e.unref(F).toLocaleString()),1)])])])]),f[12]||(f[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",an,[e.createElementVNode("table",dn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(c)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,sn)]),e.createElementVNode("tr",null,[f[7]||(f[7]=e.createElementVNode("th",{width:"1"},null,-1)),f[8]||(f[8]=e.createElementVNode("th",null,"單位名稱",-1)),f[9]||(f[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",mn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(T,j)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(j+1),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(V)[`other-${j}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":I=>T.Unit=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`other-${j}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":I=>T.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",cn,[e.createElementVNode("div",Vn,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>s(T),type:"button"},[...f[10]||(f[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pn)):e.createCommentVNode("",!0),j+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...f[11]||(f[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),f[26]||(f[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",fn,[e.createElementVNode("div",Nn,[e.createElementVNode("table",un,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[f[13]||(f[13]=e.createElementVNode("th",null,"重要工作項目",-1)),f[14]||(f[14]=e.createElementVNode("th",null,"預算項目",-1)),f[15]||(f[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),f[16]||(f[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),f[17]||(f[17]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),f[18]||(f[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",En,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,j)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(V)[`plan-${j}-ItemID`],options:e.unref(a),"text-name":"Title","value-name":"ID",modelValue:T.ItemID,"onUpdate:modelValue":I=>T.ItemID=I},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(V)[`plan-${j}-Title`],modelValue:T.Title,"onUpdate:modelValue":I=>T.Title=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`plan-${j}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":I=>T.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`plan-${j}-OtherAmount`],modelValue:T.OtherAmount,"onUpdate:modelValue":I=>T.OtherAmount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",bn,e.toDisplayString(T.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(V)[`plan-${j}-Description`],rows:"1",modelValue:T.Description,"onUpdate:modelValue":I=>T.Description=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",gn,[e.createElementVNode("div",kn,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>m(T),type:"button"},[...f[19]||(f[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,yn)):e.createCommentVNode("",!0),j+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:r,type:"button"},[...f[20]||(f[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),f[21]||(f[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[f[24]||(f[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",xn,[e.createElementVNode("table",Bn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...f[22]||(f[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":f[2]||(f[2]=T=>e.unref(N).Form3Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...f[23]||(f[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":f[3]||(f[3]=T=>e.unref(N).Form3After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",hn,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:f[4]||(f[4]=T=>i()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:f[5]||(f[5]=T=>i(!0)),type:"button"},[...f[27]||(f[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(b,{ref_key:"modal",ref:u},{default:e.withCtx(()=>[e.createElementVNode("div",$n,[f[28]||(f[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Cn,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(w).GrantLimit)+"萬",1),f[29]||(f[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),f[30]||(f[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},_n={class:"block"},wn={key:0,class:"text-pink lh-base mt-3"},An={class:"border"},Fn={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Sn={class:"d-flex gap-2 align-items-center flex-grow-1"},Dn={class:"text-nowrap"},Un={class:"flex-grow-1"},Mn={class:"d-flex gap-2"},On=["onClick"],jn=["href"],In=["id"],Pn={class:"table align-middle gray-table side-table mb-0"},qn={class:"mt-4"},Rn={class:"table align-middle gray-table side-table"},Ln={key:0,class:"block-bottom bg-light-teal"},zn={__name:"Other",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("culture",n.value.Status,4)),V=e.ref({}),n=e.ref({}),l=e.ref([]),o=e.computed(()=>l.value.filter(p=>!p.Deleted)),a=()=>l.value.push({}),u=_,E=()=>{rxjs.forkJoin([O.culture("getRelatedProject",{ID:C.id})]).subscribe(p=>{const r=p[0];n.value=r.Project,l.value=r.Projects,q().init("culture",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},y=p=>p.Deleted=!0,w=p=>{var g,k;if(V.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:C.id,Projects:l.value,Before:(g=N.value)==null?void 0:g.Form4Before,After:(k=N.value)==null?void 0:k.Form4After,Submit:p?"true":"false"};O.culture("saveRelatedProject",r).subscribe(()=>{p?u("next"):E()})},F=()=>{let p={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return o.value.forEach((r,g)=>Object.assign(V.value,M(r,p,`project-${g}-`))),N.value&&(p={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(V.value,M(N.value,p))),!Object.keys(V.value).length};return e.onMounted(E),e.provide("editable",c),(p,r)=>{const g=e.resolveComponent("required-label"),k=e.resolveComponent("input-text"),s=e.resolveComponent("input-integer"),m=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_n,[r[14]||(r[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("p",wn," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(i,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:i},[e.createElementVNode("div",An,[e.createElementVNode("div",Fn,[e.createElementVNode("div",Sn,[e.createElementVNode("label",Dn,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[4]||(r[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",Un,[e.createVNode(k,{error:e.unref(V)[`project-${t}-Title`],modelValue:i.Title,"onUpdate:modelValue":d=>i.Title=d,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Mn,[e.unref(c)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(d=>y(i),["prevent"]),href:"#"},"刪除",8,On)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,jn)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",Pn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[5]||(r[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{class:"text-start w-auto",error:e.unref(V)[`project-${t}-Year`],modelValue:i.Year,"onUpdate:modelValue":d=>i.Year=d},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[6]||(r[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(V)[`project-${t}-OrgName`],modelValue:i.OrgName,"onUpdate:modelValue":d=>i.OrgName=d,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[7]||(r[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{class:"w-auto",error:e.unref(V)[`project-${t}-Amount`],modelValue:i.Amount,"onUpdate:modelValue":d=>i.Amount=d},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[8]||(r[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(V)[`project-${t}-Description`],rows:"4",modelValue:i.Description,"onUpdate:modelValue":d=>i.Description=d,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[9]||(r[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(V)[`project-${t}-Benefit`],rows:"4",modelValue:i.Benefit,"onUpdate:modelValue":d=>i.Benefit=d,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,In)])]))),128)),e.unref(c)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:a,type:"button"},[...r[10]||(r[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",qn,[e.createElementVNode("table",Rn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(V).Form4Before,rows:"4",modelValue:e.unref(N).Form4Before,"onUpdate:modelValue":r[0]||(r[0]=i=>e.unref(N).Form4Before=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[12]||(r[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(V).Form4After,rows:"4",modelValue:e.unref(N).Form4After,"onUpdate:modelValue":r[1]||(r[1]=i=>e.unref(N).Form4After=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",Ln,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[2]||(r[2]=i=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[3]||(r[3]=i=>w(!0)),type:"button"},[...r[15]||(r[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Jn={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(C,N)=>{const c=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(c,{steps:_,type:"culture"})}}},Gn=(B,_)=>{const C=B.__vccOpts||B;for(const[N,c]of _)C[N]=c;return C},Qn={class:"block"},Wn={class:"mt-4"},Yn={class:"table align-middle gray-table side-table"},Hn={key:0,class:"d-flex align-items-center gap-2"},Zn={class:"input-group w-auto"},Kn={class:"text-teal-dark"},Xn={key:1,class:"invalid mt-0"},vn={class:"square-title mt-4"},er={class:"mt-4"},tr=["onClick"],lr={class:"d-flex flex-column gap-2"},or={class:"mt-4 d-flex flex-column gap-2"},nr={class:"d-flex flex-column gap-3 mt-4"},rr={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},ar={class:"d-flex gap-2 align-items-center flex-grow-1"},dr={class:"text-nowrap"},sr={class:"flex-grow-1"},mr={class:"d-flex gap-2"},ir=["onClick"],cr=["href"],Vr=["id"],pr={class:"table align-middle gray-table side-table mb-0"},fr={class:"p-0"},Nr={class:"item-list"},ur={class:"mt-2 align-self-start text-center"},Er={class:"input-group"},br={key:0,class:"invalid mt-0"},gr={key:0,class:"d-flex gap-2 mt-1 align-self-start"},kr=["onClick"],yr=["onClick"],xr={class:"row"},Br={class:"col"},hr=["value"],$r={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Cr=["onClick"],Tr=["onClick"],_r={class:"col"},wr=["value"],Ar={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Fr=["onClick"],Sr=["onClick"],Dr=["onClick"],Ur={class:"mt-4"},Mr={class:"table align-middle gray-table side-table"},Or={key:0,class:"block-bottom bg-light-teal"},jr=Gn({__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("culture",o.value.Status,2)),V=e.computed(()=>u.value.EndDate),n=e.ref({}),l=e.computed(()=>a.value.filter(d=>!d.Deleted)),o=e.ref({}),a=e.ref([]),u=e.ref({}),E=()=>{const d={Items:[]};y(d),a.value.push(d)},y=d=>{const f={Steps:[],Schedules:[]};F(f),F(f),F(f),w(f,1),w(f,2),d.Items.push(f)},w=(d,f)=>d.Schedules.push({Type:f,Month:0,StepID:0}),F=d=>O.culture("createGoalStep",{ID:C.id,ItemID:d.ID}).subscribe(f=>d.Steps.push(f)),p=_,r=()=>{rxjs.forkJoin([O.culture("getWorkSchedule",{ID:C.id})]).subscribe(d=>{const f=d[0];o.value=f.Project,a.value=f.Goals,u.value=f.GrantType,a.value.length||E(),q().init("culture",o.value),N.value=o.value.changeApply,o.value.changeApply=void 0})},g=d=>d.Deleted=!0,k=d=>d.Deleted=!0,s=d=>d.Deleted=!0,m=d=>d.Deleted=!0,i=d=>{var U,h;if(n.value={},d&&!t()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const f={Project:o.value,Goals:a.value,Before:(U=N.value)==null?void 0:U.Form2Before,After:(h=N.value)==null?void 0:h.Form2After,Submit:d?"true":"false"};O.culture("saveWorkSchedule",f).subscribe(()=>{d?p("next"):r()})},t=()=>{let d={StartTime:"計畫期程",EndTime:"計畫期程"};n.value=M(o.value,d);const f={Title:"計畫目標",Content:"預期效益"},U={Title:"重要工作項目",Indicator:"績效指標"},h={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},S={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return a.value.filter(D=>!D.Deleted).forEach((D,A)=>{Object.assign(n.value,M(D,f,`goal-${A}-`)),D.Items.filter(b=>!b.Deleted).forEach((b,x)=>{Object.assign(n.value,M(b,U,`item-${A}-${x}-`)),b.Steps.filter(T=>!T.Deleted).forEach((T,j)=>Object.assign(n.value,M(T,h,`step-${A}-${x}-${j}-`))),b.Schedules.filter(T=>T.Type===1&&!T.Deleted).forEach((T,j)=>Object.assign(n.value,M(T,S,`schedule-${A}-${x}-1-${j}-`))),b.Schedules.filter(T=>T.Type===2&&!T.Deleted).forEach((T,j)=>Object.assign(n.value,M(T,S,`schedule-${A}-${x}-2-${j}-`)))})}),N.value&&(d={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(n.value,M(N.value,d))),!Object.keys(n.value).length};return e.onMounted(r),e.provide("editable",c),(d,f)=>{const U=e.resolveComponent("required-label"),h=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),D=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-month"),x=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qn,[f[30]||(f[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Wn,[e.createElementVNode("table",Yn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[6]||(f[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Hn,[e.createElementVNode("div",Zn,[e.createVNode(h,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(o).StartTime,"onUpdate:modelValue":f[0]||(f[0]=T=>e.unref(o).StartTime=T)},null,8,["max-date","modelValue"]),f[7]||(f[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(h,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(o).EndTime,"onUpdate:modelValue":f[1]||(f[1]=T=>e.unref(o).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Kn,[f[8]||(f[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(V)},null,8,["value"]),f[9]||(f[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(n).StartTime||e.unref(n).EndTime?(e.openBlock(),e.createElementBlock("div",Xn,e.toDisplayString(e.unref(n).StartTime||e.unref(n).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",vn,[f[11]||(f[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:E,type:"button"},[...f[10]||(f[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",er,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,j)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:T},[e.unref(c)&&e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:I=>g(T),type:"button"},"刪除",8,tr)):e.createCommentVNode("",!0),e.createElementVNode("div",lr,[f[12]||(f[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(D,{error:e.unref(n)[`goal-${j}-Title`],modelValue:T.Title,"onUpdate:modelValue":I=>T.Title=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",or,[f[13]||(f[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(A,{error:e.unref(n)[`goal-${j}-Content`],rows:"4",modelValue:T.Content,"onUpdate:modelValue":I=>T.Content=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",nr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.Items.filter(I=>!I.Deleted),(I,J)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:I},[e.createElementVNode("div",rr,[e.createElementVNode("div",ar,[e.createElementVNode("label",dr,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[14]||(f[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",sr,[e.createVNode(D,{error:e.unref(n)[`item-${j}-${J}-Title`],modelValue:I.Title,"onUpdate:modelValue":P=>I.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",mr,[e.unref(c)&&T.Items.filter(P=>!P.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(P=>k(I),["prevent"]),href:"#"},"刪除",8,ir)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${J}`,role:"button"},"收合",8,cr)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${J}`},[e.createElementVNode("table",pr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[15]||(f[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",fr,[e.createElementVNode("ul",Nr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Steps.filter(P=>!P.Deleted),(P,G)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(c)}]),key:P},[e.createElementVNode("div",ur,e.toDisplayString(String.fromCharCode(65+G)),1),e.createElementVNode("div",null,[e.createVNode(D,{error:e.unref(n)[`step-${j}-${J}-${G}-Title`],placeholder:"如:進行口訪紀錄",modelValue:P.Title,"onUpdate:modelValue":R=>P.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",Er,[e.createVNode(b,{"empty-value":0,modelValue:P.Begin,"onUpdate:modelValue":R=>P.Begin=R},null,8,["modelValue","onUpdate:modelValue"]),f[16]||(f[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(b,{"empty-value":0,modelValue:P.End,"onUpdate:modelValue":R=>P.End=R},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(n)[`step-${j}-${J}-${G}-Begin`]||e.unref(n)[`step-${j}-${J}-${G}-End`]?(e.openBlock(),e.createElementBlock("div",br,e.toDisplayString(e.unref(n)[`step-${j}-${J}-${G}-Begin`]||e.unref(n)[`step-${j}-${J}-${G}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",gr,[I.Steps.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>m(P),type:"button"},[...f[17]||(f[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,kr)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>F(I),type:"button"},[...f[18]||(f[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,yr)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[19]||(f[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(n)[`item-${j}-${J}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:I.Indicator,"onUpdate:modelValue":P=>I.Indicator=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[20]||(f[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",xr,[e.createElementVNode("div",Br,[f[23]||(f[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Schedules.filter(P=>P.Type===1&&!P.Deleted),(P,G)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:P},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(c)?3:4}`])},[e.createVNode(b,{error:e.unref(n)[`schedule-${j}-${J}-1-${G}-Month`],"empty-value":0,modelValue:P.Month,"onUpdate:modelValue":R=>P.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(c)?7:8}`])},[e.createVNode(x,{"empty-value":0,error:e.unref(n)[`schedule-${j}-${J}-1-${G}-StepID`],options:I.Steps.filter(R=>!R.Deleted),modelValue:P.StepID,"onUpdate:modelValue":R=>P.StepID=R},{default:e.withCtx(({index:R,option:H})=>[e.createElementVNode("option",{value:H.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(H.Title),9,hr)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(c)?(e.openBlock(),e.createElementBlock("div",$r,[I.Schedules.filter(R=>R.Type===1&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>s(P),type:"button"},[...f[21]||(f[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Cr)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>w(I,1),type:"button"},[...f[22]||(f[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Tr)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",_r,[f[26]||(f[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Schedules.filter(P=>P.Type===2&&!P.Deleted),(P,G)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:P},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(c)?3:4}`])},[e.createVNode(b,{error:e.unref(n)[`schedule-${j}-${J}-2-${G}-Month`],"empty-value":0,modelValue:P.Month,"onUpdate:modelValue":R=>P.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(c)?7:8}`])},[e.createVNode(x,{"empty-value":0,error:e.unref(n)[`schedule-${j}-${J}-2-${G}-StepID`],options:I.Steps.filter(R=>!R.Deleted),modelValue:P.StepID,"onUpdate:modelValue":R=>P.StepID=R},{default:e.withCtx(({index:R,option:H})=>[e.createElementVNode("option",{value:H.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(H.Title),9,wr)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(c)?(e.openBlock(),e.createElementBlock("div",Ar,[I.Schedules.filter(R=>R.Type===2&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>s(P),type:"button"},[...f[24]||(f[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Fr)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>w(I,2),type:"button"},[...f[25]||(f[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Sr)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,Vr)]))),128))]),e.unref(c)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:I=>y(T),type:"button"},"新增工作項目",8,Dr)):e.createCommentVNode("",!0)]))),128))]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[f[29]||(f[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Ur,[e.createElementVNode("table",Mr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[27]||(f[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(n).Form2Before,rows:"4",modelValue:e.unref(N).Form2Before,"onUpdate:modelValue":f[2]||(f[2]=T=>e.unref(N).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(U,null,{default:e.withCtx(()=>[...f[28]||(f[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(n).Form2After,rows:"4",modelValue:e.unref(N).Form2After,"onUpdate:modelValue":f[3]||(f[3]=T=>e.unref(N).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",Or,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:f[4]||(f[4]=T=>i()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:f[5]||(f[5]=T=>i(!0)),type:"button"},[...f[31]||(f[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-814ebf78"]]),Ir={class:"block"},Pr={class:"mt-4"},qr={class:"table align-middle gray-table side-table"},Rr={key:0},Lr={key:1,class:"text-light-gray"},zr={class:"d-flex flex-column gap-2"},Jr={key:0},Gr={class:"mt-4"},Qr={class:"table align-middle gray-table side-table"},Wr={class:"row g-3"},Yr={class:"col-12 col-xl-2"},Hr={class:"text-gray mb-2"},Zr={class:"col-12 col-xl-3"},Kr={class:"text-gray mb-2"},Xr={key:0,class:"col-12 col-xl-4"},vr={class:"row g-1"},ea={class:"col-7"},ta={class:"col-5"},la={key:1,class:"col-12 col-xl-3"},oa={class:"text-gray mb-2"},na={class:"mt-4"},ra={class:"table align-middle gray-table side-table"},aa={class:"d-flex align-items-center gap-2"},da={class:"input-group w-auto"},sa={key:0,class:"invalid mt-0"},ma={class:"mt-4"},ia={class:"table-responsive mt-3 mb-0"},ca={class:"table align-middle gray-table"},Va={class:"text-end"},pa={class:"text-end"},fa={class:"text-end"},Na={class:"text-end"},ua={class:"text-end"},Ea={class:"table align-middle gray-table side-table"},ba={key:0,class:"table-responsive mt-3 mb-0"},ga={class:"table align-middle gray-table"},ka={key:0},ya={key:0},xa={class:"d-flex gap-2"},Ba=["onClick"],ha={class:"mt-4"},$a={class:"table align-middle gray-table side-table"},Ca={key:0,class:"block-bottom bg-light-teal"},Ta={class:"text-center"},_a={class:"mb-5"},wa={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.ref(),n=e.computed(()=>z("education",a.value.Status,1)),l=e.ref({}),o=e.computed(()=>E.value.filter(i=>!i.Deleted)),a=e.ref({}),u=e.ref(),E=e.ref([]),y=e.ref(),w=e.ref(0),F=e.computed({get:()=>!!o.value.length,set:i=>{i?p():E.value.forEach(t=>t.Deleted=!0)}}),p=()=>E.value.push({}),r=_,g=()=>{O.education("getApplication",{ID:C.id}).subscribe(i=>{a.value=i.Project,V.value=i.Contacts,E.value=i.ReceivedSubsidies,a.value.OrgCategory=a.value.OrgCategory||null,q().init("education",a.value),c.value=a.value.changeApply,a.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=(i,t)=>{var f,U;if(l.value={},i&&!m()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&y.value&&a.value.ApplyAmount>y.value.GrantLimit*1e4){u.value.show(()=>s(i,!0));return}const d={Project:a.value,Contacts:V.value,ReceivedSubsidies:E.value.filter(h=>h.ID||!h.Deleted),Before:(f=c.value)==null?void 0:f.Form1Before,After:(U=c.value)==null?void 0:U.Form1After,Submit:i?"true":"false"};O.education("saveApplication",d).subscribe(h=>{i?r("next"):a.value.ID?g():window.location.href=`Application.aspx?ID=${h.ID}`})},m=()=>{let i={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return a.value.OrgCategory==="2"&&(i.RegisteredNum="立案登記證字號"),l.value=M(a.value,i),i={Name:"姓名",JobTitle:"職稱"},Object.assign(l.value,M(V.value[0],i,"contact-0-")),i.MobilePhone="手機號碼",Object.assign(l.value,M(V.value[1],i,"contact-1-")),i={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},E.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`received-${d}-`))),c.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,M(c.value,i))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([O.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(i=>{N.value=i[0],C.id?g():O.education("getEmptyApplication").subscribe(t=>{a.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},t),V.value=[{Role:"負責人"},{Role:"聯絡人"}],q().init("education",a.value)})})}),e.provide("editable",n),e.watch(()=>a.value.OrgCategory,()=>{O.education("getGrantTargetSetting",{TargetTypeID:`EDC${a.value.OrgCategory}`}).subscribe(i=>{y.value=i})}),e.watchEffect(()=>{w.value=L(a.value.ApplyAmount)+L(a.value.SelfAmount)+L(a.value.OtherGovAmount)+L(a.value.OtherUnitAmount)}),(i,t)=>{const d=e.resolveComponent("required-label"),f=e.resolveComponent("input-text"),U=e.resolveComponent("input-select"),h=e.resolveComponent("input-tw-date"),S=e.resolveComponent("input-textarea"),D=e.resolveComponent("input-integer"),A=e.resolveComponent("input-boolean"),b=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ir,[t[52]||(t[52]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Pr,[e.createElementVNode("table",qr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[20]||(t[20]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",Rr,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Lr,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).ProjectName,modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":t[0]||(t[0]=x=>e.unref(a).ProjectName=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",zr,[e.createElementVNode("div",null,[e.createVNode(U,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).OrgCategory,"onUpdate:modelValue":t[1]||(t[1]=x=>e.unref(a).OrgCategory=x)},null,8,["error","options","modelValue"])]),e.unref(a).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Jr,[e.createVNode(f,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(a).RegisteredNum,"onUpdate:modelValue":t[2]||(t[2]=x=>e.unref(a).RegisteredNum=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":t[3]||(t[3]=x=>e.unref(a).OrgName=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[26]||(t[26]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(a).TaxID,"onUpdate:modelValue":t[4]||(t[4]=x=>e.unref(a).TaxID=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[27]||(t[27]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":t[5]||(t[5]=x=>e.unref(a).Address=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[53]||(t[53]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Gr,[e.createElementVNode("table",Qr,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(x,T)=>(e.openBlock(),e.createElementBlock("tr",{key:x},[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Wr,[e.createElementVNode("div",Yr,[e.createElementVNode("div",Hr,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[28]||(t[28]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(l)[`contact-${T}-Name`],modelValue:x.Name,"onUpdate:modelValue":j=>x.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Zr,[e.createElementVNode("div",Kr,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[29]||(t[29]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(l)[`contact-${T}-JobTitle`],modelValue:x.JobTitle,"onUpdate:modelValue":j=>x.JobTitle=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),T?(e.openBlock(),e.createElementBlock("div",Xr,[t[30]||(t[30]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",vr,[e.createElementVNode("div",ea,[e.createVNode(f,{modelValue:x.Phone,"onUpdate:modelValue":j=>x.Phone=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ta,[e.createVNode(f,{placeholder:"請輸入分機",size:"4",modelValue:x.PhoneExt,"onUpdate:modelValue":j=>x.PhoneExt=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),T?(e.openBlock(),e.createElementBlock("div",la,[e.createElementVNode("div",oa,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[31]||(t[31]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(l)[`contact-${T}-MobilePhone`],modelValue:x.MobilePhone,"onUpdate:modelValue":j=>x.MobilePhone=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),t[54]||(t[54]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",na,[e.createElementVNode("table",ra,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[32]||(t[32]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",aa,[e.createElementVNode("div",da,[e.createVNode(h,{class:"w-auto",modelValue:e.unref(a).StartTime,"onUpdate:modelValue":t[6]||(t[6]=x=>e.unref(a).StartTime=x)},null,8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(h,{class:"w-auto",modelValue:e.unref(a).EndTime,"onUpdate:modelValue":t[7]||(t[7]=x=>e.unref(a).EndTime=x)},null,8,["modelValue"])]),t[34]||(t[34]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",sa,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[35]||(t[35]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Target,modelValue:e.unref(a).Target,"onUpdate:modelValue":t[8]||(t[8]=x=>e.unref(a).Target=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[36]||(t[36]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":t[9]||(t[9]=x=>e.unref(a).Summary=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[37]||(t[37]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":t[10]||(t[10]=x=>e.unref(a).Quantified=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[55]||(t[55]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",ma,[t[43]||(t[43]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",ia,[e.createElementVNode("table",ca,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Va,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[38]||(t[38]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",pa,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[39]||(t[39]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款",-1)])]),_:1})]),e.createElementVNode("th",fa,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[40]||(t[40]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Na,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[41]||(t[41]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費（含總收費）",-1)])]),_:1})]),t[42]||(t[42]=e.createElementVNode("th",{class:"text-end"},"計畫總經費",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).ApplyAmount,modelValue:e.unref(a).ApplyAmount,"onUpdate:modelValue":t[11]||(t[11]=x=>e.unref(a).ApplyAmount=x)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).SelfAmount,modelValue:e.unref(a).SelfAmount,"onUpdate:modelValue":t[12]||(t[12]=x=>e.unref(a).SelfAmount=x)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).OtherGovAmount,modelValue:e.unref(a).OtherGovAmount,"onUpdate:modelValue":t[13]||(t[13]=x=>e.unref(a).OtherGovAmount=x)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).OtherUnitAmount,modelValue:e.unref(a).OtherUnitAmount,"onUpdate:modelValue":t[14]||(t[14]=x=>e.unref(a).OtherUnitAmount=x)},null,8,["error","modelValue"])]),e.createElementVNode("td",ua,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])])]),e.createElementVNode("table",Ea,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[44]||(t[44]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{modelValue:e.unref(F),"onUpdate:modelValue":t[15]||(t[15]=x=>e.isRef(F)?F.value=x:null)},null,8,["modelValue"]),e.unref(F)?(e.openBlock(),e.createElementBlock("div",ba,[e.createElementVNode("table",ga,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[45]||(t[45]=e.createElementVNode("th",null,"計畫名稱",-1)),t[46]||(t[46]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",ka,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(x,T)=>(e.openBlock(),e.createElementBlock("tr",{key:x},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`received-${T}-Name`],modelValue:x.Name,"onUpdate:modelValue":j=>x.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`received-${T}-Amount`],modelValue:x.Amount,"onUpdate:modelValue":j=>x.Amount=j},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",ya,[e.createElementVNode("div",xa,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:j=>k(x),type:"button"},[...t[47]||(t[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ba)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[48]||(t[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[51]||(t[51]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ha,[e.createElementVNode("table",$a,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[49]||(t[49]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(c).Form1Before,"onUpdate:modelValue":t[16]||(t[16]=x=>e.unref(c).Form1Before=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[50]||(t[50]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(c).Form1After,"onUpdate:modelValue":t[17]||(t[17]=x=>e.unref(c).Form1After=x),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ca,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[18]||(t[18]=x=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[19]||(t[19]=x=>s(!0)),type:"button"},[...t[56]||(t[56]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(b,{ref_key:"modal",ref:u},{default:e.withCtx(()=>{var x;return[e.createElementVNode("div",Ta,[t[57]||(t[57]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",_a,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((x=e.unref(y))==null?void 0:x.GrantLimit)+"萬",1),t[58]||(t[58]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[59]||(t[59]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},Aa={class:"block"},Fa={key:0,class:"text-pink lh-base mt-4"},Sa={class:"mt-4"},Da={class:"table align-middle gray-table"},Ua={class:"text-center"},Ma={key:0,width:"180"},Oa={class:"text-center"},ja={key:0},Ia=["innerHTML"],Pa={key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",type:"button"},qa={key:0,class:"text-center"},Ra={key:0},La={key:1,class:"text-pink"},za={key:1,class:"tag-group mt-2 gap-1"},Ja={key:0,class:"tag tag-green-light"},Ga=["download","href"],Qa=["onClick"],Wa={class:"mt-4"},Ya={class:"table align-middle gray-table side-table"},Ha={key:0,class:"block-bottom bg-light-teal"},Za=["disabled"],Ka={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([{Type:1,Title:"申請表",Template:!0,Files:[]},{Type:2,Title:"計畫書",Template:!0,Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:!0,Files:[]}]),c=e.ref(),V=e.computed(()=>N.value.some(p=>!p.Optional&&!p.Files.filter(r=>!r.Deleted).length)),n=e.computed(()=>z("education",o.value.Status,2)),l=e.ref({}),o=e.ref({}),a=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:o.value.ProjectID+"_"+(p.Multiple?r.Name:`${p.Title}.pdf`)})},u=O.download,E=_,y=()=>{rxjs.forkJoin([O.education("getAttachment",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=N.value.filter(g=>{var k;return!((k=g.Excludes)!=null&&k.includes(o.value.OrgCategory))}),N.value.forEach(g=>{g.Files=r.Attachments.filter(k=>k.Type===g.Type),g.Uploaded=e.computed(()=>g.Files.filter(k=>!k.Deleted).length)}),q().init("education",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},w=p=>{var g,k;if(l.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:C.id,Attachments:N.value.reduce((s,m)=>s.concat(m.Files),[]),Before:(g=c.value)==null?void 0:g.Form5Before,After:(k=c.value)==null?void 0:k.Form5After,Submit:p?"true":"false"};O.education("saveAttachment",r).subscribe(()=>{p?E("next"):y()})},F=()=>{if(c.value){const p={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,M(c.value,p))}return!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",n),(p,r)=>{const g=e.resolveComponent("required-label"),k=e.resolveComponent("input-file"),s=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Aa,[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",Fa,[...r[4]||(r[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如社團成立證明、社團運作證明、有效期間內之當選證書、登記證書等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Sa,[e.createElementVNode("table",Da,[e.createElementVNode("thead",Ua,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Ma,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",Oa,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",ja,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(g,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,Ia)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("button",Pa,[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])])):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",qa,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",Ra,"已上傳")):(e.openBlock(),e.createElementBlock("span",La,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(k,{key:0,accept:".pdf",onFile:t=>a(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",za,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ja,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(u)(t.Path)},e.toDisplayString(t.Name),9,Ga),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:d=>t.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Qa)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[r[12]||(r[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Wa,[e.createElementVNode("table",Ya,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(c).Form5Before,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(c).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(c).Form5After,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ha,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[2]||(r[2]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[3]||(r[3]=m=>w(!0)),disabled:e.unref(V),type:"button"},[...r[14]||(r[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Za)])):e.createCommentVNode("",!0)],64)}}},Xa={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(C,N)=>{const c=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(c,{steps:_,type:"education"})}}},va={class:"modal-dialog modal-dialog-centered modal-md"},ed={class:"modal-content"},td={class:"modal-body"},ld={class:"d-flex flex-column align-items-center mb-5 gap-3"},od={class:"fs-18"},nd={__name:"ErrorModal",setup(B){const _=Z(),C=e.ref();return e.onMounted(()=>C.value.addEventListener("hidden.bs.modal",()=>_.error=null)),e.watch(()=>_.error,()=>{_.error&&bootstrap.Modal.getOrCreateInstance(C.value).show()}),(N,c)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:C,tabindex:"-1"},[e.createElementVNode("div",va,[e.createElementVNode("div",ed,[c[2]||(c[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",td,[e.createElementVNode("div",ld,[c[0]||(c[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",od,e.toDisplayString(e.unref(_).error),1)]),c[1]||(c[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},rd={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(B){const _=e.useModel(B,"modelValue"),C=[{value:!0,text:"是"},{value:!1,text:"否"}];return(N,c)=>{const V=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(V,{options:C,modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=n=>_.value=n)},null,8,["modelValue"])}}},ad=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(B,{emit:_}){const C=e.ref(),N=()=>{Array.from(C.value.files).forEach(V=>O.upload(V).subscribe(n=>c("file",n))),C.value.value=""},c=_;return(V,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:n[0]||(n[0]=l=>e.unref(C).click()),type:"button"},[...n[1]||(n[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:N,class:"d-none",ref_key:"input",ref:C,type:"file"},V.$attrs),null,16)],64))}}),dd=["disabled","placeholder","type"],sd={key:0,class:"invalid mt-0"},md=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),C=e.useModel(B,"modelValue");return e.watch(C,N=>{if(N){const c=(parseInt(N)||0).toString();N.toString()!==c&&(C.value=c)}}),(N,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:"",style:{"text-align":"right"},type:B.type},N.$attrs,{"onUpdate:modelValue":c[0]||(c[0]=V=>C.value=V)}),null,16,dd),[[e.vModelDynamic,C.value]]),B.error?(e.openBlock(),e.createElementBlock("div",sd,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),id={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(B){const _=e.useModel(B,"modelValue"),C=[];for(let N=1;N<=12;N++)C.push({value:N,text:`${N}月`});return(N,c)=>{const V=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(V,{options:C,modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=n=>_.value=n)},null,8,["modelValue"])}}},cd=["onChange","checked","disabled","id","value"],Vd=["for"],pd={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>le(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),C=e.useModel(B,"modelValue"),N=c=>{C.value=c};return(c,V)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.options,n=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:n},[e.createElementVNode("input",{onChange:l=>N(n[B.valueName]),checked:n[B.valueName]===C.value,class:"form-check-input",disabled:!e.unref(_),id:`${B.id}-${n[B.valueName]}`,type:"radio",value:n[B.valueName]},null,40,cd),e.createElementVNode("label",{class:"form-check-label",for:`${B.id}-${n[B.valueName]}`},e.toDisplayString(n[B.textName]),9,Vd)]))),128))}},fd=["disabled"],Nd=["value"],ud=["value"],Ed={key:0,class:"invalid mt-0"},bd=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),C=e.useModel(B,"modelValue");return(N,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:B.disabled||!e.unref(_)},N.$attrs,{"onUpdate:modelValue":c[0]||(c[0]=V=>C.value=V)}),[e.unref(_)&&!C.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:B.emptyValue},e.toDisplayString(B.placeholder),9,Nd)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.options,(V,n)=>e.renderSlot(N.$slots,"default",{key:V,index:n,option:V},()=>[e.createElementVNode("option",{value:V[B.valueName]},e.toDisplayString(V[B.textName]),9,ud)])),128))],16,fd),[[e.vModelSelect,C.value]]),B.error?(e.openBlock(),e.createElementBlock("div",Ed,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),gd={class:"input-group"},kd={key:0,class:"input-group-text"},yd=["disabled","placeholder","type"],xd={key:0,class:"invalid mt-0"},Bd=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),C=e.useModel(B,"modelValue"),N=B;return N.maxLength&&e.watch(C,()=>{var c;((c=C.value)==null?void 0:c.length)>N.maxLength&&(C.value=C.value.substring(0,N.maxLength))}),(c,V)=>{const n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",gd,[B.prefix?(e.openBlock(),e.createElementBlock("span",kd,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(B.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:"",type:B.type},c.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=l=>C.value=l)}),null,16,yd),[[e.vModelDynamic,C.value]])]),B.error?(e.openBlock(),e.createElementBlock("div",xd,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64)}}}),hd=["disabled","placeholder"],$d={key:0,class:"fs-14 text-gray mt-2"},Cd={class:"text-pink"},Td={key:1,class:"invalid mt-0"},_d=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),C=e.useModel(B,"modelValue"),N=B;return N.maxLength&&e.watch(C,()=>{var c;((c=C.value)==null?void 0:c.length)>N.maxLength&&(C.value=C.value.substring(0,N.maxLength))}),(c,V)=>{var n;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:""},c.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=l=>C.value=l)}),null,16,hd),[[e.vModelText,C.value]]),e.unref(_)&&B.maxLength?(e.openBlock(),e.createElementBlock("div",$d,[V[1]||(V[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",Cd,e.toDisplayString(((n=C.value)==null?void 0:n.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(B.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),B.error?(e.openBlock(),e.createElementBlock("div",Td,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64)}}}),wd=["disabled"],Ad={key:0,class:"invalid"},Fd=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean}},emits:["update:modelValue"],setup(B,{emit:_}){let C;const N=B,c=e.ref(),V=e.inject("editable",!0),n=e.ref(),l=_,o=a=>{!a&&N.modelValue&&(a=moment(new Date(N.modelValue))),a?(c.value=a.format(N.displayFormat),l("update:modelValue",a.format(N.format))):(c.value="",l("update:modelValue","")),C.setStartDate(c.value||void 0)};return e.onMounted(()=>{const a=$(n.value);a.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:N.drops,locale:{format:N.displayFormat},maxDate:N.maxDate?new Date(N.maxDate):N.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(u,E)=>o(E.startDate)),C=a.data("daterangepicker"),o()}),e.onUnmounted(()=>C.remove()),e.watch(()=>N.modelValue,()=>o()),(a,u)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(V),ref_key:"element",ref:n,type:"text"},a.$attrs,{"onUpdate:modelValue":u[0]||(u[0]=E=>e.isRef(c)?c.value=E:null)}),null,16,wd),[[e.vModelText,e.unref(c)]]),B.error?(e.openBlock(),e.createElementBlock("div",Ad,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),Sd={class:"block"},Dd={class:"mt-4"},Ud={class:"table align-middle gray-table side-table"},Md={key:0},Od={key:1,class:"text-light-gray"},jd={class:"mt-4"},Id={class:"table align-middle gray-table side-table"},Pd={class:"row g-3"},qd={class:"col-12 col-xl-2"},Rd={class:"text-gray mb-2"},Ld={class:"col-12 col-xl-3"},zd={class:"text-gray mb-2"},Jd={class:"col-12 col-xl-4"},Gd={class:"row g-1"},Qd={class:"col-7"},Wd={class:"col-5"},Yd={class:"col-12 col-xl-3"},Hd={class:"text-gray mb-2"},Zd={class:"col-12"},Kd={class:"text-gray mb-2"},Xd={class:"mt-4"},vd={class:"table align-middle gray-table side-table"},es={class:"mt-4"},ts={class:"table align-middle gray-table side-table"},ls={key:0,class:"table-responsive mt-3 mb-0"},os={class:"table align-middle gray-table"},ns={key:0},rs={key:0},as={class:"d-flex gap-2"},ds=["onClick"],ss={class:"mt-4"},ms={class:"table align-middle gray-table side-table"},is={key:0,class:"block-bottom bg-light-teal"},cs={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.ref(),V=e.computed(()=>z("literacy",a.value.Status,1)),n=e.ref({}),l=e.ref([]),o=e.computed(()=>u.value.filter(k=>!k.Deleted)),a=e.ref({}),u=e.ref([]),E=e.computed({get:()=>!!o.value.length,set:k=>{k?y():u.value.forEach(s=>s.Deleted=!0)}}),y=()=>u.value.push({}),w=_,F=()=>{O.literacy("getApplication",{ID:C.id}).subscribe(k=>{a.value=k.Project,N.value=k.Contacts,u.value=k.PreviousStudies,q().init("literacy",a.value),c.value=a.value.changeApply,a.value.changeApply=void 0})},p=k=>k.Deleted=!0,r=k=>{var m,i;if(n.value={},k&&!g()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const s={Project:a.value,Contacts:N.value,PreviousStudies:u.value.filter(t=>t.ID||!t.Deleted),Before:(m=c.value)==null?void 0:m.Form1Before,After:(i=c.value)==null?void 0:i.Form1After,Submit:k?"true":"false"};O.literacy("saveApplication",s).subscribe(t=>{k?w("next"):a.value.ID?F():window.location.href=`Application.aspx?ID=${t.ID}`})},g=()=>{let k={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return n.value=M(a.value,k),k={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((s,m)=>Object.assign(n.value,M(s,k,`contact-${m}-`))),k={Title:"研習/課程名稱",TheDate:"辦理日期"},u.value.forEach((s,m)=>Object.assign(n.value,M(s,k,`study-${m}-`))),c.value&&(k={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(n.value,M(c.value,k))),!Object.keys(n.value).length};return e.onMounted(()=>{rxjs.forkJoin([O.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(k=>{l.value=k[0],C.id?F():O.literacy("getEmptyApplication").subscribe(s=>{a.value=Object.assign({Field:null,FormStep:1,Status:1},s),N.value=[{Role:"申請人"}],q().init("literacy",a.value)})})}),e.provide("editable",V),e.watch(()=>[a.value.Field,a.value.OrgName],()=>{var k;if(V.value){const s=[];a.value.Field&&s.push((k=l.value.find(m=>m.Code===a.value.Field))==null?void 0:k.Descname),a.value.OrgName&&s.push(a.value.OrgName),a.value.ProjectName=s.join("-")}}),(k,s)=>{const m=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),d=e.resolveComponent("input-textarea"),f=e.resolveComponent("input-boolean"),U=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Sd,[s[40]||(s[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Dd,[e.createElementVNode("table",Ud,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[14]||(s[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[s[15]||(s[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",Md,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Od,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[s[16]||(s[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[17]||(s[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{disabled:"",modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":s[0]||(s[0]=h=>e.unref(a).ProjectName=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[18]||(s[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(n).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).Field,"onUpdate:modelValue":s[1]||(s[1]=h=>e.unref(a).Field=h)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[19]||(s[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":s[2]||(s[2]=h=>e.unref(a).OrgName=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[20]||(s[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).OrgLeader,modelValue:e.unref(a).OrgLeader,"onUpdate:modelValue":s[3]||(s[3]=h=>e.unref(a).OrgLeader=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[21]||(s[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":s[4]||(s[4]=h=>e.unref(a).Address=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),s[41]||(s[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",jd,[e.createElementVNode("table",Id,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(h,S)=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Pd,[e.createElementVNode("div",qd,[e.createElementVNode("div",Rd,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[22]||(s[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(n)[`contact-${S}-Name`],modelValue:h.Name,"onUpdate:modelValue":D=>h.Name=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ld,[e.createElementVNode("div",zd,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[23]||(s[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(n)[`contact-${S}-JobTitle`],modelValue:h.JobTitle,"onUpdate:modelValue":D=>h.JobTitle=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Jd,[s[24]||(s[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Gd,[e.createElementVNode("div",Qd,[e.createVNode(i,{modelValue:h.Phone,"onUpdate:modelValue":D=>h.Phone=D,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Wd,[e.createVNode(i,{placeholder:"請輸入分機",size:"4",modelValue:h.PhoneExt,"onUpdate:modelValue":D=>h.PhoneExt=D,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Yd,[e.createElementVNode("div",Hd,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[25]||(s[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(n)[`contact-${S}-MobilePhone`],modelValue:h.MobilePhone,"onUpdate:modelValue":D=>h.MobilePhone=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Zd,[e.createElementVNode("div",Kd,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[26]||(s[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(n)[`contact-${S}-EMail`],modelValue:h.EMail,"onUpdate:modelValue":D=>h.EMail=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),s[42]||(s[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Xd,[e.createElementVNode("table",vd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[27]||(s[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[s[28]||(s[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(d,{error:e.unref(n).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(a).Target,"onUpdate:modelValue":s[5]||(s[5]=h=>e.unref(a).Target=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[29]||(s[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(n).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":s[6]||(s[6]=h=>e.unref(a).Summary=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[30]||(s[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(n).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":s[7]||(s[7]=h=>e.unref(a).Quantified=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[31]||(s[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(n).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Qualitative,"onUpdate:modelValue":s[8]||(s[8]=h=>e.unref(a).Qualitative=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",es,[e.createElementVNode("table",ts,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[36]||(s[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(f,{modelValue:e.unref(E),"onUpdate:modelValue":s[9]||(s[9]=h=>e.isRef(E)?E.value=h:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",ls,[e.createElementVNode("table",os,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[s[32]||(s[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),s[33]||(s[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",ns,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(h,S)=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(n)[`study-${S}-Title`],modelValue:h.Title,"onUpdate:modelValue":D=>h.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(n)[`study-${S}-TheDate`],modelValue:h.TheDate,"onUpdate:modelValue":D=>h.TheDate=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",rs,[e.createElementVNode("div",as,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>p(h),type:"button"},[...s[34]||(s[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ds)):e.createCommentVNode("",!0),S+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...s[35]||(s[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[s[39]||(s[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ss,[e.createElementVNode("table",ms,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[37]||(s[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(n).Form1Before,rows:"4",modelValue:e.unref(c).Form1Before,"onUpdate:modelValue":s[10]||(s[10]=h=>e.unref(c).Form1Before=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...s[38]||(s[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(n).Form1After,rows:"4",modelValue:e.unref(c).Form1After,"onUpdate:modelValue":s[11]||(s[11]=h=>e.unref(c).Form1After=h),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",is,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:s[12]||(s[12]=h=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:s[13]||(s[13]=h=>r(!0)),type:"button"},[...s[43]||(s[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Vs={class:"block"},ps={key:0,class:"text-pink lh-base mt-4"},fs={class:"mt-4"},Ns={class:"table align-middle gray-table"},us={class:"text-center"},Es={key:0,width:"180"},bs={class:"text-center"},gs={key:0},ks=["innerHTML"],ys={key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",type:"button"},xs={key:0,class:"text-center"},Bs={key:0},hs={key:1,class:"text-pink"},$s={key:1,class:"tag-group mt-2 gap-1"},Cs={key:0,class:"tag tag-green-light"},Ts=["download","href"],_s=["onClick"],ws={class:"mt-4"},As={class:"table align-middle gray-table side-table"},Fs={key:0,class:"block-bottom bg-light-teal"},Ss=["disabled"],Ds={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([{Type:1,Title:"申請表",Template:!0,Files:[]},{Type:2,Title:"計畫書",Template:!0,Files:[]},{Type:3,Title:"執行承諾書",Template:!0,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:!0,Files:[]},{Type:5,Title:"著作權授權同意書",Template:!0,Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),c=e.ref(),V=e.computed(()=>N.value.some(p=>!p.Optional&&!p.Files.filter(r=>!r.Deleted).length)),n=e.computed(()=>z("literacy",o.value.Status,2)),l=e.ref({}),o=e.ref({}),a=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:o.value.ProjectID+"_"+(p.Multiple?r.Name:`${p.Title}.pdf`)})},u=O.download,E=_,y=()=>{rxjs.forkJoin([O.literacy("getAttachment",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=N.value.filter(g=>{var k;return!((k=g.Excludes)!=null&&k.includes(o.value.OrgCategory))}),N.value.forEach(g=>{g.Files=r.Attachments.filter(k=>k.Type===g.Type),g.Uploaded=e.computed(()=>g.Files.filter(k=>!k.Deleted).length)}),q().init("literacy",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},w=p=>{var g,k;if(l.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:C.id,Attachments:N.value.reduce((s,m)=>s.concat(m.Files),[]),Before:(g=c.value)==null?void 0:g.Form5Before,After:(k=c.value)==null?void 0:k.Form5After,Submit:p?"true":"false"};O.literacy("saveAttachment",r).subscribe(()=>{p?E("next"):y()})},F=()=>{if(c.value){const p={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,M(c.value,p))}return!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",n),(p,r)=>{const g=e.resolveComponent("required-label"),k=e.resolveComponent("input-file"),s=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Vs,[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",ps,[...r[4]||(r[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",fs,[e.createElementVNode("table",Ns,[e.createElementVNode("thead",us,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Es,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",bs,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",gs,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(g,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,ks)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("button",ys,[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])])):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",xs,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",Bs,"已上傳")):(e.openBlock(),e.createElementBlock("span",hs,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(k,{key:0,accept:".pdf",onFile:t=>a(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",$s,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Cs,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(u)(t.Path)},e.toDisplayString(t.Name),9,Ts),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:d=>t.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,_s)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[r[12]||(r[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ws,[e.createElementVNode("table",As,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(c).Form5Before,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(c).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(c).Form5After,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Fs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[2]||(r[2]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[3]||(r[3]=m=>w(!0)),disabled:e.unref(V),type:"button"},[...r[14]||(r[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Ss)])):e.createCommentVNode("",!0)],64)}}},Us={class:"block"},Ms={class:"mt-4"},Os={class:"table-responsive mt-3 mb-0"},js={class:"table align-middle gray-table"},Is={key:0,width:"1"},Ps={key:0},qs={class:"d-flex gap-2"},Rs=["onClick"],Ls={class:"table-responsive mt-3 mb-0"},zs={class:"table align-middle gray-table"},Js={class:"mt-4"},Gs={class:"table align-middle gray-table side-table"},Qs={key:0,class:"block-bottom bg-light-teal"},Ws={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.computed(()=>z("literacy",o.value.Status,4)),n=e.ref({}),l=e.computed(()=>N.value.filter(p=>!p.Deleted)),o=e.ref({}),a=()=>N.value.push({}),u=_,E=()=>{rxjs.forkJoin([O.literacy("getBenefit",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=r.Benefits,N.value.length||a(),q().init("literacy",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},y=p=>p.Deleted=!0,w=p=>{var g,k;if(n.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:o.value,Benefits:N.value,Before:(g=c.value)==null?void 0:g.Form4Before,After:(k=c.value)==null?void 0:k.Form4After,Submit:p?"true":"false"};O.literacy("saveBenefit",r).subscribe(()=>{p?u("next"):E()})},F=()=>{let p={Benefit:"不可量化成果"};return n.value=M(o.value,p),p={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((r,g)=>Object.assign(n.value,M(r,p,`item-${g}-`))),c.value&&(p={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,M(c.value,p))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",V),(p,r)=>{const g=e.resolveComponent("input-text"),k=e.resolveComponent("input-textarea"),s=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Us,[r[14]||(r[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",Ms,[e.createElementVNode("div",Os,[e.createElementVNode("table",js,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"目標值",-1)),r[7]||(r[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Is,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${i}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Ps,[e.createElementVNode("div",qs,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>y(m),type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Rs)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Ls,[e.createElementVNode("table",zs,[r[10]||(r[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(o).Benefit,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(o).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Js,[e.createElementVNode("table",Gs,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[12]||(r[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":r[2]||(r[2]=m=>e.unref(c).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Qs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[3]||(r[3]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[4]||(r[4]=m=>w(!0)),type:"button"},[...r[15]||(r[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ys={class:"block"},Hs={class:"mt-4"},Zs={class:"table-responsive mt-3 mb-0"},Ks={class:"table align-middle gray-table"},Xs={class:"text-end"},vs={class:"text-end"},em={class:"table-responsive"},tm={class:"table align-middle gray-table"},lm=["colspan"],om={key:0,width:"1"},nm={class:"text-end"},rm={key:0},am={class:"d-flex gap-2"},dm=["onClick"],sm={class:"mt-4"},mm={class:"table-responsive mt-3 mb-0"},im={class:"table align-middle gray-table"},cm={key:0,width:"1"},Vm={class:"text-end"},pm={key:0},fm={class:"d-flex gap-2"},Nm=["onClick"],um={class:"mt-4"},Em={class:"table align-middle gray-table side-table"},bm={key:0,class:"block-bottom bg-light-teal"},gm={class:"text-center"},km={class:"mb-5"},ym={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("literacy",o.value.Status,3)),V=e.ref({}),n=e.computed(()=>u.value.filter(i=>!i.Deleted)),l=e.computed(()=>E.value.filter(i=>!i.Deleted)),o=e.ref({}),a=e.ref(),u=e.ref([]),E=e.ref([]),y=e.ref({}),w=e.ref(0),F=()=>u.value.push({}),p=()=>E.value.push({}),r=_,g=()=>{rxjs.forkJoin([O.literacy("getFunding",{ID:C.id})]).subscribe(i=>{const t=i[0];o.value=t.Project,u.value=t.OtherSubsidies,E.value=t.BudgetPlans,y.value=t.GrantTargetSetting,u.value.length||F(),E.value.length||p(),q().init("literacy",o.value),N.value=o.value.changeApply,o.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=(i,t)=>{var f,U;if(V.value={},i&&!m()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&o.value.ApplyAmount>y.value.GrantLimit*1e4){a.value.show(()=>s(i,!0));return}const d={Project:o.value,OtherSubsidies:u.value,BudgetPlans:E.value,Before:(f=N.value)==null?void 0:f.Form3Before,After:(U=N.value)==null?void 0:U.Form3After,Submit:i?"true":"false"};O.literacy("saveFunding",d).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(o.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},u.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`other-${d}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`plan-${d}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(N.value,i))),!Object.keys(V.value).length};return e.onMounted(g),e.provide("editable",c),e.watchEffect(()=>{o.value.OtherAmount=n.value.reduce((i,t)=>i+L(t.Amount),0),w.value=L(o.value.ApplyAmount)+L(o.value.SelfAmount)+L(o.value.OtherAmount),n.value.forEach(i=>i.percent=Math.round(L(i.Amount)/o.value.OtherAmount*1e4)/100),E.value.forEach(i=>i.sum=L(i.Amount)+L(i.OtherAmount))}),(i,t)=>{var D;const d=e.resolveComponent("input-integer"),f=e.resolveComponent("input-text"),U=e.resolveComponent("input-textarea"),h=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ys,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Hs,[e.createElementVNode("div",Zs,[e.createElementVNode("table",Ks,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).ApplyAmount,modelValue:e.unref(o).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(o).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).SelfAmount,modelValue:e.unref(o).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(o).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",Xs,e.toDisplayString((D=e.unref(o).OtherAmount)==null?void 0:D.toLocaleString()),1),e.createElementVNode("td",vs,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",em,[e.createElementVNode("table",tm,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(c)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,lm)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",om,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(b+1),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`other-${b}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":x=>A.Unit=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`other-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",nm,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`other-${b}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":x=>A.Content=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",rm,[e.createElementVNode("div",am,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,dm)):e.createCommentVNode("",!0),b+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",sm,[e.createElementVNode("div",mm,[e.createElementVNode("table",im,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",cm,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`plan-${b}-Title`],modelValue:A.Title,"onUpdate:modelValue":x=>A.Title=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":x=>A.OtherAmount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Vm,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`plan-${b}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":x=>A.Description=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",pm,[e.createElementVNode("div",fm,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Nm)):e.createCommentVNode("",!0),b+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",um,[e.createElementVNode("table",Em,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(N).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(N).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",bm,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>s(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",gm,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",km,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(y).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},xm={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(C,N)=>{const c=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(c,{steps:_,type:"literacy"})}}},Bm={class:"block"},hm={class:"mt-4"},$m={class:"table align-middle gray-table side-table"},Cm={key:0,class:"d-flex align-items-center gap-2"},Tm={class:"input-group w-auto"},_m={class:"text-teal-dark"},wm={key:1,class:"invalid mt-0"},Am={class:"table-responsive mt-4"},Fm={class:"table align-middle gray-table"},Sm={key:0},Dm={class:"input-group"},Um={key:0,class:"invalid mt-0"},Mm={key:0},Om={class:"d-flex gap-2"},jm=["onClick"],Im={class:"mt-4"},Pm={class:"table align-middle gray-table"},qm={key:0},Rm={key:0},Lm={class:"d-flex gap-2"},zm=["onClick"],Jm={class:"mt-4"},Gm={class:"table align-middle gray-table side-table"},Qm={key:0,class:"block-bottom bg-light-teal"},Wm={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=[{value:1,text:"50%"},{value:2,text:"100%"}],c=e.ref(),V=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("literacy",u.value.Status,2)),l=e.ref({}),o=e.computed(()=>y.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),u=e.ref({}),E=e.ref({}),y=e.ref([]),w=e.ref([]),F=()=>O.literacy("createItem",{ID:C.id}).subscribe(i=>y.value.push(i)),p=()=>w.value.push({Type:0,ItemID:0}),r=_,g=()=>{rxjs.forkJoin([O.literacy("getWorkSchedule",{ID:C.id})]).subscribe(i=>{const t=i[0];u.value=t.Project,E.value=t.GrantType,y.value=t.Items,w.value=t.Schedules,y.value.length||F(),w.value.length||p(),q().init("literacy",u.value),c.value=u.value.changeApply,u.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=i=>{var d,f;if(l.value={},i&&!m()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:u.value,Items:y.value,Schedules:w.value,Before:(d=c.value)==null?void 0:d.Form2Before,After:(f=c.value)==null?void 0:f.Form2After,Submit:i?"true":"false"};O.literacy("saveWorkSchedule",t).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=M(u.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},o.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`item-${d}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`schedule-${d}-`))),c.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,M(c.value,i))),!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",n),(i,t)=>{const d=e.resolveComponent("required-label"),f=e.resolveComponent("input-tw-date"),U=e.resolveComponent("tw-date"),h=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),D=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Bm,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",hm,[e.createElementVNode("table",$m,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Cm,[e.createElementVNode("div",Tm,[e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).StartTime,"onUpdate:modelValue":t[0]||(t[0]=b=>e.unref(u).StartTime=b)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).EndTime,"onUpdate:modelValue":t[1]||(t[1]=b=>e.unref(u).EndTime=b)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",_m,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(U,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",wm,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Am,[e.createElementVNode("table",Fm,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Sm,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+x)),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(l)[`item-${x}-Title`],modelValue:b.Title,"onUpdate:modelValue":T=>b.Title=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Dm,[e.createVNode(S,{"empty-value":0,modelValue:b.Begin,"onUpdate:modelValue":T=>b.Begin=T},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:b.End,"onUpdate:modelValue":T=>b.End=T},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]?(e.openBlock(),e.createElementBlock("div",Um,e.toDisplayString(e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`item-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Mm,[e.createElementVNode("div",Om,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,jm)):e.createCommentVNode("",!0),x+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Im,[e.createElementVNode("table",Pm,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",qm,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-Type`],options:N,modelValue:b.Type,"onUpdate:modelValue":T=>b.Type=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-ItemID`],options:e.unref(o),"text-name":"Title","value-name":"ID",modelValue:b.ItemID,"onUpdate:modelValue":T=>b.ItemID=T,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(b.ItemID?String.fromCharCode(65+e.unref(o).findIndex(T=>T.ID===b.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`schedule-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`schedule-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Rm,[e.createElementVNode("div",Lm,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,zm)):e.createCommentVNode("",!0),x+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Jm,[e.createElementVNode("table",Gm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=b=>e.unref(c).Form2Before=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":t[3]||(t[3]=b=>e.unref(c).Form2After=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Qm,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=b=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=b=>s(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ym={class:"block"},Hm={class:"mt-4"},Zm={class:"table align-middle gray-table side-table"},Km={key:0},Xm={key:1,class:"text-light-gray"},vm={class:"mt-4"},ei={class:"table align-middle gray-table side-table"},ti={class:"row g-3"},li={class:"col-12 col-xl-2"},oi={class:"text-gray mb-2"},ni={class:"col-12 col-xl-3"},ri={class:"text-gray mb-2"},ai={class:"col-12 col-xl-4"},di={class:"row g-1"},si={class:"col-7"},mi={class:"col-5"},ii={class:"col-12 col-xl-3"},ci={class:"text-gray mb-2"},Vi={class:"col-12"},pi={class:"text-gray mb-2"},fi={class:"mt-4"},Ni={class:"table align-middle gray-table side-table"},ui={class:"mt-4"},Ei={class:"table align-middle gray-table side-table"},bi={key:0,class:"table-responsive mt-3 mb-0"},gi={class:"table align-middle gray-table"},ki={key:0},yi={key:0},xi={class:"d-flex gap-2"},Bi=["onClick"],hi={class:"mt-4"},$i={class:"table align-middle gray-table side-table"},Ci={key:0,class:"block-bottom bg-light-teal"},Ti={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.ref(),n=e.computed(()=>z("multiple",u.value.Status,1)),l=e.ref({}),o=e.ref([]),a=e.computed(()=>E.value.filter(s=>!s.Deleted)),u=e.ref({}),E=e.ref([]),y=e.computed({get:()=>!!a.value.length,set:s=>{s?w():E.value.forEach(m=>m.Deleted=!0)}}),w=()=>E.value.push({}),F=_,p=()=>{O.multiple("getApplication",{ID:C.id}).subscribe(s=>{u.value=s.Project,V.value=s.Contacts,E.value=s.ReceivedSubsidies,u.value.OrgCategory=u.value.OrgCategory||null,q().init("multiple",u.value),c.value=u.value.changeApply,u.value.changeApply=void 0})},r=s=>s.Deleted=!0,g=s=>{var i,t;if(l.value={},s&&!k()){e.nextTick(()=>{var d;return(d=document.querySelector(".invalid"))==null?void 0:d.scrollIntoView({behavior:"smooth",block:"center"})});return}const m={Project:u.value,Contacts:V.value,ReceivedSubsidies:E.value.filter(d=>d.ID||!d.Deleted),Before:(i=c.value)==null?void 0:i.Form1Before,After:(t=c.value)==null?void 0:t.Form1After,Submit:s?"true":"false"};O.multiple("saveApplication",m).subscribe(d=>{s?F("next"):u.value.ID?p():window.location.href=`Application.aspx?ID=${d.ID}`})},k=()=>{let s={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return l.value=M(u.value,s),s={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},V.value.forEach((m,i)=>Object.assign(l.value,M(m,s,`contact-${i}-`))),s={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},E.value.forEach((m,i)=>Object.assign(l.value,M(m,s,`received-${i}-`))),c.value&&(s={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,M(c.value,s))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([O.multiple("getZgsCodes",{CodeGroup:"MULField"}),O.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(s=>{o.value=s[0],N.value=s[1],C.id?p():O.multiple("getEmptyApplication").subscribe(m=>{u.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},m),V.value=[{Role:"負責人"},{Role:"聯絡人"}],q().init("multiple",u.value)})})}),e.provide("editable",n),(s,m)=>{const i=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),d=e.resolveComponent("input-select"),f=e.resolveComponent("input-textarea"),U=e.resolveComponent("input-boolean"),h=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ym,[m[43]||(m[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Hm,[e.createElementVNode("table",Zm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[15]||(m[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(u).Year),1)]),e.createElementVNode("tr",null,[m[16]||(m[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(u).ProjectID?(e.openBlock(),e.createElementBlock("span",Km,e.toDisplayString(e.unref(u).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Xm,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[m[17]||(m[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(u).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[18]||(m[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).ProjectName,modelValue:e.unref(u).ProjectName,"onUpdate:modelValue":m[0]||(m[0]=S=>e.unref(u).ProjectName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[19]||(m[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{"empty-value":null,error:e.unref(l).Field,options:e.unref(o),"text-name":"Descname","value-name":"Code",modelValue:e.unref(u).Field,"onUpdate:modelValue":m[1]||(m[1]=S=>e.unref(u).Field=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[20]||(m[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(u).OrgName,"onUpdate:modelValue":m[2]||(m[2]=S=>e.unref(u).OrgName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[21]||(m[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(u).OrgCategory,"onUpdate:modelValue":m[3]||(m[3]=S=>e.unref(u).OrgCategory=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[22]||(m[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(u).TaxID,"onUpdate:modelValue":m[4]||(m[4]=S=>e.unref(u).TaxID=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[23]||(m[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(u).Address,"onUpdate:modelValue":m[5]||(m[5]=S=>e.unref(u).Address=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),m[44]||(m[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",vm,[e.createElementVNode("table",ei,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),(S,D)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",ti,[e.createElementVNode("div",li,[e.createElementVNode("div",oi,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[24]||(m[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${D}-Name`],modelValue:S.Name,"onUpdate:modelValue":A=>S.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ni,[e.createElementVNode("div",ri,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[25]||(m[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${D}-JobTitle`],modelValue:S.JobTitle,"onUpdate:modelValue":A=>S.JobTitle=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ai,[m[26]||(m[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",di,[e.createElementVNode("div",si,[e.createVNode(t,{modelValue:S.Phone,"onUpdate:modelValue":A=>S.Phone=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",mi,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:S.PhoneExt,"onUpdate:modelValue":A=>S.PhoneExt=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",ii,[e.createElementVNode("div",ci,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[27]||(m[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${D}-MobilePhone`],modelValue:S.MobilePhone,"onUpdate:modelValue":A=>S.MobilePhone=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Vi,[e.createElementVNode("div",pi,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[28]||(m[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${D}-EMail`],modelValue:S.EMail,"onUpdate:modelValue":A=>S.EMail=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),m[45]||(m[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",fi,[e.createElementVNode("table",Ni,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[29]||(m[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[m[30]||(m[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(f,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(u).Target,"onUpdate:modelValue":m[6]||(m[6]=S=>e.unref(u).Target=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[31]||(m[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(u).Summary,"onUpdate:modelValue":m[7]||(m[7]=S=>e.unref(u).Summary=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[32]||(m[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(u).Quantified,"onUpdate:modelValue":m[8]||(m[8]=S=>e.unref(u).Quantified=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[33]||(m[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(u).Qualitative,"onUpdate:modelValue":m[9]||(m[9]=S=>e.unref(u).Qualitative=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",ui,[e.createElementVNode("table",Ei,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[39]||(m[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(U,{modelValue:e.unref(y),"onUpdate:modelValue":m[10]||(m[10]=S=>e.isRef(y)?y.value=S:null)},null,8,["modelValue"]),e.unref(y)?(e.openBlock(),e.createElementBlock("div",bi,[e.createElementVNode("table",gi,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[m[34]||(m[34]=e.createElementVNode("th",null,"計畫名稱",-1)),m[35]||(m[35]=e.createElementVNode("th",null,"補助單位",-1)),m[36]||(m[36]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",ki,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(S,D)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l)[`received-${D}-Name`],modelValue:S.Name,"onUpdate:modelValue":A=>S.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l)[`received-${D}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":A=>S.Unit=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(l)[`received-${D}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":A=>S.Amount=A},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",yi,[e.createElementVNode("div",xi,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:A=>r(S),type:"button"},[...m[37]||(m[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Bi)):e.createCommentVNode("",!0),D+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:w,type:"button"},[...m[38]||(m[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[m[42]||(m[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",hi,[e.createElementVNode("table",$i,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[40]||(m[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(c).Form1Before,"onUpdate:modelValue":m[11]||(m[11]=S=>e.unref(c).Form1Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...m[41]||(m[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(c).Form1After,"onUpdate:modelValue":m[12]||(m[12]=S=>e.unref(c).Form1After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Ci,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:m[13]||(m[13]=S=>g()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:m[14]||(m[14]=S=>g(!0)),type:"button"},[...m[46]||(m[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},_i={class:"block"},wi={key:0,class:"text-pink lh-base mt-4"},Ai={class:"mt-4"},Fi={class:"table align-middle gray-table"},Si={class:"text-center"},Di={key:0,width:"180"},Ui={class:"text-center"},Mi={key:0},Oi=["innerHTML"],ji={key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",type:"button"},Ii={key:0,class:"text-center"},Pi={key:0},qi={key:1,class:"text-pink"},Ri={key:1,class:"tag-group mt-2 gap-1"},Li={key:0,class:"tag tag-green-light"},zi=["download","href"],Ji=["onClick"],Gi={class:"mt-4"},Qi={class:"table align-middle gray-table side-table"},Wi={key:0,class:"block-bottom bg-light-teal"},Yi=["disabled"],Hi={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([{Type:1,Title:"申請表",Template:!0,Files:[]},{Type:2,Title:"計畫書",Template:!0,Files:[]},{Type:3,Title:"執行承諾書",Template:!0,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:!0,Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),c=e.ref(),V=e.computed(()=>N.value.some(p=>!p.Optional&&!p.Files.filter(r=>!r.Deleted).length)),n=e.computed(()=>z("multiple",o.value.Status,2)),l=e.ref({}),o=e.ref({}),a=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:o.value.ProjectID+"_"+(p.Multiple?r.Name:`${p.Title}.pdf`)})},u=O.download,E=_,y=()=>{rxjs.forkJoin([O.multiple("getAttachment",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=N.value.filter(g=>{var k;return!((k=g.Excludes)!=null&&k.includes(o.value.OrgCategory))}),o.value.Status>=10&&N.value.push({Type:6,Title:"著作權授權同意書",Template:!0,Files:[]}),N.value.forEach(g=>{g.Files=r.Attachments.filter(k=>k.Type===g.Type),g.Uploaded=e.computed(()=>g.Files.filter(k=>!k.Deleted).length)}),q().init("multiple",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},w=p=>{var g,k;if(l.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:C.id,Attachments:N.value.reduce((s,m)=>s.concat(m.Files),[]),Before:(g=c.value)==null?void 0:g.Form5Before,After:(k=c.value)==null?void 0:k.Form5After,Submit:p?"true":"false"};O.multiple("saveAttachment",r).subscribe(()=>{p?E("next"):y()})},F=()=>{if(c.value){const p={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,M(c.value,p))}return!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",n),(p,r)=>{const g=e.resolveComponent("required-label"),k=e.resolveComponent("input-file"),s=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_i,[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("p",wi,[...r[4]||(r[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ai,[e.createElementVNode("table",Fi,[e.createElementVNode("thead",Si,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Di,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",Ui,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[m.Optional?(e.openBlock(),e.createElementBlock("span",Mi,e.toDisplayString(m.Title),1)):(e.openBlock(),e.createBlock(g,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.Title),1)]),_:2},1024))]),e.unref(n)&&m.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:m.Comment},null,8,Oi)):e.createCommentVNode("",!0),e.unref(n)&&m.Template?(e.openBlock(),e.createElementBlock("button",ji,[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])])):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Ii,[m.Uploaded?(e.openBlock(),e.createElementBlock("span",Pi,"已上傳")):(e.openBlock(),e.createElementBlock("span",qi,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(n)&&(m.Multiple||!m.Uploaded)?(e.openBlock(),e.createBlock(k,{key:0,accept:".pdf",onFile:t=>a(m,t)},null,8,["onFile"])):e.createCommentVNode("",!0),m.Uploaded?(e.openBlock(),e.createElementBlock("div",Ri,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Li,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(u)(t.Path)},e.toDisplayString(t.Name),9,zi),e.unref(n)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:d=>t.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Ji)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[r[12]||(r[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Gi,[e.createElementVNode("table",Qi,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(c).Form5Before,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(c).Form5Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(g,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(c).Form5After,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form5After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Wi,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[2]||(r[2]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[3]||(r[3]=m=>w(!0)),disabled:e.unref(V),type:"button"},[...r[14]||(r[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Yi)])):e.createCommentVNode("",!0)],64)}}},Zi={class:"block"},Ki={class:"mt-4"},Xi={class:"table-responsive mt-3 mb-0"},vi={class:"table align-middle gray-table"},ec={key:0,width:"1"},tc={key:0},lc={class:"d-flex gap-2"},oc=["onClick"],nc={class:"table-responsive mt-3 mb-0"},rc={class:"table align-middle gray-table"},ac={class:"mt-4"},dc={class:"table align-middle gray-table side-table"},sc={key:0,class:"block-bottom bg-light-teal"},mc={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref([]),c=e.ref(),V=e.computed(()=>z("multiple",o.value.Status,4)),n=e.ref({}),l=e.computed(()=>N.value.filter(p=>!p.Deleted)),o=e.ref({}),a=()=>N.value.push({}),u=_,E=()=>{rxjs.forkJoin([O.multiple("getBenefit",{ID:C.id})]).subscribe(p=>{const r=p[0];o.value=r.Project,N.value=r.Benefits,N.value.length||a(),q().init("multiple",o.value),c.value=o.value.changeApply,o.value.changeApply=void 0})},y=p=>p.Deleted=!0,w=p=>{var g,k;if(n.value={},p&&!F()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:o.value,Benefits:N.value,Before:(g=c.value)==null?void 0:g.Form4Before,After:(k=c.value)==null?void 0:k.Form4After,Submit:p?"true":"false"};O.multiple("saveBenefit",r).subscribe(()=>{p?u("next"):E()})},F=()=>{let p={Benefit:"不可量化成果"};return n.value=M(o.value,p),p={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((r,g)=>Object.assign(n.value,M(r,p,`item-${g}-`))),c.value&&(p={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(n.value,M(c.value,p))),!Object.keys(n.value).length};return e.onMounted(E),e.provide("editable",V),(p,r)=>{const g=e.resolveComponent("input-text"),k=e.resolveComponent("input-textarea"),s=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zi,[r[14]||(r[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",Ki,[e.createElementVNode("div",Xi,[e.createElementVNode("table",vi,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"目標值",-1)),r[7]||(r[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",ec,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(m,i)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Title`],modelValue:m.Title,"onUpdate:modelValue":t=>m.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(g,{error:e.unref(n)[`item-${i}-Target`],modelValue:m.Target,"onUpdate:modelValue":t=>m.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n)[`item-${i}-Description`],rows:"1",modelValue:m.Description,"onUpdate:modelValue":t=>m.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",tc,[e.createElementVNode("div",lc,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>y(m),type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,oc)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",nc,[e.createElementVNode("table",rc,[r[10]||(r[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Benefit,rows:"4",modelValue:e.unref(o).Benefit,"onUpdate:modelValue":r[0]||(r[0]=m=>e.unref(o).Benefit=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[13]||(r[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ac,[e.createElementVNode("table",dc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[11]||(r[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":r[1]||(r[1]=m=>e.unref(c).Form4Before=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...r[12]||(r[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(n).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":r[2]||(r[2]=m=>e.unref(c).Form4After=m),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",sc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[3]||(r[3]=m=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[4]||(r[4]=m=>w(!0)),type:"button"},[...r[15]||(r[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},ic={class:"block"},cc={class:"mt-4"},Vc={class:"table-responsive mt-3 mb-0"},pc={class:"table align-middle gray-table"},fc={class:"text-end"},Nc={class:"text-end"},uc={class:"table-responsive"},Ec={class:"table align-middle gray-table"},bc=["colspan"],gc={key:0,width:"1"},kc={class:"text-end"},yc={key:0},xc={class:"d-flex gap-2"},Bc=["onClick"],hc={class:"mt-4"},$c={class:"table-responsive mt-3 mb-0"},Cc={class:"table align-middle gray-table"},Tc={key:0,width:"1"},_c={class:"text-end"},wc={key:0},Ac={class:"d-flex gap-2"},Fc=["onClick"],Sc={class:"mt-4"},Dc={class:"table align-middle gray-table side-table"},Uc={key:0,class:"block-bottom bg-light-teal"},Mc={class:"text-center"},Oc={class:"mb-5"},jc={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=e.ref(),c=e.computed(()=>z("multiple",o.value.Status,3)),V=e.ref({}),n=e.computed(()=>u.value.filter(i=>!i.Deleted)),l=e.computed(()=>E.value.filter(i=>!i.Deleted)),o=e.ref({}),a=e.ref(),u=e.ref([]),E=e.ref([]),y=e.ref({}),w=e.ref(0),F=()=>u.value.push({}),p=()=>E.value.push({}),r=_,g=()=>{rxjs.forkJoin([O.multiple("getFunding",{ID:C.id})]).subscribe(i=>{const t=i[0];o.value=t.Project,u.value=t.OtherSubsidies,E.value=t.BudgetPlans,y.value=t.GrantTargetSetting,u.value.length||F(),E.value.length||p(),q().init("multiple",o.value),N.value=o.value.changeApply,o.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=(i,t)=>{var f,U;if(V.value={},i&&!m()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&o.value.ApplyAmount>y.value.GrantLimit*1e4){a.value.show(()=>s(i,!0));return}const d={Project:o.value,OtherSubsidies:u.value,BudgetPlans:E.value,Before:(f=N.value)==null?void 0:f.Form3Before,After:(U=N.value)==null?void 0:U.Form3After,Submit:i?"true":"false"};O.multiple("saveFunding",d).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return V.value=M(o.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},u.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`other-${d}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,d)=>Object.assign(V.value,M(t,i,`plan-${d}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(V.value,M(N.value,i))),!Object.keys(V.value).length};return e.onMounted(g),e.provide("editable",c),e.watchEffect(()=>{o.value.OtherAmount=n.value.reduce((i,t)=>i+L(t.Amount),0),w.value=L(o.value.ApplyAmount)+L(o.value.SelfAmount)+L(o.value.OtherAmount),n.value.forEach(i=>i.percent=Math.round(L(i.Amount)/o.value.OtherAmount*1e4)/100),E.value.forEach(i=>i.sum=L(i.Amount)+L(i.OtherAmount))}),(i,t)=>{var D;const d=e.resolveComponent("input-integer"),f=e.resolveComponent("input-text"),U=e.resolveComponent("input-textarea"),h=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ic,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",cc,[e.createElementVNode("div",Vc,[e.createElementVNode("table",pc,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).ApplyAmount,modelValue:e.unref(o).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(o).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V).SelfAmount,modelValue:e.unref(o).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(o).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",fc,e.toDisplayString((D=e.unref(o).OtherAmount)==null?void 0:D.toLocaleString()),1),e.createElementVNode("td",Nc,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",uc,[e.createElementVNode("table",Ec,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(c)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,bc)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",gc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(b+1),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`other-${b}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":x=>A.Unit=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`other-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",kc,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`other-${b}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":x=>A.Content=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",yc,[e.createElementVNode("div",xc,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Bc)):e.createCommentVNode("",!0),b+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",hc,[e.createElementVNode("div",$c,[e.createElementVNode("table",Cc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(c)?(e.openBlock(),e.createElementBlock("th",Tc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,b)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(V)[`plan-${b}-Title`],modelValue:A.Title,"onUpdate:modelValue":x=>A.Title=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":x=>A.Amount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(V)[`plan-${b}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":x=>A.OtherAmount=x},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",_c,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V)[`plan-${b}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":x=>A.Description=x,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(c)?(e.openBlock(),e.createElementBlock("td",wc,[e.createElementVNode("div",Ac,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:x=>k(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Fc)):e.createCommentVNode("",!0),b+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Sc,[e.createElementVNode("table",Dc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(N).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(V).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(N).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(c)?(e.openBlock(),e.createElementBlock("div",Uc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>s(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",Mc,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Oc,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(y).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Ic={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(C,N)=>{const c=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(c,{steps:_,type:"multiple"})}}},Pc={class:"block"},qc={class:"mt-4"},Rc={class:"table align-middle gray-table side-table"},Lc={key:0,class:"d-flex align-items-center gap-2"},zc={class:"input-group w-auto"},Jc={class:"text-teal-dark"},Gc={key:1,class:"invalid mt-0"},Qc={class:"table-responsive mt-4"},Wc={class:"table align-middle gray-table"},Yc={key:0},Hc={class:"input-group"},Zc={key:0,class:"invalid mt-0"},Kc={key:0},Xc={class:"d-flex gap-2"},vc=["onClick"],eV={class:"mt-4"},tV={class:"table align-middle gray-table"},lV={key:0},oV={key:0},nV={class:"d-flex gap-2"},rV=["onClick"],aV={class:"mt-4"},dV={class:"table align-middle gray-table side-table"},sV={key:0,class:"block-bottom bg-light-teal"},mV={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const C=B,N=[{value:1,text:"50%"},{value:2,text:"100%"}],c=e.ref(),V=e.computed(()=>E.value.EndDate),n=e.computed(()=>z("multiple",u.value.Status,2)),l=e.ref({}),o=e.computed(()=>y.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),u=e.ref({}),E=e.ref({}),y=e.ref([]),w=e.ref([]),F=()=>O.multiple("createItem",{ID:C.id}).subscribe(i=>y.value.push(i)),p=()=>w.value.push({Type:0,ItemID:0}),r=_,g=()=>{rxjs.forkJoin([O.multiple("getWorkSchedule",{ID:C.id})]).subscribe(i=>{const t=i[0];u.value=t.Project,E.value=t.GrantType,y.value=t.Items,w.value=t.Schedules,y.value.length||F(),w.value.length||p(),q().init("multiple",u.value),c.value=u.value.changeApply,u.value.changeApply=void 0})},k=i=>i.Deleted=!0,s=i=>{var d,f;if(l.value={},i&&!m()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:u.value,Items:y.value,Schedules:w.value,Before:(d=c.value)==null?void 0:d.Form2Before,After:(f=c.value)==null?void 0:f.Form2After,Submit:i?"true":"false"};O.multiple("saveWorkSchedule",t).subscribe(()=>{i?r("next"):g()})},m=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=M(u.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},o.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`item-${d}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,d)=>Object.assign(l.value,M(t,i,`schedule-${d}-`))),c.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,M(c.value,i))),!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",n),(i,t)=>{const d=e.resolveComponent("required-label"),f=e.resolveComponent("input-tw-date"),U=e.resolveComponent("tw-date"),h=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),D=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pc,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",qc,[e.createElementVNode("table",Rc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(V)?(e.openBlock(),e.createElementBlock("div",Lc,[e.createElementVNode("div",zc,[e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).StartTime,"onUpdate:modelValue":t[0]||(t[0]=b=>e.unref(u).StartTime=b)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(f,{class:"w-auto","max-date":e.unref(V),modelValue:e.unref(u).EndTime,"onUpdate:modelValue":t[1]||(t[1]=b=>e.unref(u).EndTime=b)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Jc,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(U,{value:e.unref(V)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",Gc,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Qc,[e.createElementVNode("table",Wc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",Yc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+x)),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(l)[`item-${x}-Title`],modelValue:b.Title,"onUpdate:modelValue":T=>b.Title=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Hc,[e.createVNode(S,{"empty-value":0,modelValue:b.Begin,"onUpdate:modelValue":T=>b.Begin=T},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:b.End,"onUpdate:modelValue":T=>b.End=T},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]?(e.openBlock(),e.createElementBlock("div",Zc,e.toDisplayString(e.unref(l)[`item-${x}-Begin`]||e.unref(l)[`item-${x}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`item-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",Kc,[e.createElementVNode("div",Xc,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vc)):e.createCommentVNode("",!0),x+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:F,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",eV,[e.createElementVNode("table",tV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(n)?(e.openBlock(),e.createElementBlock("th",lV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(b,x)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-Type`],options:N,modelValue:b.Type,"onUpdate:modelValue":T=>b.Type=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${x}-ItemID`],options:e.unref(o),"text-name":"Title","value-name":"ID",modelValue:b.ItemID,"onUpdate:modelValue":T=>b.ItemID=T,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(b.ItemID?String.fromCharCode(65+e.unref(o).findIndex(T=>T.ID===b.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l)[`schedule-${x}-Deadline`],modelValue:b.Deadline,"onUpdate:modelValue":T=>b.Deadline=T},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`schedule-${x}-Content`],rows:"1",modelValue:b.Content,"onUpdate:modelValue":T=>b.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(n)?(e.openBlock(),e.createElementBlock("td",oV,[e.createElementVNode("div",nV,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:T=>k(b),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,rV)):e.createCommentVNode("",!0),x+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",aV,[e.createElementVNode("table",dV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=b=>e.unref(c).Form2Before=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":t[3]||(t[3]=b=>e.unref(c).Form2After=b),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",sV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=b=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=b=>s(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},iV={key:0,class:"scroll-bottom-panel"},cV={class:"d-flex flex-column gap-3 mb-3"},VV={class:"d-flex gap-2"},pV={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},fV={class:"text-nowrap my-2 d-flex align-items-center"},NV={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=B,C=q(),N=[{value:1,text:"通過"},{value:2,text:"退回修改"}],c=e.ref({}),V=e.ref({ID:_.id,Result:1}),n=()=>{const o={};if(V.value.Result>1&&(o.Reason="原因"),c.value=M(V.value,o),Object.keys(c.value).length){l();return}O[_.type]("reviewApplicationChange",V.value).subscribe(a=>{})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,o=>{o>1&&l()}),(o,a)=>{const u=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(C)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",iV,[a[3]||(a[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",cV,[e.createElementVNode("li",VV,[a[2]||(a[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",pV,[e.createElementVNode("div",fV,[e.createVNode(u,{options:N,modelValue:e.unref(V).Result,"onUpdate:modelValue":a[0]||(a[0]=y=>e.unref(V).Result=y)},null,8,["modelValue"])]),e.unref(V).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(c).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":a[1]||(a[1]=y=>e.unref(V).Reason=y)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},uV={key:0,class:"scroll-bottom-panel"},EV={class:"d-flex flex-column gap-3 mb-3"},bV={class:"d-flex gap-2"},gV={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},kV={class:"text-nowrap my-2 d-flex align-items-center"},yV={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,C=q(),N=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],c=e.ref({}),V=e.ref({ID:_.id,Result:1}),n=()=>{const o={};if(V.value.Result>1&&(o.Reason="原因"),c.value=M(V.value,o),Object.keys(c.value).length){l();return}O[_.type]("reviewApplication",V.value).subscribe(a=>{})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,o=>{o>1&&l()}),(o,a)=>{const u=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(C)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",uV,[a[3]||(a[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",EV,[e.createElementVNode("li",bV,[a[2]||(a[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",gV,[e.createElementVNode("div",kV,[e.createVNode(u,{options:N,modelValue:e.unref(V).Result,"onUpdate:modelValue":a[0]||(a[0]=y=>e.unref(V).Result=y)},null,8,["modelValue"])]),e.unref(V).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(c).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":a[1]||(a[1]=y=>e.unref(V).Reason=y)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},xV={class:"d-flex align-items-center gap-3"},BV={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},hV={class:"modal-content"},$V={class:"modal-header"},CV={class:"fs-24 fw-bold text-green-light"},TV={class:"modal-body"},_V={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},wV=["disabled"],AV={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,C=e.computed(()=>!V.value||V.value===l[_.type].organizer),N=e.ref(),c=e.computed(()=>l[_.type].organizerName),V=e.ref(0),n=e.computed(()=>{var w;return(w=u.value.find(F=>F.UnitID===a.value))==null?void 0:w.reviewers}),l=q(),o=e.computed(()=>c.value?"移轉案件":"認領案件"),a=e.ref(0),u=e.ref([]),E=()=>{O[_.type]("queryReviewUnits").subscribe(w=>{u.value=w,rxjs.forkJoin(u.value.map(F=>O[_.type]("queryReviewersByUnit",{ID:F.UnitID}))).subscribe(F=>{F.forEach((p,r)=>{u.value[r].reviewers=p,p.some(g=>g.UserID===V.value)&&(a.value=u.value[r].UnitID)}),bootstrap.Modal.getOrCreateInstance(N.value).show()})})},y=()=>{O[_.type]("saveOrganizer",{ID:_.id,Organizer:V.value}).subscribe(w=>{w&&window.location.reload()})};return e.watch(c,()=>V.value=l[_.type].organizer),e.watch(a,()=>{n.value.some(w=>w.UserID===V.value)||(V.value=0)}),(w,F)=>{const p=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",xV,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(c)||"尚無"),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:E,type:"button"},e.toDisplayString(e.unref(o)),1)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:N,tabindex:"-1"},[e.createElementVNode("div",BV,[e.createElementVNode("div",hV,[e.createElementVNode("div",$V,[e.createElementVNode("h4",CV,e.toDisplayString(e.unref(o)),1),F[2]||(F[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",TV,[e.createElementVNode("div",null,[F[3]||(F[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(p,{"empty-value":0,options:e.unref(u),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(a),"onUpdate:modelValue":F[0]||(F[0]=r=>e.isRef(a)?a.value=r:null)},null,8,["options","modelValue"]),e.createVNode(p,{class:"mt-2","empty-value":0,options:e.unref(n),"text-name":"Name","value-name":"UserID",modelValue:e.unref(V),"onUpdate:modelValue":F[1]||(F[1]=r=>e.isRef(V)?V.value=r:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",_V,[F[4]||(F[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:y,disabled:e.unref(C),type:"button"},"確認",8,wV)])])])])],512)]))],64)}}},FV={class:"step-line-wrapper"},SV={__name:"ProjectProgress",props:{id:{type:[Number,String]},step:{required:!0,type:Number}},setup(B){return(_,C)=>(e.openBlock(),e.createElementBlock("div",FV,[...C[0]||(C[0]=[e.createStaticVNode('<div class="step-line"><div class="step-line-item active"><div class="step-line-item-title">核定計畫</div><div class="tag tag-white">審核中</div></div></div><div class="step-line"><div class="step-line-item"><div class="step-line-item-title">每月進度</div><div class="tag"></div></div></div><div class="step-line"><div class="step-line-item"><div class="step-line-item-title">階段報告</div><div class="tag"></div></div><div class="step-line-item"><div class="step-line-item-title">請款核銷</div><div class="tag"></div></div></div>',3)])]))}},DV={key:0,class:"scroll-bottom-panel"},UV={class:"d-flex flex-column gap-3 mb-3"},MV={class:"d-flex gap-2"},OV={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},jV={class:"text-nowrap mb-2 d-flex align-items-center"},IV={key:0,class:"invalid mt-0"},PV={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,C=q(),N=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],c=e.ref({}),V=e.ref({ID:_.id,Result:1}),n=()=>{},l=()=>{},o=()=>{const u={};if(V.value.Result>1&&(u.Reason="原因"),V.value.Result===3&&(u.CorrectionDeadline="補正期限"),c.value=M(V.value,u),Object.keys(c.value).length){a();return}O[_.type]("reviewApplication",V.value).subscribe(E=>{})},a=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>V.value.Result,u=>{u>1&&a()}),(u,E)=>{const y=e.resolveComponent("input-radio-group"),w=e.resolveComponent("input-tw-date"),F=e.resolveComponent("input-textarea");return e.unref(C)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",DV,[E[9]||(E[9]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",UV,[e.createElementVNode("li",{class:"d-flex gap-2"},[E[3]||(E[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:n,href:"javascript:void(0)"},"3")]),e.createElementVNode("li",{class:"d-flex gap-2"},[E[6]||(E[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),E[7]||(E[7]=e.createElementVNode("span",{class:"text-pink"},"中風險",-1)),e.createElementVNode("span",null,[E[4]||(E[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:l,href:"javascript:void(0)"},"1"),E[5]||(E[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",MV,[E[8]||(E[8]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",OV,[e.createElementVNode("div",jV,[e.createVNode(y,{options:N,modelValue:e.unref(V).Result,"onUpdate:modelValue":E[0]||(E[0]=p=>e.unref(V).Result=p)},null,8,["modelValue"]),e.createVNode(w,{class:"form-control",drops:"up",modelValue:e.unref(V).CorrectionDeadline,"onUpdate:modelValue":E[1]||(E[1]=p=>e.unref(V).CorrectionDeadline=p)},null,8,["modelValue"])]),e.unref(c).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",IV,e.toDisplayString(e.unref(c).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(V).Result>1?(e.openBlock(),e.createBlock(F,{key:1,error:e.unref(c).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(V).Reason,"onUpdate:modelValue":E[2]||(E[2]=p=>e.unref(V).Reason=p)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:o,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},qV={class:"top-wrapper"},RV={class:"top-block"},LV={class:"d-flex align-items-center gap-3"},zV={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=B,C=q();return(N,c)=>(e.openBlock(),e.createElementBlock("div",qV,[e.createElementVNode("div",RV,[e.createElementVNode("div",LV,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(C)[_.type].type)+"］"+e.toDisplayString(e.unref(C)[_.type].id)+"/"+e.toDisplayString(e.unref(C)[_.type].name),1)]),c[0]||(c[0]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"}," 查核紀錄 ",-1))])]))}},JV={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},GV={class:"d-flex gap-2"},QV={key:0,class:"btn text-teal-dark",type:"button"},WV={class:"d-flex gap-2"},YV={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},HV={class:"modal-content"},ZV={class:"modal-body"},KV={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},XV={class:"modal-content"},vV={class:"modal-body"},ep={class:"d-flex flex-column gap-4 mb-5"},tp={class:"d-flex align-items-center"},lp={class:"flex-grow-1"},op={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=q(),C=B,N=e.ref({}),c=e.ref(),V=e.ref({}),n=e.ref(),l=e.ref({}),o=e.ref(),a=()=>{const F={Reason:"計畫變更原因"};V.value=M(N.value,F),!Object.keys(V.value).length&&O[C.type]("applyChange",N.value).subscribe(p=>{})},u=()=>{N.value={ID:C.id},bootstrap.Modal.getOrCreateInstance(c.value).show()},E=()=>{bootstrap.Modal.getOrCreateInstance(n.value).show()},y=()=>{l.value={ID:C.id},bootstrap.Modal.getOrCreateInstance(o.value).show()},w=()=>{const F={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};V.value=M(l.value,F),!Object.keys(V.value).length&&O[C.type]("terminate",l.value).subscribe(p=>{})};return(F,p)=>{const r=e.resolveComponent("project-organizer"),g=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",JV,[e.createElementVNode("div",GV,[e.unref(_)[C.type].progress===2?(e.openBlock(),e.createElementBlock("button",QV," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:u,type:"button"}," 計畫變更申請 ")),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:E,type:"button"},[...p[3]||(p[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])]),p[4]||(p[4]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-download"}),e.createTextVNode(" 下載核定計畫書 ")],-1))]),e.createElementVNode("div",WV,[e.createVNode(r,{id:B.id,type:B.type},null,8,["id","type"]),e.createElementVNode("button",{class:"btn btn-pink",onClick:y,type:"button"}," 計畫終止 ")])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:c,tabindex:"-1"},[e.createElementVNode("div",YV,[e.createElementVNode("div",HV,[p[8]||(p[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",ZV,[p[6]||(p[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),p[7]||(p[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(g,{error:e.unref(V).Reason,modelValue:e.unref(N).Reason,"onUpdate:modelValue":p[0]||(p[0]=s=>e.unref(N).Reason=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[p[5]||(p[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:a},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:n,tabindex:"-1"},[...p[9]||(p[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:o,tabindex:"-1"},[e.createElementVNode("div",KV,[e.createElementVNode("div",XV,[p[14]||(p[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",vV,[e.createElementVNode("div",ep,[e.createElementVNode("div",null,[p[10]||(p[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(g,{error:e.unref(V).RejectReason,modelValue:e.unref(l).RejectReason,"onUpdate:modelValue":p[1]||(p[1]=s=>e.unref(l).RejectReason=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),p[12]||(p[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",tp,[p[11]||(p[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",lp,[e.createVNode(k,{error:e.unref(V).RecoveryAmount,modelValue:e.unref(l).RecoveryAmount,"onUpdate:modelValue":p[2]||(p[2]=s=>e.unref(l).RecoveryAmount=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[p[13]||(p[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:w},"送出")])])])])],512)]))],64)}}},np={key:0,class:"text-pink"},ee={AccessibilityApplication:Ke,AccessibilityAttachment:gt,AccessibilityBenefit:Dt,AccessibilityFunding:dl,AccessibilityProgressBar:sl,AccessibilityWorkSchedule:Dl,ConfirmModal:Pl,CommonProgressBar:Ql,CultureApplication:Fo,CultureAttachment:vo,CultureFunding:Tn,CultureOther:zn,CultureProgressBar:Jn,CultureWorkSchedule:jr,EducationApplication:wa,EducationAttachment:Ka,EducationProgressBar:Xa,ErrorModal:nd,InputBoolean:rd,InputFile:ad,InputInteger:md,InputMonth:id,InputRadioGroup:pd,InputSelect:bd,InputText:Bd,InputTextarea:_d,InputTwDate:Fd,LiteracyApplication:cs,LiteracyAttachment:Ds,LiteracyBenefit:Ws,LiteracyFunding:ym,LiteracyProgressBar:xm,LiteracyWorkSchedule:Wm,MultipleApplication:Ti,MultipleAttachment:Hi,MultipleBenefit:mc,MultipleFunding:jc,MultipleProgressBar:Ic,MultipleWorkSchedule:mV,ProjectChangeReview:NV,ProjectCorrectionReview:yV,ProjectOrganizer:AV,ProjectProgress:SV,ProjectReview:PV,ProjectTitle:zV,ProjectToolbar:op,RequiredLabel:{__name:"RequiredLabel",setup(B){const _=e.inject("editable",!0);return(C,N)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(_)?(e.openBlock(),e.createElementBlock("span",np,"* ")):e.createCommentVNode("",!0),e.renderSlot(C.$slots,"default")],64))}},TwDate:{__name:"TwDate",props:{value:{default:null,type:String}},setup(B){const _=B,C=c=>{const V=c==null?void 0:c.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return V?`${parseInt(V[1],10)-1911}/${V[2]}/${V[3]}`:""},N=e.ref(C(_.value));return e.watch(()=>_.value,c=>N.value=C(c)),(c,V)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(N)),1))}}};return{install:B=>{for(const _ in ee)B.component(_,ee[_])},useProgressStore:q}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
