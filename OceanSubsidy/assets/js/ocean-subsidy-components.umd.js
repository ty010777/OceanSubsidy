(function(e,W){typeof exports=="object"&&typeof module<"u"?module.exports=W(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],W):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=W(e.Vue,e.Pinia))})(this,(function(e,W){"use strict";const P=W.defineStore("progress",{actions:{init(x,T){var h,N;this[x]={id:T.ProjectID,type:(h=T.SubsidyPlanType)==null?void 0:h.split(" ")[0],name:T.ProjectName,step:T.FormStep,status:T.Status,progress:T.ProgressStatus,changeStatus:(N=T.changeApply)==null?void 0:N.Status,organizer:T.Organizer,organizerName:T.OrganizerName}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let le=Date.now();const z=(x,T,h)=>{const N=P();if([1,14].includes(N[x].status)||[1,4].includes(N[x].changeStatus))return!0;if(N[x].status===42)switch(x){case"culture":if([2,3,5].includes(h))return!0;break;case"multiple":if([2,3,4,5].includes(h))return!0;break;case"accessibility":if([2,3,4,5].includes(h))return!0;break}return!1},oe=()=>`id--${le++}`,R=x=>parseInt(x)||0,Z=W.defineStore("message",{state:()=>({error:null})}),{ajax:ne}=rxjs.ajax,{map:re}=rxjs;let K="";const ae=(x,T={})=>Q("Service/OFS/Accessibility.ashx",{method:x,param:T}),de=(x,T={})=>Q("Service/OFS/Culture.ashx",{method:x,param:T}),se=x=>`${K}/Service/OFS/Download.ashx?path=${x}`,me=(x,T={})=>Q("Service/OFS/Education.ashx",{method:x,param:T}),ce=(x,T={})=>Q("Service/OFS/Literacy.ashx",{method:x,param:T}),ie=(x,T={})=>Q("Service/OFS/Multiple.ashx",{method:x,param:T}),Ve=({response:x,status:T})=>{if(T===200){if(x.success)return x.data;Z().error=x.message}},Q=(x,T={})=>{const h={};T.constructor!==FormData&&(h["Content-Type"]="application/json");const N={body:T,headers:h,method:"POST",url:`${K}/${x}`};return ne(N).pipe(re(Ve))},M=Object.assign(Q,{accessibility:ae,culture:de,download:se,education:me,literacy:ce,multiple:ie,upload:x=>{const T=new FormData;return T.append("file",x),Q("Service/OFS/Upload.ashx",T)}});function pe(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var Y={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var fe=Y.exports,X;function Ne(){return X||(X=1,(function(x,T){(function(h,N,s){var p=function(l,n,a){a=r.extend({},r.options,a);var E=r.runValidations(l,n,a);if(E.some(function(V){return r.isPromise(V.error)}))throw new Error("Use validate.async if you want support for promises");return p.processValidationResults(E,a)},r=p;r.extend=function(l){return[].slice.call(arguments,1).forEach(function(n){for(var a in n)l[a]=n[a]}),l},r.extend(p,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var l=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(l+="+"+r.version.metadata),l}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(l,n,a){var E=[],V,g,w,D,f,o,y;(r.isDomElement(l)||r.isJqueryElement(l))&&(l=r.collectFormValues(l));for(V in n){w=r.getDeepObjectValue(l,V),D=r.result(n[V],w,l,V,a,n);for(g in D){if(f=r.validators[g],!f)throw y=r.format("Unknown validator %{name}",{name:g}),new Error(y);o=D[g],o=r.result(o,w,l,V,a,n),o&&E.push({attribute:V,value:w,validator:g,globalOptions:a,attributes:l,options:o,error:f.call(f,w,o,V,l,a)})}}return E},processValidationResults:function(l,n){l=r.pruneEmptyErrors(l,n),l=r.expandMultipleErrors(l,n),l=r.convertErrorMessages(l,n);var a=n.format||"grouped";if(typeof r.formatters[a]=="function")l=r.formatters[a](l);else throw new Error(r.format("Unknown format %{format}",n));return r.isEmpty(l)?void 0:l},async:function(l,n,a){a=r.extend({},r.async.options,a);var E=a.wrapErrors||function(g){return g};a.cleanAttributes!==!1&&(l=r.cleanAttributes(l,n));var V=r.runValidations(l,n,a);return new r.Promise(function(g,w){r.waitForResults(V).then(function(){var D=r.processValidationResults(V,a);D?w(new E(D,a,l,n)):g(l)},function(D){w(D)})})},single:function(l,n,a){return a=r.extend({},r.single.options,a,{format:"flat",fullMessages:!1}),r({single:l},{single:n},a)},waitForResults:function(l){return l.reduce(function(n,a){return r.isPromise(a.error)?n.then(function(){return a.error.then(function(E){a.error=E||null})}):n},new r.Promise(function(n){n()}))},result:function(l){var n=[].slice.call(arguments,1);return typeof l=="function"&&(l=l.apply(null,n)),l},isNumber:function(l){return typeof l=="number"&&!isNaN(l)},isFunction:function(l){return typeof l=="function"},isInteger:function(l){return r.isNumber(l)&&l%1===0},isBoolean:function(l){return typeof l=="boolean"},isObject:function(l){return l===Object(l)},isDate:function(l){return l instanceof Date},isDefined:function(l){return l!=null},isPromise:function(l){return!!l&&r.isFunction(l.then)},isJqueryElement:function(l){return l&&r.isString(l.jquery)},isDomElement:function(l){return!l||!l.querySelectorAll||!l.querySelector?!1:r.isObject(document)&&l===document?!0:typeof HTMLElement=="object"?l instanceof HTMLElement:l&&typeof l=="object"&&l!==null&&l.nodeType===1&&typeof l.nodeName=="string"},isEmpty:function(l){var n;if(!r.isDefined(l))return!0;if(r.isFunction(l))return!1;if(r.isString(l))return r.EMPTY_STRING_REGEXP.test(l);if(r.isArray(l))return l.length===0;if(r.isDate(l))return!1;if(r.isObject(l)){for(n in l)return!1;return!0}return!1},format:r.extend(function(l,n){return r.isString(l)?l.replace(r.format.FORMAT_REGEXP,function(a,E,V){return E==="%"?"%{"+V+"}":String(n[V])}):l},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(l){return r.isNumber(l)?l*100%1===0?""+l:parseFloat(Math.round(l*100)/100).toFixed(2):r.isArray(l)?l.map(function(n){return r.prettify(n)}).join(", "):r.isObject(l)?r.isDefined(l.toString)?l.toString():JSON.stringify(l):(l=""+l,l.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(n,a,E){return""+a+" "+E.toLowerCase()}).toLowerCase())},stringifyValue:function(l,n){var a=n&&n.prettify||r.prettify;return a(l)},isString:function(l){return typeof l=="string"},isArray:function(l){return{}.toString.call(l)==="[object Array]"},isHash:function(l){return r.isObject(l)&&!r.isArray(l)&&!r.isFunction(l)},contains:function(l,n){return r.isDefined(l)?r.isArray(l)?l.indexOf(n)!==-1:n in l:!1},unique:function(l){return r.isArray(l)?l.filter(function(n,a,E){return E.indexOf(n)==a}):l},forEachKeyInKeypath:function(l,n,a){if(r.isString(n)){var E="",V,g=!1;for(V=0;V<n.length;++V)switch(n[V]){case".":g?(g=!1,E+="."):(l=a(l,E,!1),E="");break;case"\\":g?(g=!1,E+="\\"):g=!0;break;default:g=!1,E+=n[V];break}return a(l,E,!0)}},getDeepObjectValue:function(l,n){if(r.isObject(l))return r.forEachKeyInKeypath(l,n,function(a,E){if(r.isObject(a))return a[E]})},collectFormValues:function(l,n){var a={},E,V,g,w,D,f;if(r.isJqueryElement(l)&&(l=l[0]),!l)return a;for(n=n||{},w=l.querySelectorAll("input[name], textarea[name]"),E=0;E<w.length;++E)if(g=w.item(E),!r.isDefined(g.getAttribute("data-ignored"))){var o=g.name.replace(/\./g,"\\\\.");f=r.sanitizeFormValue(g.value,n),g.type==="number"?f=f?+f:null:g.type==="checkbox"?g.attributes.value?g.checked||(f=a[o]||null):f=g.checked:g.type==="radio"&&(g.checked||(f=a[o]||null)),a[o]=f}for(w=l.querySelectorAll("select[name]"),E=0;E<w.length;++E)if(g=w.item(E),!r.isDefined(g.getAttribute("data-ignored"))){if(g.multiple){f=[];for(V in g.options)D=g.options[V],D&&D.selected&&f.push(r.sanitizeFormValue(D.value,n))}else{var y=typeof g.options[g.selectedIndex]<"u"?g.options[g.selectedIndex].value:"";f=r.sanitizeFormValue(y,n)}a[g.name]=f}return a},sanitizeFormValue:function(l,n){return n.trim&&r.isString(l)&&(l=l.trim()),n.nullify!==!1&&l===""?null:l},capitalize:function(l){return r.isString(l)?l[0].toUpperCase()+l.slice(1):l},pruneEmptyErrors:function(l){return l.filter(function(n){return!r.isEmpty(n.error)})},expandMultipleErrors:function(l){var n=[];return l.forEach(function(a){r.isArray(a.error)?a.error.forEach(function(E){n.push(r.extend({},a,{error:E}))}):n.push(a)}),n},convertErrorMessages:function(l,n){n=n||{};var a=[],E=n.prettify||r.prettify;return l.forEach(function(V){var g=r.result(V.error,V.value,V.attribute,V.options,V.attributes,V.globalOptions);if(!r.isString(g)){a.push(V);return}g[0]==="^"?g=g.slice(1):n.fullMessages!==!1&&(g=r.capitalize(E(V.attribute))+" "+g),g=g.replace(/\\\^/g,"^"),g=r.format(g,{value:r.stringifyValue(V.value,n)}),a.push(r.extend({},V,{error:g}))}),a},groupErrorsByAttribute:function(l){var n={};return l.forEach(function(a){var E=n[a.attribute];E?E.push(a):n[a.attribute]=[a]}),n},flattenErrorsToArray:function(l){return l.map(function(n){return n.error}).filter(function(n,a,E){return E.indexOf(n)===a})},cleanAttributes:function(l,n){function a(g,w,D){return r.isObject(g[w])?g[w]:g[w]=D?!0:{}}function E(g){var w={},D;for(D in g)g[D]&&r.forEachKeyInKeypath(w,D,a);return w}function V(g,w){if(!r.isObject(g))return g;var D=r.extend({},g),f,o;for(o in g)f=w[o],r.isObject(f)?D[o]=V(D[o],f):f||delete D[o];return D}return!r.isObject(n)||!r.isObject(l)?{}:(n=E(n),V(l,n))},exposeModule:function(l,n,a,E,V){a?(E&&E.exports&&(a=E.exports=l),a.validate=l):(n.validate=l,l.isFunction(V)&&V.amd&&V([],function(){return l}))},warn:function(l){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+l)},error:function(l){typeof console<"u"&&console.error&&console.error("[validate.js] "+l)}}),p.validators={presence:function(l,n){if(n=r.extend({},this.options,n),n.allowEmpty!==!1?!r.isDefined(l):r.isEmpty(l))return n.message||this.message||"can't be blank"},length:function(l,n,a){if(r.isDefined(l)){n=r.extend({},this.options,n);var E=n.is,V=n.maximum,g=n.minimum,w=n.tokenizer||function(y){return y},D,f=[];l=w(l);var o=l.length;if(!r.isNumber(o))return n.message||this.notValid||"has an incorrect length";if(r.isNumber(E)&&o!==E&&(D=n.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",f.push(r.format(D,{count:E}))),r.isNumber(g)&&o<g&&(D=n.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",f.push(r.format(D,{count:g}))),r.isNumber(V)&&o>V&&(D=n.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",f.push(r.format(D,{count:V}))),f.length>0)return n.message||f}},numericality:function(l,n,a,E,V){if(r.isDefined(l)){n=r.extend({},this.options,n);var g=[],w,D,f={greaterThan:function(d,i){return d>i},greaterThanOrEqualTo:function(d,i){return d>=i},equalTo:function(d,i){return d===i},lessThan:function(d,i){return d<i},lessThanOrEqualTo:function(d,i){return d<=i},divisibleBy:function(d,i){return d%i===0}},o=n.prettify||V&&V.prettify||r.prettify;if(r.isString(l)&&n.strict){var y="^-?(0|[1-9]\\d*)";if(n.onlyInteger||(y+="(\\.\\d+)?"),y+="$",!new RegExp(y).test(l))return n.message||n.notValid||this.notValid||this.message||"must be a valid number"}if(n.noStrings!==!0&&r.isString(l)&&!r.isEmpty(l)&&(l=+l),!r.isNumber(l))return n.message||n.notValid||this.notValid||this.message||"is not a number";if(n.onlyInteger&&!r.isInteger(l))return n.message||n.notInteger||this.notInteger||this.message||"must be an integer";for(w in f)if(D=n[w],r.isNumber(D)&&!f[w](l,D)){var b="not"+r.capitalize(w),c=n[b]||this[b]||this.message||"must be %{type} %{count}";g.push(r.format(c,{count:D,type:o(w)}))}if(n.odd&&l%2!==1&&g.push(n.notOdd||this.notOdd||this.message||"must be odd"),n.even&&l%2!==0&&g.push(n.notEven||this.notEven||this.message||"must be even"),g.length)return n.message||g}},datetime:r.extend(function(l,n){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(l)){n=r.extend({},this.options,n);var a,E=[],V=n.earliest?this.parse(n.earliest,n):NaN,g=n.latest?this.parse(n.latest,n):NaN;if(l=this.parse(l,n),isNaN(l)||n.dateOnly&&l%864e5!==0)return a=n.notValid||n.message||this.notValid||"must be a valid date",r.format(a,{value:arguments[0]});if(!isNaN(V)&&l<V&&(a=n.tooEarly||n.message||this.tooEarly||"must be no earlier than %{date}",a=r.format(a,{value:this.format(l,n),date:this.format(V,n)}),E.push(a)),!isNaN(g)&&l>g&&(a=n.tooLate||n.message||this.tooLate||"must be no later than %{date}",a=r.format(a,{date:this.format(g,n),value:this.format(l,n)}),E.push(a)),E.length)return r.unique(E)}},{parse:null,format:null}),date:function(l,n){return n=r.extend({},n,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,l,n)},format:function(l,n){(r.isString(n)||n instanceof RegExp)&&(n={pattern:n}),n=r.extend({},this.options,n);var a=n.message||this.message||"is invalid",E=n.pattern,V;if(r.isDefined(l)&&(!r.isString(l)||(r.isString(E)&&(E=new RegExp(n.pattern,n.flags)),V=E.exec(l),!V||V[0].length!=l.length)))return a},inclusion:function(l,n){if(r.isDefined(l)&&(r.isArray(n)&&(n={within:n}),n=r.extend({},this.options,n),!r.contains(n.within,l))){var a=n.message||this.message||"^%{value} is not included in the list";return r.format(a,{value:l})}},exclusion:function(l,n){if(r.isDefined(l)&&(r.isArray(n)&&(n={within:n}),n=r.extend({},this.options,n),!!r.contains(n.within,l))){var a=n.message||this.message||"^%{value} is restricted";return r.isString(n.within[l])&&(l=n.within[l]),r.format(a,{value:l})}},email:r.extend(function(l,n){n=r.extend({},this.options,n);var a=n.message||this.message||"is not a valid email";if(r.isDefined(l)&&(!r.isString(l)||!this.PATTERN.exec(l)))return a},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(l,n,a,E,V){if(r.isDefined(l)){r.isString(n)&&(n={attribute:n}),n=r.extend({},this.options,n);var g=n.message||this.message||"is not equal to %{attribute}";if(r.isEmpty(n.attribute)||!r.isString(n.attribute))throw new Error("The attribute must be a non empty string");var w=r.getDeepObjectValue(E,n.attribute),D=n.comparator||function(o,y){return o===y},f=n.prettify||V&&V.prettify||r.prettify;if(!D(l,w,n,a,E))return r.format(g,{attribute:f(n.attribute)})}},url:function(l,n){if(r.isDefined(l)){n=r.extend({},this.options,n);var a=n.message||this.message||"is not a valid url",E=n.schemes||this.schemes||["http","https"],V=n.allowLocal||this.allowLocal||!1,g=n.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(l))return a;var w="^(?:(?:"+E.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",D="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(V?D+="?":w+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",w+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+D+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",g){var f="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",o="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",y="data:(?:"+f+")?(?:;base64)?,"+o;w="(?:"+w+")|(?:^"+y+"$)"}var b=new RegExp(w,"i");if(!b.exec(l))return a}},type:r.extend(function(l,n,a,E,V){if(r.isString(n)&&(n={type:n}),!!r.isDefined(l)){var g=r.extend({},this.options,n),w=g.type;if(!r.isDefined(w))throw new Error("No type was specified");var D;if(r.isFunction(w)?D=w:D=this.types[w],!r.isFunction(D))throw new Error("validate.validators.type.types."+w+" must be a function.");if(!D(l,g,a,E,V)){var f=n.message||this.messages[w]||this.message||g.message||(r.isFunction(w)?"must be of the correct type":"must be of type %{type}");return r.isFunction(f)&&(f=f(l,n,a,E,V)),r.format(f,{attribute:r.prettify(a),type:w})}}},{types:{object:function(l){return r.isObject(l)&&!r.isArray(l)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},p.formatters={detailed:function(l){return l},flat:r.flattenErrorsToArray,grouped:function(l){var n;l=r.groupErrorsByAttribute(l);for(n in l)l[n]=r.flattenErrorsToArray(l[n]);return l},constraint:function(l){var n;l=r.groupErrorsByAttribute(l);for(n in l)l[n]=l[n].map(function(a){return a.validator}).sort();return l}},p.exposeModule(p,this,h,N,s)}).call(fe,T,x,null)})(Y,Y.exports)),Y.exports}var Ee=Ne();const v=pe(Ee),O=(x,T,h="")=>{const N={};Object.keys(T).forEach(r=>{const l=T[r];v.isString(l)?N[r]={presence:{allowEmpty:!1,message:`^請輸入${l}`}}:N[r]=l});const s={},p=v(x,N);return p&&Object.keys(p).forEach(r=>s[`${h}${r}`]=p[r].join(",")),s},ue={class:"block"},be={class:"mt-4"},ke={class:"table align-middle gray-table side-table"},ge={key:0},ye={key:1,class:"text-light-gray"},xe={class:"d-flex flex-column gap-2"},Be={key:0},he={class:"mt-4"},$e={class:"table align-middle gray-table side-table"},Ce={class:"row g-3"},Te={class:"col-12 col-xl-2"},_e={class:"text-gray mb-2"},we={class:"col-12 col-xl-3"},De={class:"text-gray mb-2"},Se={class:"col-12 col-xl-4"},Fe={class:"row g-1"},Ae={class:"col-7"},Ue={class:"col-5"},Me={class:"col-12 col-xl-3"},Oe={class:"text-gray mb-2"},je={class:"col-12"},Ie={class:"text-gray mb-2"},Pe={class:"mt-4"},qe={class:"table align-middle gray-table side-table"},Le={class:"mt-4"},Re={class:"table align-middle gray-table side-table"},ze={key:0,class:"table-responsive mt-3 mb-0"},Ge={class:"table align-middle gray-table"},Je={key:0},Qe={key:0},We={class:"d-flex gap-2"},Ye=["onClick"],He={class:"mt-4"},Ze={class:"table align-middle gray-table side-table"},Ke={key:0,class:"block-bottom bg-light-teal"},Xe={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.ref(),r=e.computed(()=>z("accessibility",a.value.Status,1)),l=e.ref({}),n=e.computed(()=>E.value.filter(b=>!b.Deleted)),a=e.ref({}),E=e.ref([]),V=e.computed({get:()=>!!n.value.length,set:b=>{b?g():E.value.forEach(c=>c.Deleted=!0)}}),g=()=>E.value.push({}),w=T,D=()=>{M.accessibility("getApplication",{ID:h.id}).subscribe(b=>{a.value=b.Project,p.value=b.Contacts,E.value=b.ReceivedSubsidies,a.value.OrgCategory=a.value.OrgCategory||null,P().init("accessibility",a.value),s.value=a.value.changeApply,a.value.changeApply=void 0})},f=b=>b.Deleted=!0,o=b=>{var d,i;if(l.value={},b&&!y()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const c={Project:a.value,Contacts:p.value,ReceivedSubsidies:E.value.filter(t=>t.ID||!t.Deleted),Before:(d=s.value)==null?void 0:d.Form1Before,After:(i=s.value)==null?void 0:i.Form1After,Submit:b?"true":"false"};M.accessibility("saveApplication",c).subscribe(t=>{b?w("next",t.ID):a.value.ID?D():window.location.href=`Application.aspx?ID=${t.ID}`})},y=()=>{let b={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return a.value.OrgCategory==="2"&&(b.RegisteredNum="立案登記證字號"),l.value=O(a.value,b),b={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},p.value.forEach((c,d)=>Object.assign(l.value,O(c,b,`contact-${d}-`))),b={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},E.value.forEach((c,d)=>Object.assign(l.value,O(c,b,`received-${d}-`))),s.value&&(b={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,O(s.value,b))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([M.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(b=>{N.value=b[0],h.id?D():M.accessibility("getEmptyApplication").subscribe(c=>{a.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},c),p.value=[{Role:"負責人"},{Role:"聯絡人"}],P().init("accessibility",a.value)})})}),e.provide("editable",r),(b,c)=>{const d=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),m=e.resolveComponent("input-textarea"),u=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ue,[c[42]||(c[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",be,[e.createElementVNode("table",ke,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[15]||(c[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[c[16]||(c[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",ge,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",ye,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[c[17]||(c[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[18]||(c[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).ProjectName,modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":c[0]||(c[0]=C=>e.unref(a).ProjectName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[19]||(c[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":c[1]||(c[1]=C=>e.unref(a).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[20]||(c[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",xe,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).OrgCategory,"onUpdate:modelValue":c[2]||(c[2]=C=>e.unref(a).OrgCategory=C)},null,8,["error","options","modelValue"])]),e.unref(a).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Be,[e.createVNode(i,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(a).RegisteredNum,"onUpdate:modelValue":c[3]||(c[3]=C=>e.unref(a).RegisteredNum=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[21]||(c[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(a).TaxID,"onUpdate:modelValue":c[4]||(c[4]=C=>e.unref(a).TaxID=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[22]||(c[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":c[5]||(c[5]=C=>e.unref(a).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),c[43]||(c[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",he,[e.createElementVNode("table",$e,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(C,F)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Ce,[e.createElementVNode("div",Te,[e.createElementVNode("div",_e,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[23]||(c[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${F}-Name`],modelValue:C.Name,"onUpdate:modelValue":U=>C.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",we,[e.createElementVNode("div",De,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[24]||(c[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${F}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":U=>C.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Se,[c[25]||(c[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Fe,[e.createElementVNode("div",Ae,[e.createVNode(i,{modelValue:C.Phone,"onUpdate:modelValue":U=>C.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ue,[e.createVNode(i,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":U=>C.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Me,[e.createElementVNode("div",Oe,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[26]||(c[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${F}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":U=>C.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",je,[e.createElementVNode("div",Ie,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[27]||(c[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(l)[`contact-${F}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":U=>C.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),c[44]||(c[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Pe,[e.createElementVNode("table",qe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[28]||(c[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[c[29]||(c[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(m,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(a).Target,"onUpdate:modelValue":c[6]||(c[6]=C=>e.unref(a).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[30]||(c[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":c[7]||(c[7]=C=>e.unref(a).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[31]||(c[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":c[8]||(c[8]=C=>e.unref(a).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[32]||(c[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Qualitative,"onUpdate:modelValue":c[9]||(c[9]=C=>e.unref(a).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Le,[e.createElementVNode("table",Re,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[38]||(c[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(u,{modelValue:e.unref(V),"onUpdate:modelValue":c[10]||(c[10]=C=>e.isRef(V)?V.value=C:null)},null,8,["modelValue"]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",ze,[e.createElementVNode("table",Ge,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[c[33]||(c[33]=e.createElementVNode("th",null,"計畫名稱",-1)),c[34]||(c[34]=e.createElementVNode("th",null,"補助單位",-1)),c[35]||(c[35]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Je,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(C,F)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l)[`received-${F}-Name`],modelValue:C.Name,"onUpdate:modelValue":U=>C.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(l)[`received-${F}-Unit`],modelValue:C.Unit,"onUpdate:modelValue":U=>C.Unit=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l)[`received-${F}-Amount`],modelValue:C.Amount,"onUpdate:modelValue":U=>C.Amount=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Qe,[e.createElementVNode("div",We,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>f(C),type:"button"},[...c[36]||(c[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ye)):e.createCommentVNode("",!0),F+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...c[37]||(c[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[c[41]||(c[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",He,[e.createElementVNode("table",Ze,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[39]||(c[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(s).Form1Before,"onUpdate:modelValue":c[11]||(c[11]=C=>e.unref(s).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[40]||(c[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(s).Form1After,"onUpdate:modelValue":c[12]||(c[12]=C=>e.unref(s).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:c[13]||(c[13]=C=>o()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:c[14]||(c[14]=C=>o(!0)),type:"button"},[...c[45]||(c[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},ve={class:"block"},et={key:0,class:"text-pink lh-base mt-4"},tt={class:"mt-4"},lt={class:"table align-middle gray-table"},ot={class:"text-center"},nt={key:0,width:"180"},rt={class:"text-center"},at={key:0},dt=["innerHTML"],st=["href"],mt={key:0,class:"text-center"},ct={key:0},it={key:1,class:"text-pink"},Vt={key:1,class:"tag-group mt-2 gap-1"},pt={key:0,class:"tag tag-green-light"},ft=["download","href"],Nt=["onClick"],Et={class:"mt-4"},ut={class:"table align-middle gray-table side-table"},bt={key:0,class:"block-bottom bg-light-teal"},kt=["disabled"],gt={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([{Type:1,Title:"申請表",Template:"../../Template/ACC/附件01-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/ACC/附件02-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/ACC/附件03-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/ACC/附件04-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),s=e.ref(),p=e.computed(()=>N.value.some(f=>!f.Optional&&!f.Files.filter(o=>!o.Deleted).length)),r=e.computed(()=>z("accessibility",n.value.Status,2)),l=e.ref({}),n=e.ref({}),a=(f,o)=>{o.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:o.Path,Name:n.value.ProjectID+"_"+(f.Multiple?o.Name:`${f.Title}.pdf`)})},E=M.download,V=T,g=()=>{rxjs.forkJoin([M.accessibility("getAttachment",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=N.value.filter(y=>{var b;return!((b=y.Excludes)!=null&&b.includes(n.value.OrgCategory))}),N.value.forEach(y=>{y.Files=o.Attachments.filter(b=>b.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(b=>!b.Deleted).length)}),P().init("accessibility",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},w=f=>{var y,b;if(l.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Attachments:N.value.reduce((c,d)=>c.concat(d.Files),[]),Before:(y=s.value)==null?void 0:y.Form5Before,After:(b=s.value)==null?void 0:b.Form5After,Submit:f?"true":"false"};M.accessibility("saveAttachment",o).subscribe(()=>{f?V("next"):g()})},D=()=>{if(s.value){const f={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,O(s.value,f))}return!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",r),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-file"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ve,[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",et,[...o[4]||(o[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",tt,[e.createElementVNode("table",lt,[e.createElementVNode("thead",ot,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",nt,"狀態")):e.createCommentVNode("",!0),o[7]||(o[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",rt,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",at,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(r)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,dt)):e.createCommentVNode("",!0),e.unref(r)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:d.Template,style:{width:"140px"},type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,st)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",mt,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",ct,"已上傳")):(e.openBlock(),e.createElementBlock("span",it,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(b,{key:0,accept:".pdf",onFile:t=>a(d,t)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",Vt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",pt,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,ft),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>t.Deleted=!0,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Nt)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o[12]||(o[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Et,[e.createElementVNode("table",ut,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(s).Form5Before,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(s).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(s).Form5After,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",bt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=d=>w(!0)),disabled:e.unref(p),type:"button"},[...o[14]||(o[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,kt)])):e.createCommentVNode("",!0)],64)}}},yt={class:"block"},xt={class:"mt-4"},Bt={class:"table-responsive mt-3 mb-0"},ht={class:"table align-middle gray-table"},$t={key:0,width:"1"},Ct={key:0},Tt={class:"d-flex gap-2"},_t=["onClick"],wt={class:"table-responsive mt-3 mb-0"},Dt={class:"table align-middle gray-table"},St={class:"mt-4"},Ft={class:"table align-middle gray-table side-table"},At={key:0,class:"block-bottom bg-light-teal"},Ut={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.computed(()=>z("accessibility",n.value.Status,4)),r=e.ref({}),l=e.computed(()=>N.value.filter(f=>!f.Deleted)),n=e.ref({}),a=()=>N.value.push({}),E=T,V=()=>{rxjs.forkJoin([M.accessibility("getBenefit",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=o.Benefits,N.value.length||a(),P().init("accessibility",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},g=f=>f.Deleted=!0,w=f=>{var y,b;if(r.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:n.value,Benefits:N.value,Before:(y=s.value)==null?void 0:y.Form4Before,After:(b=s.value)==null?void 0:b.Form4After,Submit:f?"true":"false"};M.accessibility("saveBenefit",o).subscribe(()=>{f?E("next"):V()})},D=()=>{let f={Benefit:"不可量化成果"};return r.value=O(n.value,f),f={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((o,y)=>Object.assign(r.value,O(o,f,`item-${y}-`))),s.value&&(f={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,O(s.value,f))),!Object.keys(r.value).length};return e.onMounted(V),e.provide("editable",p),(f,o)=>{const y=e.resolveComponent("input-text"),b=e.resolveComponent("input-textarea"),c=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yt,[o[14]||(o[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",xt,[e.createElementVNode("div",Bt,[e.createElementVNode("table",ht,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"目標值",-1)),o[7]||(o[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",$t,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Title`],modelValue:d.Title,"onUpdate:modelValue":t=>d.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Target`],modelValue:d.Target,"onUpdate:modelValue":t=>d.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r)[`item-${i}-Description`],rows:"1",modelValue:d.Description,"onUpdate:modelValue":t=>d.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Ct,[e.createElementVNode("div",Tt,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>g(d),type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_t)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",wt,[e.createElementVNode("table",Dt,[o[10]||(o[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(n).Benefit,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(n).Benefit=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",St,[e.createElementVNode("table",Ft,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(s).Form4Before,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form4Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(s).Form4After,"onUpdate:modelValue":o[2]||(o[2]=d=>e.unref(s).Form4After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",At,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[3]||(o[3]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[4]||(o[4]=d=>w(!0)),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Mt={class:"block"},Ot={class:"mt-4"},jt={class:"table-responsive mt-3 mb-0"},It={class:"table align-middle gray-table"},Pt={class:"text-end"},qt={class:"text-end"},Lt={class:"table-responsive"},Rt={class:"table align-middle gray-table"},zt=["colspan"],Gt={key:0,width:"1"},Jt={class:"text-end"},Qt={key:0},Wt={class:"d-flex gap-2"},Yt=["onClick"],Ht={class:"mt-4"},Zt={class:"table-responsive mt-3 mb-0"},Kt={class:"table align-middle gray-table"},Xt={key:0,width:"1"},vt={class:"text-end"},el={key:0},tl={class:"d-flex gap-2"},ll=["onClick"],ol={class:"mt-4"},nl={class:"table align-middle gray-table side-table"},rl={key:0,class:"block-bottom bg-light-teal"},al={class:"text-center"},dl={class:"mb-5"},sl={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("accessibility",n.value.Status,3)),p=e.ref({}),r=e.computed(()=>E.value.filter(i=>!i.Deleted)),l=e.computed(()=>V.value.filter(i=>!i.Deleted)),n=e.ref({}),a=e.ref(),E=e.ref([]),V=e.ref([]),g=e.ref({}),w=e.ref(0),D=()=>E.value.push({}),f=()=>V.value.push({}),o=T,y=()=>{rxjs.forkJoin([M.accessibility("getFunding",{ID:h.id})]).subscribe(i=>{const t=i[0];n.value=t.Project,E.value=t.OtherSubsidies,V.value=t.BudgetPlans,g.value=t.GrantTargetSetting,E.value.length||D(),V.value.length||f(),P().init("accessibility",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=(i,t)=>{var u,A;if(p.value={},i&&!d()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&n.value.ApplyAmount>g.value.GrantLimit*1e4){a.value.show(()=>c(i,!0));return}const m={Project:n.value,OtherSubsidies:E.value,BudgetPlans:V.value,Before:(u=N.value)==null?void 0:u.Form3Before,After:(A=N.value)==null?void 0:A.Form3After,Submit:i?"true":"false"};M.accessibility("saveFunding",m).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return p.value=O(n.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},E.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`other-${m}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},V.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`plan-${m}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(p.value,O(N.value,i))),!Object.keys(p.value).length};return e.onMounted(y),e.provide("editable",s),e.watchEffect(()=>{n.value.OtherAmount=r.value.reduce((i,t)=>i+R(t.Amount),0),w.value=R(n.value.ApplyAmount)+R(n.value.SelfAmount)+R(n.value.OtherAmount),r.value.forEach(i=>i.percent=Math.round(R(i.Amount)/n.value.OtherAmount*1e4)/100),V.value.forEach(i=>i.sum=R(i.Amount)+R(i.OtherAmount))}),(i,t)=>{var U;const m=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),F=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Mt,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Ot,[e.createElementVNode("div",jt,[e.createElementVNode("table",It,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).ApplyAmount,modelValue:e.unref(n).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=S=>e.unref(n).ApplyAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).SelfAmount,modelValue:e.unref(n).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=S=>e.unref(n).SelfAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",Pt,e.toDisplayString((U=e.unref(n).OtherAmount)==null?void 0:U.toLocaleString()),1),e.createElementVNode("td",qt,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",Lt,[e.createElementVNode("table",Rt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(s)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,zt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",Gt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,e.toDisplayString(k+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`other-${k}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":B=>S.Unit=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`other-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Jt,e.toDisplayString(S.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`other-${k}-Content`],rows:"1",modelValue:S.Content,"onUpdate:modelValue":B=>S.Content=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",Qt,[e.createElementVNode("div",Wt,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Yt)):e.createCommentVNode("",!0),k+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Ht,[e.createElementVNode("div",Zt,[e.createElementVNode("table",Kt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",Xt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`plan-${k}-Title`],modelValue:S.Title,"onUpdate:modelValue":B=>S.Title=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-OtherAmount`],modelValue:S.OtherAmount,"onUpdate:modelValue":B=>S.OtherAmount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",vt,e.toDisplayString(S.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`plan-${k}-Description`],rows:"1",modelValue:S.Description,"onUpdate:modelValue":B=>S.Description=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",el,[e.createElementVNode("div",tl,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ll)):e.createCommentVNode("",!0),k+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ol,[e.createElementVNode("table",nl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=S=>e.unref(N).Form3Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=S=>e.unref(N).Form3After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",rl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=S=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=S=>c(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(F,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",al,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",dl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(g).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},ml={__name:"ProgressBar",setup(x){const T=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(h,N)=>{const s=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(s,{steps:T,type:"accessibility"})}}},cl={class:"block"},il={class:"mt-4"},Vl={class:"table align-middle gray-table side-table"},pl={key:0,class:"d-flex align-items-center gap-2"},fl={class:"input-group w-auto"},Nl={class:"text-teal-dark"},El={key:1,class:"invalid mt-0"},ul={class:"table-responsive mt-4"},bl={class:"table align-middle gray-table"},kl={key:0},gl={class:"input-group"},yl={key:0,class:"invalid mt-0"},xl={key:0},Bl={class:"d-flex gap-2"},hl=["onClick"],$l={class:"mt-4"},Cl={class:"table align-middle gray-table"},Tl={key:0},_l={key:0},wl={class:"d-flex gap-2"},Dl=["onClick"],Sl={class:"mt-4"},Fl={class:"table align-middle gray-table side-table"},Al={key:0,class:"block-bottom bg-light-teal"},Ul={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=[{value:1,text:"50%"},{value:2,text:"100%"}],s=e.ref(),p=e.computed(()=>V.value.EndDate),r=e.computed(()=>z("accessibility",E.value.Status,2)),l=e.ref({}),n=e.computed(()=>g.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),E=e.ref({}),V=e.ref({}),g=e.ref([]),w=e.ref([]),D=()=>M.accessibility("createItem",{ID:h.id}).subscribe(i=>g.value.push(i)),f=()=>w.value.push({Type:0,ItemID:0}),o=T,y=()=>{rxjs.forkJoin([M.accessibility("getWorkSchedule",{ID:h.id})]).subscribe(i=>{const t=i[0];E.value=t.Project,V.value=t.GrantType,g.value=t.Items,w.value=t.Schedules,g.value.length||D(),w.value.length||f(),P().init("accessibility",E.value),s.value=E.value.changeApply,E.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=i=>{var m,u;if(l.value={},i&&!d()){e.nextTick(()=>{var A;return(A=document.querySelector(".invalid"))==null?void 0:A.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:E.value,Items:g.value,Schedules:w.value,Before:(m=s.value)==null?void 0:m.Form2Before,After:(u=s.value)==null?void 0:u.Form2After,Submit:i?"true":"false"};M.accessibility("saveWorkSchedule",t).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=O(E.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},n.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`item-${m}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`schedule-${m}-`))),s.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,O(s.value,i))),!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",r),(i,t)=>{const m=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),A=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),F=e.resolveComponent("input-month"),U=e.resolveComponent("input-textarea"),S=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cl,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",il,[e.createElementVNode("table",Vl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(p)?(e.openBlock(),e.createElementBlock("div",pl,[e.createElementVNode("div",fl,[e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).StartTime,"onUpdate:modelValue":t[0]||(t[0]=k=>e.unref(E).StartTime=k)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).EndTime,"onUpdate:modelValue":t[1]||(t[1]=k=>e.unref(E).EndTime=k)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Nl,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(A,{value:e.unref(p)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",El,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",ul,[e.createElementVNode("table",bl,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",kl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+B)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${B}-Title`],modelValue:k.Title,"onUpdate:modelValue":_=>k.Title=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",gl,[e.createVNode(F,{"empty-value":0,modelValue:k.Begin,"onUpdate:modelValue":_=>k.Begin=_},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(F,{"empty-value":0,modelValue:k.End,"onUpdate:modelValue":_=>k.End=_},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]?(e.openBlock(),e.createElementBlock("div",yl,e.toDisplayString(e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`item-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`item-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",xl,[e.createElementVNode("div",Bl,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,hl)):e.createCommentVNode("",!0),B+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",$l,[e.createElementVNode("table",Cl,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Tl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-Type`],options:N,modelValue:k.Type,"onUpdate:modelValue":_=>k.Type=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-ItemID`],options:e.unref(n),"text-name":"Title","value-name":"ID",modelValue:k.ItemID,"onUpdate:modelValue":_=>k.ItemID=_,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(k.ItemID?String.fromCharCode(65+e.unref(n).findIndex(_=>_.ID===k.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`schedule-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`schedule-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",_l,[e.createElementVNode("div",wl,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Dl)):e.createCommentVNode("",!0),B+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Sl,[e.createElementVNode("table",Fl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(s).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=k=>e.unref(s).Form2Before=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(s).Form2After,"onUpdate:modelValue":t[3]||(t[3]=k=>e.unref(s).Form2After=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Al,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=k=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=k=>c(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ml={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Ol={class:"modal-content"},jl={class:"modal-body"},Il={class:"d-flex justify-content-center mt-4 gap-4"},Pl={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},ql={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(x,{expose:T}){let h;const N=e.ref(),s=x,p=()=>{h&&h()};return T({show:l=>{h=l,bootstrap.Modal.getOrCreateInstance(N.value).show()}}),(l,n)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:N,tabindex:"-1"},[e.createElementVNode("div",Ml,[e.createElementVNode("div",Ol,[n[0]||(n[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",jl,[e.renderSlot(l.$slots,"default"),e.createElementVNode("div",Il,[e.createElementVNode("button",Pl,e.toDisplayString(s.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:p,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(s.confirm),1)])])])])],512)]))}},Ll={class:"application-step"},Rl=["onClick"],zl={class:"step-content"},Gl={class:"step-label"},Jl={key:0,class:"step-status edit"},Ql={key:1,class:"step-status"},Wl={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(x,{emit:T}){const h=e.computed(()=>z(s.type,N[s.type].status,s.step)),N=P(),s=x,p=l=>{s.review?r("click",l.step):l.step<=N[s.type].step&&(location.href=`${l.url}.aspx?ID=${s.id}`)},r=T;return(l,n)=>(e.openBlock(),e.createElementBlock("div",Ll,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.steps,a=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(h)&&(a.step<e.unref(N)[x.type].step||a.step===x.step)}]),onClick:E=>p(a),key:a,role:"button"},[e.createElementVNode("div",zl,[e.createElementVNode("div",Gl,e.toDisplayString(a.title),1),e.unref(h)&&a.step===x.step?(e.openBlock(),e.createElementBlock("div",Jl,"編輯中")):a.step<e.unref(N)[x.type].step?(e.openBlock(),e.createElementBlock("div",Ql,"已完成")):e.createCommentVNode("",!0)])],10,Rl))),128))]))}},Yl={class:"block"},Hl={class:"mt-4"},Zl={class:"table align-middle gray-table side-table"},Kl={key:0},Xl={key:1,class:"text-light-gray"},vl={class:"d-flex gap-2"},eo={key:0,class:"invalid mt-0"},to={class:"d-flex flex-column gap-2"},lo={key:0},oo={class:"mt-4"},no={class:"table align-middle gray-table side-table"},ro={class:"row g-3"},ao={class:"col-12 col-xl-2"},so={class:"text-gray mb-2"},mo={class:"col-12 col-xl-3"},co={class:"text-gray mb-2"},io={class:"col-12 col-xl-4"},Vo={class:"row g-1"},po={class:"col-7"},fo={class:"col-5"},No={class:"col-12 col-xl-3"},Eo={class:"text-gray mb-2"},uo={class:"col-12"},bo={class:"text-gray mb-2"},ko={class:"mt-4"},go={class:"table align-middle gray-table side-table"},yo={class:"mt-4"},xo={class:"table align-middle gray-table side-table"},Bo={key:0,class:"table-responsive mt-3 mb-0"},ho={class:"table align-middle gray-table"},$o={key:0},Co={key:0},To={class:"d-flex gap-2"},_o=["onClick"],wo={class:"mt-4"},Do={class:"table align-middle gray-table side-table"},So={key:0,class:"block-bottom bg-light-teal"},Fo={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.ref(),r=e.computed(()=>z("culture",V.value.Status,1)),l=e.ref({}),n=e.ref(null),a=e.ref([]),E=e.computed(()=>w.value.filter(t=>!t.Deleted)),V=e.ref({}),g=e.computed(()=>a.value.filter(t=>!t.ParentCode)),w=e.ref([]),D=e.computed(()=>a.value.filter(t=>t.ParentCode===n.value)),f=e.computed({get:()=>!!E.value.length,set:t=>{t?o():w.value.forEach(m=>m.Deleted=!0)}}),o=()=>w.value.push({}),y=T,b=()=>{M.culture("getApplication",{ID:h.id}).subscribe(t=>{var m;V.value=t.Project,p.value=t.Contacts,w.value=t.ReceivedSubsidies,n.value=((m=a.value.find(u=>u.Code===V.value.Field))==null?void 0:m.ParentCode)||null,V.value.OrgCategory=V.value.OrgCategory||null,P().init("culture",V.value),s.value=V.value.changeApply,V.value.changeApply=void 0})},c=t=>t.Deleted=!0,d=t=>{var u,A;if(l.value={},t&&!i()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}const m={Project:V.value,Contacts:p.value,ReceivedSubsidies:w.value.filter(C=>C.ID||!C.Deleted),Before:(u=s.value)==null?void 0:u.Form1Before,After:(A=s.value)==null?void 0:A.Form1After,Submit:t?"true":"false"};M.culture("saveApplication",m).subscribe(C=>{t?y("next",C.ID):V.value.ID?b():window.location.href=`Application.aspx?ID=${C.ID}`})},i=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return V.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),l.value=O(V.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},p.value.forEach((m,u)=>Object.assign(l.value,O(m,t,`contact-${u}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},w.value.forEach((m,u)=>Object.assign(l.value,O(m,t,`received-${u}-`))),s.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,O(s.value,t))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([M.culture("getZgsCodes",{CodeGroup:"CULField"}),M.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{a.value=t[0],N.value=t[1],h.id?b():M.culture("getEmptyApplication").subscribe(m=>{n.value=null,V.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},m),p.value=[{Role:"負責人"},{Role:"聯絡人"}],P().init("culture",V.value)})})}),e.provide("editable",r),e.watch(n,()=>{n.value?D.value.find(t=>V.value.Field===t.Code)||(V.value.Field=D.value[0].Code):V.value.Field=null}),(t,m)=>{const u=e.resolveComponent("required-label"),A=e.resolveComponent("input-text"),C=e.resolveComponent("input-select"),F=e.resolveComponent("input-textarea"),U=e.resolveComponent("input-boolean"),S=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Yl,[m[45]||(m[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Hl,[e.createElementVNode("table",Zl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[17]||(m[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(V).Year),1)]),e.createElementVNode("tr",null,[m[18]||(m[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(V).ProjectID?(e.openBlock(),e.createElementBlock("span",Kl,e.toDisplayString(e.unref(V).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Xl,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[m[19]||(m[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(V).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[20]||(m[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l).ProjectName,modelValue:e.unref(V).ProjectName,"onUpdate:modelValue":m[0]||(m[0]=k=>e.unref(V).ProjectName=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[21]||(m[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",vl,[e.createVNode(C,{"empty-value":null,options:e.unref(g),"text-name":"Descname","value-name":"Code",modelValue:e.unref(n),"onUpdate:modelValue":m[1]||(m[1]=k=>e.isRef(n)?n.value=k:null)},null,8,["options","modelValue"]),e.createVNode(C,{"empty-value":null,disabled:!e.unref(n),options:e.unref(D),"text-name":"Descname","value-name":"Code",modelValue:e.unref(V).Field,"onUpdate:modelValue":m[2]||(m[2]=k=>e.unref(V).Field=k)},null,8,["disabled","options","modelValue"])]),e.unref(l).Field?(e.openBlock(),e.createElementBlock("div",eo,e.toDisplayString(e.unref(l).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[22]||(m[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(V).OrgName,"onUpdate:modelValue":m[3]||(m[3]=k=>e.unref(V).OrgName=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[23]||(m[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",to,[e.createElementVNode("div",null,[e.createVNode(C,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(V).OrgCategory,"onUpdate:modelValue":m[4]||(m[4]=k=>e.unref(V).OrgCategory=k)},null,8,["error","options","modelValue"])]),e.unref(V).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",lo,[e.createVNode(A,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(V).RegisteredNum,"onUpdate:modelValue":m[5]||(m[5]=k=>e.unref(V).RegisteredNum=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[24]||(m[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(V).TaxID,"onUpdate:modelValue":m[6]||(m[6]=k=>e.unref(V).TaxID=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[25]||(m[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(V).Address,"onUpdate:modelValue":m[7]||(m[7]=k=>e.unref(V).Address=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),m[46]||(m[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",oo,[e.createElementVNode("table",no,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",ro,[e.createElementVNode("div",ao,[e.createElementVNode("div",so,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[26]||(m[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(A,{error:e.unref(l)[`contact-${B}-Name`],modelValue:k.Name,"onUpdate:modelValue":_=>k.Name=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",mo,[e.createElementVNode("div",co,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[27]||(m[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(A,{error:e.unref(l)[`contact-${B}-JobTitle`],modelValue:k.JobTitle,"onUpdate:modelValue":_=>k.JobTitle=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",io,[m[28]||(m[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Vo,[e.createElementVNode("div",po,[e.createVNode(A,{modelValue:k.Phone,"onUpdate:modelValue":_=>k.Phone=_,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",fo,[e.createVNode(A,{placeholder:"請輸入分機",size:"4",modelValue:k.PhoneExt,"onUpdate:modelValue":_=>k.PhoneExt=_,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",No,[e.createElementVNode("div",Eo,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[29]||(m[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(A,{error:e.unref(l)[`contact-${B}-MobilePhone`],modelValue:k.MobilePhone,"onUpdate:modelValue":_=>k.MobilePhone=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",uo,[e.createElementVNode("div",bo,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[30]||(m[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(A,{error:e.unref(l)[`contact-${B}-EMail`],modelValue:k.EMail,"onUpdate:modelValue":_=>k.EMail=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),m[47]||(m[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",ko,[e.createElementVNode("table",go,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[31]||(m[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[m[32]||(m[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(F,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(V).Target,"onUpdate:modelValue":m[8]||(m[8]=k=>e.unref(V).Target=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[33]||(m[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(V).Summary,"onUpdate:modelValue":m[9]||(m[9]=k=>e.unref(V).Summary=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[34]||(m[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(V).Quantified,"onUpdate:modelValue":m[10]||(m[10]=k=>e.unref(V).Quantified=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[35]||(m[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(V).Qualitative,"onUpdate:modelValue":m[11]||(m[11]=k=>e.unref(V).Qualitative=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",yo,[e.createElementVNode("table",xo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[m[41]||(m[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(U,{modelValue:e.unref(f),"onUpdate:modelValue":m[12]||(m[12]=k=>e.isRef(f)?f.value=k:null)},null,8,["modelValue"]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Bo,[e.createElementVNode("table",ho,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[m[36]||(m[36]=e.createElementVNode("th",null,"計畫名稱",-1)),m[37]||(m[37]=e.createElementVNode("th",null,"補助單位",-1)),m[38]||(m[38]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",$o,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(E),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l)[`received-${B}-Name`],modelValue:k.Name,"onUpdate:modelValue":_=>k.Name=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l)[`received-${B}-Unit`],modelValue:k.Unit,"onUpdate:modelValue":_=>k.Unit=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l)[`received-${B}-Amount`],modelValue:k.Amount,"onUpdate:modelValue":_=>k.Amount=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Co,[e.createElementVNode("div",To,[e.unref(E).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>c(k),type:"button"},[...m[39]||(m[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_o)):e.createCommentVNode("",!0),B+1===e.unref(E).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:o,type:"button"},[...m[40]||(m[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[m[44]||(m[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",wo,[e.createElementVNode("table",Do,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[42]||(m[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(s).Form1Before,"onUpdate:modelValue":m[13]||(m[13]=k=>e.unref(s).Form1Before=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(u,null,{default:e.withCtx(()=>[...m[43]||(m[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(s).Form1After,"onUpdate:modelValue":m[14]||(m[14]=k=>e.unref(s).Form1After=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",So,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:m[15]||(m[15]=k=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:m[16]||(m[16]=k=>d(!0)),type:"button"},[...m[48]||(m[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ao={class:"block"},Uo={key:0,class:"text-pink lh-base mt-4"},Mo={class:"mt-4"},Oo={class:"table align-middle gray-table"},jo={class:"text-center"},Io={key:0,width:"180"},Po={class:"text-center"},qo={key:0},Lo=["innerHTML"],Ro=["href"],zo={key:0,class:"text-center"},Go={key:0},Jo={key:1,class:"text-pink"},Qo={key:1,class:"tag-group mt-2 gap-1"},Wo={key:0,class:"tag tag-green-light"},Yo=["download","href"],Ho=["onClick"],Zo={class:"mt-4"},Ko={class:"table align-middle gray-table side-table"},Xo={key:0,class:"block-bottom bg-light-teal"},vo=["disabled"],en={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([{Type:1,Title:"申請表",Template:"../../Template/CUL/1.申請表.docx",Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:"../../Template/CUL/2.計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/CUL/3.執行承諾書.docx",Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:"../../Template/CUL/4.未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),s=e.ref(),p=e.computed(()=>N.value.some(f=>!f.Optional&&!f.Files.filter(o=>!o.Deleted).length)),r=e.computed(()=>z("culture",n.value.Status,5)),l=e.ref({}),n=e.ref({}),a=(f,o)=>{o.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:o.Path,Name:n.value.ProjectID+"_"+(f.Multiple?o.Name:`${f.Title}.pdf`)})},E=M.download,V=T,g=()=>{rxjs.forkJoin([M.culture("getAttachment",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=N.value.filter(y=>{var b;return!((b=y.Excludes)!=null&&b.includes(n.value.OrgCategory))}),n.value.Status>=42&&N.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/LIT/5-著作權授權同意書.docx",Files:[]}),N.value.forEach(y=>{y.Files=o.Attachments.filter(b=>b.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(b=>!b.Deleted).length)}),P().init("culture",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},w=f=>{var y,b;if(l.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Attachments:N.value.reduce((c,d)=>c.concat(d.Files),[]),Before:(y=s.value)==null?void 0:y.Form5Before,After:(b=s.value)==null?void 0:b.Form5After,Submit:f?"true":"false"};M.culture("saveAttachment",o).subscribe(()=>{f?V("next"):g()})},D=()=>{if(s.value){const f={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,O(s.value,f))}return!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",r),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-file"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ao,[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",Uo,[...o[4]||(o[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Mo,[e.createElementVNode("table",Oo,[e.createElementVNode("thead",jo,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Io,"狀態")):e.createCommentVNode("",!0),o[7]||(o[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",Po,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",qo,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(r)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Lo)):e.createCommentVNode("",!0),e.unref(r)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:d.Template,style:{width:"140px"},type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ro)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",zo,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",Go,"已上傳")):(e.openBlock(),e.createElementBlock("span",Jo,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(b,{key:0,accept:".pdf",onFile:t=>a(d,t)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",Qo,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Wo,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,Yo),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>t.Deleted=!0,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Ho)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o[12]||(o[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Zo,[e.createElementVNode("table",Ko,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(s).Form5Before,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(s).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(s).Form5After,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Xo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=d=>w(!0)),disabled:e.unref(p),type:"button"},[...o[14]||(o[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,vo)])):e.createCommentVNode("",!0)],64)}}},tn={class:"block"},ln={class:"mt-4"},on={class:"table-responsive mt-3 mb-0"},nn={class:"table align-middle gray-table"},rn={class:"text-end"},an={class:"text-end"},dn={class:"table-responsive"},sn={class:"table align-middle gray-table"},mn=["colspan"],cn={key:0,width:"1"},Vn={key:0},pn={class:"d-flex gap-2"},fn=["onClick"],Nn={class:"mt-4"},En={class:"table-responsive mt-3 mb-0"},un={class:"table align-middle gray-table"},bn={key:0,width:"1"},kn={class:"text-end"},gn={key:0},yn={class:"d-flex gap-2"},xn=["onClick"],Bn={class:"mt-4"},hn={class:"table align-middle gray-table side-table"},$n={key:0,class:"block-bottom bg-light-teal"},Cn={class:"text-center"},Tn={class:"mb-5"},_n={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("culture",n.value.Status,3)),p=e.ref({}),r=e.computed(()=>V.value.filter(m=>!m.Deleted)),l=e.computed(()=>g.value.filter(m=>!m.Deleted)),n=e.ref({}),a=e.ref([]),E=e.ref(),V=e.ref([]),g=e.ref([]),w=e.ref({}),D=e.ref(0),f=()=>V.value.push({}),o=()=>g.value.push({ItemID:0}),y=T,b=()=>{rxjs.forkJoin([M.culture("getFunding",{ID:h.id})]).subscribe(m=>{const u=m[0];n.value=u.Project,V.value=u.OtherSubsidies,g.value=u.BudgetPlans,a.value=u.Items,w.value=u.GrantTargetSetting,V.value.length||f(),g.value.length||o(),P().init("culture",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},c=m=>m.Deleted=!0,d=m=>m.Deleted=!0,i=(m,u)=>{var C,F;if(p.value={},m&&!t()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!u&&n.value.ApplyAmount>w.value.GrantLimit*1e4){E.value.show(()=>i(m,!0));return}const A={Project:n.value,OtherSubsidies:V.value,BudgetPlans:g.value,Before:(C=N.value)==null?void 0:C.Form3Before,After:(F=N.value)==null?void 0:F.Form3After,Submit:m?"true":"false"};M.culture("saveFunding",A).subscribe(()=>{m?y("next"):b()})},t=()=>{let m={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return p.value=O(n.value,m),m={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},V.value.forEach((u,A)=>Object.assign(p.value,O(u,m,`other-${A}-`))),m={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},g.value.forEach((u,A)=>Object.assign(p.value,O(u,m,`plan-${A}-`))),N.value&&(m={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(p.value,O(N.value,m))),!Object.keys(p.value).length};return e.onMounted(b),e.provide("editable",s),e.watchEffect(()=>{n.value.OtherAmount=V.value.reduce((m,u)=>m+(u.Deleted?0:R(u.Amount)),0),D.value=R(n.value.ApplyAmount)+R(n.value.SelfAmount)+R(n.value.OtherAmount),g.value.forEach(m=>m.sum=R(m.Amount)+R(m.OtherAmount))}),(m,u)=>{var B;const A=e.resolveComponent("input-integer"),C=e.resolveComponent("input-text"),F=e.resolveComponent("input-select"),U=e.resolveComponent("input-textarea"),S=e.resolveComponent("required-label"),k=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",tn,[u[25]||(u[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",ln,[e.createElementVNode("div",on,[e.createElementVNode("table",nn,[u[6]||(u[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).ApplyAmount,modelValue:e.unref(n).ApplyAmount,"onUpdate:modelValue":u[0]||(u[0]=_=>e.unref(n).ApplyAmount=_)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).SelfAmount,modelValue:e.unref(n).SelfAmount,"onUpdate:modelValue":u[1]||(u[1]=_=>e.unref(n).SelfAmount=_)},null,8,["error","modelValue"])]),e.createElementVNode("td",rn,e.toDisplayString((B=e.unref(n).OtherAmount)==null?void 0:B.toLocaleString()),1),e.createElementVNode("td",an,e.toDisplayString(e.unref(D).toLocaleString()),1)])])])]),u[12]||(u[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",dn,[e.createElementVNode("table",sn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(s)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,mn)]),e.createElementVNode("tr",null,[u[7]||(u[7]=e.createElementVNode("th",{width:"1"},null,-1)),u[8]||(u[8]=e.createElementVNode("th",null,"單位名稱",-1)),u[9]||(u[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",cn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(_,j)=>(e.openBlock(),e.createElementBlock("tr",{key:_},[e.createElementVNode("td",null,e.toDisplayString(j+1),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(p)[`other-${j}-Unit`],modelValue:_.Unit,"onUpdate:modelValue":I=>_.Unit=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`other-${j}-Amount`],modelValue:_.Amount,"onUpdate:modelValue":I=>_.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",Vn,[e.createElementVNode("div",pn,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>c(_),type:"button"},[...u[10]||(u[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,fn)):e.createCommentVNode("",!0),j+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...u[11]||(u[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),u[26]||(u[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Nn,[e.createElementVNode("div",En,[e.createElementVNode("table",un,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[u[13]||(u[13]=e.createElementVNode("th",null,"重要工作項目",-1)),u[14]||(u[14]=e.createElementVNode("th",null,"預算項目",-1)),u[15]||(u[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),u[16]||(u[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),u[17]||(u[17]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),u[18]||(u[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",bn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(_,j)=>(e.openBlock(),e.createElementBlock("tr",{key:_},[e.createElementVNode("td",null,[e.createVNode(F,{"empty-value":0,error:e.unref(p)[`plan-${j}-ItemID`],options:e.unref(a),"text-name":"Title","value-name":"ID",modelValue:_.ItemID,"onUpdate:modelValue":I=>_.ItemID=I},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(p)[`plan-${j}-Title`],modelValue:_.Title,"onUpdate:modelValue":I=>_.Title=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`plan-${j}-Amount`],modelValue:_.Amount,"onUpdate:modelValue":I=>_.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`plan-${j}-OtherAmount`],modelValue:_.OtherAmount,"onUpdate:modelValue":I=>_.OtherAmount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",kn,e.toDisplayString(_.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(p)[`plan-${j}-Description`],rows:"1",modelValue:_.Description,"onUpdate:modelValue":I=>_.Description=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",gn,[e.createElementVNode("div",yn,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>d(_),type:"button"},[...u[19]||(u[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xn)):e.createCommentVNode("",!0),j+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:o,type:"button"},[...u[20]||(u[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),u[21]||(u[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[u[24]||(u[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Bn,[e.createElementVNode("table",hn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...u[22]||(u[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(p).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":u[2]||(u[2]=_=>e.unref(N).Form3Before=_),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...u[23]||(u[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(p).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":u[3]||(u[3]=_=>e.unref(N).Form3After=_),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",$n,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:u[4]||(u[4]=_=>i()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:u[5]||(u[5]=_=>i(!0)),type:"button"},[...u[27]||(u[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(k,{ref_key:"modal",ref:E},{default:e.withCtx(()=>[e.createElementVNode("div",Cn,[u[28]||(u[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Tn,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(w).GrantLimit)+"萬",1),u[29]||(u[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),u[30]||(u[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},wn={class:"block"},Dn={key:0,class:"text-pink lh-base mt-3"},Sn={class:"border"},Fn={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},An={class:"d-flex gap-2 align-items-center flex-grow-1"},Un={class:"text-nowrap"},Mn={class:"flex-grow-1"},On={class:"d-flex gap-2"},jn=["onClick"],In=["href"],Pn=["id"],qn={class:"table align-middle gray-table side-table mb-0"},Ln={class:"mt-4"},Rn={class:"table align-middle gray-table side-table"},zn={key:0,class:"block-bottom bg-light-teal"},Gn={__name:"Other",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("culture",r.value.Status,4)),p=e.ref({}),r=e.ref({}),l=e.ref([]),n=e.computed(()=>l.value.filter(f=>!f.Deleted)),a=()=>l.value.push({}),E=T,V=()=>{rxjs.forkJoin([M.culture("getRelatedProject",{ID:h.id})]).subscribe(f=>{const o=f[0];r.value=o.Project,l.value=o.Projects,P().init("culture",r.value),N.value=r.value.changeApply,r.value.changeApply=void 0})},g=f=>f.Deleted=!0,w=f=>{var y,b;if(p.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Projects:l.value,Before:(y=N.value)==null?void 0:y.Form4Before,After:(b=N.value)==null?void 0:b.Form4After,Submit:f?"true":"false"};M.culture("saveRelatedProject",o).subscribe(()=>{f?E("next"):V()})},D=()=>{let f={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return n.value.forEach((o,y)=>Object.assign(p.value,O(o,f,`project-${y}-`))),N.value&&(f={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(p.value,O(N.value,f))),!Object.keys(p.value).length};return e.onMounted(V),e.provide("editable",s),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-text"),c=e.resolveComponent("input-integer"),d=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",wn,[o[14]||(o[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("p",Dn," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(i,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:i},[e.createElementVNode("div",Sn,[e.createElementVNode("div",Fn,[e.createElementVNode("div",An,[e.createElementVNode("label",Un,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[4]||(o[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",Mn,[e.createVNode(b,{error:e.unref(p)[`project-${t}-Title`],modelValue:i.Title,"onUpdate:modelValue":m=>i.Title=m,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",On,[e.unref(s)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(m=>g(i),["prevent"]),href:"#"},"刪除",8,jn)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,In)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",qn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[5]||(o[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{class:"text-start w-auto",error:e.unref(p)[`project-${t}-Year`],modelValue:i.Year,"onUpdate:modelValue":m=>i.Year=m},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[6]||(o[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(p)[`project-${t}-OrgName`],modelValue:i.OrgName,"onUpdate:modelValue":m=>i.OrgName=m,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[7]||(o[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{class:"w-auto",error:e.unref(p)[`project-${t}-Amount`],modelValue:i.Amount,"onUpdate:modelValue":m=>i.Amount=m},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[8]||(o[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(p)[`project-${t}-Description`],rows:"4",modelValue:i.Description,"onUpdate:modelValue":m=>i.Description=m,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[9]||(o[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(p)[`project-${t}-Benefit`],rows:"4",modelValue:i.Benefit,"onUpdate:modelValue":m=>i.Benefit=m,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,Pn)])]))),128)),e.unref(s)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:a,type:"button"},[...o[10]||(o[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Ln,[e.createElementVNode("table",Rn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(p).Form4Before,rows:"4",modelValue:e.unref(N).Form4Before,"onUpdate:modelValue":o[0]||(o[0]=i=>e.unref(N).Form4Before=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(p).Form4After,rows:"4",modelValue:e.unref(N).Form4After,"onUpdate:modelValue":o[1]||(o[1]=i=>e.unref(N).Form4After=i),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",zn,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=i=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=i=>w(!0)),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Jn={class:"block"},Qn={class:"text-teal fw-bold py-3"},Wn={class:"table-responsive"},Yn={class:"table align-middle gray-table"},Hn={class:"text-end"},Zn={class:"text-end"},Kn={class:"mt-4"},Xn={class:"table align-middle gray-table"},vn={class:"text-center"},er={key:0,width:"180"},tr={class:"text-center"},lr=["innerHTML"],or=["href"],nr={key:0,class:"text-center"},rr={key:0},ar={key:1,class:"text-pink"},dr={key:1,class:"tag-group mt-2 gap-1"},sr={key:0,class:"tag tag-green-light"},mr=["download","href"],cr=["onClick"],ir={class:"block-bottom bg-light-teal"},Vr=!0,pr={__name:"Payment1",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(0),s=e.ref({}),p=e.ref([{Type:1,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:2,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),r=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(N.value*100/s.value.ApprovedAmount*100)/100,100):0),l=(E,V)=>{V.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:V.Path,Name:s.value.ProjectID+"_第一期請款_"+(E.Multiple?V.Name:`${E.Title}.pdf`)})},n=M.download,a=E=>{};return e.onMounted(()=>{M.culture("findApplication",{ID:h.id}).subscribe(E=>{s.value=E.Project,P().init("culture",s.value),p.value=p.value.filter(V=>{var g;return!((g=V.Excludes)!=null&&g.includes(s.value.OrgCategory))}),p.value.forEach(V=>{V.Uploaded=e.computed(()=>V.Files.filter(g=>!g.Deleted).length)})})}),e.provide("editable",Vr),(E,V)=>{var f;const g=e.resolveComponent("input-integer"),w=e.resolveComponent("required-label"),D=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jn,[V[11]||(V[11]=e.createElementVNode("h5",{class:"square-title"},"實際請款（請於期中報告通過後進行請款，實支實付上限50%）",-1)),e.createElementVNode("p",Qn,"核定經費: "+e.toDisplayString((f=e.unref(s).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("div",Wn,[e.createElementVNode("table",Yn,[V[5]||(V[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Hn,e.toDisplayString(e.unref(N)),1),V[3]||(V[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(g,{modelValue:e.unref(N),"onUpdate:modelValue":V[0]||(V[0]=o=>e.isRef(N)?N.value=o:null)},null,8,["modelValue"])]),e.createElementVNode("td",Zn,e.toDisplayString(e.unref(r))+"%",1),V[4]||(V[4]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),V[12]||(V[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),V[13]||(V[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Kn,[e.createElementVNode("table",Xn,[e.createElementVNode("thead",vn,[e.createElementVNode("tr",null,[V[6]||(V[6]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),V[7]||(V[7]=e.createElementVNode("th",null,"附件名稱",-1)),(e.openBlock(),e.createElementBlock("th",er,"狀態")),V[8]||(V[8]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(o,y)=>(e.openBlock(),e.createElementBlock("tr",{key:o},[e.createElementVNode("td",tr,e.toDisplayString(y+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.Title),1)]),_:2},1024)]),o.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:o.Comment},null,8,lr)):e.createCommentVNode("",!0),o.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:o.Template,style:{width:"140px"},type:"button"},[...V[9]||(V[9]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,or)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createElementBlock("td",nr,[o.Uploaded?(e.openBlock(),e.createElementBlock("span",rr,"已上傳")):(e.openBlock(),e.createElementBlock("span",ar,"尚未上傳"))])),e.createElementVNode("td",null,[o.Multiple||!o.Uploaded?(e.openBlock(),e.createBlock(D,{key:0,accept:".pdf",onFile:b=>l(o,b)},null,8,["onFile"])):e.createCommentVNode("",!0),o.Uploaded?(e.openBlock(),e.createElementBlock("div",dr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.Files,b=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:b},[b.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",sr,[e.createElementVNode("a",{class:"tag-link my-1",download:b.Name,href:e.unref(n)(b.Path)},e.toDisplayString(b.Name),9,mr),(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:c=>b.Deleted=!0,type:"button"},[...V[10]||(V[10]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,cr))]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",ir,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[1]||(V[1]=o=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[2]||(V[2]=o=>a()),type:"button"},[...V[14]||(V[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])],64)}}},fr={class:"block"},Nr={class:"text-teal fw-bold py-3"},Er={class:"text-teal fw-bold pb-3"},ur={class:"table-responsive"},br={class:"table align-middle gray-table"},kr={class:"text-end"},gr={class:"text-end"},yr={class:"mt-4"},xr={class:"table align-middle gray-table"},Br={class:"text-center"},hr={key:0,width:"180"},$r={class:"text-center"},Cr=["innerHTML"],Tr=["href"],_r={key:0,class:"text-center"},wr={key:0},Dr={key:1,class:"text-pink"},Sr={key:1,class:"tag-group mt-2 gap-1"},Fr={key:0,class:"tag tag-green-light"},Ar=["download","href"],Ur=["onClick"],Mr={class:"block-bottom bg-light-teal"},Or=!0,ee=3e4,jr={__name:"Payment2",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(3e4),s=e.ref({}),p=e.ref([{Type:1,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:2,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:3,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:4,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),r=e.computed(()=>s.value.ApprovedAmount?Math.min(Math.round(N.value*100/s.value.ApprovedAmount*100)/100,100):0),l=(E,V)=>{V.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:V.Path,Name:s.value.ProjectID+"_第二期請款_"+(E.Multiple?V.Name:`${E.Title}.pdf`)})},n=M.download,a=E=>{};return e.onMounted(()=>{M.culture("findApplication",{ID:h.id}).subscribe(E=>{s.value=E.Project,P().init("culture",s.value),p.value=p.value.filter(V=>{var g;return!((g=V.Excludes)!=null&&g.includes(s.value.OrgCategory))}),p.value.forEach(V=>{V.Uploaded=e.computed(()=>V.Files.filter(g=>!g.Deleted).length)})})}),e.provide("editable",Or),(E,V)=>{var f;const g=e.resolveComponent("input-integer"),w=e.resolveComponent("required-label"),D=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",fr,[V[10]||(V[10]=e.createElementVNode("h5",{class:"square-title"},"實際請款（請於期末報告通過後進行請款，實支實付累計100%）",-1)),e.createElementVNode("p",Nr,"核定經費: "+e.toDisplayString((f=e.unref(s).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("p",Er,"賸餘款: "+e.toDisplayString((e.unref(s).ApprovedAmount-e.unref(N)).toLocaleString())+"元",1),e.createElementVNode("div",ur,[e.createElementVNode("table",br,[V[4]||(V[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",kr,e.toDisplayString(e.unref(N)-ee),1),e.createElementVNode("td",{class:"text-end"},e.toDisplayString(ee)),e.createElementVNode("td",null,[e.createVNode(g,{modelValue:e.unref(N),"onUpdate:modelValue":V[0]||(V[0]=o=>e.isRef(N)?N.value=o:null)},null,8,["modelValue"])]),e.createElementVNode("td",gr,e.toDisplayString(e.unref(r))+"%",1),V[3]||(V[3]=e.createElementVNode("td",{class:"text-end"},"100%",-1))])])])]),V[11]||(V[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),V[12]||(V[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",yr,[e.createElementVNode("table",xr,[e.createElementVNode("thead",Br,[e.createElementVNode("tr",null,[V[5]||(V[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),V[6]||(V[6]=e.createElementVNode("th",null,"附件名稱",-1)),(e.openBlock(),e.createElementBlock("th",hr,"狀態")),V[7]||(V[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(o,y)=>(e.openBlock(),e.createElementBlock("tr",{key:o},[e.createElementVNode("td",$r,e.toDisplayString(y+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.Title),1)]),_:2},1024)]),o.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:o.Comment},null,8,Cr)):e.createCommentVNode("",!0),o.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:o.Template,style:{width:"140px"},type:"button"},[...V[8]||(V[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Tr)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createElementBlock("td",_r,[o.Uploaded?(e.openBlock(),e.createElementBlock("span",wr,"已上傳")):(e.openBlock(),e.createElementBlock("span",Dr,"尚未上傳"))])),e.createElementVNode("td",null,[o.Multiple||!o.Uploaded?(e.openBlock(),e.createBlock(D,{key:0,accept:".pdf",onFile:b=>l(o,b)},null,8,["onFile"])):e.createCommentVNode("",!0),o.Uploaded?(e.openBlock(),e.createElementBlock("div",Sr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.Files,b=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:b},[b.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Fr,[e.createElementVNode("a",{class:"tag-link my-1",download:b.Name,href:e.unref(n)(b.Path)},e.toDisplayString(b.Name),9,Ar),(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:c=>b.Deleted=!0,type:"button"},[...V[9]||(V[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Ur))]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Mr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[1]||(V[1]=o=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[2]||(V[2]=o=>a()),type:"button"},[...V[13]||(V[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])],64)}}},Ir={class:"block rounded-top-4"},Pr={class:"horizontal-scrollable"},qr={class:"timeline"},Lr={class:"year"},Rr={class:"month"},zr=["onClick"],Gr={class:"square-title"},Jr={class:"table-responsive mt-4"},Qr={class:"table align-middle gray-table"},Wr={class:"text-end"},Yr={class:"table-responsive"},Hr={class:"table align-middle gray-table"},Zr={class:"text-end"},Kr={key:0,class:"invalid mt-0"},Xr={class:"mt-3"},vr={class:"mt-3"},ea=["rowspan"],ta={key:0,class:"block-bottom bg-light-teal"},la={__name:"Progress",props:{id:{type:[Number,String]}},setup(x){const T=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],h=x,N=e.ref(),s=e.ref({}),p=e.ref(0),r=e.ref({}),l=e.ref([]),n=e.ref({}),a=e.computed(()=>Math.round((p.value+l.value.filter(o=>o.Status===3).length)*100/E.value.length*10)/10),E=e.ref([]),V=e.ref([]),g=o=>{N.value=o,w()},w=()=>{M.culture("getMonthlyProgress",{ID:h.id,Year:N.value.year-1911,Month:N.value.month}).subscribe(o=>{const y=o.Logs,b=o.Items,c=o.Steps;let d=!1;p.value=0,n.value=o.Progress,E.value=o.Schedules,l.value=[],V.value.forEach(i=>{i.months.forEach(t=>{d||(t===N.value&&(d=!0),E.value.forEach(m=>{var u,A;if(m.Month===t.month)if(d||m.Status!==3){const C=y.find(F=>F.ScheduleID===m.ID)||{ScheduleID:m.ID,Status:m.Status};l.value.push(Object.assign(C,{Year:i.year,Month:m.Month,ItemTitle:(u=b.find(F=>F.ID===m.ItemID))==null?void 0:u.Title,Type:m.Type,StepTitle:(A=c.find(F=>F.ID===m.StepID))==null?void 0:A.Title}))}else p.value++}))})})})},D=o=>{if(s.value={},o&&!f()){e.nextTick(()=>{var b;return(b=document.querySelector(".invalid"))==null?void 0:b.scrollIntoView({behavior:"smooth",block:"center"})});return}const y={ID:n.value.ID,Description:n.value.Description||"",Status:o?1:0,Logs:l.value.map(b=>({ID:b.ID||0,ScheduleID:b.ScheduleID,Status:b.Status,DelayReason:b.DelayReason||"",ImprovedWay:b.ImprovedWay||""}))};M.culture("saveMonthlyProgress",y).subscribe(b=>{b&&(window.location.href="../inprogressList.aspx")})},f=()=>{let o={Description:"實際工作執行情形"};return s.value=O(n.value,o),l.value.forEach((y,b)=>{o={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(y.Status)&&(o.DelayReason="落後原因",o.ImprovedWay="改善措施"),Object.assign(s.value,O(y,o,`item-${b}-`))}),!Object.keys(s.value).length};return e.onMounted(()=>{M.culture("getApplication",{ID:h.id}).subscribe(o=>{r.value=o.Project,P().init("culture",r.value);const y=new Date(r.value.StartTime),b=new Date(r.value.EndTime),c=Date.now();for(;;){const d=y.getFullYear(),i=y.getMonth(),t={year:d,month:i+1,disabled:new Date(d,i,20).getTime()>c};let m=V.value.find(u=>u.year===d);if(m?m.months.push(t):V.value.push({year:d,months:[t]}),d*100+i>=b.getFullYear()*100+b.getMonth())break;y.setMonth(i+1)}})}),(o,y)=>{const b=e.resolveComponent("input-textarea"),c=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ir,[e.createElementVNode("div",Pr,[y[3]||(y[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",qr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),d=>(e.openBlock(),e.createElementBlock("li",{key:d},[e.createElementVNode("span",Lr,e.toDisplayString(d.year-1911)+"年",1),e.createElementVNode("ul",Rr,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.months,i=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(N)===i,disabled:i.disabled}),key:i},[e.createElementVNode("a",{onClick:t=>g(i),href:"javascript:void(0)"},e.toDisplayString(i.month)+"月",9,zr)],2))),128))])]))),128))]),y[4]||(y[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",Gr,e.toDisplayString(e.unref(N).year-1911)+"年"+e.toDisplayString(e.unref(N).month)+"月 實際進度",1),e.createElementVNode("div",Jr,[e.createElementVNode("table",Qr,[y[5]||(y[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Wr,e.toDisplayString(e.unref(N).year-1911)+"年"+e.toDisplayString(e.unref(N).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(s).Description,rows:"4",modelValue:e.unref(n).Description,"onUpdate:modelValue":y[0]||(y[0]=d=>e.unref(n).Description=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Yr,[e.createElementVNode("table",Hr,[y[8]||(y[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("th",Zr,e.toDisplayString(d.Year-1911)+"年"+e.toDisplayString(d.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(d.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(d.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(d.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(c,{options:T,modelValue:d.Status,"onUpdate:modelValue":t=>d.Status=t},null,8,["modelValue","onUpdate:modelValue"]),e.unref(s)[`item-${i}-Status`]?(e.openBlock(),e.createElementBlock("div",Kr,e.toDisplayString(e.unref(s)[`item-${i}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(d.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",Xr,[y[6]||(y[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(b,{error:e.unref(s)[`item-${i}-DelayReason`],rows:"1",modelValue:d.DelayReason,"onUpdate:modelValue":t=>d.DelayReason=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",vr,[y[7]||(y[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(b,{error:e.unref(s)[`item-${i}-ImprovedWay`],rows:"1",modelValue:d.ImprovedWay,"onUpdate:modelValue":t=>d.ImprovedWay=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),i?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(l).length},e.toDisplayString(e.unref(a))+"% ",9,ea))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",ta,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:y[1]||(y[1]=d=>D()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:y[2]||(y[2]=d=>D(!0)),type:"button"},[...y[9]||(y[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},oa={__name:"ProgressBar",setup(x){const T=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(h,N)=>{const s=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(s,{steps:T,type:"culture"})}}},na=(x,T)=>{const h=x.__vccOpts||x;for(const[N,s]of T)h[N]=s;return h},ra={class:"block"},aa={class:"mt-4"},da={class:"table align-middle gray-table side-table"},sa={key:0,class:"d-flex align-items-center gap-2"},ma={class:"input-group w-auto"},ca={class:"text-teal-dark"},ia={key:1,class:"invalid mt-0"},Va={class:"square-title mt-4"},pa={class:"mt-4"},fa=["onClick"],Na={class:"d-flex flex-column gap-2"},Ea={class:"mt-4 d-flex flex-column gap-2"},ua={class:"d-flex flex-column gap-3 mt-4"},ba={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},ka={class:"d-flex gap-2 align-items-center flex-grow-1"},ga={class:"text-nowrap"},ya={class:"flex-grow-1"},xa={class:"d-flex gap-2"},Ba=["onClick"],ha=["href"],$a=["id"],Ca={class:"table align-middle gray-table side-table mb-0"},Ta={class:"p-0"},_a={class:"item-list"},wa={class:"mt-2 align-self-start text-center"},Da={class:"input-group"},Sa={key:0,class:"invalid mt-0"},Fa={key:0,class:"d-flex gap-2 mt-1 align-self-start"},Aa=["onClick"],Ua=["onClick"],Ma={class:"row"},Oa={class:"col"},ja=["value"],Ia={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Pa=["onClick"],qa=["onClick"],La={class:"col"},Ra=["value"],za={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Ga=["onClick"],Ja=["onClick"],Qa=["onClick"],Wa={class:"mt-4"},Ya={class:"table align-middle gray-table side-table"},Ha={key:0,class:"block-bottom bg-light-teal"},Za=na({__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("culture",n.value.Status,2)),p=e.computed(()=>E.value.EndDate),r=e.ref({}),l=e.computed(()=>a.value.filter(m=>!m.Deleted)),n=e.ref({}),a=e.ref([]),E=e.ref({}),V=()=>{M.culture("createGoal",{ID:h.id}).subscribe(m=>{a.value.push(Object.assign(m,{Items:[]}));const u=a.value[a.value.length-1];g(u)})},g=m=>{M.culture("createGoalItem",{ID:h.id,GoalID:m.ID}).subscribe(u=>{m.Items.push(Object.assign(u,{Steps:[],Schedules:[]}));const A=m.Items[m.Items.length-1];D(A),D(A),D(A),w(A,1),w(A,2)})},w=(m,u)=>M.culture("createGoalSchedule",{ID:h.id,ItemID:m.ID,Type:u}).subscribe(A=>m.Schedules.push(A)),D=m=>M.culture("createGoalStep",{ID:h.id,ItemID:m.ID}).subscribe(u=>m.Steps.push(u)),f=T,o=()=>{rxjs.forkJoin([M.culture("getWorkSchedule",{ID:h.id})]).subscribe(m=>{const u=m[0];n.value=u.Project,a.value=u.Goals,E.value=u.GrantType,a.value.length||V(),P().init("culture",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},y=m=>m.Deleted=!0,b=m=>m.Deleted=!0,c=m=>m.Deleted=!0,d=m=>m.Deleted=!0,i=m=>{var A,C;if(r.value={},m&&!t()){e.nextTick(()=>{var F;return(F=document.querySelector(".invalid"))==null?void 0:F.scrollIntoView({behavior:"smooth",block:"center"})});return}const u={Project:n.value,Goals:a.value,Before:(A=N.value)==null?void 0:A.Form2Before,After:(C=N.value)==null?void 0:C.Form2After,Submit:m?"true":"false"};M.culture("saveWorkSchedule",u).subscribe(()=>{m?f("next"):o()})},t=()=>{let m={StartTime:"計畫期程",EndTime:"計畫期程"};r.value=O(n.value,m);const u={Title:"計畫目標",Content:"預期效益"},A={Title:"重要工作項目",Indicator:"績效指標"},C={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},F={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return a.value.filter(U=>!U.Deleted).forEach((U,S)=>{Object.assign(r.value,O(U,u,`goal-${S}-`)),U.Items.filter(k=>!k.Deleted).forEach((k,B)=>{Object.assign(r.value,O(k,A,`item-${S}-${B}-`)),k.Steps.filter(_=>!_.Deleted).forEach((_,j)=>Object.assign(r.value,O(_,C,`step-${S}-${B}-${j}-`))),k.Schedules.filter(_=>_.Type===1&&!_.Deleted).forEach((_,j)=>Object.assign(r.value,O(_,F,`schedule-${S}-${B}-1-${j}-`))),k.Schedules.filter(_=>_.Type===2&&!_.Deleted).forEach((_,j)=>Object.assign(r.value,O(_,F,`schedule-${S}-${B}-2-${j}-`)))})}),N.value&&(m={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(r.value,O(N.value,m))),!Object.keys(r.value).length};return e.onMounted(o),e.provide("editable",s),(m,u)=>{const A=e.resolveComponent("required-label"),C=e.resolveComponent("input-tw-date"),F=e.resolveComponent("tw-date"),U=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-month"),B=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ra,[u[30]||(u[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",aa,[e.createElementVNode("table",da,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[6]||(u[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(p)?(e.openBlock(),e.createElementBlock("div",sa,[e.createElementVNode("div",ma,[e.createVNode(C,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(n).StartTime,"onUpdate:modelValue":u[0]||(u[0]=_=>e.unref(n).StartTime=_)},null,8,["max-date","modelValue"]),u[7]||(u[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(n).EndTime,"onUpdate:modelValue":u[1]||(u[1]=_=>e.unref(n).EndTime=_)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",ca,[u[8]||(u[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(F,{value:e.unref(p)},null,8,["value"]),u[9]||(u[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(r).StartTime||e.unref(r).EndTime?(e.openBlock(),e.createElementBlock("div",ia,e.toDisplayString(e.unref(r).StartTime||e.unref(r).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",Va,[u[11]||(u[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:V,type:"button"},[...u[10]||(u[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(_,j)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:_},[e.unref(s)&&e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:I=>y(_),type:"button"},"刪除",8,fa)):e.createCommentVNode("",!0),e.createElementVNode("div",Na,[u[12]||(u[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(U,{error:e.unref(r)[`goal-${j}-Title`],modelValue:_.Title,"onUpdate:modelValue":I=>_.Title=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Ea,[u[13]||(u[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(S,{error:e.unref(r)[`goal-${j}-Content`],rows:"4",modelValue:_.Content,"onUpdate:modelValue":I=>_.Content=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",ua,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.Items.filter(I=>!I.Deleted),(I,G)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:I},[e.createElementVNode("div",ba,[e.createElementVNode("div",ka,[e.createElementVNode("label",ga,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[14]||(u[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",ya,[e.createVNode(U,{error:e.unref(r)[`item-${j}-${G}-Title`],modelValue:I.Title,"onUpdate:modelValue":q=>I.Title=q,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",xa,[e.unref(s)&&_.Items.filter(q=>!q.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(q=>b(I),["prevent"]),href:"#"},"刪除",8,Ba)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${G}`,role:"button"},"收合",8,ha)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${G}`},[e.createElementVNode("table",Ca,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[15]||(u[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",Ta,[e.createElementVNode("ul",_a,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Steps.filter(q=>!q.Deleted),(q,J)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(s)}]),key:q},[e.createElementVNode("div",wa,e.toDisplayString(String.fromCharCode(65+J)),1),e.createElementVNode("div",null,[e.createVNode(U,{error:e.unref(r)[`step-${j}-${G}-${J}-Title`],placeholder:"如:進行口訪紀錄",modelValue:q.Title,"onUpdate:modelValue":L=>q.Title=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",Da,[e.createVNode(k,{"empty-value":0,modelValue:q.Begin,"onUpdate:modelValue":L=>q.Begin=L},null,8,["modelValue","onUpdate:modelValue"]),u[16]||(u[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{"empty-value":0,modelValue:q.End,"onUpdate:modelValue":L=>q.End=L},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(r)[`step-${j}-${G}-${J}-Begin`]||e.unref(r)[`step-${j}-${G}-${J}-End`]?(e.openBlock(),e.createElementBlock("div",Sa,e.toDisplayString(e.unref(r)[`step-${j}-${G}-${J}-Begin`]||e.unref(r)[`step-${j}-${G}-${J}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",Fa,[I.Steps.filter(L=>!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:L=>d(q),type:"button"},[...u[17]||(u[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Aa)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:L=>D(I),type:"button"},[...u[18]||(u[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Ua)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[19]||(u[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(r)[`item-${j}-${G}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:I.Indicator,"onUpdate:modelValue":q=>I.Indicator=q,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[20]||(u[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Ma,[e.createElementVNode("div",Oa,[u[23]||(u[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Schedules.filter(q=>q.Type===1&&!q.Deleted),(q,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:q},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(s)?3:4}`])},[e.createVNode(k,{error:e.unref(r)[`schedule-${j}-${G}-1-${J}-Month`],"empty-value":0,modelValue:q.Month,"onUpdate:modelValue":L=>q.Month=L},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(s)?7:8}`])},[e.createVNode(B,{"empty-value":0,error:e.unref(r)[`schedule-${j}-${G}-1-${J}-StepID`],options:I.Steps.filter(L=>!L.Deleted),modelValue:q.StepID,"onUpdate:modelValue":L=>q.StepID=L},{default:e.withCtx(({index:L,option:H})=>[e.createElementVNode("option",{value:H.ID},e.toDisplayString(String.fromCharCode(65+L))+"."+e.toDisplayString(H.Title),9,ja)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(s)?(e.openBlock(),e.createElementBlock("div",Ia,[I.Schedules.filter(L=>L.Type===1&&!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:L=>c(q),type:"button"},[...u[21]||(u[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Pa)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:L=>w(I,1),type:"button"},[...u[22]||(u[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,qa)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",La,[u[26]||(u[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.Schedules.filter(q=>q.Type===2&&!q.Deleted),(q,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:q},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(s)?3:4}`])},[e.createVNode(k,{error:e.unref(r)[`schedule-${j}-${G}-2-${J}-Month`],"empty-value":0,modelValue:q.Month,"onUpdate:modelValue":L=>q.Month=L},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(s)?7:8}`])},[e.createVNode(B,{"empty-value":0,error:e.unref(r)[`schedule-${j}-${G}-2-${J}-StepID`],options:I.Steps.filter(L=>!L.Deleted),modelValue:q.StepID,"onUpdate:modelValue":L=>q.StepID=L},{default:e.withCtx(({index:L,option:H})=>[e.createElementVNode("option",{value:H.ID},e.toDisplayString(String.fromCharCode(65+L))+"."+e.toDisplayString(H.Title),9,Ra)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(s)?(e.openBlock(),e.createElementBlock("div",za,[I.Schedules.filter(L=>L.Type===2&&!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:L=>c(q),type:"button"},[...u[24]||(u[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ga)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:L=>w(I,2),type:"button"},[...u[25]||(u[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Ja)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,$a)]))),128))]),e.unref(s)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:I=>g(_),type:"button"},"新增工作項目",8,Qa)):e.createCommentVNode("",!0)]))),128))]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[u[29]||(u[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Wa,[e.createElementVNode("table",Ya,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[27]||(u[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(r).Form2Before,rows:"4",modelValue:e.unref(N).Form2Before,"onUpdate:modelValue":u[2]||(u[2]=_=>e.unref(N).Form2Before=_),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...u[28]||(u[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(r).Form2After,rows:"4",modelValue:e.unref(N).Form2After,"onUpdate:modelValue":u[3]||(u[3]=_=>e.unref(N).Form2After=_),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",Ha,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:u[4]||(u[4]=_=>i()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:u[5]||(u[5]=_=>i(!0)),type:"button"},[...u[31]||(u[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-84d8fceb"]]),Ka={class:"block"},Xa={class:"mt-4"},va={class:"table align-middle gray-table side-table"},ed={key:0},td={key:1,class:"text-light-gray"},ld={class:"d-flex flex-column gap-2"},od={key:0},nd={class:"mt-4"},rd={class:"table align-middle gray-table side-table"},ad={class:"row g-3"},dd={class:"col-12 col-xl-2"},sd={class:"text-gray mb-2"},md={class:"col-12 col-xl-3"},cd={class:"text-gray mb-2"},id={key:0,class:"col-12 col-xl-4"},Vd={class:"row g-1"},pd={class:"col-7"},fd={class:"col-5"},Nd={key:1,class:"col-12 col-xl-3"},Ed={class:"text-gray mb-2"},ud={class:"mt-4"},bd={class:"table align-middle gray-table side-table"},kd={class:"d-flex align-items-center gap-2"},gd={class:"input-group w-auto"},yd={key:0,class:"invalid mt-0"},xd={class:"mt-4"},Bd={class:"table-responsive mt-3 mb-0"},hd={class:"table align-middle gray-table"},$d={class:"text-end"},Cd={class:"text-end"},Td={class:"text-end"},_d={class:"text-end"},wd={class:"text-end"},Dd={class:"table align-middle gray-table side-table"},Sd={key:0,class:"table-responsive mt-3 mb-0"},Fd={class:"table align-middle gray-table"},Ad={key:0},Ud={key:0},Md={class:"d-flex gap-2"},Od=["onClick"],jd={class:"mt-4"},Id={class:"table align-middle gray-table side-table"},Pd={key:0,class:"block-bottom bg-light-teal"},qd={class:"text-center"},Ld={class:"mb-5"},Rd={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.ref(),r=e.computed(()=>z("education",a.value.Status,1)),l=e.ref({}),n=e.computed(()=>V.value.filter(i=>!i.Deleted)),a=e.ref({}),E=e.ref(),V=e.ref([]),g=e.ref(),w=e.ref(0),D=e.computed({get:()=>!!n.value.length,set:i=>{i?f():V.value.forEach(t=>t.Deleted=!0)}}),f=()=>V.value.push({}),o=T,y=()=>{M.education("getApplication",{ID:h.id}).subscribe(i=>{a.value=i.Project,p.value=i.Contacts,V.value=i.ReceivedSubsidies,a.value.OrgCategory=a.value.OrgCategory||null,P().init("education",a.value),s.value=a.value.changeApply,a.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=(i,t)=>{var u,A;if(l.value={},i&&!d()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&g.value&&a.value.ApplyAmount>g.value.GrantLimit*1e4){E.value.show(()=>c(i,!0));return}const m={Project:a.value,Contacts:p.value,ReceivedSubsidies:V.value.filter(C=>C.ID||!C.Deleted),Before:(u=s.value)==null?void 0:u.Form1Before,After:(A=s.value)==null?void 0:A.Form1After,Submit:i?"true":"false"};M.education("saveApplication",m).subscribe(C=>{i?o("next",C.ID):a.value.ID?y():window.location.href=`Application.aspx?ID=${C.ID}`})},d=()=>{let i={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return a.value.OrgCategory==="2"&&(i.RegisteredNum="立案登記證字號"),l.value=O(a.value,i),i={Name:"姓名",JobTitle:"職稱"},Object.assign(l.value,O(p.value[0],i,"contact-0-")),i.MobilePhone="手機號碼",Object.assign(l.value,O(p.value[1],i,"contact-1-")),i={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},V.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`received-${m}-`))),s.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,O(s.value,i))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([M.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(i=>{N.value=i[0],h.id?y():M.education("getEmptyApplication").subscribe(t=>{a.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},t),p.value=[{Role:"負責人"},{Role:"聯絡人"}],P().init("education",a.value)})})}),e.provide("editable",r),e.watch(()=>a.value.OrgCategory,()=>{M.education("getGrantTargetSetting",{TargetTypeID:`EDC${a.value.OrgCategory}`}).subscribe(i=>{g.value=i})}),e.watchEffect(()=>{w.value=R(a.value.ApplyAmount)+R(a.value.SelfAmount)+R(a.value.OtherGovAmount)+R(a.value.OtherUnitAmount)}),(i,t)=>{const m=e.resolveComponent("required-label"),u=e.resolveComponent("input-text"),A=e.resolveComponent("input-select"),C=e.resolveComponent("input-tw-date"),F=e.resolveComponent("input-textarea"),U=e.resolveComponent("input-integer"),S=e.resolveComponent("input-boolean"),k=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ka,[t[52]||(t[52]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Xa,[e.createElementVNode("table",va,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[20]||(t[20]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",ed,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",td,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).ProjectName,modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":t[0]||(t[0]=B=>e.unref(a).ProjectName=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",ld,[e.createElementVNode("div",null,[e.createVNode(A,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).OrgCategory,"onUpdate:modelValue":t[1]||(t[1]=B=>e.unref(a).OrgCategory=B)},null,8,["error","options","modelValue"])]),e.unref(a).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",od,[e.createVNode(u,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(a).RegisteredNum,"onUpdate:modelValue":t[2]||(t[2]=B=>e.unref(a).RegisteredNum=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":t[3]||(t[3]=B=>e.unref(a).OrgName=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[26]||(t[26]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(a).TaxID,"onUpdate:modelValue":t[4]||(t[4]=B=>e.unref(a).TaxID=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[27]||(t[27]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":t[5]||(t[5]=B=>e.unref(a).Address=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[53]||(t[53]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",nd,[e.createElementVNode("table",rd,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(B,_)=>(e.openBlock(),e.createElementBlock("tr",{key:B},[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(B.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",ad,[e.createElementVNode("div",dd,[e.createElementVNode("div",sd,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[28]||(t[28]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(l)[`contact-${_}-Name`],modelValue:B.Name,"onUpdate:modelValue":j=>B.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",md,[e.createElementVNode("div",cd,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[29]||(t[29]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(l)[`contact-${_}-JobTitle`],modelValue:B.JobTitle,"onUpdate:modelValue":j=>B.JobTitle=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),_?(e.openBlock(),e.createElementBlock("div",id,[t[30]||(t[30]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Vd,[e.createElementVNode("div",pd,[e.createVNode(u,{modelValue:B.Phone,"onUpdate:modelValue":j=>B.Phone=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",fd,[e.createVNode(u,{placeholder:"請輸入分機",size:"4",modelValue:B.PhoneExt,"onUpdate:modelValue":j=>B.PhoneExt=j,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),_?(e.openBlock(),e.createElementBlock("div",Nd,[e.createElementVNode("div",Ed,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[31]||(t[31]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(u,{error:e.unref(l)[`contact-${_}-MobilePhone`],modelValue:B.MobilePhone,"onUpdate:modelValue":j=>B.MobilePhone=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),t[54]||(t[54]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",ud,[e.createElementVNode("table",bd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[32]||(t[32]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",kd,[e.createElementVNode("div",gd,[e.createVNode(C,{class:"w-auto",modelValue:e.unref(a).StartTime,"onUpdate:modelValue":t[6]||(t[6]=B=>e.unref(a).StartTime=B)},null,8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{class:"w-auto",modelValue:e.unref(a).EndTime,"onUpdate:modelValue":t[7]||(t[7]=B=>e.unref(a).EndTime=B)},null,8,["modelValue"])]),t[34]||(t[34]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",yd,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[35]||(t[35]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Target,modelValue:e.unref(a).Target,"onUpdate:modelValue":t[8]||(t[8]=B=>e.unref(a).Target=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[36]||(t[36]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":t[9]||(t[9]=B=>e.unref(a).Summary=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[37]||(t[37]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":t[10]||(t[10]=B=>e.unref(a).Quantified=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[55]||(t[55]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",xd,[t[43]||(t[43]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",Bd,[e.createElementVNode("table",hd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",$d,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[38]||(t[38]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Cd,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[39]||(t[39]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款",-1)])]),_:1})]),e.createElementVNode("th",Td,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[40]||(t[40]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",_d,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[41]||(t[41]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費（含總收費）",-1)])]),_:1})]),t[42]||(t[42]=e.createElementVNode("th",{class:"text-end"},"計畫總經費",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).ApplyAmount,modelValue:e.unref(a).ApplyAmount,"onUpdate:modelValue":t[11]||(t[11]=B=>e.unref(a).ApplyAmount=B)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).SelfAmount,modelValue:e.unref(a).SelfAmount,"onUpdate:modelValue":t[12]||(t[12]=B=>e.unref(a).SelfAmount=B)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).OtherGovAmount,modelValue:e.unref(a).OtherGovAmount,"onUpdate:modelValue":t[13]||(t[13]=B=>e.unref(a).OtherGovAmount=B)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).OtherUnitAmount,modelValue:e.unref(a).OtherUnitAmount,"onUpdate:modelValue":t[14]||(t[14]=B=>e.unref(a).OtherUnitAmount=B)},null,8,["error","modelValue"])]),e.createElementVNode("td",wd,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])])]),e.createElementVNode("table",Dd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[44]||(t[44]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{modelValue:e.unref(D),"onUpdate:modelValue":t[15]||(t[15]=B=>e.isRef(D)?D.value=B:null)},null,8,["modelValue"]),e.unref(D)?(e.openBlock(),e.createElementBlock("div",Sd,[e.createElementVNode("table",Fd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[45]||(t[45]=e.createElementVNode("th",null,"計畫名稱",-1)),t[46]||(t[46]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Ad,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(B,_)=>(e.openBlock(),e.createElementBlock("tr",{key:B},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`received-${_}-Name`],modelValue:B.Name,"onUpdate:modelValue":j=>B.Name=j,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`received-${_}-Amount`],modelValue:B.Amount,"onUpdate:modelValue":j=>B.Amount=j},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Ud,[e.createElementVNode("div",Md,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:j=>b(B),type:"button"},[...t[47]||(t[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Od)):e.createCommentVNode("",!0),_+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[48]||(t[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[51]||(t[51]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",jd,[e.createElementVNode("table",Id,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[49]||(t[49]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(s).Form1Before,"onUpdate:modelValue":t[16]||(t[16]=B=>e.unref(s).Form1Before=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[50]||(t[50]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(F,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(s).Form1After,"onUpdate:modelValue":t[17]||(t[17]=B=>e.unref(s).Form1After=B),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Pd,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[18]||(t[18]=B=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[19]||(t[19]=B=>c(!0)),type:"button"},[...t[56]||(t[56]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(k,{ref_key:"modal",ref:E},{default:e.withCtx(()=>{var B;return[e.createElementVNode("div",qd,[t[57]||(t[57]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Ld,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((B=e.unref(g))==null?void 0:B.GrantLimit)+"萬",1),t[58]||(t[58]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[59]||(t[59]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},zd={class:"block"},Gd={key:0,class:"text-pink lh-base mt-4"},Jd={class:"mt-4"},Qd={class:"table align-middle gray-table"},Wd={class:"text-center"},Yd={key:0,width:"180"},Hd={class:"text-center"},Zd={key:0},Kd=["innerHTML"],Xd=["href"],vd={key:0,class:"text-center"},es={key:0},ts={key:1,class:"text-pink"},ls={key:1,class:"tag-group mt-2 gap-1"},os={key:0,class:"tag tag-green-light"},ns=["download","href"],rs=["onClick"],as={class:"mt-4"},ds={class:"table align-middle gray-table side-table"},ss={key:0,class:"block-bottom bg-light-teal"},ms=["disabled"],cs={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([{Type:1,Title:"申請表",Template:"../../Template/EDC/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/EDC/2-申請計畫書.docx",Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/EDC/3-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]}]),s=e.ref(),p=e.computed(()=>N.value.some(f=>!f.Optional&&!f.Files.filter(o=>!o.Deleted).length)),r=e.computed(()=>z("education",n.value.Status,2)),l=e.ref({}),n=e.ref({}),a=(f,o)=>{o.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:o.Path,Name:n.value.ProjectID+"_"+(f.Multiple?o.Name:`${f.Title}.pdf`)})},E=M.download,V=T,g=()=>{rxjs.forkJoin([M.education("getAttachment",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=N.value.filter(y=>{var b;return!((b=y.Excludes)!=null&&b.includes(n.value.OrgCategory))}),N.value.forEach(y=>{y.Files=o.Attachments.filter(b=>b.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(b=>!b.Deleted).length)}),P().init("education",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},w=f=>{var y,b;if(l.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Attachments:N.value.reduce((c,d)=>c.concat(d.Files),[]),Before:(y=s.value)==null?void 0:y.Form5Before,After:(b=s.value)==null?void 0:b.Form5After,Submit:f?"true":"false"};M.education("saveAttachment",o).subscribe(()=>{f?V("next"):g()})},D=()=>{if(s.value){const f={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,O(s.value,f))}return!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",r),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-file"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",zd,[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",Gd,[...o[4]||(o[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如社團成立證明、社團運作證明、有效期間內之當選證書、登記證書等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Jd,[e.createElementVNode("table",Qd,[e.createElementVNode("thead",Wd,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Yd,"狀態")):e.createCommentVNode("",!0),o[7]||(o[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",Hd,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",Zd,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(r)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Kd)):e.createCommentVNode("",!0),e.unref(r)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:d.Template,style:{width:"140px"},type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Xd)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",vd,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",es,"已上傳")):(e.openBlock(),e.createElementBlock("span",ts,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(b,{key:0,accept:".pdf",onFile:t=>a(d,t)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",ls,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",os,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,ns),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>t.Deleted=!0,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,rs)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o[12]||(o[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",as,[e.createElementVNode("table",ds,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(s).Form5Before,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(s).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(s).Form5After,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",ss,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=d=>w(!0)),disabled:e.unref(p),type:"button"},[...o[14]||(o[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,ms)])):e.createCommentVNode("",!0)],64)}}},is={__name:"ProgressBar",setup(x){const T=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(h,N)=>{const s=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(s,{steps:T,type:"education"})}}},Vs={class:"modal-dialog modal-dialog-centered modal-md"},ps={class:"modal-content"},fs={class:"modal-body"},Ns={class:"d-flex flex-column align-items-center mb-5 gap-3"},Es={class:"fs-18"},us={__name:"ErrorModal",setup(x){const T=Z(),h=e.ref();return e.onMounted(()=>h.value.addEventListener("hidden.bs.modal",()=>T.error=null)),e.watch(()=>T.error,()=>{T.error&&bootstrap.Modal.getOrCreateInstance(h.value).show()}),(N,s)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:h,tabindex:"-1"},[e.createElementVNode("div",Vs,[e.createElementVNode("div",ps,[s[2]||(s[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",fs,[e.createElementVNode("div",Ns,[s[0]||(s[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",Es,e.toDisplayString(e.unref(T).error),1)]),s[1]||(s[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},bs={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const T=e.useModel(x,"modelValue"),h=[{value:!0,text:"是"},{value:!1,text:"否"}];return(N,s)=>{const p=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(p,{options:h,modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=r=>T.value=r)},null,8,["modelValue"])}}},ks=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(x,{emit:T}){const h=e.ref(),N=()=>{Array.from(h.value.files).forEach(p=>M.upload(p).subscribe(r=>s("file",r))),h.value.value=""},s=T;return(p,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:r[0]||(r[0]=l=>e.unref(h).click()),type:"button"},[...r[1]||(r[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:N,class:"d-none",ref_key:"input",ref:h,type:"file"},p.$attrs),null,16)],64))}}),gs=["disabled","placeholder","type"],ys={key:0,class:"invalid mt-0"},xs=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const T=e.inject("editable",!0),h=e.useModel(x,"modelValue");return e.watch(h,N=>{if(N){const s=(parseInt(N)||0).toString();N.toString()!==s&&(h.value=s)}}),(N,s)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(T),placeholder:e.unref(T)?x.placeholder:"",style:{"text-align":"right"},type:x.type},N.$attrs,{"onUpdate:modelValue":s[0]||(s[0]=p=>h.value=p)}),null,16,gs),[[e.vModelDynamic,h.value]]),x.error?(e.openBlock(),e.createElementBlock("div",ys,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Bs={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const T=e.useModel(x,"modelValue"),h=[];for(let N=1;N<=12;N++)h.push({value:N,text:`${N}月`});return(N,s)=>{const p=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(p,{options:h,modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=r=>T.value=r)},null,8,["modelValue"])}}},hs=["onChange","checked","disabled","id","value"],$s=["for"],Cs={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>oe(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const T=e.inject("editable",!0),h=e.useModel(x,"modelValue"),N=s=>{h.value=s};return(s,p)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,r=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:r},[e.createElementVNode("input",{onChange:l=>N(r[x.valueName]),checked:r[x.valueName]===h.value,class:"form-check-input",disabled:!e.unref(T),id:`${x.id}-${r[x.valueName]}`,type:"radio",value:r[x.valueName]},null,40,hs),e.createElementVNode("label",{class:"form-check-label",for:`${x.id}-${r[x.valueName]}`},e.toDisplayString(r[x.textName]),9,$s)]))),128))}},Ts=["disabled"],_s=["value"],ws=["value"],Ds={key:0,class:"invalid mt-0"},Ss=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const T=e.inject("editable",!0),h=e.useModel(x,"modelValue");return(N,s)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:x.disabled||!e.unref(T)},N.$attrs,{"onUpdate:modelValue":s[0]||(s[0]=p=>h.value=p)}),[e.unref(T)&&!h.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:x.emptyValue},e.toDisplayString(x.placeholder),9,_s)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,(p,r)=>e.renderSlot(N.$slots,"default",{key:p,index:r,option:p},()=>[e.createElementVNode("option",{value:p[x.valueName]},e.toDisplayString(p[x.textName]),9,ws)])),128))],16,Ts),[[e.vModelSelect,h.value]]),x.error?(e.openBlock(),e.createElementBlock("div",Ds,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Fs={class:"input-group"},As={key:0,class:"input-group-text"},Us=["disabled","placeholder","type"],Ms={key:0,class:"invalid mt-0"},Os=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const T=e.inject("editable",!0),h=e.useModel(x,"modelValue"),N=x;return N.maxLength&&e.watch(h,()=>{var s;((s=h.value)==null?void 0:s.length)>N.maxLength&&(h.value=h.value.substring(0,N.maxLength))}),(s,p)=>{const r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Fs,[x.prefix?(e.openBlock(),e.createElementBlock("span",As,[e.createVNode(r,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(T),placeholder:e.unref(T)?x.placeholder:"",type:x.type},s.$attrs,{"onUpdate:modelValue":p[0]||(p[0]=l=>h.value=l)}),null,16,Us),[[e.vModelDynamic,h.value]])]),x.error?(e.openBlock(),e.createElementBlock("div",Ms,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),js=["disabled","placeholder"],Is={key:0,class:"fs-14 text-gray mt-2"},Ps={class:"text-pink"},qs={key:1,class:"invalid mt-0"},Ls=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const T=e.inject("editable",!0),h=e.useModel(x,"modelValue"),N=x;return N.maxLength&&e.watch(h,()=>{var s;((s=h.value)==null?void 0:s.length)>N.maxLength&&(h.value=h.value.substring(0,N.maxLength))}),(s,p)=>{var r;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(T),placeholder:e.unref(T)?x.placeholder:""},s.$attrs,{"onUpdate:modelValue":p[0]||(p[0]=l=>h.value=l)}),null,16,js),[[e.vModelText,h.value]]),e.unref(T)&&x.maxLength?(e.openBlock(),e.createElementBlock("div",Is,[p[1]||(p[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",Ps,e.toDisplayString(((r=h.value)==null?void 0:r.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(x.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),x.error?(e.openBlock(),e.createElementBlock("div",qs,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),Rs=["disabled"],zs={key:0,class:"invalid"},Gs=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean}},emits:["update:modelValue"],setup(x,{emit:T}){let h;const N=x,s=e.ref(),p=e.inject("editable",!0),r=e.ref(),l=T,n=a=>{!a&&N.modelValue&&(a=moment(new Date(N.modelValue))),a?(s.value=a.format(N.displayFormat),l("update:modelValue",a.format(N.format))):(s.value="",l("update:modelValue","")),h.setStartDate(s.value||void 0)};return e.onMounted(()=>{const a=$(r.value);a.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:N.drops,locale:{format:N.displayFormat},maxDate:N.maxDate?new Date(N.maxDate):N.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(E,V)=>n(V.startDate)),h=a.data("daterangepicker"),n()}),e.onUnmounted(()=>h.remove()),e.watch(()=>N.modelValue,()=>n()),(a,E)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(p),ref_key:"element",ref:r,type:"text"},a.$attrs,{"onUpdate:modelValue":E[0]||(E[0]=V=>e.isRef(s)?s.value=V:null)}),null,16,Rs),[[e.vModelText,e.unref(s)]]),x.error?(e.openBlock(),e.createElementBlock("div",zs,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Js={class:"block"},Qs={class:"mt-4"},Ws={class:"table align-middle gray-table side-table"},Ys={key:0},Hs={key:1,class:"text-light-gray"},Zs={class:"mt-4"},Ks={class:"table align-middle gray-table side-table"},Xs={class:"row g-3"},vs={class:"col-12 col-xl-2"},em={class:"text-gray mb-2"},tm={class:"col-12 col-xl-3"},lm={class:"text-gray mb-2"},om={class:"col-12 col-xl-4"},nm={class:"row g-1"},rm={class:"col-7"},am={class:"col-5"},dm={class:"col-12 col-xl-3"},sm={class:"text-gray mb-2"},mm={class:"col-12"},cm={class:"text-gray mb-2"},im={class:"mt-4"},Vm={class:"table align-middle gray-table side-table"},pm={class:"mt-4"},fm={class:"table align-middle gray-table side-table"},Nm={key:0,class:"table-responsive mt-3 mb-0"},Em={class:"table align-middle gray-table"},um={key:0},bm={key:0},km={class:"d-flex gap-2"},gm=["onClick"],ym={class:"mt-4"},xm={class:"table align-middle gray-table side-table"},Bm={key:0,class:"block-bottom bg-light-teal"},hm={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.ref(),p=e.computed(()=>z("literacy",a.value.Status,1)),r=e.ref({}),l=e.ref([]),n=e.computed(()=>E.value.filter(b=>!b.Deleted)),a=e.ref({}),E=e.ref([]),V=e.computed({get:()=>!!n.value.length,set:b=>{b?g():E.value.forEach(c=>c.Deleted=!0)}}),g=()=>E.value.push({}),w=T,D=()=>{M.literacy("getApplication",{ID:h.id}).subscribe(b=>{a.value=b.Project,N.value=b.Contacts,E.value=b.PreviousStudies,P().init("literacy",a.value),s.value=a.value.changeApply,a.value.changeApply=void 0})},f=b=>b.Deleted=!0,o=b=>{var d,i;if(r.value={},b&&!y()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const c={Project:a.value,Contacts:N.value,PreviousStudies:E.value.filter(t=>t.ID||!t.Deleted),Before:(d=s.value)==null?void 0:d.Form1Before,After:(i=s.value)==null?void 0:i.Form1After,Submit:b?"true":"false"};M.literacy("saveApplication",c).subscribe(t=>{b?w("next",t.ID):a.value.ID?D():window.location.href=`Application.aspx?ID=${t.ID}`})},y=()=>{let b={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return r.value=O(a.value,b),b={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((c,d)=>Object.assign(r.value,O(c,b,`contact-${d}-`))),b={Title:"研習/課程名稱",TheDate:"辦理日期"},E.value.forEach((c,d)=>Object.assign(r.value,O(c,b,`study-${d}-`))),s.value&&(b={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(r.value,O(s.value,b))),!Object.keys(r.value).length};return e.onMounted(()=>{rxjs.forkJoin([M.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(b=>{l.value=b[0],h.id?D():M.literacy("getEmptyApplication").subscribe(c=>{a.value=Object.assign({Field:null,FormStep:1,Status:1},c),N.value=[{Role:"申請人"}],P().init("literacy",a.value)})})}),e.provide("editable",p),e.watch(()=>[a.value.Field,a.value.OrgName],()=>{var b;if(p.value){const c=[];a.value.Field&&c.push((b=l.value.find(d=>d.Code===a.value.Field))==null?void 0:b.Descname),a.value.OrgName&&c.push(a.value.OrgName),a.value.ProjectName=c.join("-")}}),(b,c)=>{const d=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),m=e.resolveComponent("input-textarea"),u=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Js,[c[40]||(c[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Qs,[e.createElementVNode("table",Ws,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[14]||(c[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).Year),1)]),e.createElementVNode("tr",null,[c[15]||(c[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(a).ProjectID?(e.openBlock(),e.createElementBlock("span",Ys,e.toDisplayString(e.unref(a).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Hs,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[c[16]||(c[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[17]||(c[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{disabled:"",modelValue:e.unref(a).ProjectName,"onUpdate:modelValue":c[0]||(c[0]=C=>e.unref(a).ProjectName=C),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[18]||(c[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(r).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(a).Field,"onUpdate:modelValue":c[1]||(c[1]=C=>e.unref(a).Field=C)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[19]||(c[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(a).OrgName,"onUpdate:modelValue":c[2]||(c[2]=C=>e.unref(a).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[20]||(c[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).OrgLeader,modelValue:e.unref(a).OrgLeader,"onUpdate:modelValue":c[3]||(c[3]=C=>e.unref(a).OrgLeader=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[21]||(c[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Address,placeholder:"請輸入地址",modelValue:e.unref(a).Address,"onUpdate:modelValue":c[4]||(c[4]=C=>e.unref(a).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),c[41]||(c[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Zs,[e.createElementVNode("table",Ks,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(C,F)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Xs,[e.createElementVNode("div",vs,[e.createElementVNode("div",em,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[22]||(c[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(r)[`contact-${F}-Name`],modelValue:C.Name,"onUpdate:modelValue":U=>C.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",tm,[e.createElementVNode("div",lm,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[23]||(c[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(r)[`contact-${F}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":U=>C.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",om,[c[24]||(c[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",nm,[e.createElementVNode("div",rm,[e.createVNode(i,{modelValue:C.Phone,"onUpdate:modelValue":U=>C.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",am,[e.createVNode(i,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":U=>C.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",dm,[e.createElementVNode("div",sm,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[25]||(c[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(r)[`contact-${F}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":U=>C.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",mm,[e.createElementVNode("div",cm,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[26]||(c[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(i,{error:e.unref(r)[`contact-${F}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":U=>C.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),c[42]||(c[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",im,[e.createElementVNode("table",Vm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[27]||(c[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[c[28]||(c[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(m,{error:e.unref(r).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(a).Target,"onUpdate:modelValue":c[5]||(c[5]=C=>e.unref(a).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[29]||(c[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(r).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(a).Summary,"onUpdate:modelValue":c[6]||(c[6]=C=>e.unref(a).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[30]||(c[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(r).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Quantified,"onUpdate:modelValue":c[7]||(c[7]=C=>e.unref(a).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[31]||(c[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(r).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(a).Qualitative,"onUpdate:modelValue":c[8]||(c[8]=C=>e.unref(a).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",pm,[e.createElementVNode("table",fm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[36]||(c[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(u,{modelValue:e.unref(V),"onUpdate:modelValue":c[9]||(c[9]=C=>e.isRef(V)?V.value=C:null)},null,8,["modelValue"]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Nm,[e.createElementVNode("table",Em,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[c[32]||(c[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),c[33]||(c[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",um,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(C,F)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r)[`study-${F}-Title`],modelValue:C.Title,"onUpdate:modelValue":U=>C.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(r)[`study-${F}-TheDate`],modelValue:C.TheDate,"onUpdate:modelValue":U=>C.TheDate=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",bm,[e.createElementVNode("div",km,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>f(C),type:"button"},[...c[34]||(c[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,gm)):e.createCommentVNode("",!0),F+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...c[35]||(c[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[c[39]||(c[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ym,[e.createElementVNode("table",xm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[37]||(c[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(r).Form1Before,rows:"4",modelValue:e.unref(s).Form1Before,"onUpdate:modelValue":c[10]||(c[10]=C=>e.unref(s).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...c[38]||(c[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(r).Form1After,rows:"4",modelValue:e.unref(s).Form1After,"onUpdate:modelValue":c[11]||(c[11]=C=>e.unref(s).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",Bm,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:c[12]||(c[12]=C=>o()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:c[13]||(c[13]=C=>o(!0)),type:"button"},[...c[43]||(c[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},$m={class:"block"},Cm={key:0,class:"text-pink lh-base mt-4"},Tm={class:"mt-4"},_m={class:"table align-middle gray-table"},wm={class:"text-center"},Dm={key:0,width:"180"},Sm={class:"text-center"},Fm={key:0},Am=["innerHTML"],Um=["href"],Mm={key:0,class:"text-center"},Om={key:0},jm={key:1,class:"text-pink"},Im={key:1,class:"tag-group mt-2 gap-1"},Pm={key:0,class:"tag tag-green-light"},qm=["download","href"],Lm=["onClick"],Rm={class:"mt-4"},zm={class:"table align-middle gray-table side-table"},Gm={key:0,class:"block-bottom bg-light-teal"},Jm=["disabled"],Qm={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([{Type:1,Title:"申請表",Template:"../../Template/LIT/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/LIT/2-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/LIT/3-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/LIT/4-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"著作權授權同意書",Template:"../../Template/LIT/5-著作權授權同意書.docx",Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),s=e.ref(),p=e.computed(()=>N.value.some(f=>!f.Optional&&!f.Files.filter(o=>!o.Deleted).length)),r=e.computed(()=>z("literacy",n.value.Status,2)),l=e.ref({}),n=e.ref({}),a=(f,o)=>{o.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:o.Path,Name:n.value.ProjectID+"_"+(f.Multiple?o.Name:`${f.Title}.pdf`)})},E=M.download,V=T,g=()=>{rxjs.forkJoin([M.literacy("getAttachment",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=N.value.filter(y=>{var b;return!((b=y.Excludes)!=null&&b.includes(n.value.OrgCategory))}),N.value.forEach(y=>{y.Files=o.Attachments.filter(b=>b.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(b=>!b.Deleted).length)}),P().init("literacy",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},w=f=>{var y,b;if(l.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Attachments:N.value.reduce((c,d)=>c.concat(d.Files),[]),Before:(y=s.value)==null?void 0:y.Form5Before,After:(b=s.value)==null?void 0:b.Form5After,Submit:f?"true":"false"};M.literacy("saveAttachment",o).subscribe(()=>{f?V("next"):g()})},D=()=>{if(s.value){const f={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,O(s.value,f))}return!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",r),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-file"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$m,[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",Cm,[...o[4]||(o[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Tm,[e.createElementVNode("table",_m,[e.createElementVNode("thead",wm,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Dm,"狀態")):e.createCommentVNode("",!0),o[7]||(o[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",Sm,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",Fm,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(r)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Am)):e.createCommentVNode("",!0),e.unref(r)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:d.Template,style:{width:"140px"},type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Um)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Mm,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",Om,"已上傳")):(e.openBlock(),e.createElementBlock("span",jm,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(b,{key:0,accept:".pdf",onFile:t=>a(d,t)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",Im,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Pm,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,qm),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>t.Deleted=!0,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Lm)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o[12]||(o[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Rm,[e.createElementVNode("table",zm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(s).Form5Before,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(s).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(s).Form5After,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Gm,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=d=>w(!0)),disabled:e.unref(p),type:"button"},[...o[14]||(o[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Jm)])):e.createCommentVNode("",!0)],64)}}},Wm={class:"block"},Ym={class:"mt-4"},Hm={class:"table-responsive mt-3 mb-0"},Zm={class:"table align-middle gray-table"},Km={key:0,width:"1"},Xm={key:0},vm={class:"d-flex gap-2"},ec=["onClick"],tc={class:"table-responsive mt-3 mb-0"},lc={class:"table align-middle gray-table"},oc={class:"mt-4"},nc={class:"table align-middle gray-table side-table"},rc={key:0,class:"block-bottom bg-light-teal"},ac={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.computed(()=>z("literacy",n.value.Status,4)),r=e.ref({}),l=e.computed(()=>N.value.filter(f=>!f.Deleted)),n=e.ref({}),a=()=>N.value.push({}),E=T,V=()=>{rxjs.forkJoin([M.literacy("getBenefit",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=o.Benefits,N.value.length||a(),P().init("literacy",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},g=f=>f.Deleted=!0,w=f=>{var y,b;if(r.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:n.value,Benefits:N.value,Before:(y=s.value)==null?void 0:y.Form4Before,After:(b=s.value)==null?void 0:b.Form4After,Submit:f?"true":"false"};M.literacy("saveBenefit",o).subscribe(()=>{f?E("next"):V()})},D=()=>{let f={Benefit:"不可量化成果"};return r.value=O(n.value,f),f={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((o,y)=>Object.assign(r.value,O(o,f,`item-${y}-`))),s.value&&(f={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,O(s.value,f))),!Object.keys(r.value).length};return e.onMounted(V),e.provide("editable",p),(f,o)=>{const y=e.resolveComponent("input-text"),b=e.resolveComponent("input-textarea"),c=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Wm,[o[14]||(o[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",Ym,[e.createElementVNode("div",Hm,[e.createElementVNode("table",Zm,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"目標值",-1)),o[7]||(o[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",Km,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Title`],modelValue:d.Title,"onUpdate:modelValue":t=>d.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Target`],modelValue:d.Target,"onUpdate:modelValue":t=>d.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r)[`item-${i}-Description`],rows:"1",modelValue:d.Description,"onUpdate:modelValue":t=>d.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",Xm,[e.createElementVNode("div",vm,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>g(d),type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ec)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",tc,[e.createElementVNode("table",lc,[o[10]||(o[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(n).Benefit,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(n).Benefit=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",oc,[e.createElementVNode("table",nc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(s).Form4Before,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form4Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(s).Form4After,"onUpdate:modelValue":o[2]||(o[2]=d=>e.unref(s).Form4After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",rc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[3]||(o[3]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[4]||(o[4]=d=>w(!0)),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},dc={class:"block"},sc={class:"mt-4"},mc={class:"table-responsive mt-3 mb-0"},cc={class:"table align-middle gray-table"},ic={class:"text-end"},Vc={class:"text-end"},pc={class:"table-responsive"},fc={class:"table align-middle gray-table"},Nc=["colspan"],Ec={key:0,width:"1"},uc={class:"text-end"},bc={key:0},kc={class:"d-flex gap-2"},gc=["onClick"],yc={class:"mt-4"},xc={class:"table-responsive mt-3 mb-0"},Bc={class:"table align-middle gray-table"},hc={key:0,width:"1"},$c={class:"text-end"},Cc={key:0},Tc={class:"d-flex gap-2"},_c=["onClick"],wc={class:"mt-4"},Dc={class:"table align-middle gray-table side-table"},Sc={key:0,class:"block-bottom bg-light-teal"},Fc={class:"text-center"},Ac={class:"mb-5"},Uc={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("literacy",n.value.Status,3)),p=e.ref({}),r=e.computed(()=>E.value.filter(i=>!i.Deleted)),l=e.computed(()=>V.value.filter(i=>!i.Deleted)),n=e.ref({}),a=e.ref(),E=e.ref([]),V=e.ref([]),g=e.ref({}),w=e.ref(0),D=()=>E.value.push({}),f=()=>V.value.push({}),o=T,y=()=>{rxjs.forkJoin([M.literacy("getFunding",{ID:h.id})]).subscribe(i=>{const t=i[0];n.value=t.Project,E.value=t.OtherSubsidies,V.value=t.BudgetPlans,g.value=t.GrantTargetSetting,E.value.length||D(),V.value.length||f(),P().init("literacy",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=(i,t)=>{var u,A;if(p.value={},i&&!d()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&n.value.ApplyAmount>g.value.GrantLimit*1e4){a.value.show(()=>c(i,!0));return}const m={Project:n.value,OtherSubsidies:E.value,BudgetPlans:V.value,Before:(u=N.value)==null?void 0:u.Form3Before,After:(A=N.value)==null?void 0:A.Form3After,Submit:i?"true":"false"};M.literacy("saveFunding",m).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return p.value=O(n.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},E.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`other-${m}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},V.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`plan-${m}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(p.value,O(N.value,i))),!Object.keys(p.value).length};return e.onMounted(y),e.provide("editable",s),e.watchEffect(()=>{n.value.OtherAmount=r.value.reduce((i,t)=>i+R(t.Amount),0),w.value=R(n.value.ApplyAmount)+R(n.value.SelfAmount)+R(n.value.OtherAmount),r.value.forEach(i=>i.percent=Math.round(R(i.Amount)/n.value.OtherAmount*1e4)/100),V.value.forEach(i=>i.sum=R(i.Amount)+R(i.OtherAmount))}),(i,t)=>{var U;const m=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),F=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",dc,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",sc,[e.createElementVNode("div",mc,[e.createElementVNode("table",cc,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).ApplyAmount,modelValue:e.unref(n).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=S=>e.unref(n).ApplyAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).SelfAmount,modelValue:e.unref(n).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=S=>e.unref(n).SelfAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",ic,e.toDisplayString((U=e.unref(n).OtherAmount)==null?void 0:U.toLocaleString()),1),e.createElementVNode("td",Vc,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",pc,[e.createElementVNode("table",fc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(s)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Nc)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",Ec,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,e.toDisplayString(k+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`other-${k}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":B=>S.Unit=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`other-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",uc,e.toDisplayString(S.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`other-${k}-Content`],rows:"1",modelValue:S.Content,"onUpdate:modelValue":B=>S.Content=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",bc,[e.createElementVNode("div",kc,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,gc)):e.createCommentVNode("",!0),k+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",yc,[e.createElementVNode("div",xc,[e.createElementVNode("table",Bc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",hc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`plan-${k}-Title`],modelValue:S.Title,"onUpdate:modelValue":B=>S.Title=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-OtherAmount`],modelValue:S.OtherAmount,"onUpdate:modelValue":B=>S.OtherAmount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",$c,e.toDisplayString(S.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`plan-${k}-Description`],rows:"1",modelValue:S.Description,"onUpdate:modelValue":B=>S.Description=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",Cc,[e.createElementVNode("div",Tc,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_c)):e.createCommentVNode("",!0),k+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",wc,[e.createElementVNode("table",Dc,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=S=>e.unref(N).Form3Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=S=>e.unref(N).Form3After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",Sc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=S=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=S=>c(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(F,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",Fc,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Ac,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(g).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Mc={__name:"ProgressBar",setup(x){const T=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(h,N)=>{const s=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(s,{steps:T,type:"literacy"})}}},Oc={class:"block"},jc={class:"mt-4"},Ic={class:"table align-middle gray-table side-table"},Pc={key:0,class:"d-flex align-items-center gap-2"},qc={class:"input-group w-auto"},Lc={class:"text-teal-dark"},Rc={key:1,class:"invalid mt-0"},zc={class:"table-responsive mt-4"},Gc={class:"table align-middle gray-table"},Jc={key:0},Qc={class:"input-group"},Wc={key:0,class:"invalid mt-0"},Yc={key:0},Hc={class:"d-flex gap-2"},Zc=["onClick"],Kc={class:"mt-4"},Xc={class:"table align-middle gray-table"},vc={key:0},ei={key:0},ti={class:"d-flex gap-2"},li=["onClick"],oi={class:"mt-4"},ni={class:"table align-middle gray-table side-table"},ri={key:0,class:"block-bottom bg-light-teal"},ai={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=[{value:1,text:"50%"},{value:2,text:"100%"}],s=e.ref(),p=e.computed(()=>V.value.EndDate),r=e.computed(()=>z("literacy",E.value.Status,2)),l=e.ref({}),n=e.computed(()=>g.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),E=e.ref({}),V=e.ref({}),g=e.ref([]),w=e.ref([]),D=()=>M.literacy("createItem",{ID:h.id}).subscribe(i=>g.value.push(i)),f=()=>w.value.push({Type:0,ItemID:0}),o=T,y=()=>{rxjs.forkJoin([M.literacy("getWorkSchedule",{ID:h.id})]).subscribe(i=>{const t=i[0];E.value=t.Project,V.value=t.GrantType,g.value=t.Items,w.value=t.Schedules,g.value.length||D(),w.value.length||f(),P().init("literacy",E.value),s.value=E.value.changeApply,E.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=i=>{var m,u;if(l.value={},i&&!d()){e.nextTick(()=>{var A;return(A=document.querySelector(".invalid"))==null?void 0:A.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:E.value,Items:g.value,Schedules:w.value,Before:(m=s.value)==null?void 0:m.Form2Before,After:(u=s.value)==null?void 0:u.Form2After,Submit:i?"true":"false"};M.literacy("saveWorkSchedule",t).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=O(E.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},n.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`item-${m}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`schedule-${m}-`))),s.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,O(s.value,i))),!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",r),(i,t)=>{const m=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),A=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),F=e.resolveComponent("input-month"),U=e.resolveComponent("input-textarea"),S=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Oc,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",jc,[e.createElementVNode("table",Ic,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(p)?(e.openBlock(),e.createElementBlock("div",Pc,[e.createElementVNode("div",qc,[e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).StartTime,"onUpdate:modelValue":t[0]||(t[0]=k=>e.unref(E).StartTime=k)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).EndTime,"onUpdate:modelValue":t[1]||(t[1]=k=>e.unref(E).EndTime=k)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Lc,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(A,{value:e.unref(p)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",Rc,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",zc,[e.createElementVNode("table",Gc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Jc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+B)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${B}-Title`],modelValue:k.Title,"onUpdate:modelValue":_=>k.Title=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Qc,[e.createVNode(F,{"empty-value":0,modelValue:k.Begin,"onUpdate:modelValue":_=>k.Begin=_},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(F,{"empty-value":0,modelValue:k.End,"onUpdate:modelValue":_=>k.End=_},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]?(e.openBlock(),e.createElementBlock("div",Wc,e.toDisplayString(e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`item-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`item-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Yc,[e.createElementVNode("div",Hc,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Zc)):e.createCommentVNode("",!0),B+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Kc,[e.createElementVNode("table",Xc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",vc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-Type`],options:N,modelValue:k.Type,"onUpdate:modelValue":_=>k.Type=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-ItemID`],options:e.unref(n),"text-name":"Title","value-name":"ID",modelValue:k.ItemID,"onUpdate:modelValue":_=>k.ItemID=_,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(k.ItemID?String.fromCharCode(65+e.unref(n).findIndex(_=>_.ID===k.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`schedule-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`schedule-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",ei,[e.createElementVNode("div",ti,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,li)):e.createCommentVNode("",!0),B+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",oi,[e.createElementVNode("table",ni,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(s).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=k=>e.unref(s).Form2Before=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(s).Form2After,"onUpdate:modelValue":t[3]||(t[3]=k=>e.unref(s).Form2After=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",ri,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=k=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=k=>c(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},di={class:"block"},si={class:"mt-4"},mi={class:"table align-middle gray-table side-table"},ci={key:0},ii={key:1,class:"text-light-gray"},Vi={class:"mt-4"},pi={class:"table align-middle gray-table side-table"},fi={class:"row g-3"},Ni={class:"col-12 col-xl-2"},Ei={class:"text-gray mb-2"},ui={class:"col-12 col-xl-3"},bi={class:"text-gray mb-2"},ki={class:"col-12 col-xl-4"},gi={class:"row g-1"},yi={class:"col-7"},xi={class:"col-5"},Bi={class:"col-12 col-xl-3"},hi={class:"text-gray mb-2"},$i={class:"col-12"},Ci={class:"text-gray mb-2"},Ti={class:"mt-4"},_i={class:"table align-middle gray-table side-table"},wi={class:"mt-4"},Di={class:"table align-middle gray-table side-table"},Si={key:0,class:"table-responsive mt-3 mb-0"},Fi={class:"table align-middle gray-table"},Ai={key:0},Ui={key:0},Mi={class:"d-flex gap-2"},Oi=["onClick"],ji={class:"mt-4"},Ii={class:"table align-middle gray-table side-table"},Pi={key:0,class:"block-bottom bg-light-teal"},qi={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.ref(),r=e.computed(()=>z("multiple",E.value.Status,1)),l=e.ref({}),n=e.ref([]),a=e.computed(()=>V.value.filter(c=>!c.Deleted)),E=e.ref({}),V=e.ref([]),g=e.computed({get:()=>!!a.value.length,set:c=>{c?w():V.value.forEach(d=>d.Deleted=!0)}}),w=()=>V.value.push({}),D=T,f=()=>{M.multiple("getApplication",{ID:h.id}).subscribe(c=>{E.value=c.Project,p.value=c.Contacts,V.value=c.ReceivedSubsidies,E.value.OrgCategory=E.value.OrgCategory||null,P().init("multiple",E.value),s.value=E.value.changeApply,E.value.changeApply=void 0})},o=c=>c.Deleted=!0,y=c=>{var i,t;if(l.value={},c&&!b()){e.nextTick(()=>{var m;return(m=document.querySelector(".invalid"))==null?void 0:m.scrollIntoView({behavior:"smooth",block:"center"})});return}const d={Project:E.value,Contacts:p.value,ReceivedSubsidies:V.value.filter(m=>m.ID||!m.Deleted),Before:(i=s.value)==null?void 0:i.Form1Before,After:(t=s.value)==null?void 0:t.Form1After,Submit:c?"true":"false"};M.multiple("saveApplication",d).subscribe(m=>{c?D("next",m.ID):E.value.ID?f():window.location.href=`Application.aspx?ID=${m.ID}`})},b=()=>{let c={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return l.value=O(E.value,c),c={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},p.value.forEach((d,i)=>Object.assign(l.value,O(d,c,`contact-${i}-`))),c={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},V.value.forEach((d,i)=>Object.assign(l.value,O(d,c,`received-${i}-`))),s.value&&(c={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,O(s.value,c))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([M.multiple("getZgsCodes",{CodeGroup:"MULField"}),M.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(c=>{n.value=c[0],N.value=c[1],h.id?f():M.multiple("getEmptyApplication").subscribe(d=>{E.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},d),p.value=[{Role:"負責人"},{Role:"聯絡人"}],P().init("multiple",E.value)})})}),e.provide("editable",r),(c,d)=>{const i=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),m=e.resolveComponent("input-select"),u=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-boolean"),C=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",di,[d[43]||(d[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",si,[e.createElementVNode("table",mi,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[15]||(d[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[d[16]||(d[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",ci,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",ii,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[d[17]||(d[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[18]||(d[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":d[0]||(d[0]=F=>e.unref(E).ProjectName=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[19]||(d[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{"empty-value":null,error:e.unref(l).Field,options:e.unref(n),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).Field,"onUpdate:modelValue":d[1]||(d[1]=F=>e.unref(E).Field=F)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[20]||(d[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":d[2]||(d[2]=F=>e.unref(E).OrgName=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[21]||(d[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(m,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(N),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":d[3]||(d[3]=F=>e.unref(E).OrgCategory=F)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[22]||(d[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":d[4]||(d[4]=F=>e.unref(E).TaxID=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[23]||(d[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":d[5]||(d[5]=F=>e.unref(E).Address=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),d[44]||(d[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Vi,[e.createElementVNode("table",pi,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(p),(F,U)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(F.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",fi,[e.createElementVNode("div",Ni,[e.createElementVNode("div",Ei,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[24]||(d[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${U}-Name`],modelValue:F.Name,"onUpdate:modelValue":S=>F.Name=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ui,[e.createElementVNode("div",bi,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[25]||(d[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${U}-JobTitle`],modelValue:F.JobTitle,"onUpdate:modelValue":S=>F.JobTitle=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ki,[d[26]||(d[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",gi,[e.createElementVNode("div",yi,[e.createVNode(t,{modelValue:F.Phone,"onUpdate:modelValue":S=>F.Phone=S,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",xi,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:F.PhoneExt,"onUpdate:modelValue":S=>F.PhoneExt=S,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Bi,[e.createElementVNode("div",hi,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[27]||(d[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${U}-MobilePhone`],modelValue:F.MobilePhone,"onUpdate:modelValue":S=>F.MobilePhone=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",$i,[e.createElementVNode("div",Ci,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[28]||(d[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(l)[`contact-${U}-EMail`],modelValue:F.EMail,"onUpdate:modelValue":S=>F.EMail=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),d[45]||(d[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Ti,[e.createElementVNode("table",_i,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[29]||(d[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[d[30]||(d[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(u,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(E).Target,"onUpdate:modelValue":d[6]||(d[6]=F=>e.unref(E).Target=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[31]||(d[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":d[7]||(d[7]=F=>e.unref(E).Summary=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[32]||(d[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":d[8]||(d[8]=F=>e.unref(E).Quantified=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[33]||(d[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Qualitative,"onUpdate:modelValue":d[9]||(d[9]=F=>e.unref(E).Qualitative=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",wi,[e.createElementVNode("table",Di,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[39]||(d[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(A,{modelValue:e.unref(g),"onUpdate:modelValue":d[10]||(d[10]=F=>e.isRef(g)?g.value=F:null)},null,8,["modelValue"]),e.unref(g)?(e.openBlock(),e.createElementBlock("div",Si,[e.createElementVNode("table",Fi,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[d[34]||(d[34]=e.createElementVNode("th",null,"計畫名稱",-1)),d[35]||(d[35]=e.createElementVNode("th",null,"補助單位",-1)),d[36]||(d[36]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Ai,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(F,U)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l)[`received-${U}-Name`],modelValue:F.Name,"onUpdate:modelValue":S=>F.Name=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(l)[`received-${U}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":S=>F.Unit=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`received-${U}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":S=>F.Amount=S},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Ui,[e.createElementVNode("div",Mi,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:S=>o(F),type:"button"},[...d[37]||(d[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Oi)):e.createCommentVNode("",!0),U+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:w,type:"button"},[...d[38]||(d[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[d[42]||(d[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ji,[e.createElementVNode("table",Ii,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[40]||(d[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(s).Form1Before,"onUpdate:modelValue":d[11]||(d[11]=F=>e.unref(s).Form1Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(i,null,{default:e.withCtx(()=>[...d[41]||(d[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(s).Form1After,"onUpdate:modelValue":d[12]||(d[12]=F=>e.unref(s).Form1After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Pi,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:d[13]||(d[13]=F=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:d[14]||(d[14]=F=>y(!0)),type:"button"},[...d[46]||(d[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Li={class:"block"},Ri={key:0,class:"text-pink lh-base mt-4"},zi={class:"mt-4"},Gi={class:"table align-middle gray-table"},Ji={class:"text-center"},Qi={key:0,width:"180"},Wi={class:"text-center"},Yi={key:0},Hi=["innerHTML"],Zi=["href"],Ki={key:0,class:"text-center"},Xi={key:0},vi={key:1,class:"text-pink"},eV={key:1,class:"tag-group mt-2 gap-1"},tV={key:0,class:"tag tag-green-light"},lV=["download","href"],oV=["onClick"],nV={class:"mt-4"},rV={class:"table align-middle gray-table side-table"},aV={key:0,class:"block-bottom bg-light-teal"},dV=["disabled"],sV={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([{Type:1,Title:"申請表",Template:"../../Template/MUL/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/MUL/2-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/MUL/3-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/MUL/4-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),s=e.ref(),p=e.computed(()=>N.value.some(f=>!f.Optional&&!f.Files.filter(o=>!o.Deleted).length)),r=e.computed(()=>z("multiple",n.value.Status,2)),l=e.ref({}),n=e.ref({}),a=(f,o)=>{o.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:o.Path,Name:n.value.ProjectID+"_"+(f.Multiple?o.Name:`${f.Title}.pdf`)})},E=M.download,V=T,g=()=>{rxjs.forkJoin([M.multiple("getAttachment",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=N.value.filter(y=>{var b;return!((b=y.Excludes)!=null&&b.includes(n.value.OrgCategory))}),n.value.Status>=42&&N.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),N.value.forEach(y=>{y.Files=o.Attachments.filter(b=>b.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(b=>!b.Deleted).length)}),P().init("multiple",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},w=f=>{var y,b;if(l.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={ID:h.id,Attachments:N.value.reduce((c,d)=>c.concat(d.Files),[]),Before:(y=s.value)==null?void 0:y.Form5Before,After:(b=s.value)==null?void 0:b.Form5After,Submit:f?"true":"false"};M.multiple("saveAttachment",o).subscribe(()=>{f?V("next"):g()})},D=()=>{if(s.value){const f={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,O(s.value,f))}return!Object.keys(l.value).length};return e.onMounted(g),e.provide("editable",r),(f,o)=>{const y=e.resolveComponent("required-label"),b=e.resolveComponent("input-file"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Li,[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",Ri,[...o[4]||(o[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",zi,[e.createElementVNode("table",Gi,[e.createElementVNode("thead",Ji,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Qi,"狀態")):e.createCommentVNode("",!0),o[7]||(o[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",Wi,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",Yi,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(r)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Hi)):e.createCommentVNode("",!0),e.unref(r)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:d.Template,style:{width:"140px"},type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Zi)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Ki,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",Xi,"已上傳")):(e.openBlock(),e.createElementBlock("span",vi,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(b,{key:0,accept:".pdf",onFile:t=>a(d,t)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",eV,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",tV,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,lV),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:m=>t.Deleted=!0,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,oV)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o[12]||(o[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",nV,[e.createElementVNode("table",rV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(s).Form5Before,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(s).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(s).Form5After,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",aV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[2]||(o[2]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[3]||(o[3]=d=>w(!0)),disabled:e.unref(p),type:"button"},[...o[14]||(o[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,dV)])):e.createCommentVNode("",!0)],64)}}},mV={class:"block"},cV={class:"mt-4"},iV={class:"table-responsive mt-3 mb-0"},VV={class:"table align-middle gray-table"},pV={key:0,width:"1"},fV={key:0},NV={class:"d-flex gap-2"},EV=["onClick"],uV={class:"table-responsive mt-3 mb-0"},bV={class:"table align-middle gray-table"},kV={class:"mt-4"},gV={class:"table align-middle gray-table side-table"},yV={key:0,class:"block-bottom bg-light-teal"},xV={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref([]),s=e.ref(),p=e.computed(()=>z("multiple",n.value.Status,4)),r=e.ref({}),l=e.computed(()=>N.value.filter(f=>!f.Deleted)),n=e.ref({}),a=()=>N.value.push({}),E=T,V=()=>{rxjs.forkJoin([M.multiple("getBenefit",{ID:h.id})]).subscribe(f=>{const o=f[0];n.value=o.Project,N.value=o.Benefits,N.value.length||a(),P().init("multiple",n.value),s.value=n.value.changeApply,n.value.changeApply=void 0})},g=f=>f.Deleted=!0,w=f=>{var y,b;if(r.value={},f&&!D()){e.nextTick(()=>{var c;return(c=document.querySelector(".invalid"))==null?void 0:c.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:n.value,Benefits:N.value,Before:(y=s.value)==null?void 0:y.Form4Before,After:(b=s.value)==null?void 0:b.Form4After,Submit:f?"true":"false"};M.multiple("saveBenefit",o).subscribe(()=>{f?E("next"):V()})},D=()=>{let f={Benefit:"不可量化成果"};return r.value=O(n.value,f),f={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((o,y)=>Object.assign(r.value,O(o,f,`item-${y}-`))),s.value&&(f={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,O(s.value,f))),!Object.keys(r.value).length};return e.onMounted(V),e.provide("editable",p),(f,o)=>{const y=e.resolveComponent("input-text"),b=e.resolveComponent("input-textarea"),c=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",mV,[o[14]||(o[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",cV,[e.createElementVNode("div",iV,[e.createElementVNode("table",VV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[5]||(o[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),o[6]||(o[6]=e.createElementVNode("th",null,"目標值",-1)),o[7]||(o[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(p)?(e.openBlock(),e.createElementBlock("th",pV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(d,i)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Title`],modelValue:d.Title,"onUpdate:modelValue":t=>d.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${i}-Target`],modelValue:d.Target,"onUpdate:modelValue":t=>d.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r)[`item-${i}-Description`],rows:"1",modelValue:d.Description,"onUpdate:modelValue":t=>d.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(p)?(e.openBlock(),e.createElementBlock("td",fV,[e.createElementVNode("div",NV,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>g(d),type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,EV)):e.createCommentVNode("",!0),i+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...o[9]||(o[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",uV,[e.createElementVNode("table",bV,[o[10]||(o[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(n).Benefit,"onUpdate:modelValue":o[0]||(o[0]=d=>e.unref(n).Benefit=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[13]||(o[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",kV,[e.createElementVNode("table",gV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(s).Form4Before,"onUpdate:modelValue":o[1]||(o[1]=d=>e.unref(s).Form4Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(s).Form4After,"onUpdate:modelValue":o[2]||(o[2]=d=>e.unref(s).Form4After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",yV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[3]||(o[3]=d=>w()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[4]||(o[4]=d=>w(!0)),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},BV={class:"block"},hV={class:"mt-4"},$V={class:"table-responsive mt-3 mb-0"},CV={class:"table align-middle gray-table"},TV={class:"text-end"},_V={class:"text-end"},wV={class:"table-responsive"},DV={class:"table align-middle gray-table"},SV=["colspan"],FV={key:0,width:"1"},AV={class:"text-end"},UV={key:0},MV={class:"d-flex gap-2"},OV=["onClick"],jV={class:"mt-4"},IV={class:"table-responsive mt-3 mb-0"},PV={class:"table align-middle gray-table"},qV={key:0,width:"1"},LV={class:"text-end"},RV={key:0},zV={class:"d-flex gap-2"},GV=["onClick"],JV={class:"mt-4"},QV={class:"table align-middle gray-table side-table"},WV={key:0,class:"block-bottom bg-light-teal"},YV={class:"text-center"},HV={class:"mb-5"},ZV={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=e.ref(),s=e.computed(()=>z("multiple",n.value.Status,3)),p=e.ref({}),r=e.computed(()=>E.value.filter(i=>!i.Deleted)),l=e.computed(()=>V.value.filter(i=>!i.Deleted)),n=e.ref({}),a=e.ref(),E=e.ref([]),V=e.ref([]),g=e.ref({}),w=e.ref(0),D=()=>E.value.push({}),f=()=>V.value.push({}),o=T,y=()=>{rxjs.forkJoin([M.multiple("getFunding",{ID:h.id})]).subscribe(i=>{const t=i[0];n.value=t.Project,E.value=t.OtherSubsidies,V.value=t.BudgetPlans,g.value=t.GrantTargetSetting,E.value.length||D(),V.value.length||f(),P().init("multiple",n.value),N.value=n.value.changeApply,n.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=(i,t)=>{var u,A;if(p.value={},i&&!d()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&n.value.ApplyAmount>g.value.GrantLimit*1e4){a.value.show(()=>c(i,!0));return}const m={Project:n.value,OtherSubsidies:E.value,BudgetPlans:V.value,Before:(u=N.value)==null?void 0:u.Form3Before,After:(A=N.value)==null?void 0:A.Form3After,Submit:i?"true":"false"};M.multiple("saveFunding",m).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return p.value=O(n.value,i),i={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},E.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`other-${m}-`))),i={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},V.value.forEach((t,m)=>Object.assign(p.value,O(t,i,`plan-${m}-`))),N.value&&(i={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(p.value,O(N.value,i))),!Object.keys(p.value).length};return e.onMounted(y),e.provide("editable",s),e.watchEffect(()=>{n.value.OtherAmount=r.value.reduce((i,t)=>i+R(t.Amount),0),w.value=R(n.value.ApplyAmount)+R(n.value.SelfAmount)+R(n.value.OtherAmount),r.value.forEach(i=>i.percent=Math.round(R(i.Amount)/n.value.OtherAmount*1e4)/100),V.value.forEach(i=>i.sum=R(i.Amount)+R(i.OtherAmount))}),(i,t)=>{var U;const m=e.resolveComponent("input-integer"),u=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),C=e.resolveComponent("required-label"),F=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",BV,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",hV,[e.createElementVNode("div",$V,[e.createElementVNode("table",CV,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).ApplyAmount,modelValue:e.unref(n).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=S=>e.unref(n).ApplyAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p).SelfAmount,modelValue:e.unref(n).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=S=>e.unref(n).SelfAmount=S)},null,8,["error","modelValue"])]),e.createElementVNode("td",TV,e.toDisplayString((U=e.unref(n).OtherAmount)==null?void 0:U.toLocaleString()),1),e.createElementVNode("td",_V,e.toDisplayString(e.unref(w).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",wV,[e.createElementVNode("table",DV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(s)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,SV)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",FV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,e.toDisplayString(k+1),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`other-${k}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":B=>S.Unit=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`other-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",AV,e.toDisplayString(S.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`other-${k}-Content`],rows:"1",modelValue:S.Content,"onUpdate:modelValue":B=>S.Content=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",UV,[e.createElementVNode("div",MV,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,OV)):e.createCommentVNode("",!0),k+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",jV,[e.createElementVNode("div",IV,[e.createElementVNode("table",PV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(s)?(e.openBlock(),e.createElementBlock("th",qV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(S,k)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(p)[`plan-${k}-Title`],modelValue:S.Title,"onUpdate:modelValue":B=>S.Title=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":B=>S.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(m,{error:e.unref(p)[`plan-${k}-OtherAmount`],modelValue:S.OtherAmount,"onUpdate:modelValue":B=>S.OtherAmount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",LV,e.toDisplayString(S.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p)[`plan-${k}-Description`],rows:"1",modelValue:S.Description,"onUpdate:modelValue":B=>S.Description=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(s)?(e.openBlock(),e.createElementBlock("td",RV,[e.createElementVNode("div",zV,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>b(S),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,GV)):e.createCommentVNode("",!0),k+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",JV,[e.createElementVNode("table",QV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3Before,rows:"4",modelValue:e.unref(N).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=S=>e.unref(N).Form3Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(p).Form3After,rows:"4",modelValue:e.unref(N).Form3After,"onUpdate:modelValue":t[3]||(t[3]=S=>e.unref(N).Form3After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",WV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=S=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=S=>c(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(F,{ref_key:"modal",ref:a},{default:e.withCtx(()=>[e.createElementVNode("div",YV,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",HV,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(g).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},KV={__name:"ProgressBar",setup(x){const T=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(h,N)=>{const s=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(s,{steps:T,type:"multiple"})}}},XV={class:"block"},vV={class:"mt-4"},ep={class:"table align-middle gray-table side-table"},tp={key:0,class:"d-flex align-items-center gap-2"},lp={class:"input-group w-auto"},op={class:"text-teal-dark"},np={key:1,class:"invalid mt-0"},rp={class:"table-responsive mt-4"},ap={class:"table align-middle gray-table"},dp={key:0},sp={class:"input-group"},mp={key:0,class:"invalid mt-0"},cp={key:0},ip={class:"d-flex gap-2"},Vp=["onClick"],pp={class:"mt-4"},fp={class:"table align-middle gray-table"},Np={key:0},Ep={key:0},up={class:"d-flex gap-2"},bp=["onClick"],kp={class:"mt-4"},gp={class:"table align-middle gray-table side-table"},yp={key:0,class:"block-bottom bg-light-teal"},xp={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x,N=[{value:1,text:"50%"},{value:2,text:"100%"}],s=e.ref(),p=e.computed(()=>V.value.EndDate),r=e.computed(()=>z("multiple",E.value.Status,2)),l=e.ref({}),n=e.computed(()=>g.value.filter(i=>!i.Deleted)),a=e.computed(()=>w.value.filter(i=>!i.Deleted)),E=e.ref({}),V=e.ref({}),g=e.ref([]),w=e.ref([]),D=()=>M.multiple("createItem",{ID:h.id}).subscribe(i=>g.value.push(i)),f=()=>w.value.push({Type:0,ItemID:0}),o=T,y=()=>{rxjs.forkJoin([M.multiple("getWorkSchedule",{ID:h.id})]).subscribe(i=>{const t=i[0];E.value=t.Project,V.value=t.GrantType,g.value=t.Items,w.value=t.Schedules,g.value.length||D(),w.value.length||f(),P().init("multiple",E.value),s.value=E.value.changeApply,E.value.changeApply=void 0})},b=i=>i.Deleted=!0,c=i=>{var m,u;if(l.value={},i&&!d()){e.nextTick(()=>{var A;return(A=document.querySelector(".invalid"))==null?void 0:A.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:E.value,Items:g.value,Schedules:w.value,Before:(m=s.value)==null?void 0:m.Form2Before,After:(u=s.value)==null?void 0:u.Form2After,Submit:i?"true":"false"};M.multiple("saveWorkSchedule",t).subscribe(()=>{i?o("next"):y()})},d=()=>{let i={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=O(E.value,i),i={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},n.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`item-${m}-`))),i={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},a.value.forEach((t,m)=>Object.assign(l.value,O(t,i,`schedule-${m}-`))),s.value&&(i={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,O(s.value,i))),!Object.keys(l.value).length};return e.onMounted(y),e.provide("editable",r),(i,t)=>{const m=e.resolveComponent("required-label"),u=e.resolveComponent("input-tw-date"),A=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),F=e.resolveComponent("input-month"),U=e.resolveComponent("input-textarea"),S=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",XV,[t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",vV,[e.createElementVNode("table",ep,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(p)?(e.openBlock(),e.createElementBlock("div",tp,[e.createElementVNode("div",lp,[e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).StartTime,"onUpdate:modelValue":t[0]||(t[0]=k=>e.unref(E).StartTime=k)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(u,{class:"w-auto","max-date":e.unref(p),modelValue:e.unref(E).EndTime,"onUpdate:modelValue":t[1]||(t[1]=k=>e.unref(E).EndTime=k)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",op,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(A,{value:e.unref(p)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",np,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",rp,[e.createElementVNode("table",ap,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",dp,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+B)),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${B}-Title`],modelValue:k.Title,"onUpdate:modelValue":_=>k.Title=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",sp,[e.createVNode(F,{"empty-value":0,modelValue:k.Begin,"onUpdate:modelValue":_=>k.Begin=_},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(F,{"empty-value":0,modelValue:k.End,"onUpdate:modelValue":_=>k.End=_},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]?(e.openBlock(),e.createElementBlock("div",mp,e.toDisplayString(e.unref(l)[`item-${B}-Begin`]||e.unref(l)[`item-${B}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`item-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`item-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",cp,[e.createElementVNode("div",ip,[e.unref(n).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Vp)):e.createCommentVNode("",!0),B+1===e.unref(n).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:D,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[29]||(t[29]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",pp,[e.createElementVNode("table",fp,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),t[21]||(t[21]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Np,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(k,B)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-Type`],options:N,modelValue:k.Type,"onUpdate:modelValue":_=>k.Type=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(l)[`schedule-${B}-ItemID`],options:e.unref(n),"text-name":"Title","value-name":"ID",modelValue:k.ItemID,"onUpdate:modelValue":_=>k.ItemID=_,modelModifiers:{trim:!0}},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(k.ItemID?String.fromCharCode(65+e.unref(n).findIndex(_=>_.ID===k.ItemID)):""),1),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(l)[`schedule-${B}-Deadline`],modelValue:k.Deadline,"onUpdate:modelValue":_=>k.Deadline=_},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l)[`schedule-${B}-Content`],rows:"1",modelValue:k.Content,"onUpdate:modelValue":_=>k.Content=_,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Ep,[e.createElementVNode("div",up,[e.unref(a).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:_=>b(k),type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,bp)):e.createCommentVNode("",!0),B+1===e.unref(a).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:f,type:"button"},[...t[23]||(t[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(s)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",kp,[e.createElementVNode("table",gp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(s).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=k=>e.unref(s).Form2Before=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(m,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(U,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(s).Form2After,"onUpdate:modelValue":t[3]||(t[3]=k=>e.unref(s).Form2After=k),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",yp,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=k=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=k=>c(!0)),type:"button"},[...t[30]||(t[30]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Bp={key:0,class:"scroll-bottom-panel"},hp={class:"d-flex flex-column gap-3 mb-3"},$p={class:"d-flex gap-2"},Cp={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Tp={class:"text-nowrap my-2 d-flex align-items-center"},_p={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const T=x,h=P(),N=[{value:1,text:"通過"},{value:2,text:"退回修改"}],s=e.ref({}),p=e.ref({ID:T.id,Result:1}),r=()=>{const n={};if(p.value.Result>1&&(n.Reason="原因"),s.value=O(p.value,n),Object.keys(s.value).length){l();return}M[T.type]("reviewApplicationChange",p.value).subscribe(a=>{a&&(window.location.href="../ReviewChecklist.aspx?type=5")})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>p.value.Result,n=>{n>1&&l()}),(n,a)=>{const E=e.resolveComponent("input-radio-group"),V=e.resolveComponent("input-textarea");return e.unref(h)[x.type].organizer?(e.openBlock(),e.createElementBlock("div",Bp,[a[3]||(a[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",hp,[e.createElementVNode("li",$p,[a[2]||(a[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Cp,[e.createElementVNode("div",Tp,[e.createVNode(E,{options:N,modelValue:e.unref(p).Result,"onUpdate:modelValue":a[0]||(a[0]=g=>e.unref(p).Result=g)},null,8,["modelValue"])]),e.unref(p).Result>1?(e.openBlock(),e.createBlock(V,{key:0,error:e.unref(s).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(p).Reason,"onUpdate:modelValue":a[1]||(a[1]=g=>e.unref(p).Reason=g)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},wp={key:0,class:"scroll-bottom-panel"},Dp={class:"d-flex flex-column gap-3 mb-3"},Sp={class:"d-flex gap-2"},Fp={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Ap={class:"text-nowrap my-2 d-flex align-items-center"},Up={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(x){const T=x,h=P(),N=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],s=e.ref({}),p=e.ref({ID:T.id,Result:1}),r=()=>{const n={};if(p.value.Result>1&&(n.Reason="原因"),s.value=O(p.value,n),Object.keys(s.value).length){l();return}M[T.type]("reviewApplication",p.value).subscribe(a=>{a&&(window.location.href="../ReviewChecklist.aspx?type=4")})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>p.value.Result,n=>{n>1&&l()}),(n,a)=>{const E=e.resolveComponent("input-radio-group"),V=e.resolveComponent("input-textarea");return e.unref(h)[x.type].organizer?(e.openBlock(),e.createElementBlock("div",wp,[a[3]||(a[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Dp,[e.createElementVNode("li",Sp,[a[2]||(a[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Fp,[e.createElementVNode("div",Ap,[e.createVNode(E,{options:N,modelValue:e.unref(p).Result,"onUpdate:modelValue":a[0]||(a[0]=g=>e.unref(p).Result=g)},null,8,["modelValue"])]),e.unref(p).Result>1?(e.openBlock(),e.createBlock(V,{key:0,error:e.unref(s).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(p).Reason,"onUpdate:modelValue":a[1]||(a[1]=g=>e.unref(p).Reason=g)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Mp={class:"d-flex align-items-center gap-3"},Op={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},jp={class:"modal-content"},Ip={class:"modal-header"},Pp={class:"fs-24 fw-bold text-green-light"},qp={class:"modal-body"},Lp={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},Rp=["disabled"],zp={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(x){const T=x,h=e.computed(()=>!p.value||p.value===l[T.type].organizer),N=e.ref(),s=e.computed(()=>l[T.type].organizerName),p=e.ref(0),r=e.computed(()=>{var w;return(w=E.value.find(D=>D.UnitID===a.value))==null?void 0:w.reviewers}),l=P(),n=e.computed(()=>s.value?"移轉案件":"認領案件"),a=e.ref(0),E=e.ref([]),V=()=>{M[T.type]("queryReviewUnits").subscribe(w=>{E.value=w,rxjs.forkJoin(E.value.map(D=>M[T.type]("queryReviewersByUnit",{ID:D.UnitID}))).subscribe(D=>{D.forEach((f,o)=>{E.value[o].reviewers=f,f.some(y=>y.UserID===p.value)&&(a.value=E.value[o].UnitID)}),bootstrap.Modal.getOrCreateInstance(N.value).show()})})},g=()=>{M[T.type]("saveOrganizer",{ID:T.id,Organizer:p.value}).subscribe(w=>{w&&window.location.reload()})};return e.watch(s,()=>p.value=l[T.type].organizer),e.watch(a,()=>{r.value.some(w=>w.UserID===p.value)||(p.value=0)}),(w,D)=>{const f=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Mp,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(s)||"尚無"),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:V,type:"button"},e.toDisplayString(e.unref(n)),1)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:N,tabindex:"-1"},[e.createElementVNode("div",Op,[e.createElementVNode("div",jp,[e.createElementVNode("div",Ip,[e.createElementVNode("h4",Pp,e.toDisplayString(e.unref(n)),1),D[2]||(D[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",qp,[e.createElementVNode("div",null,[D[3]||(D[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(f,{"empty-value":0,options:e.unref(E),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(a),"onUpdate:modelValue":D[0]||(D[0]=o=>e.isRef(a)?a.value=o:null)},null,8,["options","modelValue"]),e.createVNode(f,{class:"mt-2","empty-value":0,options:e.unref(r),"text-name":"Name","value-name":"UserID",modelValue:e.unref(p),"onUpdate:modelValue":D[1]||(D[1]=o=>e.isRef(p)?p.value=o:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",Lp,[D[4]||(D[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:g,disabled:e.unref(h),type:"button"},"確認",8,Rp)])])])])],512)]))],64)}}},Gp={class:"step-line-wrapper"},Jp={class:"step-line"},Qp={key:0,class:"tag tag-white"},Wp={key:1,class:"tag tag-white"},Yp={key:0,class:"step-line"},Hp={key:0,class:"tag tag-white"},Zp={class:"step-line"},Kp={key:0,class:"tag tag-white"},Xp={key:0,class:"tag tag-white"},vp={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(x){const T=P(),h=x,N=s=>{location.href=`${s}.aspx?ID=${h.id}`};return(s,p)=>(e.openBlock(),e.createElementBlock("div",Gp,[e.createElementVNode("div",Jp,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===1}]),onClick:p[0]||(p[0]=r=>N("Audit")),role:"button"},[p[4]||(p[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),x.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(T)[h.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",Qp,"編輯中")):e.unref(T)[h.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",Wp,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),x.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Yp,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===4}]),onClick:p[1]||(p[1]=r=>N("Progress")),role:"button"},[p[5]||(p[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),x.step===4?(e.openBlock(),e.createElementBlock("div",Hp,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",Zp,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===5}]),onClick:p[2]||(p[2]=r=>N("Report")),role:"button"},[p[6]||(p[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),x.step===5?(e.openBlock(),e.createElementBlock("div",Kp,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===6}]),onClick:p[3]||(p[3]=r=>N("Payment")),role:"button"},[p[7]||(p[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),x.step===6?(e.openBlock(),e.createElementBlock("div",Xp,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},ef={class:"block"},tf={class:"square-title"},lf=["innerHTML"],of={class:"table-responsive mt-3"},nf={class:"table align-middle gray-table"},rf={class:"text-center"},af=["href"],df={key:0,class:"text-center"},sf={key:0},mf={key:1,class:"text-pink"},cf={key:1,class:"tag-group mt-2 gap-1"},Vf={key:0,class:"tag tag-green-light"},pf=["download","href"],ff=["onClick"],Nf={key:0,class:"block-bottom bg-light-teal"},Ef=!0,uf={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:T}){const h=x;e.computed(()=>N.value.some(n=>!n.Optional&&!n.Files.filter(a=>!a.Deleted).length));const N=e.ref(h.data.docs.map(n=>({...n,Files:[]})));e.ref({});const s=(n,a)=>{a.Type==="application/zip"&&n.Files.push({Type:n.Type,Path:a.Path,Name:h.id+"_"+(n.Multiple?a.Name:`${n.Title}.zip`)})},p=M.download,r=()=>{N.value.forEach(n=>{n.Uploaded=e.computed(()=>n.Files.filter(a=>!a.Deleted).length)})},l=n=>{};return e.onMounted(r),e.provide("editable",Ef),(n,a)=>{const E=e.resolveComponent("required-label"),V=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ef,[e.createElementVNode("h5",tf,e.toDisplayString(x.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:x.data.description},null,8,lf),e.createElementVNode("div",of,[e.createElementVNode("table",nf,[a[4]||(a[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號"),e.createElementVNode("th",null,"附件名稱"),e.createElementVNode("th",{class:"text-center"},"狀態"),e.createElementVNode("th",null,"上傳附件")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(g,w)=>(e.openBlock(),e.createElementBlock("tr",{key:g},[e.createElementVNode("td",rf,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(E,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(g.Title),1)]),_:2},1024)]),g.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:g.Template,style:{width:"140px"},type:"button"},[...a[2]||(a[2]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,af)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createElementBlock("td",df,[g.Uploaded?(e.openBlock(),e.createElementBlock("span",sf,"已上傳")):(e.openBlock(),e.createElementBlock("span",mf,"尚未上傳"))])),e.createElementVNode("td",null,[g.Multiple||!g.Uploaded?(e.openBlock(),e.createBlock(V,{key:0,accept:".zip",onFile:D=>s(g,D)},null,8,["onFile"])):e.createCommentVNode("",!0),g.Uploaded?(e.openBlock(),e.createElementBlock("div",cf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Vf,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(p)(D.Path)},e.toDisplayString(D.Name),9,pf),(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:f=>D.Deleted=!0,type:"button"},[...a[3]||(a[3]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ff))]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),(e.openBlock(),e.createElementBlock("div",Nf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[0]||(a[0]=g=>l()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[1]||(a[1]=g=>l()),type:"button"},[...a[5]||(a[5]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])]))],64)}}},bf={key:0,class:"scroll-bottom-panel"},kf={class:"d-flex flex-column gap-3 mb-3"},gf={class:"d-flex gap-2"},yf={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},xf={class:"text-nowrap mb-2 d-flex align-items-center"},Bf={key:0,class:"invalid mt-0"},hf={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(x){const T=x,h=P(),N=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],s=e.ref({}),p=e.ref({ID:T.id,Result:1}),r=()=>{},l=()=>{},n=()=>{const E={};if(p.value.Result>1&&(E.Reason="原因"),p.value.Result===3&&(E.CorrectionDeadline="補正期限"),s.value=O(p.value,E),Object.keys(s.value).length){a();return}M[T.type]("reviewApplication",p.value).subscribe(V=>{V&&(window.location.href="../ReviewChecklist.aspx?type=1")})},a=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>p.value.Result,E=>{E>1&&a()}),(E,V)=>{const g=e.resolveComponent("input-radio-group"),w=e.resolveComponent("input-tw-date"),D=e.resolveComponent("input-textarea");return e.unref(h)[x.type].organizer?(e.openBlock(),e.createElementBlock("div",bf,[V[9]||(V[9]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",kf,[e.createElementVNode("li",{class:"d-flex gap-2"},[V[3]||(V[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:r,href:"javascript:void(0)"},"3")]),e.createElementVNode("li",{class:"d-flex gap-2"},[V[6]||(V[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),V[7]||(V[7]=e.createElementVNode("span",{class:"text-pink"},"中風險",-1)),e.createElementVNode("span",null,[V[4]||(V[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:l,href:"javascript:void(0)"},"1"),V[5]||(V[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",gf,[V[8]||(V[8]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",yf,[e.createElementVNode("div",xf,[e.createVNode(g,{options:N,modelValue:e.unref(p).Result,"onUpdate:modelValue":V[0]||(V[0]=f=>e.unref(p).Result=f)},null,8,["modelValue"]),e.createVNode(w,{class:"form-control",drops:"up",modelValue:e.unref(p).CorrectionDeadline,"onUpdate:modelValue":V[1]||(V[1]=f=>e.unref(p).CorrectionDeadline=f)},null,8,["modelValue"])]),e.unref(s).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",Bf,e.toDisplayString(e.unref(s).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(p).Result>1?(e.openBlock(),e.createBlock(D,{key:1,error:e.unref(s).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(p).Reason,"onUpdate:modelValue":V[2]||(V[2]=f=>e.unref(p).Reason=f)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:n,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},$f={class:"top-wrapper"},Cf={class:"top-block"},Tf={class:"d-flex align-items-center gap-3"},_f={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const T=x,h=P();return(N,s)=>(e.openBlock(),e.createElementBlock("div",$f,[e.createElementVNode("div",Cf,[e.createElementVNode("div",Tf,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(h)[T.type].type)+"］"+e.toDisplayString(e.unref(h)[T.type].id)+"/"+e.toDisplayString(e.unref(h)[T.type].name),1)]),s[0]||(s[0]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"}," 查核紀錄 ",-1))])]))}},wf={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},Df={class:"d-flex gap-2"},Sf={key:0,class:"btn text-teal-dark",type:"button"},Ff={class:"d-flex gap-2"},Af={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Uf={class:"modal-content"},Mf={class:"modal-body"},Of={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},jf={class:"modal-content"},If={class:"modal-body"},Pf={class:"d-flex flex-column gap-4 mb-5"},qf={class:"d-flex align-items-center"},Lf={class:"flex-grow-1"},Rf={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const T=P(),h=x,N=e.ref({}),s=e.ref(),p=e.ref({}),r=e.ref(),l=e.ref({}),n=e.ref(),a=()=>{const D={Reason:"計畫變更原因"};p.value=O(N.value,D),!Object.keys(p.value).length&&M[h.type]("applyChange",N.value).subscribe(f=>{f&&location.reload()})},E=()=>{N.value={ID:h.id},bootstrap.Modal.getOrCreateInstance(s.value).show()},V=()=>{bootstrap.Modal.getOrCreateInstance(r.value).show()},g=()=>{l.value={ID:h.id},bootstrap.Modal.getOrCreateInstance(n.value).show()},w=()=>{const D={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};p.value=O(l.value,D),!Object.keys(p.value).length&&M[h.type]("terminate",l.value).subscribe(f=>{f&&(location.href="../ApplicationChecklist.aspx")})};return(D,f)=>{const o=e.resolveComponent("project-organizer"),y=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",wf,[e.createElementVNode("div",Df,[e.unref(T)[h.type].changeStatus?(e.openBlock(),e.createElementBlock("button",Sf," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:E,type:"button"}," 計畫變更申請 ")),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:V,type:"button"},[...f[3]||(f[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])]),f[4]||(f[4]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-download"}),e.createTextVNode(" 下載核定計畫書 ")],-1))]),e.createElementVNode("div",Ff,[e.createVNode(o,{id:x.id,type:x.type},null,8,["id","type"]),e.createElementVNode("button",{class:"btn btn-pink",onClick:g,type:"button"}," 計畫終止 ")])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:s,tabindex:"-1"},[e.createElementVNode("div",Af,[e.createElementVNode("div",Uf,[f[8]||(f[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Mf,[f[6]||(f[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),f[7]||(f[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(y,{error:e.unref(p).Reason,modelValue:e.unref(N).Reason,"onUpdate:modelValue":f[0]||(f[0]=c=>e.unref(N).Reason=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[f[5]||(f[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:a},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:r,tabindex:"-1"},[...f[9]||(f[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:n,tabindex:"-1"},[e.createElementVNode("div",Of,[e.createElementVNode("div",jf,[f[14]||(f[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",If,[e.createElementVNode("div",Pf,[e.createElementVNode("div",null,[f[10]||(f[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(y,{error:e.unref(p).RejectReason,modelValue:e.unref(l).RejectReason,"onUpdate:modelValue":f[1]||(f[1]=c=>e.unref(l).RejectReason=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),f[12]||(f[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",qf,[f[11]||(f[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",Lf,[e.createVNode(b,{error:e.unref(p).RecoveryAmount,modelValue:e.unref(l).RecoveryAmount,"onUpdate:modelValue":f[2]||(f[2]=c=>e.unref(l).RecoveryAmount=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[f[13]||(f[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:w},"送出")])])])])],512)]))],64)}}},zf={key:0,class:"text-pink"},te={AccessibilityApplication:Xe,AccessibilityAttachment:gt,AccessibilityBenefit:Ut,AccessibilityFunding:sl,AccessibilityProgressBar:ml,AccessibilityWorkSchedule:Ul,ConfirmModal:ql,CommonProgressBar:Wl,CultureApplication:Fo,CultureAttachment:en,CultureFunding:_n,CultureOther:Gn,CulturePayment1:pr,CulturePayment2:jr,CultureProgress:la,CultureProgressBar:oa,CultureWorkSchedule:Za,EducationApplication:Rd,EducationAttachment:cs,EducationProgressBar:is,ErrorModal:us,InputBoolean:bs,InputFile:ks,InputInteger:xs,InputMonth:Bs,InputRadioGroup:Cs,InputSelect:Ss,InputText:Os,InputTextarea:Ls,InputTwDate:Gs,LiteracyApplication:hm,LiteracyAttachment:Qm,LiteracyBenefit:ac,LiteracyFunding:Uc,LiteracyProgressBar:Mc,LiteracyWorkSchedule:ai,MultipleApplication:qi,MultipleAttachment:sV,MultipleBenefit:xV,MultipleFunding:ZV,MultipleProgressBar:KV,MultipleWorkSchedule:xp,ProjectChangeReview:_p,ProjectCorrectionReview:Up,ProjectOrganizer:zp,ProjectProgress:vp,ProjectReport:uf,ProjectReview:hf,ProjectTitle:_f,ProjectToolbar:Rf,RequiredLabel:{__name:"RequiredLabel",setup(x){const T=e.inject("editable",!0);return(h,N)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(T)?(e.openBlock(),e.createElementBlock("span",zf,"* ")):e.createCommentVNode("",!0),e.renderSlot(h.$slots,"default")],64))}},TwDate:{__name:"TwDate",props:{value:{default:null,type:String}},setup(x){const T=x,h=s=>{const p=s==null?void 0:s.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return p?`${parseInt(p[1],10)-1911}/${p[2]}/${p[3]}`:""},N=e.ref(h(T.value));return e.watch(()=>T.value,s=>N.value=h(s)),(s,p)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(N)),1))}}};return{api:M,install:x=>{for(const T in te)x.component(T,te[T])},useProgressStore:P}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
