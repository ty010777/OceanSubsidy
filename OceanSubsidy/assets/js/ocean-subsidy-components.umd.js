(function(e,W){typeof exports=="object"&&typeof module<"u"?module.exports=W(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],W):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=W(e.Vue,e.Pinia))})(this,(function(e,W){"use strict";const j=W.defineStore("progress",{actions:{init(h,u,b){var i,m;this[h]={id:u.ProjectID,type:(i=u.SubsidyPlanType)==null?void 0:i.split(" ")[0],name:u.ProjectName,step:u.FormStep,status:u.Status,progress:u.ProgressStatus,changeStatus:(m=u.changeApply)==null?void 0:m.Status,reportStatus:b==null?void 0:b.Status,organizer:u.Organizer,organizerName:u.OrganizerName,isOrganizer:u.isOrganizer}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let ae=Date.now();const Y=(h,u,b)=>{const i=j();if([1,14].includes(i[h].status)||[1,4].includes(i[h].changeStatus))return!0;if(i[h].status===42)switch(h){case"culture":if([2,3,5].includes(b))return!0;break;case"multiple":if([2,3,4,5].includes(b))return!0;break;case"accessibility":if([2,3,4,5].includes(b))return!0;break}return!1},se=()=>`id--${ae++}`,q=h=>parseInt(h)||0,ee=W.defineStore("message",{state:()=>({error:null})}),{ajax:de}=rxjs.ajax,{catchError:ce,map:ie}=rxjs;let X="";const me=(h,u={})=>K("Service/OFS/Accessibility.ashx",{method:h,param:u}),pe=(h,u={})=>K("Service/OFS/Culture.ashx",{method:h,param:u}),Ve=h=>`${X}/Service/OFS/Download.ashx?path=${encodeURIComponent(h)}`,fe=(h,u={})=>K("Service/OFS/Education.ashx",{method:h,param:u}),Ne=h=>{if(h.status===403){let u="/OFS/Home.aspx";/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Application|Attachment|Benefit|Funding|Other|WorkSchedule)\.aspx/.test(window.location.href)?u="/OFS/ApplicationChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Review)\.aspx/.test(window.location.href)?u="/OFS/ReviewChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Audit|Payment|Progress|Report)\.aspx/.test(window.location.href)&&(u="/OFS/inprogressList.aspx"),window.location.href=te(u)}},Ee=(h,u={})=>K("Service/OFS/Literacy.ashx",{method:h,param:u}),be=(h,u={})=>K("Service/OFS/Multiple.ashx",{method:h,param:u}),ge=({response:h,status:u})=>{if(u===200){if(h.success)return h.data;ee().error=h.message}},K=(h,u={})=>{const b={};u.constructor!==FormData&&(b["Content-Type"]="application/json");const i={body:u,headers:b,method:"POST",url:`${X}/${h}`};return de(i).pipe(ie(ge),ce(Ne))},ye=(h,u)=>{let b=`${X}/Service/SCI_Download.ashx?action=${h}`;return Object.keys(u).forEach(i=>b=`${b}&${i}=${encodeURIComponent(u[i])}`),b},ke=h=>X=h,ue=(h,u={})=>K("Service/OFS/System.ashx",{method:h,param:u}),te=h=>`${X}${h}`,F=Object.assign(K,{accessibility:me,culture:pe,download:Ve,education:fe,literacy:Ee,multiple:be,sciDownload:ye,setBaseUrl:ke,system:ue,toUrl:te,upload:h=>{const u=new FormData;return u.append("file",h),K("Service/OFS/Upload.ashx",u)}});function he(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Z={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var xe=Z.exports,le;function $e(){return le||(le=1,(function(h,u){(function(b,i,m){var f=function(o,l,c){c=a.extend({},a.options,c);var g=a.runValidations(o,l,c);if(g.some(function(E){return a.isPromise(E.error)}))throw new Error("Use validate.async if you want support for promises");return f.processValidationResults(g,c)},a=f;a.extend=function(o){return[].slice.call(arguments,1).forEach(function(l){for(var c in l)o[c]=l[c]}),o},a.extend(f,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var o=a.format("%{major}.%{minor}.%{patch}",a.version);return a.isEmpty(a.version.metadata)||(o+="+"+a.version.metadata),o}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(o,l,c){var g=[],E,x,_,y,s,n,C;(a.isDomElement(o)||a.isJqueryElement(o))&&(o=a.collectFormValues(o));for(E in l){_=a.getDeepObjectValue(o,E),y=a.result(l[E],_,o,E,c,l);for(x in y){if(s=a.validators[x],!s)throw C=a.format("Unknown validator %{name}",{name:x}),new Error(C);n=y[x],n=a.result(n,_,o,E,c,l),n&&g.push({attribute:E,value:_,validator:x,globalOptions:c,attributes:o,options:n,error:s.call(s,_,n,E,o,c)})}}return g},processValidationResults:function(o,l){o=a.pruneEmptyErrors(o,l),o=a.expandMultipleErrors(o,l),o=a.convertErrorMessages(o,l);var c=l.format||"grouped";if(typeof a.formatters[c]=="function")o=a.formatters[c](o);else throw new Error(a.format("Unknown format %{format}",l));return a.isEmpty(o)?void 0:o},async:function(o,l,c){c=a.extend({},a.async.options,c);var g=c.wrapErrors||function(x){return x};c.cleanAttributes!==!1&&(o=a.cleanAttributes(o,l));var E=a.runValidations(o,l,c);return new a.Promise(function(x,_){a.waitForResults(E).then(function(){var y=a.processValidationResults(E,c);y?_(new g(y,c,o,l)):x(o)},function(y){_(y)})})},single:function(o,l,c){return c=a.extend({},a.single.options,c,{format:"flat",fullMessages:!1}),a({single:o},{single:l},c)},waitForResults:function(o){return o.reduce(function(l,c){return a.isPromise(c.error)?l.then(function(){return c.error.then(function(g){c.error=g||null})}):l},new a.Promise(function(l){l()}))},result:function(o){var l=[].slice.call(arguments,1);return typeof o=="function"&&(o=o.apply(null,l)),o},isNumber:function(o){return typeof o=="number"&&!isNaN(o)},isFunction:function(o){return typeof o=="function"},isInteger:function(o){return a.isNumber(o)&&o%1===0},isBoolean:function(o){return typeof o=="boolean"},isObject:function(o){return o===Object(o)},isDate:function(o){return o instanceof Date},isDefined:function(o){return o!=null},isPromise:function(o){return!!o&&a.isFunction(o.then)},isJqueryElement:function(o){return o&&a.isString(o.jquery)},isDomElement:function(o){return!o||!o.querySelectorAll||!o.querySelector?!1:a.isObject(document)&&o===document?!0:typeof HTMLElement=="object"?o instanceof HTMLElement:o&&typeof o=="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName=="string"},isEmpty:function(o){var l;if(!a.isDefined(o))return!0;if(a.isFunction(o))return!1;if(a.isString(o))return a.EMPTY_STRING_REGEXP.test(o);if(a.isArray(o))return o.length===0;if(a.isDate(o))return!1;if(a.isObject(o)){for(l in o)return!1;return!0}return!1},format:a.extend(function(o,l){return a.isString(o)?o.replace(a.format.FORMAT_REGEXP,function(c,g,E){return g==="%"?"%{"+E+"}":String(l[E])}):o},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(o){return a.isNumber(o)?o*100%1===0?""+o:parseFloat(Math.round(o*100)/100).toFixed(2):a.isArray(o)?o.map(function(l){return a.prettify(l)}).join(", "):a.isObject(o)?a.isDefined(o.toString)?o.toString():JSON.stringify(o):(o=""+o,o.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(l,c,g){return""+c+" "+g.toLowerCase()}).toLowerCase())},stringifyValue:function(o,l){var c=l&&l.prettify||a.prettify;return c(o)},isString:function(o){return typeof o=="string"},isArray:function(o){return{}.toString.call(o)==="[object Array]"},isHash:function(o){return a.isObject(o)&&!a.isArray(o)&&!a.isFunction(o)},contains:function(o,l){return a.isDefined(o)?a.isArray(o)?o.indexOf(l)!==-1:l in o:!1},unique:function(o){return a.isArray(o)?o.filter(function(l,c,g){return g.indexOf(l)==c}):o},forEachKeyInKeypath:function(o,l,c){if(a.isString(l)){var g="",E,x=!1;for(E=0;E<l.length;++E)switch(l[E]){case".":x?(x=!1,g+="."):(o=c(o,g,!1),g="");break;case"\\":x?(x=!1,g+="\\"):x=!0;break;default:x=!1,g+=l[E];break}return c(o,g,!0)}},getDeepObjectValue:function(o,l){if(a.isObject(o))return a.forEachKeyInKeypath(o,l,function(c,g){if(a.isObject(c))return c[g]})},collectFormValues:function(o,l){var c={},g,E,x,_,y,s;if(a.isJqueryElement(o)&&(o=o[0]),!o)return c;for(l=l||{},_=o.querySelectorAll("input[name], textarea[name]"),g=0;g<_.length;++g)if(x=_.item(g),!a.isDefined(x.getAttribute("data-ignored"))){var n=x.name.replace(/\./g,"\\\\.");s=a.sanitizeFormValue(x.value,l),x.type==="number"?s=s?+s:null:x.type==="checkbox"?x.attributes.value?x.checked||(s=c[n]||null):s=x.checked:x.type==="radio"&&(x.checked||(s=c[n]||null)),c[n]=s}for(_=o.querySelectorAll("select[name]"),g=0;g<_.length;++g)if(x=_.item(g),!a.isDefined(x.getAttribute("data-ignored"))){if(x.multiple){s=[];for(E in x.options)y=x.options[E],y&&y.selected&&s.push(a.sanitizeFormValue(y.value,l))}else{var C=typeof x.options[x.selectedIndex]<"u"?x.options[x.selectedIndex].value:"";s=a.sanitizeFormValue(C,l)}c[x.name]=s}return c},sanitizeFormValue:function(o,l){return l.trim&&a.isString(o)&&(o=o.trim()),l.nullify!==!1&&o===""?null:o},capitalize:function(o){return a.isString(o)?o[0].toUpperCase()+o.slice(1):o},pruneEmptyErrors:function(o){return o.filter(function(l){return!a.isEmpty(l.error)})},expandMultipleErrors:function(o){var l=[];return o.forEach(function(c){a.isArray(c.error)?c.error.forEach(function(g){l.push(a.extend({},c,{error:g}))}):l.push(c)}),l},convertErrorMessages:function(o,l){l=l||{};var c=[],g=l.prettify||a.prettify;return o.forEach(function(E){var x=a.result(E.error,E.value,E.attribute,E.options,E.attributes,E.globalOptions);if(!a.isString(x)){c.push(E);return}x[0]==="^"?x=x.slice(1):l.fullMessages!==!1&&(x=a.capitalize(g(E.attribute))+" "+x),x=x.replace(/\\\^/g,"^"),x=a.format(x,{value:a.stringifyValue(E.value,l)}),c.push(a.extend({},E,{error:x}))}),c},groupErrorsByAttribute:function(o){var l={};return o.forEach(function(c){var g=l[c.attribute];g?g.push(c):l[c.attribute]=[c]}),l},flattenErrorsToArray:function(o){return o.map(function(l){return l.error}).filter(function(l,c,g){return g.indexOf(l)===c})},cleanAttributes:function(o,l){function c(x,_,y){return a.isObject(x[_])?x[_]:x[_]=y?!0:{}}function g(x){var _={},y;for(y in x)x[y]&&a.forEachKeyInKeypath(_,y,c);return _}function E(x,_){if(!a.isObject(x))return x;var y=a.extend({},x),s,n;for(n in x)s=_[n],a.isObject(s)?y[n]=E(y[n],s):s||delete y[n];return y}return!a.isObject(l)||!a.isObject(o)?{}:(l=g(l),E(o,l))},exposeModule:function(o,l,c,g,E){c?(g&&g.exports&&(c=g.exports=o),c.validate=o):(l.validate=o,o.isFunction(E)&&E.amd&&E([],function(){return o}))},warn:function(o){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+o)},error:function(o){typeof console<"u"&&console.error&&console.error("[validate.js] "+o)}}),f.validators={presence:function(o,l){if(l=a.extend({},this.options,l),l.allowEmpty!==!1?!a.isDefined(o):a.isEmpty(o))return l.message||this.message||"can't be blank"},length:function(o,l,c){if(a.isDefined(o)){l=a.extend({},this.options,l);var g=l.is,E=l.maximum,x=l.minimum,_=l.tokenizer||function(C){return C},y,s=[];o=_(o);var n=o.length;if(!a.isNumber(n))return l.message||this.notValid||"has an incorrect length";if(a.isNumber(g)&&n!==g&&(y=l.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",s.push(a.format(y,{count:g}))),a.isNumber(x)&&n<x&&(y=l.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",s.push(a.format(y,{count:x}))),a.isNumber(E)&&n>E&&(y=l.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",s.push(a.format(y,{count:E}))),s.length>0)return l.message||s}},numericality:function(o,l,c,g,E){if(a.isDefined(o)){l=a.extend({},this.options,l);var x=[],_,y,s={greaterThan:function(N,d){return N>d},greaterThanOrEqualTo:function(N,d){return N>=d},equalTo:function(N,d){return N===d},lessThan:function(N,d){return N<d},lessThanOrEqualTo:function(N,d){return N<=d},divisibleBy:function(N,d){return N%d===0}},n=l.prettify||E&&E.prettify||a.prettify;if(a.isString(o)&&l.strict){var C="^-?(0|[1-9]\\d*)";if(l.onlyInteger||(C+="(\\.\\d+)?"),C+="$",!new RegExp(C).test(o))return l.message||l.notValid||this.notValid||this.message||"must be a valid number"}if(l.noStrings!==!0&&a.isString(o)&&!a.isEmpty(o)&&(o=+o),!a.isNumber(o))return l.message||l.notValid||this.notValid||this.message||"is not a number";if(l.onlyInteger&&!a.isInteger(o))return l.message||l.notInteger||this.notInteger||this.message||"must be an integer";for(_ in s)if(y=l[_],a.isNumber(y)&&!s[_](o,y)){var p="not"+a.capitalize(_),r=l[p]||this[p]||this.message||"must be %{type} %{count}";x.push(a.format(r,{count:y,type:n(_)}))}if(l.odd&&o%2!==1&&x.push(l.notOdd||this.notOdd||this.message||"must be odd"),l.even&&o%2!==0&&x.push(l.notEven||this.notEven||this.message||"must be even"),x.length)return l.message||x}},datetime:a.extend(function(o,l){if(!a.isFunction(this.parse)||!a.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(a.isDefined(o)){l=a.extend({},this.options,l);var c,g=[],E=l.earliest?this.parse(l.earliest,l):NaN,x=l.latest?this.parse(l.latest,l):NaN;if(o=this.parse(o,l),isNaN(o)||l.dateOnly&&o%864e5!==0)return c=l.notValid||l.message||this.notValid||"must be a valid date",a.format(c,{value:arguments[0]});if(!isNaN(E)&&o<E&&(c=l.tooEarly||l.message||this.tooEarly||"must be no earlier than %{date}",c=a.format(c,{value:this.format(o,l),date:this.format(E,l)}),g.push(c)),!isNaN(x)&&o>x&&(c=l.tooLate||l.message||this.tooLate||"must be no later than %{date}",c=a.format(c,{date:this.format(x,l),value:this.format(o,l)}),g.push(c)),g.length)return a.unique(g)}},{parse:null,format:null}),date:function(o,l){return l=a.extend({},l,{dateOnly:!0}),a.validators.datetime.call(a.validators.datetime,o,l)},format:function(o,l){(a.isString(l)||l instanceof RegExp)&&(l={pattern:l}),l=a.extend({},this.options,l);var c=l.message||this.message||"is invalid",g=l.pattern,E;if(a.isDefined(o)&&(!a.isString(o)||(a.isString(g)&&(g=new RegExp(l.pattern,l.flags)),E=g.exec(o),!E||E[0].length!=o.length)))return c},inclusion:function(o,l){if(a.isDefined(o)&&(a.isArray(l)&&(l={within:l}),l=a.extend({},this.options,l),!a.contains(l.within,o))){var c=l.message||this.message||"^%{value} is not included in the list";return a.format(c,{value:o})}},exclusion:function(o,l){if(a.isDefined(o)&&(a.isArray(l)&&(l={within:l}),l=a.extend({},this.options,l),!!a.contains(l.within,o))){var c=l.message||this.message||"^%{value} is restricted";return a.isString(l.within[o])&&(o=l.within[o]),a.format(c,{value:o})}},email:a.extend(function(o,l){l=a.extend({},this.options,l);var c=l.message||this.message||"is not a valid email";if(a.isDefined(o)&&(!a.isString(o)||!this.PATTERN.exec(o)))return c},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(o,l,c,g,E){if(a.isDefined(o)){a.isString(l)&&(l={attribute:l}),l=a.extend({},this.options,l);var x=l.message||this.message||"is not equal to %{attribute}";if(a.isEmpty(l.attribute)||!a.isString(l.attribute))throw new Error("The attribute must be a non empty string");var _=a.getDeepObjectValue(g,l.attribute),y=l.comparator||function(n,C){return n===C},s=l.prettify||E&&E.prettify||a.prettify;if(!y(o,_,l,c,g))return a.format(x,{attribute:s(l.attribute)})}},url:function(o,l){if(a.isDefined(o)){l=a.extend({},this.options,l);var c=l.message||this.message||"is not a valid url",g=l.schemes||this.schemes||["http","https"],E=l.allowLocal||this.allowLocal||!1,x=l.allowDataUrl||this.allowDataUrl||!1;if(!a.isString(o))return c;var _="^(?:(?:"+g.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",y="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(E?y+="?":_+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",_+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+y+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",x){var s="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",n="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",C="data:(?:"+s+")?(?:;base64)?,"+n;_="(?:"+_+")|(?:^"+C+"$)"}var p=new RegExp(_,"i");if(!p.exec(o))return c}},type:a.extend(function(o,l,c,g,E){if(a.isString(l)&&(l={type:l}),!!a.isDefined(o)){var x=a.extend({},this.options,l),_=x.type;if(!a.isDefined(_))throw new Error("No type was specified");var y;if(a.isFunction(_)?y=_:y=this.types[_],!a.isFunction(y))throw new Error("validate.validators.type.types."+_+" must be a function.");if(!y(o,x,c,g,E)){var s=l.message||this.messages[_]||this.message||x.message||(a.isFunction(_)?"must be of the correct type":"must be of type %{type}");return a.isFunction(s)&&(s=s(o,l,c,g,E)),a.format(s,{attribute:a.prettify(c),type:_})}}},{types:{object:function(o){return a.isObject(o)&&!a.isArray(o)},array:a.isArray,integer:a.isInteger,number:a.isNumber,string:a.isString,date:a.isDate,boolean:a.isBoolean},messages:{}})},f.formatters={detailed:function(o){return o},flat:a.flattenErrorsToArray,grouped:function(o){var l;o=a.groupErrorsByAttribute(o);for(l in o)o[l]=a.flattenErrorsToArray(o[l]);return o},constraint:function(o){var l;o=a.groupErrorsByAttribute(o);for(l in o)o[l]=o[l].map(function(c){return c.validator}).sort();return o}},f.exposeModule(f,this,b,i,m)}).call(xe,u,h,null)})(Z,Z.exports)),Z.exports}var Be=$e();const oe=he(Be),I=(h,u,b="")=>{const i={};Object.keys(u).forEach(a=>{const o=u[a];oe.isString(o)?i[a]={presence:{allowEmpty:!1,message:o.startsWith("^")?o:`^請輸入${o}`}}:i[a]=o});const m={},f=oe(h,i);return f&&Object.keys(f).forEach(a=>m[`${b}${a}`]=f[a].join(",")),m},_e={class:"block"},Ce={class:"mt-4"},Te={class:"table align-middle gray-table side-table"},we={key:0},De={key:1,class:"text-light-gray"},Se={class:"d-flex flex-column gap-2"},Ae={key:0},Fe={class:"mt-4"},Ue={class:"table align-middle gray-table side-table"},Pe={class:"row g-3"},Me={class:"col-12 col-xl-2"},Ie={class:"text-gray mb-2"},je={class:"col-12 col-xl-3"},Oe={class:"text-gray mb-2"},Le={class:"col-12 col-xl-4"},Re={class:"row g-1"},qe={class:"col-7"},ze={class:"col-5"},Ge={class:"col-12 col-xl-3"},Ye={class:"text-gray mb-2"},Je={class:"col-12"},Qe={class:"text-gray mb-2"},He={class:"mt-4"},We={class:"table align-middle gray-table side-table"},Ke={class:"mt-4"},Xe={class:"table align-middle gray-table side-table"},Ze={key:0,class:"table-responsive mt-3 mb-0"},ve={class:"table align-middle gray-table"},et={key:0},tt={key:0},lt={class:"d-flex gap-2"},ot=["onClick"],nt={class:"mt-4"},rt={class:"table align-middle gray-table side-table"},at={key:0,class:"block-bottom bg-light-teal"},st={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.ref(),a=e.computed(()=>Y("accessibility",c.value.Status,1)),o=e.ref({}),l=e.computed(()=>g.value.filter(p=>!p.Deleted)),c=e.ref({}),g=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:p=>{p?x():g.value.forEach(r=>r.Deleted=!0)}}),x=()=>g.value.push({}),_=u,y=()=>{F.accessibility("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(p=>{c.value=p.Project,f.value=p.Contacts,g.value=p.ReceivedSubsidies,c.value.OrgCategory=c.value.OrgCategory||null,j().init("accessibility",c.value),m.value=c.value.changeApply,c.value.changeApply=void 0})},s=p=>p.Deleted=!0,n=p=>{var N,d;if(o.value={},p&&!C()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:c.value,Contacts:f.value,ReceivedSubsidies:g.value.filter(t=>t.ID||!t.Deleted),Before:(N=m.value)==null?void 0:N.Form1Before,After:(d=m.value)==null?void 0:d.Form1After,Submit:p?"true":"false"};F.accessibility("saveApplication",r).subscribe(t=>{p?_("next",t.ID):c.value.ID?y():window.location.href=`Application.aspx?ID=${t.ID}`})},C=()=>{let p={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return c.value.OrgCategory==="2"&&(p.RegisteredNum="立案登記證字號"),o.value=I(c.value,p),p={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((r,N)=>Object.assign(o.value,I(r,p,`contact-${N}-`))),p={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},g.value.forEach((r,N)=>Object.assign(o.value,I(r,p,`received-${N}-`))),m.value&&(p={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,I(m.value,p))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(p=>{i.value=p[0],b.id?y():F.accessibility("getEmptyApplication").subscribe(r=>{c.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},r),f.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("accessibility",c.value)})})}),e.provide("editable",a),(p,r)=>{const N=e.resolveComponent("required-label"),d=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),V=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),S=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_e,[r[42]||(r[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Ce,[e.createElementVNode("table",Te,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[15]||(r[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).Year),1)]),e.createElementVNode("tr",null,[r[16]||(r[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(c).ProjectID?(e.openBlock(),e.createElementBlock("span",we,e.toDisplayString(e.unref(c).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",De,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[r[17]||(r[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[18]||(r[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o).ProjectName,modelValue:e.unref(c).ProjectName,"onUpdate:modelValue":r[0]||(r[0]=w=>e.unref(c).ProjectName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[19]||(r[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(c).OrgName,"onUpdate:modelValue":r[1]||(r[1]=w=>e.unref(c).OrgName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[20]||(r[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Se,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(i),"text-name":"Descname","value-name":"Code",modelValue:e.unref(c).OrgCategory,"onUpdate:modelValue":r[2]||(r[2]=w=>e.unref(c).OrgCategory=w)},null,8,["error","options","modelValue"])]),e.unref(c).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Ae,[e.createVNode(d,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(c).RegisteredNum,"onUpdate:modelValue":r[3]||(r[3]=w=>e.unref(c).RegisteredNum=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[21]||(r[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(c).TaxID,"onUpdate:modelValue":r[4]||(r[4]=w=>e.unref(c).TaxID=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[22]||(r[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(c).Address,"onUpdate:modelValue":r[5]||(r[5]=w=>e.unref(c).Address=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),r[43]||(r[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Fe,[e.createElementVNode("table",Ue,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(w,D)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Pe,[e.createElementVNode("div",Me,[e.createElementVNode("div",Ie,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[23]||(r[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(o)[`contact-${D}-Name`],modelValue:w.Name,"onUpdate:modelValue":B=>w.Name=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",je,[e.createElementVNode("div",Oe,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[24]||(r[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(o)[`contact-${D}-JobTitle`],modelValue:w.JobTitle,"onUpdate:modelValue":B=>w.JobTitle=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Le,[r[25]||(r[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Re,[e.createElementVNode("div",qe,[e.createVNode(d,{modelValue:w.Phone,"onUpdate:modelValue":B=>w.Phone=B,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ze,[e.createVNode(d,{placeholder:"請輸入分機",size:"4",modelValue:w.PhoneExt,"onUpdate:modelValue":B=>w.PhoneExt=B,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Ge,[e.createElementVNode("div",Ye,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[26]||(r[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(o)[`contact-${D}-MobilePhone`],modelValue:w.MobilePhone,"onUpdate:modelValue":B=>w.MobilePhone=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Je,[e.createElementVNode("div",Qe,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[27]||(r[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(o)[`contact-${D}-EMail`],modelValue:w.EMail,"onUpdate:modelValue":B=>w.EMail=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),r[44]||(r[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",He,[e.createElementVNode("table",We,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[28]||(r[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[r[29]||(r[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(V,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(c).Target,"onUpdate:modelValue":r[6]||(r[6]=w=>e.unref(c).Target=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[30]||(r[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(c).Summary,"onUpdate:modelValue":r[7]||(r[7]=w=>e.unref(c).Summary=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[31]||(r[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(c).Quantified,"onUpdate:modelValue":r[8]||(r[8]=w=>e.unref(c).Quantified=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[32]||(r[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(c).Qualitative,"onUpdate:modelValue":r[9]||(r[9]=w=>e.unref(c).Qualitative=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Ke,[e.createElementVNode("table",Xe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[38]||(r[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(E),"onUpdate:modelValue":r[10]||(r[10]=w=>e.isRef(E)?E.value=w:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Ze,[e.createElementVNode("table",ve,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[33]||(r[33]=e.createElementVNode("th",null,"計畫名稱",-1)),r[34]||(r[34]=e.createElementVNode("th",null,"補助單位",-1)),r[35]||(r[35]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",et,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(w,D)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o)[`received-${D}-Name`],modelValue:w.Name,"onUpdate:modelValue":B=>w.Name=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(o)[`received-${D}-Unit`],modelValue:w.Unit,"onUpdate:modelValue":B=>w.Unit=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o)[`received-${D}-Amount`],modelValue:w.Amount,"onUpdate:modelValue":B=>w.Amount=B},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",tt,[e.createElementVNode("div",lt,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>s(w),type:"button"},[...r[36]||(r[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ot)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:x,type:"button"},[...r[37]||(r[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[41]||(r[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",nt,[e.createElementVNode("table",rt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[39]||(r[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":r[11]||(r[11]=w=>e.unref(m).Form1Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[40]||(r[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":r[12]||(r[12]=w=>e.unref(m).Form1After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",at,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[13]||(r[13]=w=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[14]||(r[14]=w=>n(!0)),type:"button"},[...r[45]||(r[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},dt={class:"block"},ct={key:0,class:"text-pink lh-base mt-4"},it={class:"mt-4"},mt={class:"table align-middle gray-table"},pt={class:"text-center"},Vt={key:0,width:"180"},ft={class:"text-center"},Nt={key:0},Et=["innerHTML"],bt=["href"],gt={key:0,class:"text-center"},yt={key:0},kt={key:1,class:"text-pink"},ut={key:1,class:"tag-group mt-2 gap-1"},ht={key:0,class:"tag tag-green-light"},xt=["download","href"],$t=["onClick"],Bt={key:1,class:"text-center mt-4"},_t={class:"mt-4"},Ct={class:"table align-middle gray-table side-table"},Tt={key:0,class:"block-bottom bg-light-teal"},wt=["disabled"],Dt={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),f=e.computed(()=>i.value.some(s=>!s.Optional&&!s.Files.filter(n=>!n.Deleted).length)),a=e.computed(()=>Y("accessibility",l.value.Status,2)),o=e.ref({}),l=e.ref({}),c=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:l.value.ProjectID+"_"+(s.Multiple?n.Name:`${s.Title}.pdf`)})},g=F.download,E=u,x=()=>{rxjs.forkJoin([F.accessibility("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=i.value.filter(C=>{var p;return!((p=C.Excludes)!=null&&p.includes(l.value.OrgCategory))}),i.value.forEach(C=>{C.Files=n.Attachments.filter(p=>p.Type===C.Type),C.Uploaded=e.computed(()=>C.Files.filter(p=>!p.Deleted).length)}),j().init("accessibility",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=s=>{var C,p;if(o.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Attachments:i.value.reduce((r,N)=>r.concat(N.Files),[]),Before:(C=m.value)==null?void 0:C.Form5Before,After:(p=m.value)==null?void 0:p.Form5After,Submit:s?"true":"false"};F.accessibility("saveAttachment",n).subscribe(r=>{r&&(s?E("next",x):x())})},y=()=>{if(m.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,I(m.value,s))}return!Object.keys(o.value).length};return e.onMounted(x),e.provide("editable",a),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file"),r=e.resolveComponent("tw-date-time"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",dt,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("p",ct,[...n[4]||(n[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",it,[e.createElementVNode("table",mt,[e.createElementVNode("thead",pt,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",Vt,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",ft,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",Nt,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(C,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(a)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Et)):e.createCommentVNode("",!0),e.unref(a)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:d.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,bt)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",gt,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",yt,"已上傳")):(e.openBlock(),e.createElementBlock("span",kt,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:V=>c(d,V)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",ut,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,V=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:V},[V.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ht,[e.createElementVNode("a",{class:"tag-link my-1",download:V.Name,href:e.unref(g)(V.Path)},e.toDisplayString(V.Name),9,xt),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>V.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,$t)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(l).ApplyTime?(e.openBlock(),e.createElementBlock("div",Bt,[n[10]||(n[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(r,{value:e.unref(l).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",_t,[e.createElementVNode("table",Ct,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(m).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(m).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Tt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),disabled:e.unref(f),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,wt)])):e.createCommentVNode("",!0)],64)}}},St={class:"block"},At={class:"mt-4"},Ft={class:"table-responsive mt-3 mb-0"},Ut={class:"table align-middle gray-table"},Pt={key:0,width:"1"},Mt={key:0},It={class:"d-flex gap-2"},jt=["onClick"],Ot={class:"table-responsive mt-3 mb-0"},Lt={class:"table align-middle gray-table"},Rt={class:"mt-4"},qt={class:"table align-middle gray-table side-table"},zt={key:0,class:"block-bottom bg-light-teal"},Gt={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.computed(()=>Y("accessibility",l.value.Status,4)),a=e.ref({}),o=e.computed(()=>i.value.filter(s=>!s.Deleted)),l=e.ref({}),c=()=>i.value.push({}),g=u,E=()=>{rxjs.forkJoin([F.accessibility("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=n.Benefits,i.value.length||c(),j().init("accessibility",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},x=s=>s.Deleted=!0,_=s=>{var C,p;if(a.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:l.value,Benefits:i.value,Before:(C=m.value)==null?void 0:C.Form4Before,After:(p=m.value)==null?void 0:p.Form4After,Submit:s?"true":"false"};F.accessibility("saveBenefit",n).subscribe(()=>{s?g("next"):E()})},y=()=>{let s={Benefit:"不可量化成果"};return a.value=I(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((n,C)=>Object.assign(a.value,I(n,s,`item-${C}-`))),m.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(a.value,I(m.value,s))),!Object.keys(a.value).length};return e.onMounted(E),e.provide("editable",f),(s,n)=>{const C=e.resolveComponent("input-text"),p=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",St,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",At,[e.createElementVNode("div",Ft,[e.createElementVNode("table",Ut,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"目標值",-1)),n[7]||(n[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Pt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(N,d)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Title`],modelValue:N.Title,"onUpdate:modelValue":t=>N.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Target`],modelValue:N.Target,"onUpdate:modelValue":t=>N.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a)[`item-${d}-Description`],rows:"1",modelValue:N.Description,"onUpdate:modelValue":t=>N.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Mt,[e.createElementVNode("div",It,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>x(N),type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,jt)):e.createCommentVNode("",!0),d+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:c,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Ot,[e.createElementVNode("table",Lt,[n[10]||(n[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":n[0]||(n[0]=N=>e.unref(l).Benefit=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Rt,[e.createElementVNode("table",qt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":n[1]||(n[1]=N=>e.unref(m).Form4Before=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":n[2]||(n[2]=N=>e.unref(m).Form4After=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",zt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[3]||(n[3]=N=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[4]||(n[4]=N=>_(!0)),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Yt={class:"block"},Jt={class:"mt-4"},Qt={class:"table-responsive mt-3 mb-0"},Ht={class:"table align-middle gray-table"},Wt={class:"text-end"},Kt={class:"text-end"},Xt={class:"table-responsive"},Zt={class:"table align-middle gray-table"},vt=["colspan"],el={key:0,width:"1"},tl={class:"text-end"},ll={key:0},ol={class:"d-flex gap-2"},nl=["onClick"],rl={class:"mt-4"},al={class:"table-responsive mt-3 mb-0"},sl={class:"table align-middle gray-table"},dl={key:0,width:"1"},cl={class:"text-end"},il={key:0},ml={class:"d-flex gap-2"},pl=["onClick"],Vl={class:"mt-4"},fl={class:"table align-middle gray-table side-table"},Nl={key:0,class:"block-bottom bg-light-teal"},El={class:"text-center"},bl={class:"mb-5"},gl={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("accessibility",l.value.Status,3)),f=e.ref({}),a=e.computed(()=>g.value.filter(d=>!d.Deleted)),o=e.computed(()=>E.value.filter(d=>!d.Deleted)),l=e.ref({}),c=e.ref(),g=e.ref([]),E=e.ref([]),x=e.ref({}),_=e.ref(0),y=()=>g.value.push({}),s=()=>E.value.push({}),n=u,C=()=>{rxjs.forkJoin([F.accessibility("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];l.value=t.Project,g.value=t.OtherSubsidies,E.value=t.BudgetPlans,x.value=t.GrantTargetSetting,E.value.length||s(),j().init("accessibility",l.value),i.value=l.value.changeApply,l.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=(d,t)=>{var k,S;if(f.value={},d&&!N()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>x.value.GrantLimit*1e4){c.value.show(()=>r(d,!0));return}const V={Project:l.value,OtherSubsidies:g.value,BudgetPlans:E.value,Before:(k=i.value)==null?void 0:k.Form3Before,After:(S=i.value)==null?void 0:S.Form3After,Submit:d?"true":"false"};F.accessibility("saveFunding",V).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=I(l.value,d),d={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},a.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`other-${V}-`))),d={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`plan-${V}-`))),i.value&&(d={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,I(i.value,d))),!Object.keys(f.value).length};return e.onMounted(C),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=a.value.reduce((d,t)=>d+q(t.Amount),0),_.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),a.value.forEach(d=>d.percent=Math.round(q(d.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(d=>d.sum=q(d.Amount)+q(d.OtherAmount))}),(d,t)=>{var B;const V=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),w=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Yt,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Jt,[e.createElementVNode("div",Qt,[e.createElementVNode("table",Ht,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",Wt,e.toDisplayString((B=e.unref(l).OtherAmount)==null?void 0:B.toLocaleString()),1),e.createElementVNode("td",Kt,e.toDisplayString(e.unref(_).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",Xt,[e.createElementVNode("table",Zt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,vt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",el,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`other-${T}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",tl,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",ll,[e.createElementVNode("div",ol,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,nl)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",rl,[e.createElementVNode("div",al,[e.createElementVNode("table",sl,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",dl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`plan-${T}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",cl,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",il,[e.createElementVNode("div",ml,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pl)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Vl,[e.createElementVNode("table",fl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(i).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(i).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(i).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(i).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Nl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:c},{default:e.withCtx(()=>[e.createElementVNode("div",El,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",bl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(x).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},H=W.defineStore("payment",{actions:{init(h,u=0){this.stage=h==null?void 0:h.Stage,this.amount=h==null?void 0:h.CurrentRequestAmount,this.paid=u,this.status=h==null?void 0:h.Status}},state:()=>({stage:null,amount:null,paid:null,status:null})}),yl={class:"block"},kl={class:"square-title"},ul={class:"text-teal fw-bold py-3"},hl={class:"table-responsive mb-0"},xl={class:"table align-middle gray-table"},$l={class:"text-end"},Bl={class:"text-end"},_l={class:"text-end"},Cl={class:"text-teal fw-bold pb-3"},Tl={class:"text-teal fw-bold pb-3"},wl={class:"mt-4"},Dl={class:"table align-middle gray-table"},Sl={class:"text-center"},Al={key:0,width:"180"},Fl={class:"text-center"},Ul=["href"],Pl={key:0,class:"text-center"},Ml={key:0},Il={key:1,class:"text-pink"},jl={key:1,class:"tag-group mt-2 gap-1"},Ol={key:0,class:"tag tag-green-light"},Ll=["download","href"],Rl=["onClick"],ql={key:0,class:"block-bottom bg-light-teal"},zl=["disabled"],Gl={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>x.value.some(p=>!p.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),a=e.computed(()=>{var p;return((p=l.value)==null?void 0:p.Status)==="通過"}),o=e.ref(0),l=e.ref(),c=e.ref({}),g=e.computed(()=>c.value.ApprovedAmount?Math.min(Math.round(i.value*100/c.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>a.value?Math.round(i.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),x=e.ref([{Type:11,Title:"領據",Files:[]}]),_=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:`${c.value.ProjectID}_第一期請款_${p.Title}.pdf`})},y=F.download,s=u,n=()=>{F.accessibility("getPayment",{ID:b.id}).subscribe(p=>{c.value=p.Project,j().init("accessibility",c.value),x.value=x.value.filter(r=>{var N;return!((N=r.Excludes)!=null&&N.includes(c.value.OrgCategory))}),x.value.forEach(r=>{r.Files=p.Attachments.filter(N=>N.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(N=>!N.Deleted).length)}),l.value=p.Payments.find(r=>r.Stage===1),l.value&&(i.value=l.value.TotalSpentAmount),o.value=Math.round(c.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),H().init(l.value)})},C=p=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:x.value.reduce((N,d)=>N.concat(d.Files),[]),Submit:p?"true":"false"};F.accessibility("savePayment",r).subscribe(N=>{N&&(p?s("next",n):n())})};return e.onMounted(n),e.provide("editable",f),(p,r)=>{var V;const N=e.resolveComponent("input-integer"),d=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yl,[e.createElementVNode("h5",kl,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",ul,"核定經費: "+e.toDisplayString((V=e.unref(c).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("div",hl,[e.createElementVNode("table",xl,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",$l,e.toDisplayString(e.unref(i)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(N,{max:e.unref(o),modelValue:e.unref(i),"onUpdate:modelValue":r[0]||(r[0]=k=>e.isRef(i)?i.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Bl,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",_l,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Cl,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Tl,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",wl,[e.createElementVNode("table",Dl,[e.createElementVNode("thead",Sl,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Al,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Fl,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(f)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ul)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Pl,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Ml,"已上傳")):(e.openBlock(),e.createElementBlock("span",Il,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:w=>_(k,w)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",jl,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,w=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:w},[w.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ol,[e.createElementVNode("a",{class:"tag-link my-1",download:w.Name,href:e.unref(y)(w.Path)},e.toDisplayString(w.Name),9,Ll),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>w.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Rl)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",ql,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=k=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=k=>C(!0)),disabled:e.unref(m),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,zl)])):e.createCommentVNode("",!0)],64)}}},Yl={class:"block"},Jl={class:"square-title"},Ql={class:"text-teal fw-bold py-3"},Hl={class:"text-teal fw-bold pb-3"},Wl={class:"table-responsive mb-0"},Kl={class:"table align-middle gray-table"},Xl={class:"text-end"},Zl={class:"text-end"},vl={class:"text-end"},eo={class:"text-end"},to={class:"text-teal fw-bold pb-3"},lo={class:"text-teal fw-bold pb-3"},oo={class:"mt-4"},no={class:"table align-middle gray-table"},ro={class:"text-center"},ao={key:0,width:"180"},so={class:"text-center"},co=["href"],io={key:0,class:"text-center"},mo={key:0},po={key:1,class:"text-pink"},Vo={key:1,class:"tag-group mt-2 gap-1"},fo={key:0,class:"tag tag-green-light"},No=["download","href"],Eo=["onClick"],bo={key:0,class:"block-bottom bg-light-teal"},go=["disabled"],yo={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>s.value.some(d=>!d.Files.filter(t=>!t.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),a=e.computed(()=>{var d;return((d=l.value)==null?void 0:d.Status)==="通過"}),o=e.ref(0),l=e.ref(),c=e.ref(0),g=e.ref(0),E=e.ref({}),x=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(i.value*100/E.value.ApprovedAmount*100)/100,100):0),_=e.computed(()=>y.value?Math.round(i.value*100/y.value*100)/100:0),y=e.computed(()=>g.value+(a.value?l.value.CurrentActualPaidAmount:0)),s=e.ref([{Type:21,Title:"領據",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/ACC/1-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/ACC/2-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/ACC/3-補助清單.docx",Files:[]},{Type:25,Title:"其他",Files:[]}]),n=(d,t)=>{t.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${d.Title}.pdf`})},C=F.download,p=u,r=()=>{F.accessibility("getPayment",{ID:b.id}).subscribe(d=>{E.value=d.Project,j().init("accessibility",E.value),s.value=s.value.filter(V=>{var k;return!((k=V.Excludes)!=null&&k.includes(E.value.OrgCategory))}),s.value.forEach(V=>{V.Files=d.Attachments.filter(k=>k.Type===V.Type),V.Uploaded=e.computed(()=>V.Files.filter(k=>!k.Deleted).length)}),l.value=d.Payments.find(V=>V.Stage===2),l.value&&(i.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=d.Payments.filter(V=>V.Stage<2&&V.Status==="通過");c.value=t.reduce((V,k)=>V+k.CurrentRequestAmount,0),g.value=t.reduce((V,k)=>V+k.CurrentActualPaidAmount,0),H().init(l.value,g.value)})},N=d=>{const t={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:s.value.reduce((V,k)=>V.concat(k.Files),[]),Submit:d?"true":"false"};F.accessibility("savePayment",t).subscribe(V=>{V&&(d?p("next",r):r())})};return e.onMounted(r),e.provide("editable",f),(d,t)=>{var w;const V=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),S=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Yl,[e.createElementVNode("h5",Jl,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",Ql,"核定經費: "+e.toDisplayString((w=e.unref(E).ApprovedAmount)==null?void 0:w.toLocaleString())+"元",1),e.createElementVNode("p",Hl,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(i)).toLocaleString())+"元",1),e.createElementVNode("div",Wl,[e.createElementVNode("table",Kl,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Xl,e.toDisplayString(e.unref(i)-e.unref(c)),1),e.createElementVNode("td",Zl,e.toDisplayString(e.unref(g)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(o),modelValue:e.unref(i),"onUpdate:modelValue":t[0]||(t[0]=D=>e.isRef(i)?i.value=D:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",vl,e.toDisplayString(e.unref(x))+"%",1),e.createElementVNode("td",eo,e.toDisplayString(e.unref(_))+"%",1)])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",to,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",lo,"累積實際撥款: "+e.toDisplayString(e.unref(y).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",oo,[e.createElementVNode("table",no,[e.createElementVNode("thead",ro,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",ao,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(D,B)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",so,e.toDisplayString(B+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Title),1)]),_:2},1024)]),e.unref(f)&&D.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:D.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,co)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",io,[D.Uploaded?(e.openBlock(),e.createElementBlock("span",mo,"已上傳")):(e.openBlock(),e.createElementBlock("span",po,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!D.Uploaded?(e.openBlock(),e.createBlock(S,{key:0,accept:".pdf",onFile:A=>n(D,A)},null,8,["onFile"])):e.createCommentVNode("",!0),D.Uploaded?(e.openBlock(),e.createElementBlock("div",Vo,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",fo,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(C)(A.Path)},e.toDisplayString(A.Name),9,No),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>A.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Eo)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",bo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=D=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=D=>N(!0)),disabled:e.unref(m),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,go)])):e.createCommentVNode("",!0)],64)}}},ko={__name:"ProgressBar",setup(h){const u=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,i)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:u,type:"accessibility"})}}},uo={class:"block"},ho={class:"mt-4"},xo={class:"table align-middle gray-table side-table"},$o={key:0,class:"d-flex align-items-center gap-2"},Bo={class:"input-group w-auto"},_o={class:"text-teal-dark"},Co={key:1,class:"invalid mt-0"},To={class:"table-responsive mt-4"},wo={class:"table align-middle gray-table"},Do={key:0},So={class:"input-group"},Ao={key:0,class:"invalid mt-0"},Fo={key:0},Uo={class:"d-flex gap-2"},Po=["onClick"],Mo={class:"mt-4"},Io={class:"table align-middle gray-table"},jo={key:0},Oo=["value"],Lo={key:0},Ro={class:"d-flex gap-2"},qo=["onClick"],zo={class:"mt-4"},Go={class:"table align-middle gray-table side-table"},Yo={key:0,class:"block-bottom bg-light-teal"},Jo={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),f=e.computed(()=>E.value.PlanEndDate),a=e.computed(()=>Y("accessibility",g.value.Status,2)),o=e.ref({}),l=e.computed(()=>x.value.filter(d=>!d.Deleted)),c=e.computed(()=>_.value.filter(d=>!d.Deleted)),g=e.ref({}),E=e.ref({}),x=e.ref([]),_=e.ref([]),y=()=>F.accessibility("createItem",{ID:b.id}).subscribe(d=>x.value.push(d)),s=()=>_.value.push({Type:0,ItemID:0}),n=u,C=()=>{rxjs.forkJoin([F.accessibility("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];g.value=t.Project,E.value=t.GrantType,x.value=t.Items,_.value=t.Schedules,x.value.length||y(),_.value.length||s(),j().init("accessibility",g.value),m.value=g.value.changeApply,g.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=d=>{var V,k;if(o.value={},d&&!N()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:g.value,Items:x.value,Schedules:_.value,Before:(V=m.value)==null?void 0:V.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:d?"true":"false"};F.accessibility("saveWorkSchedule",t).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=I(g.value,d),d={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`item-${V}-`))),d={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},c.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`schedule-${V}-`))),m.value&&(d={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,I(m.value,d))),!Object.keys(o.value).length};return e.onMounted(C),e.provide("editable",a),(d,t)=>{const V=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),w=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),B=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",uo,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",ho,[e.createElementVNode("table",xo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",$o,[e.createElementVNode("div",Bo,[e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(g).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(g).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",_o,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Co,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",To,[e.createElementVNode("table",wo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",Do,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`item-${P}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",So,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",Ao,e.toDisplayString(e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`item-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Fo,[e.createElementVNode("div",Uo,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Po)):e.createCommentVNode("",!0),P+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Mo,[e.createElementVNode("table",Io,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",jo,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-Type`],options:i,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,Oo)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`schedule-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Lo,[e.createElementVNode("div",Ro,[e.unref(c).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,qo)):e.createCommentVNode("",!0),P+1===e.unref(c).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",zo,[e.createElementVNode("table",Go,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Yo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Qo={class:"block rounded-bottom-4"},Ho={class:"mt-4"},Wo={class:"table align-middle gray-table side-table"},Ko={class:"text-pink"},Xo={class:"table-responsive",style:{"min-height":"400px"}},Zo={class:"table teal-table"},vo={"data-th":"計畫編號／計畫名稱:",class:"text-start"},en=["href"],tn={"data-th":"查核日期／人員:",class:"text-start"},ln={"data-th":"風險評估:"},on={"data-th":"查核意見:",class:"text-start"},nn={"data-th":"執行單位回覆:",class:"text-start"},rn={__name:"AuditHistory",props:{name:{type:String}},setup(h){const u=h,b=e.ref([]),i=e.ref(0),m=["無","低風險","中風險","高風險"];return e.onMounted(()=>{F.system("getAuditHistory",{Name:u.name}).subscribe(f=>{b.value=f.List,b.value.forEach(a=>{switch(a.Risk){case"Low":a.lv=1,i.value<1&&(i.value=1);break;case"Medium":a.lv=2,i.value<2&&(i.value=2);break;case"High":a.lv=3,i.value<3&&(i.value=3);break}})})}),(f,a)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock("div",Qo,[a[3]||(a[3]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"查核紀錄")])])],-1)),e.createElementVNode("div",Ho,[e.createElementVNode("table",Wo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[a[0]||(a[0]=e.createElementVNode("th",null,"執行單位",-1)),e.createElementVNode("td",null,e.toDisplayString(h.name),1)]),e.createElementVNode("tr",null,[a[1]||(a[1]=e.createElementVNode("th",null,"風險評估",-1)),e.createElementVNode("td",null,[e.createElementVNode("span",Ko,e.toDisplayString(m[e.unref(i)]),1)])])])])]),e.createElementVNode("div",Xo,[e.createElementVNode("table",Zo,[a[2]||(a[2]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫編號／計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核日期／人員")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"風險評估")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核意見")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"執行單位回覆")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",vo,[e.createElementVNode("a",{class:"link-black",href:`AuditRecords.aspx?ProjectID=${l.ProjectID}`,target:"_blank"},e.toDisplayString(l.ProjectID)+"／"+e.toDisplayString(l.ProjectName),9,en)]),e.createElementVNode("td",tn,[e.createVNode(o,{value:l.CheckDate},null,8,["value"]),e.createTextVNode("／"+e.toDisplayString(l.ReviewerName),1)]),e.createElementVNode("td",ln,e.toDisplayString(m[l.lv]),1),e.createElementVNode("td",on,e.toDisplayString(l.ReviewerComment),1),e.createElementVNode("td",nn,e.toDisplayString(l.ExecutorComment),1)]))),128))])])])])}}},an={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},sn={class:"modal-content"},dn={class:"modal-body"},cn={class:"d-flex justify-content-center mt-4 gap-4"},mn={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},pn={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(h,{expose:u}){let b;const i=e.ref(),m=h,f=()=>{b&&b()};return u({show:o=>{b=o,bootstrap.Modal.getOrCreateInstance(i.value).show()}}),(o,l)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:i,tabindex:"-1"},[e.createElementVNode("div",an,[e.createElementVNode("div",sn,[l[0]||(l[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",dn,[e.renderSlot(o.$slots,"default"),e.createElementVNode("div",cn,[e.createElementVNode("button",mn,e.toDisplayString(m.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:f,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(m.confirm),1)])])])])],512)]))}},Vn={class:"application-step"},fn=["onClick"],Nn={class:"step-content"},En={class:"step-label"},bn={key:0,class:"step-status edit"},gn={key:1,class:"step-status"},yn={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(h,{emit:u}){const b=e.computed(()=>Y(m.type,i[m.type].status,m.step)),i=j(),m=h,f=o=>{m.review?a("click",o.step):o.step<=i[m.type].step&&(location.href=`${o.url}.aspx?ID=${m.id}`)},a=u;return(o,l)=>(e.openBlock(),e.createElementBlock("div",Vn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.steps,c=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(b)&&(c.step<e.unref(i)[h.type].step||c.step===h.step)}]),onClick:g=>f(c),key:c,role:"button"},[e.createElementVNode("div",Nn,[e.createElementVNode("div",En,e.toDisplayString(c.title),1),e.unref(b)&&c.step===h.step?(e.openBlock(),e.createElementBlock("div",bn,"編輯中")):c.step<e.unref(i)[h.type].step?(e.openBlock(),e.createElementBlock("div",gn,"已完成")):e.createCommentVNode("",!0)])],10,fn))),128))]))}},kn={class:"block"},un={class:"mt-4"},hn={class:"table align-middle gray-table side-table"},xn={key:0},$n={key:1,class:"text-light-gray"},Bn={class:"d-flex gap-2"},_n={key:0,class:"invalid mt-0"},Cn={class:"d-flex flex-column gap-2"},Tn={key:0},wn={class:"mt-4"},Dn={class:"table align-middle gray-table side-table"},Sn={class:"row g-3"},An={class:"col-12 col-xl-2"},Fn={class:"text-gray mb-2"},Un={class:"col-12 col-xl-3"},Pn={class:"text-gray mb-2"},Mn={class:"col-12 col-xl-4"},In={class:"row g-1"},jn={class:"col-7"},On={class:"col-5"},Ln={class:"col-12 col-xl-3"},Rn={class:"text-gray mb-2"},qn={class:"col-12"},zn={class:"text-gray mb-2"},Gn={class:"mt-4"},Yn={class:"table align-middle gray-table side-table"},Jn={class:"mt-4"},Qn={class:"table align-middle gray-table side-table"},Hn={key:0,class:"table-responsive mt-3 mb-0"},Wn={class:"table align-middle gray-table"},Kn={key:0},Xn={key:0},Zn={class:"d-flex gap-2"},vn=["onClick"],er={class:"mt-4"},tr={class:"table align-middle gray-table side-table"},lr={key:0,class:"block-bottom bg-light-teal"},or={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.ref(),a=e.computed(()=>Y("culture",E.value.Status,1)),o=e.ref({}),l=e.ref(null),c=e.ref([]),g=e.computed(()=>_.value.filter(t=>!t.Deleted)),E=e.ref({}),x=e.computed(()=>c.value.filter(t=>!t.ParentCode)),_=e.ref([]),y=e.computed(()=>c.value.filter(t=>t.ParentCode===l.value)),s=e.computed({get:()=>!!g.value.length,set:t=>{t?n():_.value.forEach(V=>V.Deleted=!0)}}),n=()=>_.value.push({}),C=u,p=()=>{F.culture("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(t=>{var V;E.value=t.Project,f.value=t.Contacts,_.value=t.ReceivedSubsidies,l.value=((V=c.value.find(k=>k.Code===E.value.Field))==null?void 0:V.ParentCode)||null,E.value.OrgCategory=E.value.OrgCategory||null,j().init("culture",E.value),m.value=E.value.changeApply,E.value.changeApply=void 0})},r=t=>t.Deleted=!0,N=t=>{var k,S;if(o.value={},t&&!d()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const V={Project:E.value,Contacts:f.value,ReceivedSubsidies:_.value.filter(w=>w.ID||!w.Deleted),Before:(k=m.value)==null?void 0:k.Form1Before,After:(S=m.value)==null?void 0:S.Form1After,Submit:t?"true":"false"};F.culture("saveApplication",V).subscribe(w=>{t?C("next",w.ID):E.value.ID?p():window.location.href=`Application.aspx?ID=${w.ID}`})},d=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return E.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),o.value=I(E.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((V,k)=>Object.assign(o.value,I(V,t,`contact-${k}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},_.value.forEach((V,k)=>Object.assign(o.value,I(V,t,`received-${k}-`))),m.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,I(m.value,t))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.culture("getZgsCodes",{CodeGroup:"CULField"}),F.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{c.value=t[0],i.value=t[1],b.id?p():F.culture("getEmptyApplication").subscribe(V=>{l.value=null,E.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},V),f.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("culture",E.value)})})}),e.provide("editable",a),e.watch(l,()=>{l.value?y.value.find(t=>E.value.Field===t.Code)||(E.value.Field=y.value[0].Code):E.value.Field=null}),(t,V)=>{const k=e.resolveComponent("required-label"),S=e.resolveComponent("input-text"),w=e.resolveComponent("input-select"),D=e.resolveComponent("input-textarea"),B=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kn,[V[45]||(V[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",un,[e.createElementVNode("table",hn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[17]||(V[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[V[18]||(V[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",xn,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",$n,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[V[19]||(V[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[20]||(V[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":V[0]||(V[0]=T=>e.unref(E).ProjectName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[21]||(V[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Bn,[e.createVNode(w,{"empty-value":null,options:e.unref(x),"text-name":"Descname","value-name":"Code",modelValue:e.unref(l),"onUpdate:modelValue":V[1]||(V[1]=T=>e.isRef(l)?l.value=T:null)},null,8,["options","modelValue"]),e.createVNode(w,{"empty-value":null,disabled:!e.unref(l),options:e.unref(y),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).Field,"onUpdate:modelValue":V[2]||(V[2]=T=>e.unref(E).Field=T)},null,8,["disabled","options","modelValue"])]),e.unref(o).Field?(e.openBlock(),e.createElementBlock("div",_n,e.toDisplayString(e.unref(o).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[22]||(V[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":V[3]||(V[3]=T=>e.unref(E).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[23]||(V[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Cn,[e.createElementVNode("div",null,[e.createVNode(w,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(i),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":V[4]||(V[4]=T=>e.unref(E).OrgCategory=T)},null,8,["error","options","modelValue"])]),e.unref(E).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",Tn,[e.createVNode(S,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(E).RegisteredNum,"onUpdate:modelValue":V[5]||(V[5]=T=>e.unref(E).RegisteredNum=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[24]||(V[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":V[6]||(V[6]=T=>e.unref(E).TaxID=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[25]||(V[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":V[7]||(V[7]=T=>e.unref(E).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),V[46]||(V[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",wn,[e.createElementVNode("table",Dn,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Sn,[e.createElementVNode("div",An,[e.createElementVNode("div",Fn,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[26]||(V[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(o)[`contact-${P}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Un,[e.createElementVNode("div",Pn,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[27]||(V[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(o)[`contact-${P}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":U=>T.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Mn,[V[28]||(V[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",In,[e.createElementVNode("div",jn,[e.createVNode(S,{modelValue:T.Phone,"onUpdate:modelValue":U=>T.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",On,[e.createVNode(S,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":U=>T.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Ln,[e.createElementVNode("div",Rn,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[29]||(V[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(o)[`contact-${P}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":U=>T.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",qn,[e.createElementVNode("div",zn,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[30]||(V[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(o)[`contact-${P}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":U=>T.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),V[47]||(V[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Gn,[e.createElementVNode("table",Yn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[31]||(V[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[V[32]||(V[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2025國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(D,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(E).Target,"onUpdate:modelValue":V[8]||(V[8]=T=>e.unref(E).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[33]||(V[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":V[9]||(V[9]=T=>e.unref(E).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[34]||(V[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":V[10]||(V[10]=T=>e.unref(E).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[35]||(V[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Qualitative,"onUpdate:modelValue":V[11]||(V[11]=T=>e.unref(E).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Jn,[e.createElementVNode("table",Qn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[41]||(V[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(B,{modelValue:e.unref(s),"onUpdate:modelValue":V[12]||(V[12]=T=>e.isRef(s)?s.value=T:null)},null,8,["modelValue"]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",Hn,[e.createElementVNode("table",Wn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[V[36]||(V[36]=e.createElementVNode("th",null,"計畫名稱",-1)),V[37]||(V[37]=e.createElementVNode("th",null,"補助單位",-1)),V[38]||(V[38]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",Kn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o)[`received-${P}-Name`],modelValue:T.Name,"onUpdate:modelValue":U=>T.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o)[`received-${P}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":U=>T.Unit=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(o)[`received-${P}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":U=>T.Amount=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Xn,[e.createElementVNode("div",Zn,[e.unref(g).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>r(T),type:"button"},[...V[39]||(V[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vn)):e.createCommentVNode("",!0),P+1===e.unref(g).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:n,type:"button"},[...V[40]||(V[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[V[44]||(V[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",er,[e.createElementVNode("table",tr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[42]||(V[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":V[13]||(V[13]=T=>e.unref(m).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...V[43]||(V[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":V[14]||(V[14]=T=>e.unref(m).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",lr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[15]||(V[15]=T=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[16]||(V[16]=T=>N(!0)),type:"button"},[...V[48]||(V[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},nr={class:"block"},rr={key:0,class:"text-pink lh-base mt-4"},ar={class:"mt-4"},sr={class:"table align-middle gray-table"},dr={class:"text-center"},cr={key:0,width:"180"},ir={class:"text-center"},mr={key:0},pr=["innerHTML"],Vr=["href"],fr={key:0,class:"text-center"},Nr={key:0},Er={key:1,class:"text-pink"},br={key:1,class:"tag-group mt-2 gap-1"},gr={key:0,class:"tag tag-green-light"},yr=["download","href"],kr=["onClick"],ur={key:1,class:"text-center mt-4"},hr={class:"mt-4"},xr={class:"table align-middle gray-table side-table"},$r={key:0,class:"block-bottom bg-light-teal"},Br=["disabled"],_r={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=4&id=${b.id}`,Files:[],Excludes:["1"]},{Type:5,Title:"附錄",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),f=e.computed(()=>i.value.some(s=>!s.Optional&&!s.Files.filter(n=>!n.Deleted).length)),a=e.computed(()=>Y("culture",l.value.Status,5)),o=e.ref({}),l=e.ref({}),c=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:l.value.ProjectID+"_"+(s.Multiple?n.Name:`${s.Title}.pdf`)})},g=F.download,E=u,x=()=>{rxjs.forkJoin([F.culture("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=i.value.filter(C=>{var p;return!((p=C.Excludes)!=null&&p.includes(l.value.OrgCategory))}),l.value.Status>=42&&i.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/CUL/5.海洋委員會補助計畫著作權授權同意書.docx",Files:[]}),i.value.forEach(C=>{C.Files=n.Attachments.filter(p=>p.Type===C.Type),C.Uploaded=e.computed(()=>C.Files.filter(p=>!p.Deleted).length)}),j().init("culture",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=s=>{var C,p;if(o.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Attachments:i.value.reduce((r,N)=>r.concat(N.Files),[]),Before:(C=m.value)==null?void 0:C.Form5Before,After:(p=m.value)==null?void 0:p.Form5After,Submit:s?"true":"false"};F.culture("saveAttachment",n).subscribe(r=>{r&&(s?E("next",x):x())})},y=()=>{if(m.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,I(m.value,s))}return!Object.keys(o.value).length};return e.onMounted(x),e.provide("editable",a),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file"),r=e.resolveComponent("tw-date-time"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nr,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("p",rr,[...n[4]||(n[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",ar,[e.createElementVNode("table",sr,[e.createElementVNode("thead",dr,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",cr,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",ir,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",mr,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(C,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(a)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,pr)):e.createCommentVNode("",!0),e.unref(a)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:d.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Vr)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",fr,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",Nr,"已上傳")):(e.openBlock(),e.createElementBlock("span",Er,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:V=>c(d,V)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",br,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,V=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:V},[V.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",gr,[e.createElementVNode("a",{class:"tag-link my-1",download:V.Name,href:e.unref(g)(V.Path)},e.toDisplayString(V.Name),9,yr),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>V.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,kr)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(l).ApplyTime?(e.openBlock(),e.createElementBlock("div",ur,[n[10]||(n[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(r,{value:e.unref(l).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",hr,[e.createElementVNode("table",xr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(m).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(m).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",$r,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),disabled:e.unref(f),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Br)])):e.createCommentVNode("",!0)],64)}}},Cr={class:"block"},Tr={class:"mt-4"},wr={class:"table-responsive mt-3 mb-0"},Dr={class:"table align-middle gray-table"},Sr={class:"text-end"},Ar={class:"text-end"},Fr={class:"table-responsive"},Ur={class:"table align-middle gray-table"},Pr=["colspan"],Mr={key:0,width:"1"},Ir={key:0},jr={class:"d-flex gap-2"},Or=["onClick"],Lr={class:"mt-4"},Rr={class:"table-responsive mt-3 mb-0"},qr={class:"table align-middle gray-table"},zr={key:0,width:"1"},Gr={class:"text-end"},Yr={key:0},Jr={class:"d-flex gap-2"},Qr=["onClick"],Hr={class:"mt-4"},Wr={class:"table align-middle gray-table side-table"},Kr={key:0,class:"block-bottom bg-light-teal"},Xr={class:"text-center"},Zr={class:"mb-5"},vr={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("culture",l.value.Status,3)),f=e.ref({}),a=e.computed(()=>E.value.filter(V=>!V.Deleted)),o=e.computed(()=>x.value.filter(V=>!V.Deleted)),l=e.ref({}),c=e.ref([]),g=e.ref(),E=e.ref([]),x=e.ref([]),_=e.ref({}),y=e.ref(0),s=()=>E.value.push({}),n=()=>x.value.push({ItemID:0}),C=u,p=()=>{rxjs.forkJoin([F.culture("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(V=>{const k=V[0];l.value=k.Project,E.value=k.OtherSubsidies,x.value=k.BudgetPlans,c.value=k.Items,_.value=k.GrantTargetSetting,x.value.length||n(),j().init("culture",l.value),i.value=l.value.changeApply,l.value.changeApply=void 0})},r=V=>V.Deleted=!0,N=V=>V.Deleted=!0,d=(V,k)=>{var w,D;if(f.value={},V&&!t()){e.nextTick(()=>{var B;return(B=document.querySelector(".invalid"))==null?void 0:B.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!k&&l.value.ApplyAmount>_.value.GrantLimit*1e4){g.value.show(()=>d(V,!0));return}const S={Project:l.value,OtherSubsidies:E.value,BudgetPlans:x.value,Before:(w=i.value)==null?void 0:w.Form3Before,After:(D=i.value)==null?void 0:D.Form3After,Submit:V?"true":"false"};F.culture("saveFunding",S).subscribe(()=>{V?C("next"):p()})},t=()=>{let V={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=I(l.value,V),V={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},a.value.forEach((k,S)=>Object.assign(f.value,I(k,V,`other-${S}-`))),V={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((k,S)=>Object.assign(f.value,I(k,V,`plan-${S}-`))),i.value&&(V={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,I(i.value,V))),!Object.keys(f.value).length};return e.onMounted(p),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=E.value.reduce((V,k)=>V+(k.Deleted?0:q(k.Amount)),0),y.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),x.value.forEach(V=>V.sum=q(V.Amount)+q(V.OtherAmount))}),(V,k)=>{var P;const S=e.resolveComponent("input-integer"),w=e.resolveComponent("input-text"),D=e.resolveComponent("input-select"),B=e.resolveComponent("input-textarea"),A=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Cr,[k[25]||(k[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Tr,[e.createElementVNode("div",wr,[e.createElementVNode("table",Dr,[k[6]||(k[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(l).ApplyAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(l).SelfAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",Sr,e.toDisplayString((P=e.unref(l).OtherAmount)==null?void 0:P.toLocaleString()),1),e.createElementVNode("td",Ar,e.toDisplayString(e.unref(y).toLocaleString()),1)])])])]),k[12]||(k[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體者，配合款比例應為計畫總經費5%"),e.createElementVNode("li",null,"補助申請單位為各級學校者，配合款比例得為計畫總經費0%"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之20%以上")],-1)),e.createElementVNode("div",Fr,[e.createElementVNode("table",Ur,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Pr)]),e.createElementVNode("tr",null,[k[7]||(k[7]=e.createElementVNode("th",{width:"1"},null,-1)),k[8]||(k[8]=e.createElementVNode("th",null,"單位名稱",-1)),k[9]||(k[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Mr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(U,L)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,e.toDisplayString(L+1),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`other-${L}-Unit`],modelValue:U.Unit,"onUpdate:modelValue":O=>U.Unit=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`other-${L}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Ir,[e.createElementVNode("div",jr,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:O=>r(U),type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Or)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...k[11]||(k[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),k[26]||(k[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Lr,[e.createElementVNode("div",Rr,[e.createElementVNode("table",qr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[k[13]||(k[13]=e.createElementVNode("th",null,"重要工作項目",-1)),k[14]||(k[14]=e.createElementVNode("th",null,"預算項目",-1)),k[15]||(k[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),k[16]||(k[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),k[17]||(k[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),k[18]||(k[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",zr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,L)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,[e.createVNode(D,{"empty-value":0,error:e.unref(f)[`plan-${L}-ItemID`],options:e.unref(c),"text-name":"Title","value-name":"ID",modelValue:U.ItemID,"onUpdate:modelValue":O=>U.ItemID=O},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(f)[`plan-${L}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`plan-${L}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`plan-${L}-OtherAmount`],modelValue:U.OtherAmount,"onUpdate:modelValue":O=>U.OtherAmount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Gr,e.toDisplayString(U.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(f)[`plan-${L}-Description`],rows:"1",modelValue:U.Description,"onUpdate:modelValue":O=>U.Description=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Yr,[e.createElementVNode("div",Jr,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>N(U),type:"button"},[...k[19]||(k[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Qr)):e.createCommentVNode("",!0),L+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:n,type:"button"},[...k[20]||(k[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),k[21]||(k[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[24]||(k[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Hr,[e.createElementVNode("table",Wr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...k[22]||(k[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(i).Form3Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(i).Form3Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...k[23]||(k[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(i).Form3After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(i).Form3After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Kr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>d(!0)),type:"button"},[...k[27]||(k[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:g},{default:e.withCtx(()=>[e.createElementVNode("div",Xr,[k[28]||(k[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Zr,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),k[29]||(k[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),k[30]||(k[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},ea={class:"block"},ta={key:0,class:"text-pink lh-base mt-3"},la={class:"border"},oa={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},na={class:"d-flex gap-2 align-items-center flex-grow-1"},ra={class:"text-nowrap"},aa={class:"flex-grow-1"},sa={class:"d-flex gap-2"},da=["onClick"],ca=["href"],ia=["id"],ma={class:"table align-middle gray-table side-table mb-0"},pa={class:"mt-4"},Va={class:"table align-middle gray-table side-table"},fa={key:0,class:"block-bottom bg-light-teal"},Na={__name:"Other",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("culture",a.value.Status,4)),f=e.ref({}),a=e.ref({}),o=e.ref([]),l=e.computed(()=>o.value.filter(s=>!s.Deleted)),c=()=>o.value.push({}),g=u,E=()=>{rxjs.forkJoin([F.culture("getRelatedProject",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];a.value=n.Project,o.value=n.Projects,j().init("culture",a.value),i.value=a.value.changeApply,a.value.changeApply=void 0})},x=s=>s.Deleted=!0,_=s=>{var C,p;if(f.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Projects:o.value,Before:(C=i.value)==null?void 0:C.Form4Before,After:(p=i.value)==null?void 0:p.Form4After,Submit:s?"true":"false"};F.culture("saveRelatedProject",n).subscribe(()=>{s?g("next"):E()})},y=()=>{let s={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return l.value.forEach((n,C)=>Object.assign(f.value,I(n,s,`project-${C}-`))),i.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(f.value,I(i.value,s))),!Object.keys(f.value).length};return e.onMounted(E),e.provide("editable",m),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-text"),r=e.resolveComponent("input-integer"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ea,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("p",ta," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(d,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:d},[e.createElementVNode("div",la,[e.createElementVNode("div",oa,[e.createElementVNode("div",na,[e.createElementVNode("label",ra,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[4]||(n[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",aa,[e.createVNode(p,{error:e.unref(f)[`project-${t}-Title`],modelValue:d.Title,"onUpdate:modelValue":V=>d.Title=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",sa,[e.unref(m)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(V=>x(d),["prevent"]),href:"#"},"刪除",8,da)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,ca)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",ma,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[5]||(n[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{class:"text-start w-auto",error:e.unref(f)[`project-${t}-Year`],modelValue:d.Year,"onUpdate:modelValue":V=>d.Year=V},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[6]||(n[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(f)[`project-${t}-OrgName`],modelValue:d.OrgName,"onUpdate:modelValue":V=>d.OrgName=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[7]||(n[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{class:"w-auto",error:e.unref(f)[`project-${t}-Amount`],modelValue:d.Amount,"onUpdate:modelValue":V=>d.Amount=V},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[8]||(n[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(f)[`project-${t}-Description`],rows:"4",modelValue:d.Description,"onUpdate:modelValue":V=>d.Description=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[9]||(n[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(f)[`project-${t}-Benefit`],rows:"4",modelValue:d.Benefit,"onUpdate:modelValue":V=>d.Benefit=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,ia)])]))),128)),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:c,type:"button"},[...n[10]||(n[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",pa,[e.createElementVNode("table",Va,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(f).Form4Before,rows:"4",modelValue:e.unref(i).Form4Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(i).Form4Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(f).Form4After,rows:"4",modelValue:e.unref(i).Form4After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(i).Form4After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",fa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ea={class:"block"},ba={class:"square-title"},ga={class:"text-teal fw-bold py-3"},ya={class:"table-responsive mb-0"},ka={class:"table align-middle gray-table"},ua={class:"text-end"},ha={class:"text-end"},xa={class:"text-end"},$a={class:"text-teal fw-bold pb-3"},Ba={class:"text-teal fw-bold pb-3"},_a={class:"mt-4"},Ca={class:"table align-middle gray-table"},Ta={class:"text-center"},wa={key:0,width:"180"},Da={class:"text-center"},Sa=["href"],Aa={key:0,class:"text-center"},Fa={key:0},Ua={key:1,class:"text-pink"},Pa={key:1,class:"tag-group mt-2 gap-1"},Ma={key:0,class:"tag tag-green-light"},Ia=["download","href"],ja=["onClick"],Oa={key:0,class:"block-bottom bg-light-teal"},La=["disabled"],Ra={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>i.value<=0||x.value.some(p=>!p.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),a=e.computed(()=>{var p;return((p=l.value)==null?void 0:p.Status)==="通過"}),o=e.ref(0),l=e.ref(),c=e.ref({}),g=e.computed(()=>c.value.ApprovedAmount?Math.min(Math.round(i.value*100/c.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>a.value?Math.round(i.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),x=e.ref([{Type:11,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:12,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),_=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:`${c.value.ProjectID}_第一期請款_${p.Title}.pdf`})},y=F.download,s=u,n=()=>{F.culture("getPayment",{ID:b.id}).subscribe(p=>{c.value=p.Project,j().init("culture",c.value),x.value=x.value.filter(r=>{var N;return!((N=r.Excludes)!=null&&N.includes(c.value.OrgCategory))}),x.value.forEach(r=>{r.Files=p.Attachments.filter(N=>N.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(N=>!N.Deleted).length)}),l.value=p.Payments.find(r=>r.Stage===1),l.value&&(i.value=l.value.TotalSpentAmount),o.value=Math.round(c.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),H().init(l.value)})},C=p=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:x.value.reduce((N,d)=>N.concat(d.Files),[]),Submit:p?"true":"false"};F.culture("savePayment",r).subscribe(N=>{N&&(p?s("next",n):n())})};return e.onMounted(n),e.provide("editable",f),(p,r)=>{var V;const N=e.resolveComponent("input-integer"),d=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ea,[e.createElementVNode("h5",ba,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",ga,"核定經費: "+e.toDisplayString((V=e.unref(c).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("div",ya,[e.createElementVNode("table",ka,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",ua,e.toDisplayString(e.unref(i)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(N,{max:e.unref(o),modelValue:e.unref(i),"onUpdate:modelValue":r[0]||(r[0]=k=>e.isRef(i)?i.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",ha,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",xa,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",$a,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ba,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",_a,[e.createElementVNode("table",Ca,[e.createElementVNode("thead",Ta,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",wa,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Da,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(f)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Sa)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Aa,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Fa,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ua,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:w=>_(k,w)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",Pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,w=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:w},[w.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ma,[e.createElementVNode("a",{class:"tag-link my-1",download:w.Name,href:e.unref(y)(w.Path)},e.toDisplayString(w.Name),9,Ia),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>w.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ja)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Oa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=k=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=k=>C(!0)),disabled:e.unref(m),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,La)])):e.createCommentVNode("",!0)],64)}}},qa={class:"block"},za={class:"square-title"},Ga={class:"text-teal fw-bold py-3"},Ya={class:"text-teal fw-bold pb-3"},Ja={class:"table-responsive mb-0"},Qa={class:"table align-middle gray-table"},Ha={class:"text-end"},Wa={class:"text-end"},Ka={class:"text-end"},Xa={class:"text-end"},Za={class:"text-teal fw-bold pb-3"},va={class:"text-teal fw-bold pb-3"},es={class:"mt-4"},ts={class:"table align-middle gray-table"},ls={class:"text-center"},os={key:0,width:"180"},ns={class:"text-center"},rs=["href"],as={key:0,class:"text-center"},ss={key:0},ds={key:1,class:"text-pink"},cs={key:1,class:"tag-group mt-2 gap-1"},is={key:0,class:"tag tag-green-light"},ms=["download","href"],ps=["onClick"],Vs={key:0,class:"block-bottom bg-light-teal"},fs=["disabled"],Ns={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>i.value<=0||s.value.some(d=>!d.Files.filter(t=>!t.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),a=e.computed(()=>{var d;return((d=l.value)==null?void 0:d.Status)==="通過"}),o=e.ref(0),l=e.ref(),c=e.ref(0),g=e.ref(0),E=e.ref({}),x=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(i.value*100/E.value.ApprovedAmount*100)/100,100):0),_=e.computed(()=>y.value?Math.round(i.value*100/y.value*100)/100:0),y=e.computed(()=>g.value+(a.value?l.value.CurrentActualPaidAmount:0)),s=e.ref([{Type:21,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:22,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:23,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:24,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),n=(d,t)=>{t.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${d.Title}.pdf`})},C=F.download,p=u,r=()=>{F.culture("getPayment",{ID:b.id}).subscribe(d=>{E.value=d.Project,j().init("culture",E.value),s.value=s.value.filter(V=>{var k;return!((k=V.Excludes)!=null&&k.includes(E.value.OrgCategory))}),s.value.forEach(V=>{V.Files=d.Attachments.filter(k=>k.Type===V.Type),V.Uploaded=e.computed(()=>V.Files.filter(k=>!k.Deleted).length)}),l.value=d.Payments.find(V=>V.Stage===2),l.value&&(i.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=d.Payments.filter(V=>V.Stage<2&&V.Status==="通過");c.value=t.reduce((V,k)=>V+k.CurrentRequestAmount,0),g.value=t.reduce((V,k)=>V+k.CurrentActualPaidAmount,0),H().init(l.value,g.value)})},N=d=>{const t={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:s.value.reduce((V,k)=>V.concat(k.Files),[]),Submit:d?"true":"false"};F.culture("savePayment",t).subscribe(V=>{V&&(d?p("next",r):r())})};return e.onMounted(r),e.provide("editable",f),(d,t)=>{var w;const V=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),S=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",qa,[e.createElementVNode("h5",za,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",Ga,"核定經費: "+e.toDisplayString((w=e.unref(E).ApprovedAmount)==null?void 0:w.toLocaleString())+"元",1),e.createElementVNode("p",Ya,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(i)).toLocaleString())+"元",1),e.createElementVNode("div",Ja,[e.createElementVNode("table",Qa,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Ha,e.toDisplayString(e.unref(i)-e.unref(c)),1),e.createElementVNode("td",Wa,e.toDisplayString(e.unref(g)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(o),modelValue:e.unref(i),"onUpdate:modelValue":t[0]||(t[0]=D=>e.isRef(i)?i.value=D:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Ka,e.toDisplayString(e.unref(x))+"%",1),e.createElementVNode("td",Xa,e.toDisplayString(e.unref(_))+"%",1)])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Za,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",va,"累積實際撥款: "+e.toDisplayString(e.unref(y).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",es,[e.createElementVNode("table",ts,[e.createElementVNode("thead",ls,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",os,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(D,B)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",ns,e.toDisplayString(B+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Title),1)]),_:2},1024)]),e.unref(f)&&D.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:D.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,rs)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",as,[D.Uploaded?(e.openBlock(),e.createElementBlock("span",ss,"已上傳")):(e.openBlock(),e.createElementBlock("span",ds,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!D.Uploaded?(e.openBlock(),e.createBlock(S,{key:0,accept:".pdf",onFile:A=>n(D,A)},null,8,["onFile"])):e.createCommentVNode("",!0),D.Uploaded?(e.openBlock(),e.createElementBlock("div",cs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",is,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(C)(A.Path)},e.toDisplayString(A.Name),9,ms),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>A.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ps)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Vs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=D=>N()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=D=>N(!0)),disabled:e.unref(m),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,fs)])):e.createCommentVNode("",!0)],64)}}},Es={class:"block rounded-top-4"},bs={class:"horizontal-scrollable"},gs={class:"timeline"},ys={class:"year"},ks={class:"month"},us=["onClick"],hs={class:"square-title"},xs={class:"table-responsive mt-4"},$s={class:"table align-middle gray-table"},Bs={class:"text-end"},_s={class:"table-responsive"},Cs={class:"table align-middle gray-table"},Ts={class:"text-end"},ws={key:0,class:"invalid mt-0"},Ds={class:"mt-3"},Ss={class:"mt-3"},As=["rowspan"],Fs={key:0,class:"block-bottom bg-light-teal"},Us={__name:"Progress",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],i=h,m=e.ref(),f=e.ref({}),a=e.ref(0),o=e.ref({}),l=e.ref([]),c=e.ref({}),g=e.computed(()=>Math.round((a.value+l.value.filter(p=>p.Status===3).length)*100/E.value.length*10)/10),E=e.ref([]),x=e.ref([]),_=p=>{m.value=p,s()},y=u,s=()=>{F.culture("getMonthlyProgress",{ID:i.id,Year:m.value.year-1911,Month:m.value.month}).subscribe(p=>{const r=p.Logs,N=p.Items,d=p.Steps;let t=!1;a.value=0,c.value=p.Progress,E.value=p.Schedules,l.value=[],x.value.forEach(V=>{V.months.forEach(k=>{t||(k===m.value&&(t=!0),E.value.forEach(S=>{var w,D;if(S.Month===k.month)if(t||S.Status!==3){const B=r.find(A=>A.ScheduleID===S.ID)||{ScheduleID:S.ID,Status:S.Status};l.value.push(Object.assign(B,{Year:V.year,Month:S.Month,ItemTitle:(w=N.find(A=>A.ID===S.ItemID))==null?void 0:w.Title,Type:S.Type,StepTitle:(D=d.find(A=>A.ID===S.StepID))==null?void 0:D.Title}))}else a.value++}))})})})},n=p=>{if(f.value={},p&&!C()){e.nextTick(()=>{var N;return(N=document.querySelector(".invalid"))==null?void 0:N.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={ID:c.value.ID,Description:c.value.Description||"",Status:p?1:0,Logs:l.value.map(N=>({ID:N.ID||0,ScheduleID:N.ScheduleID,Status:N.Status,DelayReason:N.DelayReason||"",ImprovedWay:N.ImprovedWay||""}))};F.culture("saveMonthlyProgress",r).subscribe(N=>{N&&p&&y("next")})},C=()=>{let p={Description:"實際工作執行情形"};return f.value=I(c.value,p),l.value.forEach((r,N)=>{p={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(r.Status)&&(p.DelayReason="落後原因",p.ImprovedWay="改善措施"),Object.assign(f.value,I(r,p,`item-${N}-`))}),!Object.keys(f.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.culture("getApplication",{ID:i.id}),F.culture("getSubmitedMonthlyProgress",{ID:i.id})]).subscribe(p=>{o.value=p[0].Project,j().init("culture",o.value);const r=new Date(o.value.StartTime),N=new Date(o.value.EndTime),d=Date.now();for(;;){const k=r.getFullYear(),S=r.getMonth(),w={year:k,month:S+1,disabled:new Date(k,S,20).getTime()>d};let D=x.value.find(B=>B.year===k);if(D?D.months.push(w):x.value.push({year:k,months:[w]}),k*100+S>=N.getFullYear()*100+N.getMonth())break;r.setMonth(S+1)}let t=!1;const V=p[1].List;x.value.forEach(k=>{k.months.forEach(S=>{!t&&!V.some(w=>w.Year===S.year-1911&&w.Month===S.month)&&(t=!0,_(S))})}),t||_(x.value[0].months[0])})}),(p,r)=>{const N=e.resolveComponent("input-textarea"),d=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Es,[e.createElementVNode("div",bs,[r[3]||(r[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),t=>(e.openBlock(),e.createElementBlock("li",{key:t},[e.createElementVNode("span",ys,e.toDisplayString(t.year-1911)+"年",1),e.createElementVNode("ul",ks,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.months,V=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(m)===V,disabled:V.disabled}),key:V},[e.createElementVNode("a",{onClick:k=>_(V),href:"javascript:void(0)"},e.toDisplayString(V.month)+"月",9,us)],2))),128))])]))),128))]),r[4]||(r[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",hs,e.toDisplayString(e.unref(m).year-1911)+"年"+e.toDisplayString(e.unref(m).month)+"月 實際進度",1),e.createElementVNode("div",xs,[e.createElementVNode("table",$s,[r[5]||(r[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Bs,e.toDisplayString(e.unref(m).year-1911)+"年"+e.toDisplayString(e.unref(m).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(f).Description,rows:"4",modelValue:e.unref(c).Description,"onUpdate:modelValue":r[0]||(r[0]=t=>e.unref(c).Description=t),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",_s,[e.createElementVNode("table",Cs,[r[8]||(r[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(t,V)=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("th",Ts,e.toDisplayString(t.Year-1911)+"年"+e.toDisplayString(t.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(t.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(t.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(t.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(d,{options:b,modelValue:t.Status,"onUpdate:modelValue":k=>t.Status=k},null,8,["modelValue","onUpdate:modelValue"]),e.unref(f)[`item-${V}-Status`]?(e.openBlock(),e.createElementBlock("div",ws,e.toDisplayString(e.unref(f)[`item-${V}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(t.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",Ds,[r[6]||(r[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(N,{error:e.unref(f)[`item-${V}-DelayReason`],rows:"1",modelValue:t.DelayReason,"onUpdate:modelValue":k=>t.DelayReason=k,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ss,[r[7]||(r[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(N,{error:e.unref(f)[`item-${V}-ImprovedWay`],rows:"1",modelValue:t.ImprovedWay,"onUpdate:modelValue":k=>t.ImprovedWay=k,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),V?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(l).length},e.toDisplayString(e.unref(g))+"% ",9,As))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Fs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=t=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=t=>n(!0)),type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ps={__name:"ProgressBar",setup(h){const u=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,i)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:u,type:"culture"})}}},ne=(h,u)=>{const b=h.__vccOpts||h;for(const[i,m]of u)b[i]=m;return b},Ms={class:"block"},Is={class:"mt-4"},js={class:"table align-middle gray-table side-table"},Os={key:0,class:"d-flex align-items-center gap-2"},Ls={class:"input-group w-auto"},Rs={class:"text-teal-dark"},qs={key:1,class:"invalid mt-0"},zs={class:"square-title mt-4"},Gs={class:"mt-4"},Ys=["onClick"],Js={class:"d-flex flex-column gap-2"},Qs={class:"mt-4 d-flex flex-column gap-2"},Hs={class:"d-flex flex-column gap-3 mt-4"},Ws={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Ks={class:"d-flex gap-2 align-items-center flex-grow-1"},Xs={class:"text-nowrap"},Zs={class:"flex-grow-1"},vs={class:"d-flex gap-2"},ed=["onClick"],td=["href"],ld=["id"],od={class:"table align-middle gray-table side-table mb-0"},nd={class:"p-0"},rd={class:"item-list"},ad={class:"mt-2 align-self-start text-center"},sd={class:"input-group"},dd={key:0,class:"invalid mt-0"},cd={key:0,class:"d-flex gap-2 mt-1 align-self-start"},id=["onClick"],md=["onClick"],pd={class:"row"},Vd={class:"col"},fd=["value"],Nd={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Ed=["onClick"],bd=["onClick"],gd={class:"col"},yd=["value"],kd={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},ud=["onClick"],hd=["onClick"],xd=["onClick"],$d={class:"mt-4"},Bd={class:"table align-middle gray-table side-table"},_d={key:0,class:"block-bottom bg-light-teal"},Cd=ne({__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("culture",l.value.Status,2)),f=e.computed(()=>g.value.PlanEndDate),a=e.ref({}),o=e.computed(()=>c.value.filter(V=>!V.Deleted)),l=e.ref({}),c=e.ref([]),g=e.ref({}),E=()=>{F.culture("createGoal",{ID:b.id}).subscribe(V=>{c.value.push(Object.assign(V,{Items:[]}));const k=c.value[c.value.length-1];x(k)})},x=V=>{F.culture("createGoalItem",{ID:b.id,GoalID:V.ID}).subscribe(k=>{V.Items.push(Object.assign(k,{Steps:[],Schedules:[]}));const S=V.Items[V.Items.length-1];y(S),y(S),y(S),_(S,1),_(S,2)})},_=(V,k)=>F.culture("createGoalSchedule",{ID:b.id,ItemID:V.ID,Type:k}).subscribe(S=>V.Schedules.push(S)),y=V=>F.culture("createGoalStep",{ID:b.id,ItemID:V.ID}).subscribe(k=>V.Steps.push(k)),s=u,n=()=>{rxjs.forkJoin([F.culture("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(V=>{const k=V[0];l.value=k.Project,c.value=k.Goals,g.value=k.GrantType,c.value.length||E(),j().init("culture",l.value),i.value=l.value.changeApply,l.value.changeApply=void 0})},C=V=>V.Deleted=!0,p=V=>V.Deleted=!0,r=V=>V.Deleted=!0,N=V=>V.Deleted=!0,d=V=>{var S,w;if(a.value={},V&&!t()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}const k={Project:l.value,Goals:c.value,Before:(S=i.value)==null?void 0:S.Form2Before,After:(w=i.value)==null?void 0:w.Form2After,Submit:V?"true":"false"};F.culture("saveWorkSchedule",k).subscribe(()=>{V?s("next"):n()})},t=()=>{let V={StartTime:"計畫期程",EndTime:"計畫期程"};a.value=I(l.value,V);const k={Title:"計畫目標",Content:"預期效益"},S={Title:"重要工作項目",Indicator:"績效指標"},w={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},D={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return c.value.filter(B=>!B.Deleted).forEach((B,A)=>{Object.assign(a.value,I(B,k,`goal-${A}-`)),B.Items.filter(T=>!T.Deleted).forEach((T,P)=>{Object.assign(a.value,I(T,S,`item-${A}-${P}-`)),T.Steps.filter(U=>!U.Deleted).forEach((U,L)=>Object.assign(a.value,I(U,w,`step-${A}-${P}-${L}-`))),T.Schedules.filter(U=>U.Type===1&&!U.Deleted).forEach((U,L)=>Object.assign(a.value,I(U,D,`schedule-${A}-${P}-1-${L}-`))),T.Schedules.filter(U=>U.Type===2&&!U.Deleted).forEach((U,L)=>Object.assign(a.value,I(U,D,`schedule-${A}-${P}-2-${L}-`)))})}),i.value&&(V={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(a.value,I(i.value,V))),!Object.keys(a.value).length};return e.onMounted(n),e.provide("editable",m),(V,k)=>{const S=e.resolveComponent("required-label"),w=e.resolveComponent("input-tw-date"),D=e.resolveComponent("tw-date"),B=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),T=e.resolveComponent("input-month"),P=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ms,[k[30]||(k[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Is,[e.createElementVNode("table",js,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[6]||(k[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Os,[e.createElementVNode("div",Ls,[e.createVNode(w,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(l).StartTime,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(l).StartTime=U)},null,8,["max-date","modelValue"]),k[7]||(k[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(w,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(l).EndTime,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(l).EndTime=U)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Rs,[k[8]||(k[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(D,{value:e.unref(f)},null,8,["value"]),k[9]||(k[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(a).StartTime||e.unref(a).EndTime?(e.openBlock(),e.createElementBlock("div",qs,e.toDisplayString(e.unref(a).StartTime||e.unref(a).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",zs,[k[11]||(k[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:E,type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(U,L)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:U},[e.unref(m)&&e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:O=>C(U),type:"button"},"刪除",8,Ys)):e.createCommentVNode("",!0),e.createElementVNode("div",Js,[k[12]||(k[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(B,{error:e.unref(a)[`goal-${L}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Qs,[k[13]||(k[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(A,{error:e.unref(a)[`goal-${L}-Content`],rows:"4",modelValue:U.Content,"onUpdate:modelValue":O=>U.Content=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Hs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(U.Items.filter(O=>!O.Deleted),(O,J)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:O},[e.createElementVNode("div",Ws,[e.createElementVNode("div",Ks,[e.createElementVNode("label",Xs,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[14]||(k[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",Zs,[e.createVNode(B,{error:e.unref(a)[`item-${L}-${J}-Title`],modelValue:O.Title,"onUpdate:modelValue":R=>O.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",vs,[e.unref(m)&&U.Items.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(R=>p(O),["prevent"]),href:"#"},"刪除",8,ed)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${J}`,role:"button"},"收合",8,td)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${J}`},[e.createElementVNode("table",od,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[15]||(k[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",nd,[e.createElementVNode("ul",rd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Steps.filter(R=>!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(m)}]),key:R},[e.createElementVNode("div",ad,e.toDisplayString(String.fromCharCode(65+Q)),1),e.createElementVNode("div",null,[e.createVNode(B,{error:e.unref(a)[`step-${L}-${J}-${Q}-Title`],placeholder:"如:進行口訪紀錄",modelValue:R.Title,"onUpdate:modelValue":M=>R.Title=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",sd,[e.createVNode(T,{"empty-value":0,modelValue:R.Begin,"onUpdate:modelValue":M=>R.Begin=M},null,8,["modelValue","onUpdate:modelValue"]),k[16]||(k[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(T,{"empty-value":0,modelValue:R.End,"onUpdate:modelValue":M=>R.End=M},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(a)[`step-${L}-${J}-${Q}-Begin`]||e.unref(a)[`step-${L}-${J}-${Q}-End`]?(e.openBlock(),e.createElementBlock("div",dd,e.toDisplayString(e.unref(a)[`step-${L}-${J}-${Q}-Begin`]||e.unref(a)[`step-${L}-${J}-${Q}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",cd,[O.Steps.filter(M=>!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>N(R),type:"button"},[...k[17]||(k[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,id)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>y(O),type:"button"},[...k[18]||(k[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,md)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[19]||(k[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(a)[`item-${L}-${J}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:O.Indicator,"onUpdate:modelValue":R=>O.Indicator=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[20]||(k[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",pd,[e.createElementVNode("div",Vd,[k[23]||(k[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(R=>R.Type===1&&!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:R},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?3:4}`])},[e.createVNode(T,{error:e.unref(a)[`schedule-${L}-${J}-1-${Q}-Month`],"empty-value":0,modelValue:R.Month,"onUpdate:modelValue":M=>R.Month=M},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?7:8}`])},[e.createVNode(P,{"empty-value":0,error:e.unref(a)[`schedule-${L}-${J}-1-${Q}-StepID`],options:O.Steps.filter(M=>!M.Deleted),modelValue:R.StepID,"onUpdate:modelValue":M=>R.StepID=M},{default:e.withCtx(({index:M,option:G})=>[e.createElementVNode("option",{value:G.ID},e.toDisplayString(String.fromCharCode(65+M))+"."+e.toDisplayString(G.Title),9,fd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Nd,[O.Schedules.filter(M=>M.Type===1&&!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>r(R),type:"button"},[...k[21]||(k[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ed)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>_(O,1),type:"button"},[...k[22]||(k[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,bd)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",gd,[k[26]||(k[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(R=>R.Type===2&&!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:R},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?3:4}`])},[e.createVNode(T,{error:e.unref(a)[`schedule-${L}-${J}-2-${Q}-Month`],"empty-value":0,modelValue:R.Month,"onUpdate:modelValue":M=>R.Month=M},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(m)?7:8}`])},[e.createVNode(P,{"empty-value":0,error:e.unref(a)[`schedule-${L}-${J}-2-${Q}-StepID`],options:O.Steps.filter(M=>!M.Deleted),modelValue:R.StepID,"onUpdate:modelValue":M=>R.StepID=M},{default:e.withCtx(({index:M,option:G})=>[e.createElementVNode("option",{value:G.ID},e.toDisplayString(String.fromCharCode(65+M))+"."+e.toDisplayString(G.Title),9,yd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(m)?(e.openBlock(),e.createElementBlock("div",kd,[O.Schedules.filter(M=>M.Type===2&&!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>r(R),type:"button"},[...k[24]||(k[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ud)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>_(O,2),type:"button"},[...k[25]||(k[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,hd)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,ld)]))),128))]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:O=>x(U),type:"button"},"新增工作項目",8,xd)):e.createCommentVNode("",!0)]))),128))]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[29]||(k[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",$d,[e.createElementVNode("table",Bd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[27]||(k[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(a).Form2Before,rows:"4",modelValue:e.unref(i).Form2Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(i).Form2Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[28]||(k[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(a).Form2After,rows:"4",modelValue:e.unref(i).Form2After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(i).Form2After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",_d,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>d(!0)),type:"button"},[...k[31]||(k[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-988b407a"]]),Td={class:"block"},wd={class:"mt-4"},Dd={class:"table align-middle gray-table side-table"},Sd={key:0},Ad={key:1,class:"text-light-gray"},Fd={class:"d-flex flex-column gap-2"},Ud={key:0},Pd={class:"mt-4"},Md={class:"table align-middle gray-table side-table"},Id={class:"row g-3"},jd={class:"col-12 col-xl-2"},Od={class:"text-gray mb-2"},Ld={class:"col-12 col-xl-3"},Rd={class:"text-gray mb-2"},qd={key:0,class:"col-12 col-xl-4"},zd={class:"row g-1"},Gd={class:"col-7"},Yd={class:"col-5"},Jd={key:1,class:"col-12 col-xl-3"},Qd={class:"text-gray mb-2"},Hd={class:"mt-4"},Wd={class:"table align-middle gray-table side-table"},Kd={class:"d-flex align-items-center gap-2"},Xd={class:"input-group w-auto"},Zd={key:0,class:"invalid mt-0"},vd={class:"mt-4"},ec={class:"table-responsive mt-3 mb-0"},tc={class:"table align-middle gray-table"},lc={class:"text-end"},oc={class:"text-end"},nc={class:"text-end"},rc={class:"text-end"},ac={class:"text-end"},sc={class:"text-end"},dc={class:"table-responsive"},cc={class:"table align-middle gray-table"},ic=["colspan"],mc={key:0,width:"1"},pc={class:"text-end"},Vc={key:0},fc={class:"d-flex gap-2"},Nc=["onClick"],Ec={class:"mt-4"},bc={class:"table-responsive mt-3 mb-0"},gc={class:"table align-middle gray-table"},yc={key:0,width:"1"},kc={class:"text-end"},uc={key:0},hc={class:"d-flex gap-2"},xc=["onClick"],$c={class:"table align-middle gray-table side-table"},Bc={key:0,class:"table-responsive mt-3 mb-0"},_c={class:"table align-middle gray-table"},Cc={key:0},Tc={key:0},wc={class:"d-flex gap-2"},Dc=["onClick"],Sc={class:"mt-4"},Ac={class:"table align-middle gray-table side-table"},Fc={key:0,class:"block-bottom bg-light-teal"},Uc={class:"text-center"},Pc={class:"mb-5"},Mc={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.ref(),a=e.computed(()=>Y("education",E.value.Status,1)),o=e.ref({}),l=e.computed(()=>_.value.filter(D=>!D.Deleted)),c=e.computed(()=>y.value.filter(D=>!D.Deleted)),g=e.computed(()=>s.value.filter(D=>!D.Deleted)),E=e.ref({}),x=e.ref(),_=e.ref([]),y=e.ref([]),s=e.ref([]),n=e.ref(),C=e.ref(0),p=e.computed({get:()=>!!g.value.length,set:D=>{D?r():s.value.forEach(B=>B.Deleted=!0)}}),r=()=>s.value.push({}),N=()=>_.value.push({}),d=()=>y.value.push({}),t=u,V=()=>{F.education("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(D=>{E.value=D.Project,f.value=D.Contacts,_.value=D.OtherSubsidies||[],y.value=D.BudgetPlans||[],s.value=D.ReceivedSubsidies,E.value.OrgCategory=E.value.OrgCategory||null,y.value.length||d(),j().init("education",E.value),m.value=E.value.changeApply,E.value.changeApply=void 0})},k=D=>D.Deleted=!0,S=(D,B)=>{var T,P;if(o.value={},D&&!w()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!B&&n.value&&E.value.ApplyAmount>n.value.GrantLimit*1e4){x.value.show(()=>S(D,!0));return}const A={Project:E.value,Contacts:f.value,OtherSubsidies:_.value,BudgetPlans:y.value,ReceivedSubsidies:s.value.filter(U=>U.ID||!U.Deleted),Before:(T=m.value)==null?void 0:T.Form1Before,After:(P=m.value)==null?void 0:P.Form1After,Submit:D?"true":"false"};F.education("saveApplication",A).subscribe(U=>{D?t("next",U.ID):E.value.ID?V():window.location.href=`Application.aspx?ID=${U.ID}`})},w=()=>{let D={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return E.value.OrgCategory==="2"&&(D.RegisteredNum="立案登記證字號"),o.value=I(E.value,D),D={Name:"姓名",JobTitle:"職稱"},Object.assign(o.value,I(f.value[0],D,"contact-0-")),D.MobilePhone="手機號碼",Object.assign(o.value,I(f.value[1],D,"contact-1-")),D={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},l.value.forEach((B,A)=>Object.assign(o.value,I(B,D,`other-${A}-`))),D={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},c.value.forEach((B,A)=>Object.assign(o.value,I(B,D,`plan-${A}-`))),D={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},s.value.forEach((B,A)=>Object.assign(o.value,I(B,D,`received-${A}-`))),m.value&&(D={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,I(m.value,D))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(D=>{i.value=D[0],b.id?V():F.education("getEmptyApplication").subscribe(B=>{E.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},B),f.value=[{Role:"負責人"},{Role:"聯絡人"}],d(),j().init("education",E.value)})})}),e.provide("editable",a),e.watch(()=>E.value.OrgCategory,()=>{F.education("getGrantTargetSetting",{TargetTypeID:`EDC${E.value.OrgCategory}`}).subscribe(D=>{n.value=D})}),e.watchEffect(()=>{E.value.OtherUnitAmount=l.value.reduce((D,B)=>D+q(B.Amount),0),C.value=q(E.value.ApplyAmount)+q(E.value.SelfAmount)+q(E.value.OtherGovAmount)+q(E.value.OtherUnitAmount),l.value.forEach(D=>D.percent=Math.round(q(D.Amount)/E.value.OtherUnitAmount*1e4)/100),y.value.forEach(D=>D.sum=q(D.Amount)+q(D.OtherAmount))}),(D,B)=>{var Q;const A=e.resolveComponent("required-label"),T=e.resolveComponent("input-text"),P=e.resolveComponent("input-select"),U=e.resolveComponent("input-tw-date"),L=e.resolveComponent("input-textarea"),O=e.resolveComponent("input-integer"),J=e.resolveComponent("input-boolean"),R=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Td,[B[66]||(B[66]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",wd,[e.createElementVNode("table",Dd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[B[19]||(B[19]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[B[20]||(B[20]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",Sd,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Ad,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[B[21]||(B[21]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[22]||(B[22]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":B[0]||(B[0]=M=>e.unref(E).ProjectName=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[23]||(B[23]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Fd,[e.createElementVNode("div",null,[e.createVNode(P,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(i),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":B[1]||(B[1]=M=>e.unref(E).OrgCategory=M)},null,8,["error","options","modelValue"])]),e.unref(E).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Ud,[e.createVNode(T,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(E).RegisteredNum,"onUpdate:modelValue":B[2]||(B[2]=M=>e.unref(E).RegisteredNum=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[24]||(B[24]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o).OrgName,placeholder:"請輸入單位全銜",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":B[3]||(B[3]=M=>e.unref(E).OrgName=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[25]||(B[25]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":B[4]||(B[4]=M=>e.unref(E).TaxID=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[26]||(B[26]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":B[5]||(B[5]=M=>e.unref(E).Address=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),B[67]||(B[67]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Pd,[e.createElementVNode("table",Md,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(M.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Id,[e.createElementVNode("div",jd,[e.createElementVNode("div",Od,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[27]||(B[27]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(T,{error:e.unref(o)[`contact-${G}-Name`],modelValue:M.Name,"onUpdate:modelValue":z=>M.Name=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ld,[e.createElementVNode("div",Rd,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[28]||(B[28]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(T,{error:e.unref(o)[`contact-${G}-JobTitle`],modelValue:M.JobTitle,"onUpdate:modelValue":z=>M.JobTitle=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),G?(e.openBlock(),e.createElementBlock("div",qd,[B[29]||(B[29]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",zd,[e.createElementVNode("div",Gd,[e.createVNode(T,{modelValue:M.Phone,"onUpdate:modelValue":z=>M.Phone=z,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Yd,[e.createVNode(T,{placeholder:"請輸入分機",size:"4",modelValue:M.PhoneExt,"onUpdate:modelValue":z=>M.PhoneExt=z,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),G?(e.openBlock(),e.createElementBlock("div",Jd,[e.createElementVNode("div",Qd,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[30]||(B[30]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(T,{error:e.unref(o)[`contact-${G}-MobilePhone`],modelValue:M.MobilePhone,"onUpdate:modelValue":z=>M.MobilePhone=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),B[68]||(B[68]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Hd,[e.createElementVNode("table",Wd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[31]||(B[31]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Kd,[e.createElementVNode("div",Xd,[e.createVNode(U,{class:"w-auto",modelValue:e.unref(E).StartTime,"onUpdate:modelValue":B[6]||(B[6]=M=>e.unref(E).StartTime=M)},null,8,["modelValue"]),B[32]||(B[32]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(U,{class:"w-auto",modelValue:e.unref(E).EndTime,"onUpdate:modelValue":B[7]||(B[7]=M=>e.unref(E).EndTime=M)},null,8,["modelValue"])]),B[33]||(B[33]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Zd,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[34]||(B[34]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o).Target,modelValue:e.unref(E).Target,"onUpdate:modelValue":B[8]||(B[8]=M=>e.unref(E).Target=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[35]||(B[35]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":B[9]||(B[9]=M=>e.unref(E).Summary=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[36]||(B[36]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":B[10]||(B[10]=M=>e.unref(E).Quantified=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),B[69]||(B[69]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",vd,[B[49]||(B[49]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",ec,[e.createElementVNode("table",tc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",lc,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[37]||(B[37]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",oc,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[38]||(B[38]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款(元)",-1)])]),_:1})]),e.createElementVNode("th",nc,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[39]||(B[39]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",rc,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[40]||(B[40]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元) (含總收費)",-1)])]),_:1})]),B[41]||(B[41]=e.createElementVNode("th",{class:"text-end"},"計畫總經費(元)",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o).ApplyAmount,modelValue:e.unref(E).ApplyAmount,"onUpdate:modelValue":B[11]||(B[11]=M=>e.unref(E).ApplyAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o).SelfAmount,modelValue:e.unref(E).SelfAmount,"onUpdate:modelValue":B[12]||(B[12]=M=>e.unref(E).SelfAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o).OtherGovAmount,modelValue:e.unref(E).OtherGovAmount,"onUpdate:modelValue":B[13]||(B[13]=M=>e.unref(E).OtherGovAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",ac,e.toDisplayString((Q=e.unref(E).OtherUnitAmount)==null?void 0:Q.toLocaleString()),1),e.createElementVNode("td",sc,e.toDisplayString(e.unref(C).toLocaleString()),1)])])])]),B[50]||(B[50]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},null,-1)),e.createElementVNode("div",dc,[e.createElementVNode("table",cc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(a)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,ic)]),e.createElementVNode("tr",null,[B[42]||(B[42]=e.createElementVNode("th",{width:"1"},null,-1)),B[43]||(B[43]=e.createElementVNode("th",null,"單位名稱",-1)),B[44]||(B[44]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),B[45]||(B[45]=e.createElementVNode("th",null,"比例",-1)),B[46]||(B[46]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",mc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,e.toDisplayString(G+1),1),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`other-${G}-Unit`],modelValue:M.Unit,"onUpdate:modelValue":z=>M.Unit=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o)[`other-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",pc,e.toDisplayString(M.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o)[`other-${G}-Content`],rows:"1",modelValue:M.Content,"onUpdate:modelValue":z=>M.Content=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Vc,[e.createElementVNode("div",fc,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...B[47]||(B[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Nc)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:N,type:"button"},[...B[48]||(B[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),B[70]||(B[70]=e.createElementVNode("h5",{class:"square-title mt-5"},"經費預算規劃",-1)),e.createElementVNode("div",Ec,[e.createElementVNode("div",bc,[e.createElementVNode("table",gc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[B[51]||(B[51]=e.createElementVNode("th",null,"預算項目",-1)),B[52]||(B[52]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),B[53]||(B[53]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),B[54]||(B[54]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),B[55]||(B[55]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",yc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`plan-${G}-Title`],modelValue:M.Title,"onUpdate:modelValue":z=>M.Title=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o)[`plan-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o)[`plan-${G}-OtherAmount`],modelValue:M.OtherAmount,"onUpdate:modelValue":z=>M.OtherAmount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",kc,e.toDisplayString(M.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o)[`plan-${G}-Description`],rows:"1",modelValue:M.Description,"onUpdate:modelValue":z=>M.Description=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",uc,[e.createElementVNode("div",hc,[e.unref(c).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...B[56]||(B[56]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xc)):e.createCommentVNode("",!0),G+1===e.unref(c).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...B[57]||(B[57]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.createElementVNode("table",$c,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[58]||(B[58]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(J,{modelValue:e.unref(p),"onUpdate:modelValue":B[14]||(B[14]=M=>e.isRef(p)?p.value=M:null)},null,8,["modelValue"]),e.unref(p)?(e.openBlock(),e.createElementBlock("div",Bc,[e.createElementVNode("table",_c,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[B[59]||(B[59]=e.createElementVNode("th",null,"計畫名稱",-1)),B[60]||(B[60]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費(元)",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",Cc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`received-${G}-Name`],modelValue:M.Name,"onUpdate:modelValue":z=>M.Name=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(o)[`received-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Tc,[e.createElementVNode("div",wc,[e.unref(g).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...B[61]||(B[61]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Dc)):e.createCommentVNode("",!0),G+1===e.unref(g).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:r,type:"button"},[...B[62]||(B[62]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[B[65]||(B[65]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Sc,[e.createElementVNode("table",Ac,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[63]||(B[63]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":B[15]||(B[15]=M=>e.unref(m).Form1Before=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...B[64]||(B[64]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":B[16]||(B[16]=M=>e.unref(m).Form1After=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Fc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:B[17]||(B[17]=M=>S()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:B[18]||(B[18]=M=>S(!0)),type:"button"},[...B[71]||(B[71]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(R,{ref_key:"modal",ref:x},{default:e.withCtx(()=>{var M;return[e.createElementVNode("div",Uc,[B[72]||(B[72]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Pc,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((M=e.unref(n))==null?void 0:M.GrantLimit)+"萬",1),B[73]||(B[73]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),B[74]||(B[74]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},Ic={class:"block"},jc={key:0,class:"text-pink lh-base mt-4"},Oc={class:"mt-4"},Lc={class:"table align-middle gray-table"},Rc={class:"text-center"},qc={key:0,width:"180"},zc={class:"text-center"},Gc={key:0},Yc=["innerHTML"],Jc=["href"],Qc={key:0,class:"text-center"},Hc={key:0},Wc={key:1,class:"text-pink"},Kc={key:1,class:"tag-group mt-2 gap-1"},Xc={key:0,class:"tag tag-green-light"},Zc=["download","href"],vc=["onClick"],ei={key:1,class:"text-center mt-4"},ti={class:"mt-4"},li={class:"table align-middle gray-table side-table"},oi={key:0,class:"block-bottom bg-light-teal"},ni=["disabled"],ri={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"相關佐證資料",Comment:"(如：有效期間內之當選證書、核准登記設立證明等)",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),f=e.computed(()=>i.value.some(s=>!s.Optional&&!s.Files.filter(n=>!n.Deleted).length)),a=e.computed(()=>Y("education",l.value.Status,2)),o=e.ref({}),l=e.ref({}),c=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:l.value.ProjectID+"_"+(s.Multiple?n.Name:`${s.Title}.pdf`)})},g=F.download,E=u,x=()=>{rxjs.forkJoin([F.education("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=i.value.filter(C=>{var p;return!((p=C.Excludes)!=null&&p.includes(l.value.OrgCategory))}),i.value.forEach(C=>{C.Files=n.Attachments.filter(p=>p.Type===C.Type),C.Uploaded=e.computed(()=>C.Files.filter(p=>!p.Deleted).length)}),j().init("education",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=s=>{var C,p;if(o.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Attachments:i.value.reduce((r,N)=>r.concat(N.Files),[]),Before:(C=m.value)==null?void 0:C.Form5Before,After:(p=m.value)==null?void 0:p.Form5After,Submit:s?"true":"false"};F.education("saveAttachment",n).subscribe(r=>{r&&(s?E("next",x):x())})},y=()=>{if(m.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,I(m.value,s))}return!Object.keys(o.value).length};return e.onMounted(x),e.provide("editable",a),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file"),r=e.resolveComponent("tw-date-time"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ic,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("p",jc,[...n[4]||(n[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如有效期間內之當選證書、核准登記設立證明等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Oc,[e.createElementVNode("table",Lc,[e.createElementVNode("thead",Rc,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",qc,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",zc,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",Gc,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(C,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(a)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,Yc)):e.createCommentVNode("",!0),e.unref(a)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:d.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Jc)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Qc,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",Hc,"已上傳")):(e.openBlock(),e.createElementBlock("span",Wc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:V=>c(d,V)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",Kc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,V=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:V},[V.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Xc,[e.createElementVNode("a",{class:"tag-link my-1",download:V.Name,href:e.unref(g)(V.Path)},e.toDisplayString(V.Name),9,Zc),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>V.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,vc)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(l).ApplyTime?(e.openBlock(),e.createElementBlock("div",ei,[n[10]||(n[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(r,{value:e.unref(l).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ti,[e.createElementVNode("table",li,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(m).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(m).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",oi,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),disabled:e.unref(f),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,ni)])):e.createCommentVNode("",!0)],64)}}},ai={class:"block"},si={class:"square-title"},di={class:"text-teal fw-bold py-3"},ci={class:"text-teal fw-bold pb-3"},ii={class:"table-responsive mb-0"},mi={class:"table align-middle gray-table"},pi={class:"text-end"},Vi={class:"text-end"},fi={class:"text-end"},Ni={class:"text-teal fw-bold pb-3"},Ei={class:"text-teal fw-bold pb-3"},bi={class:"mt-4"},gi={class:"table align-middle gray-table"},yi={class:"text-center"},ki={key:0,width:"180"},ui={class:"text-center"},hi=["href"],xi={key:0,class:"text-center"},$i={key:0},Bi={key:1,class:"text-pink"},_i={key:1,class:"tag-group mt-2 gap-1"},Ci={key:0,class:"tag tag-green-light"},Ti=["download","href"],wi=["onClick"],Di={key:0,class:"block-bottom bg-light-teal"},Si=["disabled"],Ai={__name:"Payment",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>i.value<=0||x.value.some(p=>!p.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!l.value||l.value.Status==="請款中"),a=e.computed(()=>{var p;return((p=l.value)==null?void 0:p.Status)==="通過"}),o=e.ref(0),l=e.ref(),c=e.ref({}),g=e.computed(()=>c.value.ApprovedAmount?Math.min(Math.round(i.value*100/c.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>a.value?Math.round(i.value*100/l.value.CurrentActualPaidAmount*100)/100+"%":"--"),x=e.ref([{Type:11,Title:"收支明細表",Template:"../../Template/EDC/1-收支明細表.docx",Files:[]},{Type:12,Title:"受補助清單",Template:"../../Template/EDC/2-受補助清單.docx",Files:[]},{Type:13,Title:"經費分攤表",Template:"../../Template/EDC/3-經費分攤表.docx",Files:[]},{Type:14,Title:"憑證",Template:"../../Template/EDC/4-憑證.docx",Files:[]},{Type:15,Title:"領據",Template:"../../Template/EDC/5-領據.docx",Files:[]}]),_=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:`${c.value.ProjectID}_${p.Title}.pdf`})},y=F.download,s=u,n=()=>{F.education("getPayment",{ID:b.id}).subscribe(p=>{c.value=p.Project,j().init("education",c.value),x.value=x.value.filter(r=>{var N;return!((N=r.Excludes)!=null&&N.includes(c.value.OrgCategory))}),x.value.forEach(r=>{r.Files=p.Attachments.filter(N=>N.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(N=>!N.Deleted).length)}),l.value=p.Payments.find(r=>r.Stage===1),l.value&&(i.value=l.value.TotalSpentAmount),o.value=c.value.ApprovedAmount,H().init(l.value)})},C=p=>{const r={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:x.value.reduce((N,d)=>N.concat(d.Files),[]),Submit:p?"true":"false"};F.education("savePayment",r).subscribe(N=>{N&&(p?s("next",n):n())})};return e.onMounted(n),e.provide("editable",f),(p,r)=>{var V;const N=e.resolveComponent("input-integer"),d=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ai,[e.createElementVNode("h5",si,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",di,"核定經費: "+e.toDisplayString((V=e.unref(c).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("p",ci,"賸餘款: "+e.toDisplayString((e.unref(c).ApprovedAmount-e.unref(i)).toLocaleString())+"元",1),e.createElementVNode("div",ii,[e.createElementVNode("table",mi,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",pi,e.toDisplayString(e.unref(i)),1),r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(N,{max:e.unref(o),modelValue:e.unref(i),"onUpdate:modelValue":r[0]||(r[0]=k=>e.isRef(i)?i.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Vi,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",fi,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Ni,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ei,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",bi,[e.createElementVNode("table",gi,[e.createElementVNode("thead",yi,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",ki,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",ui,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(f)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,hi)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",xi,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",$i,"已上傳")):(e.openBlock(),e.createElementBlock("span",Bi,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:w=>_(k,w)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",_i,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,w=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:w},[w.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ci,[e.createElementVNode("a",{class:"tag-link my-1",download:w.Name,href:e.unref(y)(w.Path)},e.toDisplayString(w.Name),9,Ti),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>w.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,wi)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",Di,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=k=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=k=>C(!0)),disabled:e.unref(m),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Si)])):e.createCommentVNode("",!0)],64)}}},Fi={__name:"ProgressBar",setup(h){const u=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(b,i)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:u,type:"education"})}}},Ui={class:"modal-dialog modal-dialog-centered modal-md"},Pi={class:"modal-content"},Mi={class:"modal-body"},Ii={class:"d-flex flex-column align-items-center mb-5 gap-3"},ji={class:"fs-18"},Oi={__name:"ErrorModal",setup(h){const u=ee(),b=e.ref();return e.onMounted(()=>b.value.addEventListener("hidden.bs.modal",()=>u.error=null)),e.watch(()=>u.error,()=>{u.error&&bootstrap.Modal.getOrCreateInstance(b.value).show()}),(i,m)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:b,tabindex:"-1"},[e.createElementVNode("div",Ui,[e.createElementVNode("div",Pi,[m[2]||(m[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Mi,[e.createElementVNode("div",Ii,[m[0]||(m[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",ji,e.toDisplayString(e.unref(u).error),1)]),m[1]||(m[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},v=W.defineStore("grant",{actions:{init(h){this.type=h}},state:()=>({type:null,typeList:[{code:"SCI",title:"科專"},{code:"CUL",title:"文化"},{code:"EDC",title:"學校／民間"},{code:"CLB",title:"學校社團"},{code:"MUL",title:"多元"},{code:"LIT",title:"素養"},{code:"ACC",title:"無障礙"}]})}),Li={key:0,class:"search bg-gray rounded-4 mt-4"},Ri={class:"search-form"},qi={class:"row g-3"},zi={class:"col-12 col-lg-6"},Gi={class:"col-12 col-lg-6"},Yi={key:0,class:"rounded-4 bg-white mt-4 p-4"},Ji={class:"row"},Qi={class:"col-12"},Hi={class:"row"},Wi={class:"col-12 d-flex justify-content-between align-items-center pe-4"},Ki={class:"fw-bold text-primary fs-2"},Xi={key:1,class:"rounded-4 bg-white mt-4 py-4"},Zi={class:"row"},vi={class:"col-12 col-lg-4"},em={class:"col-12 col-lg-8"},tm={key:2,class:"row"},lm={class:"col-12 col-lg-6 pt-4"},om={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},nm={class:"fw-bold text-primary fs-2"},rm={class:"col-12 col-lg-6 pt-4"},am={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},sm={class:"fw-bold text-primary fs-2"},dm={class:"col-12 col-lg-6 pt-4"},cm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},im={class:"fw-bold text-primary fs-2"},mm={class:"col-12 col-lg-6 pt-4"},pm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},Vm={class:"fw-bold text-primary fs-2"},fm={class:"rounded-4 bg-white p-4 mt-4 d-flex flex-column gap-3"},Nm={class:"table-responsive"},Em={class:"table align-middle gray-table"},bm={class:"text-center"},gm={class:"text-center"},ym=["href"],km={class:"text-end"},um={class:"text-end"},hm={class:"search bg-white rounded-4 mt-4"},xm={class:"table-responsive mt-4"},$m={class:"row"},Bm={class:"col"},_m=["value"],Cm={class:"table teal-table","aria-label":"申請計畫列表"},Tm={"data-th":"年度:"},wm={"data-th":"類別:",class:"text-start"},Dm={"data-th":"補助計畫:"},Sm={"data-th":"申請期限:"},Am={"data-th":"補助對象:"},Fm={"data-th":"相關檔案:"},Um=["download","href"],Pm={"data-th":"我要申請:"},Mm=["href"],Im={class:"search bg-white rounded-4 mt-4"},jm={class:"mt-4"},Om={key:0,class:"total-list mt-4"},Lm=["href"],Rm={class:"total-item-title"},qm={class:"total-item-content"},zm={class:"count"},Gm={__name:"HomeDashboard",setup(h){const u=v().typeList,b=[{title:"申請中尚未提送",url:"ApplicationChecklist.aspx",count:e.computed(()=>i.value.filter(d=>[1,14].includes(d.Status)).length)},{title:"申請審查中",url:"ApplicationChecklist.aspx",count:e.computed(()=>i.value.filter(d=>[11,12,21,22,31,32,41,42,43,44].includes(d.Status)).length)},{title:"審查意見待回覆",url:"ApplicationChecklist.aspx?waitingReply=1",count:e.computed(()=>{var d;return((d=o.value.find(t=>t.Status===1))==null?void 0:d.Count)||0})},{title:"執行中計畫",url:"inprogressList.aspx",count:e.computed(()=>i.value.filter(d=>[51,52].includes(d.Status)).length)},{title:"執行階段待回覆",url:"inprogressList.aspx?pendingReply=1",count:e.computed(()=>{var d;return((d=o.value.find(t=>t.Status===2))==null?void 0:d.Count)||0})}],i=e.ref([]),m=e.ref([]),f=e.ref(),a=e.ref(),o=e.ref([]),l=e.ref(""),c=e.ref([]),g=e.ref([]),E=e.ref([]),x=e.ref(),_=e.ref(115),y=e.computed(()=>{let d=m.value;return l.value&&(d=d.filter(t=>t.tags.includes(l.value))),d}),s=e.computed(()=>E.value.filter(d=>d.Year===_.value&&(!x.value||d.Category===x.value))),n=e.computed(()=>({ApprovedAmount:s.value.reduce((d,t)=>d+t.ApprovedAmount,0),RemainingAmount:s.value.reduce((d,t)=>d+t.ApprovedAmount-t.SpendAmount,0),SpendAmount:s.value.reduce((d,t)=>d+t.SpendAmount,0),PaymentAmount:s.value.reduce((d,t)=>d+t.PaymentAmount,0),BudgetFees:s.value.reduce((d,t)=>d+t.BudgetFees,0)})),C=F.download,p=d=>g.value.filter(t=>t.GrantTypeID===d.TypeCode).map((t,V)=>`${V+1}.${t.Note}`).join("<br>"),r=d=>{switch(d.TypeCode){case"SCI":return`SCI/SciApplication.aspx?TypeID=${d.TypeID}`;case"CLB":return`CLB/ClbApplication.aspx?TypeID=${d.TypeID}`;default:return`${d.TypeCode}/Application.aspx`}},N=(d,t,V=2)=>{if(t){const k=10**V;return Math.round(d*100/t*k)/k}return 0};return e.onMounted(()=>{F.system("dashboard").subscribe(d=>{m.value=d.GrantTypes,g.value=d.Settings,i.value=d.ApplyList,E.value=d.StatList,o.value=d.PendingList,f.value=d.IsOrganizer,a.value=d.IsUser,m.value.forEach(t=>{var V;t.tags=((V=t.TargetTags)==null?void 0:V.split(`
`).map(k=>k.trim()).filter(k=>k))||[],t.tags.forEach(k=>{c.value.includes(k)||c.value.push(k)})})})}),(d,t)=>{const V=e.resolveComponent("input-select"),k=e.resolveComponent("report-pie-chart"),S=e.resolveComponent("report-mix-chart"),w=e.resolveComponent("tw-date"),D=e.resolveComponent("tooltip");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",Li,[t[22]||(t[22]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon12-teal.svg"}),e.createTextVNode(" 經費執行狀況 ")],-1)),e.createElementVNode("div",Ri,[e.createElementVNode("div",qi,[e.createElementVNode("div",zi,[t[4]||(t[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=B=>e.isRef(_)?_.value=B:null)},[...t[3]||(t[3]=[e.createElementVNode("option",{value:115},"115",-1),e.createElementVNode("option",{value:114},"114",-1)])],512),[[e.vModelSelect,e.unref(_)]])]),e.createElementVNode("div",Gi,[t[5]||(t[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"全部類別",-1)),e.createVNode(V,{"allow-empty":"",options:e.unref(u),placeholder:"全部","text-name":"title","value-name":"code",modelValue:e.unref(x),"onUpdate:modelValue":t[1]||(t[1]=B=>e.isRef(x)?x.value=B:null)},null,8,["options","modelValue"])])]),t[6]||(t[6]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))]),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Yi,[e.createElementVNode("div",Ji,[e.createElementVNode("div",Qi,[e.createElementVNode("div",Hi,[e.createElementVNode("div",Wi,[t[8]||(t[8]=e.createElementVNode("div",{class:"fw-bold fs-4"},"總預算經費",-1)),e.createElementVNode("div",Ki,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(n).BudgetFees/1e3).toLocaleString())+" ",1),t[7]||(t[7]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])])])):e.createCommentVNode("",!0),e.unref(n)?(e.openBlock(),e.createElementBlock("div",Xi,[e.createElementVNode("div",Zi,[e.createElementVNode("div",vi,[t[9]||(t[9]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"經費執行率",-1)),e.createVNode(k,{active:"已執行",color:9323693,inactive:"未執行",percent:N(e.unref(n).SpendAmount,e.unref(n).ApprovedAmount,1),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",em,[t[10]||(t[10]=e.createElementVNode("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e.createElementVNode("span",{class:"fs-4 fw-bold"},"各類經費執行情形")],-1)),t[11]||(t[11]=e.createElementVNode("div",{class:"fs-6 text-end text-secondary me-5"},"單位：千元",-1)),e.unref(s).length?(e.openBlock(),e.createBlock(S,{key:0,list:e.unref(s),style:{width:"100%",height:"300px"}},null,8,["list"])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),e.unref(n)?(e.openBlock(),e.createElementBlock("div",tm,[e.createElementVNode("div",lm,[e.createElementVNode("div",om,[t[13]||(t[13]=e.createElementVNode("div",{class:"fw-bold fs-4"},"核定補助經費",-1)),e.createElementVNode("div",nm,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(n).ApprovedAmount/1e3).toLocaleString())+" ",1),t[12]||(t[12]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",rm,[e.createElementVNode("div",am,[t[15]||(t[15]=e.createElementVNode("div",{class:"fw-bold fs-4"},"賸餘款",-1)),e.createElementVNode("div",sm,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(n).RemainingAmount/1e3).toLocaleString())+" ",1),t[14]||(t[14]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",dm,[e.createElementVNode("div",cm,[t[17]||(t[17]=e.createElementVNode("div",{class:"fw-bold fs-4"},"實支金額",-1)),e.createElementVNode("div",im,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(n).SpendAmount/1e3).toLocaleString())+" ",1),t[16]||(t[16]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",mm,[e.createElementVNode("div",pm,[t[19]||(t[19]=e.createElementVNode("div",{class:"fw-bold fs-4"},"已撥付",-1)),e.createElementVNode("div",Vm,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(n).PaymentAmount/1e3).toLocaleString())+" ",1),t[18]||(t[18]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",fm,[t[21]||(t[21]=e.createElementVNode("h5",{class:"square-title"},"各類經費列表",-1)),e.createElementVNode("div",Nm,[e.createElementVNode("table",Em,[t[20]||(t[20]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-center"},"類別"),e.createElementVNode("th",{class:"text-center"},"核定件數"),e.createElementVNode("th",{class:"text-end"},"核定補助經費"),e.createElementVNode("th",{class:"text-end"},"經費執行率")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),B=>(e.openBlock(),e.createElementBlock("tr",{key:B},[e.createElementVNode("td",bm,e.toDisplayString(e.unref(u).find(A=>A.code===B.Category).title),1),e.createElementVNode("td",gm,[e.createElementVNode("a",{href:`Report/ApprovedList.aspx?category=${B.Category}`},e.toDisplayString(B.Count),9,ym)]),e.createElementVNode("td",km,e.toDisplayString(B.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",um,e.toDisplayString(N(B.SpendAmount,B.ApprovedAmount))+"%",1)]))),128))])])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",hm,[t[28]||(t[28]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon13-teal.svg"}),e.createTextVNode(" 海洋委員會補助公告 ")],-1)),e.createElementVNode("div",xm,[e.createElementVNode("div",$m,[e.createElementVNode("div",Bm,[t[24]||(t[24]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"依身分篩選適用規定",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=B=>e.isRef(l)?l.value=B:null)},[t[23]||(t[23]=e.createElementVNode("option",{value:""},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),B=>(e.openBlock(),e.createElementBlock("option",{key:B,value:B},e.toDisplayString(B),9,_m))),128))],512),[[e.vModelSelect,e.unref(l)]])])]),e.createElementVNode("table",Cm,[t[27]||(t[27]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"類別"),e.createElementVNode("th",{scope:"col"},"補助計畫"),e.createElementVNode("th",{scope:"col"},"申請期限"),e.createElementVNode("th",{scope:"col"},"補助對象"),e.createElementVNode("th",{scope:"col"},"相關檔案"),e.createElementVNode("th",{scope:"col"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),B=>(e.openBlock(),e.createElementBlock("tr",{key:B},[e.createElementVNode("td",Tm,e.toDisplayString(B.Year),1),e.createElementVNode("td",wm,e.toDisplayString(B.ShortName),1),e.createElementVNode("td",Dm,e.toDisplayString(B.FullName),1),e.createElementVNode("td",Sm,[e.createVNode(w,{value:B.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",Am,[e.createVNode(D,{"data-bs-html":"true",title:p(B)},null,8,["title"])]),e.createElementVNode("td",Fm,[B.Path?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark",download:B.Filename,href:e.unref(C)(B.Path),style:{display:"inline"}},[...t[25]||(t[25]=[e.createElementVNode("i",{class:"fas fa-file-alt"},null,-1)])],8,Um)):e.createCommentVNode("",!0)]),e.createElementVNode("td",Pm,[e.createElementVNode("a",{class:"btn btn-teal-dark",href:r(B),target:"_blank"},[...t[26]||(t[26]=[e.createElementVNode("i",{class:"fa-solid"},null,-1),e.createTextVNode("我要申請",-1)])],8,Mm)])]))),128))])])])]),e.createElementVNode("div",Im,[t[30]||(t[30]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon14-teal.svg"}),e.createTextVNode(" 我的計畫進度 ")],-1)),e.createElementVNode("div",jm,[e.unref(a)?(e.openBlock(),e.createElementBlock("ul",Om,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(b,B=>e.createElementVNode("li",{class:"total-item",key:B},[e.createElementVNode("a",{href:B.url},[e.createElementVNode("div",Rm,e.toDisplayString(B.title),1),e.createElementVNode("div",qm,[e.createElementVNode("span",zm,e.toDisplayString(B.count),1),t[29]||(t[29]=e.createElementVNode("span",{class:"unit"},"件",-1))])],8,Lm)])),64))])):e.createCommentVNode("",!0)])])],64)}}},Ym={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(h){const u=e.useModel(h,"modelValue"),b=[{value:!0,text:"是"},{value:!1,text:"否"}];return(i,m)=>{const f=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(f,{options:b,modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=a=>u.value=a)},null,8,["modelValue"])}}},Jm=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(h,{emit:u}){const b=e.ref(),i=()=>{Array.from(b.value.files).forEach(f=>F.upload(f).subscribe(a=>m("file",a))),b.value.value=""},m=u;return(f,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:a[0]||(a[0]=o=>e.unref(b).click()),type:"button"},[...a[1]||(a[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:i,class:"d-none",ref_key:"input",ref:b,type:"file"},f.$attrs),null,16)],64))}}),Qm=["disabled","placeholder","type"],Hm={key:0,class:"invalid mt-0"},Wm=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},max:{type:Number},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const u=e.inject("editable",!0),b=e.useModel(h,"modelValue"),i=h;return e.watch(b,m=>{if(m){const f=(parseInt(m)||0).toString();m.toString()!==f?b.value=f:i.max&&Number(f)>i.max&&(b.value=i.max)}}),(m,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(u),placeholder:e.unref(u)?h.placeholder:"",style:{"text-align":"right"},type:h.type},m.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=a=>b.value=a)}),null,16,Qm),[[e.vModelDynamic,b.value]]),h.error?(e.openBlock(),e.createElementBlock("div",Hm,e.toDisplayString(h.error),1)):e.createCommentVNode("",!0)],64))}}),Km={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(h){const u=e.useModel(h,"modelValue"),b=[];for(let i=1;i<=12;i++)b.push({value:i,text:`${i}月`});return(i,m)=>{const f=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(f,{options:b,modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=a=>u.value=a)},null,8,["modelValue"])}}},Xm=["onChange","checked","disabled","id","value"],Zm=["for"],vm={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>se(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const u=e.inject("editable",!0),b=e.useModel(h,"modelValue"),i=m=>{b.value=m};return(m,f)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.options,a=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:a},[e.createElementVNode("input",{onChange:o=>i(a[h.valueName]),checked:a[h.valueName]===b.value,class:"form-check-input",disabled:!e.unref(u),id:`${h.id}-${a[h.valueName]}`,type:"radio",value:a[h.valueName]},null,40,Xm),e.createElementVNode("label",{class:"form-check-label",for:`${h.id}-${a[h.valueName]}`},e.toDisplayString(a[h.textName]),9,Zm)]))),128))}},ep=["disabled"],tp=["value"],lp=["value"],op={key:0,class:"invalid mt-0"},np=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({allowEmpty:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const u=e.inject("editable",!0),b=e.useModel(h,"modelValue");return(i,m)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:h.disabled||!e.unref(u)},i.$attrs,{"onUpdate:modelValue":m[0]||(m[0]=f=>b.value=f)}),[h.allowEmpty||e.unref(u)&&!b.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:h.emptyValue},e.toDisplayString(h.placeholder),9,tp)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.options,(f,a)=>e.renderSlot(i.$slots,"default",{key:f,index:a,option:f},()=>[e.createElementVNode("option",{value:f[h.valueName]},e.toDisplayString(f[h.textName]),9,lp)])),128))],16,ep),[[e.vModelSelect,b.value]]),h.error?(e.openBlock(),e.createElementBlock("div",op,e.toDisplayString(h.error),1)):e.createCommentVNode("",!0)],64))}}),rp={class:"input-group"},ap={key:0,class:"input-group-text"},sp=["disabled","placeholder","type"],dp={key:0,class:"invalid mt-0"},cp=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const u=e.inject("editable",!0),b=e.useModel(h,"modelValue"),i=h;return i.maxLength&&e.watch(b,()=>{var m;((m=b.value)==null?void 0:m.length)>i.maxLength&&(b.value=b.value.substring(0,i.maxLength))}),(m,f)=>{const a=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",rp,[h.prefix?(e.openBlock(),e.createElementBlock("span",ap,[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(u),placeholder:e.unref(u)?h.placeholder:"",type:h.type},m.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=o=>b.value=o)}),null,16,sp),[[e.vModelDynamic,b.value]])]),h.error?(e.openBlock(),e.createElementBlock("div",dp,e.toDisplayString(h.error),1)):e.createCommentVNode("",!0)],64)}}}),ip=["disabled","placeholder"],mp={key:0,class:"fs-14 text-gray mt-2"},pp={class:"text-pink"},Vp={key:1,class:"invalid mt-0"},fp=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const u=e.inject("editable",!0),b=e.useModel(h,"modelValue"),i=h;return i.maxLength&&e.watch(b,()=>{var m;((m=b.value)==null?void 0:m.length)>i.maxLength&&(b.value=b.value.substring(0,i.maxLength))}),(m,f)=>{var a;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(u),placeholder:e.unref(u)?h.placeholder:""},m.$attrs,{"onUpdate:modelValue":f[0]||(f[0]=o=>b.value=o)}),null,16,ip),[[e.vModelText,b.value]]),e.unref(u)&&h.maxLength?(e.openBlock(),e.createElementBlock("div",mp,[f[1]||(f[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",pp,e.toDisplayString(((a=b.value)==null?void 0:a.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(h.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),h.error?(e.openBlock(),e.createElementBlock("div",Vp,e.toDisplayString(h.error),1)):e.createCommentVNode("",!0)],64)}}}),Np=["disabled","placeholder"],Ep={key:0,class:"invalid"},bp=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean},placeholder:{default:"請輸入",type:String}},emits:["update:modelValue"],setup(h,{emit:u}){let b;const i=h,m=e.ref(),f=e.inject("editable",!0),a=e.ref(),o=u,l=c=>{!c&&i.modelValue&&(c=moment(new Date(i.modelValue))),c?(m.value=c.format(i.displayFormat),o("update:modelValue",c.format(i.format))):(m.value="",o("update:modelValue","")),b.setStartDate(m.value||void 0)};return e.onMounted(()=>{const c=$(a.value);c.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:i.drops,locale:{format:i.displayFormat},maxDate:i.maxDate?new Date(i.maxDate):i.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(g,E)=>l(E.startDate)),b=c.data("daterangepicker"),l()}),e.onUnmounted(()=>b.remove()),e.watch(()=>i.modelValue,()=>l()),(c,g)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(f),placeholder:e.unref(f)?h.placeholder:"",ref_key:"element",ref:a,type:"text"},c.$attrs,{"onUpdate:modelValue":g[0]||(g[0]=E=>e.isRef(m)?m.value=E:null)}),null,16,Np),[[e.vModelText,e.unref(m)]]),h.error?(e.openBlock(),e.createElementBlock("div",Ep,e.toDisplayString(h.error),1)):e.createCommentVNode("",!0)],64))}}),gp={key:0,class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},yp={class:"pagination","aria-label":"Pagination"},kp=["disabled"],up={key:1,class:"pagination-item ellipsis",type:"button"},hp=["onClick"],xp={class:"page-number"},$p={key:2,class:"pagination-item ellipsis",type:"button"},Bp={class:"page-number"},_p=["disabled"],Cp={class:"page-number-control"},Tp={class:"page-number-control-item"},wp=["selected","value"],Dp={class:"page-number-control-item"},Sp=["value","selected"],Ap={__name:"ListPager",props:{count:{required:!0,type:Number},page:{required:!0,type:Number},pageSize:{required:!0,type:Number},slots:{default:3,type:Number}},emits:["change"],setup(h,{emit:u}){const b={},i=h,m=e.computed(()=>Math.ceil(i.count/i.pageSize)),f=(o,l)=>{l&&(o=Math.min(o,Math.ceil(i.count/l))),1<=o&&o<=m.value&&a("change",o,l||i.pageSize)},a=u;return e.watchEffect(()=>{b.from=i.page-parseInt(i.slots/2),b.to=i.page+parseInt((i.slots-1)/2),b.pages=[];for(let o=b.from;o<=b.to;o++)0<o&&o<=m.value&&b.pages.push(o)}),(o,l)=>i.count?(e.openBlock(),e.createElementBlock("div",gp,[e.createElementVNode("nav",yp,[e.createElementVNode("button",{"aria-label":"Previous page",class:"nav-button",onClick:l[0]||(l[0]=c=>f(h.page-1)),disabled:h.page===1,type:"button"},[...l[6]||(l[6]=[e.createElementVNode("i",{class:"fas fa-chevron-left"},null,-1)])],8,kp),b.from>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pagination-item",onClick:l[1]||(l[1]=c=>f(1)),type:"button"},[...l[7]||(l[7]=[e.createElementVNode("span",{class:"page-number"},"1",-1)])])):e.createCommentVNode("",!0),b.from>2?(e.openBlock(),e.createElementBlock("button",up,[...l[8]||(l[8]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.pages,c=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["pagination-item",{active:h.page===c}]),onClick:g=>f(c),key:c,type:"button"},[e.createElementVNode("span",xp,e.toDisplayString(c),1)],10,hp))),128)),e.unref(m)>b.to+1?(e.openBlock(),e.createElementBlock("button",$p,[...l[9]||(l[9]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),e.unref(m)>b.to?(e.openBlock(),e.createElementBlock("button",{key:3,class:"pagination-item",onClick:l[2]||(l[2]=c=>f(e.unref(m))),type:"button"},[e.createElementVNode("span",Bp,e.toDisplayString(e.unref(m)),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{"aria-label":"Next page",class:"nav-button",onClick:l[3]||(l[3]=c=>f(h.page+1)),type:"button",disabled:h.page===e.unref(m)},[...l[10]||(l[10]=[e.createElementVNode("i",{class:"fas fa-chevron-right"},null,-1)])],8,_p)]),e.createElementVNode("div",Cp,[e.createElementVNode("div",Tp,[l[11]||(l[11]=e.createElementVNode("span",null,"跳到",-1)),e.createElementVNode("select",{onChange:l[4]||(l[4]=c=>f(c.target.value)),class:"form-select jump-to-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),c=>(e.openBlock(),e.createElementBlock("option",{key:c,selected:c===h.page,value:c},e.toDisplayString(c),9,wp))),128))],32),l[12]||(l[12]=e.createElementVNode("span",null,"頁",-1)),l[13]||(l[13]=e.createElementVNode("span",null,",",-1))]),e.createElementVNode("div",Dp,[l[14]||(l[14]=e.createElementVNode("span",null,"每頁顯示",-1)),e.createElementVNode("select",{onChange:l[5]||(l[5]=c=>f(h.page,c.target.value)),class:"form-select"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([10,20,30],c=>e.createElementVNode("option",{value:c,selected:c===h.pageSize},e.toDisplayString(c),9,Sp)),64))],32),l[15]||(l[15]=e.createElementVNode("span",null,"筆",-1))])])])):e.createCommentVNode("",!0)}},Fp={class:"block"},Up={class:"mt-4"},Pp={class:"table align-middle gray-table side-table"},Mp={key:0},Ip={key:1,class:"text-light-gray"},jp={class:"mt-4"},Op={class:"table align-middle gray-table side-table"},Lp={class:"row g-3"},Rp={class:"col-12 col-xl-2"},qp={class:"text-gray mb-2"},zp={class:"col-12 col-xl-3"},Gp={class:"text-gray mb-2"},Yp={class:"col-12 col-xl-4"},Jp={class:"row g-1"},Qp={class:"col-7"},Hp={class:"col-5"},Wp={class:"col-12 col-xl-3"},Kp={class:"text-gray mb-2"},Xp={class:"col-12"},Zp={class:"text-gray mb-2"},vp={class:"mt-4"},eV={class:"table align-middle gray-table side-table"},tV={class:"mt-4"},lV={class:"table align-middle gray-table side-table"},oV={key:0,class:"table-responsive mt-3 mb-0"},nV={class:"table align-middle gray-table"},rV={key:0},aV={key:0},sV={class:"d-flex gap-2"},dV=["onClick"],cV={class:"mt-4"},iV={class:"table align-middle gray-table side-table"},mV={key:0,class:"block-bottom bg-light-teal"},pV={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.ref(),f=e.computed(()=>Y("literacy",c.value.Status,1)),a=e.ref({}),o=e.ref([]),l=e.computed(()=>g.value.filter(p=>!p.Deleted)),c=e.ref({}),g=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:p=>{p?x():g.value.forEach(r=>r.Deleted=!0)}}),x=()=>g.value.push({}),_=u,y=()=>{F.literacy("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(p=>{c.value=p.Project,i.value=p.Contacts,g.value=p.PreviousStudies,j().init("literacy",c.value),m.value=c.value.changeApply,c.value.changeApply=void 0})},s=p=>p.Deleted=!0,n=p=>{var N,d;if(a.value={},p&&!C()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const r={Project:c.value,Contacts:i.value,PreviousStudies:g.value.filter(t=>t.ID||!t.Deleted),Before:(N=m.value)==null?void 0:N.Form1Before,After:(d=m.value)==null?void 0:d.Form1After,Submit:p?"true":"false"};F.literacy("saveApplication",r).subscribe(t=>{p?_("next",t.ID):c.value.ID?y():window.location.href=`Application.aspx?ID=${t.ID}`})},C=()=>{let p={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return a.value=I(c.value,p),p={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},i.value.forEach((r,N)=>Object.assign(a.value,I(r,p,`contact-${N}-`))),p={Title:"研習/課程名稱",TheDate:"辦理日期"},g.value.forEach((r,N)=>Object.assign(a.value,I(r,p,`study-${N}-`))),m.value&&(p={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(a.value,I(m.value,p))),!Object.keys(a.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(p=>{o.value=p[0],b.id?y():F.literacy("getEmptyApplication").subscribe(r=>{c.value=Object.assign({Field:null,FormStep:1,Status:1},r),i.value=[{Role:"申請人"}],j().init("literacy",c.value)})})}),e.provide("editable",f),e.watch(()=>[c.value.Field,c.value.OrgName],()=>{var p;if(f.value){const r=[];c.value.Field&&r.push((p=o.value.find(N=>N.Code===c.value.Field))==null?void 0:p.Descname),c.value.OrgName&&r.push(c.value.OrgName),c.value.ProjectName=r.join("-")}}),(p,r)=>{const N=e.resolveComponent("required-label"),d=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),V=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),S=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Fp,[r[40]||(r[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Up,[e.createElementVNode("table",Pp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[14]||(r[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).Year),1)]),e.createElementVNode("tr",null,[r[15]||(r[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(c).ProjectID?(e.openBlock(),e.createElementBlock("span",Mp,e.toDisplayString(e.unref(c).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Ip,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[r[16]||(r[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[17]||(r[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{disabled:"",modelValue:e.unref(c).ProjectName,"onUpdate:modelValue":r[0]||(r[0]=w=>e.unref(c).ProjectName=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[18]||(r[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(a).Field,options:e.unref(o),"text-name":"Descname","value-name":"Code",modelValue:e.unref(c).Field,"onUpdate:modelValue":r[1]||(r[1]=w=>e.unref(c).Field=w)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[19]||(r[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(a).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(c).OrgName,"onUpdate:modelValue":r[2]||(r[2]=w=>e.unref(c).OrgName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[20]||(r[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(a).OrgLeader,modelValue:e.unref(c).OrgLeader,"onUpdate:modelValue":r[3]||(r[3]=w=>e.unref(c).OrgLeader=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[21]||(r[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(a).Address,placeholder:"請輸入地址",modelValue:e.unref(c).Address,"onUpdate:modelValue":r[4]||(r[4]=w=>e.unref(c).Address=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),r[41]||(r[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",jp,[e.createElementVNode("table",Op,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(w,D)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Lp,[e.createElementVNode("div",Rp,[e.createElementVNode("div",qp,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[22]||(r[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(a)[`contact-${D}-Name`],modelValue:w.Name,"onUpdate:modelValue":B=>w.Name=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",zp,[e.createElementVNode("div",Gp,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[23]||(r[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(a)[`contact-${D}-JobTitle`],modelValue:w.JobTitle,"onUpdate:modelValue":B=>w.JobTitle=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Yp,[r[24]||(r[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Jp,[e.createElementVNode("div",Qp,[e.createVNode(d,{modelValue:w.Phone,"onUpdate:modelValue":B=>w.Phone=B,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Hp,[e.createVNode(d,{placeholder:"請輸入分機",size:"4",modelValue:w.PhoneExt,"onUpdate:modelValue":B=>w.PhoneExt=B,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Wp,[e.createElementVNode("div",Kp,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[25]||(r[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(a)[`contact-${D}-MobilePhone`],modelValue:w.MobilePhone,"onUpdate:modelValue":B=>w.MobilePhone=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Xp,[e.createElementVNode("div",Zp,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[26]||(r[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(d,{error:e.unref(a)[`contact-${D}-EMail`],modelValue:w.EMail,"onUpdate:modelValue":B=>w.EMail=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),r[42]||(r[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",vp,[e.createElementVNode("table",eV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[27]||(r[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[r[28]||(r[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(V,{error:e.unref(a).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(c).Target,"onUpdate:modelValue":r[5]||(r[5]=w=>e.unref(c).Target=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[29]||(r[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(a).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(c).Summary,"onUpdate:modelValue":r[6]||(r[6]=w=>e.unref(c).Summary=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[30]||(r[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(a).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(c).Quantified,"onUpdate:modelValue":r[7]||(r[7]=w=>e.unref(c).Quantified=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[31]||(r[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(a).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(c).Qualitative,"onUpdate:modelValue":r[8]||(r[8]=w=>e.unref(c).Qualitative=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",tV,[e.createElementVNode("table",lV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[36]||(r[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(E),"onUpdate:modelValue":r[9]||(r[9]=w=>e.isRef(E)?E.value=w:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",oV,[e.createElementVNode("table",nV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[r[32]||(r[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),r[33]||(r[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",rV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(w,D)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(d,{error:e.unref(a)[`study-${D}-Title`],modelValue:w.Title,"onUpdate:modelValue":B=>w.Title=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(a)[`study-${D}-TheDate`],modelValue:w.TheDate,"onUpdate:modelValue":B=>w.TheDate=B,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",aV,[e.createElementVNode("div",sV,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:B=>s(w),type:"button"},[...r[34]||(r[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,dV)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:x,type:"button"},[...r[35]||(r[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r[39]||(r[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",cV,[e.createElementVNode("table",iV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[37]||(r[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(a).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":r[10]||(r[10]=w=>e.unref(m).Form1Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(N,null,{default:e.withCtx(()=>[...r[38]||(r[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(a).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":r[11]||(r[11]=w=>e.unref(m).Form1After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",mV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[12]||(r[12]=w=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[13]||(r[13]=w=>n(!0)),type:"button"},[...r[43]||(r[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},VV={class:"block"},fV={key:0,class:"text-pink lh-base mt-4"},NV={class:"mt-4"},EV={class:"table align-middle gray-table"},bV={class:"text-center"},gV={key:0,width:"180"},yV={class:"text-center"},kV={key:0},uV=["innerHTML"],hV=["href"],xV={key:0,class:"text-center"},$V={key:0},BV={key:1,class:"text-pink"},_V={key:1,class:"tag-group mt-2 gap-1"},CV={key:0,class:"tag tag-green-light"},TV=["download","href"],wV=["onClick"],DV={key:1,class:"text-center mt-4"},SV={class:"mt-4"},AV={class:"table align-middle gray-table side-table"},FV={key:0,class:"block-bottom bg-light-teal"},UV=["disabled"],PV={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"著作權授權同意書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=5&id=${b.id}`,Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),f=e.computed(()=>i.value.some(s=>!s.Optional&&!s.Files.filter(n=>!n.Deleted).length)),a=e.computed(()=>Y("literacy",l.value.Status,2)),o=e.ref({}),l=e.ref({}),c=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:l.value.ProjectID+"_"+(s.Multiple?n.Name:`${s.Title}.pdf`)})},g=F.download,E=u,x=()=>{rxjs.forkJoin([F.literacy("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=i.value.filter(C=>{var p;return!((p=C.Excludes)!=null&&p.includes(l.value.OrgCategory))}),i.value.forEach(C=>{C.Files=n.Attachments.filter(p=>p.Type===C.Type),C.Uploaded=e.computed(()=>C.Files.filter(p=>!p.Deleted).length)}),j().init("literacy",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=s=>{var C,p;if(o.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Attachments:i.value.reduce((r,N)=>r.concat(N.Files),[]),Before:(C=m.value)==null?void 0:C.Form5Before,After:(p=m.value)==null?void 0:p.Form5After,Submit:s?"true":"false"};F.literacy("saveAttachment",n).subscribe(r=>{r&&(s?E("next",x):x())})},y=()=>{if(m.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,I(m.value,s))}return!Object.keys(o.value).length};return e.onMounted(x),e.provide("editable",a),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file"),r=e.resolveComponent("tw-date-time"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",VV,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("p",fV,[...n[4]||(n[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",NV,[e.createElementVNode("table",EV,[e.createElementVNode("thead",bV,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",gV,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",yV,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",kV,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(C,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(a)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,uV)):e.createCommentVNode("",!0),e.unref(a)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:d.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,hV)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",xV,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",$V,"已上傳")):(e.openBlock(),e.createElementBlock("span",BV,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:V=>c(d,V)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",_V,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,V=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:V},[V.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",CV,[e.createElementVNode("a",{class:"tag-link my-1",download:V.Name,href:e.unref(g)(V.Path)},e.toDisplayString(V.Name),9,TV),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>V.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,wV)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(l).ApplyTime?(e.openBlock(),e.createElementBlock("div",DV,[n[10]||(n[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(r,{value:e.unref(l).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",SV,[e.createElementVNode("table",AV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(m).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(m).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",FV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),disabled:e.unref(f),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,UV)])):e.createCommentVNode("",!0)],64)}}},MV={class:"block"},IV={class:"mt-4"},jV={class:"table-responsive mt-3 mb-0"},OV={class:"table align-middle gray-table"},LV={key:0,width:"1"},RV={key:0},qV={class:"d-flex gap-2"},zV=["onClick"],GV={class:"table-responsive mt-3 mb-0"},YV={class:"table align-middle gray-table"},JV={class:"mt-4"},QV={class:"table align-middle gray-table side-table"},HV={key:0,class:"block-bottom bg-light-teal"},WV={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.computed(()=>Y("literacy",l.value.Status,4)),a=e.ref({}),o=e.computed(()=>i.value.filter(s=>!s.Deleted)),l=e.ref({}),c=()=>i.value.push({}),g=u,E=()=>{rxjs.forkJoin([F.literacy("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=n.Benefits,i.value.length||c(),j().init("literacy",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},x=s=>s.Deleted=!0,_=s=>{var C,p;if(a.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:l.value,Benefits:i.value,Before:(C=m.value)==null?void 0:C.Form4Before,After:(p=m.value)==null?void 0:p.Form4After,Submit:s?"true":"false"};F.literacy("saveBenefit",n).subscribe(()=>{s?g("next"):E()})},y=()=>{let s={Benefit:"不可量化成果"};return a.value=I(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((n,C)=>Object.assign(a.value,I(n,s,`item-${C}-`))),m.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(a.value,I(m.value,s))),!Object.keys(a.value).length};return e.onMounted(E),e.provide("editable",f),(s,n)=>{const C=e.resolveComponent("input-text"),p=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",MV,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",IV,[e.createElementVNode("div",jV,[e.createElementVNode("table",OV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"目標值",-1)),n[7]||(n[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",LV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(N,d)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Title`],modelValue:N.Title,"onUpdate:modelValue":t=>N.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Target`],modelValue:N.Target,"onUpdate:modelValue":t=>N.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a)[`item-${d}-Description`],rows:"1",modelValue:N.Description,"onUpdate:modelValue":t=>N.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",RV,[e.createElementVNode("div",qV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>x(N),type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,zV)):e.createCommentVNode("",!0),d+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:c,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",GV,[e.createElementVNode("table",YV,[n[10]||(n[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":n[0]||(n[0]=N=>e.unref(l).Benefit=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",JV,[e.createElementVNode("table",QV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":n[1]||(n[1]=N=>e.unref(m).Form4Before=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":n[2]||(n[2]=N=>e.unref(m).Form4After=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",HV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[3]||(n[3]=N=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[4]||(n[4]=N=>_(!0)),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},KV={class:"block"},XV={class:"mt-4"},ZV={class:"table-responsive mt-3 mb-0"},vV={class:"table align-middle gray-table"},ef={class:"text-end"},tf={class:"text-end"},lf={class:"table-responsive"},of={class:"table align-middle gray-table"},nf=["colspan"],rf={key:0,width:"1"},af={class:"text-end"},sf={key:0},df={class:"d-flex gap-2"},cf=["onClick"],mf={class:"mt-4"},pf={class:"table-responsive mt-3 mb-0"},Vf={class:"table align-middle gray-table"},ff={key:0,width:"1"},Nf={class:"text-end"},Ef={key:0},bf={class:"d-flex gap-2"},gf=["onClick"],yf={class:"mt-4"},kf={class:"table align-middle gray-table side-table"},uf={key:0,class:"block-bottom bg-light-teal"},hf={class:"text-center"},xf={class:"mb-5"},$f={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("literacy",l.value.Status,3)),f=e.ref({}),a=e.computed(()=>g.value.filter(d=>!d.Deleted)),o=e.computed(()=>E.value.filter(d=>!d.Deleted)),l=e.ref({}),c=e.ref(),g=e.ref([]),E=e.ref([]),x=e.ref({}),_=e.ref(0),y=()=>g.value.push({}),s=()=>E.value.push({}),n=u,C=()=>{rxjs.forkJoin([F.literacy("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];l.value=t.Project,g.value=t.OtherSubsidies,E.value=t.BudgetPlans,x.value=t.GrantTargetSetting,E.value.length||s(),j().init("literacy",l.value),i.value=l.value.changeApply,l.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=(d,t)=>{var k,S;if(f.value={},d&&!N()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>x.value.GrantLimit*1e4){c.value.show(()=>r(d,!0));return}const V={Project:l.value,OtherSubsidies:g.value,BudgetPlans:E.value,Before:(k=i.value)==null?void 0:k.Form3Before,After:(S=i.value)==null?void 0:S.Form3After,Submit:d?"true":"false"};F.literacy("saveFunding",V).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=I(l.value,d),d={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},a.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`other-${V}-`))),d={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`plan-${V}-`))),i.value&&(d={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,I(i.value,d))),!Object.keys(f.value).length};return e.onMounted(C),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=a.value.reduce((d,t)=>d+q(t.Amount),0),_.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),a.value.forEach(d=>d.percent=Math.round(q(d.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(d=>d.sum=q(d.Amount)+q(d.OtherAmount))}),(d,t)=>{var B;const V=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),w=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",KV,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",XV,[e.createElementVNode("div",ZV,[e.createElementVNode("table",vV,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",ef,e.toDisplayString((B=e.unref(l).OtherAmount)==null?void 0:B.toLocaleString()),1),e.createElementVNode("td",tf,e.toDisplayString(e.unref(_).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",lf,[e.createElementVNode("table",of,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,nf)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",rf,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`other-${T}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",af,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",sf,[e.createElementVNode("div",df,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,cf)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",mf,[e.createElementVNode("div",pf,[e.createElementVNode("table",Vf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",ff,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`plan-${T}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Nf,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Ef,[e.createElementVNode("div",bf,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,gf)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",yf,[e.createElementVNode("table",kf,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(i).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(i).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(i).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(i).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",uf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:c},{default:e.withCtx(()=>[e.createElementVNode("div",hf,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",xf,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(x).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Bf={class:"block"},_f={class:"square-title"},Cf={class:"text-teal fw-bold py-3"},Tf={class:"table-responsive mb-0"},wf={class:"table align-middle gray-table"},Df={class:"text-end"},Sf={class:"text-teal fw-bold pb-3"},Af={class:"text-teal fw-bold pb-3"},Ff={class:"mt-4"},Uf={class:"table align-middle gray-table"},Pf={class:"text-center"},Mf={key:0,width:"180"},If={class:"text-center"},jf=["href"],Of={key:0,class:"text-center"},Lf={key:0},Rf={key:1,class:"text-pink"},qf={key:1,class:"tag-group mt-2 gap-1"},zf={key:0,class:"tag tag-green-light"},Gf=["download","href"],Yf=["onClick"],Jf={key:0,class:"block-bottom bg-light-teal"},Qf=["disabled"],Hf={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.computed(()=>l.value.some(y=>!y.Files.filter(s=>!s.Deleted).length)),m=e.computed(()=>!a.value||a.value.Status==="請款中"),f=e.computed(()=>{var y;return((y=a.value)==null?void 0:y.Status)==="通過"}),a=e.ref(),o=e.ref({}),l=e.ref([{Type:11,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]}]),c=(y,s)=>{s.Type==="application/pdf"&&y.Files.push({Type:y.Type,Path:s.Path,Name:`${o.value.ProjectID}_請款_${y.Title}.pdf`})},g=F.download,E=u,x=()=>{F.literacy("getPayment",{ID:b.id}).subscribe(y=>{o.value=y.Project,j().init("literacy",o.value),l.value=l.value.filter(s=>{var n;return!((n=s.Excludes)!=null&&n.includes(o.value.OrgCategory))}),l.value.forEach(s=>{s.Files=y.Attachments.filter(n=>n.Type===s.Type),s.Uploaded=e.computed(()=>s.Files.filter(n=>!n.Deleted).length)}),a.value=y.Payments.find(s=>s.Stage===1),H().init(a.value)})},_=y=>{const s={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:o.value.ApprovedAmount},Attachments:l.value.reduce((n,C)=>n.concat(C.Files),[]),Submit:y?"true":"false"};F.literacy("savePayment",s).subscribe(n=>{n&&(y?E("next",x):x())})};return e.onMounted(x),e.provide("editable",m),(y,s)=>{var p;const n=e.resolveComponent("required-label"),C=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Bf,[e.createElementVNode("h5",_f,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",Cf,"核定經費: "+e.toDisplayString((p=e.unref(o).ApprovedAmount)==null?void 0:p.toLocaleString())+"元",1),e.createElementVNode("div",Tf,[e.createElementVNode("table",wf,[s[6]||(s[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Df,e.toDisplayString(e.unref(o).ApprovedAmount),1),s[2]||(s[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[3]||(s[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[4]||(s[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[5]||(s[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Sf,"本期實際撥款: "+e.toDisplayString(e.unref(a).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Af,"累積實際撥款: "+e.toDisplayString(e.unref(a).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),s[12]||(s[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),s[13]||(s[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Ff,[e.createElementVNode("table",Uf,[e.createElementVNode("thead",Pf,[e.createElementVNode("tr",null,[s[7]||(s[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),s[8]||(s[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",Mf,"狀態")):e.createCommentVNode("",!0),s[9]||(s[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(r,N)=>(e.openBlock(),e.createElementBlock("tr",{key:r},[e.createElementVNode("td",If,e.toDisplayString(N+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(n,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.Title),1)]),_:2},1024)]),e.unref(m)&&r.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:r.Template,style:{width:"140px"},type:"button"},[...s[10]||(s[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,jf)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",Of,[r.Uploaded?(e.openBlock(),e.createElementBlock("span",Lf,"已上傳")):(e.openBlock(),e.createElementBlock("span",Rf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(m)&&!r.Uploaded?(e.openBlock(),e.createBlock(C,{key:0,accept:".pdf",onFile:d=>c(r,d)},null,8,["onFile"])):e.createCommentVNode("",!0),r.Uploaded?(e.openBlock(),e.createElementBlock("div",qf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.Files,d=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:d},[d.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",zf,[e.createElementVNode("a",{class:"tag-link my-1",download:d.Name,href:e.unref(g)(d.Path)},e.toDisplayString(d.Name),9,Gf),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:t=>d.Deleted=!0,type:"button"},[...s[11]||(s[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Yf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",Jf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:s[0]||(s[0]=r=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:s[1]||(s[1]=r=>_(!0)),disabled:e.unref(i),type:"button"},[...s[14]||(s[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Qf)])):e.createCommentVNode("",!0)],64)}}},Wf={class:"block"},Kf={class:"square-title"},Xf={class:"text-teal fw-bold py-3"},Zf={class:"text-teal fw-bold pb-3"},vf={class:"table-responsive"},eN={class:"table align-middle gray-table"},tN={class:"text-end"},lN={class:"text-end"},oN={class:"text-end"},nN={class:"mt-4"},rN={class:"table align-middle gray-table"},aN={class:"text-center"},sN={key:0,width:"180"},dN={class:"text-center"},cN=["href"],iN={key:0,class:"text-center"},mN={key:0},pN={key:1,class:"text-pink"},VN={key:1,class:"tag-group mt-2 gap-1"},fN={key:0,class:"tag tag-green-light"},NN=["download","href"],EN=["onClick"],bN={key:0,class:"block-bottom bg-light-teal"},gN=["disabled"],yN={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>i.value<=0||x.value.some(p=>!p.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),a=e.ref(0),o=e.ref(),l=e.ref(0),c=e.ref({}),g=e.computed(()=>c.value.ApprovedAmount?Math.min(Math.round(i.value*100/c.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.round(i.value*100/l.value*100)/100:0),x=e.ref([{Type:21,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/LIT/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/LIT/3-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/LIT/4-補助清單.docx",Files:[]}]),_=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:`${c.value.ProjectID}_結案核銷_${p.Title}.pdf`})},y=F.download,s=u,n=()=>{F.literacy("getPayment",{ID:b.id}).subscribe(p=>{c.value=p.Project,j().init("literacy",c.value),x.value=x.value.filter(r=>{var N;return!((N=r.Excludes)!=null&&N.includes(c.value.OrgCategory))}),x.value.forEach(r=>{r.Files=p.Attachments.filter(N=>N.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(N=>!N.Deleted).length)}),o.value=p.Payments.find(r=>r.Stage===2),o.value&&(i.value=o.value.TotalSpentAmount),l.value=p.Payments.filter(r=>r.Stage<2&&r.Status==="通過").reduce((r,N)=>r+N.CurrentActualPaidAmount,0),a.value=l.value,H().init(o.value,l.value)})},C=p=>{const r={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:x.value.reduce((N,d)=>N.concat(d.Files),[]),Submit:p?"true":"false"};F.literacy("savePayment",r).subscribe(N=>{N&&(p?s("next",n):n())})};return e.onMounted(n),e.provide("editable",f),(p,r)=>{var V;const N=e.resolveComponent("input-integer"),d=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Wf,[e.createElementVNode("h5",Kf,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",Xf,"核定經費: "+e.toDisplayString((V=e.unref(c).ApprovedAmount)==null?void 0:V.toLocaleString())+"元",1),e.createElementVNode("p",Zf,"賸餘款: "+e.toDisplayString((e.unref(c).ApprovedAmount-e.unref(i)).toLocaleString())+"元",1),e.createElementVNode("div",vf,[e.createElementVNode("table",eN,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",tN,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(N,{max:e.unref(a),modelValue:e.unref(i),"onUpdate:modelValue":r[0]||(r[0]=k=>e.isRef(i)?i.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",lN,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",oN,e.toDisplayString(e.unref(E))+"%",1)])])])]),r[10]||(r[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[11]||(r[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",nN,[e.createElementVNode("table",rN,[e.createElementVNode("thead",aN,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",sN,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",dN,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(f)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,cN)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",iN,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",mN,"已上傳")):(e.openBlock(),e.createElementBlock("span",pN,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!k.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:w=>_(k,w)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",VN,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,w=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:w},[w.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",fN,[e.createElementVNode("a",{class:"tag-link my-1",download:w.Name,href:e.unref(y)(w.Path)},e.toDisplayString(w.Name),9,NN),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>w.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,EN)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",bN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=k=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=k=>C(!0)),disabled:e.unref(m),type:"button"},[...r[12]||(r[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,gN)])):e.createCommentVNode("",!0)],64)}}},kN={__name:"ProgressBar",setup(h){const u=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,i)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:u,type:"literacy"})}}},uN={class:"block"},hN={class:"mt-4"},xN={class:"table align-middle gray-table side-table"},$N={key:0,class:"d-flex align-items-center gap-2"},BN={class:"input-group w-auto"},_N={class:"text-teal-dark"},CN={key:1,class:"invalid mt-0"},TN={class:"table-responsive mt-4"},wN={class:"table align-middle gray-table"},DN={key:0},SN={class:"input-group"},AN={key:0,class:"invalid mt-0"},FN={key:0},UN={class:"d-flex gap-2"},PN=["onClick"],MN={class:"mt-4"},IN={class:"table align-middle gray-table"},jN={key:0},ON=["value"],LN={key:0},RN={class:"d-flex gap-2"},qN=["onClick"],zN={class:"mt-4"},GN={class:"table align-middle gray-table side-table"},YN={key:0,class:"block-bottom bg-light-teal"},JN={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),f=e.computed(()=>E.value.PlanEndDate),a=e.computed(()=>Y("literacy",g.value.Status,2)),o=e.ref({}),l=e.computed(()=>x.value.filter(d=>!d.Deleted)),c=e.computed(()=>_.value.filter(d=>!d.Deleted)),g=e.ref({}),E=e.ref({}),x=e.ref([]),_=e.ref([]),y=()=>F.literacy("createItem",{ID:b.id}).subscribe(d=>x.value.push(d)),s=()=>_.value.push({Type:0,ItemID:0}),n=u,C=()=>{rxjs.forkJoin([F.literacy("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];g.value=t.Project,E.value=t.GrantType,x.value=t.Items,_.value=t.Schedules,x.value.length||y(),_.value.length||s(),j().init("literacy",g.value),m.value=g.value.changeApply,g.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=d=>{var V,k;if(o.value={},d&&!N()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:g.value,Items:x.value,Schedules:_.value,Before:(V=m.value)==null?void 0:V.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:d?"true":"false"};F.literacy("saveWorkSchedule",t).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=I(g.value,d),d={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`item-${V}-`))),d={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},c.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`schedule-${V}-`))),m.value&&(d={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,I(m.value,d))),!Object.keys(o.value).length};return e.onMounted(C),e.provide("editable",a),(d,t)=>{const V=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),w=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),B=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",uN,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",hN,[e.createElementVNode("table",xN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",$N,[e.createElementVNode("div",BN,[e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(g).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(g).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",_N,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",CN,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",TN,[e.createElementVNode("table",wN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",DN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`item-${P}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",SN,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",AN,e.toDisplayString(e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`item-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",FN,[e.createElementVNode("div",UN,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,PN)):e.createCommentVNode("",!0),P+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",MN,[e.createElementVNode("table",IN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",jN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-Type`],options:i,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,ON)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`schedule-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",LN,[e.createElementVNode("div",RN,[e.unref(c).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,qN)):e.createCommentVNode("",!0),P+1===e.unref(c).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",zN,[e.createElementVNode("table",GN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",YN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},QN={class:"block"},HN={class:"mt-4"},WN={class:"table align-middle gray-table side-table"},KN={key:0},XN={key:1,class:"text-light-gray"},ZN={class:"mt-4"},vN={class:"table align-middle gray-table side-table"},e1={class:"row g-3"},t1={class:"col-12 col-xl-2"},l1={class:"text-gray mb-2"},o1={class:"col-12 col-xl-3"},n1={class:"text-gray mb-2"},r1={class:"col-12 col-xl-4"},a1={class:"row g-1"},s1={class:"col-7"},d1={class:"col-5"},c1={class:"col-12 col-xl-3"},i1={class:"text-gray mb-2"},m1={class:"col-12"},p1={class:"text-gray mb-2"},V1={class:"mt-4"},f1={class:"table align-middle gray-table side-table"},N1={class:"mt-4"},E1={class:"table align-middle gray-table side-table"},b1={key:0,class:"table-responsive mt-3 mb-0"},g1={class:"table align-middle gray-table"},y1={key:0},k1={key:0},u1={class:"d-flex gap-2"},h1=["onClick"],x1={class:"mt-4"},$1={class:"table align-middle gray-table side-table"},B1={key:0,class:"block-bottom bg-light-teal"},_1={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.ref(),a=e.computed(()=>Y("multiple",g.value.Status,1)),o=e.ref({}),l=e.ref([]),c=e.computed(()=>E.value.filter(r=>!r.Deleted)),g=e.ref({}),E=e.ref([]),x=e.computed({get:()=>!!c.value.length,set:r=>{r?_():E.value.forEach(N=>N.Deleted=!0)}}),_=()=>E.value.push({}),y=u,s=()=>{F.multiple("getApplication",{Apply:b.apply?"true":"false",ID:b.id}).subscribe(r=>{g.value=r.Project,f.value=r.Contacts,E.value=r.ReceivedSubsidies,g.value.OrgCategory=g.value.OrgCategory||null,j().init("multiple",g.value),m.value=g.value.changeApply,g.value.changeApply=void 0})},n=r=>r.Deleted=!0,C=r=>{var d,t;if(o.value={},r&&!p()){e.nextTick(()=>{var V;return(V=document.querySelector(".invalid"))==null?void 0:V.scrollIntoView({behavior:"smooth",block:"center"})});return}const N={Project:g.value,Contacts:f.value,ReceivedSubsidies:E.value.filter(V=>V.ID||!V.Deleted),Before:(d=m.value)==null?void 0:d.Form1Before,After:(t=m.value)==null?void 0:t.Form1After,Submit:r?"true":"false"};F.multiple("saveApplication",N).subscribe(V=>{r?y("next",V.ID):g.value.ID?s():window.location.href=`Application.aspx?ID=${V.ID}`})},p=()=>{let r={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return o.value=I(g.value,r),r={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},f.value.forEach((N,d)=>Object.assign(o.value,I(N,r,`contact-${d}-`))),r={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},E.value.forEach((N,d)=>Object.assign(o.value,I(N,r,`received-${d}-`))),m.value&&(r={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,I(m.value,r))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.multiple("getZgsCodes",{CodeGroup:"MULField"}),F.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(r=>{l.value=r[0],i.value=r[1],b.id?s():F.multiple("getEmptyApplication").subscribe(N=>{g.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},N),f.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("multiple",g.value)})})}),e.provide("editable",a),(r,N)=>{const d=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),V=e.resolveComponent("input-select"),k=e.resolveComponent("input-textarea"),S=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",QN,[N[43]||(N[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",HN,[e.createElementVNode("table",WN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[N[15]||(N[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).Year),1)]),e.createElementVNode("tr",null,[N[16]||(N[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(g).ProjectID?(e.openBlock(),e.createElementBlock("span",KN,e.toDisplayString(e.unref(g).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",XN,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[N[17]||(N[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[18]||(N[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).ProjectName,modelValue:e.unref(g).ProjectName,"onUpdate:modelValue":N[0]||(N[0]=D=>e.unref(g).ProjectName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[19]||(N[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{"empty-value":null,error:e.unref(o).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).Field,"onUpdate:modelValue":N[1]||(N[1]=D=>e.unref(g).Field=D)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[20]||(N[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(g).OrgName,"onUpdate:modelValue":N[2]||(N[2]=D=>e.unref(g).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[21]||(N[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(i),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).OrgCategory,"onUpdate:modelValue":N[3]||(N[3]=D=>e.unref(g).OrgCategory=D)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[22]||(N[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(g).TaxID,"onUpdate:modelValue":N[4]||(N[4]=D=>e.unref(g).TaxID=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[23]||(N[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(g).Address,"onUpdate:modelValue":N[5]||(N[5]=D=>e.unref(g).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),N[44]||(N[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",ZN,[e.createElementVNode("table",vN,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(D,B)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",e1,[e.createElementVNode("div",t1,[e.createElementVNode("div",l1,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[24]||(N[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${B}-Name`],modelValue:D.Name,"onUpdate:modelValue":A=>D.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",o1,[e.createElementVNode("div",n1,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[25]||(N[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${B}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":A=>D.JobTitle=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",r1,[N[26]||(N[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",a1,[e.createElementVNode("div",s1,[e.createVNode(t,{modelValue:D.Phone,"onUpdate:modelValue":A=>D.Phone=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",d1,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":A=>D.PhoneExt=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",c1,[e.createElementVNode("div",i1,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[27]||(N[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${B}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":A=>D.MobilePhone=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",m1,[e.createElementVNode("div",p1,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[28]||(N[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${B}-EMail`],modelValue:D.EMail,"onUpdate:modelValue":A=>D.EMail=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),N[45]||(N[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",V1,[e.createElementVNode("table",f1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[29]||(N[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[N[30]||(N[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(k,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(g).Target,"onUpdate:modelValue":N[6]||(N[6]=D=>e.unref(g).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[31]||(N[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(g).Summary,"onUpdate:modelValue":N[7]||(N[7]=D=>e.unref(g).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[32]||(N[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Quantified,"onUpdate:modelValue":N[8]||(N[8]=D=>e.unref(g).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[33]||(N[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Qualitative,"onUpdate:modelValue":N[9]||(N[9]=D=>e.unref(g).Qualitative=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",N1,[e.createElementVNode("table",E1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[N[39]||(N[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(S,{modelValue:e.unref(x),"onUpdate:modelValue":N[10]||(N[10]=D=>e.isRef(x)?x.value=D:null)},null,8,["modelValue"]),e.unref(x)?(e.openBlock(),e.createElementBlock("div",b1,[e.createElementVNode("table",g1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[N[34]||(N[34]=e.createElementVNode("th",null,"計畫名稱",-1)),N[35]||(N[35]=e.createElementVNode("th",null,"補助單位",-1)),N[36]||(N[36]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",y1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(D,B)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${B}-Name`],modelValue:D.Name,"onUpdate:modelValue":A=>D.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${B}-Unit`],modelValue:D.Unit,"onUpdate:modelValue":A=>D.Unit=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${B}-Amount`],modelValue:D.Amount,"onUpdate:modelValue":A=>D.Amount=A},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",k1,[e.createElementVNode("div",u1,[e.unref(c).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:A=>n(D),type:"button"},[...N[37]||(N[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,h1)):e.createCommentVNode("",!0),B+1===e.unref(c).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:_,type:"button"},[...N[38]||(N[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[N[42]||(N[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",x1,[e.createElementVNode("table",$1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[40]||(N[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(m).Form1Before,"onUpdate:modelValue":N[11]||(N[11]=D=>e.unref(m).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...N[41]||(N[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(m).Form1After,"onUpdate:modelValue":N[12]||(N[12]=D=>e.unref(m).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",B1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:N[13]||(N[13]=D=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:N[14]||(N[14]=D=>C(!0)),type:"button"},[...N[46]||(N[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},C1={class:"block"},T1={key:0,class:"text-pink lh-base mt-4"},w1={class:"mt-4"},D1={class:"table align-middle gray-table"},S1={class:"text-center"},A1={key:0,width:"180"},F1={class:"text-center"},U1={key:0},P1=["innerHTML"],M1=["href"],I1={key:0,class:"text-center"},j1={key:0},O1={key:1,class:"text-pink"},L1={key:1,class:"tag-group mt-2 gap-1"},R1={key:0,class:"tag tag-green-light"},q1=["download","href"],z1=["onClick"],G1={key:1,class:"text-center mt-4"},Y1={class:"mt-4"},J1={class:"table align-middle gray-table side-table"},Q1={key:0,class:"block-bottom bg-light-teal"},H1=["disabled"],W1={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=1&id=${b.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=2&id=${b.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=3&id=${b.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=4&id=${b.id}`,Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),m=e.ref(),f=e.computed(()=>i.value.some(s=>!s.Optional&&!s.Files.filter(n=>!n.Deleted).length)),a=e.computed(()=>Y("multiple",l.value.Status,2)),o=e.ref({}),l=e.ref({}),c=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:l.value.ProjectID+"_"+(s.Multiple?n.Name:`${s.Title}.pdf`)})},g=F.download,E=u,x=()=>{rxjs.forkJoin([F.multiple("getAttachment",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=i.value.filter(C=>{var p;return!((p=C.Excludes)!=null&&p.includes(l.value.OrgCategory))}),l.value.Status>=42&&i.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),i.value.forEach(C=>{C.Files=n.Attachments.filter(p=>p.Type===C.Type),C.Uploaded=e.computed(()=>C.Files.filter(p=>!p.Deleted).length)}),j().init("multiple",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},_=s=>{var C,p;if(o.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:b.id,Attachments:i.value.reduce((r,N)=>r.concat(N.Files),[]),Before:(C=m.value)==null?void 0:C.Form5Before,After:(p=m.value)==null?void 0:p.Form5After,Submit:s?"true":"false"};F.multiple("saveAttachment",n).subscribe(r=>{r&&(s?E("next",x):x())})},y=()=>{if(m.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,I(m.value,s))}return!Object.keys(o.value).length};return e.onMounted(x),e.provide("editable",a),(s,n)=>{const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file"),r=e.resolveComponent("tw-date-time"),N=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",C1,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("p",T1,[...n[4]||(n[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",w1,[e.createElementVNode("table",D1,[e.createElementVNode("thead",S1,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",A1,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",F1,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[d.Optional?(e.openBlock(),e.createElementBlock("span",U1,e.toDisplayString(d.Title),1)):(e.openBlock(),e.createBlock(C,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.Title),1)]),_:2},1024))]),e.unref(a)&&d.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:d.Comment},null,8,P1)):e.createCommentVNode("",!0),e.unref(a)&&d.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:d.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,M1)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",I1,[d.Uploaded?(e.openBlock(),e.createElementBlock("span",j1,"已上傳")):(e.openBlock(),e.createElementBlock("span",O1,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&(d.Multiple||!d.Uploaded)?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:V=>c(d,V)},null,8,["onFile"])):e.createCommentVNode("",!0),d.Uploaded?(e.openBlock(),e.createElementBlock("div",L1,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.Files,V=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:V},[V.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",R1,[e.createElementVNode("a",{class:"tag-link my-1",download:V.Name,href:e.unref(g)(V.Path)},e.toDisplayString(V.Name),9,q1),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>V.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,z1)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(l).ApplyTime?(e.openBlock(),e.createElementBlock("div",G1,[n[10]||(n[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(r,{value:e.unref(l).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Y1,[e.createElementVNode("table",J1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(m).Form5Before,"onUpdate:modelValue":n[0]||(n[0]=d=>e.unref(m).Form5Before=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(C,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(m).Form5After,"onUpdate:modelValue":n[1]||(n[1]=d=>e.unref(m).Form5After=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Q1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[2]||(n[2]=d=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[3]||(n[3]=d=>_(!0)),disabled:e.unref(f),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,H1)])):e.createCommentVNode("",!0)],64)}}},K1={class:"block"},X1={class:"mt-4"},Z1={class:"table-responsive mt-3 mb-0"},v1={class:"table align-middle gray-table"},eE={key:0,width:"1"},tE={key:0},lE={class:"d-flex gap-2"},oE=["onClick"],nE={class:"table-responsive mt-3 mb-0"},rE={class:"table align-middle gray-table"},aE={class:"mt-4"},sE={class:"table align-middle gray-table side-table"},dE={key:0,class:"block-bottom bg-light-teal"},cE={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=e.ref(),f=e.computed(()=>Y("multiple",l.value.Status,4)),a=e.ref({}),o=e.computed(()=>i.value.filter(s=>!s.Deleted)),l=e.ref({}),c=()=>i.value.push({}),g=u,E=()=>{rxjs.forkJoin([F.multiple("getBenefit",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(s=>{const n=s[0];l.value=n.Project,i.value=n.Benefits,i.value.length||c(),j().init("multiple",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},x=s=>s.Deleted=!0,_=s=>{var C,p;if(a.value={},s&&!y()){e.nextTick(()=>{var r;return(r=document.querySelector(".invalid"))==null?void 0:r.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:l.value,Benefits:i.value,Before:(C=m.value)==null?void 0:C.Form4Before,After:(p=m.value)==null?void 0:p.Form4After,Submit:s?"true":"false"};F.multiple("saveBenefit",n).subscribe(()=>{s?g("next"):E()})},y=()=>{let s={Benefit:"不可量化成果"};return a.value=I(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((n,C)=>Object.assign(a.value,I(n,s,`item-${C}-`))),m.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(a.value,I(m.value,s))),!Object.keys(a.value).length};return e.onMounted(E),e.provide("editable",f),(s,n)=>{const C=e.resolveComponent("input-text"),p=e.resolveComponent("input-textarea"),r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",K1,[n[14]||(n[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",X1,[e.createElementVNode("div",Z1,[e.createElementVNode("table",v1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"目標值",-1)),n[7]||(n[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",eE,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(N,d)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Title`],modelValue:N.Title,"onUpdate:modelValue":t=>N.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(a)[`item-${d}-Target`],modelValue:N.Target,"onUpdate:modelValue":t=>N.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a)[`item-${d}-Description`],rows:"1",modelValue:N.Description,"onUpdate:modelValue":t=>N.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",tE,[e.createElementVNode("div",lE,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>x(N),type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,oE)):e.createCommentVNode("",!0),d+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:c,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",nE,[e.createElementVNode("table",rE,[n[10]||(n[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":n[0]||(n[0]=N=>e.unref(l).Benefit=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[13]||(n[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",aE,[e.createElementVNode("table",sE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[11]||(n[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":n[1]||(n[1]=N=>e.unref(m).Form4Before=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...n[12]||(n[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(a).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":n[2]||(n[2]=N=>e.unref(m).Form4After=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",dE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[3]||(n[3]=N=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[4]||(n[4]=N=>_(!0)),type:"button"},[...n[15]||(n[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},iE={class:"block"},mE={class:"mt-4"},pE={class:"table-responsive mt-3 mb-0"},VE={class:"table align-middle gray-table"},fE={class:"text-end"},NE={class:"text-end"},EE={class:"table-responsive"},bE={class:"table align-middle gray-table"},gE=["colspan"],yE={key:0,width:"1"},kE={class:"text-end"},uE={key:0},hE={class:"d-flex gap-2"},xE=["onClick"],$E={class:"mt-4"},BE={class:"table-responsive mt-3 mb-0"},_E={class:"table align-middle gray-table"},CE={key:0,width:"1"},TE={class:"text-end"},wE={key:0},DE={class:"d-flex gap-2"},SE=["onClick"],AE={class:"mt-4"},FE={class:"table align-middle gray-table side-table"},UE={key:0,class:"block-bottom bg-light-teal"},PE={class:"text-center"},ME={class:"mb-5"},IE={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(),m=e.computed(()=>Y("multiple",l.value.Status,3)),f=e.ref({}),a=e.computed(()=>g.value.filter(d=>!d.Deleted)),o=e.computed(()=>E.value.filter(d=>!d.Deleted)),l=e.ref({}),c=e.ref(),g=e.ref([]),E=e.ref([]),x=e.ref({}),_=e.ref(0),y=()=>g.value.push({}),s=()=>E.value.push({}),n=u,C=()=>{rxjs.forkJoin([F.multiple("getFunding",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];l.value=t.Project,g.value=t.OtherSubsidies,E.value=t.BudgetPlans,x.value=t.GrantTargetSetting,E.value.length||s(),j().init("multiple",l.value),i.value=l.value.changeApply,l.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=(d,t)=>{var k,S;if(f.value={},d&&!N()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>x.value.GrantLimit*1e4){c.value.show(()=>r(d,!0));return}const V={Project:l.value,OtherSubsidies:g.value,BudgetPlans:E.value,Before:(k=i.value)==null?void 0:k.Form3Before,After:(S=i.value)==null?void 0:S.Form3After,Submit:d?"true":"false"};F.multiple("saveFunding",V).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return f.value=I(l.value,d),d={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},a.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`other-${V}-`))),d={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},o.value.forEach((t,V)=>Object.assign(f.value,I(t,d,`plan-${V}-`))),i.value&&(d={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(f.value,I(i.value,d))),!Object.keys(f.value).length};return e.onMounted(C),e.provide("editable",m),e.watchEffect(()=>{l.value.OtherAmount=a.value.reduce((d,t)=>d+q(t.Amount),0),_.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),a.value.forEach(d=>d.percent=Math.round(q(d.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(d=>d.sum=q(d.Amount)+q(d.OtherAmount))}),(d,t)=>{var B;const V=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),w=e.resolveComponent("required-label"),D=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",iE,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",mE,[e.createElementVNode("div",pE,[e.createElementVNode("table",VE,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",fE,e.toDisplayString((B=e.unref(l).OtherAmount)==null?void 0:B.toLocaleString()),1),e.createElementVNode("td",NE,e.toDisplayString(e.unref(_).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",EE,[e.createElementVNode("table",bE,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(m)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,gE)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",yE,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`other-${T}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`other-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",kE,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`other-${T}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",uE,[e.createElementVNode("div",hE,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xE)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(m)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",$E,[e.createElementVNode("div",BE,[e.createElementVNode("table",_E,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock("th",CE,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,T)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(f)[`plan-${T}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(f)[`plan-${T}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",TE,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f)[`plan-${T}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(m)?(e.openBlock(),e.createElementBlock("td",wE,[e.createElementVNode("div",DE,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>p(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,SE)):e.createCommentVNode("",!0),T+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",AE,[e.createElementVNode("table",FE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3Before,rows:"4",modelValue:e.unref(i).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(i).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(f).Form3After,rows:"4",modelValue:e.unref(i).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(i).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",UE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>r(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(D,{ref_key:"modal",ref:c},{default:e.withCtx(()=>[e.createElementVNode("div",PE,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",ME,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(x).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},jE={class:"block"},OE={class:"square-title"},LE={class:"text-teal fw-bold py-3"},RE={class:"table-responsive mb-0"},qE={class:"table align-middle gray-table"},zE={class:"text-end"},GE={class:"text-teal fw-bold pb-3"},YE={class:"text-teal fw-bold pb-3"},JE={class:"mt-4"},QE={class:"table align-middle gray-table"},HE={class:"text-center"},WE={key:0,width:"180"},KE={class:"text-center"},XE=["href"],ZE={key:0,class:"text-center"},vE={key:0},eb={key:1,class:"text-pink"},tb={key:1,class:"tag-group mt-2 gap-1"},lb={key:0,class:"tag tag-green-light"},ob=["download","href"],nb=["onClick"],rb={key:0,class:"block-bottom bg-light-teal"},ab=["disabled"],sb={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>c.value.some(s=>!s.Files.filter(n=>!n.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),a=e.computed(()=>{var s;return((s=o.value)==null?void 0:s.Status)==="通過"}),o=e.ref(),l=e.ref({}),c=e.ref([{Type:11,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]}]),g=(s,n)=>{n.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:n.Path,Name:`${l.value.ProjectID}_第一期_${s.Title}.pdf`})},E=F.download,x=u,_=()=>{F.multiple("getPayment",{ID:b.id}).subscribe(s=>{l.value=s.Project,j().init("multiple",l.value),c.value=c.value.filter(n=>{var C;return!((C=n.Excludes)!=null&&C.includes(l.value.OrgCategory))}),c.value.forEach(n=>{n.Files=s.Attachments.filter(C=>C.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(C=>!C.Deleted).length)}),o.value=s.Payments.find(n=>n.Stage===1),o.value?i.value=o.value.CurrentRequestAmount:i.value=Math.round(l.value.ApprovedAmount*b.setting.DisbursementRatioPct/100),H().init(o.value)})},y=s=>{const n={Payment:{ProjectID:b.id,Stage:1,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:i.value},Attachments:c.value.reduce((C,p)=>C.concat(p.Files),[]),Submit:s?"true":"false"};F.multiple("savePayment",n).subscribe(C=>{C&&(s?x("next",_):_())})};return e.onMounted(_),e.provide("editable",f),(s,n)=>{var r;const C=e.resolveComponent("required-label"),p=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",jE,[e.createElementVNode("h5",OE,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",LE,"核定經費: "+e.toDisplayString((r=e.unref(l).ApprovedAmount)==null?void 0:r.toLocaleString())+"元",1),e.createElementVNode("div",RE,[e.createElementVNode("table",qE,[n[6]||(n[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",zE,e.toDisplayString(e.unref(i)),1),n[2]||(n[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),n[4]||(n[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),n[5]||(n[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",GE,"本期實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",YE,"累積實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[12]||(n[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[13]||(n[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",JE,[e.createElementVNode("table",QE,[e.createElementVNode("thead",HE,[e.createElementVNode("tr",null,[n[7]||(n[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[8]||(n[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",WE,"狀態")):e.createCommentVNode("",!0),n[9]||(n[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(N,d)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",KE,e.toDisplayString(d+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(C,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(N.Title),1)]),_:2},1024)]),e.unref(f)&&N.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:N.Template,style:{width:"140px"},type:"button"},[...n[10]||(n[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,XE)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",ZE,[N.Uploaded?(e.openBlock(),e.createElementBlock("span",vE,"已上傳")):(e.openBlock(),e.createElementBlock("span",eb,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!N.Uploaded?(e.openBlock(),e.createBlock(p,{key:0,accept:".pdf",onFile:t=>g(N,t)},null,8,["onFile"])):e.createCommentVNode("",!0),N.Uploaded?(e.openBlock(),e.createElementBlock("div",tb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",lb,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,ob),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>t.Deleted=!0,type:"button"},[...n[11]||(n[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,nb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",rb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[0]||(n[0]=N=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[1]||(n[1]=N=>y(!0)),disabled:e.unref(m),type:"button"},[...n[14]||(n[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ab)])):e.createCommentVNode("",!0)],64)}}},db={class:"block"},cb={class:"square-title"},ib={class:"text-teal fw-bold py-3"},mb={class:"table-responsive mb-0"},pb={class:"table align-middle gray-table"},Vb={class:"text-end"},fb={class:"text-end"},Nb={class:"text-end"},Eb={class:"text-end"},bb={class:"text-teal fw-bold pb-3"},gb={class:"text-teal fw-bold pb-3"},yb={class:"mt-4"},kb={class:"table align-middle gray-table"},ub={class:"text-center"},hb={key:0,width:"180"},xb={class:"text-center"},$b=["href"],Bb={key:0,class:"text-center"},_b={key:0},Cb={key:1,class:"text-pink"},Tb={key:1,class:"tag-group mt-2 gap-1"},wb={key:0,class:"tag tag-green-light"},Db=["download","href"],Sb=["onClick"],Ab={key:0,class:"block-bottom bg-light-teal"},Fb=["disabled"],Ub={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.ref(0),f=e.computed(()=>i.value<=0||n.value.some(t=>!t.Files.filter(V=>!V.Deleted).length)),a=e.computed(()=>!c.value||c.value.Status==="請款中"),o=e.computed(()=>{var t;return((t=c.value)==null?void 0:t.Status)==="通過"}),l=e.ref(0),c=e.ref(),g=e.ref(0),E=e.ref(0),x=e.ref({}),_=e.computed(()=>x.value.ApprovedAmount?Math.min(Math.round(i.value*100/x.value.ApprovedAmount*100)/100,100):0),y=e.computed(()=>s.value?Math.round(i.value*100/s.value*100)/100:0),s=e.computed(()=>E.value+(o.value?c.value.CurrentActualPaidAmount:0)),n=e.ref([{Type:21,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:24,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),C=(t,V)=>{V.Type==="application/pdf"&&t.Files.push({Type:t.Type,Path:V.Path,Name:`${x.value.ProjectID}_第二期_${t.Title}.pdf`})},p=F.download,r=u,N=()=>{F.multiple("getPayment",{ID:b.id}).subscribe(t=>{x.value=t.Project,j().init("multiple",x.value),n.value=n.value.filter(k=>{var S;return!((S=k.Excludes)!=null&&S.includes(x.value.OrgCategory))}),n.value.forEach(k=>{k.Files=t.Attachments.filter(S=>S.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(S=>!S.Deleted).length)}),c.value=t.Payments.find(k=>k.Stage===2),c.value?m.value=c.value.CurrentRequestAmount:m.value=Math.round(x.value.ApprovedAmount*b.setting.DisbursementRatioPct/100);const V=t.Payments.filter(k=>k.Stage<2&&k.Status==="通過");g.value=V.reduce((k,S)=>k+S.CurrentRequestAmount,0),E.value=V.reduce((k,S)=>k+S.CurrentActualPaidAmount,0),l.value=x.value.ApprovedAmount,H().init(c.value,E.value)})},d=t=>{const V={Payment:{ProjectID:b.id,Stage:2,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,CurrentRequestAmount:m.value,TotalSpentAmount:i.value},Attachments:n.value.reduce((k,S)=>k.concat(S.Files),[]),Submit:t?"true":"false"};F.multiple("savePayment",V).subscribe(k=>{k&&(t?r("next",N):N())})};return e.onMounted(N),e.provide("editable",a),(t,V)=>{var D;const k=e.resolveComponent("input-integer"),S=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",db,[e.createElementVNode("h5",cb,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",ib,"核定經費: "+e.toDisplayString((D=e.unref(x).ApprovedAmount)==null?void 0:D.toLocaleString())+"元",1),e.createElementVNode("div",mb,[e.createElementVNode("table",pb,[V[3]||(V[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Vb,e.toDisplayString(e.unref(m)),1),e.createElementVNode("td",fb,e.toDisplayString(e.unref(E)),1),e.createElementVNode("td",null,[e.createVNode(k,{max:e.unref(l),modelValue:e.unref(i),"onUpdate:modelValue":V[0]||(V[0]=B=>e.isRef(i)?i.value=B:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Nb,e.toDisplayString(e.unref(_))+"%",1),e.createElementVNode("td",Eb,e.toDisplayString(e.unref(y))+"%",1)])])])]),e.unref(o)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",bb,"本期實際撥款: "+e.toDisplayString(e.unref(c).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",gb,"累積實際撥款: "+e.toDisplayString(e.unref(s).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),V[9]||(V[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),V[10]||(V[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",yb,[e.createElementVNode("table",kb,[e.createElementVNode("thead",ub,[e.createElementVNode("tr",null,[V[4]||(V[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),V[5]||(V[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",hb,"狀態")):e.createCommentVNode("",!0),V[6]||(V[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),(B,A)=>(e.openBlock(),e.createElementBlock("tr",{key:B},[e.createElementVNode("td",xb,e.toDisplayString(A+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(S,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(B.Title),1)]),_:2},1024)]),e.unref(a)&&B.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:B.Template,style:{width:"140px"},type:"button"},[...V[7]||(V[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,$b)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Bb,[B.Uploaded?(e.openBlock(),e.createElementBlock("span",_b,"已上傳")):(e.openBlock(),e.createElementBlock("span",Cb,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&!B.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:T=>C(B,T)},null,8,["onFile"])):e.createCommentVNode("",!0),B.Uploaded?(e.openBlock(),e.createElementBlock("div",Tb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",wb,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(p)(T.Path)},e.toDisplayString(T.Name),9,Db),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:P=>T.Deleted=!0,type:"button"},[...V[8]||(V[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Sb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Ab,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[1]||(V[1]=B=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[2]||(V[2]=B=>d(!0)),disabled:e.unref(f),type:"button"},[...V[11]||(V[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Fb)])):e.createCommentVNode("",!0)],64)}}},Pb={class:"block"},Mb={class:"square-title"},Ib={class:"text-teal fw-bold py-3"},jb={class:"text-teal fw-bold pb-3"},Ob={class:"table-responsive"},Lb={class:"table align-middle gray-table"},Rb={class:"text-end"},qb={class:"text-end"},zb={class:"text-end"},Gb={class:"mt-4"},Yb={class:"table align-middle gray-table"},Jb={class:"text-center"},Qb={key:0,width:"180"},Hb={class:"text-center"},Wb=["href"],Kb={key:0,class:"text-center"},Xb={key:0},Zb={key:1,class:"text-pink"},vb={key:1,class:"tag-group mt-2 gap-1"},eg={key:0,class:"tag tag-green-light"},tg=["download","href"],lg=["onClick"],og={class:"text-center"},ng={colspan:"2"},rg={key:0,class:"block-bottom bg-light-teal"},ag=["disabled"],sg={__name:"Payment3",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref(0),m=e.computed(()=>i.value<=0||x.value.some(p=>!p.Files.filter(r=>!r.Deleted).length)),f=e.computed(()=>!o.value||o.value.Status==="請款中"),a=e.ref(0),o=e.ref(),l=e.ref(0),c=e.ref({}),g=e.computed(()=>c.value.ApprovedAmount?Math.min(Math.round(i.value*100/c.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.round(i.value*100/l.value*100)/100:0),x=e.ref([{Type:31,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:32,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:33,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:34,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),_=(p,r)=>{r.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:r.Path,Name:`${c.value.ProjectID}_結案核銷_${p.Title}.pdf`})},y=F.download,s=u,n=()=>{F.multiple("getPayment",{ID:b.id}).subscribe(p=>{c.value=p.Project,j().init("multiple",c.value),x.value=x.value.filter(r=>{var N;return!((N=r.Excludes)!=null&&N.includes(c.value.OrgCategory))}),x.value.forEach(r=>{r.Files=p.Attachments.filter(N=>N.Type===r.Type),r.Uploaded=e.computed(()=>r.Files.filter(N=>!N.Deleted).length)}),o.value=p.Payments.find(r=>r.Stage===3),l.value=p.Payments.filter(r=>r.Stage<3&&r.Status==="通過").reduce((r,N)=>r+N.CurrentActualPaidAmount,0),a.value=c.value.ApprovedAmount,H().init(o.value,l.value)})},C=p=>{const r={Payment:{ProjectID:b.id,Stage:3,ActDisbursementRatioPct:b.setting.DisbursementRatioPct,TotalSpentAmount:i.value},Attachments:x.value.reduce((N,d)=>N.concat(d.Files),[]),Submit:p?"true":"false"};F.multiple("savePayment",r).subscribe(N=>{N&&(p?s("next",n):n())})};return e.onMounted(n),e.provide("editable",f),(p,r)=>{var k;const N=e.resolveComponent("input-integer"),d=e.resolveComponent("required-label"),t=e.resolveComponent("input-file"),V=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pb,[e.createElementVNode("h5",Mb,e.toDisplayString(h.setting.DisbursementType)+e.toDisplayString(h.setting.Note),1),e.createElementVNode("p",Ib,"核定經費: "+e.toDisplayString((k=e.unref(c).ApprovedAmount)==null?void 0:k.toLocaleString())+"元",1),e.createElementVNode("p",jb,"賸餘款: "+e.toDisplayString((e.unref(c).ApprovedAmount-e.unref(i)).toLocaleString())+"元",1),e.createElementVNode("div",Ob,[e.createElementVNode("table",Lb,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[3]||(r[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",Rb,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(N,{max:e.unref(a),modelValue:e.unref(i),"onUpdate:modelValue":r[0]||(r[0]=S=>e.isRef(i)?i.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",qb,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",zb,e.toDisplayString(e.unref(E))+"%",1)])])])]),r[11]||(r[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),r[12]||(r[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Gb,[e.createElementVNode("table",Yb,[e.createElementVNode("thead",Jb,[e.createElementVNode("tr",null,[r[5]||(r[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),r[6]||(r[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(f)?(e.openBlock(),e.createElementBlock("th",Qb,"狀態")):e.createCommentVNode("",!0),r[7]||(r[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),(S,w)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",Hb,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(f)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...r[8]||(r[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Wb)):e.createCommentVNode("",!0)]),e.unref(f)?(e.openBlock(),e.createElementBlock("td",Kb,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",Xb,"已上傳")):(e.openBlock(),e.createElementBlock("span",Zb,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(f)&&!S.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:D=>_(S,D)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",vb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",eg,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(y)(D.Path)},e.toDisplayString(D.Name),9,tg),e.unref(f)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:B=>D.Deleted=!0,type:"button"},[...r[9]||(r[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,lg)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128)),e.createElementVNode("tr",null,[e.createElementVNode("td",og,e.toDisplayString(e.unref(x).length+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...r[10]||(r[10]=[e.createTextVNode("其他資料（5分鐘精華影片）",-1)])]),_:1})])]),e.createElementVNode("td",ng,[e.createVNode(V)])])])])])]),e.unref(f)?(e.openBlock(),e.createElementBlock("div",rg,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:r[1]||(r[1]=S=>C()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:r[2]||(r[2]=S=>C(!0)),disabled:e.unref(m),type:"button"},[...r[13]||(r[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ag)])):e.createCommentVNode("",!0)],64)}}},dg={__name:"ProgressBar",setup(h){const u=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(b,i)=>{const m=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(m,{steps:u,type:"multiple"})}}},cg={class:"block"},ig={class:"mt-4"},mg={class:"table align-middle gray-table side-table"},pg={key:0,class:"d-flex align-items-center gap-2"},Vg={class:"input-group w-auto"},fg={class:"text-teal-dark"},Ng={key:1,class:"invalid mt-0"},Eg={class:"table-responsive mt-4"},bg={class:"table align-middle gray-table"},gg={key:0},yg={class:"input-group"},kg={key:0,class:"invalid mt-0"},ug={key:0},hg={class:"d-flex gap-2"},xg=["onClick"],$g={class:"mt-4"},Bg={class:"table align-middle gray-table"},_g={key:0},Cg=["value"],Tg={key:0},wg={class:"d-flex gap-2"},Dg=["onClick"],Sg={class:"mt-4"},Ag={class:"table align-middle gray-table side-table"},Fg={key:0,class:"block-bottom bg-light-teal"},Ug={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=[{value:1,text:"50%"},{value:2,text:"100%"}],m=e.ref(),f=e.computed(()=>E.value.PlanEndDate),a=e.computed(()=>Y("multiple",g.value.Status,2)),o=e.ref({}),l=e.computed(()=>x.value.filter(d=>!d.Deleted)),c=e.computed(()=>_.value.filter(d=>!d.Deleted)),g=e.ref({}),E=e.ref({}),x=e.ref([]),_=e.ref([]),y=()=>F.multiple("createItem",{ID:b.id}).subscribe(d=>x.value.push(d)),s=()=>_.value.push({Type:0,ItemID:0}),n=u,C=()=>{rxjs.forkJoin([F.multiple("getWorkSchedule",{Apply:b.apply?"true":"false",ID:b.id})]).subscribe(d=>{const t=d[0];g.value=t.Project,E.value=t.GrantType,x.value=t.Items,_.value=t.Schedules,x.value.length||y(),_.value.length||s(),j().init("multiple",g.value),m.value=g.value.changeApply,g.value.changeApply=void 0})},p=d=>d.Deleted=!0,r=d=>{var V,k;if(o.value={},d&&!N()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:g.value,Items:x.value,Schedules:_.value,Before:(V=m.value)==null?void 0:V.Form2Before,After:(k=m.value)==null?void 0:k.Form2After,Submit:d?"true":"false"};F.multiple("saveWorkSchedule",t).subscribe(()=>{d?n("next"):C()})},N=()=>{let d={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=I(g.value,d),d={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`item-${V}-`))),d={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},c.value.forEach((t,V)=>Object.assign(o.value,I(t,d,`schedule-${V}-`))),m.value&&(d={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,I(m.value,d))),!Object.keys(o.value).length};return e.onMounted(C),e.provide("editable",a),(d,t)=>{const V=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),w=e.resolveComponent("input-text"),D=e.resolveComponent("input-month"),B=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cg,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",ig,[e.createElementVNode("table",mg,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(f)?(e.openBlock(),e.createElementBlock("div",pg,[e.createElementVNode("div",Vg,[e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":t[0]||(t[0]=T=>e.unref(g).StartTime=T)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(f),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":t[1]||(t[1]=T=>e.unref(g).EndTime=T)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",fg,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(f)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Ng,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Eg,[e.createElementVNode("table",bg,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",gg,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`item-${P}-Title`],modelValue:T.Title,"onUpdate:modelValue":U=>T.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",yg,[e.createVNode(D,{"empty-value":0,modelValue:T.Begin,"onUpdate:modelValue":U=>T.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(D,{"empty-value":0,modelValue:T.End,"onUpdate:modelValue":U=>T.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",kg,e.toDisplayString(e.unref(o)[`item-${P}-Begin`]||e.unref(o)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`item-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`item-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",ug,[e.createElementVNode("div",hg,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xg)):e.createCommentVNode("",!0),P+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:y,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",$g,[e.createElementVNode("table",Bg,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(a)?(e.openBlock(),e.createElementBlock("th",_g,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(T,P)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-Type`],options:i,modelValue:T.Type,"onUpdate:modelValue":U=>T.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${P}-ItemID`],options:e.unref(l),modelValue:T.ItemID,"onUpdate:modelValue":U=>T.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,Cg)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(o)[`schedule-${P}-Deadline`],modelValue:T.Deadline,"onUpdate:modelValue":U=>T.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o)[`schedule-${P}-Content`],rows:"1",modelValue:T.Content,"onUpdate:modelValue":U=>T.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",Tg,[e.createElementVNode("div",wg,[e.unref(c).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>p(T),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Dg)):e.createCommentVNode("",!0),P+1===e.unref(c).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Sg,[e.createElementVNode("table",Ag,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=T=>e.unref(m).Form2Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(B,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":t[3]||(t[3]=T=>e.unref(m).Form2After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",Fg,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=T=>r()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=T=>r(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Pg={class:"block bg-light-teal-100 rounded-4 py-4"},Mg={class:"fw-bold"},Ig={class:"d-flex align-items-center gap-3 text-teal-dark mt-3"},jg={class:"block rounded-4 mt-4"},Og=["innerHTML"],Lg={class:"mt-3 d-flex flex-column gap-2"},Rg=["download","href"],qg={class:"mt-3"},zg=["data-caption","href"],Gg=["alt","src"],Yg={class:"mt-3 d-flex flex-column gap-2"},Jg=["href"],Qg={__name:"NewsDetail",props:{id:{type:[Number,String]}},setup(h){const u=h,b=e.ref(),i=e.ref([]),m=e.ref({}),f=e.ref([]),a=e.ref([]),o=F.download;return e.onMounted(()=>{F.system("getNews",{ID:u.id}).subscribe(l=>{m.value=l.News,i.value=l.Files,f.value=l.Images,a.value=l.Videos,e.nextTick(()=>{Fancybox.bind(b.value,"[data-fancybox]")})})}),(l,c)=>{const g=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pg,[e.createElementVNode("h5",Mg,e.toDisplayString(e.unref(m).Title),1),e.createElementVNode("ul",Ig,[e.createElementVNode("li",null,[c[0]||(c[0]=e.createTextVNode("公告日期：",-1)),e.createVNode(g,{value:e.unref(m).EnableTime},null,8,["value"])]),e.createElementVNode("li",null,"公告單位："+e.toDisplayString(e.unref(m).UserOrg),1)])]),e.createElementVNode("div",jg,[e.createElementVNode("div",{class:"mb-5",style:{"white-space":"pre-line"},innerHTML:e.unref(m).Content},null,8,Og),e.unref(i).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[c[2]||(c[2]=e.createElementVNode("h5",{class:"square-title"},"相關附件",-1)),e.createElementVNode("ul",Lg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",download:E.Name,href:e.unref(o)(E.Path)},[e.createTextVNode(e.toDisplayString(E.Name)+" ",1),c[1]||(c[1]=e.createElementVNode("i",{class:"fa-solid fa-file-arrow-down text-teal-dark ms-1"},null,-1))],8,Rg)]))),128))])],64)):e.createCommentVNode("",!0),e.unref(f).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[c[4]||(c[4]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關照片",-1)),e.createElementVNode("div",qg,[e.createElementVNode("div",{class:"image-preview mt-3",ref_key:"container",ref:b},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(E,x)=>(e.openBlock(),e.createElementBlock("div",{class:"image-preview__item",key:E},[e.createElementVNode("a",{"data-fancybox":"gallery","data-caption":`相片 ${x}`,href:e.unref(o)(E.Path)},[e.createElementVNode("img",{alt:`相片 ${x}`,src:e.unref(o)(E.Path)},null,8,Gg),c[3]||(c[3]=e.createElementVNode("div",{class:"image-preview__item-overlay"},[e.createElementVNode("button",{"aria-label":"檢視圖片",class:"btn btn-view-image",tabindex:"-1",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"})])],-1))],8,zg)]))),128))],512)])],64)):e.createCommentVNode("",!0),e.unref(a).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[c[6]||(c[6]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關影片",-1)),e.createElementVNode("ul",Yg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",href:E.URL,target:"_blank"},[e.createTextVNode(e.toDisplayString(E.Title)+" ",1),c[5]||(c[5]=e.createStaticVNode('<svg class="ms-1" xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19 24" fill="none"><g clip-path="url(#clip0_1051_6167)"><path d="M17.7333 0.5H12.6667C11.913 0.5 11.4 1.12067 11.4 1.76667C11.4 2.05167 11.4887 2.36833 11.7673 2.65967L13.4077 4.3L9.87367 7.834C9.60767 8.1 9.5 8.423 9.5 8.727C9.5 9.43633 10.0573 9.99367 10.7667 9.99367C11.096 9.99367 11.4127 9.87333 11.6597 9.62L15.1937 6.086L16.834 7.72633C17.1253 8.005 17.442 8.09367 17.727 8.09367C18.373 8.09367 18.9937 7.58067 18.9937 6.827V1.76667C18.9937 1.12067 18.4807 0.5 17.727 0.5H17.7333ZM15.2 7.88467L12.559 10.5257C12.084 11.0007 11.4443 11.2667 10.7667 11.2667C9.348 11.2667 8.23333 10.152 8.23333 8.73333C8.23333 8.05567 8.49933 7.42233 8.97433 6.941L11.6153 4.3L10.8743 3.559C10.716 3.39433 10.5957 3.217 10.488 3.03333H1.26667C0.563667 3.03333 0 3.597 0 4.3V18.2333C0 18.93 0.563667 19.5 1.26667 19.5H15.2C15.8967 19.5 16.4667 18.93 16.4667 18.2333V9.01833C16.2893 8.917 16.1183 8.79667 15.9663 8.651L15.2 7.88467Z" fill="#037F72"></path></g><defs><clipPath id="clip0_1051_6167"><rect width="19" height="19" fill="white" transform="translate(0 0.5)"></rect></clipPath></defs></svg>',1))],8,Jg)]))),128))])],64)):e.createCommentVNode("",!0)])],64)}}},Hg={class:"block rounded-4 mt-4"},Wg={class:"table-responsive",style:{"min-height":"400px"}},Kg={class:"table teal-table","aria-label":"公告列表"},Xg={"data-th":"公告時間:"},Zg={"data-th":"公告標題:",class:"text-start"},vg=["href"],ey={"data-th":"發布單位:",class:"text-start"},ty={__name:"NewsList",setup(h){const u=e.ref([]),b=e.ref(1),i=e.ref(10),m=e.computed(()=>u.value.slice((b.value-1)*i.value,b.value*i.value)),f=(a,o)=>{b.value=parseInt(a),i.value=parseInt(o)};return e.onMounted(()=>{F.system("getPublishedNewsList").subscribe(a=>u.value=a.List)}),(a,o)=>{const l=e.resolveComponent("tw-date"),c=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",Hg,[o[1]||(o[1]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")])])],-1)),e.createElementVNode("div",Wg,[e.createElementVNode("table",Kg,[o[0]||(o[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告時間"),e.createElementVNode("th",{scope:"col",class:"text-start"},"標題"),e.createElementVNode("th",{scope:"col",style:{width:"300px"}},"發布單位")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),g=>(e.openBlock(),e.createElementBlock("tr",{key:g},[e.createElementVNode("td",Xg,[e.createVNode(l,{value:g.EnableTime},null,8,["value"])]),e.createElementVNode("td",Zg,[e.createElementVNode("a",{class:"link-black",href:`NewsDetail.aspx?ID=${g.ID}`},e.toDisplayString(g.Title),9,vg)]),e.createElementVNode("td",ey,e.toDisplayString(g.UserOrg)+" "+e.toDisplayString(g.UserName),1)]))),128))])])]),e.createVNode(c,{count:e.unref(u).length,onChange:f,page:e.unref(b),"page-size":e.unref(i)},null,8,["count","page","page-size"])])}}},ly={key:0,class:"notice mb-3"},oy={class:"notice-content"},ny=["onClick"],ry={class:"notice-action"},ay=["href"],sy=ne({__name:"NewsMarquee",setup(h){let u=0;const b=e.ref([]),i=e.ref(),m=e.computed(()=>F.toUrl("/OFS/Information/NewsList.aspx")),f=a=>{window.open(F.toUrl(`/OFS/Information/NewsDetail.aspx?ID=${a.ID}`),"_blank")};return e.onMounted(()=>{F.system("getPublishedNewsList").subscribe(a=>{b.value=a.List,b.value.length>1&&setInterval(()=>{u++,i.value.style.transition="transform 1s ease-in-out",i.value.style.transform=`translateY(-${u*1.5}rem)`,u===b.value.length&&setTimeout(()=>{i.value.style.transition="none",i.value.style.transform="translateY(0)",u=0},1e3)},5e3)})}),(a,o)=>{const l=e.resolveComponent("tw-date");return e.unref(b).length?(e.openBlock(),e.createElementBlock("div",ly,[e.createElementVNode("div",oy,[e.createElementVNode("div",{class:"notice-list",ref_key:"marquee",ref:i},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),c=>(e.openBlock(),e.createElementBlock("h3",{class:"notice-title",onClick:g=>f(c),style:{"margin-bottom":"0.5rem",cursor:"pointer"},key:c},[e.createVNode(l,{value:c.EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(c.Title),1)],8,ny))),128)),e.unref(b).length>1?(e.openBlock(),e.createElementBlock("h3",{key:0,class:"notice-title",onClick:o[0]||(o[0]=c=>f(e.unref(b)[0])),style:{cursor:"pointer"}},[e.createVNode(l,{value:e.unref(b)[0].EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(e.unref(b)[0].Title),1)])):e.createCommentVNode("",!0)],512)]),e.createElementVNode("div",ry,[e.createElementVNode("a",{class:"btn-link",href:e.unref(m)},"全部公告",8,ay)])])):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-8802a1c0"]]),dy={key:0,class:"scroll-bottom-panel"},cy={class:"d-flex flex-column gap-3 mb-3"},iy={class:"d-flex gap-2"},my={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},py={class:"text-nowrap my-2 d-flex align-items-center"},Vy={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(h){const u=h,b=j(),i=[{value:1,text:"通過"},{value:2,text:"退回修改"}],m=e.ref({}),f=e.ref({ID:u.id,Result:1}),a=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),m.value=I(f.value,l),Object.keys(m.value).length){o();return}F[u.type]("reviewApplicationChange",f.value).subscribe(c=>{c&&(window.location.href="../ReviewChecklist.aspx?type=5")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,c)=>{const g=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[h.type].organizer&&e.unref(b)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",dy,[c[3]||(c[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",cy,[e.createElementVNode("li",iy,[c[2]||(c[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",my,[e.createElementVNode("div",py,[e.createVNode(g,{options:i,modelValue:e.unref(f).Result,"onUpdate:modelValue":c[0]||(c[0]=x=>e.unref(f).Result=x)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":c[1]||(c[1]=x=>e.unref(f).Reason=x)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:a,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},fy={key:0,class:"scroll-bottom-panel"},Ny={class:"d-flex flex-column gap-3 mb-3"},Ey={class:"d-flex gap-2"},by={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},gy={class:"text-nowrap my-2 d-flex align-items-center"},yy={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(h){const u=h,b=j(),i=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],m=e.ref({}),f=e.ref({ID:u.id,Result:1}),a=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),m.value=I(f.value,l),Object.keys(m.value).length){o();return}F[u.type]("reviewApplication",f.value).subscribe(c=>{c&&(window.location.href="../ReviewChecklist.aspx?type=4")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,c)=>{const g=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[h.type].organizer&&e.unref(b)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",fy,[c[3]||(c[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ny,[e.createElementVNode("li",Ey,[c[2]||(c[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",by,[e.createElementVNode("div",gy,[e.createVNode(g,{options:i,modelValue:e.unref(f).Result,"onUpdate:modelValue":c[0]||(c[0]=x=>e.unref(f).Result=x)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":c[1]||(c[1]=x=>e.unref(f).Reason=x)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:a,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},ky={class:"d-flex align-items-center gap-3"},uy={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},hy={class:"modal-content"},xy={class:"modal-header"},$y={class:"fs-24 fw-bold text-green-light"},By={class:"modal-body"},_y={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},Cy=["disabled"],Ty={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(h){const u=h,b=e.computed(()=>!a.value||a.value===l[u.type].organizer),i=e.ref(),m=e.ref(),f=e.computed(()=>l[u.type].organizerName),a=e.ref(0),o=e.computed(()=>{var y;return(y=E.value.find(s=>s.UnitID===g.value))==null?void 0:y.reviewers}),l=j(),c=e.computed(()=>f.value?"移轉案件":"認領案件"),g=e.ref(0),E=e.ref([]),x=()=>{F[u.type]("queryReviewUnits").subscribe(y=>{E.value=y,rxjs.forkJoin(E.value.map(s=>F[u.type]("queryReviewersByUnit",{ID:s.UnitID}))).subscribe(s=>{s.forEach((n,C)=>{E.value[C].reviewers=n,n.some(p=>p.UserID===a.value)&&(g.value=E.value[C].UnitID)}),bootstrap.Modal.getOrCreateInstance(m.value).show()})})},_=()=>{F[u.type]("saveOrganizer",{ID:u.id,Organizer:a.value}).subscribe(y=>{y&&window.location.reload()})};return e.onMounted(()=>{F.system("getRoles").subscribe(y=>{i.value=y.IsOrganizer||y.IsSupervisor||y.IsSysAdmin})}),e.watch(f,()=>a.value=l[u.type].organizer),e.watch(g,()=>{o.value.some(y=>y.UserID===a.value)||(a.value=0)}),(y,s)=>{const n=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ky,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(f)||"尚無"),1),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal",onClick:x,type:"button"},e.toDisplayString(e.unref(c)),1)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:m,tabindex:"-1"},[e.createElementVNode("div",uy,[e.createElementVNode("div",hy,[e.createElementVNode("div",xy,[e.createElementVNode("h4",$y,e.toDisplayString(e.unref(c)),1),s[2]||(s[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",By,[e.createElementVNode("div",null,[s[3]||(s[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(n,{"empty-value":0,options:e.unref(E),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(g),"onUpdate:modelValue":s[0]||(s[0]=C=>e.isRef(g)?g.value=C:null)},null,8,["options","modelValue"]),e.createVNode(n,{class:"mt-2","empty-value":0,options:e.unref(o),"text-name":"Name","value-name":"UserID",modelValue:e.unref(a),"onUpdate:modelValue":s[1]||(s[1]=C=>e.isRef(a)?a.value=C:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",_y,[s[4]||(s[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:_,disabled:e.unref(b),type:"button"},"確認",8,Cy)])])])])],512)]))],64)}}},wy={key:0,class:"scroll-bottom-panel"},Dy={class:"d-flex flex-column gap-3 mb-3"},Sy={key:0,class:"d-flex gap-2 align-items-center"},Ay={key:1,class:"d-flex gap-2 align-items-center"},Fy={class:"d-flex gap-2"},Uy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Py={class:"text-nowrap my-2 d-flex align-items-center"},My=["disabled"],Iy={__name:"ProjectPaymentReview",props:{id:{type:[Number,String]},type:{type:String}},setup(h){const u=h,b=j(),i=H(),m=[{value:1,text:"通過"},{value:2,text:"退回修改"}],f=e.computed(()=>!i.stage),a=e.ref({}),o=e.ref({ID:u.id,Result:1,Reason:""}),l=e.computed(()=>o.value.Result===1?u.type==="culture"&&i.stage===2||u.type==="education"||u.type==="accessibility"&&i.stage===2?"確定撥款及結案":u.type==="multiple"&&i.stage===3||u.type==="literacy"&&i.stage===2?"確定核銷及結案":"確定撥款":"確定退回"),c=()=>{const E={};if(o.value.Result>1&&(E.Reason="原因"),a.value=I(o.value,E),Object.keys(a.value).length){g();return}o.value.Stage=i.stage,F[u.type]("reviewPayment",o.value).subscribe(x=>{x&&(window.location.href="../ReviewChecklist.aspx?type=5")})},g=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>o.value.Result,E=>{E>1&&g()}),e.watch(()=>i.amount,E=>o.value.Amount=E),(E,x)=>{const _=e.resolveComponent("input-integer"),y=e.resolveComponent("input-radio-group"),s=e.resolveComponent("input-textarea");return e.unref(i).status==="審核中"&&e.unref(b)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",wy,[x[6]||(x[6]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Dy,[e.unref(i).amount?(e.openBlock(),e.createElementBlock("li",Sy,[x[3]||(x[3]=e.createElementVNode("span",{class:"text-gray"},"本期撥付：",-1)),e.createVNode(_,{class:"w-auto",max:e.unref(i).amount,modelValue:e.unref(o).Amount,"onUpdate:modelValue":x[0]||(x[0]=n=>e.unref(o).Amount=n)},null,8,["max","modelValue"])])):e.createCommentVNode("",!0),e.unref(i).paid?(e.openBlock(),e.createElementBlock("li",Ay,[x[4]||(x[4]=e.createElementVNode("span",{class:"text-gray"},"前期累積撥付：",-1)),e.createTextVNode(" "+e.toDisplayString(e.unref(i).paid.toLocaleString()),1)])):e.createCommentVNode("",!0),e.createElementVNode("li",Fy,[x[5]||(x[5]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Uy,[e.createElementVNode("div",Py,[e.createVNode(y,{options:m,modelValue:e.unref(o).Result,"onUpdate:modelValue":x[1]||(x[1]=n=>e.unref(o).Result=n)},null,8,["modelValue"])]),e.unref(o).Result>1?(e.openBlock(),e.createBlock(s,{key:0,error:e.unref(a).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(o).Reason,"onUpdate:modelValue":x[2]||(x[2]=n=>e.unref(o).Reason=n)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:c,disabled:e.unref(f),type:"button"},e.toDisplayString(e.unref(l)),9,My)])):e.createCommentVNode("",!0)}}},jy={class:"step-line-wrapper"},Oy={class:"step-line"},Ly={key:0,class:"tag tag-white"},Ry={key:1,class:"tag tag-white"},qy={key:0,class:"step-line"},zy={key:0,class:"tag tag-white"},Gy={class:"step-line"},Yy={key:0,class:"tag tag-white"},Jy={key:0,class:"tag tag-white"},Qy={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(h){const u=j(),b=h,i=m=>{location.href=`${m}.aspx?ID=${b.id}`};return(m,f)=>(e.openBlock(),e.createElementBlock("div",jy,[e.createElementVNode("div",Oy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:h.step===1}]),onClick:f[0]||(f[0]=a=>i("Audit")),role:"button"},[f[4]||(f[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),h.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(u)[b.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",Ly,"編輯中")):e.unref(u)[b.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",Ry,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),h.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",qy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:h.step===4}]),onClick:f[1]||(f[1]=a=>i("Progress")),role:"button"},[f[5]||(f[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),h.step===4?(e.openBlock(),e.createElementBlock("div",zy,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",Gy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:h.step===5}]),onClick:f[2]||(f[2]=a=>i("Report")),role:"button"},[f[6]||(f[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),h.step===5?(e.openBlock(),e.createElementBlock("div",Yy,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:h.step===6}]),onClick:f[3]||(f[3]=a=>i("Payment")),role:"button"},[f[7]||(f[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),h.step===6?(e.openBlock(),e.createElementBlock("div",Jy,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},Hy={class:"block"},Wy={class:"square-title"},Ky=["innerHTML"],Xy={class:"table-responsive mt-3"},Zy={class:"table align-middle gray-table"},vy={key:0,class:"text-center"},ek={class:"text-center"},tk=["href"],lk={key:0,class:"text-center"},ok={key:0},nk={key:1,class:"text-pink"},rk={key:1,class:"tag-group mt-2 gap-1"},ak={key:0,class:"tag tag-green-light"},sk=["download","href"],dk=["onClick"],ck={key:0,class:"block-bottom bg-light-teal"},ik=["disabled"],mk={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]},type:{type:String}},emits:["next"],setup(h,{emit:u}){let b;const i=h,m=e.computed(()=>f.value.some(_=>!_.Optional&&!_.Files.filter(y=>!y.Deleted).length)),f=e.ref(i.data.docs.map(_=>({..._,Files:[]}))),a=e.ref(),o=e.ref({}),l=(_,y)=>{(y.Type==="application/zip"||y.Type==="application/x-zip-compressed")&&_.Files.push({Type:_.Type,Path:y.Path,Name:`${i.id}_${_.Title}_${b}.zip`})},c=F.download,g=u,E=()=>{F[i.type]("getReport",{ID:i.id,Stage:i.data.id}).subscribe(_=>{var y;o.value=_.Report,f.value.forEach(s=>{s.Files=_.Attachments.filter(n=>n.Type===s.Type),s.Uploaded=e.computed(()=>s.Files.filter(n=>!n.Deleted).length)}),a.value=!o.value.Status||o.value.Status==="暫存"||o.value.Status==="退回修正",b=(y=o.value)!=null&&y.Reviewer?"修訂版":"初版",j().init(i.type,_.Project,o.value)})},x=_=>{const y={ID:i.id,Stage:i.data.id,Attachments:f.value.reduce((s,n)=>s.concat(n.Files),[]),Submit:_?"true":"false"};F[i.type]("saveReport",y).subscribe(s=>{s&&(_?g("next",E):E())})};return e.onMounted(E),e.provide("editable",a),(_,y)=>{const s=e.resolveComponent("required-label"),n=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Hy,[e.createElementVNode("h5",Wy,e.toDisplayString(h.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:h.data.description},null,8,Ky),e.createElementVNode("div",Xy,[e.createElementVNode("table",Zy,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[y[2]||(y[2]=e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號",-1)),y[3]||(y[3]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(a)?(e.openBlock(),e.createElementBlock("th",vy,"狀態")):e.createCommentVNode("",!0),y[4]||(y[4]=e.createElementVNode("th",null,"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(C,p)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",ek,e.toDisplayString(p+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Title),1)]),_:2},1024)]),e.unref(a)&&C.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:C.Template,style:{width:"140px"},type:"button"},[...y[5]||(y[5]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,tk)):e.createCommentVNode("",!0)]),e.unref(a)?(e.openBlock(),e.createElementBlock("td",lk,[C.Uploaded?(e.openBlock(),e.createElementBlock("span",ok,"已上傳")):(e.openBlock(),e.createElementBlock("span",nk,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(a)&&!C.Uploaded?(e.openBlock(),e.createBlock(n,{key:0,accept:".zip",onFile:r=>l(C,r)},null,8,["onFile"])):e.createCommentVNode("",!0),C.Uploaded?(e.openBlock(),e.createElementBlock("div",rk,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.Files,r=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:r},[r.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ak,[e.createElementVNode("a",{class:"tag-link my-1",download:r.Name,href:e.unref(c)(r.Path)},e.toDisplayString(r.Name),9,sk),e.unref(a)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:N=>r.Deleted=!0,type:"button"},[...y[6]||(y[6]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,dk)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",ck,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:y[0]||(y[0]=C=>x()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:y[1]||(y[1]=C=>x(!0)),disabled:e.unref(m),type:"button"},[...y[7]||(y[7]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ik)])):e.createCommentVNode("",!0)],64)}}},pk={key:0,class:"scroll-bottom-panel"},Vk={class:"d-flex flex-column gap-3 mb-3"},fk={class:"d-flex gap-2"},Nk={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Ek={class:"text-nowrap my-2 d-flex align-items-center"},bk={__name:"ProjectReportReview",props:{id:{type:[Number,String]},stage:{type:Number},type:{type:String}},setup(h){const u=h,b=j(),i=[{value:1,text:"通過"},{value:2,text:"退回修改"}],m=e.ref({}),f=e.ref({ID:u.id,Result:1}),a=()=>{const l={};if(f.value.Result>1&&(l.Reason="原因"),m.value=I(f.value,l),Object.keys(m.value).length){o();return}f.value.Stage=u.stage,F[u.type]("reviewReport",f.value).subscribe(c=>{c&&(window.location.href="../ReviewChecklist.aspx?type=6")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>f.value.Result,l=>{l>1&&o()}),(l,c)=>{const g=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(b)[h.type].organizer&&e.unref(b)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",pk,[c[3]||(c[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Vk,[e.createElementVNode("li",fk,[c[2]||(c[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Nk,[e.createElementVNode("div",Ek,[e.createVNode(g,{options:i,modelValue:e.unref(f).Result,"onUpdate:modelValue":c[0]||(c[0]=x=>e.unref(f).Result=x)},null,8,["modelValue"])]),e.unref(f).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(m).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(f).Reason,"onUpdate:modelValue":c[1]||(c[1]=x=>e.unref(f).Reason=x)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:a,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},gk={key:0,class:"scroll-bottom-panel"},yk={class:"d-flex flex-column gap-3 mb-3"},kk={class:"d-flex gap-2"},uk={class:"d-flex gap-2"},hk={class:"text-pink"},xk={class:"d-flex gap-2"},$k={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Bk={class:"text-nowrap mb-2 d-flex align-items-center"},_k={key:0,class:"invalid mt-0"},Ck={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(h){const u=h,b=j(),i=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],m=["無","低風險","中風險","高風險"],f=e.ref({}),a=e.ref({ID:u.id,Result:1}),o=e.ref({}),l=e.ref(0),c=()=>{window.open(F.toUrl(`/OFS/ApplicationChecklist.aspx?Year=${o.value.Year}&OrgName=${encodeURIComponent(o.value.OrgName)}`),"_blank")},g=()=>{window.open(F.toUrl(`/OFS/AuditHistory.aspx?Name=${encodeURIComponent(o.value.OrgName)}`),"_blank")},E=()=>{const _={};if(a.value.Result>1&&(_.Reason="原因"),a.value.Result===3&&(_.CorrectionDeadline="補正期限"),f.value=I(a.value,_),Object.keys(f.value).length){x();return}F[u.type]("reviewApplication",a.value).subscribe(y=>{y&&(window.location.href="../ReviewChecklist.aspx?type=1")})},x=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.onMounted(()=>{F[u.type]("getReviewInfo",{ID:u.id}).subscribe(_=>{o.value=_,o.value.AuditRecords.forEach(y=>{switch(y.Risk){case"Low":l.value<1&&(l.value=1);break;case"Medium":l.value<2&&(l.value=2);break;case"High":l.value<3&&(l.value=3);break}})})}),e.watch(()=>a.value.Result,_=>{_>1&&x()}),(_,y)=>{const s=e.resolveComponent("input-radio-group"),n=e.resolveComponent("input-tw-date"),C=e.resolveComponent("input-textarea");return e.unref(b)[h.type].organizer&&e.unref(b)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",gk,[y[8]||(y[8]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",yk,[e.createElementVNode("li",kk,[y[3]||(y[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:c,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).OtherCount),1)]),e.createElementVNode("li",uk,[y[6]||(y[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),e.createElementVNode("span",hk,e.toDisplayString(m[e.unref(l)]),1),e.createElementVNode("span",null,[y[4]||(y[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:g,href:"javascript:void(0)"},e.toDisplayString(e.unref(o).AuditRecords.length),1),y[5]||(y[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",xk,[y[7]||(y[7]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",$k,[e.createElementVNode("div",Bk,[e.createVNode(s,{options:i,modelValue:e.unref(a).Result,"onUpdate:modelValue":y[0]||(y[0]=p=>e.unref(a).Result=p)},null,8,["modelValue"]),e.createVNode(n,{class:"form-control",drops:"up",modelValue:e.unref(a).CorrectionDeadline,"onUpdate:modelValue":y[1]||(y[1]=p=>e.unref(a).CorrectionDeadline=p)},null,8,["modelValue"])]),e.unref(f).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",_k,e.toDisplayString(e.unref(f).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(a).Result>1?(e.openBlock(),e.createBlock(C,{key:1,error:e.unref(f).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(a).Reason,"onUpdate:modelValue":y[2]||(y[2]=p=>e.unref(a).Reason=p)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:E,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Tk={class:"top-wrapper"},wk={class:"top-block"},Dk={class:"d-flex align-items-center gap-3"},Sk={key:0,class:"tag tag-light-gray"},Ak={key:1,class:"tag tag-light-pink"},Fk={key:2,class:"tag tag-pale-green"},Uk=["href"],Pk={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(h){const u=h,b=j(),i=e.ref();return e.onMounted(()=>{F.system("getProjectTodoTask",{ID:u.id}).subscribe(m=>i.value=m==null?void 0:m.TaskName)}),(m,f)=>(e.openBlock(),e.createElementBlock("div",Tk,[e.createElementVNode("div",wk,[e.createElementVNode("div",Dk,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(b)[u.type].type)+"］"+e.toDisplayString(e.unref(b)[u.type].id)+"/"+e.toDisplayString(e.unref(b)[u.type].name),1),e.unref(b)[h.type].status===91?(e.openBlock(),e.createElementBlock("span",Sk,"計畫已結案")):e.unref(b)[h.type].status===99?(e.openBlock(),e.createElementBlock("span",Ak,"計畫已終止")):e.unref(i)?(e.openBlock(),e.createElementBlock("span",Fk,"待辦事項："+e.toDisplayString(e.unref(i)),1)):e.createCommentVNode("",!0)]),e.createElementVNode("a",{class:"btn btn-teal-dark",href:`../AuditRecords.aspx?ProjectID=${h.id}`,target:"_blank"}," 查核紀錄 ",8,Uk)])]))}},Mk={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},Ik={class:"d-flex gap-2"},jk={key:0,class:"btn text-teal-dark",type:"button"},Ok=["href"],Lk=["href"],Rk={class:"d-flex gap-2"},qk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},zk={class:"modal-content"},Gk={class:"modal-body"},Yk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Jk={class:"modal-content"},Qk={class:"modal-body"},Hk={class:"d-flex flex-column gap-4 mb-5"},Wk={class:"d-flex align-items-center"},Kk={class:"flex-grow-1"},Xk={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(h){const u=j(),b=h,i=e.ref({}),m=e.ref(),f=e.ref({}),a=e.ref(),o=e.ref({}),l=e.ref(),c=e.computed(()=>{let s="";switch(b.type){case"culture":s="CUL";break;case"education":s="EDC";break;case"multiple":s="MUL";break;case"literacy":s="LIT";break;case"accessibility":s="ACC";break}return`../../Service/OFS/DownloadPdf.ashx?Type=${s}&ProjectID=${b.id}&Version=2`}),g=e.computed(()=>F.toUrl(`/OFS/PlanChangeRecords.aspx?ProjectID=${b.id}`)),E=()=>{const s={Reason:"計畫變更原因"};f.value=I(i.value,s),!Object.keys(f.value).length&&F[b.type]("applyChange",i.value).subscribe(n=>{n&&location.reload()})},x=()=>{i.value={ID:b.id},bootstrap.Modal.getOrCreateInstance(m.value).show()},_=()=>{o.value={ID:b.id},bootstrap.Modal.getOrCreateInstance(l.value).show()},y=()=>{const s={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};f.value=I(o.value,s),!Object.keys(f.value).length&&F[b.type]("terminate",o.value).subscribe(n=>{n&&(location.href="../ApplicationChecklist.aspx")})};return(s,n)=>{const C=e.resolveComponent("project-organizer"),p=e.resolveComponent("input-textarea"),r=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Mk,[e.createElementVNode("div",Ik,[e.unref(u)[h.type].changeStatus?(e.openBlock(),e.createElementBlock("button",jk," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:x,type:"button"}," 計畫變更申請 ")),e.createElementVNode("a",{class:"btn btn-teal-dark",href:e.unref(g),target:"_blank"},[...n[3]||(n[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])],8,Ok),e.createElementVNode("a",{class:"btn btn-teal-dark",download:"",href:e.unref(c)},[...n[4]||(n[4]=[e.createElementVNode("i",{class:"fa-solid fa-download"},null,-1),e.createTextVNode(" 下載核定計畫書 ",-1)])],8,Lk)]),e.createElementVNode("div",Rk,[e.createVNode(C,{id:h.id,type:h.type},null,8,["id","type"]),e.unref(u)[h.type].isOrganizer?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-pink",onClick:_,type:"button"}," 計畫終止 ")):e.createCommentVNode("",!0)])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:m,tabindex:"-1"},[e.createElementVNode("div",qk,[e.createElementVNode("div",zk,[n[8]||(n[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Gk,[n[6]||(n[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),n[7]||(n[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(p,{error:e.unref(f).Reason,modelValue:e.unref(i).Reason,"onUpdate:modelValue":n[0]||(n[0]=N=>e.unref(i).Reason=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[n[5]||(n[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:E},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:a,tabindex:"-1"},[...n[9]||(n[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:l,tabindex:"-1"},[e.createElementVNode("div",Yk,[e.createElementVNode("div",Jk,[n[14]||(n[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Qk,[e.createElementVNode("div",Hk,[e.createElementVNode("div",null,[n[10]||(n[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(p,{error:e.unref(f).RejectReason,modelValue:e.unref(o).RejectReason,"onUpdate:modelValue":n[1]||(n[1]=N=>e.unref(o).RejectReason=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),n[12]||(n[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",Wk,[n[11]||(n[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",Kk,[e.createVNode(r,{error:e.unref(f).RecoveryAmount,modelValue:e.unref(o).RecoveryAmount,"onUpdate:modelValue":n[2]||(n[2]=N=>e.unref(o).RecoveryAmount=N),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[n[13]||(n[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:y},"送出")])])])])],512)]))],64)}}},Zk={class:"search bg-gray mt-4"},vk={class:"search-form"},eu={class:"row g-3"},tu={class:"col-12 col-lg-4"},lu=["value"],ou={class:"col-12 col-lg-4"},nu=["value"],ru={class:"col-12 col-lg-4"},au=["value"],su={class:"row g-3"},du={class:"col-12 col-lg-6"},cu={class:"col-12 col-lg-6"},iu={class:"total-list multiple-option"},mu={class:"all-total"},pu={class:"total-item-content"},Vu={class:"count"},fu=["for"],Nu={class:"total-item-title"},Eu={class:"total-item-content"},bu={class:"count"},gu=["id","onUpdate:modelValue"],yu={class:"block rounded-bottom-4"},ku={class:"title border-teal"},uu={class:"d-flex align-items-center gap-2"},hu={class:"text-teal"},xu={class:"table-responsive",style:{"min-height":"400px"}},$u={class:"table teal-table"},Bu={class:"total-row"},_u={class:"text-end"},Cu={class:"text-end"},Tu={class:"text-end"},wu={"data-th":"年度:"},Du={"data-th":"類別:"},Su={"data-th":"計畫名稱:",style:{"text-align":"left"}},Au=["href"],Fu={"data-th":"申請單位:",style:{"text-align":"left"}},Uu={"data-th":"申請本會補助:",class:"text-end"},Pu={"data-th":"配合款:",class:"text-end"},Mu={"data-th":"總經費:",class:"text-end"},Iu={"data-th":"狀態:",style:{"text-align":"center",width:"100px"}},ju={class:"text-teal"},Ou={__name:"ApplyList",setup(h){const u=e.ref([{id:1,title:"申請中",checked:!0},{id:2,title:"審查中",checked:!0},{id:3,title:"已核定",checked:!0},{id:4,title:"未通過",checked:!0}]),b=e.ref([]),i=e.ref({}),m=e.ref([]),f=e.ref(1),a=e.ref(10),o=e.ref([]),l=e.ref([]),c=e.computed(()=>E.value.filter(y=>u.value.find(s=>s.checked&&y.type===s.id))),g=e.computed(()=>c.value.slice((f.value-1)*a.value,f.value*a.value)),E=e.computed(()=>{let y=m.value;return i.value.year&&(y=y.filter(s=>s.Year===i.value.year)),i.value.category&&(y=y.filter(s=>s.Category===i.value.category)),i.value.unit&&(y=y.filter(s=>s.SupervisoryUnit===i.value.unit)),i.value.org&&(y=y.filter(s=>{var n;return(n=s.OrgName)==null?void 0:n.includes(i.value.org)})),i.value.name&&(y=y.filter(s=>{var n;return s.ProjectID.includes(i.value.name)||((n=s.ProjectName)==null?void 0:n.includes(i.value.name))})),y}),x=(y,s)=>{f.value=parseInt(y),a.value=parseInt(s)},_=y=>{if(y.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("CLB"))return`../CLB/ClbApplication.aspx?ProjectID=${y.ProjectID}`;if(y.ProjectID.includes("SCI"))return`../SCI/SciApplication.aspx?ProjectID=${y.ProjectID}`};return e.onMounted(()=>{F.system("getApplyList").subscribe(y=>{m.value=y.List,m.value.forEach(n=>{[1,14].includes(n.Status)?n.type=1:[11,12,21,22,31,32,41,42,43,44].includes(n.Status)?n.type=2:[45,51,52,91].includes(n.Status)?n.type=3:n.type=4,l.value.includes(n.Year)||l.value.push(n.Year),b.value.includes(n.Category)||b.value.push(n.Category),o.value.includes(n.SupervisoryUnit)||o.value.push(n.SupervisoryUnit)}),l.value.sort((n,C)=>C-n);const s=new Date().getFullYear()-1911;i.value.year=l.value.includes(s)?s:l.value[0]})}),(y,s)=>{const n=e.resolveComponent("input-text"),C=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zk,[s[14]||(s[14]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",vk,[e.createElementVNode("div",eu,[e.createElementVNode("div",tu,[s[6]||(s[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[0]||(s[0]=p=>e.unref(i).year=p)},[s[5]||(s[5]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p)+"年",9,lu))),128))],512),[[e.vModelSelect,e.unref(i).year]])]),e.createElementVNode("div",ou,[s[8]||(s[8]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=p=>e.unref(i).category=p)},[s[7]||(s[7]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,nu))),128))],512),[[e.vModelSelect,e.unref(i).category]])]),e.createElementVNode("div",ru,[s[10]||(s[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=p=>e.unref(i).unit=p)},[s[9]||(s[9]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,au))),128))],512),[[e.vModelSelect,e.unref(i).unit]])])]),e.createElementVNode("div",su,[e.createElementVNode("div",du,[s[11]||(s[11]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(n,{modelValue:e.unref(i).org,"onUpdate:modelValue":s[3]||(s[3]=p=>e.unref(i).org=p),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",cu,[s[12]||(s[12]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(n,{modelValue:e.unref(i).name,"onUpdate:modelValue":s[4]||(s[4]=p=>e.unref(i).name=p),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),s[13]||(s[13]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("ul",iu,[e.createElementVNode("li",mu,[s[16]||(s[16]=e.createElementVNode("div",{class:"total-item-title"},"總申請",-1)),e.createElementVNode("div",pu,[e.createElementVNode("span",Vu,e.toDisplayString(e.unref(E).length),1),s[15]||(s[15]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),p=>(e.openBlock(),e.createElementBlock("li",{class:"total-item",key:p},[e.createElementVNode("label",{class:"checke-total",for:`apply-${p.id}`},[e.createElementVNode("div",null,[e.createElementVNode("div",Nu,e.toDisplayString(p.title),1),e.createElementVNode("div",Eu,[e.createElementVNode("span",bu,e.toDisplayString(e.unref(E).filter(r=>r.type===p.id).length),1),s[17]||(s[17]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),s[18]||(s[18]=e.createElementVNode("img",{class:"check-icon",src:"../../assets/img/check-white.svg"},null,-1))],8,fu),e.withDirectives(e.createElementVNode("input",{class:"total-checkbox",id:`apply-${p.id}`,type:"checkbox","onUpdate:modelValue":r=>p.checked=r},null,8,gu),[[e.vModelCheckbox,p.checked]])]))),128))]),e.createElementVNode("div",yu,[e.createElementVNode("div",ku,[e.createElementVNode("div",uu,[s[21]||(s[21]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[s[19]||(s[19]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",hu,e.toDisplayString(e.unref(c).length),1),s[20]||(s[20]=e.createTextVNode(" 筆資料",-1))])]),s[22]||(s[22]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",xu,[e.createElementVNode("table",$u,[e.createElementVNode("thead",null,[s[25]||(s[25]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"申請本會補助")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"總經費")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"狀態")])])],-1)),e.createElementVNode("tr",Bu,[s[23]||(s[23]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",_u,e.toDisplayString(e.unref(c).reduce((p,r)=>p+r.ApplyAmount,0).toLocaleString()),1),e.createElementVNode("td",Cu,e.toDisplayString(e.unref(c).reduce((p,r)=>p+r.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Tu,e.toDisplayString(e.unref(c).reduce((p,r)=>p+r.ApplyAmount+r.OtherAmount,0).toLocaleString()),1),s[24]||(s[24]=e.createElementVNode("td",null,null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),p=>(e.openBlock(),e.createElementBlock("tr",{key:p},[e.createElementVNode("td",wu,e.toDisplayString(p.Year),1),e.createElementVNode("td",Du,e.toDisplayString(p.Category),1),e.createElementVNode("td",Su,[e.createElementVNode("a",{class:"link-black",href:_(p),target:"_blank"},e.toDisplayString(p.ProjectName||"[未設定]"),9,Au)]),e.createElementVNode("td",Fu,e.toDisplayString(p.OrgName),1),e.createElementVNode("td",Uu,e.toDisplayString(p.ApplyAmount.toLocaleString()),1),e.createElementVNode("td",Pu,e.toDisplayString(p.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Mu,e.toDisplayString((p.ApplyAmount+p.OtherAmount).toLocaleString()),1),e.createElementVNode("td",Iu,[e.createElementVNode("span",ju,e.toDisplayString(e.unref(u).find(r=>r.id===p.type).title),1)])]))),128))])])]),e.createVNode(C,{count:e.unref(c).length,onChange:x,page:e.unref(f),"page-size":e.unref(a)},null,8,["count","page","page-size"])])],64)}}},Lu={class:"search bg-gray mt-4"},Ru={class:"search-form"},qu={class:"row g-3"},zu={class:"col-12 col-lg-4"},Gu=["value"],Yu={class:"col-12 col-lg-4"},Ju=["value"],Qu={class:"col-12 col-lg-4"},Hu=["value"],Wu={class:"row g-3"},Ku={class:"col-12 col-lg-6"},Xu={class:"col-12 col-lg-6"},Zu={class:"block rounded-bottom-4"},vu={class:"title border-teal"},eh={class:"d-flex align-items-center gap-2"},th={class:"text-teal"},lh={class:"table-responsive",style:{"min-height":"400px"}},oh={class:"table teal-table"},nh={class:"total-row"},rh={class:"text-end"},ah={class:"text-end"},sh={"data-th":"年度:"},dh={"data-th":"類別:"},ch={"data-th":"計畫名稱:",style:{"text-align":"left"}},ih=["href"],mh={"data-th":"申請單位:",style:{"text-align":"left"}},ph={"data-th":"本會補助金額:",class:"text-end"},Vh={"data-th":"配合款:",class:"text-end"},fh={__name:"ApprovedList",props:{category:{type:String}},setup(h){const u=h,b={ACC:"無障礙",CLB:"學校社團",CUL:"文化",EDC:"學校／民間",LIT:"素養",MUL:"多元",SCI:"科專"},i=e.ref([]),m=e.ref({}),f=e.ref([]),a=e.ref(1),o=e.ref(10),l=e.ref([]),c=e.ref([]),g=e.computed(()=>E.value.slice((a.value-1)*o.value,a.value*o.value)),E=e.computed(()=>{let y=f.value;return m.value.year&&(y=y.filter(s=>s.Year===m.value.year)),m.value.category&&(y=y.filter(s=>s.Category===m.value.category)),m.value.unit&&(y=y.filter(s=>s.SupervisoryUnit===m.value.unit)),m.value.org&&(y=y.filter(s=>{var n;return(n=s.OrgName)==null?void 0:n.includes(m.value.org)})),m.value.name&&(y=y.filter(s=>{var n;return s.ProjectID.includes(m.value.name)||((n=s.ProjectName)==null?void 0:n.includes(m.value.name))})),y}),x=(y,s)=>{a.value=parseInt(y),o.value=parseInt(s)},_=y=>{if(y.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${y.ProjectID}`;if(y.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${y.ProjectID}`;if(y.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${y.ProjectID}`};return e.onMounted(()=>{F.system("getApprovedList").subscribe(y=>{f.value=y.List,f.value.forEach(n=>{c.value.includes(n.Year)||c.value.push(n.Year),i.value.includes(n.Category)||i.value.push(n.Category),l.value.includes(n.SupervisoryUnit)||l.value.push(n.SupervisoryUnit)}),c.value.sort((n,C)=>C-n);const s=new Date().getFullYear()-1911;if(m.value.year=c.value.includes(s)?s:c.value[0],u.category){const n=b[u.category];i.value.includes(n)&&(m.value.category=n)}})}),(y,s)=>{const n=e.resolveComponent("input-text"),C=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Lu,[s[14]||(s[14]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Ru,[e.createElementVNode("div",qu,[e.createElementVNode("div",zu,[s[6]||(s[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[0]||(s[0]=p=>e.unref(m).year=p)},[s[5]||(s[5]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p)+"年",9,Gu))),128))],512),[[e.vModelSelect,e.unref(m).year]])]),e.createElementVNode("div",Yu,[s[8]||(s[8]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=p=>e.unref(m).category=p)},[s[7]||(s[7]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,Ju))),128))],512),[[e.vModelSelect,e.unref(m).category]])]),e.createElementVNode("div",Qu,[s[10]||(s[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=p=>e.unref(m).unit=p)},[s[9]||(s[9]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,Hu))),128))],512),[[e.vModelSelect,e.unref(m).unit]])])]),e.createElementVNode("div",Wu,[e.createElementVNode("div",Ku,[s[11]||(s[11]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(n,{modelValue:e.unref(m).org,"onUpdate:modelValue":s[3]||(s[3]=p=>e.unref(m).org=p),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Xu,[s[12]||(s[12]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(n,{modelValue:e.unref(m).name,"onUpdate:modelValue":s[4]||(s[4]=p=>e.unref(m).name=p),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),s[13]||(s[13]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Zu,[e.createElementVNode("div",vu,[e.createElementVNode("div",eh,[s[17]||(s[17]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[s[15]||(s[15]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",th,e.toDisplayString(e.unref(E).length),1),s[16]||(s[16]=e.createTextVNode(" 筆資料",-1))])]),s[18]||(s[18]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",lh,[e.createElementVNode("table",oh,[e.createElementVNode("thead",null,[s[20]||(s[20]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])])],-1)),e.createElementVNode("tr",nh,[s[19]||(s[19]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",rh,e.toDisplayString(e.unref(E).reduce((p,r)=>p+r.ApprovedAmount,0).toLocaleString()),1),e.createElementVNode("td",ah,e.toDisplayString(e.unref(E).reduce((p,r)=>p+r.OtherAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),p=>(e.openBlock(),e.createElementBlock("tr",{key:p},[e.createElementVNode("td",sh,e.toDisplayString(p.Year),1),e.createElementVNode("td",dh,e.toDisplayString(p.Category),1),e.createElementVNode("td",ch,[e.createElementVNode("a",{class:"link-black",href:_(p),target:"_blank"},e.toDisplayString(p.ProjectName),9,ih)]),e.createElementVNode("td",mh,e.toDisplayString(p.OrgName),1),e.createElementVNode("td",ph,e.toDisplayString(p.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Vh,e.toDisplayString(p.OtherAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(C,{count:e.unref(E).length,onChange:x,page:e.unref(a),"page-size":e.unref(o)},null,8,["count","page","page-size"])])],64)}}},Nh={class:"search bg-gray mt-4"},Eh={class:"search-form"},bh={class:"row g-3"},gh={class:"col-12 col-lg-4"},yh=["value"],kh={class:"col-12 col-lg-4"},uh=["value"],hh={class:"col-12 col-lg-4"},xh=["value"],$h={class:"row g-3"},Bh={class:"col-12 col-lg-6"},_h={class:"col-12 col-lg-6"},Ch={class:"block rounded-bottom-4"},Th={class:"title border-teal"},wh={class:"d-flex align-items-center gap-2"},Dh={class:"text-teal"},Sh={class:"table-responsive",style:{"min-height":"400px"}},Ah={class:"table teal-table"},Fh={class:"total-row"},Uh={class:"text-end"},Ph={class:"text-end"},Mh={class:"text-end"},Ih={class:"text-end"},jh={class:"text-end"},Oh={"data-th":"年度:"},Lh={"data-th":"類別:"},Rh={"data-th":"計畫名稱:",style:{"text-align":"left"}},qh=["href"],zh={"data-th":"申請單位:",style:{"text-align":"left"}},Gh={"data-th":"本會補助金額:",class:"text-end"},Yh={"data-th":"配合款:",class:"text-end"},Jh={"data-th":"實支金額:",class:"text-end"},Qh={"data-th":"累積經費執行率:",class:"text-end"},Hh={"data-th":"本會已撥金額:",class:"text-end"},Wh={__name:"InprogressList",setup(h){const u=e.ref([]),b=e.ref({}),i=e.ref([]),m=e.ref(1),f=e.ref(10),a=e.ref([]),o=e.ref([]),l=e.computed(()=>E.value.reduce((s,n)=>s+n.ApprovedAmount,0)),c=e.computed(()=>E.value.slice((m.value-1)*f.value,m.value*f.value)),g=e.computed(()=>E.value.reduce((s,n)=>s+n.SpendAmount,0)),E=e.computed(()=>{let s=i.value;return b.value.year&&(s=s.filter(n=>n.Year===b.value.year)),b.value.category&&(s=s.filter(n=>n.Category===b.value.category)),b.value.unit&&(s=s.filter(n=>n.SupervisoryUnit===b.value.unit)),b.value.org&&(s=s.filter(n=>{var C;return(C=n.OrgName)==null?void 0:C.includes(b.value.org)})),b.value.name&&(s=s.filter(n=>{var C;return n.ProjectID.includes(b.value.name)||((C=n.ProjectName)==null?void 0:C.includes(b.value.name))})),s}),x=(s,n)=>{m.value=parseInt(s),f.value=parseInt(n)},_=s=>{if(s.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${s.ProjectID}`;if(s.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${s.ProjectID}`;if(s.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${s.ProjectID}`;if(s.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${s.ProjectID}`;if(s.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${s.ProjectID}`;if(s.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${s.ProjectID}`;if(s.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${s.ProjectID}`},y=(s,n)=>n?Math.round(s*100/n*100)/100:0;return e.onMounted(()=>{F.system("getInprogressList").subscribe(s=>{i.value=s.List,i.value.forEach(C=>{o.value.includes(C.Year)||o.value.push(C.Year),u.value.includes(C.Category)||u.value.push(C.Category),a.value.includes(C.SupervisoryUnit)||a.value.push(C.SupervisoryUnit)}),o.value.sort((C,p)=>p-C);const n=new Date().getFullYear()-1911;b.value.year=o.value.includes(n)?n:o.value[0]})}),(s,n)=>{const C=e.resolveComponent("input-text"),p=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Nh,[n[14]||(n[14]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Eh,[e.createElementVNode("div",bh,[e.createElementVNode("div",gh,[n[6]||(n[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":n[0]||(n[0]=r=>e.unref(b).year=r)},[n[5]||(n[5]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),r=>(e.openBlock(),e.createElementBlock("option",{key:r,value:r},e.toDisplayString(r)+"年",9,yh))),128))],512),[[e.vModelSelect,e.unref(b).year]])]),e.createElementVNode("div",kh,[n[8]||(n[8]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":n[1]||(n[1]=r=>e.unref(b).category=r)},[n[7]||(n[7]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),r=>(e.openBlock(),e.createElementBlock("option",{key:r,value:r},e.toDisplayString(r),9,uh))),128))],512),[[e.vModelSelect,e.unref(b).category]])]),e.createElementVNode("div",hh,[n[10]||(n[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":n[2]||(n[2]=r=>e.unref(b).unit=r)},[n[9]||(n[9]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),r=>(e.openBlock(),e.createElementBlock("option",{key:r,value:r},e.toDisplayString(r),9,xh))),128))],512),[[e.vModelSelect,e.unref(b).unit]])])]),e.createElementVNode("div",$h,[e.createElementVNode("div",Bh,[n[11]||(n[11]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(C,{modelValue:e.unref(b).org,"onUpdate:modelValue":n[3]||(n[3]=r=>e.unref(b).org=r),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",_h,[n[12]||(n[12]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(C,{modelValue:e.unref(b).name,"onUpdate:modelValue":n[4]||(n[4]=r=>e.unref(b).name=r),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),n[13]||(n[13]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Ch,[e.createElementVNode("div",Th,[e.createElementVNode("div",wh,[n[17]||(n[17]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[n[15]||(n[15]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Dh,e.toDisplayString(e.unref(E).length),1),n[16]||(n[16]=e.createTextVNode(" 筆資料",-1))])]),n[18]||(n[18]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Sh,[e.createElementVNode("table",Ah,[e.createElementVNode("thead",null,[n[20]||(n[20]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"實支金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"累積經費執行率")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會已撥金額")])])],-1)),e.createElementVNode("tr",Fh,[n[19]||(n[19]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Uh,e.toDisplayString(e.unref(l).toLocaleString()),1),e.createElementVNode("td",Ph,e.toDisplayString(e.unref(E).reduce((r,N)=>r+N.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Mh,e.toDisplayString(e.unref(g).toLocaleString()),1),e.createElementVNode("td",Ih,e.toDisplayString(y(e.unref(g),e.unref(l)).toLocaleString())+"%",1),e.createElementVNode("td",jh,e.toDisplayString(e.unref(E).reduce((r,N)=>r+N.PaymentAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),r=>(e.openBlock(),e.createElementBlock("tr",{key:r},[e.createElementVNode("td",Oh,e.toDisplayString(r.Year),1),e.createElementVNode("td",Lh,e.toDisplayString(r.Category),1),e.createElementVNode("td",Rh,[e.createElementVNode("a",{class:"link-black",href:_(r),target:"_blank"},e.toDisplayString(r.ProjectName),9,qh)]),e.createElementVNode("td",zh,e.toDisplayString(r.OrgName),1),e.createElementVNode("td",Gh,e.toDisplayString(r.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Yh,e.toDisplayString(r.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Jh,e.toDisplayString(r.SpendAmount.toLocaleString()),1),e.createElementVNode("td",Qh,e.toDisplayString(y(r.SpendAmount,r.ApprovedAmount).toLocaleString())+"%",1),e.createElementVNode("td",Hh,e.toDisplayString(r.PaymentAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(p,{count:e.unref(E).length,onChange:x,page:e.unref(m),"page-size":e.unref(f)},null,8,["count","page","page-size"])])],64)}}},Kh={__name:"MixChart",props:{list:{required:!0,type:Array}},setup(h){let u;const b=v().typeList,i=h,m=e.ref(),f=l=>{am5.ready(()=>{u&&u.dispose(),u=am5.Root.new(m.value),u.setThemes([am5themes_Animated.new(u)]);const c=u.container.children.push(am5xy.XYChart.new(u,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,layout:u.verticalLayout})),g=am5xy.AxisRendererX.new(u,{minGridDistance:30});g.labels.template.setAll({rotation:-45,centerY:am5.p50,centerX:am5.p100,textAlign:"right"});var E=c.xAxes.push(am5xy.CategoryAxis.new(u,{categoryField:"category",renderer:g,tooltip:am5.Tooltip.new(u,{})}));E.data.setAll(l);var x=c.yAxes.push(am5xy.ValueAxis.new(u,{renderer:am5xy.AxisRendererY.new(u,{})})),_=c.yAxes.push(am5xy.ValueAxis.new(u,{renderer:am5xy.AxisRendererY.new(u,{opposite:!0}),min:0,max:1,numberFormat:"#.0%",extraMax:.1,strictMinMax:!0}));const y=(r,N,d)=>{var t=c.series.push(am5xy.ColumnSeries.new(u,{name:N,xAxis:E,yAxis:x,valueYField:r,categoryXField:"category",clustered:!0,tooltip:am5.Tooltip.new(u,{labelText:"{name}: {valueY}"})}));return t.data.setAll(l),t.columns.template.setAll({fillOpacity:1,strokeOpacity:0,fill:am5.color(d),cornerRadiusTL:0,cornerRadiusTR:0,width:am5.percent(70)}),t};y("核定經費","核定經費",4946924),y("實支金額","實支金額",9323693),y("已撥付","已撥付",3447003);const s=(r,N,d)=>{var t=c.series.push(am5xy.LineSeries.new(u,{name:N,xAxis:E,yAxis:_,valueYField:r,categoryXField:"category",stroke:am5.color(d),fill:am5.color(d),tooltip:am5.Tooltip.new(u,{labelText:"{name}: {valueY.formatNumber('#.0%')}"})}));return t.strokes.template.setAll({strokeWidth:3}),t.bullets.push(()=>am5.Bullet.new(u,{sprite:am5.Circle.new(u,{radius:5,fill:t.get("stroke")})})),t.data.setAll(l),t};s("經費執行率(%)","經費執行率(%)",15105570),s("支用比(%)","支用比(%)",2600544),c.children.push(am5.Legend.new(u,{centerX:am5.p50,x:am5.p50,layout:u.horizontalLayout,useDefaultMarker:!0,maxWidth:300})).labels.template.setAll({fontSize:12,paddingLeft:4,paddingRight:4,marginTop:4,marginBottom:4,marginLeft:4,marginRight:4});var C=c.children.push(am5.Legend.new(u,{centerX:am5.p0,x:am5.p0,layout:u.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));C.data.setAll([c.series.getIndex(0),c.series.getIndex(1),c.series.getIndex(2)]);var p=c.children.push(am5.Legend.new(u,{centerX:am5.p100,x:am5.p100,layout:u.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));p.data.setAll([c.series.getIndex(3),c.series.getIndex(4)]),c.set("cursor",am5xy.XYCursor.new(u,{}))})},a=(l,c,g=2)=>{if(c){const E=10**g;return Math.round(l*100/c*E)/E}return 0},o=()=>{f(b.map(l=>{const c={category:l.title,核定經費:0,實支金額:0,已撥付:0,"經費執行率(%)":0,"支用比(%)":0},g=i.list.find(E=>E.Category===l.code);return g&&(c.核定經費=Math.floor(g.ApprovedAmount/1e3),c.實支金額=Math.floor(g.SpendAmount/1e3),c.已撥付=Math.floor(g.PaymentAmount/1e3),c["經費執行率(%)"]=a(c.實支金額,c.核定經費,1),c["支用比(%)"]=a(c.實支金額,c.已撥付,1)),c}))};return e.onMounted(o),e.watch(()=>i.list,o),(l,c)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:m},null,512))}},Xh={__name:"PieChart",props:{active:{required:!0,type:String},color:{required:!0,type:Number},inactive:{required:!0,type:String},percent:{required:!0,type:Number}},setup(h){let u,b,i;const m=h,f=e.ref();return e.onMounted(()=>{am5.ready(()=>{b=am5.Root.new(f.value),b.setThemes([am5themes_Animated.new(b)]);const a=b.container.children.push(am5percent.PieChart.new(b,{innerRadius:95,width:158,x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,layout:b.verticalLayout}));i=a.series.push(am5percent.PieSeries.new(b,{valueField:"size",categoryField:"sector"})),i.set("colors",am5.ColorSet.new(b,{colors:[am5.color(m.color),am5.color(16119285)]})),i.labels.template.set("visible",!1),i.ticks.template.set("visible",!1),i.data.setAll([{sector:m.active,size:m.percent},{sector:m.inactive,size:100-m.percent}]),i.appear(1e3,100),u=b.tooltipContainer.children.push(am5.Label.new(b,{x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,fill:am5.color(m.color),fontSize:28,fontWeight:"bold"})),u.set("text",`${m.percent}%`);const o=()=>{var l=window.innerWidth>=768&&window.innerWidth<=1024,c=l?105:158,g=l?55:95,E=l?20:28;a.set("width",c),a.set("innerRadius",g),u.set("fontSize",E)};o(),window.addEventListener("resize",o)})}),e.watch(()=>m.percent,a=>{u.set("text",`${a}%`),i.data.setAll([{sector:m.active,size:a},{sector:m.inactive,size:100-a}])}),(a,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:f},null,512))}},Zh={class:"search bg-gray mt-4"},vh={class:"search-form"},ex={class:"row g-3"},tx={class:"col-12 col-lg-4"},lx={class:"col-12 col-lg-4"},ox={class:"col-12 col-lg-4"},nx={class:"row g-3"},rx={class:"col-12"},ax={class:"block rounded-bottom-4"},sx={class:"title border-teal"},dx={class:"d-flex align-items-center gap-2"},cx={class:"text-teal"},ix={class:"table-responsive",style:{"min-height":"400px"}},mx={class:"table teal-table"},px={"data-th":"年度:"},Vx={"data-th":"計畫名稱:",class:"text-start"},fx=["href"],Nx={"data-th":"計畫申請單位:",class:"text-start"},Ex={"data-th":"委員姓名:"},bx={"data-th":"任職單位:",class:"text-start"},gx={"data-th":"職稱:"},yx={"data-th":"應迴避之具體理由及事證:",class:"text-start"},kx={__name:"RecusedList",setup(h){const u=e.ref({Year:0,Keyword:"",Name:"",Org:""}),b=e.ref([]),i=e.ref(1),m=e.ref(10),f=[],a=e.computed(()=>b.value.slice((i.value-1)*m.value,i.value*m.value)),o=(g,E)=>{i.value=parseInt(g),m.value=parseInt(E)},l=()=>{F.system("downloadRecusedList",u.value).subscribe(g=>{const E=document.createElement("a");E.download="迴避審查委員名單.xlsx",E.href=F.download(g.filename),E.click()})},c=()=>{F.system("getRecusedList",u.value).subscribe(g=>{b.value=g.List,i.value=1})};for(let g=new Date().getFullYear()-1911;g>=114;g--)f.push({text:`${g} 年`,value:g});return e.onMounted(c),(g,E)=>{const x=e.resolveComponent("input-select"),_=e.resolveComponent("input-text"),y=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zh,[E[9]||(E[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",vh,[e.createElementVNode("div",ex,[e.createElementVNode("div",tx,[E[4]||(E[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.createVNode(x,{"empty-value":0,options:f,modelValue:e.unref(u).Year,"onUpdate:modelValue":E[0]||(E[0]=s=>e.unref(u).Year=s)},null,8,["modelValue"])]),e.createElementVNode("div",lx,[E[5]||(E[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, 任職單位, 職稱",-1)),e.createVNode(_,{placeholder:"請輸入委員姓名, 任職單位, 職稱",modelValue:e.unref(u).Keyword,"onUpdate:modelValue":E[1]||(E[1]=s=>e.unref(u).Keyword=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",ox,[E[6]||(E[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫名稱",-1)),e.createVNode(_,{placeholder:"請輸入計畫名稱",modelValue:e.unref(u).Name,"onUpdate:modelValue":E[2]||(E[2]=s=>e.unref(u).Name=s),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("div",nx,[e.createElementVNode("div",rx,[E[7]||(E[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫申請單位",-1)),e.createVNode(_,{placeholder:"請輸入計畫申請單位",modelValue:e.unref(u).Org,"onUpdate:modelValue":E[3]||(E[3]=s=>e.unref(u).Org=s),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:c,type:"button"},[...E[8]||(E[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",ax,[e.createElementVNode("div",sx,[e.createElementVNode("div",dx,[E[12]||(E[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[E[10]||(E[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",cx,e.toDisplayString(e.unref(b).length),1),E[11]||(E[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...E[13]||(E[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",ix,[e.createElementVNode("table",mx,[E[14]||(E[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"任職單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"職稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"應迴避之具體理由及事證")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),s=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",px,e.toDisplayString(s.Year),1),e.createElementVNode("td",Vx,[e.createElementVNode("a",{class:"link-black",href:`../SCI/SciApplication.aspx?ProjectID=${s.ProjectID}`,target:"_blank"},e.toDisplayString(s.ProjectNameTw),9,fx)]),e.createElementVNode("td",Nx,e.toDisplayString(s.OrgName),1),e.createElementVNode("td",Ex,e.toDisplayString(s.RecusedName),1),e.createElementVNode("td",bx,e.toDisplayString(s.EmploymentUnit),1),e.createElementVNode("td",gx,e.toDisplayString(s.JobTitle),1),e.createElementVNode("td",yx,e.toDisplayString(s.RecusedReason),1)]))),128))])])]),e.createVNode(y,{count:e.unref(b).length,onChange:o,page:e.unref(i),"page-size":e.unref(m)},null,8,["count","page","page-size"])])],64)}}},ux={class:"block rounded-bottom-4"},hx={class:"title border-teal"},xx={class:"d-flex align-items-center gap-2"},$x={class:"text-teal"},Bx={class:"table-responsive",style:{"min-height":"400px"}},_x={class:"table teal-table"},Cx={"data-th":"委員姓名:",class:"text-start"},Tx={"data-th":"審查階段:",class:"text-start"},wx={"data-th":"類別:",class:"text-start"},Dx={"data-th":"計畫編號:"},Sx={"data-th":"計畫名稱:",class:"text-start"},Ax={__name:"ReviewerDetails",props:{id:{type:String},type:{type:String}},setup(h){const u=h,b=e.ref({ID:u.id,Type:u.type}),i=e.ref([]),m=e.ref(1),f=e.ref(10),a=e.computed(()=>i.value.slice((m.value-1)*f.value,m.value*f.value)),o=(c,g)=>{m.value=parseInt(c),f.value=parseInt(g)},l=()=>{F.system("downloadReviewerDetails",b.value).subscribe(c=>{const g=document.createElement("a");g.download="審查計畫.xlsx",g.href=F.download(c.filename),g.click()})};return e.onMounted(()=>{F.system("getReviewerDetails",b.value).subscribe(c=>{i.value=c.List,m.value=1})}),(c,g)=>{const E=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",ux,[e.createElementVNode("div",hx,[e.createElementVNode("div",xx,[g[2]||(g[2]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"審查計畫")],-1)),e.createElementVNode("span",null,[g[0]||(g[0]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",$x,e.toDisplayString(e.unref(i).length),1),g[1]||(g[1]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:l,type:"button"},[...g[3]||(g[3]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",Bx,[e.createElementVNode("table",_x,[g[4]||(g[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"計畫編號")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫名稱")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),x=>(e.openBlock(),e.createElementBlock("tr",{key:x},[e.createElementVNode("td",Cx,e.toDisplayString(x.CommitteeUser),1),e.createElementVNode("td",Tx,e.toDisplayString(h.type==1?"申請計畫":"執行計畫")+"／"+e.toDisplayString(x.ReviewStage),1),e.createElementVNode("td",wx,e.toDisplayString(x.FieldName),1),e.createElementVNode("td",Dx,e.toDisplayString(x.ProjectID),1),e.createElementVNode("td",Sx,e.toDisplayString(x.ProjectName),1)]))),128))])])]),e.createVNode(E,{count:e.unref(i).length,onChange:o,page:e.unref(m),"page-size":e.unref(f)},null,8,["count","page","page-size"])])}}},Fx={class:"search bg-gray mt-4"},Ux={class:"search-form"},Px={class:"row g-3"},Mx={class:"col-3"},Ix={class:"col-3"},jx={class:"col-3"},Ox={class:"col-3"},Lx={class:"block rounded-bottom-4"},Rx={class:"title border-teal"},qx={class:"d-flex align-items-center gap-2"},zx={class:"text-teal"},Gx={class:"table-responsive",style:{"min-height":"400px"}},Yx={class:"table teal-table"},Jx={"data-th":"委員姓名:"},Qx={"data-th":"Email:",class:"text-start"},Hx={"data-th":"審查階段:"},Wx={"data-th":"審查計畫件數:"},Kx=["href"],Xx={"data-th":"銀行帳戶:",class:"text-start"},Zx=["onClick"],vx={key:1},e$={"data-th":"戶籍地址:",class:"text-start"},t$={"data-th":"更新時間:",class:"text-start"},l$={class:"modal-dialog modal-dialog-centered modal-xl"},o$={class:"modal-content"},n$={class:"modal-body"},r$={class:"mb-5"},a$=["src"],s$={__name:"ReviewerList",setup(h){const u=e.ref({Type:0,Keyword:"",Begin:"",End:""}),b=e.ref([]),i=e.ref(),m=e.ref(1),f=e.ref(10),a=e.ref({}),o=[{text:"申請計畫審查",value:1},{text:"執行計畫審查",value:2}],l=e.computed(()=>b.value.slice((m.value-1)*f.value,m.value*f.value)),c=(_,y)=>{m.value=parseInt(_),f.value=parseInt(y)},g=()=>{F.system("downloadReviewerList",u.value).subscribe(_=>{const y=document.createElement("a");y.download="審查委員名單.xlsx",y.href=F.download(_.filename),y.click()})},E=_=>{var y;a.value=_.Type===1?F.download(_.BankPhoto):F.sciDownload("downloadbankbook",{token:(y=_.BankPhoto)==null?void 0:y.trim()}),bootstrap.Modal.getOrCreateInstance(i.value).show()},x=()=>{F.system("getReviewerList",u.value).subscribe(_=>{b.value=_.List,m.value=1})};return e.onMounted(x),(_,y)=>{const s=e.resolveComponent("input-select"),n=e.resolveComponent("input-text"),C=e.resolveComponent("input-tw-date"),p=e.resolveComponent("tw-date-time"),r=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Fx,[y[9]||(y[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Ux,[e.createElementVNode("div",Px,[e.createElementVNode("div",Mx,[y[4]||(y[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"審查階段",-1)),e.createVNode(s,{"empty-value":0,options:o,modelValue:e.unref(u).Type,"onUpdate:modelValue":y[0]||(y[0]=N=>e.unref(u).Type=N)},null,8,["modelValue"])]),e.createElementVNode("div",Ix,[y[5]||(y[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, Email",-1)),e.createVNode(n,{placeholder:"請輸入委員姓名, Email",modelValue:e.unref(u).Keyword,"onUpdate:modelValue":y[1]||(y[1]=N=>e.unref(u).Keyword=N),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",jx,[y[6]||(y[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"開始時間",-1)),e.createVNode(C,{modelValue:e.unref(u).Begin,"onUpdate:modelValue":y[2]||(y[2]=N=>e.unref(u).Begin=N)},null,8,["modelValue"])]),e.createElementVNode("div",Ox,[y[7]||(y[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"結束時間",-1)),e.createVNode(C,{modelValue:e.unref(u).End,"onUpdate:modelValue":y[3]||(y[3]=N=>e.unref(u).End=N)},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:x,type:"button"},[...y[8]||(y[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",Lx,[e.createElementVNode("div",Rx,[e.createElementVNode("div",qx,[y[12]||(y[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[y[10]||(y[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",zx,e.toDisplayString(e.unref(b).length),1),y[11]||(y[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:g,type:"button"},[...y[13]||(y[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",Gx,[e.createElementVNode("table",Yx,[y[14]||(y[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"Email")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查計畫件數")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"銀行帳戶")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"戶籍地址")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"更新時間")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),N=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",Jx,e.toDisplayString(N.CommitteeUser),1),e.createElementVNode("td",Qx,e.toDisplayString(N.Email),1),e.createElementVNode("td",Hx,e.toDisplayString(N.Type===1?"申請計畫":"執行計畫"),1),e.createElementVNode("td",Wx,[e.createElementVNode("a",{class:"link-black",href:`ReviewerList${N.Type}.aspx?ID=${N.ID}`,target:"_blank"},e.toDisplayString(N.Count),9,Kx)]),e.createElementVNode("td",Xx,[N.BankPhoto?(e.openBlock(),e.createElementBlock("a",{key:0,onClick:e.withModifiers(d=>E(N),["prevent"]),href:"#"},e.toDisplayString(N.BankCode)+" "+e.toDisplayString(N.BankName)+" "+e.toDisplayString(N.BankAccount),9,Zx)):(e.openBlock(),e.createElementBlock("span",vx,e.toDisplayString(N.BankCode)+" "+e.toDisplayString(N.BankName)+" "+e.toDisplayString(N.BankAccount),1))]),e.createElementVNode("td",e$,e.toDisplayString(N.RegistrationAddress),1),e.createElementVNode("td",t$,[e.createVNode(p,{value:N.UpdateTime},null,8,["value"])])]))),128))])])]),e.createVNode(r,{count:e.unref(b).length,onChange:c,page:e.unref(m),"page-size":e.unref(f)},null,8,["count","page","page-size"])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade",ref_key:"modal",ref:i,tabindex:"-1"},[e.createElementVNode("div",l$,[e.createElementVNode("div",o$,[y[16]||(y[16]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",n$,[e.createElementVNode("div",r$,[e.createElementVNode("img",{class:"img-fluid",src:e.unref(a)},null,8,a$)]),y[15]||(y[15]=e.createElementVNode("div",{class:"d-flex justify-content-center"},[e.createElementVNode("button",{class:"btn btn-primary","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))],64)}}},d$={key:0,class:"text-pink"},c$={__name:"RequiredLabel",setup(h){const u=e.inject("editable",!0);return(b,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(u)?(e.openBlock(),e.createElementBlock("span",d$,"* ")):e.createCommentVNode("",!0),e.renderSlot(b.$slots,"default")],64))}},i$={class:"block"},m$={class:"mt-4"},p$={class:"table align-middle gray-table side-table"},V$={class:"d-flex gap-2"},f$=["src"],N$={key:0,class:"invalid mt-0"},E$={__name:"ReviewCommitteeInfo",props:{token:{type:String}},setup(h){const u=h,b=e.ref([]),i=e.ref({}),m=e.ref({}),f=c=>{m.value.BankPhoto=c.Path},a=F.download,o=()=>{if(i.value={},!l()){e.nextTick(()=>{var g;return(g=document.querySelector(".invalid"))==null?void 0:g.scrollIntoView({behavior:"smooth",block:"center"})});return}const c={Token:u.token,BankCode:m.value.BankCode,BankAccount:m.value.BankAccount,BankPhoto:m.value.BankPhoto,RegistrationAddress:m.value.RegistrationAddress};F.system("saveReviewCommittee",c).subscribe(g=>{g&&alert("儲存成功")})},l=()=>{let c={BankCode:"^請選擇銀行",BankAccount:"帳戶號碼",BankPhoto:"^請上傳存摺影本",RegistrationAddress:"戶籍地址"};return i.value=I(m.value,c),!Object.keys(i.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.system("getZgsCodes",{CodeGroup:"BankCode"}),F.system("getReviewCommittee",{Token:u.token})]).subscribe(c=>{b.value=c[0],m.value=c[1].Data})}),(c,g)=>{const E=e.resolveComponent("required-label"),x=e.resolveComponent("input-select"),_=e.resolveComponent("input-text"),y=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",i$,[g[7]||(g[7]=e.createElementVNode("h5",{class:"square-title"},"委員資料",-1)),e.createElementVNode("div",m$,[e.createElementVNode("table",p$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[g[3]||(g[3]=e.createElementVNode("th",null,"審查委員",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).CommitteeUser)+" ("+e.toDisplayString(e.unref(m).Email)+") ",1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...g[4]||(g[4]=[e.createTextVNode("銀行帳戶",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",V$,[e.createElementVNode("div",null,[e.createVNode(x,{"empty-value":null,error:e.unref(i).BankCode,options:e.unref(b),placeholder:"請選擇銀行","text-name":"Descname","value-name":"Code",modelValue:e.unref(m).BankCode,"onUpdate:modelValue":g[0]||(g[0]=s=>e.unref(m).BankCode=s)},null,8,["error","options","modelValue"])]),e.createElementVNode("div",null,[e.createVNode(_,{error:e.unref(i).BankAccount,placeholder:"帳戶號碼",modelValue:e.unref(m).BankAccount,"onUpdate:modelValue":g[1]||(g[1]=s=>e.unref(m).BankAccount=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...g[5]||(g[5]=[e.createTextVNode("存摺影本",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(y,{accept:".jpg,.png",onFile:f}),e.unref(m).BankPhoto?(e.openBlock(),e.createElementBlock("img",{key:0,class:"img-fluid mt-2",src:e.unref(a)(e.unref(m).BankPhoto)},null,8,f$)):e.createCommentVNode("",!0)]),e.unref(i).BankPhoto?(e.openBlock(),e.createElementBlock("div",N$,e.toDisplayString(e.unref(i).BankPhoto),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(E,null,{default:e.withCtx(()=>[...g[6]||(g[6]=[e.createTextVNode("戶籍地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(_,{error:e.unref(i).RegistrationAddress,placeholder:"(郵遞區號)完整地址",modelValue:e.unref(m).RegistrationAddress,"onUpdate:modelValue":g[2]||(g[2]=s=>e.unref(m).RegistrationAddress=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:o,type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定送出",-1)])])])],64)}}},b$={class:"block"},g$={class:"table align-middle gray-table side-table mt-4"},y$=["value"],k$={key:0,class:"tag-group mt-2 gap-1"},u$={class:"tag tag-green-light"},h$=["download","href"],x$={key:1},$$={key:2,class:"invalid mt-0"},B$={class:"table align-middle gray-table side-table mt-4"},_$={class:"d-flex align-items-center flex-wrap"},C$={class:"d-flex align-items-center text-nowrap me-3"},T$={class:"d-flex align-items-center text-nowrap"},w$={key:0,class:"invalid mt-0"},D$={key:0,class:"table align-middle gray-table"},S$={width:"1%"},A$={class:"row"},F$={class:"col"},U$={class:"col"},P$={width:"1%"},M$={class:"d-flex gap-2"},I$=["onClick"],j$={key:0},O$={class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},L$={__name:"GrantForm1",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=v().typeList,m=e.ref(!1),f=e.ref({}),a=e.ref({}),o=e.ref(),l=e.computed(()=>x.value.filter(C=>!C.Deleted)),c=e.computed(()=>E.value.filter(C=>!C.Deleted)),g=e.ref({}),E=e.ref([]),x=e.ref([]),_=F.download,y=u,s=C=>{var r,N,d;if(a.value={},f.value.Path=(r=o.value)==null?void 0:r.Path,f.value.Filename=(N=o.value)==null?void 0:N.Name,C){if(!n()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}f.value.Status=m.value?2:1}g.value.ShortName=(d=i.find(t=>t.code===g.value.TypeCode))==null?void 0:d.title;const p={GrantType:g.value,Content:f.value,Procedures:x.value,Links:E.value,Submit:C?"true":"false"};F.system("saveGrantTypeContent",p).subscribe(t=>{t&&y("next",C,t.ID)})},n=()=>{let C={ServiceContent:"內容",ContactPerson:"聯絡電話及分機",ContactTel:"聯絡人",Filename:"相關檔案"};return m.value&&(C.StatusReason="下架原因"),a.value=I(f.value,C),b.id||(C={TypeCode:"補助類別",Year:"年度",FullName:"補助類別全稱"},Object.assign(a.value,I(g.value,C))),l.value.length&&(C={Content:"內容"},l.value.forEach((p,r)=>Object.assign(a.value,I(p,C,`procedure-${r}-`)))),c.value.length&&(C={Title:"參考資料名稱",URL:"網址"},c.value.forEach((p,r)=>Object.assign(a.value,I(p,C,`link-${r}-`)))),!Object.keys(a.value).length};return e.onMounted(()=>{b.id?F.system("getGrantTypeContent",{ID:b.id}).subscribe(C=>{g.value=C.GrantType,f.value=C.Content,x.value=C.Procedures,E.value=C.Links,f.value.Filename&&(o.value={Name:f.value.Filename,Path:f.value.Path}),x.value.length?x.value.forEach((p,r)=>{r&&(p.Deleted=!0)}):x.value.push({}),v().init(g.value.TypeCode)}):x.value.push({})}),(C,p)=>{const r=e.resolveComponent("required-label"),N=e.resolveComponent("input-select"),d=e.resolveComponent("input-integer"),t=e.resolveComponent("input-text"),V=e.resolveComponent("input-file"),k=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",b$,[p[37]||(p[37]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("table",g$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[17]||(p[17]=[e.createTextVNode("補助類別(代碼)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(N,{class:"w-auto",error:e.unref(a).TypeCode,options:e.unref(i),modelValue:e.unref(g).TypeCode,"onUpdate:modelValue":p[0]||(p[0]=S=>e.unref(g).TypeCode=S)},{default:e.withCtx(({option:S})=>[e.createElementVNode("option",{value:S.code},e.toDisplayString(S.title)+" ("+e.toDisplayString(S.code)+")",9,y$)]),_:1},8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[18]||(p[18]=[e.createTextVNode("年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(d,{class:"w-auto",error:e.unref(a).Year,modelValue:e.unref(g).Year,"onUpdate:modelValue":p[1]||(p[1]=S=>e.unref(g).Year=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[19]||(p[19]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(a).FullName,modelValue:e.unref(g).FullName,"onUpdate:modelValue":p[2]||(p[2]=S=>e.unref(g).FullName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[20]||(p[20]=[e.createTextVNode("相關檔案",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(顯示於首頁)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",k$,[e.createElementVNode("span",u$,[e.createElementVNode("a",{class:"tag-link my-1",download:e.unref(o).Name,href:e.unref(_)(e.unref(o).Path)},e.toDisplayString(e.unref(o).Name),9,h$),e.createElementVNode("button",{class:"tag-btn",onClick:p[3]||(p[3]=S=>o.value=null),type:"button"},[...p[21]||(p[21]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])])])])):(e.openBlock(),e.createElementBlock("div",x$,[e.createVNode(V,{onFile:p[4]||(p[4]=S=>o.value=S)})])),e.unref(a).Filename?(e.openBlock(),e.createElementBlock("div",$$,e.toDisplayString(e.unref(a).Filename),1)):e.createCommentVNode("",!0)])])])]),p[38]||(p[38]=e.createElementVNode("h5",{class:"square-title mt-4"},"我的E政府",-1)),e.createElementVNode("table",B$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[22]||(p[22]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{disabled:"",modelValue:e.unref(g).FullName,"onUpdate:modelValue":p[5]||(p[5]=S=>e.unref(g).FullName=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[23]||(p[23]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(a).ServiceContent,modelValue:e.unref(f).ServiceContent,"onUpdate:modelValue":p[6]||(p[6]=S=>e.unref(f).ServiceContent=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[p[24]||(p[24]=e.createElementVNode("th",null,"關鍵字",-1)),e.createElementVNode("td",null,[e.createVNode(t,{modelValue:e.unref(f).Keywords,"onUpdate:modelValue":p[7]||(p[7]=S=>e.unref(f).Keywords=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[p[25]||(p[25]=e.createElementVNode("th",null,"申辦資格",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(f).Criteria,"onUpdate:modelValue":p[8]||(p[8]=S=>e.unref(f).Criteria=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[26]||(p[26]=[e.createTextVNode("申辦流程",-1)])]),_:1})]),e.createElementVNode("td",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(S,w)=>(e.openBlock(),e.createBlock(k,{key:S,error:e.unref(a)[`procedure-${w}-Content`],modelValue:S.Content,"onUpdate:modelValue":D=>S.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"]))),128))])]),e.createElementVNode("tr",null,[p[27]||(p[27]=e.createElementVNode("th",null,"應備物品",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(f).Documentary,"onUpdate:modelValue":p[9]||(p[9]=S=>e.unref(f).Documentary=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(r,null,{default:e.withCtx(()=>[...p[28]||(p[28]=[e.createTextVNode("聯絡窗口",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",_$,[e.createElementVNode("div",C$,[p[29]||(p[29]=e.createElementVNode("label",{class:"me-2"},"聯絡電話及分機",-1)),e.createVNode(t,{modelValue:e.unref(f).ContactTel,"onUpdate:modelValue":p[10]||(p[10]=S=>e.unref(f).ContactTel=S),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",T$,[p[30]||(p[30]=e.createElementVNode("label",{class:"me-2"},"聯絡人",-1)),e.createVNode(t,{modelValue:e.unref(f).ContactPerson,"onUpdate:modelValue":p[11]||(p[11]=S=>e.unref(f).ContactPerson=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.unref(a).ContactTel||e.unref(a).ContactPerson?(e.openBlock(),e.createElementBlock("div",w$,e.toDisplayString(e.unref(a).ContactTel||e.unref(a).ContactPerson),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[p[33]||(p[33]=e.createElementVNode("th",null,[e.createTextVNode("線上申辦"),e.createElementVNode("br"),e.createTextVNode("參考資料")],-1)),e.createElementVNode("td",null,[e.unref(c).length?(e.openBlock(),e.createElementBlock("table",D$,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(S,w)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",S$,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",A$,[e.createElementVNode("div",F$,[e.createVNode(t,{error:e.unref(a)[`link-${w}-Title`],placeholder:"參考資料名稱",modelValue:S.Title,"onUpdate:modelValue":D=>S.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",U$,[e.createVNode(t,{error:e.unref(a)[`link-${w}-URL`],placeholder:"網址",modelValue:S.URL,"onUpdate:modelValue":D=>S.URL=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("td",P$,[e.createElementVNode("div",M$,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:D=>S.Deleted=!0,type:"button"},[...p[31]||(p[31]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,I$)])])]))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:p[12]||(p[12]=S=>e.unref(E).push({})),type:"button"},[...p[32]||(p[32]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])]),e.unref(f).Status===1?(e.openBlock(),e.createElementBlock("tr",j$,[p[35]||(p[35]=e.createElementVNode("th",null,"申請下架",-1)),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"status-checkbox",type:"checkbox","onUpdate:modelValue":p[13]||(p[13]=S=>e.isRef(m)?m.value=S:null)},null,512),[[e.vModelCheckbox,e.unref(m)]]),p[34]||(p[34]=e.createElementVNode("label",{class:"form-check-label ms-1 mb-2",for:"status-checkbox"},"申請E政府下架（請輸入原因）",-1)),e.createVNode(k,{error:e.unref(a).StatusReason,modelValue:e.unref(f).StatusReason,"onUpdate:modelValue":p[14]||(p[14]=S=>e.unref(f).StatusReason=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",O$,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:p[15]||(p[15]=S=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:p[16]||(p[16]=S=>s(!0)),type:"button"},[...p[36]||(p[36]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定發布",-1)])])])])}}},R$={class:"block"},q$={class:"table align-middle gray-table side-table"},z$={class:"p-0"},G$={class:"row align-items-center mb-0"},Y$={class:"col p-4"},J$={class:"col p-4"},Q$={class:"col p-4"},H$={class:"d-flex align-items-center flex-wrap gap-2"},W$={class:"input-group",style:{width:"360px"}},K$={class:"d-flex align-items-center flex-wrap gap-2"},X$={class:"input-group",style:{width:"360px"}},Z$={style:{width:"360px"}},v$={class:"d-flex align-items-center mb-2"},e2={class:"d-flex align-items-center mb-2"},t2={class:"d-flex align-items-center mb-2"},l2={class:"d-flex align-items-center mb-2"},o2={class:"d-flex align-items-center gap-2"},n2={class:"d-flex align-items-center flex-wrap gap-2"},r2={class:"input-group",style:{width:"360px"}},a2={class:"d-flex align-items-center flex-wrap gap-2"},s2={class:"input-group",style:{width:"360px"}},d2={__name:"GrantForm2",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref({}),m=e.ref(!1),f=u,a=()=>{const o={};m.value||(i.value.OverduePeriod=null),F.system("saveGrantType",{GrantType:Object.assign(i.value,o)}).subscribe(l=>{l&&(l.error?Swal.fire({title:l.error,icon:"error"}):f("next"))})};return e.onMounted(()=>{F.system("getGrantType",{ID:b.id}).subscribe(o=>{i.value=o.GrantType,i.value.OverduePeriod&&(m.value=!0)})}),(o,l)=>{const c=e.resolveComponent("input-integer"),g=e.resolveComponent("input-textarea"),E=e.resolveComponent("input-tw-date"),x=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock("div",R$,[e.createElementVNode("table",q$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[l[18]||(l[18]=e.createElementVNode("th",null,"補助類別 全稱",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(i).FullName),1)]),e.createElementVNode("tr",null,[l[21]||(l[21]=e.createElementVNode("th",null,"補助類別 簡稱",-1)),e.createElementVNode("td",z$,[e.createElementVNode("div",G$,[e.createElementVNode("div",Y$,e.toDisplayString(e.unref(i).ShortName),1),l[19]||(l[19]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"代碼",-1)),e.createElementVNode("div",J$,e.toDisplayString(e.unref(i).TypeCode),1),l[20]||(l[20]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"年度",-1)),e.createElementVNode("div",Q$,e.toDisplayString(e.unref(i).Year),1)])])]),e.createElementVNode("tr",null,[l[22]||(l[22]=e.createElementVNode("th",null,"總預算經費(元)",-1)),e.createElementVNode("td",null,[e.createVNode(c,{class:"w-auto",modelValue:e.unref(i).BudgetFees,"onUpdate:modelValue":l[0]||(l[0]=_=>e.unref(i).BudgetFees=_),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[23]||(l[23]=e.createElementVNode("th",null,"身分標籤",-1)),e.createElementVNode("td",null,[e.createVNode(g,{rows:"5",modelValue:e.unref(i).TargetTags,"onUpdate:modelValue":l[1]||(l[1]=_=>e.unref(i).TargetTags=_),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[25]||(l[25]=e.createElementVNode("th",null,"申請期間",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",H$,[e.createElementVNode("div",W$,[e.createVNode(E,{modelValue:e.unref(i).ApplyStartDate,"onUpdate:modelValue":l[2]||(l[2]=_=>e.unref(i).ApplyStartDate=_)},null,8,["modelValue"]),l[24]||(l[24]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(E,{modelValue:e.unref(i).ApplyEndDate,"onUpdate:modelValue":l[3]||(l[3]=_=>e.unref(i).ApplyEndDate=_)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[26]||(l[26]=e.createElementVNode("th",null,"計畫期程迄日",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",K$,[e.createElementVNode("div",X$,[e.createVNode(E,{modelValue:e.unref(i).PlanEndDate,"onUpdate:modelValue":l[4]||(l[4]=_=>e.unref(i).PlanEndDate=_)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[31]||(l[31]=e.createElementVNode("th",null,"申請階段審查",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",Z$,[e.createElementVNode("div",v$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-1",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[5]||(l[5]=_=>e.unref(i).Review1Enabled=_)},null,512),[[e.vModelCheckbox,e.unref(i).Review1Enabled]]),l[27]||(l[27]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-1"},"1.",-1)),e.createVNode(x,{class:"w-auto","aria-label":"資格審查",placeholder:"資格審查",modelValue:e.unref(i).Review1Title,"onUpdate:modelValue":l[6]||(l[6]=_=>e.unref(i).Review1Title=_),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",e2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-2",type:"checkbox","onUpdate:modelValue":l[7]||(l[7]=_=>e.unref(i).Review2Enabled=_)},null,512),[[e.vModelCheckbox,e.unref(i).Review2Enabled]]),l[28]||(l[28]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-2"},"2.",-1)),e.createVNode(x,{class:"w-auto","aria-label":"初審",placeholder:"初審",modelValue:e.unref(i).Review2Title,"onUpdate:modelValue":l[8]||(l[8]=_=>e.unref(i).Review2Title=_),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",t2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-3",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=_=>e.unref(i).Review3Enabled=_)},null,512),[[e.vModelCheckbox,e.unref(i).Review3Enabled]]),l[29]||(l[29]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-3"},"3.",-1)),e.createVNode(x,{class:"w-auto","aria-label":"複審",placeholder:"複審",modelValue:e.unref(i).Review3Title,"onUpdate:modelValue":l[10]||(l[10]=_=>e.unref(i).Review3Title=_),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",l2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-4",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[11]||(l[11]=_=>e.unref(i).Review4Enabled=_)},null,512),[[e.vModelCheckbox,e.unref(i).Review4Enabled]]),l[30]||(l[30]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-4"},"4.",-1)),e.createVNode(x,{class:"w-auto","aria-label":"決審核定",placeholder:"決審核定",modelValue:e.unref(i).Review4Title,"onUpdate:modelValue":l[12]||(l[12]=_=>e.unref(i).Review4Title=_),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[34]||(l[34]=e.createElementVNode("th",null,"補正補件期限",-1)),e.createElementVNode("td",o2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"overdue-period",type:"checkbox","onUpdate:modelValue":l[13]||(l[13]=_=>e.isRef(m)?m.value=_:null)},null,512),[[e.vModelCheckbox,e.unref(m)]]),l[33]||(l[33]=e.createElementVNode("label",{class:"form-check-label",for:"overdue-period"},"有期限",-1)),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(c,{class:"w-auto",modelValue:e.unref(i).OverduePeriod,"onUpdate:modelValue":l[14]||(l[14]=_=>e.unref(i).OverduePeriod=_),modelModifiers:{trim:!0}},null,8,["modelValue"]),l[32]||(l[32]=e.createTextVNode("天 ",-1))],64)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[l[35]||(l[35]=e.createElementVNode("th",null,[e.createTextVNode("期中報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("span",n2,[e.createElementVNode("span",r2,[e.createVNode(E,{modelValue:e.unref(i).MidtermDeadline,"onUpdate:modelValue":l[15]||(l[15]=_=>e.unref(i).MidtermDeadline=_)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[38]||(l[38]=e.createElementVNode("th",null,[e.createTextVNode("期末/成果報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("div",a2,[e.createElementVNode("div",s2,[e.createVNode(E,{disabled:e.unref(i).FinalOneMonth,modelValue:e.unref(i).FinalDeadline,"onUpdate:modelValue":l[16]||(l[16]=_=>e.unref(i).FinalDeadline=_)},null,8,["disabled","modelValue"])]),l[36]||(l[36]=e.createElementVNode("span",{class:"p-2"},"或",-1)),e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"final-one-month",type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=_=>e.unref(i).FinalOneMonth=_)},null,512),[[e.vModelCheckbox,e.unref(i).FinalOneMonth]]),l[37]||(l[37]=e.createElementVNode("label",{class:"form-check-label",for:"final-one-month"},"計畫結束一個月後",-1))])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:a,type:"button"},"儲存")])])}}},c2={class:"block"},i2={class:"mt-4"},m2={class:"table-responsive"},p2={class:"table align-middle gray-table"},V2={class:"d-flex align-items-center gap-2"},f2=["id","onUpdate:modelValue"],N2=["for"],E2={__name:"GrantForm3",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref([]),m=u,f=()=>{const a=i.value.map(o=>({...o,MatchingFund:o.checked?o.MatchingFund:null}));F.system("saveGrantTargetSettings",{List:a}).subscribe(o=>{o&&m("next")})};return e.onMounted(()=>{F.system("getGrantTargetSettings",{ID:b.id}).subscribe(a=>{i.value=a.List,i.value.forEach(o=>{typeof o.MatchingFund=="number"&&(o.checked=!0)})})}),(a,o)=>{const l=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock("div",c2,[e.createElementVNode("div",i2,[e.createElementVNode("div",m2,[e.createElementVNode("table",p2,[o[1]||(o[1]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th"),e.createElementVNode("th",null,"適用申請單位類別"),e.createElementVNode("th",null,"補助經費上限(萬)"),e.createElementVNode("th",null,"配合款")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(c,g)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",null,e.toDisplayString(g+1),1),e.createElementVNode("td",null,e.toDisplayString(c.TargetName),1),e.createElementVNode("td",null,[e.createVNode(l,{modelValue:c.GrantLimit,"onUpdate:modelValue":E=>c.GrantLimit=E},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",V2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:`checkbox-${g}`,type:"checkbox","onUpdate:modelValue":E=>c.checked=E},null,8,f2),[[e.vModelCheckbox,c.checked]]),e.createElementVNode("label",{class:"form-check-label ms-1",for:`checkbox-${g}`},"配合款分攤比例",8,N2),c.checked?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(l,{class:"w-auto",modelValue:c.MatchingFund,"onUpdate:modelValue":E=>c.MatchingFund=E},null,8,["modelValue","onUpdate:modelValue"]),o[0]||(o[0]=e.createTextVNode("(%) ",-1))],64)):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:f,type:"button"},"儲存")])])}}},b2={class:"block"},g2={class:"mt-4"},y2={class:"table-responsive"},k2={class:"table align-middle gray-table side-table"},u2={class:"input-group",style:{width:"400px"}},h2={class:"teal-dark-tabs"},x2={key:0,class:"table-responsive sub-table"},$2={class:"table align-middle gray-table"},B2={class:"d-flex gap-2"},_2=["onClick"],C2={key:1},T2={class:"d-flex gap-2"},w2={__name:"GrantForm4",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref({}),m=e.ref(),f=e.ref([]),a=e.ref({}),o=e.ref(1),l=e.ref(""),c=()=>{const _=/^(.*?)\s*<([^>]+)>$/;l.value.split(`
`).forEach(y=>{const s=y.trim().match(_);s&&a.value[m.value].push({CommitteeUser:s[1],Email:s[2]})}),o.value=1,l.value=""},g=u,E=()=>{if(!x()){e.nextTick(()=>{var _;return(_=document.querySelector(".invalid"))==null?void 0:_.scrollIntoView({behavior:"smooth",block:"center"})});return}F.system("saveReviewCommitteeList",{ID:m.value,List:a.value[m.value]}).subscribe(_=>{_&&g("next")})},x=()=>{const _={CommitteeUser:"姓名",Email:{presence:{message:"^請輸入 Email"},email:{message:"格式錯誤"}}};return i.value={},a.value[m.value].filter(y=>!y.Deleted).forEach((y,s)=>Object.assign(i.value,I(y,_,`item-${s}-`))),!Object.keys(i.value).length};return e.onMounted(()=>{F.system("getReviewGroups",{ID:b.id}).subscribe(_=>{f.value=_.List,m.value=f.value[0].Value})}),e.watch(m,_=>{a.value[_]||F.system("getReviewCommitteeList",{ID:_}).subscribe(y=>{a.value[_]=y.List})}),(_,y)=>{var r;const s=e.resolveComponent("required-label"),n=e.resolveComponent("input-select"),C=e.resolveComponent("input-text"),p=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",b2,[e.createElementVNode("div",g2,[e.createElementVNode("div",y2,[e.createElementVNode("table",k2,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...y[5]||(y[5]=[e.createTextVNode("審查組別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",u2,[e.createVNode(n,{options:e.unref(f),"text-name":"Text","value-name":"Value",modelValue:e.unref(m),"onUpdate:modelValue":y[0]||(y[0]=N=>e.isRef(m)?m.value=N:null)},null,8,["options","modelValue"])])])]),e.createElementVNode("tr",null,[y[11]||(y[11]=e.createElementVNode("th",null,"審查委員名單",-1)),e.createElementVNode("td",null,[e.createElementVNode("ul",h2,[e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===1})},[e.createElementVNode("a",{class:"tab-link",onClick:y[1]||(y[1]=N=>o.value=1),href:"javascript:void(0)"},"逐筆輸入")],2),e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===2})},[e.createElementVNode("a",{class:"tab-link",onClick:y[2]||(y[2]=N=>o.value=2),href:"javascript:void(0)"},"批次輸入")],2)]),e.unref(o)===1?(e.openBlock(),e.createElementBlock("div",x2,[e.createElementVNode("table",$2,[y[7]||(y[7]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"1%"}),e.createElementVNode("th",null,"姓名"),e.createElementVNode("th",null,"Email"),e.createElementVNode("th",{width:"1%"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((r=e.unref(a)[e.unref(m)])==null?void 0:r.filter(N=>!N.Deleted),(N,d)=>(e.openBlock(),e.createElementBlock("tr",{key:N},[e.createElementVNode("td",null,e.toDisplayString(d+1),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(i)[`item-${d}-CommitteeUser`],modelValue:N.CommitteeUser,"onUpdate:modelValue":t=>N.CommitteeUser=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(i)[`item-${d}-Email`],modelValue:N.Email,"onUpdate:modelValue":t=>N.Email=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",B2,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:t=>N.Deleted=!0,type:"button"},[...y[6]||(y[6]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_2)])])]))),128))])]),e.createElementVNode("button",{class:"btn btn-sm btn-teal",onClick:y[3]||(y[3]=N=>{var d;return(d=e.unref(a)[e.unref(m)])==null?void 0:d.push({})}),type:"button"},[...y[8]||(y[8]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])):e.createCommentVNode("",!0),e.unref(o)===2?(e.openBlock(),e.createElementBlock("div",C2,[e.createElementVNode("div",T2,[e.createVNode(p,{placeholder:`張曉明 <aming@gmail.com>
陳小華 <hwahchen@xxx.edu.tw>`,rows:"5",modelValue:e.unref(l),"onUpdate:modelValue":y[4]||(y[4]=N=>e.isRef(l)?l.value=N:null),modelModifiers:{trim:!0}},null,8,["modelValue"]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:c,type:"button"},[...y[9]||(y[9]=[e.createElementVNode("i",{class:"fa-solid fa-plus"},null,-1),e.createTextVNode("新增",-1)])])]),y[10]||(y[10]=e.createElementVNode("label",{class:"form-text"},"輸入格式範例「姓名 <xxx@email.com>」，多筆請斷行輸入",-1))])):e.createCommentVNode("",!0)])])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:E,type:"button"},"儲存")])])}}},D2={class:"search-form"},S2={class:"row g-3"},A2={class:"col-3"},F2=["value"],U2={class:"block rounded-4 mt-4"},P2={class:"table-responsive",style:{"min-height":"400px"}},M2={"aria-label":"公告列表",class:"table teal-table"},I2={"data-th":"年度:"},j2={"data-th":"補助類別全稱:",class:"text-start"},O2={"data-th":"簡稱:",class:"text-start"},L2={"data-th":"代碼:",class:"text-start"},R2={"data-th":"申請期間:",class:"text-start"},q2={"data-th":"管理:",class:"text-center"},z2={class:"d-inline-flex gap-2"},G2=["href"],Y2={__name:"GrantList",setup(h){const u=e.ref([]),b=e.ref(),i=e.ref([]),m=e.computed(()=>u.value.filter(f=>f.Year===b.value));return e.onMounted(()=>{F.system("getGrantTypeList").subscribe(f=>{u.value=f.List,i.value=[],u.value.forEach(a=>{i.value.includes(a.Year)||i.value.push(a.Year)}),b.value=i.value.length?i.value[0]:null})}),(f,a)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",D2,[e.createElementVNode("div",S2,[e.createElementVNode("div",A2,[a[1]||(a[1]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":a[0]||(a[0]=l=>e.isRef(b)?b.value=l:null)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l)+"年",9,F2))),128))],512),[[e.vModelSelect,e.unref(b)]])])])]),e.createElementVNode("div",U2,[a[5]||(a[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="GrantEdit.aspx"><i class="fa-solid fa-plus"></i> 新增類別 </a></div>',1)),e.createElementVNode("div",P2,[e.createElementVNode("table",M2,[a[4]||(a[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"補助類別全稱"),e.createElementVNode("th",{scope:"col",class:"text-start"},"簡稱"),e.createElementVNode("th",{scope:"col"},"代碼"),e.createElementVNode("th",{scope:"col"},"申請期間"),e.createElementVNode("th",{scope:"col"},"管理")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",I2,e.toDisplayString(l.Year),1),e.createElementVNode("td",j2,e.toDisplayString(l.FullName),1),e.createElementVNode("td",O2,e.toDisplayString(l.ShortName),1),e.createElementVNode("td",L2,e.toDisplayString(l.TypeCode),1),e.createElementVNode("td",R2,[e.createVNode(o,{"default-value":"未設定",value:l.ApplyStartDate},null,8,["value"]),a[2]||(a[2]=e.createTextVNode(" ~ ",-1)),e.createVNode(o,{"default-value":"未設定",value:l.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",q2,[e.createElementVNode("div",z2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`GrantEdit.aspx?ID=${l.TypeID}`},[...a[3]||(a[3]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,G2)])])]))),128))])])])])],64)}}},J2={class:"block rounded-4 mt-4"},Q2={class:"table-responsive",style:{"min-height":"400px"}},H2={class:"table teal-table","aria-label":"公告列表"},W2={"data-th":"公告期間:"},K2={key:1},X2={"data-th":"公告標題:",class:"text-start"},Z2={"data-th":"發布者:",class:"text-start"},v2={"data-th":"功能:",class:"text-center"},eB={class:"d-inline-flex gap-2"},tB=["href"],lB=["onClick"],oB={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},nB={class:"modal-content"},rB={class:"modal-body"},aB={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},sB={__name:"NewsList",setup(h){let u;const b=e.ref([]),i=e.ref(),m=e.ref(1),f=e.ref(10),a=e.computed(()=>b.value.slice((m.value-1)*f.value,m.value*f.value)),o=(c,g)=>{m.value=parseInt(c),f.value=parseInt(g)},l=(c,g)=>{if(!g){u=c,bootstrap.Modal.getOrCreateInstance(i.value).show();return}F.system("deleteNews",{ID:c.ID}).subscribe(E=>{E&&(b.value=b.value.filter(x=>x!==c),bootstrap.Modal.getOrCreateInstance(i.value).hide())})};return e.onMounted(()=>{F.system("getNewsList").subscribe(c=>b.value=c.List)}),(c,g)=>{const E=e.resolveComponent("tw-date"),x=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",J2,[g[5]||(g[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="NewsEdit.aspx"><i class="fa-solid fa-plus"></i> 新增公告 </a></div>',1)),e.createElementVNode("div",Q2,[e.createElementVNode("table",H2,[g[4]||(g[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告期間"),e.createElementVNode("th",{class:"text-start",scope:"col"},"公告標題"),e.createElementVNode("th",{class:"text-start",scope:"col",style:{width:"200px"}},"發布者"),e.createElementVNode("th",{scope:"col",style:{width:"180px"}},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),_=>(e.openBlock(),e.createElementBlock("tr",{key:_},[e.createElementVNode("td",W2,[e.createVNode(E,{value:_.EnableTime},null,8,["value"]),g[1]||(g[1]=e.createTextVNode(" ~ ",-1)),_.DisableTime?(e.openBlock(),e.createBlock(E,{key:0,value:_.DisableTime},null,8,["value"])):(e.openBlock(),e.createElementBlock("span",K2,"未設定"))]),e.createElementVNode("td",X2,e.toDisplayString(_.Title),1),e.createElementVNode("td",Z2,e.toDisplayString(_.UserOrg)+" "+e.toDisplayString(_.UserName),1),e.createElementVNode("td",v2,[e.createElementVNode("div",eB,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`NewsEdit.aspx?ID=${_.ID}`},[...g[2]||(g[2]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,tB),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:y=>l(_),type:"button"},[...g[3]||(g[3]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,lB)])])]))),128))])])]),e.createVNode(x,{count:e.unref(b).length,onChange:o,page:e.unref(m),"page-size":e.unref(f)},null,8,["count","page","page-size"])]),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:i,tabindex:"-1"},[e.createElementVNode("div",oB,[e.createElementVNode("div",nB,[g[7]||(g[7]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 fw-bold text-green-light"},"確定刪除公告資料？"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",rB,[e.createElementVNode("div",aB,[g[6]||(g[6]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:g[0]||(g[0]=_=>l(e.unref(u),!0)),type:"button"},"確認刪除")])])])])],512)],64)}}},dB={class:"block rounded-top-4 mt-4 d-flex flex-column gap-5"},cB={class:"table-responsive mt-3 mb-0"},iB={class:"table align-middle gray-table side-table"},mB={class:"d-flex align-items-center gap-2"},pB={class:"input-group w-auto"},VB={key:0,class:"invalid mt-0"},fB={class:"d-flex mb-2 gap-3"},NB={class:"tag-group mt-3"},EB={key:0,class:"tag tag-green-light"},bB=["download","href"],gB=["onClick"],yB={class:"d-flex mb-2 gap-3"},kB={class:"image-preview mt-3"},uB={key:0,class:"image-preview__item"},hB=["src"],xB={class:"image-preview__item-overlay"},$B=["onClick"],BB={class:"d-flex mb-2 gap-3"},_B={key:0,class:"table-responsive mt-3"},CB={class:"table align-middle gray-table"},TB={class:"text-center"},wB={class:"d-flex gap-1"},DB=["onClick"],re={AccessibilityApplication:st,AccessibilityAttachment:Dt,AccessibilityBenefit:Gt,AccessibilityFunding:gl,AccessibilityPayment1:Gl,AccessibilityPayment2:yo,AccessibilityProgressBar:ko,AccessibilityWorkSchedule:Jo,AuditHistory:rn,ConfirmModal:pn,CommonProgressBar:yn,CultureApplication:or,CultureAttachment:_r,CultureFunding:vr,CultureOther:Na,CulturePayment1:Ra,CulturePayment2:Ns,CultureProgress:Us,CultureProgressBar:Ps,CultureWorkSchedule:Cd,EducationApplication:Mc,EducationAttachment:ri,EducationPayment:Ai,EducationProgressBar:Fi,ErrorModal:Oi,HomeDashboard:Gm,InputBoolean:Ym,InputFile:Jm,InputInteger:Wm,InputMonth:Km,InputRadioGroup:vm,InputSelect:np,InputText:cp,InputTextarea:fp,InputTwDate:bp,ListPager:Ap,LiteracyApplication:pV,LiteracyAttachment:PV,LiteracyBenefit:WV,LiteracyFunding:$f,LiteracyPayment1:Hf,LiteracyPayment2:yN,LiteracyProgressBar:kN,LiteracyWorkSchedule:JN,MultipleApplication:_1,MultipleAttachment:W1,MultipleBenefit:cE,MultipleFunding:IE,MultiplePayment1:sb,MultiplePayment2:Ub,MultiplePayment3:sg,MultipleProgressBar:dg,MultipleWorkSchedule:Ug,NewsDetail:Qg,NewsList:ty,NewsMarquee:sy,ProjectChangeReview:Vy,ProjectCorrectionReview:yy,ProjectOrganizer:Ty,ProjectPaymentReview:Iy,ProjectProgress:Qy,ProjectReport:mk,ProjectReportReview:bk,ProjectReview:Ck,ProjectTitle:Pk,ProjectToolbar:Xk,ReportApplyList:Ou,ReportApprovedList:fh,ReportInprogressList:Wh,ReportMixChart:Kh,ReportPieChart:Xh,ReportRecusedList:kx,ReportReviewerDetails:Ax,ReportReviewerList:s$,RequiredLabel:c$,ReviewCommitteeInfo:E$,SystemGrantForm1:L$,SystemGrantForm2:d2,SystemGrantForm3:E2,SystemGrantForm4:w2,SystemGrantList:Y2,SystemNewsList:sB,SystemNewsForm:{__name:"NewsForm",props:{id:{type:[Number,String]}},emits:["next"],setup(h,{emit:u}){const b=h,i=e.ref({}),m=e.ref([]),f=e.computed(()=>l.value.filter(y=>!y.Deleted)),a=e.ref({}),o=e.ref([]),l=e.ref([]),c=(y,s)=>y.push({Path:s.Path,Name:s.Name}),g=F.download,E=u,x=()=>{if(!_()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const y={News:a.value,Files:m.value,Images:o.value,Videos:l.value};F.system("saveNews",y).subscribe(s=>{s&&E("next",s.ID)})},_=()=>{let y={Title:"公告標題",EnableTime:"公告期間",Content:"內容"};return i.value=I(a.value,y),y={Title:"影片名稱",URL:"影片網址"},f.value.forEach((s,n)=>Object.assign(i.value,I(s,y,`video-${n}-`))),!Object.keys(i.value).length};return e.onMounted(()=>{b.id?F.system("getNews",{ID:b.id}).subscribe(y=>{a.value=y.News,m.value=y.Files,o.value=y.Images,l.value=y.Videos}):F.system("getEmptyNews").subscribe(y=>a.value=y)}),(y,s)=>{const n=e.resolveComponent("required-label"),C=e.resolveComponent("input-text"),p=e.resolveComponent("input-tw-date"),r=e.resolveComponent("input-textarea"),N=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",dB,[e.createElementVNode("div",null,[s[12]||(s[12]=e.createElementVNode("h5",{class:"square-title"},"公告內容",-1)),e.createElementVNode("div",cB,[e.createElementVNode("table",iB,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[7]||(s[7]=e.createElementVNode("th",null,"發佈者",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(a).UserOrg)+"    "+e.toDisplayString(e.unref(a).UserName),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...s[8]||(s[8]=[e.createTextVNode("公告標題",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(i).Title,modelValue:e.unref(a).Title,"onUpdate:modelValue":s[0]||(s[0]=d=>e.unref(a).Title=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...s[9]||(s[9]=[e.createTextVNode("公告期間",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",mB,[e.createElementVNode("div",pB,[e.createVNode(p,{class:"w-auto",modelValue:e.unref(a).EnableTime,"onUpdate:modelValue":s[1]||(s[1]=d=>e.unref(a).EnableTime=d)},null,8,["modelValue"]),s[10]||(s[10]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(p,{class:"w-auto",modelValue:e.unref(a).DisableTime,"onUpdate:modelValue":s[2]||(s[2]=d=>e.unref(a).DisableTime=d)},null,8,["modelValue"])])]),e.unref(i).EnableTime?(e.openBlock(),e.createElementBlock("div",VB,e.toDisplayString(e.unref(i).EnableTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...s[11]||(s[11]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(r,{error:e.unref(i).Content,modelValue:e.unref(a).Content,"onUpdate:modelValue":s[3]||(s[3]=d=>e.unref(a).Content=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",null,[e.createElementVNode("div",fB,[s[13]||(s[13]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關附件")],-1)),e.createVNode(N,{accept:".pdf,.odt,.doc,.docx,.zip",onFile:s[4]||(s[4]=d=>c(e.unref(m),d))})]),s[15]||(s[15]=e.createElementVNode("span",{class:"text-pink"},"支援文件 pdf, odt, doc, docx (10MB以內)、ZIP 壓縮檔 (50MB以內)",-1)),e.createElementVNode("div",NB,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),d=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:d},[d.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",EB,[e.createElementVNode("a",{class:"tag-link my-1",download:d.Name,href:e.unref(g)(d.Path)},e.toDisplayString(d.Name),9,bB),e.createElementVNode("button",{class:"tag-btn",onClick:t=>d.Deleted=!0,type:"button"},[...s[14]||(s[14]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,gB)]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",yB,[s[16]||(s[16]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關圖片")],-1)),e.createVNode(N,{accept:".jpg,.png",onFile:s[5]||(s[5]=d=>c(e.unref(o),d))})]),s[18]||(s[18]=e.createElementVNode("span",{class:"text-pink"},"支援 JPG, PNG，檔案大小 10MB以內",-1)),e.createElementVNode("div",kB,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),d=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:d},[d.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",uB,[e.createElementVNode("img",{alt:"picture",src:e.unref(g)(d.Path)},null,8,hB),e.createElementVNode("div",xB,[e.createElementVNode("button",{"aria-label":"移除圖片",class:"btn btn-remove-image",onClick:t=>d.Deleted=!0,type:"button"},[...s[17]||(s[17]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,$B)])]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",BB,[s[20]||(s[20]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關影片")],-1)),e.createElementVNode("button",{"aria-label":"新增影片",class:"btn btn-teal-dark",onClick:s[6]||(s[6]=d=>e.unref(l).push({})),type:"button"},[...s[19]||(s[19]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增 ",-1)])])]),e.unref(f).length?(e.openBlock(),e.createElementBlock("div",_B,[e.createElementVNode("table",CB,[s[22]||(s[22]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80",class:"text-center"},"項次"),e.createElementVNode("th",null,"影片名稱"),e.createElementVNode("th",null,"影片網址"),e.createElementVNode("th",{width:"120"},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(d,t)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",TB,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(i)[`video-${t}-Title`],modelValue:d.Title,"onUpdate:modelValue":V=>d.Title=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(i)[`video-${t}-URL`],modelValue:d.URL,"onUpdate:modelValue":V=>d.URL=V,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",wB,[e.createElementVNode("button",{"aria-label":"刪除影片",class:"btn btn-sm btn-teal-dark",onClick:V=>d.Deleted=!0,type:"button"},[...s[21]||(s[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,DB)])])]))),128))])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:x,type:"button"},[...s[23]||(s[23]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確認送出",-1)])])])],64)}}},Tooltip:{__name:"Tooltip",setup(h){const u=e.ref();let b;return e.onMounted(()=>{b=new bootstrap.Tooltip(u.value)}),e.onUnmounted(()=>{b&&b.dispose()}),(i,m)=>(e.openBlock(),e.createElementBlock("button",{class:"btn-tooltip",ref_key:"element",ref:u,style:{color:"#027f72"},type:"button"},[...m[0]||(m[0]=[e.createElementVNode("i",{class:"fa-solid fa-circle-info"},null,-1)])],512))}},TwDate:{__name:"TwDate",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(h){const u=h,b=m=>{const f=m==null?void 0:m.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return f?`${parseInt(f[1],10)-1911}/${f[2]}/${f[3]}`:""},i=e.ref(b(u.value));return e.watch(()=>u.value,m=>i.value=b(m)),(m,f)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(i)||h.defaultValue),1))}},TwDateTime:{__name:"TwDateTime",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(h){const u=h,b=m=>{const f=m==null?void 0:m.match(/^(\d+)[\/-](\d+)[\/-](\d+)[ T](\d+:\d+(:\d+)?)/);return f?`${parseInt(f[1],10)-1911}/${f[2]}/${f[3]} ${f[4]}`:""},i=e.ref(b(u.value));return e.watch(()=>u.value,m=>i.value=b(m)),(m,f)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(i)||h.defaultValue),1))}}};return{api:F,install:h=>{for(const u in re)h.component(u,re[u])},useGrantStore:v,useProgressStore:j}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
