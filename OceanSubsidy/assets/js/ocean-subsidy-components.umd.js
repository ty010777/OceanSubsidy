(function(e,W){typeof exports=="object"&&typeof module<"u"?module.exports=W(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],W):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=W(e.Vue,e.Pinia))})(this,(function(e,W){"use strict";const j=W.defineStore("progress",{actions:{init(x,B,y){var c,i;this[x]={id:B.ProjectID,type:(c=B.SubsidyPlanType)==null?void 0:c.split(" ")[0],name:B.ProjectName,step:B.FormStep,status:B.Status,progress:B.ProgressStatus,changeStatus:(i=B.changeApply)==null?void 0:i.Status,reportStatus:y==null?void 0:y.Status,organizer:B.Organizer,organizerName:B.OrganizerName,isOrganizer:B.isOrganizer}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let ae=Date.now();const J=(x,B,y)=>{const c=j();if([1,14].includes(c[x].status)||[1,4].includes(c[x].changeStatus))return!0;if(c[x].status===42)switch(x){case"culture":if([2,3,5].includes(y))return!0;break;case"multiple":if([2,3,4,5].includes(y))return!0;break;case"accessibility":if([2,3,4,5].includes(y))return!0;break}return!1},se=()=>`id--${ae++}`,q=x=>parseInt(x)||0,ee=W.defineStore("message",{state:()=>({error:null})}),{ajax:de}=rxjs.ajax,{catchError:ce,map:ie}=rxjs;let X="";const me=(x,B={})=>K("Service/OFS/Accessibility.ashx",{method:x,param:B}),pe=(x,B={})=>K("Service/OFS/Culture.ashx",{method:x,param:B}),Ve=x=>`${X}/Service/OFS/Download.ashx?path=${encodeURIComponent(x)}`,fe=(x,B={})=>K("Service/OFS/Education.ashx",{method:x,param:B}),Ne=x=>{if(x.status===403){let B="/OFS/Home.aspx";/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Application|Attachment|Benefit|Funding|Other|WorkSchedule)\.aspx/.test(window.location.href)?B="/OFS/ApplicationChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Review)\.aspx/.test(window.location.href)?B="/OFS/ReviewChecklist.aspx":/\/OFS\/(ACC|CUL|EDC|LIT|MUL)\/(Audit|Payment|Progress|Report)\.aspx/.test(window.location.href)&&(B="/OFS/inprogressList.aspx"),window.location.href=te(B)}},Ee=(x,B={})=>K("Service/OFS/Literacy.ashx",{method:x,param:B}),be=(x,B={})=>K("Service/OFS/Multiple.ashx",{method:x,param:B}),ge=({response:x,status:B})=>{if(B===200){if(x.success)return x.data;ee().error=x.message}},K=(x,B={})=>{const y={};B.constructor!==FormData&&(y["Content-Type"]="application/json");const c={body:B,headers:y,method:"POST",url:`${X}/${x}`};return de(c).pipe(ie(ge),ce(Ne))},ye=(x,B)=>{let y=`${X}/Service/SCI_Download.ashx?action=${x}`;return Object.keys(B).forEach(c=>y=`${y}&${c}=${encodeURIComponent(B[c])}`),y},ke=x=>X=x,ue=(x,B={})=>K("Service/OFS/System.ashx",{method:x,param:B}),te=x=>`${X}${x}`,F=Object.assign(K,{accessibility:me,culture:pe,download:Ve,education:fe,literacy:Ee,multiple:be,sciDownload:ye,setBaseUrl:ke,system:ue,toUrl:te,upload:x=>{const B=new FormData;return B.append("file",x),K("Service/OFS/Upload.ashx",B)}});function he(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var Z={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var xe=Z.exports,le;function $e(){return le||(le=1,(function(x,B){(function(y,c,i){var N=function(l,t,m){m=r.extend({},r.options,m);var g=r.runValidations(l,t,m);if(g.some(function(b){return r.isPromise(b.error)}))throw new Error("Use validate.async if you want support for promises");return N.processValidationResults(g,m)},r=N;r.extend=function(l){return[].slice.call(arguments,1).forEach(function(t){for(var m in t)l[m]=t[m]}),l},r.extend(N,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var l=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(l+="+"+r.version.metadata),l}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(l,t,m){var g=[],b,_,u,p,d,a,h;(r.isDomElement(l)||r.isJqueryElement(l))&&(l=r.collectFormValues(l));for(b in t){u=r.getDeepObjectValue(l,b),p=r.result(t[b],u,l,b,m,t);for(_ in p){if(d=r.validators[_],!d)throw h=r.format("Unknown validator %{name}",{name:_}),new Error(h);a=p[_],a=r.result(a,u,l,b,m,t),a&&g.push({attribute:b,value:u,validator:_,globalOptions:m,attributes:l,options:a,error:d.call(d,u,a,b,l,m)})}}return g},processValidationResults:function(l,t){l=r.pruneEmptyErrors(l,t),l=r.expandMultipleErrors(l,t),l=r.convertErrorMessages(l,t);var m=t.format||"grouped";if(typeof r.formatters[m]=="function")l=r.formatters[m](l);else throw new Error(r.format("Unknown format %{format}",t));return r.isEmpty(l)?void 0:l},async:function(l,t,m){m=r.extend({},r.async.options,m);var g=m.wrapErrors||function(_){return _};m.cleanAttributes!==!1&&(l=r.cleanAttributes(l,t));var b=r.runValidations(l,t,m);return new r.Promise(function(_,u){r.waitForResults(b).then(function(){var p=r.processValidationResults(b,m);p?u(new g(p,m,l,t)):_(l)},function(p){u(p)})})},single:function(l,t,m){return m=r.extend({},r.single.options,m,{format:"flat",fullMessages:!1}),r({single:l},{single:t},m)},waitForResults:function(l){return l.reduce(function(t,m){return r.isPromise(m.error)?t.then(function(){return m.error.then(function(g){m.error=g||null})}):t},new r.Promise(function(t){t()}))},result:function(l){var t=[].slice.call(arguments,1);return typeof l=="function"&&(l=l.apply(null,t)),l},isNumber:function(l){return typeof l=="number"&&!isNaN(l)},isFunction:function(l){return typeof l=="function"},isInteger:function(l){return r.isNumber(l)&&l%1===0},isBoolean:function(l){return typeof l=="boolean"},isObject:function(l){return l===Object(l)},isDate:function(l){return l instanceof Date},isDefined:function(l){return l!=null},isPromise:function(l){return!!l&&r.isFunction(l.then)},isJqueryElement:function(l){return l&&r.isString(l.jquery)},isDomElement:function(l){return!l||!l.querySelectorAll||!l.querySelector?!1:r.isObject(document)&&l===document?!0:typeof HTMLElement=="object"?l instanceof HTMLElement:l&&typeof l=="object"&&l!==null&&l.nodeType===1&&typeof l.nodeName=="string"},isEmpty:function(l){var t;if(!r.isDefined(l))return!0;if(r.isFunction(l))return!1;if(r.isString(l))return r.EMPTY_STRING_REGEXP.test(l);if(r.isArray(l))return l.length===0;if(r.isDate(l))return!1;if(r.isObject(l)){for(t in l)return!1;return!0}return!1},format:r.extend(function(l,t){return r.isString(l)?l.replace(r.format.FORMAT_REGEXP,function(m,g,b){return g==="%"?"%{"+b+"}":String(t[b])}):l},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(l){return r.isNumber(l)?l*100%1===0?""+l:parseFloat(Math.round(l*100)/100).toFixed(2):r.isArray(l)?l.map(function(t){return r.prettify(t)}).join(", "):r.isObject(l)?r.isDefined(l.toString)?l.toString():JSON.stringify(l):(l=""+l,l.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(t,m,g){return""+m+" "+g.toLowerCase()}).toLowerCase())},stringifyValue:function(l,t){var m=t&&t.prettify||r.prettify;return m(l)},isString:function(l){return typeof l=="string"},isArray:function(l){return{}.toString.call(l)==="[object Array]"},isHash:function(l){return r.isObject(l)&&!r.isArray(l)&&!r.isFunction(l)},contains:function(l,t){return r.isDefined(l)?r.isArray(l)?l.indexOf(t)!==-1:t in l:!1},unique:function(l){return r.isArray(l)?l.filter(function(t,m,g){return g.indexOf(t)==m}):l},forEachKeyInKeypath:function(l,t,m){if(r.isString(t)){var g="",b,_=!1;for(b=0;b<t.length;++b)switch(t[b]){case".":_?(_=!1,g+="."):(l=m(l,g,!1),g="");break;case"\\":_?(_=!1,g+="\\"):_=!0;break;default:_=!1,g+=t[b];break}return m(l,g,!0)}},getDeepObjectValue:function(l,t){if(r.isObject(l))return r.forEachKeyInKeypath(l,t,function(m,g){if(r.isObject(m))return m[g]})},collectFormValues:function(l,t){var m={},g,b,_,u,p,d;if(r.isJqueryElement(l)&&(l=l[0]),!l)return m;for(t=t||{},u=l.querySelectorAll("input[name], textarea[name]"),g=0;g<u.length;++g)if(_=u.item(g),!r.isDefined(_.getAttribute("data-ignored"))){var a=_.name.replace(/\./g,"\\\\.");d=r.sanitizeFormValue(_.value,t),_.type==="number"?d=d?+d:null:_.type==="checkbox"?_.attributes.value?_.checked||(d=m[a]||null):d=_.checked:_.type==="radio"&&(_.checked||(d=m[a]||null)),m[a]=d}for(u=l.querySelectorAll("select[name]"),g=0;g<u.length;++g)if(_=u.item(g),!r.isDefined(_.getAttribute("data-ignored"))){if(_.multiple){d=[];for(b in _.options)p=_.options[b],p&&p.selected&&d.push(r.sanitizeFormValue(p.value,t))}else{var h=typeof _.options[_.selectedIndex]<"u"?_.options[_.selectedIndex].value:"";d=r.sanitizeFormValue(h,t)}m[_.name]=d}return m},sanitizeFormValue:function(l,t){return t.trim&&r.isString(l)&&(l=l.trim()),t.nullify!==!1&&l===""?null:l},capitalize:function(l){return r.isString(l)?l[0].toUpperCase()+l.slice(1):l},pruneEmptyErrors:function(l){return l.filter(function(t){return!r.isEmpty(t.error)})},expandMultipleErrors:function(l){var t=[];return l.forEach(function(m){r.isArray(m.error)?m.error.forEach(function(g){t.push(r.extend({},m,{error:g}))}):t.push(m)}),t},convertErrorMessages:function(l,t){t=t||{};var m=[],g=t.prettify||r.prettify;return l.forEach(function(b){var _=r.result(b.error,b.value,b.attribute,b.options,b.attributes,b.globalOptions);if(!r.isString(_)){m.push(b);return}_[0]==="^"?_=_.slice(1):t.fullMessages!==!1&&(_=r.capitalize(g(b.attribute))+" "+_),_=_.replace(/\\\^/g,"^"),_=r.format(_,{value:r.stringifyValue(b.value,t)}),m.push(r.extend({},b,{error:_}))}),m},groupErrorsByAttribute:function(l){var t={};return l.forEach(function(m){var g=t[m.attribute];g?g.push(m):t[m.attribute]=[m]}),t},flattenErrorsToArray:function(l){return l.map(function(t){return t.error}).filter(function(t,m,g){return g.indexOf(t)===m})},cleanAttributes:function(l,t){function m(_,u,p){return r.isObject(_[u])?_[u]:_[u]=p?!0:{}}function g(_){var u={},p;for(p in _)_[p]&&r.forEachKeyInKeypath(u,p,m);return u}function b(_,u){if(!r.isObject(_))return _;var p=r.extend({},_),d,a;for(a in _)d=u[a],r.isObject(d)?p[a]=b(p[a],d):d||delete p[a];return p}return!r.isObject(t)||!r.isObject(l)?{}:(t=g(t),b(l,t))},exposeModule:function(l,t,m,g,b){m?(g&&g.exports&&(m=g.exports=l),m.validate=l):(t.validate=l,l.isFunction(b)&&b.amd&&b([],function(){return l}))},warn:function(l){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+l)},error:function(l){typeof console<"u"&&console.error&&console.error("[validate.js] "+l)}}),N.validators={presence:function(l,t){if(t=r.extend({},this.options,t),t.allowEmpty!==!1?!r.isDefined(l):r.isEmpty(l))return t.message||this.message||"can't be blank"},length:function(l,t,m){if(r.isDefined(l)){t=r.extend({},this.options,t);var g=t.is,b=t.maximum,_=t.minimum,u=t.tokenizer||function(h){return h},p,d=[];l=u(l);var a=l.length;if(!r.isNumber(a))return t.message||this.notValid||"has an incorrect length";if(r.isNumber(g)&&a!==g&&(p=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",d.push(r.format(p,{count:g}))),r.isNumber(_)&&a<_&&(p=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",d.push(r.format(p,{count:_}))),r.isNumber(b)&&a>b&&(p=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",d.push(r.format(p,{count:b}))),d.length>0)return t.message||d}},numericality:function(l,t,m,g,b){if(r.isDefined(l)){t=r.extend({},this.options,t);var _=[],u,p,d={greaterThan:function(V,s){return V>s},greaterThanOrEqualTo:function(V,s){return V>=s},equalTo:function(V,s){return V===s},lessThan:function(V,s){return V<s},lessThanOrEqualTo:function(V,s){return V<=s},divisibleBy:function(V,s){return V%s===0}},a=t.prettify||b&&b.prettify||r.prettify;if(r.isString(l)&&t.strict){var h="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(h+="(\\.\\d+)?"),h+="$",!new RegExp(h).test(l))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(t.noStrings!==!0&&r.isString(l)&&!r.isEmpty(l)&&(l=+l),!r.isNumber(l))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!r.isInteger(l))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(u in d)if(p=t[u],r.isNumber(p)&&!d[u](l,p)){var E="not"+r.capitalize(u),n=t[E]||this[E]||this.message||"must be %{type} %{count}";_.push(r.format(n,{count:p,type:a(u)}))}if(t.odd&&l%2!==1&&_.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&l%2!==0&&_.push(t.notEven||this.notEven||this.message||"must be even"),_.length)return t.message||_}},datetime:r.extend(function(l,t){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(l)){t=r.extend({},this.options,t);var m,g=[],b=t.earliest?this.parse(t.earliest,t):NaN,_=t.latest?this.parse(t.latest,t):NaN;if(l=this.parse(l,t),isNaN(l)||t.dateOnly&&l%864e5!==0)return m=t.notValid||t.message||this.notValid||"must be a valid date",r.format(m,{value:arguments[0]});if(!isNaN(b)&&l<b&&(m=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",m=r.format(m,{value:this.format(l,t),date:this.format(b,t)}),g.push(m)),!isNaN(_)&&l>_&&(m=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",m=r.format(m,{date:this.format(_,t),value:this.format(l,t)}),g.push(m)),g.length)return r.unique(g)}},{parse:null,format:null}),date:function(l,t){return t=r.extend({},t,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,l,t)},format:function(l,t){(r.isString(t)||t instanceof RegExp)&&(t={pattern:t}),t=r.extend({},this.options,t);var m=t.message||this.message||"is invalid",g=t.pattern,b;if(r.isDefined(l)&&(!r.isString(l)||(r.isString(g)&&(g=new RegExp(t.pattern,t.flags)),b=g.exec(l),!b||b[0].length!=l.length)))return m},inclusion:function(l,t){if(r.isDefined(l)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),!r.contains(t.within,l))){var m=t.message||this.message||"^%{value} is not included in the list";return r.format(m,{value:l})}},exclusion:function(l,t){if(r.isDefined(l)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),!!r.contains(t.within,l))){var m=t.message||this.message||"^%{value} is restricted";return r.isString(t.within[l])&&(l=t.within[l]),r.format(m,{value:l})}},email:r.extend(function(l,t){t=r.extend({},this.options,t);var m=t.message||this.message||"is not a valid email";if(r.isDefined(l)&&(!r.isString(l)||!this.PATTERN.exec(l)))return m},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(l,t,m,g,b){if(r.isDefined(l)){r.isString(t)&&(t={attribute:t}),t=r.extend({},this.options,t);var _=t.message||this.message||"is not equal to %{attribute}";if(r.isEmpty(t.attribute)||!r.isString(t.attribute))throw new Error("The attribute must be a non empty string");var u=r.getDeepObjectValue(g,t.attribute),p=t.comparator||function(a,h){return a===h},d=t.prettify||b&&b.prettify||r.prettify;if(!p(l,u,t,m,g))return r.format(_,{attribute:d(t.attribute)})}},url:function(l,t){if(r.isDefined(l)){t=r.extend({},this.options,t);var m=t.message||this.message||"is not a valid url",g=t.schemes||this.schemes||["http","https"],b=t.allowLocal||this.allowLocal||!1,_=t.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(l))return m;var u="^(?:(?:"+g.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",p="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(b?p+="?":u+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",u+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+p+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",_){var d="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",a="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",h="data:(?:"+d+")?(?:;base64)?,"+a;u="(?:"+u+")|(?:^"+h+"$)"}var E=new RegExp(u,"i");if(!E.exec(l))return m}},type:r.extend(function(l,t,m,g,b){if(r.isString(t)&&(t={type:t}),!!r.isDefined(l)){var _=r.extend({},this.options,t),u=_.type;if(!r.isDefined(u))throw new Error("No type was specified");var p;if(r.isFunction(u)?p=u:p=this.types[u],!r.isFunction(p))throw new Error("validate.validators.type.types."+u+" must be a function.");if(!p(l,_,m,g,b)){var d=t.message||this.messages[u]||this.message||_.message||(r.isFunction(u)?"must be of the correct type":"must be of type %{type}");return r.isFunction(d)&&(d=d(l,t,m,g,b)),r.format(d,{attribute:r.prettify(m),type:u})}}},{types:{object:function(l){return r.isObject(l)&&!r.isArray(l)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},N.formatters={detailed:function(l){return l},flat:r.flattenErrorsToArray,grouped:function(l){var t;l=r.groupErrorsByAttribute(l);for(t in l)l[t]=r.flattenErrorsToArray(l[t]);return l},constraint:function(l){var t;l=r.groupErrorsByAttribute(l);for(t in l)l[t]=l[t].map(function(m){return m.validator}).sort();return l}},N.exposeModule(N,this,y,c,i)}).call(xe,B,x,null)})(Z,Z.exports)),Z.exports}var Be=$e();const oe=he(Be),I=(x,B,y="")=>{const c={};Object.keys(B).forEach(r=>{const l=B[r];oe.isString(l)?c[r]={presence:{allowEmpty:!1,message:l.startsWith("^")?l:`^請輸入${l}`}}:c[r]=l});const i={},N=oe(x,c);return N&&Object.keys(N).forEach(r=>i[`${y}${r}`]=N[r].join(",")),i},_e={class:"block"},Ce={class:"mt-4"},Te={class:"table align-middle gray-table side-table"},we={key:0},De={key:1,class:"text-light-gray"},Se={class:"d-flex flex-column gap-2"},Ae={key:0},Fe={class:"mt-4"},Ue={class:"table align-middle gray-table side-table"},Pe={class:"row g-3"},Me={class:"col-12 col-xl-2"},Ie={class:"text-gray mb-2"},je={class:"col-12 col-xl-3"},Oe={class:"text-gray mb-2"},Le={class:"col-12 col-xl-4"},Re={class:"row g-1"},qe={class:"col-7"},ze={class:"col-5"},Ge={class:"col-12 col-xl-3"},Je={class:"text-gray mb-2"},Ye={class:"col-12"},Qe={class:"text-gray mb-2"},He={class:"mt-4"},We={class:"table align-middle gray-table side-table"},Ke={class:"mt-4"},Xe={class:"table align-middle gray-table side-table"},Ze={key:0,class:"table-responsive mt-3 mb-0"},ve={class:"table align-middle gray-table"},et={key:0},tt={key:0},lt={class:"d-flex gap-2"},ot=["onClick"],nt={class:"mt-4"},rt={class:"table align-middle gray-table side-table"},at={key:0,class:"block-bottom bg-light-teal"},st={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.ref(),r=e.computed(()=>J("accessibility",m.value.Status,1)),l=e.ref({}),t=e.computed(()=>g.value.filter(E=>!E.Deleted)),m=e.ref({}),g=e.ref([]),b=e.computed({get:()=>!!t.value.length,set:E=>{E?_():g.value.forEach(n=>n.Deleted=!0)}}),_=()=>g.value.push({}),u=B,p=()=>{F.accessibility("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(E=>{m.value=E.Project,N.value=E.Contacts,g.value=E.ReceivedSubsidies,m.value.OrgCategory=m.value.OrgCategory||null,j().init("accessibility",m.value),i.value=m.value.changeApply,m.value.changeApply=void 0})},d=E=>E.Deleted=!0,a=E=>{var V,s;if(l.value={},E&&!h()){e.nextTick(()=>{var o;return(o=document.querySelector(".invalid"))==null?void 0:o.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:m.value,Contacts:N.value,ReceivedSubsidies:g.value.filter(o=>o.ID||!o.Deleted),Before:(V=i.value)==null?void 0:V.Form1Before,After:(s=i.value)==null?void 0:s.Form1After,Submit:E?"true":"false"};F.accessibility("saveApplication",n).subscribe(o=>{E?u("next",o.ID):m.value.ID?p():window.location.href=`Application.aspx?ID=${o.ID}`})},h=()=>{let E={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return m.value.OrgCategory==="2"&&(E.RegisteredNum="立案登記證字號"),l.value=I(m.value,E),E={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((n,V)=>Object.assign(l.value,I(n,E,`contact-${V}-`))),E={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},g.value.forEach((n,V)=>Object.assign(l.value,I(n,E,`received-${V}-`))),i.value&&(E={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,I(i.value,E))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(E=>{c.value=E[0],y.id?p():F.accessibility("getEmptyApplication").subscribe(n=>{m.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},n),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("accessibility",m.value)})})}),e.provide("editable",r),(E,n)=>{const V=e.resolveComponent("required-label"),s=e.resolveComponent("input-text"),o=e.resolveComponent("input-select"),f=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),S=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_e,[n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Ce,[e.createElementVNode("table",Te,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).Year),1)]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(m).ProjectID?(e.openBlock(),e.createElementBlock("span",we,e.toDisplayString(e.unref(m).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",De,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[17]||(n[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).ProjectName,modelValue:e.unref(m).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=D=>e.unref(m).ProjectName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(m).OrgName,"onUpdate:modelValue":n[1]||(n[1]=D=>e.unref(m).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Se,[e.createElementVNode("div",null,[e.createVNode(o,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(m).OrgCategory,"onUpdate:modelValue":n[2]||(n[2]=D=>e.unref(m).OrgCategory=D)},null,8,["error","options","modelValue"])]),e.unref(m).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Ae,[e.createVNode(s,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(m).RegisteredNum,"onUpdate:modelValue":n[3]||(n[3]=D=>e.unref(m).RegisteredNum=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(m).TaxID,"onUpdate:modelValue":n[4]||(n[4]=D=>e.unref(m).TaxID=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(m).Address,"onUpdate:modelValue":n[5]||(n[5]=D=>e.unref(m).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[43]||(n[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Fe,[e.createElementVNode("table",Ue,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(D,T)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Pe,[e.createElementVNode("div",Me,[e.createElementVNode("div",Ie,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(l)[`contact-${T}-Name`],modelValue:D.Name,"onUpdate:modelValue":C=>D.Name=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",je,[e.createElementVNode("div",Oe,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[24]||(n[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(l)[`contact-${T}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":C=>D.JobTitle=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Le,[n[25]||(n[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Re,[e.createElementVNode("div",qe,[e.createVNode(s,{modelValue:D.Phone,"onUpdate:modelValue":C=>D.Phone=C,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ze,[e.createVNode(s,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":C=>D.PhoneExt=C,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Ge,[e.createElementVNode("div",Je,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(l)[`contact-${T}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":C=>D.MobilePhone=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ye,[e.createElementVNode("div",Qe,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(l)[`contact-${T}-EMail`],modelValue:D.EMail,"onUpdate:modelValue":C=>D.EMail=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[44]||(n[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",He,[e.createElementVNode("table",We,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[28]||(n[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[29]||(n[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(f,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(m).Target,"onUpdate:modelValue":n[6]||(n[6]=D=>e.unref(m).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(m).Summary,"onUpdate:modelValue":n[7]||(n[7]=D=>e.unref(m).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(m).Quantified,"onUpdate:modelValue":n[8]||(n[8]=D=>e.unref(m).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[32]||(n[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(m).Qualitative,"onUpdate:modelValue":n[9]||(n[9]=D=>e.unref(m).Qualitative=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Ke,[e.createElementVNode("table",Xe,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[38]||(n[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(b),"onUpdate:modelValue":n[10]||(n[10]=D=>e.isRef(b)?b.value=D:null)},null,8,["modelValue"]),e.unref(b)?(e.openBlock(),e.createElementBlock("div",Ze,[e.createElementVNode("table",ve,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[33]||(n[33]=e.createElementVNode("th",null,"計畫名稱",-1)),n[34]||(n[34]=e.createElementVNode("th",null,"補助單位",-1)),n[35]||(n[35]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",et,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(D,T)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l)[`received-${T}-Name`],modelValue:D.Name,"onUpdate:modelValue":C=>D.Name=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(l)[`received-${T}-Unit`],modelValue:D.Unit,"onUpdate:modelValue":C=>D.Unit=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l)[`received-${T}-Amount`],modelValue:D.Amount,"onUpdate:modelValue":C=>D.Amount=C},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",tt,[e.createElementVNode("div",lt,[e.unref(t).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:C=>d(D),type:"button"},[...n[36]||(n[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ot)):e.createCommentVNode("",!0),T+1===e.unref(t).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:_,type:"button"},[...n[37]||(n[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",nt,[e.createElementVNode("table",rt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[39]||(n[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(i).Form1Before,"onUpdate:modelValue":n[11]||(n[11]=D=>e.unref(i).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[40]||(n[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(i).Form1After,"onUpdate:modelValue":n[12]||(n[12]=D=>e.unref(i).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",at,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[13]||(n[13]=D=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[14]||(n[14]=D=>a(!0)),type:"button"},[...n[45]||(n[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},dt={class:"block"},ct={key:0,class:"text-pink lh-base mt-4"},it={class:"mt-4"},mt={class:"table align-middle gray-table"},pt={class:"text-center"},Vt={key:0,width:"180"},ft={class:"text-center"},Nt={key:0},Et=["innerHTML"],bt=["href"],gt={key:0,class:"text-center"},yt={key:0},kt={key:1,class:"text-pink"},ut={key:1,class:"tag-group mt-2 gap-1"},ht={key:0,class:"tag tag-green-light"},xt=["download","href"],$t=["onClick"],Bt={key:1,class:"text-center mt-4"},_t={class:"mt-4"},Ct={class:"table align-middle gray-table side-table"},Tt={key:0,class:"block-bottom bg-light-teal"},wt=["disabled"],Dt={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateACC.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),i=e.ref(),N=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>J("accessibility",t.value.Status,2)),l=e.ref({}),t=e.ref({}),m=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:t.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},g=F.download,b=B,_=()=>{rxjs.forkJoin([F.accessibility("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=c.value.filter(h=>{var E;return!((E=h.Excludes)!=null&&E.includes(t.value.OrgCategory))}),c.value.forEach(h=>{h.Files=a.Attachments.filter(E=>E.Type===h.Type),h.Uploaded=e.computed(()=>h.Files.filter(E=>!E.Deleted).length)}),j().init("accessibility",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},u=d=>{var h,E;if(l.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,V)=>n.concat(V.Files),[]),Before:(h=i.value)==null?void 0:h.Form5Before,After:(E=i.value)==null?void 0:E.Form5After,Submit:d?"true":"false"};F.accessibility("saveAttachment",a).subscribe(n=>{n&&(d?b("next",_):_())})},p=()=>{if(i.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,I(i.value,d))}return!Object.keys(l.value).length};return e.onMounted(_),e.provide("editable",r),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file"),n=e.resolveComponent("tw-date-time"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",dt,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",ct,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",it,[e.createElementVNode("table",mt,[e.createElementVNode("thead",pt,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Vt,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",ft,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",Nt,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,Et)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,bt)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",gt,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",yt,"已上傳")):(e.openBlock(),e.createElementBlock("span",kt,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:f=>m(s,f)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",ut,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ht,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(g)(f.Path)},e.toDisplayString(f.Name),9,xt),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>f.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,$t)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(t).ApplyTime?(e.openBlock(),e.createElementBlock("div",Bt,[a[10]||(a[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(n,{value:e.unref(t).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",_t,[e.createElementVNode("table",Ct,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(i).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(i).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(i).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(i).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Tt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),disabled:e.unref(N),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,wt)])):e.createCommentVNode("",!0)],64)}}},St={class:"block"},At={class:"mt-4"},Ft={class:"table-responsive mt-3 mb-0"},Ut={class:"table align-middle gray-table"},Pt={key:0,width:"1"},Mt={key:0},It={class:"d-flex gap-2"},jt=["onClick"],Ot={class:"table-responsive mt-3 mb-0"},Lt={class:"table align-middle gray-table"},Rt={class:"mt-4"},qt={class:"table align-middle gray-table side-table"},zt={key:0,class:"block-bottom bg-light-teal"},Gt={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.computed(()=>J("accessibility",t.value.Status,4)),r=e.ref({}),l=e.computed(()=>c.value.filter(d=>!d.Deleted)),t=e.ref({}),m=()=>c.value.push({}),g=B,b=()=>{rxjs.forkJoin([F.accessibility("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=a.Benefits,c.value.length||m(),j().init("accessibility",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},_=d=>d.Deleted=!0,u=d=>{var h,E;if(r.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:t.value,Benefits:c.value,Before:(h=i.value)==null?void 0:h.Form4Before,After:(E=i.value)==null?void 0:E.Form4After,Submit:d?"true":"false"};F.accessibility("saveBenefit",a).subscribe(()=>{d?g("next"):b()})},p=()=>{let d={Benefit:"不可量化成果"};return r.value=I(t.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((a,h)=>Object.assign(r.value,I(a,d,`item-${h}-`))),i.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,I(i.value,d))),!Object.keys(r.value).length};return e.onMounted(b),e.provide("editable",N),(d,a)=>{const h=e.resolveComponent("input-text"),E=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",St,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",At,[e.createElementVNode("div",Ft,[e.createElementVNode("table",Ut,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Pt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(V,s)=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Title`],modelValue:V.Title,"onUpdate:modelValue":o=>V.Title=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Target`],modelValue:V.Target,"onUpdate:modelValue":o=>V.Target=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r)[`item-${s}-Description`],rows:"1",modelValue:V.Description,"onUpdate:modelValue":o=>V.Description=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Mt,[e.createElementVNode("div",It,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:o=>_(V),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,jt)):e.createCommentVNode("",!0),s+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:m,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Ot,[e.createElementVNode("table",Lt,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(t).Benefit,"onUpdate:modelValue":a[0]||(a[0]=V=>e.unref(t).Benefit=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Rt,[e.createElementVNode("table",qt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(i).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=V=>e.unref(i).Form4Before=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(i).Form4After,"onUpdate:modelValue":a[2]||(a[2]=V=>e.unref(i).Form4After=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",zt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=V=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=V=>u(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Jt={class:"block"},Yt={class:"mt-4"},Qt={class:"table-responsive mt-3 mb-0"},Ht={class:"table align-middle gray-table"},Wt={class:"text-end"},Kt={class:"text-end"},Xt={class:"table-responsive"},Zt={class:"table align-middle gray-table"},vt=["colspan"],el={key:0,width:"1"},tl={class:"text-end"},ll={key:0},ol={class:"d-flex gap-2"},nl=["onClick"],rl={class:"mt-4"},al={class:"table-responsive mt-3 mb-0"},sl={class:"table align-middle gray-table"},dl={key:0,width:"1"},cl={class:"text-end"},il={key:0},ml={class:"d-flex gap-2"},pl=["onClick"],Vl={class:"mt-4"},fl={class:"table align-middle gray-table side-table"},Nl={key:0,class:"block-bottom bg-light-teal"},El={class:"text-center"},bl={class:"mb-5"},gl={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("accessibility",t.value.Status,3)),N=e.ref({}),r=e.computed(()=>g.value.filter(s=>!s.Deleted)),l=e.computed(()=>b.value.filter(s=>!s.Deleted)),t=e.ref({}),m=e.ref(),g=e.ref([]),b=e.ref([]),_=e.ref({}),u=e.ref(0),p=()=>g.value.push({}),d=()=>b.value.push({}),a=B,h=()=>{rxjs.forkJoin([F.accessibility("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];t.value=o.Project,g.value=o.OtherSubsidies,b.value=o.BudgetPlans,_.value=o.GrantTargetSetting,b.value.length||d(),j().init("accessibility",t.value),c.value=t.value.changeApply,t.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=(s,o)=>{var k,S;if(N.value={},s&&!V()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!o&&t.value.ApplyAmount>_.value.GrantLimit*1e4){m.value.show(()=>n(s,!0));return}const f={Project:t.value,OtherSubsidies:g.value,BudgetPlans:b.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(S=c.value)==null?void 0:S.Form3After,Submit:s?"true":"false"};F.accessibility("saveFunding",f).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=I(t.value,s),s={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`other-${f}-`))),s={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},l.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`plan-${f}-`))),c.value&&(s={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,I(c.value,s))),!Object.keys(N.value).length};return e.onMounted(h),e.provide("editable",i),e.watchEffect(()=>{t.value.OtherAmount=r.value.reduce((s,o)=>s+q(o.Amount),0),u.value=q(t.value.ApplyAmount)+q(t.value.SelfAmount)+q(t.value.OtherAmount),r.value.forEach(s=>s.percent=Math.round(q(s.Amount)/t.value.OtherAmount*1e4)/100),b.value.forEach(s=>s.sum=q(s.Amount)+q(s.OtherAmount))}),(s,o)=>{var C;const f=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),D=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jt,[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Yt,[e.createElementVNode("div",Qt,[e.createElementVNode("table",Ht,[o[6]||(o[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).ApplyAmount,modelValue:e.unref(t).ApplyAmount,"onUpdate:modelValue":o[0]||(o[0]=A=>e.unref(t).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).SelfAmount,modelValue:e.unref(t).SelfAmount,"onUpdate:modelValue":o[1]||(o[1]=A=>e.unref(t).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",Wt,e.toDisplayString((C=e.unref(t).OtherAmount)==null?void 0:C.toLocaleString()),1),e.createElementVNode("td",Kt,e.toDisplayString(e.unref(u).toLocaleString()),1)])])])]),o[14]||(o[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",Xt,[e.createElementVNode("table",Zt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(i)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,vt)]),e.createElementVNode("tr",null,[o[7]||(o[7]=e.createElementVNode("th",{width:"1"},null,-1)),o[8]||(o[8]=e.createElementVNode("th",null,"單位名稱",-1)),o[9]||(o[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),o[10]||(o[10]=e.createElementVNode("th",null,"比例",-1)),o[11]||(o[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",el,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`other-${w}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`other-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",tl,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`other-${w}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",ll,[e.createElementVNode("div",ol,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[12]||(o[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,nl)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[13]||(o[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",rl,[e.createElementVNode("div",al,[e.createElementVNode("table",sl,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[15]||(o[15]=e.createElementVNode("th",null,"預算項目",-1)),o[16]||(o[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),o[17]||(o[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),o[18]||(o[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),o[19]||(o[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",dl,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`plan-${w}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",cl,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`plan-${w}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",il,[e.createElementVNode("div",ml,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[20]||(o[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,pl)):e.createCommentVNode("",!0),w+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[24]||(o[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Vl,[e.createElementVNode("table",fl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":o[2]||(o[2]=A=>e.unref(c).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":o[3]||(o[3]=A=>e.unref(c).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Nl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=A=>n(!0)),type:"button"},[...o[27]||(o[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:m},{default:e.withCtx(()=>[e.createElementVNode("div",El,[o[28]||(o[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",bl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),o[29]||(o[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),o[30]||(o[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},H=W.defineStore("payment",{actions:{init(x,B=0){this.stage=x==null?void 0:x.Stage,this.amount=x==null?void 0:x.CurrentRequestAmount,this.paid=B,this.status=x==null?void 0:x.Status}},state:()=>({stage:null,amount:null,paid:null,status:null})}),yl={class:"block"},kl={class:"square-title"},ul={class:"text-teal fw-bold py-3"},hl={class:"table-responsive mb-0"},xl={class:"table align-middle gray-table"},$l={class:"text-end"},Bl={class:"text-end"},_l={class:"text-end"},Cl={class:"text-teal fw-bold pb-3"},Tl={class:"text-teal fw-bold pb-3"},wl={class:"mt-4"},Dl={class:"table align-middle gray-table"},Sl={class:"text-center"},Al={key:0,width:"180"},Fl={class:"text-center"},Ul=["href"],Pl={key:0,class:"text-center"},Ml={key:0},Il={key:1,class:"text-pink"},jl={key:1,class:"tag-group mt-2 gap-1"},Ol={key:0,class:"tag tag-green-light"},Ll=["download","href"],Rl=["onClick"],ql={key:0,class:"block-bottom bg-light-teal"},zl=["disabled"],Gl={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>_.value.some(E=>!E.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!t.value||t.value.Status==="請款中"),r=e.computed(()=>{var E;return((E=t.value)==null?void 0:E.Status)==="通過"}),l=e.ref(0),t=e.ref(),m=e.ref({}),g=e.computed(()=>m.value.ApprovedAmount?Math.min(Math.round(c.value*100/m.value.ApprovedAmount*100)/100,100):0),b=e.computed(()=>r.value?Math.round(c.value*100/t.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"領據",Files:[]}]),u=(E,n)=>{n.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:n.Path,Name:`${m.value.ProjectID}_第一期請款_${E.Title}.pdf`})},p=F.download,d=B,a=()=>{F.accessibility("getPayment",{ID:y.id}).subscribe(E=>{m.value=E.Project,j().init("accessibility",m.value),_.value=_.value.filter(n=>{var V;return!((V=n.Excludes)!=null&&V.includes(m.value.OrgCategory))}),_.value.forEach(n=>{n.Files=E.Attachments.filter(V=>V.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(V=>!V.Deleted).length)}),t.value=E.Payments.find(n=>n.Stage===1),t.value&&(c.value=t.value.TotalSpentAmount),l.value=Math.round(m.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),H().init(t.value)})},h=E=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((V,s)=>V.concat(s.Files),[]),Submit:E?"true":"false"};F.accessibility("savePayment",n).subscribe(V=>{V&&(E?d("next",a):a())})};return e.onMounted(a),e.provide("editable",N),(E,n)=>{var f;const V=e.resolveComponent("input-integer"),s=e.resolveComponent("required-label"),o=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yl,[e.createElementVNode("h5",kl,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",ul,"核定經費: "+e.toDisplayString((f=e.unref(m).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("div",hl,[e.createElementVNode("table",xl,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",$l,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Bl,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",_l,e.toDisplayString(e.unref(b)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Cl,"本期實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Tl,"累積實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",wl,[e.createElementVNode("table",Dl,[e.createElementVNode("thead",Sl,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Al,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Fl,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(N)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Ul)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Pl,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Ml,"已上傳")):(e.openBlock(),e.createElementBlock("span",Il,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!k.Uploaded?(e.openBlock(),e.createBlock(o,{key:0,accept:".pdf",onFile:D=>u(k,D)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",jl,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ol,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(p)(D.Path)},e.toDisplayString(D.Name),9,Ll),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>D.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Rl)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",ql,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>h(!0)),disabled:e.unref(i),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,zl)])):e.createCommentVNode("",!0)],64)}}},Jl={class:"block"},Yl={class:"square-title"},Ql={class:"text-teal fw-bold py-3"},Hl={class:"text-teal fw-bold pb-3"},Wl={class:"table-responsive mb-0"},Kl={class:"table align-middle gray-table"},Xl={class:"text-end"},Zl={class:"text-end"},vl={class:"text-end"},eo={class:"text-end"},to={class:"text-teal fw-bold pb-3"},lo={class:"text-teal fw-bold pb-3"},oo={class:"mt-4"},no={class:"table align-middle gray-table"},ro={class:"text-center"},ao={key:0,width:"180"},so={class:"text-center"},co=["href"],io={key:0,class:"text-center"},mo={key:0},po={key:1,class:"text-pink"},Vo={key:1,class:"tag-group mt-2 gap-1"},fo={key:0,class:"tag tag-green-light"},No=["download","href"],Eo=["onClick"],bo={key:0,class:"block-bottom bg-light-teal"},go=["disabled"],yo={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>d.value.some(s=>!s.Files.filter(o=>!o.Deleted).length)),N=e.computed(()=>!t.value||t.value.Status==="請款中"),r=e.computed(()=>{var s;return((s=t.value)==null?void 0:s.Status)==="通過"}),l=e.ref(0),t=e.ref(),m=e.ref(0),g=e.ref(0),b=e.ref({}),_=e.computed(()=>b.value.ApprovedAmount?Math.min(Math.round(c.value*100/b.value.ApprovedAmount*100)/100,100):0),u=e.computed(()=>p.value?Math.round(c.value*100/p.value*100)/100:0),p=e.computed(()=>g.value+(r.value?t.value.CurrentActualPaidAmount:0)),d=e.ref([{Type:21,Title:"領據",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/ACC/1-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/ACC/2-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/ACC/3-補助清單.docx",Files:[]},{Type:25,Title:"其他",Files:[]}]),a=(s,o)=>{o.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:o.Path,Name:`${b.value.ProjectID}_第二期請款_${s.Title}.pdf`})},h=F.download,E=B,n=()=>{F.accessibility("getPayment",{ID:y.id}).subscribe(s=>{b.value=s.Project,j().init("accessibility",b.value),d.value=d.value.filter(f=>{var k;return!((k=f.Excludes)!=null&&k.includes(b.value.OrgCategory))}),d.value.forEach(f=>{f.Files=s.Attachments.filter(k=>k.Type===f.Type),f.Uploaded=e.computed(()=>f.Files.filter(k=>!k.Deleted).length)}),t.value=s.Payments.find(f=>f.Stage===2),t.value&&(c.value=t.value.TotalSpentAmount),l.value=b.value.ApprovedAmount;const o=s.Payments.filter(f=>f.Stage<2&&f.Status==="通過");m.value=o.reduce((f,k)=>f+k.CurrentRequestAmount,0),g.value=o.reduce((f,k)=>f+k.CurrentActualPaidAmount,0),H().init(t.value,g.value)})},V=s=>{const o={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:d.value.reduce((f,k)=>f.concat(k.Files),[]),Submit:s?"true":"false"};F.accessibility("savePayment",o).subscribe(f=>{f&&(s?E("next",n):n())})};return e.onMounted(n),e.provide("editable",N),(s,o)=>{var D;const f=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),S=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jl,[e.createElementVNode("h5",Yl,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Ql,"核定經費: "+e.toDisplayString((D=e.unref(b).ApprovedAmount)==null?void 0:D.toLocaleString())+"元",1),e.createElementVNode("p",Hl,"賸餘款: "+e.toDisplayString((e.unref(b).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Wl,[e.createElementVNode("table",Kl,[o[3]||(o[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Xl,e.toDisplayString(e.unref(c)-e.unref(m)),1),e.createElementVNode("td",Zl,e.toDisplayString(e.unref(g)),1),e.createElementVNode("td",null,[e.createVNode(f,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":o[0]||(o[0]=T=>e.isRef(c)?c.value=T:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",vl,e.toDisplayString(e.unref(_))+"%",1),e.createElementVNode("td",eo,e.toDisplayString(e.unref(u))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",to,"本期實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",lo,"累積實際撥款: "+e.toDisplayString(e.unref(p).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),o[9]||(o[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),o[10]||(o[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",oo,[e.createElementVNode("table",no,[e.createElementVNode("thead",ro,[e.createElementVNode("tr",null,[o[4]||(o[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[5]||(o[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",ao,"狀態")):e.createCommentVNode("",!0),o[6]||(o[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(T,C)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",so,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Title),1)]),_:2},1024)]),e.unref(N)&&T.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:T.Template,style:{width:"140px"},type:"button"},[...o[7]||(o[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,co)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",io,[T.Uploaded?(e.openBlock(),e.createElementBlock("span",mo,"已上傳")):(e.openBlock(),e.createElementBlock("span",po,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!T.Uploaded?(e.openBlock(),e.createBlock(S,{key:0,accept:".pdf",onFile:A=>a(T,A)},null,8,["onFile"])):e.createCommentVNode("",!0),T.Uploaded?(e.openBlock(),e.createElementBlock("div",Vo,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",fo,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(h)(A.Path)},e.toDisplayString(A.Name),9,No),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:w=>A.Deleted=!0,type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Eo)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",bo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[1]||(o[1]=T=>V()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[2]||(o[2]=T=>V(!0)),disabled:e.unref(i),type:"button"},[...o[11]||(o[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,go)])):e.createCommentVNode("",!0)],64)}}},ko={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const i=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(i,{steps:B,type:"accessibility"})}}},uo={class:"block"},ho={class:"mt-4"},xo={class:"table align-middle gray-table side-table"},$o={key:0,class:"d-flex align-items-center gap-2"},Bo={class:"input-group w-auto"},_o={class:"text-teal-dark"},Co={key:1,class:"invalid mt-0"},To={class:"table-responsive mt-4"},wo={class:"table align-middle gray-table"},Do={key:0},So={class:"input-group"},Ao={key:0,class:"invalid mt-0"},Fo={key:0},Uo={class:"d-flex gap-2"},Po=["onClick"],Mo={class:"mt-4"},Io={class:"table align-middle gray-table"},jo={key:0},Oo=["value"],Lo={key:0},Ro={class:"d-flex gap-2"},qo=["onClick"],zo={class:"mt-4"},Go={class:"table align-middle gray-table side-table"},Jo={key:0,class:"block-bottom bg-light-teal"},Yo={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],i=e.ref(),N=e.computed(()=>b.value.PlanEndDate),r=e.computed(()=>J("accessibility",g.value.Status,2)),l=e.ref({}),t=e.computed(()=>_.value.filter(s=>!s.Deleted)),m=e.computed(()=>u.value.filter(s=>!s.Deleted)),g=e.ref({}),b=e.ref({}),_=e.ref([]),u=e.ref([]),p=()=>F.accessibility("createItem",{ID:y.id}).subscribe(s=>_.value.push(s)),d=()=>u.value.push({Type:0,ItemID:0}),a=B,h=()=>{rxjs.forkJoin([F.accessibility("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];g.value=o.Project,b.value=o.GrantType,_.value=o.Items,u.value=o.Schedules,_.value.length||p(),u.value.length||d(),j().init("accessibility",g.value),i.value=g.value.changeApply,g.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=s=>{var f,k;if(l.value={},s&&!V()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:g.value,Items:_.value,Schedules:u.value,Before:(f=i.value)==null?void 0:f.Form2Before,After:(k=i.value)==null?void 0:k.Form2After,Submit:s?"true":"false"};F.accessibility("saveWorkSchedule",o).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=I(g.value,s),s={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},t.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`item-${f}-`))),s={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},m.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`schedule-${f}-`))),i.value&&(s={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,I(i.value,s))),!Object.keys(l.value).length};return e.onMounted(h),e.provide("editable",r),(s,o)=>{const f=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),D=e.resolveComponent("input-text"),T=e.resolveComponent("input-month"),C=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",uo,[o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",ho,[e.createElementVNode("table",xo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[6]||(o[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",$o,[e.createElementVNode("div",Bo,[e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":o[0]||(o[0]=w=>e.unref(g).StartTime=w)},null,8,["max-date","modelValue"]),o[7]||(o[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":o[1]||(o[1]=w=>e.unref(g).EndTime=w)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",_o,[o[8]||(o[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(N)},null,8,["value"]),o[9]||(o[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",Co,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),o[27]||(o[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",To,[e.createElementVNode("table",wo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[14]||(o[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[13]||(o[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Do,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${P}-Title`],modelValue:w.Title,"onUpdate:modelValue":U=>w.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",So,[e.createVNode(T,{"empty-value":0,modelValue:w.Begin,"onUpdate:modelValue":U=>w.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(T,{"empty-value":0,modelValue:w.End,"onUpdate:modelValue":U=>w.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",Ao,e.toDisplayString(e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`item-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Fo,[e.createElementVNode("div",Uo,[e.unref(t).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Po)):e.createCommentVNode("",!0),P+1===e.unref(t).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[16]||(o[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),o[28]||(o[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Mo,[e.createElementVNode("table",Io,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[17]||(o[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[18]||(o[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[19]||(o[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[20]||(o[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",jo,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-Type`],options:c,modelValue:w.Type,"onUpdate:modelValue":U=>w.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-ItemID`],options:e.unref(t),modelValue:w.ItemID,"onUpdate:modelValue":U=>w.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,Oo)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`schedule-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`schedule-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Lo,[e.createElementVNode("div",Ro,[e.unref(m).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,qo)):e.createCommentVNode("",!0),P+1===e.unref(m).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[22]||(o[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",zo,[e.createElementVNode("table",Go,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(i).Form2Before,"onUpdate:modelValue":o[2]||(o[2]=w=>e.unref(i).Form2Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[24]||(o[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(i).Form2After,"onUpdate:modelValue":o[3]||(o[3]=w=>e.unref(i).Form2After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Jo,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=w=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=w=>n(!0)),type:"button"},[...o[29]||(o[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Qo={class:"block rounded-bottom-4"},Ho={class:"mt-4"},Wo={class:"table align-middle gray-table side-table"},Ko={class:"text-pink"},Xo={class:"table-responsive",style:{"min-height":"400px"}},Zo={class:"table teal-table"},vo={"data-th":"計畫編號／計畫名稱:",class:"text-start"},en=["href"],tn={"data-th":"查核日期／人員:",class:"text-start"},ln={"data-th":"風險評估:"},on={"data-th":"查核意見:",class:"text-start"},nn={"data-th":"執行單位回覆:",class:"text-start"},rn={__name:"AuditHistory",props:{name:{type:String}},setup(x){const B=x,y=e.ref([]),c=e.ref(0),i=["無","低風險","中風險","高風險"];return e.onMounted(()=>{F.system("getAuditHistory",{Name:B.name}).subscribe(N=>{y.value=N.List,y.value.forEach(r=>{switch(r.Risk){case"Low":r.lv=1,c.value<1&&(c.value=1);break;case"Medium":r.lv=2,c.value<2&&(c.value=2);break;case"High":r.lv=3,c.value<3&&(c.value=3);break}})})}),(N,r)=>{const l=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock("div",Qo,[r[3]||(r[3]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"查核紀錄")])])],-1)),e.createElementVNode("div",Ho,[e.createElementVNode("table",Wo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[r[0]||(r[0]=e.createElementVNode("th",null,"執行單位",-1)),e.createElementVNode("td",null,e.toDisplayString(x.name),1)]),e.createElementVNode("tr",null,[r[1]||(r[1]=e.createElementVNode("th",null,"風險評估",-1)),e.createElementVNode("td",null,[e.createElementVNode("span",Ko,e.toDisplayString(i[e.unref(c)]),1)])])])])]),e.createElementVNode("div",Xo,[e.createElementVNode("table",Zo,[r[2]||(r[2]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫編號／計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核日期／人員")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"風險評估")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"查核意見")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"執行單位回覆")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),t=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",vo,[e.createElementVNode("a",{class:"link-black",href:`AuditRecords.aspx?ProjectID=${t.ProjectID}`,target:"_blank"},e.toDisplayString(t.ProjectID)+"／"+e.toDisplayString(t.ProjectName),9,en)]),e.createElementVNode("td",tn,[e.createVNode(l,{value:t.CheckDate},null,8,["value"]),e.createTextVNode("／"+e.toDisplayString(t.ReviewerName),1)]),e.createElementVNode("td",ln,e.toDisplayString(i[t.lv]),1),e.createElementVNode("td",on,e.toDisplayString(t.ReviewerComment),1),e.createElementVNode("td",nn,e.toDisplayString(t.ExecutorComment),1)]))),128))])])])])}}},an={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},sn={class:"modal-content"},dn={class:"modal-body"},cn={class:"d-flex justify-content-center mt-4 gap-4"},mn={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},pn={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(x,{expose:B}){let y;const c=e.ref(),i=x,N=()=>{y&&y()};return B({show:l=>{y=l,bootstrap.Modal.getOrCreateInstance(c.value).show()}}),(l,t)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",an,[e.createElementVNode("div",sn,[t[0]||(t[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",dn,[e.renderSlot(l.$slots,"default"),e.createElementVNode("div",cn,[e.createElementVNode("button",mn,e.toDisplayString(i.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:N,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(i.confirm),1)])])])])],512)]))}},Vn={class:"application-step"},fn=["onClick"],Nn={class:"step-content"},En={class:"step-label"},bn={key:0,class:"step-status edit"},gn={key:1,class:"step-status"},yn={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(x,{emit:B}){const y=e.computed(()=>J(i.type,c[i.type].status,i.step)),c=j(),i=x,N=l=>{i.review?r("click",l.step):l.step<=c[i.type].step&&(location.href=`${l.url}.aspx?ID=${i.id}`)},r=B;return(l,t)=>(e.openBlock(),e.createElementBlock("div",Vn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.steps,m=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(y)&&(m.step<e.unref(c)[x.type].step||m.step===x.step)}]),onClick:g=>N(m),key:m,role:"button"},[e.createElementVNode("div",Nn,[e.createElementVNode("div",En,e.toDisplayString(m.title),1),e.unref(y)&&m.step===x.step?(e.openBlock(),e.createElementBlock("div",bn,"編輯中")):m.step<e.unref(c)[x.type].step?(e.openBlock(),e.createElementBlock("div",gn,"已完成")):e.createCommentVNode("",!0)])],10,fn))),128))]))}},kn={class:"block"},un={class:"mt-4"},hn={class:"table align-middle gray-table side-table"},xn={key:0},$n={key:1,class:"text-light-gray"},Bn={class:"d-flex gap-2"},_n={key:0,class:"invalid mt-0"},Cn={class:"d-flex flex-column gap-2"},Tn={key:0},wn={class:"mt-4"},Dn={class:"table align-middle gray-table side-table"},Sn={class:"row g-3"},An={class:"col-12 col-xl-2"},Fn={class:"text-gray mb-2"},Un={class:"col-12 col-xl-3"},Pn={class:"text-gray mb-2"},Mn={class:"col-12 col-xl-4"},In={class:"row g-1"},jn={class:"col-7"},On={class:"col-5"},Ln={class:"col-12 col-xl-3"},Rn={class:"text-gray mb-2"},qn={class:"col-12"},zn={class:"text-gray mb-2"},Gn={class:"mt-4"},Jn={class:"table align-middle gray-table side-table"},Yn={class:"mt-4"},Qn={class:"table align-middle gray-table side-table"},Hn={key:0,class:"table-responsive mt-3 mb-0"},Wn={class:"table align-middle gray-table"},Kn={key:0},Xn={key:0},Zn={class:"d-flex gap-2"},vn=["onClick"],er={class:"mt-4"},tr={class:"table align-middle gray-table side-table"},lr={key:0,class:"block-bottom bg-light-teal"},or={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.ref(),r=e.computed(()=>J("culture",b.value.Status,1)),l=e.ref({}),t=e.ref(null),m=e.ref([]),g=e.computed(()=>u.value.filter(o=>!o.Deleted)),b=e.ref({}),_=e.computed(()=>m.value.filter(o=>!o.ParentCode)),u=e.ref([]),p=e.computed(()=>m.value.filter(o=>o.ParentCode===t.value)),d=e.computed({get:()=>!!g.value.length,set:o=>{o?a():u.value.forEach(f=>f.Deleted=!0)}}),a=()=>u.value.push({}),h=B,E=()=>{F.culture("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(o=>{var f;b.value=o.Project,N.value=o.Contacts,u.value=o.ReceivedSubsidies,t.value=((f=m.value.find(k=>k.Code===b.value.Field))==null?void 0:f.ParentCode)||null,b.value.OrgCategory=b.value.OrgCategory||null,j().init("culture",b.value),i.value=b.value.changeApply,b.value.changeApply=void 0})},n=o=>o.Deleted=!0,V=o=>{var k,S;if(l.value={},o&&!s()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}const f={Project:b.value,Contacts:N.value,ReceivedSubsidies:u.value.filter(D=>D.ID||!D.Deleted),Before:(k=i.value)==null?void 0:k.Form1Before,After:(S=i.value)==null?void 0:S.Form1After,Submit:o?"true":"false"};F.culture("saveApplication",f).subscribe(D=>{o?h("next",D.ID):b.value.ID?E():window.location.href=`Application.aspx?ID=${D.ID}`})},s=()=>{let o={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return b.value.OrgCategory==="3"&&(o.RegisteredNum="立案登記證字號"),l.value=I(b.value,o),o={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((f,k)=>Object.assign(l.value,I(f,o,`contact-${k}-`))),o={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},u.value.forEach((f,k)=>Object.assign(l.value,I(f,o,`received-${k}-`))),i.value&&(o={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,I(i.value,o))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.culture("getZgsCodes",{CodeGroup:"CULField"}),F.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(o=>{m.value=o[0],c.value=o[1],y.id?E():F.culture("getEmptyApplication").subscribe(f=>{t.value=null,b.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},f),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("culture",b.value)})})}),e.provide("editable",r),e.watch(t,()=>{t.value?p.value.find(o=>b.value.Field===o.Code)||(b.value.Field=p.value[0].Code):b.value.Field=null}),(o,f)=>{const k=e.resolveComponent("required-label"),S=e.resolveComponent("input-text"),D=e.resolveComponent("input-select"),T=e.resolveComponent("input-textarea"),C=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kn,[f[45]||(f[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",un,[e.createElementVNode("table",hn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[f[17]||(f[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).Year),1)]),e.createElementVNode("tr",null,[f[18]||(f[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(b).ProjectID?(e.openBlock(),e.createElementBlock("span",xn,e.toDisplayString(e.unref(b).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",$n,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[f[19]||(f[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[20]||(f[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).ProjectName,modelValue:e.unref(b).ProjectName,"onUpdate:modelValue":f[0]||(f[0]=w=>e.unref(b).ProjectName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[21]||(f[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Bn,[e.createVNode(D,{"empty-value":null,options:e.unref(_),"text-name":"Descname","value-name":"Code",modelValue:e.unref(t),"onUpdate:modelValue":f[1]||(f[1]=w=>e.isRef(t)?t.value=w:null)},null,8,["options","modelValue"]),e.createVNode(D,{"empty-value":null,disabled:!e.unref(t),options:e.unref(p),"text-name":"Descname","value-name":"Code",modelValue:e.unref(b).Field,"onUpdate:modelValue":f[2]||(f[2]=w=>e.unref(b).Field=w)},null,8,["disabled","options","modelValue"])]),e.unref(l).Field?(e.openBlock(),e.createElementBlock("div",_n,e.toDisplayString(e.unref(l).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[22]||(f[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(b).OrgName,"onUpdate:modelValue":f[3]||(f[3]=w=>e.unref(b).OrgName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[23]||(f[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Cn,[e.createElementVNode("div",null,[e.createVNode(D,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(b).OrgCategory,"onUpdate:modelValue":f[4]||(f[4]=w=>e.unref(b).OrgCategory=w)},null,8,["error","options","modelValue"])]),e.unref(b).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",Tn,[e.createVNode(S,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(b).RegisteredNum,"onUpdate:modelValue":f[5]||(f[5]=w=>e.unref(b).RegisteredNum=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[24]||(f[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(b).TaxID,"onUpdate:modelValue":f[6]||(f[6]=w=>e.unref(b).TaxID=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[25]||(f[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(b).Address,"onUpdate:modelValue":f[7]||(f[7]=w=>e.unref(b).Address=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),f[46]||(f[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",wn,[e.createElementVNode("table",Dn,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Sn,[e.createElementVNode("div",An,[e.createElementVNode("div",Fn,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[26]||(f[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(l)[`contact-${P}-Name`],modelValue:w.Name,"onUpdate:modelValue":U=>w.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Un,[e.createElementVNode("div",Pn,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[27]||(f[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(l)[`contact-${P}-JobTitle`],modelValue:w.JobTitle,"onUpdate:modelValue":U=>w.JobTitle=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Mn,[f[28]||(f[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",In,[e.createElementVNode("div",jn,[e.createVNode(S,{modelValue:w.Phone,"onUpdate:modelValue":U=>w.Phone=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",On,[e.createVNode(S,{placeholder:"請輸入分機",size:"4",modelValue:w.PhoneExt,"onUpdate:modelValue":U=>w.PhoneExt=U,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Ln,[e.createElementVNode("div",Rn,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[29]||(f[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(l)[`contact-${P}-MobilePhone`],modelValue:w.MobilePhone,"onUpdate:modelValue":U=>w.MobilePhone=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",qn,[e.createElementVNode("div",zn,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[30]||(f[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(S,{error:e.unref(l)[`contact-${P}-EMail`],modelValue:w.EMail,"onUpdate:modelValue":U=>w.EMail=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),f[47]||(f[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Gn,[e.createElementVNode("table",Jn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[31]||(f[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[f[32]||(f[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(T,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(b).Target,"onUpdate:modelValue":f[8]||(f[8]=w=>e.unref(b).Target=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[33]||(f[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(b).Summary,"onUpdate:modelValue":f[9]||(f[9]=w=>e.unref(b).Summary=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[34]||(f[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(b).Quantified,"onUpdate:modelValue":f[10]||(f[10]=w=>e.unref(b).Quantified=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[35]||(f[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(b).Qualitative,"onUpdate:modelValue":f[11]||(f[11]=w=>e.unref(b).Qualitative=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Yn,[e.createElementVNode("table",Qn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[f[41]||(f[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(C,{modelValue:e.unref(d),"onUpdate:modelValue":f[12]||(f[12]=w=>e.isRef(d)?d.value=w:null)},null,8,["modelValue"]),e.unref(d)?(e.openBlock(),e.createElementBlock("div",Hn,[e.createElementVNode("table",Wn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[f[36]||(f[36]=e.createElementVNode("th",null,"計畫名稱",-1)),f[37]||(f[37]=e.createElementVNode("th",null,"補助單位",-1)),f[38]||(f[38]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Kn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l)[`received-${P}-Name`],modelValue:w.Name,"onUpdate:modelValue":U=>w.Name=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(l)[`received-${P}-Unit`],modelValue:w.Unit,"onUpdate:modelValue":U=>w.Unit=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(l)[`received-${P}-Amount`],modelValue:w.Amount,"onUpdate:modelValue":U=>w.Amount=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Xn,[e.createElementVNode("div",Zn,[e.unref(g).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>n(w),type:"button"},[...f[39]||(f[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vn)):e.createCommentVNode("",!0),P+1===e.unref(g).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...f[40]||(f[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[f[44]||(f[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",er,[e.createElementVNode("table",tr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[42]||(f[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(i).Form1Before,"onUpdate:modelValue":f[13]||(f[13]=w=>e.unref(i).Form1Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(k,null,{default:e.withCtx(()=>[...f[43]||(f[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(i).Form1After,"onUpdate:modelValue":f[14]||(f[14]=w=>e.unref(i).Form1After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",lr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:f[15]||(f[15]=w=>V()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:f[16]||(f[16]=w=>V(!0)),type:"button"},[...f[48]||(f[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},nr={class:"block"},rr={key:0,class:"text-pink lh-base mt-4"},ar={class:"mt-4"},sr={class:"table align-middle gray-table"},dr={class:"text-center"},cr={key:0,width:"180"},ir={class:"text-center"},mr={key:0},pr=["innerHTML"],Vr=["href"],fr={key:0,class:"text-center"},Nr={key:0},Er={key:1,class:"text-pink"},br={key:1,class:"tag-group mt-2 gap-1"},gr={key:0,class:"tag tag-green-light"},yr=["download","href"],kr=["onClick"],ur={key:1,class:"text-center mt-4"},hr={class:"mt-4"},xr={class:"table align-middle gray-table side-table"},$r={key:0,class:"block-bottom bg-light-teal"},Br=["disabled"],_r={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=3&id=${y.id}`,Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:`../../Service/OFS/DownloadTemplateCUL.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),i=e.ref(),N=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>J("culture",t.value.Status,5)),l=e.ref({}),t=e.ref({}),m=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:t.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},g=F.download,b=B,_=()=>{rxjs.forkJoin([F.culture("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=c.value.filter(h=>{var E;return!((E=h.Excludes)!=null&&E.includes(t.value.OrgCategory))}),t.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/CUL/5.海洋委員會補助計畫著作權授權同意書.docx",Files:[]}),c.value.forEach(h=>{h.Files=a.Attachments.filter(E=>E.Type===h.Type),h.Uploaded=e.computed(()=>h.Files.filter(E=>!E.Deleted).length)}),j().init("culture",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},u=d=>{var h,E;if(l.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,V)=>n.concat(V.Files),[]),Before:(h=i.value)==null?void 0:h.Form5Before,After:(E=i.value)==null?void 0:E.Form5After,Submit:d?"true":"false"};F.culture("saveAttachment",a).subscribe(n=>{n&&(d?b("next",_):_())})},p=()=>{if(i.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,I(i.value,d))}return!Object.keys(l.value).length};return e.onMounted(_),e.provide("editable",r),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file"),n=e.resolveComponent("tw-date-time"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nr,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",rr,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",ar,[e.createElementVNode("table",sr,[e.createElementVNode("thead",dr,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",cr,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",ir,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",mr,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,pr)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Vr)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",fr,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",Nr,"已上傳")):(e.openBlock(),e.createElementBlock("span",Er,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:f=>m(s,f)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",br,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",gr,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(g)(f.Path)},e.toDisplayString(f.Name),9,yr),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>f.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,kr)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(t).ApplyTime?(e.openBlock(),e.createElementBlock("div",ur,[a[10]||(a[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(n,{value:e.unref(t).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",hr,[e.createElementVNode("table",xr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(i).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(i).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(i).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(i).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",$r,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),disabled:e.unref(N),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Br)])):e.createCommentVNode("",!0)],64)}}},Cr={class:"block"},Tr={class:"mt-4"},wr={class:"table-responsive mt-3 mb-0"},Dr={class:"table align-middle gray-table"},Sr={class:"text-end"},Ar={class:"text-end"},Fr={class:"table-responsive"},Ur={class:"table align-middle gray-table"},Pr=["colspan"],Mr={key:0,width:"1"},Ir={key:0},jr={class:"d-flex gap-2"},Or=["onClick"],Lr={class:"mt-4"},Rr={class:"table-responsive mt-3 mb-0"},qr={class:"table align-middle gray-table"},zr={key:0,width:"1"},Gr={class:"text-end"},Jr={key:0},Yr={class:"d-flex gap-2"},Qr=["onClick"],Hr={class:"mt-4"},Wr={class:"table align-middle gray-table side-table"},Kr={key:0,class:"block-bottom bg-light-teal"},Xr={class:"text-center"},Zr={class:"mb-5"},vr={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("culture",t.value.Status,3)),N=e.ref({}),r=e.computed(()=>b.value.filter(f=>!f.Deleted)),l=e.computed(()=>_.value.filter(f=>!f.Deleted)),t=e.ref({}),m=e.ref([]),g=e.ref(),b=e.ref([]),_=e.ref([]),u=e.ref({}),p=e.ref(0),d=()=>b.value.push({}),a=()=>_.value.push({ItemID:0}),h=B,E=()=>{rxjs.forkJoin([F.culture("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(f=>{const k=f[0];t.value=k.Project,b.value=k.OtherSubsidies,_.value=k.BudgetPlans,m.value=k.Items,u.value=k.GrantTargetSetting,_.value.length||a(),j().init("culture",t.value),c.value=t.value.changeApply,t.value.changeApply=void 0})},n=f=>f.Deleted=!0,V=f=>f.Deleted=!0,s=(f,k)=>{var D,T;if(N.value={},f&&!o()){e.nextTick(()=>{var C;return(C=document.querySelector(".invalid"))==null?void 0:C.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!k&&t.value.ApplyAmount>u.value.GrantLimit*1e4){g.value.show(()=>s(f,!0));return}const S={Project:t.value,OtherSubsidies:b.value,BudgetPlans:_.value,Before:(D=c.value)==null?void 0:D.Form3Before,After:(T=c.value)==null?void 0:T.Form3After,Submit:f?"true":"false"};F.culture("saveFunding",S).subscribe(()=>{f?h("next"):E()})},o=()=>{let f={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=I(t.value,f),f={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},r.value.forEach((k,S)=>Object.assign(N.value,I(k,f,`other-${S}-`))),f={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},l.value.forEach((k,S)=>Object.assign(N.value,I(k,f,`plan-${S}-`))),c.value&&(f={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,I(c.value,f))),!Object.keys(N.value).length};return e.onMounted(E),e.provide("editable",i),e.watchEffect(()=>{t.value.OtherAmount=b.value.reduce((f,k)=>f+(k.Deleted?0:q(k.Amount)),0),p.value=q(t.value.ApplyAmount)+q(t.value.SelfAmount)+q(t.value.OtherAmount),_.value.forEach(f=>f.sum=q(f.Amount)+q(f.OtherAmount))}),(f,k)=>{var P;const S=e.resolveComponent("input-integer"),D=e.resolveComponent("input-text"),T=e.resolveComponent("input-select"),C=e.resolveComponent("input-textarea"),A=e.resolveComponent("required-label"),w=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Cr,[k[25]||(k[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",Tr,[e.createElementVNode("div",wr,[e.createElementVNode("table",Dr,[k[6]||(k[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).ApplyAmount,modelValue:e.unref(t).ApplyAmount,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(t).ApplyAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).SelfAmount,modelValue:e.unref(t).SelfAmount,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(t).SelfAmount=U)},null,8,["error","modelValue"])]),e.createElementVNode("td",Sr,e.toDisplayString((P=e.unref(t).OtherAmount)==null?void 0:P.toLocaleString()),1),e.createElementVNode("td",Ar,e.toDisplayString(e.unref(p).toLocaleString()),1)])])])]),k[12]||(k[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",Fr,[e.createElementVNode("table",Ur,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(i)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Pr)]),e.createElementVNode("tr",null,[k[7]||(k[7]=e.createElementVNode("th",{width:"1"},null,-1)),k[8]||(k[8]=e.createElementVNode("th",null,"單位名稱",-1)),k[9]||(k[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",Mr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(U,L)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,e.toDisplayString(L+1),1),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(N)[`other-${L}-Unit`],modelValue:U.Unit,"onUpdate:modelValue":O=>U.Unit=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`other-${L}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",Ir,[e.createElementVNode("div",jr,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:O=>n(U),type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Or)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...k[11]||(k[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),k[26]||(k[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Lr,[e.createElementVNode("div",Rr,[e.createElementVNode("table",qr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[k[13]||(k[13]=e.createElementVNode("th",null,"重要工作項目",-1)),k[14]||(k[14]=e.createElementVNode("th",null,"預算項目",-1)),k[15]||(k[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),k[16]||(k[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),k[17]||(k[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),k[18]||(k[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",zr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(U,L)=>(e.openBlock(),e.createElementBlock("tr",{key:U},[e.createElementVNode("td",null,[e.createVNode(T,{"empty-value":0,error:e.unref(N)[`plan-${L}-ItemID`],options:e.unref(m),"text-name":"Title","value-name":"ID",modelValue:U.ItemID,"onUpdate:modelValue":O=>U.ItemID=O},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(N)[`plan-${L}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`plan-${L}-Amount`],modelValue:U.Amount,"onUpdate:modelValue":O=>U.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`plan-${L}-OtherAmount`],modelValue:U.OtherAmount,"onUpdate:modelValue":O=>U.OtherAmount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Gr,e.toDisplayString(U.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(N)[`plan-${L}-Description`],rows:"1",modelValue:U.Description,"onUpdate:modelValue":O=>U.Description=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",Jr,[e.createElementVNode("div",Yr,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>V(U),type:"button"},[...k[19]||(k[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Qr)):e.createCommentVNode("",!0),L+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...k[20]||(k[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),k[21]||(k[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[24]||(k[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Hr,[e.createElementVNode("table",Wr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...k[22]||(k[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(c).Form3Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...k[23]||(k[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(c).Form3After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Kr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>s(!0)),type:"button"},[...k[27]||(k[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(w,{ref_key:"modal",ref:g},{default:e.withCtx(()=>[e.createElementVNode("div",Xr,[k[28]||(k[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Zr,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(u).GrantLimit)+"萬",1),k[29]||(k[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),k[30]||(k[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},ea={class:"block"},ta={key:0,class:"text-pink lh-base mt-3"},la={class:"border"},oa={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},na={class:"d-flex gap-2 align-items-center flex-grow-1"},ra={class:"text-nowrap"},aa={class:"flex-grow-1"},sa={class:"d-flex gap-2"},da=["onClick"],ca=["href"],ia=["id"],ma={class:"table align-middle gray-table side-table mb-0"},pa={class:"mt-4"},Va={class:"table align-middle gray-table side-table"},fa={key:0,class:"block-bottom bg-light-teal"},Na={__name:"Other",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("culture",r.value.Status,4)),N=e.ref({}),r=e.ref({}),l=e.ref([]),t=e.computed(()=>l.value.filter(d=>!d.Deleted)),m=()=>l.value.push({}),g=B,b=()=>{rxjs.forkJoin([F.culture("getRelatedProject",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];r.value=a.Project,l.value=a.Projects,j().init("culture",r.value),c.value=r.value.changeApply,r.value.changeApply=void 0})},_=d=>d.Deleted=!0,u=d=>{var h,E;if(N.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Projects:l.value,Before:(h=c.value)==null?void 0:h.Form4Before,After:(E=c.value)==null?void 0:E.Form4After,Submit:d?"true":"false"};F.culture("saveRelatedProject",a).subscribe(()=>{d?g("next"):b()})},p=()=>{let d={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return t.value.forEach((a,h)=>Object.assign(N.value,I(a,d,`project-${h}-`))),c.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(N.value,I(c.value,d))),!Object.keys(N.value).length};return e.onMounted(b),e.provide("editable",i),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-text"),n=e.resolveComponent("input-integer"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ea,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("p",ta," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(s,o)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:s},[e.createElementVNode("div",la,[e.createElementVNode("div",oa,[e.createElementVNode("div",na,[e.createElementVNode("label",ra,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[4]||(a[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",aa,[e.createVNode(E,{error:e.unref(N)[`project-${o}-Title`],modelValue:s.Title,"onUpdate:modelValue":f=>s.Title=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",sa,[e.unref(i)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(f=>_(s),["prevent"]),href:"#"},"刪除",8,da)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${o}`,role:"button"},"收合",8,ca)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${o}`},[e.createElementVNode("table",ma,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[5]||(a[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"text-start w-auto",error:e.unref(N)[`project-${o}-Year`],modelValue:s.Year,"onUpdate:modelValue":f=>s.Year=f},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[6]||(a[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(N)[`project-${o}-OrgName`],modelValue:s.OrgName,"onUpdate:modelValue":f=>s.OrgName=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[7]||(a[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"w-auto",error:e.unref(N)[`project-${o}-Amount`],modelValue:s.Amount,"onUpdate:modelValue":f=>s.Amount=f},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[8]||(a[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(N)[`project-${o}-Description`],rows:"4",modelValue:s.Description,"onUpdate:modelValue":f=>s.Description=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[9]||(a[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(N)[`project-${o}-Benefit`],rows:"4",modelValue:s.Benefit,"onUpdate:modelValue":f=>s.Benefit=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,ia)])]))),128)),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:m,type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",pa,[e.createElementVNode("table",Va,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(N).Form4Before,rows:"4",modelValue:e.unref(c).Form4Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(c).Form4Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(N).Form4After,rows:"4",modelValue:e.unref(c).Form4After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(c).Form4After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",fa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ea={class:"block"},ba={class:"square-title"},ga={class:"text-teal fw-bold py-3"},ya={class:"table-responsive mb-0"},ka={class:"table align-middle gray-table"},ua={class:"text-end"},ha={class:"text-end"},xa={class:"text-end"},$a={class:"text-teal fw-bold pb-3"},Ba={class:"text-teal fw-bold pb-3"},_a={class:"mt-4"},Ca={class:"table align-middle gray-table"},Ta={class:"text-center"},wa={key:0,width:"180"},Da={class:"text-center"},Sa=["href"],Aa={key:0,class:"text-center"},Fa={key:0},Ua={key:1,class:"text-pink"},Pa={key:1,class:"tag-group mt-2 gap-1"},Ma={key:0,class:"tag tag-green-light"},Ia=["download","href"],ja=["onClick"],Oa={key:0,class:"block-bottom bg-light-teal"},La=["disabled"],Ra={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>c.value<=0||_.value.some(E=>!E.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!t.value||t.value.Status==="請款中"),r=e.computed(()=>{var E;return((E=t.value)==null?void 0:E.Status)==="通過"}),l=e.ref(0),t=e.ref(),m=e.ref({}),g=e.computed(()=>m.value.ApprovedAmount?Math.min(Math.round(c.value*100/m.value.ApprovedAmount*100)/100,100):0),b=e.computed(()=>r.value?Math.round(c.value*100/t.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:12,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),u=(E,n)=>{n.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:n.Path,Name:`${m.value.ProjectID}_第一期請款_${E.Title}.pdf`})},p=F.download,d=B,a=()=>{F.culture("getPayment",{ID:y.id}).subscribe(E=>{m.value=E.Project,j().init("culture",m.value),_.value=_.value.filter(n=>{var V;return!((V=n.Excludes)!=null&&V.includes(m.value.OrgCategory))}),_.value.forEach(n=>{n.Files=E.Attachments.filter(V=>V.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(V=>!V.Deleted).length)}),t.value=E.Payments.find(n=>n.Stage===1),t.value&&(c.value=t.value.TotalSpentAmount),l.value=Math.round(m.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),H().init(t.value)})},h=E=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((V,s)=>V.concat(s.Files),[]),Submit:E?"true":"false"};F.culture("savePayment",n).subscribe(V=>{V&&(E?d("next",a):a())})};return e.onMounted(a),e.provide("editable",N),(E,n)=>{var f;const V=e.resolveComponent("input-integer"),s=e.resolveComponent("required-label"),o=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ea,[e.createElementVNode("h5",ba,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",ga,"核定經費: "+e.toDisplayString((f=e.unref(m).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("div",ya,[e.createElementVNode("table",ka,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",ua,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",ha,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",xa,e.toDisplayString(e.unref(b)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",$a,"本期實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ba,"累積實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",_a,[e.createElementVNode("table",Ca,[e.createElementVNode("thead",Ta,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",wa,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",Da,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(N)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Sa)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Aa,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",Fa,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ua,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!k.Uploaded?(e.openBlock(),e.createBlock(o,{key:0,accept:".pdf",onFile:D=>u(k,D)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",Pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ma,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(p)(D.Path)},e.toDisplayString(D.Name),9,Ia),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>D.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ja)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",Oa,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>h(!0)),disabled:e.unref(i),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,La)])):e.createCommentVNode("",!0)],64)}}},qa={class:"block"},za={class:"square-title"},Ga={class:"text-teal fw-bold py-3"},Ja={class:"text-teal fw-bold pb-3"},Ya={class:"table-responsive mb-0"},Qa={class:"table align-middle gray-table"},Ha={class:"text-end"},Wa={class:"text-end"},Ka={class:"text-end"},Xa={class:"text-end"},Za={class:"text-teal fw-bold pb-3"},va={class:"text-teal fw-bold pb-3"},es={class:"mt-4"},ts={class:"table align-middle gray-table"},ls={class:"text-center"},os={key:0,width:"180"},ns={class:"text-center"},rs=["href"],as={key:0,class:"text-center"},ss={key:0},ds={key:1,class:"text-pink"},cs={key:1,class:"tag-group mt-2 gap-1"},is={key:0,class:"tag tag-green-light"},ms=["download","href"],ps=["onClick"],Vs={key:0,class:"block-bottom bg-light-teal"},fs=["disabled"],Ns={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>c.value<=0||d.value.some(s=>!s.Files.filter(o=>!o.Deleted).length)),N=e.computed(()=>!t.value||t.value.Status==="請款中"),r=e.computed(()=>{var s;return((s=t.value)==null?void 0:s.Status)==="通過"}),l=e.ref(0),t=e.ref(),m=e.ref(0),g=e.ref(0),b=e.ref({}),_=e.computed(()=>b.value.ApprovedAmount?Math.min(Math.round(c.value*100/b.value.ApprovedAmount*100)/100,100):0),u=e.computed(()=>p.value?Math.round(c.value*100/p.value*100)/100:0),p=e.computed(()=>g.value+(r.value?t.value.CurrentActualPaidAmount:0)),d=e.ref([{Type:21,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:22,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:23,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:24,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),a=(s,o)=>{o.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:o.Path,Name:`${b.value.ProjectID}_第二期請款_${s.Title}.pdf`})},h=F.download,E=B,n=()=>{F.culture("getPayment",{ID:y.id}).subscribe(s=>{b.value=s.Project,j().init("culture",b.value),d.value=d.value.filter(f=>{var k;return!((k=f.Excludes)!=null&&k.includes(b.value.OrgCategory))}),d.value.forEach(f=>{f.Files=s.Attachments.filter(k=>k.Type===f.Type),f.Uploaded=e.computed(()=>f.Files.filter(k=>!k.Deleted).length)}),t.value=s.Payments.find(f=>f.Stage===2),t.value&&(c.value=t.value.TotalSpentAmount),l.value=b.value.ApprovedAmount;const o=s.Payments.filter(f=>f.Stage<2&&f.Status==="通過");m.value=o.reduce((f,k)=>f+k.CurrentRequestAmount,0),g.value=o.reduce((f,k)=>f+k.CurrentActualPaidAmount,0),H().init(t.value,g.value)})},V=s=>{const o={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:d.value.reduce((f,k)=>f.concat(k.Files),[]),Submit:s?"true":"false"};F.culture("savePayment",o).subscribe(f=>{f&&(s?E("next",n):n())})};return e.onMounted(n),e.provide("editable",N),(s,o)=>{var D;const f=e.resolveComponent("input-integer"),k=e.resolveComponent("required-label"),S=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",qa,[e.createElementVNode("h5",za,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Ga,"核定經費: "+e.toDisplayString((D=e.unref(b).ApprovedAmount)==null?void 0:D.toLocaleString())+"元",1),e.createElementVNode("p",Ja,"賸餘款: "+e.toDisplayString((e.unref(b).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Ya,[e.createElementVNode("table",Qa,[o[3]||(o[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Ha,e.toDisplayString(e.unref(c)-e.unref(m)),1),e.createElementVNode("td",Wa,e.toDisplayString(e.unref(g)),1),e.createElementVNode("td",null,[e.createVNode(f,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":o[0]||(o[0]=T=>e.isRef(c)?c.value=T:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Ka,e.toDisplayString(e.unref(_))+"%",1),e.createElementVNode("td",Xa,e.toDisplayString(e.unref(u))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Za,"本期實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",va,"累積實際撥款: "+e.toDisplayString(e.unref(p).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),o[9]||(o[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),o[10]||(o[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",es,[e.createElementVNode("table",ts,[e.createElementVNode("thead",ls,[e.createElementVNode("tr",null,[o[4]||(o[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),o[5]||(o[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",os,"狀態")):e.createCommentVNode("",!0),o[6]||(o[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(T,C)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",ns,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(k,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Title),1)]),_:2},1024)]),e.unref(N)&&T.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:T.Template,style:{width:"140px"},type:"button"},[...o[7]||(o[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,rs)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",as,[T.Uploaded?(e.openBlock(),e.createElementBlock("span",ss,"已上傳")):(e.openBlock(),e.createElementBlock("span",ds,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!T.Uploaded?(e.openBlock(),e.createBlock(S,{key:0,accept:".pdf",onFile:A=>a(T,A)},null,8,["onFile"])):e.createCommentVNode("",!0),T.Uploaded?(e.openBlock(),e.createElementBlock("div",cs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",is,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(h)(A.Path)},e.toDisplayString(A.Name),9,ms),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:w=>A.Deleted=!0,type:"button"},[...o[8]||(o[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ps)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",Vs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[1]||(o[1]=T=>V()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[2]||(o[2]=T=>V(!0)),disabled:e.unref(i),type:"button"},[...o[11]||(o[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,fs)])):e.createCommentVNode("",!0)],64)}}},Es={class:"block rounded-top-4"},bs={class:"horizontal-scrollable"},gs={class:"timeline"},ys={class:"year"},ks={class:"month"},us=["onClick"],hs={class:"square-title"},xs={class:"table-responsive mt-4"},$s={class:"table align-middle gray-table"},Bs={class:"text-end"},_s={class:"table-responsive"},Cs={class:"table align-middle gray-table"},Ts={class:"text-end"},ws={key:0,class:"invalid mt-0"},Ds={class:"mt-3"},Ss={class:"mt-3"},As=["rowspan"],Fs={key:0,class:"block-bottom bg-light-teal"},Us={__name:"Progress",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],c=x,i=e.ref(),N=e.ref({}),r=e.ref(0),l=e.ref({}),t=e.ref([]),m=e.ref({}),g=e.computed(()=>Math.round((r.value+t.value.filter(E=>E.Status===3).length)*100/b.value.length*10)/10),b=e.ref([]),_=e.ref([]),u=E=>{i.value=E,d()},p=B,d=()=>{F.culture("getMonthlyProgress",{ID:c.id,Year:i.value.year-1911,Month:i.value.month}).subscribe(E=>{const n=E.Logs,V=E.Items,s=E.Steps;let o=!1;r.value=0,m.value=E.Progress,b.value=E.Schedules,t.value=[],_.value.forEach(f=>{f.months.forEach(k=>{o||(k===i.value&&(o=!0),b.value.forEach(S=>{var D,T;if(S.Month===k.month)if(o||S.Status!==3){const C=n.find(A=>A.ScheduleID===S.ID)||{ScheduleID:S.ID,Status:S.Status};t.value.push(Object.assign(C,{Year:f.year,Month:S.Month,ItemTitle:(D=V.find(A=>A.ID===S.ItemID))==null?void 0:D.Title,Type:S.Type,StepTitle:(T=s.find(A=>A.ID===S.StepID))==null?void 0:T.Title}))}else r.value++}))})})})},a=E=>{if(N.value={},E&&!h()){e.nextTick(()=>{var V;return(V=document.querySelector(".invalid"))==null?void 0:V.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={ID:m.value.ID,Description:m.value.Description||"",Status:E?1:0,Logs:t.value.map(V=>({ID:V.ID||0,ScheduleID:V.ScheduleID,Status:V.Status,DelayReason:V.DelayReason||"",ImprovedWay:V.ImprovedWay||""}))};F.culture("saveMonthlyProgress",n).subscribe(V=>{V&&E&&p("next")})},h=()=>{let E={Description:"實際工作執行情形"};return N.value=I(m.value,E),t.value.forEach((n,V)=>{E={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(n.Status)&&(E.DelayReason="落後原因",E.ImprovedWay="改善措施"),Object.assign(N.value,I(n,E,`item-${V}-`))}),!Object.keys(N.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.culture("getApplication",{ID:c.id}),F.culture("getSubmitedMonthlyProgress",{ID:c.id})]).subscribe(E=>{l.value=E[0].Project,j().init("culture",l.value);const n=new Date(l.value.StartTime),V=new Date(l.value.EndTime),s=Date.now();for(;;){const k=n.getFullYear(),S=n.getMonth(),D={year:k,month:S+1,disabled:new Date(k,S,20).getTime()>s};let T=_.value.find(C=>C.year===k);if(T?T.months.push(D):_.value.push({year:k,months:[D]}),k*100+S>=V.getFullYear()*100+V.getMonth())break;n.setMonth(S+1)}let o=!1;const f=E[1].List;_.value.forEach(k=>{k.months.forEach(S=>{!o&&!f.some(D=>D.Year===S.year-1911&&D.Month===S.month)&&(o=!0,u(S))})}),o||u(_.value[0].months[0])})}),(E,n)=>{const V=e.resolveComponent("input-textarea"),s=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Es,[e.createElementVNode("div",bs,[n[3]||(n[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),o=>(e.openBlock(),e.createElementBlock("li",{key:o},[e.createElementVNode("span",ys,e.toDisplayString(o.year-1911)+"年",1),e.createElementVNode("ul",ks,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.months,f=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(i)===f,disabled:f.disabled}),key:f},[e.createElementVNode("a",{onClick:k=>u(f),href:"javascript:void(0)"},e.toDisplayString(f.month)+"月",9,us)],2))),128))])]))),128))]),n[4]||(n[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",hs,e.toDisplayString(e.unref(i).year-1911)+"年"+e.toDisplayString(e.unref(i).month)+"月 實際進度",1),e.createElementVNode("div",xs,[e.createElementVNode("table",$s,[n[5]||(n[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Bs,e.toDisplayString(e.unref(i).year-1911)+"年"+e.toDisplayString(e.unref(i).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(N).Description,rows:"4",modelValue:e.unref(m).Description,"onUpdate:modelValue":n[0]||(n[0]=o=>e.unref(m).Description=o),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",_s,[e.createElementVNode("table",Cs,[n[8]||(n[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(o,f)=>(e.openBlock(),e.createElementBlock("tr",{key:o},[e.createElementVNode("th",Ts,e.toDisplayString(o.Year-1911)+"年"+e.toDisplayString(o.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(o.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(o.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(o.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(s,{options:y,modelValue:o.Status,"onUpdate:modelValue":k=>o.Status=k},null,8,["modelValue","onUpdate:modelValue"]),e.unref(N)[`item-${f}-Status`]?(e.openBlock(),e.createElementBlock("div",ws,e.toDisplayString(e.unref(N)[`item-${f}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(o.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",Ds,[n[6]||(n[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(V,{error:e.unref(N)[`item-${f}-DelayReason`],rows:"1",modelValue:o.DelayReason,"onUpdate:modelValue":k=>o.DelayReason=k,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ss,[n[7]||(n[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(V,{error:e.unref(N)[`item-${f}-ImprovedWay`],rows:"1",modelValue:o.ImprovedWay,"onUpdate:modelValue":k=>o.ImprovedWay=k,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),f?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(t).length},e.toDisplayString(e.unref(g))+"% ",9,As))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Fs,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=o=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=o=>a(!0)),type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ps={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const i=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(i,{steps:B,type:"culture"})}}},ne=(x,B)=>{const y=x.__vccOpts||x;for(const[c,i]of B)y[c]=i;return y},Ms={class:"block"},Is={class:"mt-4"},js={class:"table align-middle gray-table side-table"},Os={key:0,class:"d-flex align-items-center gap-2"},Ls={class:"input-group w-auto"},Rs={class:"text-teal-dark"},qs={key:1,class:"invalid mt-0"},zs={class:"square-title mt-4"},Gs={class:"mt-4"},Js=["onClick"],Ys={class:"d-flex flex-column gap-2"},Qs={class:"mt-4 d-flex flex-column gap-2"},Hs={class:"d-flex flex-column gap-3 mt-4"},Ws={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Ks={class:"d-flex gap-2 align-items-center flex-grow-1"},Xs={class:"text-nowrap"},Zs={class:"flex-grow-1"},vs={class:"d-flex gap-2"},ed=["onClick"],td=["href"],ld=["id"],od={class:"table align-middle gray-table side-table mb-0"},nd={class:"p-0"},rd={class:"item-list"},ad={class:"mt-2 align-self-start text-center"},sd={class:"input-group"},dd={key:0,class:"invalid mt-0"},cd={key:0,class:"d-flex gap-2 mt-1 align-self-start"},id=["onClick"],md=["onClick"],pd={class:"row"},Vd={class:"col"},fd=["value"],Nd={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Ed=["onClick"],bd=["onClick"],gd={class:"col"},yd=["value"],kd={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},ud=["onClick"],hd=["onClick"],xd=["onClick"],$d={class:"mt-4"},Bd={class:"table align-middle gray-table side-table"},_d={key:0,class:"block-bottom bg-light-teal"},Cd=ne({__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("culture",t.value.Status,2)),N=e.computed(()=>g.value.PlanEndDate),r=e.ref({}),l=e.computed(()=>m.value.filter(f=>!f.Deleted)),t=e.ref({}),m=e.ref([]),g=e.ref({}),b=()=>{F.culture("createGoal",{ID:y.id}).subscribe(f=>{m.value.push(Object.assign(f,{Items:[]}));const k=m.value[m.value.length-1];_(k)})},_=f=>{F.culture("createGoalItem",{ID:y.id,GoalID:f.ID}).subscribe(k=>{f.Items.push(Object.assign(k,{Steps:[],Schedules:[]}));const S=f.Items[f.Items.length-1];p(S),p(S),p(S),u(S,1),u(S,2)})},u=(f,k)=>F.culture("createGoalSchedule",{ID:y.id,ItemID:f.ID,Type:k}).subscribe(S=>f.Schedules.push(S)),p=f=>F.culture("createGoalStep",{ID:y.id,ItemID:f.ID}).subscribe(k=>f.Steps.push(k)),d=B,a=()=>{rxjs.forkJoin([F.culture("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(f=>{const k=f[0];t.value=k.Project,m.value=k.Goals,g.value=k.GrantType,m.value.length||b(),j().init("culture",t.value),c.value=t.value.changeApply,t.value.changeApply=void 0})},h=f=>f.Deleted=!0,E=f=>f.Deleted=!0,n=f=>f.Deleted=!0,V=f=>f.Deleted=!0,s=f=>{var S,D;if(r.value={},f&&!o()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}const k={Project:t.value,Goals:m.value,Before:(S=c.value)==null?void 0:S.Form2Before,After:(D=c.value)==null?void 0:D.Form2After,Submit:f?"true":"false"};F.culture("saveWorkSchedule",k).subscribe(()=>{f?d("next"):a()})},o=()=>{let f={StartTime:"計畫期程",EndTime:"計畫期程"};r.value=I(t.value,f);const k={Title:"計畫目標",Content:"預期效益"},S={Title:"重要工作項目",Indicator:"績效指標"},D={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},T={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return m.value.filter(C=>!C.Deleted).forEach((C,A)=>{Object.assign(r.value,I(C,k,`goal-${A}-`)),C.Items.filter(w=>!w.Deleted).forEach((w,P)=>{Object.assign(r.value,I(w,S,`item-${A}-${P}-`)),w.Steps.filter(U=>!U.Deleted).forEach((U,L)=>Object.assign(r.value,I(U,D,`step-${A}-${P}-${L}-`))),w.Schedules.filter(U=>U.Type===1&&!U.Deleted).forEach((U,L)=>Object.assign(r.value,I(U,T,`schedule-${A}-${P}-1-${L}-`))),w.Schedules.filter(U=>U.Type===2&&!U.Deleted).forEach((U,L)=>Object.assign(r.value,I(U,T,`schedule-${A}-${P}-2-${L}-`)))})}),c.value&&(f={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(r.value,I(c.value,f))),!Object.keys(r.value).length};return e.onMounted(a),e.provide("editable",i),(f,k)=>{const S=e.resolveComponent("required-label"),D=e.resolveComponent("input-tw-date"),T=e.resolveComponent("tw-date"),C=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),w=e.resolveComponent("input-month"),P=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ms,[k[30]||(k[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Is,[e.createElementVNode("table",js,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[6]||(k[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",Os,[e.createElementVNode("div",Ls,[e.createVNode(D,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(t).StartTime,"onUpdate:modelValue":k[0]||(k[0]=U=>e.unref(t).StartTime=U)},null,8,["max-date","modelValue"]),k[7]||(k[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(D,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(t).EndTime,"onUpdate:modelValue":k[1]||(k[1]=U=>e.unref(t).EndTime=U)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Rs,[k[8]||(k[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(T,{value:e.unref(N)},null,8,["value"]),k[9]||(k[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(r).StartTime||e.unref(r).EndTime?(e.openBlock(),e.createElementBlock("div",qs,e.toDisplayString(e.unref(r).StartTime||e.unref(r).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",zs,[k[11]||(k[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:b,type:"button"},[...k[10]||(k[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(U,L)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:U},[e.unref(i)&&e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:O=>h(U),type:"button"},"刪除",8,Js)):e.createCommentVNode("",!0),e.createElementVNode("div",Ys,[k[12]||(k[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(C,{error:e.unref(r)[`goal-${L}-Title`],modelValue:U.Title,"onUpdate:modelValue":O=>U.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Qs,[k[13]||(k[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(A,{error:e.unref(r)[`goal-${L}-Content`],rows:"4",modelValue:U.Content,"onUpdate:modelValue":O=>U.Content=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Hs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(U.Items.filter(O=>!O.Deleted),(O,Y)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:O},[e.createElementVNode("div",Ws,[e.createElementVNode("div",Ks,[e.createElementVNode("label",Xs,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[14]||(k[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",Zs,[e.createVNode(C,{error:e.unref(r)[`item-${L}-${Y}-Title`],modelValue:O.Title,"onUpdate:modelValue":R=>O.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",vs,[e.unref(i)&&U.Items.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(R=>E(O),["prevent"]),href:"#"},"刪除",8,ed)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${Y}`,role:"button"},"收合",8,td)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${Y}`},[e.createElementVNode("table",od,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[15]||(k[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",nd,[e.createElementVNode("ul",rd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Steps.filter(R=>!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(i)}]),key:R},[e.createElementVNode("div",ad,e.toDisplayString(String.fromCharCode(65+Q)),1),e.createElementVNode("div",null,[e.createVNode(C,{error:e.unref(r)[`step-${L}-${Y}-${Q}-Title`],placeholder:"如:進行口訪紀錄",modelValue:R.Title,"onUpdate:modelValue":M=>R.Title=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",sd,[e.createVNode(w,{"empty-value":0,modelValue:R.Begin,"onUpdate:modelValue":M=>R.Begin=M},null,8,["modelValue","onUpdate:modelValue"]),k[16]||(k[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(w,{"empty-value":0,modelValue:R.End,"onUpdate:modelValue":M=>R.End=M},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(r)[`step-${L}-${Y}-${Q}-Begin`]||e.unref(r)[`step-${L}-${Y}-${Q}-End`]?(e.openBlock(),e.createElementBlock("div",dd,e.toDisplayString(e.unref(r)[`step-${L}-${Y}-${Q}-Begin`]||e.unref(r)[`step-${L}-${Y}-${Q}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",cd,[O.Steps.filter(M=>!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>V(R),type:"button"},[...k[17]||(k[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,id)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>p(O),type:"button"},[...k[18]||(k[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,md)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[19]||(k[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(r)[`item-${L}-${Y}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:O.Indicator,"onUpdate:modelValue":R=>O.Indicator=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[20]||(k[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",pd,[e.createElementVNode("div",Vd,[k[23]||(k[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(R=>R.Type===1&&!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:R},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(i)?3:4}`])},[e.createVNode(w,{error:e.unref(r)[`schedule-${L}-${Y}-1-${Q}-Month`],"empty-value":0,modelValue:R.Month,"onUpdate:modelValue":M=>R.Month=M},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(i)?7:8}`])},[e.createVNode(P,{"empty-value":0,error:e.unref(r)[`schedule-${L}-${Y}-1-${Q}-StepID`],options:O.Steps.filter(M=>!M.Deleted),modelValue:R.StepID,"onUpdate:modelValue":M=>R.StepID=M},{default:e.withCtx(({index:M,option:G})=>[e.createElementVNode("option",{value:G.ID},e.toDisplayString(String.fromCharCode(65+M))+"."+e.toDisplayString(G.Title),9,fd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Nd,[O.Schedules.filter(M=>M.Type===1&&!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>n(R),type:"button"},[...k[21]||(k[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ed)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>u(O,1),type:"button"},[...k[22]||(k[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,bd)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",gd,[k[26]||(k[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(R=>R.Type===2&&!R.Deleted),(R,Q)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:R},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(i)?3:4}`])},[e.createVNode(w,{error:e.unref(r)[`schedule-${L}-${Y}-2-${Q}-Month`],"empty-value":0,modelValue:R.Month,"onUpdate:modelValue":M=>R.Month=M},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(i)?7:8}`])},[e.createVNode(P,{"empty-value":0,error:e.unref(r)[`schedule-${L}-${Y}-2-${Q}-StepID`],options:O.Steps.filter(M=>!M.Deleted),modelValue:R.StepID,"onUpdate:modelValue":M=>R.StepID=M},{default:e.withCtx(({index:M,option:G})=>[e.createElementVNode("option",{value:G.ID},e.toDisplayString(String.fromCharCode(65+M))+"."+e.toDisplayString(G.Title),9,yd)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(i)?(e.openBlock(),e.createElementBlock("div",kd,[O.Schedules.filter(M=>M.Type===2&&!M.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>n(R),type:"button"},[...k[24]||(k[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ud)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:M=>u(O,2),type:"button"},[...k[25]||(k[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,hd)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,ld)]))),128))]),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:O=>_(U),type:"button"},"新增工作項目",8,xd)):e.createCommentVNode("",!0)]))),128))]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[k[29]||(k[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",$d,[e.createElementVNode("table",Bd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[27]||(k[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(r).Form2Before,rows:"4",modelValue:e.unref(c).Form2Before,"onUpdate:modelValue":k[2]||(k[2]=U=>e.unref(c).Form2Before=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(S,null,{default:e.withCtx(()=>[...k[28]||(k[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(r).Form2After,rows:"4",modelValue:e.unref(c).Form2After,"onUpdate:modelValue":k[3]||(k[3]=U=>e.unref(c).Form2After=U),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",_d,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:k[4]||(k[4]=U=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[5]||(k[5]=U=>s(!0)),type:"button"},[...k[31]||(k[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-988b407a"]]),Td={class:"block"},wd={class:"mt-4"},Dd={class:"table align-middle gray-table side-table"},Sd={key:0},Ad={key:1,class:"text-light-gray"},Fd={class:"d-flex flex-column gap-2"},Ud={key:0},Pd={class:"mt-4"},Md={class:"table align-middle gray-table side-table"},Id={class:"row g-3"},jd={class:"col-12 col-xl-2"},Od={class:"text-gray mb-2"},Ld={class:"col-12 col-xl-3"},Rd={class:"text-gray mb-2"},qd={key:0,class:"col-12 col-xl-4"},zd={class:"row g-1"},Gd={class:"col-7"},Jd={class:"col-5"},Yd={key:1,class:"col-12 col-xl-3"},Qd={class:"text-gray mb-2"},Hd={class:"mt-4"},Wd={class:"table align-middle gray-table side-table"},Kd={class:"d-flex align-items-center gap-2"},Xd={class:"input-group w-auto"},Zd={key:0,class:"invalid mt-0"},vd={class:"mt-4"},ec={class:"table-responsive mt-3 mb-0"},tc={class:"table align-middle gray-table"},lc={class:"text-end"},oc={class:"text-end"},nc={class:"text-end"},rc={class:"text-end"},ac={class:"text-end"},sc={class:"text-end"},dc={class:"table-responsive"},cc={class:"table align-middle gray-table"},ic=["colspan"],mc={key:0,width:"1"},pc={class:"text-end"},Vc={key:0},fc={class:"d-flex gap-2"},Nc=["onClick"],Ec={class:"mt-4"},bc={class:"table-responsive mt-3 mb-0"},gc={class:"table align-middle gray-table"},yc={key:0,width:"1"},kc={class:"text-end"},uc={key:0},hc={class:"d-flex gap-2"},xc=["onClick"],$c={class:"table align-middle gray-table side-table"},Bc={key:0,class:"table-responsive mt-3 mb-0"},_c={class:"table align-middle gray-table"},Cc={key:0},Tc={key:0},wc={class:"d-flex gap-2"},Dc=["onClick"],Sc={class:"mt-4"},Ac={class:"table align-middle gray-table side-table"},Fc={key:0,class:"block-bottom bg-light-teal"},Uc={class:"text-center"},Pc={class:"mb-5"},Mc={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.ref(),r=e.computed(()=>J("education",b.value.Status,1)),l=e.ref({}),t=e.computed(()=>u.value.filter(T=>!T.Deleted)),m=e.computed(()=>p.value.filter(T=>!T.Deleted)),g=e.computed(()=>d.value.filter(T=>!T.Deleted)),b=e.ref({}),_=e.ref(),u=e.ref([]),p=e.ref([]),d=e.ref([]),a=e.ref(),h=e.ref(0),E=e.computed({get:()=>!!g.value.length,set:T=>{T?n():d.value.forEach(C=>C.Deleted=!0)}}),n=()=>d.value.push({}),V=()=>u.value.push({}),s=()=>p.value.push({}),o=B,f=()=>{F.education("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(T=>{b.value=T.Project,N.value=T.Contacts,u.value=T.OtherSubsidies||[],p.value=T.BudgetPlans||[],d.value=T.ReceivedSubsidies,b.value.OrgCategory=b.value.OrgCategory||null,p.value.length||s(),j().init("education",b.value),i.value=b.value.changeApply,b.value.changeApply=void 0})},k=T=>T.Deleted=!0,S=(T,C)=>{var w,P;if(l.value={},T&&!D()){e.nextTick(()=>{var U;return(U=document.querySelector(".invalid"))==null?void 0:U.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!C&&a.value&&b.value.ApplyAmount>a.value.GrantLimit*1e4){_.value.show(()=>S(T,!0));return}const A={Project:b.value,Contacts:N.value,OtherSubsidies:u.value,BudgetPlans:p.value,ReceivedSubsidies:d.value.filter(U=>U.ID||!U.Deleted),Before:(w=i.value)==null?void 0:w.Form1Before,After:(P=i.value)==null?void 0:P.Form1After,Submit:T?"true":"false"};F.education("saveApplication",A).subscribe(U=>{T?o("next",U.ID):b.value.ID?f():window.location.href=`Application.aspx?ID=${U.ID}`})},D=()=>{let T={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return b.value.OrgCategory==="2"&&(T.RegisteredNum="立案登記證字號"),l.value=I(b.value,T),T={Name:"姓名",JobTitle:"職稱"},Object.assign(l.value,I(N.value[0],T,"contact-0-")),T.MobilePhone="手機號碼",Object.assign(l.value,I(N.value[1],T,"contact-1-")),T={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},t.value.forEach((C,A)=>Object.assign(l.value,I(C,T,`other-${A}-`))),T={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},m.value.forEach((C,A)=>Object.assign(l.value,I(C,T,`plan-${A}-`))),T={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},d.value.forEach((C,A)=>Object.assign(l.value,I(C,T,`received-${A}-`))),i.value&&(T={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,I(i.value,T))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(T=>{c.value=T[0],y.id?f():F.education("getEmptyApplication").subscribe(C=>{b.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},C),N.value=[{Role:"負責人"},{Role:"聯絡人"}],s(),j().init("education",b.value)})})}),e.provide("editable",r),e.watch(()=>b.value.OrgCategory,()=>{F.education("getGrantTargetSetting",{TargetTypeID:`EDC${b.value.OrgCategory}`}).subscribe(T=>{a.value=T})}),e.watchEffect(()=>{b.value.OtherUnitAmount=t.value.reduce((T,C)=>T+q(C.Amount),0),h.value=q(b.value.ApplyAmount)+q(b.value.SelfAmount)+q(b.value.OtherGovAmount)+q(b.value.OtherUnitAmount),t.value.forEach(T=>T.percent=Math.round(q(T.Amount)/b.value.OtherUnitAmount*1e4)/100),p.value.forEach(T=>T.sum=q(T.Amount)+q(T.OtherAmount))}),(T,C)=>{var Q;const A=e.resolveComponent("required-label"),w=e.resolveComponent("input-text"),P=e.resolveComponent("input-select"),U=e.resolveComponent("input-tw-date"),L=e.resolveComponent("input-textarea"),O=e.resolveComponent("input-integer"),Y=e.resolveComponent("input-boolean"),R=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Td,[C[66]||(C[66]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",wd,[e.createElementVNode("table",Dd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[C[19]||(C[19]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).Year),1)]),e.createElementVNode("tr",null,[C[20]||(C[20]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(b).ProjectID?(e.openBlock(),e.createElementBlock("span",Sd,e.toDisplayString(e.unref(b).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Ad,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[C[21]||(C[21]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(b).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[22]||(C[22]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l).ProjectName,modelValue:e.unref(b).ProjectName,"onUpdate:modelValue":C[0]||(C[0]=M=>e.unref(b).ProjectName=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[23]||(C[23]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Fd,[e.createElementVNode("div",null,[e.createVNode(P,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(b).OrgCategory,"onUpdate:modelValue":C[1]||(C[1]=M=>e.unref(b).OrgCategory=M)},null,8,["error","options","modelValue"])]),e.unref(b).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",Ud,[e.createVNode(w,{error:e.unref(l).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(b).RegisteredNum,"onUpdate:modelValue":C[2]||(C[2]=M=>e.unref(b).RegisteredNum=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[24]||(C[24]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l).OrgName,placeholder:"請輸入單位全銜",modelValue:e.unref(b).OrgName,"onUpdate:modelValue":C[3]||(C[3]=M=>e.unref(b).OrgName=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[25]||(C[25]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(b).TaxID,"onUpdate:modelValue":C[4]||(C[4]=M=>e.unref(b).TaxID=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[26]||(C[26]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(b).Address,"onUpdate:modelValue":C[5]||(C[5]=M=>e.unref(b).Address=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),C[67]||(C[67]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Pd,[e.createElementVNode("table",Md,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(M.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Id,[e.createElementVNode("div",jd,[e.createElementVNode("div",Od,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[27]||(C[27]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(l)[`contact-${G}-Name`],modelValue:M.Name,"onUpdate:modelValue":z=>M.Name=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ld,[e.createElementVNode("div",Rd,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[28]||(C[28]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(l)[`contact-${G}-JobTitle`],modelValue:M.JobTitle,"onUpdate:modelValue":z=>M.JobTitle=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),G?(e.openBlock(),e.createElementBlock("div",qd,[C[29]||(C[29]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",zd,[e.createElementVNode("div",Gd,[e.createVNode(w,{modelValue:M.Phone,"onUpdate:modelValue":z=>M.Phone=z,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Jd,[e.createVNode(w,{placeholder:"請輸入分機",size:"4",modelValue:M.PhoneExt,"onUpdate:modelValue":z=>M.PhoneExt=z,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),G?(e.openBlock(),e.createElementBlock("div",Yd,[e.createElementVNode("div",Qd,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[30]||(C[30]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(l)[`contact-${G}-MobilePhone`],modelValue:M.MobilePhone,"onUpdate:modelValue":z=>M.MobilePhone=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),C[68]||(C[68]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Hd,[e.createElementVNode("table",Wd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[31]||(C[31]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Kd,[e.createElementVNode("div",Xd,[e.createVNode(U,{class:"w-auto",modelValue:e.unref(b).StartTime,"onUpdate:modelValue":C[6]||(C[6]=M=>e.unref(b).StartTime=M)},null,8,["modelValue"]),C[32]||(C[32]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(U,{class:"w-auto",modelValue:e.unref(b).EndTime,"onUpdate:modelValue":C[7]||(C[7]=M=>e.unref(b).EndTime=M)},null,8,["modelValue"])]),C[33]||(C[33]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",Zd,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[34]||(C[34]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l).Target,modelValue:e.unref(b).Target,"onUpdate:modelValue":C[8]||(C[8]=M=>e.unref(b).Target=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[35]||(C[35]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(b).Summary,"onUpdate:modelValue":C[9]||(C[9]=M=>e.unref(b).Summary=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[36]||(C[36]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(b).Quantified,"onUpdate:modelValue":C[10]||(C[10]=M=>e.unref(b).Quantified=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),C[69]||(C[69]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",vd,[C[49]||(C[49]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",ec,[e.createElementVNode("table",tc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",lc,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[37]||(C[37]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",oc,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[38]||(C[38]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款(元)",-1)])]),_:1})]),e.createElementVNode("th",nc,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[39]||(C[39]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元)",-1)])]),_:1})]),e.createElementVNode("th",rc,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[40]||(C[40]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費(元) (含總收費)",-1)])]),_:1})]),C[41]||(C[41]=e.createElementVNode("th",{class:"text-end"},"計畫總經費(元)",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l).ApplyAmount,modelValue:e.unref(b).ApplyAmount,"onUpdate:modelValue":C[11]||(C[11]=M=>e.unref(b).ApplyAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l).SelfAmount,modelValue:e.unref(b).SelfAmount,"onUpdate:modelValue":C[12]||(C[12]=M=>e.unref(b).SelfAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l).OtherGovAmount,modelValue:e.unref(b).OtherGovAmount,"onUpdate:modelValue":C[13]||(C[13]=M=>e.unref(b).OtherGovAmount=M)},null,8,["error","modelValue"])]),e.createElementVNode("td",ac,e.toDisplayString((Q=e.unref(b).OtherUnitAmount)==null?void 0:Q.toLocaleString()),1),e.createElementVNode("td",sc,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),C[50]||(C[50]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},null,-1)),e.createElementVNode("div",dc,[e.createElementVNode("table",cc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(r)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,ic)]),e.createElementVNode("tr",null,[C[42]||(C[42]=e.createElementVNode("th",{width:"1"},null,-1)),C[43]||(C[43]=e.createElementVNode("th",null,"單位名稱",-1)),C[44]||(C[44]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),C[45]||(C[45]=e.createElementVNode("th",null,"比例",-1)),C[46]||(C[46]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",mc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,e.toDisplayString(G+1),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l)[`other-${G}-Unit`],modelValue:M.Unit,"onUpdate:modelValue":z=>M.Unit=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l)[`other-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",pc,e.toDisplayString(M.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l)[`other-${G}-Content`],rows:"1",modelValue:M.Content,"onUpdate:modelValue":z=>M.Content=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Vc,[e.createElementVNode("div",fc,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...C[47]||(C[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Nc)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:V,type:"button"},[...C[48]||(C[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),C[70]||(C[70]=e.createElementVNode("h5",{class:"square-title mt-5"},"經費預算規劃",-1)),e.createElementVNode("div",Ec,[e.createElementVNode("div",bc,[e.createElementVNode("table",gc,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[C[51]||(C[51]=e.createElementVNode("th",null,"預算項目",-1)),C[52]||(C[52]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),C[53]||(C[53]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),C[54]||(C[54]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),C[55]||(C[55]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",yc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l)[`plan-${G}-Title`],modelValue:M.Title,"onUpdate:modelValue":z=>M.Title=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l)[`plan-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l)[`plan-${G}-OtherAmount`],modelValue:M.OtherAmount,"onUpdate:modelValue":z=>M.OtherAmount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",kc,e.toDisplayString(M.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l)[`plan-${G}-Description`],rows:"1",modelValue:M.Description,"onUpdate:modelValue":z=>M.Description=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",uc,[e.createElementVNode("div",hc,[e.unref(m).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...C[56]||(C[56]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xc)):e.createCommentVNode("",!0),G+1===e.unref(m).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...C[57]||(C[57]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.createElementVNode("table",$c,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[58]||(C[58]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(Y,{modelValue:e.unref(E),"onUpdate:modelValue":C[14]||(C[14]=M=>e.isRef(E)?E.value=M:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Bc,[e.createElementVNode("table",_c,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[C[59]||(C[59]=e.createElementVNode("th",null,"計畫名稱",-1)),C[60]||(C[60]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Cc,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(g),(M,G)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(l)[`received-${G}-Name`],modelValue:M.Name,"onUpdate:modelValue":z=>M.Name=z,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(O,{error:e.unref(l)[`received-${G}-Amount`],modelValue:M.Amount,"onUpdate:modelValue":z=>M.Amount=z},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Tc,[e.createElementVNode("div",wc,[e.unref(g).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:z=>k(M),type:"button"},[...C[61]||(C[61]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Dc)):e.createCommentVNode("",!0),G+1===e.unref(g).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:n,type:"button"},[...C[62]||(C[62]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[C[65]||(C[65]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Sc,[e.createElementVNode("table",Ac,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[63]||(C[63]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(i).Form1Before,"onUpdate:modelValue":C[15]||(C[15]=M=>e.unref(i).Form1Before=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...C[64]||(C[64]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(L,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(i).Form1After,"onUpdate:modelValue":C[16]||(C[16]=M=>e.unref(i).Form1After=M),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Fc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:C[17]||(C[17]=M=>S()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:C[18]||(C[18]=M=>S(!0)),type:"button"},[...C[71]||(C[71]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(R,{ref_key:"modal",ref:_},{default:e.withCtx(()=>{var M;return[e.createElementVNode("div",Uc,[C[72]||(C[72]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Pc,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((M=e.unref(a))==null?void 0:M.GrantLimit)+"萬",1),C[73]||(C[73]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),C[74]||(C[74]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},Ic={class:"block"},jc={key:0,class:"text-pink lh-base mt-4"},Oc={class:"mt-4"},Lc={class:"table align-middle gray-table"},Rc={class:"text-center"},qc={key:0,width:"180"},zc={class:"text-center"},Gc={key:0},Jc=["innerHTML"],Yc=["href"],Qc={key:0,class:"text-center"},Hc={key:0},Wc={key:1,class:"text-pink"},Kc={key:1,class:"tag-group mt-2 gap-1"},Xc={key:0,class:"tag tag-green-light"},Zc=["download","href"],vc=["onClick"],ei={key:1,class:"text-center mt-4"},ti={class:"mt-4"},li={class:"table align-middle gray-table side-table"},oi={key:0,class:"block-bottom bg-light-teal"},ni=["disabled"],ri={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateEDC.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"相關佐證資料",Comment:"(如：有效期間內之當選證書、核准登記設立證明等)",Files:[],Multiple:!0,Optional:!0}]),i=e.ref(),N=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>J("education",t.value.Status,2)),l=e.ref({}),t=e.ref({}),m=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:t.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},g=F.download,b=B,_=()=>{rxjs.forkJoin([F.education("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=c.value.filter(h=>{var E;return!((E=h.Excludes)!=null&&E.includes(t.value.OrgCategory))}),c.value.forEach(h=>{h.Files=a.Attachments.filter(E=>E.Type===h.Type),h.Uploaded=e.computed(()=>h.Files.filter(E=>!E.Deleted).length)}),j().init("education",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},u=d=>{var h,E;if(l.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,V)=>n.concat(V.Files),[]),Before:(h=i.value)==null?void 0:h.Form5Before,After:(E=i.value)==null?void 0:E.Form5After,Submit:d?"true":"false"};F.education("saveAttachment",a).subscribe(n=>{n&&(d?b("next",_):_())})},p=()=>{if(i.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,I(i.value,d))}return!Object.keys(l.value).length};return e.onMounted(_),e.provide("editable",r),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file"),n=e.resolveComponent("tw-date-time"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ic,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",jc,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如有效期間內之當選證書、核准登記設立證明等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Oc,[e.createElementVNode("table",Lc,[e.createElementVNode("thead",Rc,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",qc,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",zc,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",Gc,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,Jc)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Yc)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Qc,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",Hc,"已上傳")):(e.openBlock(),e.createElementBlock("span",Wc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:f=>m(s,f)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",Kc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Xc,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(g)(f.Path)},e.toDisplayString(f.Name),9,Zc),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>f.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,vc)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(t).ApplyTime?(e.openBlock(),e.createElementBlock("div",ei,[a[10]||(a[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(n,{value:e.unref(t).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ti,[e.createElementVNode("table",li,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(i).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(i).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(i).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(i).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",oi,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),disabled:e.unref(N),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,ni)])):e.createCommentVNode("",!0)],64)}}},ai={class:"block"},si={class:"square-title"},di={class:"text-teal fw-bold py-3"},ci={class:"text-teal fw-bold pb-3"},ii={class:"table-responsive mb-0"},mi={class:"table align-middle gray-table"},pi={class:"text-end"},Vi={class:"text-end"},fi={class:"text-end"},Ni={class:"text-teal fw-bold pb-3"},Ei={class:"text-teal fw-bold pb-3"},bi={class:"mt-4"},gi={class:"table align-middle gray-table"},yi={class:"text-center"},ki={key:0,width:"180"},ui={class:"text-center"},hi=["href"],xi={key:0,class:"text-center"},$i={key:0},Bi={key:1,class:"text-pink"},_i={key:1,class:"tag-group mt-2 gap-1"},Ci={key:0,class:"tag tag-green-light"},Ti=["download","href"],wi=["onClick"],Di={key:0,class:"block-bottom bg-light-teal"},Si=["disabled"],Ai={__name:"Payment",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>c.value<=0||_.value.some(E=>!E.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!t.value||t.value.Status==="請款中"),r=e.computed(()=>{var E;return((E=t.value)==null?void 0:E.Status)==="通過"}),l=e.ref(0),t=e.ref(),m=e.ref({}),g=e.computed(()=>m.value.ApprovedAmount?Math.min(Math.round(c.value*100/m.value.ApprovedAmount*100)/100,100):0),b=e.computed(()=>r.value?Math.round(c.value*100/t.value.CurrentActualPaidAmount*100)/100+"%":"--"),_=e.ref([{Type:11,Title:"收支明細表",Template:"../../Template/EDC/1-收支明細表.docx",Files:[]},{Type:12,Title:"受補助清單",Template:"../../Template/EDC/2-受補助清單.docx",Files:[]},{Type:13,Title:"經費分攤表",Template:"../../Template/EDC/3-經費分攤表.docx",Files:[]},{Type:14,Title:"憑證",Template:"../../Template/EDC/4-憑證.docx",Files:[]},{Type:15,Title:"領據",Template:"../../Template/EDC/5-領據.docx",Files:[]}]),u=(E,n)=>{n.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:n.Path,Name:`${m.value.ProjectID}_${E.Title}.pdf`})},p=F.download,d=B,a=()=>{F.education("getPayment",{ID:y.id}).subscribe(E=>{m.value=E.Project,j().init("education",m.value),_.value=_.value.filter(n=>{var V;return!((V=n.Excludes)!=null&&V.includes(m.value.OrgCategory))}),_.value.forEach(n=>{n.Files=E.Attachments.filter(V=>V.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(V=>!V.Deleted).length)}),t.value=E.Payments.find(n=>n.Stage===1),t.value&&(c.value=t.value.TotalSpentAmount),l.value=m.value.ApprovedAmount,H().init(t.value)})},h=E=>{const n={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((V,s)=>V.concat(s.Files),[]),Submit:E?"true":"false"};F.education("savePayment",n).subscribe(V=>{V&&(E?d("next",a):a())})};return e.onMounted(a),e.provide("editable",N),(E,n)=>{var f;const V=e.resolveComponent("input-integer"),s=e.resolveComponent("required-label"),o=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ai,[e.createElementVNode("h5",si,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",di,"核定經費: "+e.toDisplayString((f=e.unref(m).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("p",ci,"賸餘款: "+e.toDisplayString((e.unref(m).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",ii,[e.createElementVNode("table",mi,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",pi,e.toDisplayString(e.unref(c)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(l),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Vi,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",fi,e.toDisplayString(e.unref(b)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Ni,"本期實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ei,"累積實際撥款: "+e.toDisplayString(e.unref(t).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",bi,[e.createElementVNode("table",gi,[e.createElementVNode("thead",yi,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",ki,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",ui,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(N)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,hi)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",xi,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",$i,"已上傳")):(e.openBlock(),e.createElementBlock("span",Bi,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!k.Uploaded?(e.openBlock(),e.createBlock(o,{key:0,accept:".pdf",onFile:D=>u(k,D)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",_i,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ci,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(p)(D.Path)},e.toDisplayString(D.Name),9,Ti),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>D.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,wi)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",Di,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>h(!0)),disabled:e.unref(i),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Si)])):e.createCommentVNode("",!0)],64)}}},Fi={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const i=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(i,{steps:B,type:"education"})}}},Ui={class:"modal-dialog modal-dialog-centered modal-md"},Pi={class:"modal-content"},Mi={class:"modal-body"},Ii={class:"d-flex flex-column align-items-center mb-5 gap-3"},ji={class:"fs-18"},Oi={__name:"ErrorModal",setup(x){const B=ee(),y=e.ref();return e.onMounted(()=>y.value.addEventListener("hidden.bs.modal",()=>B.error=null)),e.watch(()=>B.error,()=>{B.error&&bootstrap.Modal.getOrCreateInstance(y.value).show()}),(c,i)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:y,tabindex:"-1"},[e.createElementVNode("div",Ui,[e.createElementVNode("div",Pi,[i[2]||(i[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Mi,[e.createElementVNode("div",Ii,[i[0]||(i[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",ji,e.toDisplayString(e.unref(B).error),1)]),i[1]||(i[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},v=W.defineStore("grant",{actions:{init(x){this.type=x}},state:()=>({type:null,typeList:[{code:"SCI",title:"科專"},{code:"CUL",title:"文化"},{code:"EDC",title:"學校／民間"},{code:"CLB",title:"學校社團"},{code:"MUL",title:"多元"},{code:"LIT",title:"素養"},{code:"ACC",title:"無障礙"}]})}),Li={key:0,class:"search bg-gray rounded-4 mt-4"},Ri={class:"search-form"},qi={class:"row g-3"},zi={class:"col-12 col-lg-6"},Gi={key:0,class:"rounded-4 bg-white mt-4 p-4"},Ji={class:"row"},Yi={class:"col-12"},Qi={class:"row"},Hi={class:"col-12 d-flex justify-content-between align-items-center pe-4"},Wi={class:"fw-bold text-primary fs-2"},Ki={key:1,class:"rounded-4 bg-white mt-4 py-4"},Xi={class:"row"},Zi={class:"col-12 col-lg-4"},vi={class:"col-12 col-lg-8"},em={key:2,class:"row"},tm={class:"col-12 col-lg-6 pt-4"},lm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},om={class:"fw-bold text-primary fs-2"},nm={class:"col-12 col-lg-6 pt-4"},rm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},am={class:"fw-bold text-primary fs-2"},sm={class:"col-12 col-lg-6 pt-4"},dm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},cm={class:"fw-bold text-primary fs-2"},im={class:"col-12 col-lg-6 pt-4"},mm={class:"d-flex justify-content-between align-items-center rounded-4 bg-white p-4"},pm={class:"fw-bold text-primary fs-2"},Vm={class:"rounded-4 bg-white p-4 mt-4 d-flex flex-column gap-3"},fm={class:"table-responsive"},Nm={class:"table align-middle gray-table"},Em={class:"text-center"},bm={class:"text-center"},gm=["href"],ym={class:"text-end"},km={class:"text-end"},um={class:"search bg-white rounded-4 mt-4"},hm={class:"table-responsive mt-4"},xm={class:"row"},$m={class:"col"},Bm=["value"],_m={class:"table teal-table","aria-label":"申請計畫列表"},Cm={"data-th":"年度:"},Tm={"data-th":"類別:",class:"text-start"},wm={"data-th":"補助計畫:"},Dm={"data-th":"申請期限:"},Sm={"data-th":"補助對象:"},Am={"data-th":"相關檔案:"},Fm=["download","href"],Um={"data-th":"我要申請:"},Pm=["href"],Mm={class:"search bg-white rounded-4 mt-4"},Im={class:"mt-4"},jm={key:0,class:"total-list mt-4"},Om=["href"],Lm={class:"total-item-title"},Rm={class:"total-item-content"},qm={class:"count"},zm={__name:"HomeDashboard",setup(x){const B=v().typeList,y=[{title:"申請中尚未提送",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(V=>[1,14].includes(V.Status)).length)},{title:"申請審查中",url:"ApplicationChecklist.aspx",count:e.computed(()=>c.value.filter(V=>[11,12,21,22,31,32,41,42,43,44].includes(V.Status)).length)},{title:"審查意見待回覆",url:"ApplicationChecklist.aspx?waitingReply=1",count:e.computed(()=>{var V;return((V=l.value.find(s=>s.Status===1))==null?void 0:V.Count)||0})},{title:"執行中計畫",url:"inprogressList.aspx",count:e.computed(()=>c.value.filter(V=>[51,52].includes(V.Status)).length)},{title:"執行階段待回覆",url:"inprogressList.aspx?pendingReply=1",count:e.computed(()=>{var V;return((V=l.value.find(s=>s.Status===2))==null?void 0:V.Count)||0})}],c=e.ref([]),i=e.ref([]),N=e.ref(),r=e.ref(),l=e.ref([]),t=e.ref(""),m=e.ref([]),g=e.ref([]),b=e.ref([]),_=e.ref(),u=e.computed(()=>{let V=i.value;return t.value&&(V=V.filter(s=>s.tags.includes(t.value))),V}),p=e.computed(()=>_.value?b.value.filter(V=>V.Category===_.value):b.value),d=e.computed(()=>({ApprovedAmount:p.value.reduce((V,s)=>V+s.ApprovedAmount,0),RemainingAmount:p.value.reduce((V,s)=>V+s.ApprovedAmount-s.SpendAmount,0),SpendAmount:p.value.reduce((V,s)=>V+s.SpendAmount,0),PaymentAmount:p.value.reduce((V,s)=>V+s.PaymentAmount,0),BudgetFees:p.value.reduce((V,s)=>V+s.BudgetFees,0)})),a=F.download,h=V=>g.value.filter(s=>s.GrantTypeID===V.TypeCode).map((s,o)=>`${o+1}.${s.Note}`).join("<br>"),E=V=>{switch(V.TypeCode){case"SCI":return`SCI/SciApplication.aspx?TypeID=${V.TypeID}`;case"CLB":return`CLB/ClbApplication.aspx?TypeID=${V.TypeID}`;default:return`${V.TypeCode}/Application.aspx`}},n=(V,s,o=2)=>{if(s){const f=10**o;return Math.round(V*100/s*f)/f}return 0};return e.onMounted(()=>{F.system("dashboard").subscribe(V=>{i.value=V.GrantTypes,g.value=V.Settings,c.value=V.ApplyList,b.value=V.StatList,l.value=V.PendingList,N.value=V.IsOrganizer,r.value=V.IsUser,i.value.forEach(s=>{var o;s.tags=((o=s.TargetTags)==null?void 0:o.split(`
`).map(f=>f.trim()).filter(f=>f))||[],s.tags.forEach(f=>{m.value.includes(f)||m.value.push(f)})})})}),(V,s)=>{const o=e.resolveComponent("input-select"),f=e.resolveComponent("report-pie-chart"),k=e.resolveComponent("report-mix-chart"),S=e.resolveComponent("tw-date"),D=e.resolveComponent("tooltip");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",Li,[s[20]||(s[20]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon12-teal.svg"}),e.createTextVNode(" 經費執行狀況 ")],-1)),e.createElementVNode("div",Ri,[e.createElementVNode("div",qi,[s[3]||(s[3]=e.createElementVNode("div",{class:"col-12 col-lg-6"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",{value:""},"114")])],-1)),e.createElementVNode("div",zi,[s[2]||(s[2]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"全部類別",-1)),e.createVNode(o,{"allow-empty":"",options:e.unref(B),placeholder:"全部","text-name":"title","value-name":"code",modelValue:e.unref(_),"onUpdate:modelValue":s[0]||(s[0]=T=>e.isRef(_)?_.value=T:null)},null,8,["options","modelValue"])])]),s[4]||(s[4]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))]),e.unref(d)?(e.openBlock(),e.createElementBlock("div",Gi,[e.createElementVNode("div",Ji,[e.createElementVNode("div",Yi,[e.createElementVNode("div",Qi,[e.createElementVNode("div",Hi,[s[6]||(s[6]=e.createElementVNode("div",{class:"fw-bold fs-4"},"總預算經費",-1)),e.createElementVNode("div",Wi,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(d).BudgetFees/1e3).toLocaleString())+" ",1),s[5]||(s[5]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])])])):e.createCommentVNode("",!0),e.unref(d)?(e.openBlock(),e.createElementBlock("div",Ki,[e.createElementVNode("div",Xi,[e.createElementVNode("div",Zi,[s[7]||(s[7]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"經費執行率",-1)),e.createVNode(f,{active:"已執行",color:9323693,inactive:"未執行",percent:n(e.unref(d).SpendAmount,e.unref(d).ApprovedAmount,1),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",vi,[s[8]||(s[8]=e.createElementVNode("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e.createElementVNode("span",{class:"fs-4 fw-bold"},"各類經費執行情形")],-1)),s[9]||(s[9]=e.createElementVNode("div",{class:"fs-6 text-end text-secondary me-5"},"單位：千元",-1)),e.unref(b).length?(e.openBlock(),e.createBlock(k,{key:0,list:e.unref(b),style:{width:"100%",height:"300px"}},null,8,["list"])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),e.unref(d)?(e.openBlock(),e.createElementBlock("div",em,[e.createElementVNode("div",tm,[e.createElementVNode("div",lm,[s[11]||(s[11]=e.createElementVNode("div",{class:"fw-bold fs-4"},"核定補助經費",-1)),e.createElementVNode("div",om,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(d).ApprovedAmount/1e3).toLocaleString())+" ",1),s[10]||(s[10]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",nm,[e.createElementVNode("div",rm,[s[13]||(s[13]=e.createElementVNode("div",{class:"fw-bold fs-4"},"賸餘款",-1)),e.createElementVNode("div",am,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(d).RemainingAmount/1e3).toLocaleString())+" ",1),s[12]||(s[12]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",sm,[e.createElementVNode("div",dm,[s[15]||(s[15]=e.createElementVNode("div",{class:"fw-bold fs-4"},"實支金額",-1)),e.createElementVNode("div",cm,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(d).SpendAmount/1e3).toLocaleString())+" ",1),s[14]||(s[14]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",im,[e.createElementVNode("div",mm,[s[17]||(s[17]=e.createElementVNode("div",{class:"fw-bold fs-4"},"已撥付",-1)),e.createElementVNode("div",pm,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(d).PaymentAmount/1e3).toLocaleString())+" ",1),s[16]||(s[16]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Vm,[s[19]||(s[19]=e.createElementVNode("h5",{class:"square-title"},"各類經費列表",-1)),e.createElementVNode("div",fm,[e.createElementVNode("table",Nm,[s[18]||(s[18]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-center"},"類別"),e.createElementVNode("th",{class:"text-center"},"核定件數"),e.createElementVNode("th",{class:"text-end"},"核定補助經費"),e.createElementVNode("th",{class:"text-end"},"經費執行率")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(b),T=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",Em,e.toDisplayString(e.unref(B).find(C=>C.code===T.Category).title),1),e.createElementVNode("td",bm,[e.createElementVNode("a",{href:`Report/ApprovedList.aspx?category=${T.Category}`},e.toDisplayString(T.Count),9,gm)]),e.createElementVNode("td",ym,e.toDisplayString(T.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",km,e.toDisplayString(n(T.SpendAmount,T.ApprovedAmount))+"%",1)]))),128))])])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",um,[s[26]||(s[26]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon13-teal.svg"}),e.createTextVNode(" 海洋委員會補助公告 ")],-1)),e.createElementVNode("div",hm,[e.createElementVNode("div",xm,[e.createElementVNode("div",$m,[s[22]||(s[22]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"依身分篩選適用規定",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=T=>e.isRef(t)?t.value=T:null)},[s[21]||(s[21]=e.createElementVNode("option",{value:""},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),T=>(e.openBlock(),e.createElementBlock("option",{key:T,value:T},e.toDisplayString(T),9,Bm))),128))],512),[[e.vModelSelect,e.unref(t)]])])]),e.createElementVNode("table",_m,[s[25]||(s[25]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"類別"),e.createElementVNode("th",{scope:"col"},"補助計畫"),e.createElementVNode("th",{scope:"col"},"申請期限"),e.createElementVNode("th",{scope:"col"},"補助對象"),e.createElementVNode("th",{scope:"col"},"相關檔案"),e.createElementVNode("th",{scope:"col"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),T=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",Cm,e.toDisplayString(T.Year),1),e.createElementVNode("td",Tm,e.toDisplayString(T.ShortName),1),e.createElementVNode("td",wm,e.toDisplayString(T.FullName),1),e.createElementVNode("td",Dm,[e.createVNode(S,{value:T.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",Sm,[e.createVNode(D,{"data-bs-html":"true",title:h(T)},null,8,["title"])]),e.createElementVNode("td",Am,[T.Path?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark",download:T.Filename,href:e.unref(a)(T.Path),style:{display:"inline"}},[...s[23]||(s[23]=[e.createElementVNode("i",{class:"fas fa-file-alt"},null,-1)])],8,Fm)):e.createCommentVNode("",!0)]),e.createElementVNode("td",Um,[e.createElementVNode("a",{class:"btn btn-teal-dark",href:E(T),target:"_blank"},[...s[24]||(s[24]=[e.createElementVNode("i",{class:"fa-solid"},null,-1),e.createTextVNode("我要申請",-1)])],8,Pm)])]))),128))])])])]),e.createElementVNode("div",Mm,[s[28]||(s[28]=e.createElementVNode("h3",{class:"text-teal d-flex align-items-center gap-2"},[e.createElementVNode("img",{src:"../assets/img/title-icon14-teal.svg"}),e.createTextVNode(" 我的計畫進度 ")],-1)),e.createElementVNode("div",Im,[e.unref(r)?(e.openBlock(),e.createElementBlock("ul",jm,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(y,T=>e.createElementVNode("li",{class:"total-item",key:T},[e.createElementVNode("a",{href:T.url},[e.createElementVNode("div",Lm,e.toDisplayString(T.title),1),e.createElementVNode("div",Rm,[e.createElementVNode("span",qm,e.toDisplayString(T.count),1),s[27]||(s[27]=e.createElementVNode("span",{class:"unit"},"件",-1))])],8,Om)])),64))])):e.createCommentVNode("",!0)])])],64)}}},Gm={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const B=e.useModel(x,"modelValue"),y=[{value:!0,text:"是"},{value:!1,text:"否"}];return(c,i)=>{const N=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(N,{options:y,modelValue:B.value,"onUpdate:modelValue":i[0]||(i[0]=r=>B.value=r)},null,8,["modelValue"])}}},Jm=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(x,{emit:B}){const y=e.ref(),c=()=>{Array.from(y.value.files).forEach(N=>F.upload(N).subscribe(r=>i("file",r))),y.value.value=""},i=B;return(N,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:r[0]||(r[0]=l=>e.unref(y).click()),type:"button"},[...r[1]||(r[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:c,class:"d-none",ref_key:"input",ref:y,type:"file"},N.$attrs),null,16)],64))}}),Ym=["disabled","placeholder","type"],Qm={key:0,class:"invalid mt-0"},Hm=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},max:{type:Number},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return e.watch(y,i=>{if(i){const N=(parseInt(i)||0).toString();i.toString()!==N?y.value=N:c.max&&Number(N)>c.max&&(y.value=c.max)}}),(i,N)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:"",style:{"text-align":"right"},type:x.type},i.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=r=>y.value=r)}),null,16,Ym),[[e.vModelDynamic,y.value]]),x.error?(e.openBlock(),e.createElementBlock("div",Qm,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),Wm={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const B=e.useModel(x,"modelValue"),y=[];for(let c=1;c<=12;c++)y.push({value:c,text:`${c}月`});return(c,i)=>{const N=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(N,{options:y,modelValue:B.value,"onUpdate:modelValue":i[0]||(i[0]=r=>B.value=r)},null,8,["modelValue"])}}},Km=["onChange","checked","disabled","id","value"],Xm=["for"],Zm={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>se(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=i=>{y.value=i};return(i,N)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,r=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:r},[e.createElementVNode("input",{onChange:l=>c(r[x.valueName]),checked:r[x.valueName]===y.value,class:"form-check-input",disabled:!e.unref(B),id:`${x.id}-${r[x.valueName]}`,type:"radio",value:r[x.valueName]},null,40,Km),e.createElementVNode("label",{class:"form-check-label",for:`${x.id}-${r[x.valueName]}`},e.toDisplayString(r[x.textName]),9,Xm)]))),128))}},vm=["disabled"],ep=["value"],tp=["value"],lp={key:0,class:"invalid mt-0"},op=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({allowEmpty:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue");return(c,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:x.disabled||!e.unref(B)},c.$attrs,{"onUpdate:modelValue":i[0]||(i[0]=N=>y.value=N)}),[x.allowEmpty||e.unref(B)&&!y.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:x.emptyValue},e.toDisplayString(x.placeholder),9,ep)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.options,(N,r)=>e.renderSlot(c.$slots,"default",{key:N,index:r,option:N},()=>[e.createElementVNode("option",{value:N[x.valueName]},e.toDisplayString(N[x.textName]),9,tp)])),128))],16,vm),[[e.vModelSelect,y.value]]),x.error?(e.openBlock(),e.createElementBlock("div",lp,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),np={class:"input-group"},rp={key:0,class:"input-group-text"},ap=["disabled","placeholder","type"],sp={key:0,class:"invalid mt-0"},dp=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return c.maxLength&&e.watch(y,()=>{var i;((i=y.value)==null?void 0:i.length)>c.maxLength&&(y.value=y.value.substring(0,c.maxLength))}),(i,N)=>{const r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",np,[x.prefix?(e.openBlock(),e.createElementBlock("span",rp,[e.createVNode(r,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:"",type:x.type},i.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=l=>y.value=l)}),null,16,ap),[[e.vModelDynamic,y.value]])]),x.error?(e.openBlock(),e.createElementBlock("div",sp,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),cp=["disabled","placeholder"],ip={key:0,class:"fs-14 text-gray mt-2"},mp={class:"text-pink"},pp={key:1,class:"invalid mt-0"},Vp=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const B=e.inject("editable",!0),y=e.useModel(x,"modelValue"),c=x;return c.maxLength&&e.watch(y,()=>{var i;((i=y.value)==null?void 0:i.length)>c.maxLength&&(y.value=y.value.substring(0,c.maxLength))}),(i,N)=>{var r;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(B),placeholder:e.unref(B)?x.placeholder:""},i.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=l=>y.value=l)}),null,16,cp),[[e.vModelText,y.value]]),e.unref(B)&&x.maxLength?(e.openBlock(),e.createElementBlock("div",ip,[N[1]||(N[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",mp,e.toDisplayString(((r=y.value)==null?void 0:r.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(x.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),x.error?(e.openBlock(),e.createElementBlock("div",pp,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64)}}}),fp=["disabled","placeholder"],Np={key:0,class:"invalid"},Ep=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean},placeholder:{default:"請輸入",type:String}},emits:["update:modelValue"],setup(x,{emit:B}){let y;const c=x,i=e.ref(),N=e.inject("editable",!0),r=e.ref(),l=B,t=m=>{!m&&c.modelValue&&(m=moment(new Date(c.modelValue))),m?(i.value=m.format(c.displayFormat),l("update:modelValue",m.format(c.format))):(i.value="",l("update:modelValue","")),y.setStartDate(i.value||void 0)};return e.onMounted(()=>{const m=$(r.value);m.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:c.drops,locale:{format:c.displayFormat},maxDate:c.maxDate?new Date(c.maxDate):c.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(g,b)=>t(b.startDate)),y=m.data("daterangepicker"),t()}),e.onUnmounted(()=>y.remove()),e.watch(()=>c.modelValue,()=>t()),(m,g)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(N),placeholder:e.unref(N)?x.placeholder:"",ref_key:"element",ref:r,type:"text"},m.$attrs,{"onUpdate:modelValue":g[0]||(g[0]=b=>e.isRef(i)?i.value=b:null)}),null,16,fp),[[e.vModelText,e.unref(i)]]),x.error?(e.openBlock(),e.createElementBlock("div",Np,e.toDisplayString(x.error),1)):e.createCommentVNode("",!0)],64))}}),bp={key:0,class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},gp={class:"pagination","aria-label":"Pagination"},yp=["disabled"],kp={key:1,class:"pagination-item ellipsis",type:"button"},up=["onClick"],hp={class:"page-number"},xp={key:2,class:"pagination-item ellipsis",type:"button"},$p={class:"page-number"},Bp=["disabled"],_p={class:"page-number-control"},Cp={class:"page-number-control-item"},Tp=["selected","value"],wp={class:"page-number-control-item"},Dp=["value","selected"],Sp={__name:"ListPager",props:{count:{required:!0,type:Number},page:{required:!0,type:Number},pageSize:{required:!0,type:Number},slots:{default:3,type:Number}},emits:["change"],setup(x,{emit:B}){const y={},c=x,i=e.computed(()=>Math.ceil(c.count/c.pageSize)),N=(l,t)=>{t&&(l=Math.min(l,Math.ceil(c.count/t))),1<=l&&l<=i.value&&r("change",l,t||c.pageSize)},r=B;return e.watchEffect(()=>{y.from=c.page-parseInt(c.slots/2),y.to=c.page+parseInt((c.slots-1)/2),y.pages=[];for(let l=y.from;l<=y.to;l++)0<l&&l<=i.value&&y.pages.push(l)}),(l,t)=>c.count?(e.openBlock(),e.createElementBlock("div",bp,[e.createElementVNode("nav",gp,[e.createElementVNode("button",{"aria-label":"Previous page",class:"nav-button",onClick:t[0]||(t[0]=m=>N(x.page-1)),disabled:x.page===1,type:"button"},[...t[6]||(t[6]=[e.createElementVNode("i",{class:"fas fa-chevron-left"},null,-1)])],8,yp),y.from>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pagination-item",onClick:t[1]||(t[1]=m=>N(1)),type:"button"},[...t[7]||(t[7]=[e.createElementVNode("span",{class:"page-number"},"1",-1)])])):e.createCommentVNode("",!0),y.from>2?(e.openBlock(),e.createElementBlock("button",kp,[...t[8]||(t[8]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.pages,m=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["pagination-item",{active:x.page===m}]),onClick:g=>N(m),key:m,type:"button"},[e.createElementVNode("span",hp,e.toDisplayString(m),1)],10,up))),128)),e.unref(i)>y.to+1?(e.openBlock(),e.createElementBlock("button",xp,[...t[9]||(t[9]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),e.unref(i)>y.to?(e.openBlock(),e.createElementBlock("button",{key:3,class:"pagination-item",onClick:t[2]||(t[2]=m=>N(e.unref(i))),type:"button"},[e.createElementVNode("span",$p,e.toDisplayString(e.unref(i)),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{"aria-label":"Next page",class:"nav-button",onClick:t[3]||(t[3]=m=>N(x.page+1)),type:"button",disabled:x.page===e.unref(i)},[...t[10]||(t[10]=[e.createElementVNode("i",{class:"fas fa-chevron-right"},null,-1)])],8,Bp)]),e.createElementVNode("div",_p,[e.createElementVNode("div",Cp,[t[11]||(t[11]=e.createElementVNode("span",null,"跳到",-1)),e.createElementVNode("select",{onChange:t[4]||(t[4]=m=>N(m.target.value)),class:"form-select jump-to-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),m=>(e.openBlock(),e.createElementBlock("option",{key:m,selected:m===x.page,value:m},e.toDisplayString(m),9,Tp))),128))],32),t[12]||(t[12]=e.createElementVNode("span",null,"頁",-1)),t[13]||(t[13]=e.createElementVNode("span",null,",",-1))]),e.createElementVNode("div",wp,[t[14]||(t[14]=e.createElementVNode("span",null,"每頁顯示",-1)),e.createElementVNode("select",{onChange:t[5]||(t[5]=m=>N(x.page,m.target.value)),class:"form-select"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([10,20,30],m=>e.createElementVNode("option",{value:m,selected:m===x.pageSize},e.toDisplayString(m),9,Dp)),64))],32),t[15]||(t[15]=e.createElementVNode("span",null,"筆",-1))])])])):e.createCommentVNode("",!0)}},Ap={class:"block"},Fp={class:"mt-4"},Up={class:"table align-middle gray-table side-table"},Pp={key:0},Mp={key:1,class:"text-light-gray"},Ip={class:"mt-4"},jp={class:"table align-middle gray-table side-table"},Op={class:"row g-3"},Lp={class:"col-12 col-xl-2"},Rp={class:"text-gray mb-2"},qp={class:"col-12 col-xl-3"},zp={class:"text-gray mb-2"},Gp={class:"col-12 col-xl-4"},Jp={class:"row g-1"},Yp={class:"col-7"},Qp={class:"col-5"},Hp={class:"col-12 col-xl-3"},Wp={class:"text-gray mb-2"},Kp={class:"col-12"},Xp={class:"text-gray mb-2"},Zp={class:"mt-4"},vp={class:"table align-middle gray-table side-table"},eV={class:"mt-4"},tV={class:"table align-middle gray-table side-table"},lV={key:0,class:"table-responsive mt-3 mb-0"},oV={class:"table align-middle gray-table"},nV={key:0},rV={key:0},aV={class:"d-flex gap-2"},sV=["onClick"],dV={class:"mt-4"},cV={class:"table align-middle gray-table side-table"},iV={key:0,class:"block-bottom bg-light-teal"},mV={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.ref(),N=e.computed(()=>J("literacy",m.value.Status,1)),r=e.ref({}),l=e.ref([]),t=e.computed(()=>g.value.filter(E=>!E.Deleted)),m=e.ref({}),g=e.ref([]),b=e.computed({get:()=>!!t.value.length,set:E=>{E?_():g.value.forEach(n=>n.Deleted=!0)}}),_=()=>g.value.push({}),u=B,p=()=>{F.literacy("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(E=>{m.value=E.Project,c.value=E.Contacts,g.value=E.PreviousStudies,j().init("literacy",m.value),i.value=m.value.changeApply,m.value.changeApply=void 0})},d=E=>E.Deleted=!0,a=E=>{var V,s;if(r.value={},E&&!h()){e.nextTick(()=>{var o;return(o=document.querySelector(".invalid"))==null?void 0:o.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:m.value,Contacts:c.value,PreviousStudies:g.value.filter(o=>o.ID||!o.Deleted),Before:(V=i.value)==null?void 0:V.Form1Before,After:(s=i.value)==null?void 0:s.Form1After,Submit:E?"true":"false"};F.literacy("saveApplication",n).subscribe(o=>{E?u("next",o.ID):m.value.ID?p():window.location.href=`Application.aspx?ID=${o.ID}`})},h=()=>{let E={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return r.value=I(m.value,E),E={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},c.value.forEach((n,V)=>Object.assign(r.value,I(n,E,`contact-${V}-`))),E={Title:"研習/課程名稱",TheDate:"辦理日期"},g.value.forEach((n,V)=>Object.assign(r.value,I(n,E,`study-${V}-`))),i.value&&(E={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(r.value,I(i.value,E))),!Object.keys(r.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(E=>{l.value=E[0],y.id?p():F.literacy("getEmptyApplication").subscribe(n=>{m.value=Object.assign({Field:null,FormStep:1,Status:1},n),c.value=[{Role:"申請人"}],j().init("literacy",m.value)})})}),e.provide("editable",N),e.watch(()=>[m.value.Field,m.value.OrgName],()=>{var E;if(N.value){const n=[];m.value.Field&&n.push((E=l.value.find(V=>V.Code===m.value.Field))==null?void 0:E.Descname),m.value.OrgName&&n.push(m.value.OrgName),m.value.ProjectName=n.join("-")}}),(E,n)=>{const V=e.resolveComponent("required-label"),s=e.resolveComponent("input-text"),o=e.resolveComponent("input-select"),f=e.resolveComponent("input-textarea"),k=e.resolveComponent("input-boolean"),S=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ap,[n[40]||(n[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Fp,[e.createElementVNode("table",Up,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[14]||(n[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).Year),1)]),e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(m).ProjectID?(e.openBlock(),e.createElementBlock("span",Pp,e.toDisplayString(e.unref(m).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Mp,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[17]||(n[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{disabled:"",modelValue:e.unref(m).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=D=>e.unref(m).ProjectName=D),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{"empty-value":null,error:e.unref(r).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(m).Field,"onUpdate:modelValue":n[1]||(n[1]=D=>e.unref(m).Field=D)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(r).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(m).OrgName,"onUpdate:modelValue":n[2]||(n[2]=D=>e.unref(m).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(r).OrgLeader,modelValue:e.unref(m).OrgLeader,"onUpdate:modelValue":n[3]||(n[3]=D=>e.unref(m).OrgLeader=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(r).Address,placeholder:"請輸入地址",modelValue:e.unref(m).Address,"onUpdate:modelValue":n[4]||(n[4]=D=>e.unref(m).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Ip,[e.createElementVNode("table",jp,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(D,T)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Op,[e.createElementVNode("div",Lp,[e.createElementVNode("div",Rp,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(r)[`contact-${T}-Name`],modelValue:D.Name,"onUpdate:modelValue":C=>D.Name=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",qp,[e.createElementVNode("div",zp,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(r)[`contact-${T}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":C=>D.JobTitle=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Gp,[n[24]||(n[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Jp,[e.createElementVNode("div",Yp,[e.createVNode(s,{modelValue:D.Phone,"onUpdate:modelValue":C=>D.Phone=C,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Qp,[e.createVNode(s,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":C=>D.PhoneExt=C,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Hp,[e.createElementVNode("div",Wp,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[25]||(n[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(r)[`contact-${T}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":C=>D.MobilePhone=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Kp,[e.createElementVNode("div",Xp,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(s,{error:e.unref(r)[`contact-${T}-EMail`],modelValue:D.EMail,"onUpdate:modelValue":C=>D.EMail=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Zp,[e.createElementVNode("table",vp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[28]||(n[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(f,{error:e.unref(r).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(m).Target,"onUpdate:modelValue":n[5]||(n[5]=D=>e.unref(m).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[29]||(n[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(m).Summary,"onUpdate:modelValue":n[6]||(n[6]=D=>e.unref(m).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(m).Quantified,"onUpdate:modelValue":n[7]||(n[7]=D=>e.unref(m).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(m).Qualitative,"onUpdate:modelValue":n[8]||(n[8]=D=>e.unref(m).Qualitative=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",eV,[e.createElementVNode("table",tV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[36]||(n[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(b),"onUpdate:modelValue":n[9]||(n[9]=D=>e.isRef(b)?b.value=D:null)},null,8,["modelValue"]),e.unref(b)?(e.openBlock(),e.createElementBlock("div",lV,[e.createElementVNode("table",oV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[32]||(n[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),n[33]||(n[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",nV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(D,T)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(s,{error:e.unref(r)[`study-${T}-Title`],modelValue:D.Title,"onUpdate:modelValue":C=>D.Title=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(r)[`study-${T}-TheDate`],modelValue:D.TheDate,"onUpdate:modelValue":C=>D.TheDate=C,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",rV,[e.createElementVNode("div",aV,[e.unref(t).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:C=>d(D),type:"button"},[...n[34]||(n[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,sV)):e.createCommentVNode("",!0),T+1===e.unref(t).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:_,type:"button"},[...n[35]||(n[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[39]||(n[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",dV,[e.createElementVNode("table",cV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[37]||(n[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Form1Before,rows:"4",modelValue:e.unref(i).Form1Before,"onUpdate:modelValue":n[10]||(n[10]=D=>e.unref(i).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(V,null,{default:e.withCtx(()=>[...n[38]||(n[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Form1After,rows:"4",modelValue:e.unref(i).Form1After,"onUpdate:modelValue":n[11]||(n[11]=D=>e.unref(i).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",iV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[12]||(n[12]=D=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[13]||(n[13]=D=>a(!0)),type:"button"},[...n[43]||(n[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},pV={class:"block"},VV={key:0,class:"text-pink lh-base mt-4"},fV={class:"mt-4"},NV={class:"table align-middle gray-table"},EV={class:"text-center"},bV={key:0,width:"180"},gV={class:"text-center"},yV={key:0},kV=["innerHTML"],uV=["href"],hV={key:0,class:"text-center"},xV={key:0},$V={key:1,class:"text-pink"},BV={key:1,class:"tag-group mt-2 gap-1"},_V={key:0,class:"tag tag-green-light"},CV=["download","href"],TV=["onClick"],wV={key:1,class:"text-center mt-4"},DV={class:"mt-4"},SV={class:"table align-middle gray-table side-table"},AV={key:0,class:"block-bottom bg-light-teal"},FV=["disabled"],UV={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"著作權授權同意書",Template:`../../Service/OFS/DownloadTemplateLIT.ashx?type=5&id=${y.id}`,Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),i=e.ref(),N=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>J("literacy",t.value.Status,2)),l=e.ref({}),t=e.ref({}),m=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:t.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},g=F.download,b=B,_=()=>{rxjs.forkJoin([F.literacy("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=c.value.filter(h=>{var E;return!((E=h.Excludes)!=null&&E.includes(t.value.OrgCategory))}),c.value.forEach(h=>{h.Files=a.Attachments.filter(E=>E.Type===h.Type),h.Uploaded=e.computed(()=>h.Files.filter(E=>!E.Deleted).length)}),j().init("literacy",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},u=d=>{var h,E;if(l.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,V)=>n.concat(V.Files),[]),Before:(h=i.value)==null?void 0:h.Form5Before,After:(E=i.value)==null?void 0:E.Form5After,Submit:d?"true":"false"};F.literacy("saveAttachment",a).subscribe(n=>{n&&(d?b("next",_):_())})},p=()=>{if(i.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,I(i.value,d))}return!Object.keys(l.value).length};return e.onMounted(_),e.provide("editable",r),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file"),n=e.resolveComponent("tw-date-time"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",pV,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",VV,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",fV,[e.createElementVNode("table",NV,[e.createElementVNode("thead",EV,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",bV,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",gV,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",yV,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,kV)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,uV)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",hV,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",xV,"已上傳")):(e.openBlock(),e.createElementBlock("span",$V,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:f=>m(s,f)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",BV,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",_V,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(g)(f.Path)},e.toDisplayString(f.Name),9,CV),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>f.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,TV)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(t).ApplyTime?(e.openBlock(),e.createElementBlock("div",wV,[a[10]||(a[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(n,{value:e.unref(t).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",DV,[e.createElementVNode("table",SV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(i).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(i).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(i).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(i).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",AV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),disabled:e.unref(N),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,FV)])):e.createCommentVNode("",!0)],64)}}},PV={class:"block"},MV={class:"mt-4"},IV={class:"table-responsive mt-3 mb-0"},jV={class:"table align-middle gray-table"},OV={key:0,width:"1"},LV={key:0},RV={class:"d-flex gap-2"},qV=["onClick"],zV={class:"table-responsive mt-3 mb-0"},GV={class:"table align-middle gray-table"},JV={class:"mt-4"},YV={class:"table align-middle gray-table side-table"},QV={key:0,class:"block-bottom bg-light-teal"},HV={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.computed(()=>J("literacy",t.value.Status,4)),r=e.ref({}),l=e.computed(()=>c.value.filter(d=>!d.Deleted)),t=e.ref({}),m=()=>c.value.push({}),g=B,b=()=>{rxjs.forkJoin([F.literacy("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=a.Benefits,c.value.length||m(),j().init("literacy",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},_=d=>d.Deleted=!0,u=d=>{var h,E;if(r.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:t.value,Benefits:c.value,Before:(h=i.value)==null?void 0:h.Form4Before,After:(E=i.value)==null?void 0:E.Form4After,Submit:d?"true":"false"};F.literacy("saveBenefit",a).subscribe(()=>{d?g("next"):b()})},p=()=>{let d={Benefit:"不可量化成果"};return r.value=I(t.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((a,h)=>Object.assign(r.value,I(a,d,`item-${h}-`))),i.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,I(i.value,d))),!Object.keys(r.value).length};return e.onMounted(b),e.provide("editable",N),(d,a)=>{const h=e.resolveComponent("input-text"),E=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",PV,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",MV,[e.createElementVNode("div",IV,[e.createElementVNode("table",jV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",OV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(V,s)=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Title`],modelValue:V.Title,"onUpdate:modelValue":o=>V.Title=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Target`],modelValue:V.Target,"onUpdate:modelValue":o=>V.Target=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r)[`item-${s}-Description`],rows:"1",modelValue:V.Description,"onUpdate:modelValue":o=>V.Description=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",LV,[e.createElementVNode("div",RV,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:o=>_(V),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,qV)):e.createCommentVNode("",!0),s+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:m,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",zV,[e.createElementVNode("table",GV,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(t).Benefit,"onUpdate:modelValue":a[0]||(a[0]=V=>e.unref(t).Benefit=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",JV,[e.createElementVNode("table",YV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(i).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=V=>e.unref(i).Form4Before=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(i).Form4After,"onUpdate:modelValue":a[2]||(a[2]=V=>e.unref(i).Form4After=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",QV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=V=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=V=>u(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},WV={class:"block"},KV={class:"mt-4"},XV={class:"table-responsive mt-3 mb-0"},ZV={class:"table align-middle gray-table"},vV={class:"text-end"},ef={class:"text-end"},tf={class:"table-responsive"},lf={class:"table align-middle gray-table"},of=["colspan"],nf={key:0,width:"1"},rf={class:"text-end"},af={key:0},sf={class:"d-flex gap-2"},df=["onClick"],cf={class:"mt-4"},mf={class:"table-responsive mt-3 mb-0"},pf={class:"table align-middle gray-table"},Vf={key:0,width:"1"},ff={class:"text-end"},Nf={key:0},Ef={class:"d-flex gap-2"},bf=["onClick"],gf={class:"mt-4"},yf={class:"table align-middle gray-table side-table"},kf={key:0,class:"block-bottom bg-light-teal"},uf={class:"text-center"},hf={class:"mb-5"},xf={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("literacy",t.value.Status,3)),N=e.ref({}),r=e.computed(()=>g.value.filter(s=>!s.Deleted)),l=e.computed(()=>b.value.filter(s=>!s.Deleted)),t=e.ref({}),m=e.ref(),g=e.ref([]),b=e.ref([]),_=e.ref({}),u=e.ref(0),p=()=>g.value.push({}),d=()=>b.value.push({}),a=B,h=()=>{rxjs.forkJoin([F.literacy("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];t.value=o.Project,g.value=o.OtherSubsidies,b.value=o.BudgetPlans,_.value=o.GrantTargetSetting,b.value.length||d(),j().init("literacy",t.value),c.value=t.value.changeApply,t.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=(s,o)=>{var k,S;if(N.value={},s&&!V()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!o&&t.value.ApplyAmount>_.value.GrantLimit*1e4){m.value.show(()=>n(s,!0));return}const f={Project:t.value,OtherSubsidies:g.value,BudgetPlans:b.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(S=c.value)==null?void 0:S.Form3After,Submit:s?"true":"false"};F.literacy("saveFunding",f).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=I(t.value,s),s={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`other-${f}-`))),s={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},l.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`plan-${f}-`))),c.value&&(s={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,I(c.value,s))),!Object.keys(N.value).length};return e.onMounted(h),e.provide("editable",i),e.watchEffect(()=>{t.value.OtherAmount=r.value.reduce((s,o)=>s+q(o.Amount),0),u.value=q(t.value.ApplyAmount)+q(t.value.SelfAmount)+q(t.value.OtherAmount),r.value.forEach(s=>s.percent=Math.round(q(s.Amount)/t.value.OtherAmount*1e4)/100),b.value.forEach(s=>s.sum=q(s.Amount)+q(s.OtherAmount))}),(s,o)=>{var C;const f=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),D=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",WV,[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",KV,[e.createElementVNode("div",XV,[e.createElementVNode("table",ZV,[o[6]||(o[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).ApplyAmount,modelValue:e.unref(t).ApplyAmount,"onUpdate:modelValue":o[0]||(o[0]=A=>e.unref(t).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).SelfAmount,modelValue:e.unref(t).SelfAmount,"onUpdate:modelValue":o[1]||(o[1]=A=>e.unref(t).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",vV,e.toDisplayString((C=e.unref(t).OtherAmount)==null?void 0:C.toLocaleString()),1),e.createElementVNode("td",ef,e.toDisplayString(e.unref(u).toLocaleString()),1)])])])]),o[14]||(o[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",tf,[e.createElementVNode("table",lf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(i)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,of)]),e.createElementVNode("tr",null,[o[7]||(o[7]=e.createElementVNode("th",{width:"1"},null,-1)),o[8]||(o[8]=e.createElementVNode("th",null,"單位名稱",-1)),o[9]||(o[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),o[10]||(o[10]=e.createElementVNode("th",null,"比例",-1)),o[11]||(o[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",nf,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`other-${w}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`other-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",rf,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`other-${w}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",af,[e.createElementVNode("div",sf,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[12]||(o[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,df)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[13]||(o[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",cf,[e.createElementVNode("div",mf,[e.createElementVNode("table",pf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[15]||(o[15]=e.createElementVNode("th",null,"預算項目",-1)),o[16]||(o[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),o[17]||(o[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),o[18]||(o[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),o[19]||(o[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",Vf,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`plan-${w}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",ff,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`plan-${w}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",Nf,[e.createElementVNode("div",Ef,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[20]||(o[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,bf)):e.createCommentVNode("",!0),w+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[24]||(o[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",gf,[e.createElementVNode("table",yf,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":o[2]||(o[2]=A=>e.unref(c).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":o[3]||(o[3]=A=>e.unref(c).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",kf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=A=>n(!0)),type:"button"},[...o[27]||(o[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:m},{default:e.withCtx(()=>[e.createElementVNode("div",uf,[o[28]||(o[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",hf,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),o[29]||(o[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),o[30]||(o[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},$f={class:"block"},Bf={class:"square-title"},_f={class:"text-teal fw-bold py-3"},Cf={class:"table-responsive mb-0"},Tf={class:"table align-middle gray-table"},wf={class:"text-end"},Df={class:"text-teal fw-bold pb-3"},Sf={class:"text-teal fw-bold pb-3"},Af={class:"mt-4"},Ff={class:"table align-middle gray-table"},Uf={class:"text-center"},Pf={key:0,width:"180"},Mf={class:"text-center"},If=["href"],jf={key:0,class:"text-center"},Of={key:0},Lf={key:1,class:"text-pink"},Rf={key:1,class:"tag-group mt-2 gap-1"},qf={key:0,class:"tag tag-green-light"},zf=["download","href"],Gf=["onClick"],Jf={key:0,class:"block-bottom bg-light-teal"},Yf=["disabled"],Qf={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.computed(()=>t.value.some(p=>!p.Files.filter(d=>!d.Deleted).length)),i=e.computed(()=>!r.value||r.value.Status==="請款中"),N=e.computed(()=>{var p;return((p=r.value)==null?void 0:p.Status)==="通過"}),r=e.ref(),l=e.ref({}),t=e.ref([{Type:11,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]}]),m=(p,d)=>{d.Type==="application/pdf"&&p.Files.push({Type:p.Type,Path:d.Path,Name:`${l.value.ProjectID}_請款_${p.Title}.pdf`})},g=F.download,b=B,_=()=>{F.literacy("getPayment",{ID:y.id}).subscribe(p=>{l.value=p.Project,j().init("literacy",l.value),t.value=t.value.filter(d=>{var a;return!((a=d.Excludes)!=null&&a.includes(l.value.OrgCategory))}),t.value.forEach(d=>{d.Files=p.Attachments.filter(a=>a.Type===d.Type),d.Uploaded=e.computed(()=>d.Files.filter(a=>!a.Deleted).length)}),r.value=p.Payments.find(d=>d.Stage===1),H().init(r.value)})},u=p=>{const d={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:l.value.ApprovedAmount},Attachments:t.value.reduce((a,h)=>a.concat(h.Files),[]),Submit:p?"true":"false"};F.literacy("savePayment",d).subscribe(a=>{a&&(p?b("next",_):_())})};return e.onMounted(_),e.provide("editable",i),(p,d)=>{var E;const a=e.resolveComponent("required-label"),h=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$f,[e.createElementVNode("h5",Bf,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",_f,"核定經費: "+e.toDisplayString((E=e.unref(l).ApprovedAmount)==null?void 0:E.toLocaleString())+"元",1),e.createElementVNode("div",Cf,[e.createElementVNode("table",Tf,[d[6]||(d[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",wf,e.toDisplayString(e.unref(l).ApprovedAmount),1),d[2]||(d[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[3]||(d[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[4]||(d[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),d[5]||(d[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Df,"本期實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Sf,"累積實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),d[12]||(d[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),d[13]||(d[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Af,[e.createElementVNode("table",Ff,[e.createElementVNode("thead",Uf,[e.createElementVNode("tr",null,[d[7]||(d[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),d[8]||(d[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",Pf,"狀態")):e.createCommentVNode("",!0),d[9]||(d[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(n,V)=>(e.openBlock(),e.createElementBlock("tr",{key:n},[e.createElementVNode("td",Mf,e.toDisplayString(V+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(n.Title),1)]),_:2},1024)]),e.unref(i)&&n.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:n.Template,style:{width:"140px"},type:"button"},[...d[10]||(d[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,If)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",jf,[n.Uploaded?(e.openBlock(),e.createElementBlock("span",Of,"已上傳")):(e.openBlock(),e.createElementBlock("span",Lf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(i)&&!n.Uploaded?(e.openBlock(),e.createBlock(h,{key:0,accept:".pdf",onFile:s=>m(n,s)},null,8,["onFile"])):e.createCommentVNode("",!0),n.Uploaded?(e.openBlock(),e.createElementBlock("div",Rf,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.Files,s=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:s},[s.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",qf,[e.createElementVNode("a",{class:"tag-link my-1",download:s.Name,href:e.unref(g)(s.Path)},e.toDisplayString(s.Name),9,zf),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:o=>s.Deleted=!0,type:"button"},[...d[11]||(d[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Gf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",Jf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:d[0]||(d[0]=n=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:d[1]||(d[1]=n=>u(!0)),disabled:e.unref(c),type:"button"},[...d[14]||(d[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Yf)])):e.createCommentVNode("",!0)],64)}}},Hf={class:"block"},Wf={class:"square-title"},Kf={class:"text-teal fw-bold py-3"},Xf={class:"text-teal fw-bold pb-3"},Zf={class:"table-responsive"},vf={class:"table align-middle gray-table"},eN={class:"text-end"},tN={class:"text-end"},lN={class:"text-end"},oN={class:"mt-4"},nN={class:"table align-middle gray-table"},rN={class:"text-center"},aN={key:0,width:"180"},sN={class:"text-center"},dN=["href"],cN={key:0,class:"text-center"},iN={key:0},mN={key:1,class:"text-pink"},pN={key:1,class:"tag-group mt-2 gap-1"},VN={key:0,class:"tag tag-green-light"},fN=["download","href"],NN=["onClick"],EN={key:0,class:"block-bottom bg-light-teal"},bN=["disabled"],gN={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>c.value<=0||_.value.some(E=>!E.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.ref(0),l=e.ref(),t=e.ref(0),m=e.ref({}),g=e.computed(()=>m.value.ApprovedAmount?Math.min(Math.round(c.value*100/m.value.ApprovedAmount*100)/100,100):0),b=e.computed(()=>t.value?Math.round(c.value*100/t.value*100)/100:0),_=e.ref([{Type:21,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/LIT/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/LIT/3-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/LIT/4-補助清單.docx",Files:[]}]),u=(E,n)=>{n.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:n.Path,Name:`${m.value.ProjectID}_結案核銷_${E.Title}.pdf`})},p=F.download,d=B,a=()=>{F.literacy("getPayment",{ID:y.id}).subscribe(E=>{m.value=E.Project,j().init("literacy",m.value),_.value=_.value.filter(n=>{var V;return!((V=n.Excludes)!=null&&V.includes(m.value.OrgCategory))}),_.value.forEach(n=>{n.Files=E.Attachments.filter(V=>V.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(V=>!V.Deleted).length)}),l.value=E.Payments.find(n=>n.Stage===2),l.value&&(c.value=l.value.TotalSpentAmount),t.value=E.Payments.filter(n=>n.Stage<2&&n.Status==="通過").reduce((n,V)=>n+V.CurrentActualPaidAmount,0),r.value=t.value,H().init(l.value,t.value)})},h=E=>{const n={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((V,s)=>V.concat(s.Files),[]),Submit:E?"true":"false"};F.literacy("savePayment",n).subscribe(V=>{V&&(E?d("next",a):a())})};return e.onMounted(a),e.provide("editable",N),(E,n)=>{var f;const V=e.resolveComponent("input-integer"),s=e.resolveComponent("required-label"),o=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Hf,[e.createElementVNode("h5",Wf,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Kf,"核定經費: "+e.toDisplayString((f=e.unref(m).ApprovedAmount)==null?void 0:f.toLocaleString())+"元",1),e.createElementVNode("p",Xf,"賸餘款: "+e.toDisplayString((e.unref(m).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",Zf,[e.createElementVNode("table",vf,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",eN,e.toDisplayString(e.unref(t)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(r),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=k=>e.isRef(c)?c.value=k:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",tN,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",lN,e.toDisplayString(e.unref(b))+"%",1)])])])]),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",oN,[e.createElementVNode("table",nN,[e.createElementVNode("thead",rN,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",aN,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(k,S)=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",sN,e.toDisplayString(S+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.Title),1)]),_:2},1024)]),e.unref(N)&&k.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:k.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,dN)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",cN,[k.Uploaded?(e.openBlock(),e.createElementBlock("span",iN,"已上傳")):(e.openBlock(),e.createElementBlock("span",mN,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!k.Uploaded?(e.openBlock(),e.createBlock(o,{key:0,accept:".pdf",onFile:D=>u(k,D)},null,8,["onFile"])):e.createCommentVNode("",!0),k.Uploaded?(e.openBlock(),e.createElementBlock("div",pN,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.Files,D=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:D},[D.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",VN,[e.createElementVNode("a",{class:"tag-link my-1",download:D.Name,href:e.unref(p)(D.Path)},e.toDisplayString(D.Name),9,fN),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:T=>D.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,NN)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",EN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=k=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=k=>h(!0)),disabled:e.unref(i),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,bN)])):e.createCommentVNode("",!0)],64)}}},yN={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const i=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(i,{steps:B,type:"literacy"})}}},kN={class:"block"},uN={class:"mt-4"},hN={class:"table align-middle gray-table side-table"},xN={key:0,class:"d-flex align-items-center gap-2"},$N={class:"input-group w-auto"},BN={class:"text-teal-dark"},_N={key:1,class:"invalid mt-0"},CN={class:"table-responsive mt-4"},TN={class:"table align-middle gray-table"},wN={key:0},DN={class:"input-group"},SN={key:0,class:"invalid mt-0"},AN={key:0},FN={class:"d-flex gap-2"},UN=["onClick"],PN={class:"mt-4"},MN={class:"table align-middle gray-table"},IN={key:0},jN=["value"],ON={key:0},LN={class:"d-flex gap-2"},RN=["onClick"],qN={class:"mt-4"},zN={class:"table align-middle gray-table side-table"},GN={key:0,class:"block-bottom bg-light-teal"},JN={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],i=e.ref(),N=e.computed(()=>b.value.PlanEndDate),r=e.computed(()=>J("literacy",g.value.Status,2)),l=e.ref({}),t=e.computed(()=>_.value.filter(s=>!s.Deleted)),m=e.computed(()=>u.value.filter(s=>!s.Deleted)),g=e.ref({}),b=e.ref({}),_=e.ref([]),u=e.ref([]),p=()=>F.literacy("createItem",{ID:y.id}).subscribe(s=>_.value.push(s)),d=()=>u.value.push({Type:0,ItemID:0}),a=B,h=()=>{rxjs.forkJoin([F.literacy("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];g.value=o.Project,b.value=o.GrantType,_.value=o.Items,u.value=o.Schedules,_.value.length||p(),u.value.length||d(),j().init("literacy",g.value),i.value=g.value.changeApply,g.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=s=>{var f,k;if(l.value={},s&&!V()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:g.value,Items:_.value,Schedules:u.value,Before:(f=i.value)==null?void 0:f.Form2Before,After:(k=i.value)==null?void 0:k.Form2After,Submit:s?"true":"false"};F.literacy("saveWorkSchedule",o).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=I(g.value,s),s={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},t.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`item-${f}-`))),s={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},m.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`schedule-${f}-`))),i.value&&(s={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,I(i.value,s))),!Object.keys(l.value).length};return e.onMounted(h),e.provide("editable",r),(s,o)=>{const f=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),D=e.resolveComponent("input-text"),T=e.resolveComponent("input-month"),C=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kN,[o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",uN,[e.createElementVNode("table",hN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[6]||(o[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",xN,[e.createElementVNode("div",$N,[e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":o[0]||(o[0]=w=>e.unref(g).StartTime=w)},null,8,["max-date","modelValue"]),o[7]||(o[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":o[1]||(o[1]=w=>e.unref(g).EndTime=w)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",BN,[o[8]||(o[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(N)},null,8,["value"]),o[9]||(o[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",_N,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),o[27]||(o[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",CN,[e.createElementVNode("table",TN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[14]||(o[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[13]||(o[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",wN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${P}-Title`],modelValue:w.Title,"onUpdate:modelValue":U=>w.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",DN,[e.createVNode(T,{"empty-value":0,modelValue:w.Begin,"onUpdate:modelValue":U=>w.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(T,{"empty-value":0,modelValue:w.End,"onUpdate:modelValue":U=>w.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",SN,e.toDisplayString(e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`item-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",AN,[e.createElementVNode("div",FN,[e.unref(t).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,UN)):e.createCommentVNode("",!0),P+1===e.unref(t).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[16]||(o[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),o[28]||(o[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",PN,[e.createElementVNode("table",MN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[17]||(o[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[18]||(o[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[19]||(o[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[20]||(o[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",IN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-Type`],options:c,modelValue:w.Type,"onUpdate:modelValue":U=>w.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-ItemID`],options:e.unref(t),modelValue:w.ItemID,"onUpdate:modelValue":U=>w.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,jN)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`schedule-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`schedule-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",ON,[e.createElementVNode("div",LN,[e.unref(m).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,RN)):e.createCommentVNode("",!0),P+1===e.unref(m).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[22]||(o[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",qN,[e.createElementVNode("table",zN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(i).Form2Before,"onUpdate:modelValue":o[2]||(o[2]=w=>e.unref(i).Form2Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[24]||(o[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(i).Form2After,"onUpdate:modelValue":o[3]||(o[3]=w=>e.unref(i).Form2After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",GN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=w=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=w=>n(!0)),type:"button"},[...o[29]||(o[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},YN={class:"block"},QN={class:"mt-4"},HN={class:"table align-middle gray-table side-table"},WN={key:0},KN={key:1,class:"text-light-gray"},XN={class:"mt-4"},ZN={class:"table align-middle gray-table side-table"},vN={class:"row g-3"},e1={class:"col-12 col-xl-2"},t1={class:"text-gray mb-2"},l1={class:"col-12 col-xl-3"},o1={class:"text-gray mb-2"},n1={class:"col-12 col-xl-4"},r1={class:"row g-1"},a1={class:"col-7"},s1={class:"col-5"},d1={class:"col-12 col-xl-3"},c1={class:"text-gray mb-2"},i1={class:"col-12"},m1={class:"text-gray mb-2"},p1={class:"mt-4"},V1={class:"table align-middle gray-table side-table"},f1={class:"mt-4"},N1={class:"table align-middle gray-table side-table"},E1={key:0,class:"table-responsive mt-3 mb-0"},b1={class:"table align-middle gray-table"},g1={key:0},y1={key:0},k1={class:"d-flex gap-2"},u1=["onClick"],h1={class:"mt-4"},x1={class:"table align-middle gray-table side-table"},$1={key:0,class:"block-bottom bg-light-teal"},B1={__name:"Application",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.ref(),r=e.computed(()=>J("multiple",g.value.Status,1)),l=e.ref({}),t=e.ref([]),m=e.computed(()=>b.value.filter(n=>!n.Deleted)),g=e.ref({}),b=e.ref([]),_=e.computed({get:()=>!!m.value.length,set:n=>{n?u():b.value.forEach(V=>V.Deleted=!0)}}),u=()=>b.value.push({}),p=B,d=()=>{F.multiple("getApplication",{Apply:y.apply?"true":"false",ID:y.id}).subscribe(n=>{g.value=n.Project,N.value=n.Contacts,b.value=n.ReceivedSubsidies,g.value.OrgCategory=g.value.OrgCategory||null,j().init("multiple",g.value),i.value=g.value.changeApply,g.value.changeApply=void 0})},a=n=>n.Deleted=!0,h=n=>{var s,o;if(l.value={},n&&!E()){e.nextTick(()=>{var f;return(f=document.querySelector(".invalid"))==null?void 0:f.scrollIntoView({behavior:"smooth",block:"center"})});return}const V={Project:g.value,Contacts:N.value,ReceivedSubsidies:b.value.filter(f=>f.ID||!f.Deleted),Before:(s=i.value)==null?void 0:s.Form1Before,After:(o=i.value)==null?void 0:o.Form1After,Submit:n?"true":"false"};F.multiple("saveApplication",V).subscribe(f=>{n?p("next",f.ID):g.value.ID?d():window.location.href=`Application.aspx?ID=${f.ID}`})},E=()=>{let n={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return l.value=I(g.value,n),n={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((V,s)=>Object.assign(l.value,I(V,n,`contact-${s}-`))),n={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},b.value.forEach((V,s)=>Object.assign(l.value,I(V,n,`received-${s}-`))),i.value&&(n={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(l.value,I(i.value,n))),!Object.keys(l.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.multiple("getZgsCodes",{CodeGroup:"MULField"}),F.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(n=>{t.value=n[0],c.value=n[1],y.id?d():F.multiple("getEmptyApplication").subscribe(V=>{g.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},V),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("multiple",g.value)})})}),e.provide("editable",r),(n,V)=>{const s=e.resolveComponent("required-label"),o=e.resolveComponent("input-text"),f=e.resolveComponent("input-select"),k=e.resolveComponent("input-textarea"),S=e.resolveComponent("input-boolean"),D=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",YN,[V[43]||(V[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",QN,[e.createElementVNode("table",HN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[15]||(V[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).Year),1)]),e.createElementVNode("tr",null,[V[16]||(V[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(g).ProjectID?(e.openBlock(),e.createElementBlock("span",WN,e.toDisplayString(e.unref(g).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",KN,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[V[17]||(V[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(g).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[18]||(V[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l).ProjectName,modelValue:e.unref(g).ProjectName,"onUpdate:modelValue":V[0]||(V[0]=T=>e.unref(g).ProjectName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[19]||(V[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{"empty-value":null,error:e.unref(l).Field,options:e.unref(t),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).Field,"onUpdate:modelValue":V[1]||(V[1]=T=>e.unref(g).Field=T)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[20]||(V[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(g).OrgName,"onUpdate:modelValue":V[2]||(V[2]=T=>e.unref(g).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[21]||(V[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{"empty-value":null,error:e.unref(l).OrgCategory,options:e.unref(c),"text-name":"Descname","value-name":"Code",modelValue:e.unref(g).OrgCategory,"onUpdate:modelValue":V[3]||(V[3]=T=>e.unref(g).OrgCategory=T)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[22]||(V[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l).TaxID,"max-length":8,modelValue:e.unref(g).TaxID,"onUpdate:modelValue":V[4]||(V[4]=T=>e.unref(g).TaxID=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[23]||(V[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l).Address,placeholder:"請輸入地址",modelValue:e.unref(g).Address,"onUpdate:modelValue":V[5]||(V[5]=T=>e.unref(g).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),V[44]||(V[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",XN,[e.createElementVNode("table",ZN,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(T,C)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",vN,[e.createElementVNode("div",e1,[e.createElementVNode("div",t1,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[24]||(V[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(o,{error:e.unref(l)[`contact-${C}-Name`],modelValue:T.Name,"onUpdate:modelValue":A=>T.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",l1,[e.createElementVNode("div",o1,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[25]||(V[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(o,{error:e.unref(l)[`contact-${C}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":A=>T.JobTitle=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",n1,[V[26]||(V[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",r1,[e.createElementVNode("div",a1,[e.createVNode(o,{modelValue:T.Phone,"onUpdate:modelValue":A=>T.Phone=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",s1,[e.createVNode(o,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":A=>T.PhoneExt=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",d1,[e.createElementVNode("div",c1,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[27]||(V[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(o,{error:e.unref(l)[`contact-${C}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":A=>T.MobilePhone=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",i1,[e.createElementVNode("div",m1,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[28]||(V[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(o,{error:e.unref(l)[`contact-${C}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":A=>T.EMail=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),V[45]||(V[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",p1,[e.createElementVNode("table",V1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[29]||(V[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[V[30]||(V[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(k,{error:e.unref(l).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(g).Target,"onUpdate:modelValue":V[6]||(V[6]=T=>e.unref(g).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[31]||(V[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(g).Summary,"onUpdate:modelValue":V[7]||(V[7]=T=>e.unref(g).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[32]||(V[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Quantified,"onUpdate:modelValue":V[8]||(V[8]=T=>e.unref(g).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[33]||(V[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(g).Qualitative,"onUpdate:modelValue":V[9]||(V[9]=T=>e.unref(g).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",f1,[e.createElementVNode("table",N1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[V[39]||(V[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(S,{modelValue:e.unref(_),"onUpdate:modelValue":V[10]||(V[10]=T=>e.isRef(_)?_.value=T:null)},null,8,["modelValue"]),e.unref(_)?(e.openBlock(),e.createElementBlock("div",E1,[e.createElementVNode("table",b1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[V[34]||(V[34]=e.createElementVNode("th",null,"計畫名稱",-1)),V[35]||(V[35]=e.createElementVNode("th",null,"補助單位",-1)),V[36]||(V[36]=e.createElementVNode("th",{class:"text-end"},"補助金額(元)",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",g1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(T,C)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l)[`received-${C}-Name`],modelValue:T.Name,"onUpdate:modelValue":A=>T.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(l)[`received-${C}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":A=>T.Unit=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`received-${C}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":A=>T.Amount=A},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",y1,[e.createElementVNode("div",k1,[e.unref(m).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:A=>a(T),type:"button"},[...V[37]||(V[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,u1)):e.createCommentVNode("",!0),C+1===e.unref(m).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:u,type:"button"},[...V[38]||(V[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[V[42]||(V[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",h1,[e.createElementVNode("table",x1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[40]||(V[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l).Form1Before,rows:"4",modelValue:e.unref(i).Form1Before,"onUpdate:modelValue":V[11]||(V[11]=T=>e.unref(i).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...V[41]||(V[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l).Form1After,rows:"4",modelValue:e.unref(i).Form1After,"onUpdate:modelValue":V[12]||(V[12]=T=>e.unref(i).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",$1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:V[13]||(V[13]=T=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:V[14]||(V[14]=T=>h(!0)),type:"button"},[...V[46]||(V[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},_1={class:"block"},C1={key:0,class:"text-pink lh-base mt-4"},T1={class:"mt-4"},w1={class:"table align-middle gray-table"},D1={class:"text-center"},S1={key:0,width:"180"},A1={class:"text-center"},F1={key:0},U1=["innerHTML"],P1=["href"],M1={key:0,class:"text-center"},I1={key:0},j1={key:1,class:"text-pink"},O1={key:1,class:"tag-group mt-2 gap-1"},L1={key:0,class:"tag tag-green-light"},R1=["download","href"],q1=["onClick"],z1={key:1,class:"text-center mt-4"},G1={class:"mt-4"},J1={class:"table align-middle gray-table side-table"},Y1={key:0,class:"block-bottom bg-light-teal"},Q1=["disabled"],H1={__name:"Attachment",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([{Type:1,Title:"申請表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=1&id=${y.id}`,Files:[]},{Type:2,Title:"計畫書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=2&id=${y.id}`,Files:[]},{Type:3,Title:"執行承諾書",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=3&id=${y.id}`,Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:`../../Service/OFS/DownloadTemplateMUL.ashx?type=4&id=${y.id}`,Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),i=e.ref(),N=e.computed(()=>c.value.some(d=>!d.Optional&&!d.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>J("multiple",t.value.Status,2)),l=e.ref({}),t=e.ref({}),m=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:t.value.ProjectID+"_"+(d.Multiple?a.Name:`${d.Title}.pdf`)})},g=F.download,b=B,_=()=>{rxjs.forkJoin([F.multiple("getAttachment",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=c.value.filter(h=>{var E;return!((E=h.Excludes)!=null&&E.includes(t.value.OrgCategory))}),t.value.Status>=42&&c.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),c.value.forEach(h=>{h.Files=a.Attachments.filter(E=>E.Type===h.Type),h.Uploaded=e.computed(()=>h.Files.filter(E=>!E.Deleted).length)}),j().init("multiple",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},u=d=>{var h,E;if(l.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:y.id,Attachments:c.value.reduce((n,V)=>n.concat(V.Files),[]),Before:(h=i.value)==null?void 0:h.Form5Before,After:(E=i.value)==null?void 0:E.Form5After,Submit:d?"true":"false"};F.multiple("saveAttachment",a).subscribe(n=>{n&&(d?b("next",_):_())})},p=()=>{if(i.value){const d={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(l.value,I(i.value,d))}return!Object.keys(l.value).length};return e.onMounted(_),e.provide("editable",r),(d,a)=>{const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file"),n=e.resolveComponent("tw-date-time"),V=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_1,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",C1,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",T1,[e.createElementVNode("table",w1,[e.createElementVNode("thead",D1,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",S1,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",A1,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[s.Optional?(e.openBlock(),e.createElementBlock("span",F1,e.toDisplayString(s.Title),1)):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.Title),1)]),_:2},1024))]),e.unref(r)&&s.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:s.Comment},null,8,U1)):e.createCommentVNode("",!0),e.unref(r)&&s.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",download:"",href:s.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,P1)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",M1,[s.Uploaded?(e.openBlock(),e.createElementBlock("span",I1,"已上傳")):(e.openBlock(),e.createElementBlock("span",j1,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(s.Multiple||!s.Uploaded)?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:f=>m(s,f)},null,8,["onFile"])):e.createCommentVNode("",!0),s.Uploaded?(e.openBlock(),e.createElementBlock("div",O1,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",L1,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(g)(f.Path)},e.toDisplayString(f.Name),9,R1),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:k=>f.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,q1)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(t).ApplyTime?(e.openBlock(),e.createElementBlock("div",z1,[a[10]||(a[10]=e.createTextVNode("申請送件時間：",-1)),e.createVNode(n,{value:e.unref(t).ApplyTime},null,8,["value"])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",G1,[e.createElementVNode("table",J1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5Before,rows:"4",modelValue:e.unref(i).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=s=>e.unref(i).Form5Before=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(h,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{error:e.unref(l).Form5After,rows:"4",modelValue:e.unref(i).Form5After,"onUpdate:modelValue":a[1]||(a[1]=s=>e.unref(i).Form5After=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Y1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=s=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=s=>u(!0)),disabled:e.unref(N),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Q1)])):e.createCommentVNode("",!0)],64)}}},W1={class:"block"},K1={class:"mt-4"},X1={class:"table-responsive mt-3 mb-0"},Z1={class:"table align-middle gray-table"},v1={key:0,width:"1"},eE={key:0},tE={class:"d-flex gap-2"},lE=["onClick"],oE={class:"table-responsive mt-3 mb-0"},nE={class:"table align-middle gray-table"},rE={class:"mt-4"},aE={class:"table align-middle gray-table side-table"},sE={key:0,class:"block-bottom bg-light-teal"},dE={__name:"Benefit",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=e.ref(),N=e.computed(()=>J("multiple",t.value.Status,4)),r=e.ref({}),l=e.computed(()=>c.value.filter(d=>!d.Deleted)),t=e.ref({}),m=()=>c.value.push({}),g=B,b=()=>{rxjs.forkJoin([F.multiple("getBenefit",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(d=>{const a=d[0];t.value=a.Project,c.value=a.Benefits,c.value.length||m(),j().init("multiple",t.value),i.value=t.value.changeApply,t.value.changeApply=void 0})},_=d=>d.Deleted=!0,u=d=>{var h,E;if(r.value={},d&&!p()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:t.value,Benefits:c.value,Before:(h=i.value)==null?void 0:h.Form4Before,After:(E=i.value)==null?void 0:E.Form4After,Submit:d?"true":"false"};F.multiple("saveBenefit",a).subscribe(()=>{d?g("next"):b()})},p=()=>{let d={Benefit:"不可量化成果"};return r.value=I(t.value,d),d={Title:"指標",Target:"目標值",Description:"說明"},l.value.forEach((a,h)=>Object.assign(r.value,I(a,d,`item-${h}-`))),i.value&&(d={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,I(i.value,d))),!Object.keys(r.value).length};return e.onMounted(b),e.provide("editable",N),(d,a)=>{const h=e.resolveComponent("input-text"),E=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",W1,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",K1,[e.createElementVNode("div",X1,[e.createElementVNode("table",Z1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",v1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(V,s)=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Title`],modelValue:V.Title,"onUpdate:modelValue":o=>V.Title=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(r)[`item-${s}-Target`],modelValue:V.Target,"onUpdate:modelValue":o=>V.Target=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r)[`item-${s}-Description`],rows:"1",modelValue:V.Description,"onUpdate:modelValue":o=>V.Description=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",eE,[e.createElementVNode("div",tE,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:o=>_(V),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,lE)):e.createCommentVNode("",!0),s+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:m,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",oE,[e.createElementVNode("table",nE,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(t).Benefit,"onUpdate:modelValue":a[0]||(a[0]=V=>e.unref(t).Benefit=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",rE,[e.createElementVNode("table",aE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(i).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=V=>e.unref(i).Form4Before=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(E,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(i).Form4After,"onUpdate:modelValue":a[2]||(a[2]=V=>e.unref(i).Form4After=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",sE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=V=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=V=>u(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},cE={class:"block"},iE={class:"mt-4"},mE={class:"table-responsive mt-3 mb-0"},pE={class:"table align-middle gray-table"},VE={class:"text-end"},fE={class:"text-end"},NE={class:"table-responsive"},EE={class:"table align-middle gray-table"},bE=["colspan"],gE={key:0,width:"1"},yE={class:"text-end"},kE={key:0},uE={class:"d-flex gap-2"},hE=["onClick"],xE={class:"mt-4"},$E={class:"table-responsive mt-3 mb-0"},BE={class:"table align-middle gray-table"},_E={key:0,width:"1"},CE={class:"text-end"},TE={key:0},wE={class:"d-flex gap-2"},DE=["onClick"],SE={class:"mt-4"},AE={class:"table align-middle gray-table side-table"},FE={key:0,class:"block-bottom bg-light-teal"},UE={class:"text-center"},PE={class:"mb-5"},ME={__name:"Funding",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(),i=e.computed(()=>J("multiple",t.value.Status,3)),N=e.ref({}),r=e.computed(()=>g.value.filter(s=>!s.Deleted)),l=e.computed(()=>b.value.filter(s=>!s.Deleted)),t=e.ref({}),m=e.ref(),g=e.ref([]),b=e.ref([]),_=e.ref({}),u=e.ref(0),p=()=>g.value.push({}),d=()=>b.value.push({}),a=B,h=()=>{rxjs.forkJoin([F.multiple("getFunding",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];t.value=o.Project,g.value=o.OtherSubsidies,b.value=o.BudgetPlans,_.value=o.GrantTargetSetting,b.value.length||d(),j().init("multiple",t.value),c.value=t.value.changeApply,t.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=(s,o)=>{var k,S;if(N.value={},s&&!V()){e.nextTick(()=>{var D;return(D=document.querySelector(".invalid"))==null?void 0:D.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!o&&t.value.ApplyAmount>_.value.GrantLimit*1e4){m.value.show(()=>n(s,!0));return}const f={Project:t.value,OtherSubsidies:g.value,BudgetPlans:b.value,Before:(k=c.value)==null?void 0:k.Form3Before,After:(S=c.value)==null?void 0:S.Form3After,Submit:s?"true":"false"};F.multiple("saveFunding",f).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=I(t.value,s),s={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},r.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`other-${f}-`))),s={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},l.value.forEach((o,f)=>Object.assign(N.value,I(o,s,`plan-${f}-`))),c.value&&(s={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,I(c.value,s))),!Object.keys(N.value).length};return e.onMounted(h),e.provide("editable",i),e.watchEffect(()=>{t.value.OtherAmount=r.value.reduce((s,o)=>s+q(o.Amount),0),u.value=q(t.value.ApplyAmount)+q(t.value.SelfAmount)+q(t.value.OtherAmount),r.value.forEach(s=>s.percent=Math.round(q(s.Amount)/t.value.OtherAmount*1e4)/100),b.value.forEach(s=>s.sum=q(s.Amount)+q(s.OtherAmount))}),(s,o)=>{var C;const f=e.resolveComponent("input-integer"),k=e.resolveComponent("input-text"),S=e.resolveComponent("input-textarea"),D=e.resolveComponent("required-label"),T=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",cE,[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",iE,[e.createElementVNode("div",mE,[e.createElementVNode("table",pE,[o[6]||(o[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額(元) (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款(元) (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額(元) (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費(元) (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).ApplyAmount,modelValue:e.unref(t).ApplyAmount,"onUpdate:modelValue":o[0]||(o[0]=A=>e.unref(t).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N).SelfAmount,modelValue:e.unref(t).SelfAmount,"onUpdate:modelValue":o[1]||(o[1]=A=>e.unref(t).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",VE,e.toDisplayString((C=e.unref(t).OtherAmount)==null?void 0:C.toLocaleString()),1),e.createElementVNode("td",fE,e.toDisplayString(e.unref(u).toLocaleString()),1)])])])]),o[14]||(o[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",NE,[e.createElementVNode("table",EE,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(i)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,bE)]),e.createElementVNode("tr",null,[o[7]||(o[7]=e.createElementVNode("th",{width:"1"},null,-1)),o[8]||(o[8]=e.createElementVNode("th",null,"單位名稱",-1)),o[9]||(o[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額(元)（含尚未核定者）",-1)),o[10]||(o[10]=e.createElementVNode("th",null,"比例",-1)),o[11]||(o[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",gE,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`other-${w}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":P=>A.Unit=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`other-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",yE,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`other-${w}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":P=>A.Content=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",kE,[e.createElementVNode("div",uE,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[12]||(o[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,hE)])])):e.createCommentVNode("",!0)]))),128))])]),e.unref(i)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[13]||(o[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增",-1)])])):e.createCommentVNode("",!0)])]),o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",xE,[e.createElementVNode("div",$E,[e.createElementVNode("table",BE,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[15]||(o[15]=e.createElementVNode("th",null,"預算項目",-1)),o[16]||(o[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),o[17]||(o[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),o[18]||(o[18]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額(元)"),e.createElementVNode("br"),e.createTextVNode("小計")],-1)),o[19]||(o[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock("th",_E,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(A,w)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(N)[`plan-${w}-Title`],modelValue:A.Title,"onUpdate:modelValue":P=>A.Title=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":P=>A.Amount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(N)[`plan-${w}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":P=>A.OtherAmount=P},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",CE,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N)[`plan-${w}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":P=>A.Description=P,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(i)?(e.openBlock(),e.createElementBlock("td",TE,[e.createElementVNode("div",wE,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:P=>E(A),type:"button"},[...o[20]||(o[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,DE)):e.createCommentVNode("",!0),w+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(c)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[24]||(o[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",SE,[e.createElementVNode("table",AE,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[22]||(o[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(c).Form3Before,"onUpdate:modelValue":o[2]||(o[2]=A=>e.unref(c).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(D,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(c).Form3After,"onUpdate:modelValue":o[3]||(o[3]=A=>e.unref(c).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(i)?(e.openBlock(),e.createElementBlock("div",FE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=A=>n(!0)),type:"button"},[...o[27]||(o[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(T,{ref_key:"modal",ref:m},{default:e.withCtx(()=>[e.createElementVNode("div",UE,[o[28]||(o[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",PE,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(_).GrantLimit)+"萬",1),o[29]||(o[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),o[30]||(o[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},IE={class:"block"},jE={class:"square-title"},OE={class:"text-teal fw-bold py-3"},LE={class:"table-responsive mb-0"},RE={class:"table align-middle gray-table"},qE={class:"text-end"},zE={class:"text-teal fw-bold pb-3"},GE={class:"text-teal fw-bold pb-3"},JE={class:"mt-4"},YE={class:"table align-middle gray-table"},QE={class:"text-center"},HE={key:0,width:"180"},WE={class:"text-center"},KE=["href"],XE={key:0,class:"text-center"},ZE={key:0},vE={key:1,class:"text-pink"},eb={key:1,class:"tag-group mt-2 gap-1"},tb={key:0,class:"tag tag-green-light"},lb=["download","href"],ob=["onClick"],nb={key:0,class:"block-bottom bg-light-teal"},rb=["disabled"],ab={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>m.value.some(d=>!d.Files.filter(a=>!a.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var d;return((d=l.value)==null?void 0:d.Status)==="通過"}),l=e.ref(),t=e.ref({}),m=e.ref([{Type:11,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]}]),g=(d,a)=>{a.Type==="application/pdf"&&d.Files.push({Type:d.Type,Path:a.Path,Name:`${t.value.ProjectID}_第一期_${d.Title}.pdf`})},b=F.download,_=B,u=()=>{F.multiple("getPayment",{ID:y.id}).subscribe(d=>{t.value=d.Project,j().init("multiple",t.value),m.value=m.value.filter(a=>{var h;return!((h=a.Excludes)!=null&&h.includes(t.value.OrgCategory))}),m.value.forEach(a=>{a.Files=d.Attachments.filter(h=>h.Type===a.Type),a.Uploaded=e.computed(()=>a.Files.filter(h=>!h.Deleted).length)}),l.value=d.Payments.find(a=>a.Stage===1),l.value?c.value=l.value.CurrentRequestAmount:c.value=Math.round(t.value.ApprovedAmount*y.setting.DisbursementRatioPct/100),H().init(l.value)})},p=d=>{const a={Payment:{ProjectID:y.id,Stage:1,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:c.value},Attachments:m.value.reduce((h,E)=>h.concat(E.Files),[]),Submit:d?"true":"false"};F.multiple("savePayment",a).subscribe(h=>{h&&(d?_("next",u):u())})};return e.onMounted(u),e.provide("editable",N),(d,a)=>{var n;const h=e.resolveComponent("required-label"),E=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",IE,[e.createElementVNode("h5",jE,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",OE,"核定經費: "+e.toDisplayString((n=e.unref(t).ApprovedAmount)==null?void 0:n.toLocaleString())+"元",1),e.createElementVNode("div",LE,[e.createElementVNode("table",RE,[a[6]||(a[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",qE,e.toDisplayString(e.unref(c)),1),a[2]||(a[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[3]||(a[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[4]||(a[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[5]||(a[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",zE,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",GE,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),a[13]||(a[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",JE,[e.createElementVNode("table",YE,[e.createElementVNode("thead",QE,[e.createElementVNode("tr",null,[a[7]||(a[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[8]||(a[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",HE,"狀態")):e.createCommentVNode("",!0),a[9]||(a[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(V,s)=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",WE,e.toDisplayString(s+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(h,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(V.Title),1)]),_:2},1024)]),e.unref(N)&&V.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:V.Template,style:{width:"140px"},type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,KE)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",XE,[V.Uploaded?(e.openBlock(),e.createElementBlock("span",ZE,"已上傳")):(e.openBlock(),e.createElementBlock("span",vE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!V.Uploaded?(e.openBlock(),e.createBlock(E,{key:0,accept:".pdf",onFile:o=>g(V,o)},null,8,["onFile"])):e.createCommentVNode("",!0),V.Uploaded?(e.openBlock(),e.createElementBlock("div",eb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.Files,o=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o},[o.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",tb,[e.createElementVNode("a",{class:"tag-link my-1",download:o.Name,href:e.unref(b)(o.Path)},e.toDisplayString(o.Name),9,lb),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:f=>o.Deleted=!0,type:"button"},[...a[11]||(a[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ob)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",nb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[0]||(a[0]=V=>p()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[1]||(a[1]=V=>p(!0)),disabled:e.unref(i),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,rb)])):e.createCommentVNode("",!0)],64)}}},sb={class:"block"},db={class:"square-title"},cb={class:"text-teal fw-bold py-3"},ib={class:"table-responsive mb-0"},mb={class:"table align-middle gray-table"},pb={class:"text-end"},Vb={class:"text-end"},fb={class:"text-end"},Nb={class:"text-end"},Eb={class:"text-teal fw-bold pb-3"},bb={class:"text-teal fw-bold pb-3"},gb={class:"mt-4"},yb={class:"table align-middle gray-table"},kb={class:"text-center"},ub={key:0,width:"180"},hb={class:"text-center"},xb=["href"],$b={key:0,class:"text-center"},Bb={key:0},_b={key:1,class:"text-pink"},Cb={key:1,class:"tag-group mt-2 gap-1"},Tb={key:0,class:"tag tag-green-light"},wb=["download","href"],Db=["onClick"],Sb={key:0,class:"block-bottom bg-light-teal"},Ab=["disabled"],Fb={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.ref(0),N=e.computed(()=>c.value<=0||a.value.some(o=>!o.Files.filter(f=>!f.Deleted).length)),r=e.computed(()=>!m.value||m.value.Status==="請款中"),l=e.computed(()=>{var o;return((o=m.value)==null?void 0:o.Status)==="通過"}),t=e.ref(0),m=e.ref(),g=e.ref(0),b=e.ref(0),_=e.ref({}),u=e.computed(()=>_.value.ApprovedAmount?Math.min(Math.round(c.value*100/_.value.ApprovedAmount*100)/100,100):0),p=e.computed(()=>d.value?Math.round(c.value*100/d.value*100)/100:0),d=e.computed(()=>b.value+(l.value?m.value.CurrentActualPaidAmount:0)),a=e.ref([{Type:21,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:24,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),h=(o,f)=>{f.Type==="application/pdf"&&o.Files.push({Type:o.Type,Path:f.Path,Name:`${_.value.ProjectID}_第二期_${o.Title}.pdf`})},E=F.download,n=B,V=()=>{F.multiple("getPayment",{ID:y.id}).subscribe(o=>{_.value=o.Project,j().init("multiple",_.value),a.value=a.value.filter(k=>{var S;return!((S=k.Excludes)!=null&&S.includes(_.value.OrgCategory))}),a.value.forEach(k=>{k.Files=o.Attachments.filter(S=>S.Type===k.Type),k.Uploaded=e.computed(()=>k.Files.filter(S=>!S.Deleted).length)}),m.value=o.Payments.find(k=>k.Stage===2),m.value?i.value=m.value.CurrentRequestAmount:i.value=Math.round(_.value.ApprovedAmount*y.setting.DisbursementRatioPct/100);const f=o.Payments.filter(k=>k.Stage<2&&k.Status==="通過");g.value=f.reduce((k,S)=>k+S.CurrentRequestAmount,0),b.value=f.reduce((k,S)=>k+S.CurrentActualPaidAmount,0),t.value=_.value.ApprovedAmount,H().init(m.value,b.value)})},s=o=>{const f={Payment:{ProjectID:y.id,Stage:2,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,CurrentRequestAmount:i.value,TotalSpentAmount:c.value},Attachments:a.value.reduce((k,S)=>k.concat(S.Files),[]),Submit:o?"true":"false"};F.multiple("savePayment",f).subscribe(k=>{k&&(o?n("next",V):V())})};return e.onMounted(V),e.provide("editable",r),(o,f)=>{var T;const k=e.resolveComponent("input-integer"),S=e.resolveComponent("required-label"),D=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",sb,[e.createElementVNode("h5",db,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",cb,"核定經費: "+e.toDisplayString((T=e.unref(_).ApprovedAmount)==null?void 0:T.toLocaleString())+"元",1),e.createElementVNode("div",ib,[e.createElementVNode("table",mb,[f[3]||(f[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",pb,e.toDisplayString(e.unref(i)),1),e.createElementVNode("td",Vb,e.toDisplayString(e.unref(b)),1),e.createElementVNode("td",null,[e.createVNode(k,{max:e.unref(t),modelValue:e.unref(c),"onUpdate:modelValue":f[0]||(f[0]=C=>e.isRef(c)?c.value=C:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",fb,e.toDisplayString(e.unref(u))+"%",1),e.createElementVNode("td",Nb,e.toDisplayString(e.unref(p))+"%",1)])])])]),e.unref(l)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Eb,"本期實際撥款: "+e.toDisplayString(e.unref(m).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",bb,"累積實際撥款: "+e.toDisplayString(e.unref(d).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),f[9]||(f[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),f[10]||(f[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",gb,[e.createElementVNode("table",yb,[e.createElementVNode("thead",kb,[e.createElementVNode("tr",null,[f[4]||(f[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),f[5]||(f[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",ub,"狀態")):e.createCommentVNode("",!0),f[6]||(f[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(C,A)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",hb,e.toDisplayString(A+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(S,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Title),1)]),_:2},1024)]),e.unref(r)&&C.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:C.Template,style:{width:"140px"},type:"button"},[...f[7]||(f[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,xb)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",$b,[C.Uploaded?(e.openBlock(),e.createElementBlock("span",Bb,"已上傳")):(e.openBlock(),e.createElementBlock("span",_b,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!C.Uploaded?(e.openBlock(),e.createBlock(D,{key:0,accept:".pdf",onFile:w=>h(C,w)},null,8,["onFile"])):e.createCommentVNode("",!0),C.Uploaded?(e.openBlock(),e.createElementBlock("div",Cb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.Files,w=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:w},[w.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Tb,[e.createElementVNode("a",{class:"tag-link my-1",download:w.Name,href:e.unref(E)(w.Path)},e.toDisplayString(w.Name),9,wb),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:P=>w.Deleted=!0,type:"button"},[...f[8]||(f[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Db)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Sb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:f[1]||(f[1]=C=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:f[2]||(f[2]=C=>s(!0)),disabled:e.unref(N),type:"button"},[...f[11]||(f[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ab)])):e.createCommentVNode("",!0)],64)}}},Ub={class:"block"},Pb={class:"square-title"},Mb={class:"text-teal fw-bold py-3"},Ib={class:"text-teal fw-bold pb-3"},jb={class:"table-responsive"},Ob={class:"table align-middle gray-table"},Lb={class:"text-end"},Rb={class:"text-end"},qb={class:"text-end"},zb={class:"mt-4"},Gb={class:"table align-middle gray-table"},Jb={class:"text-center"},Yb={key:0,width:"180"},Qb={class:"text-center"},Hb=["href"],Wb={key:0,class:"text-center"},Kb={key:0},Xb={key:1,class:"text-pink"},Zb={key:1,class:"tag-group mt-2 gap-1"},vb={key:0,class:"tag tag-green-light"},eg=["download","href"],tg=["onClick"],lg={class:"text-center"},og={colspan:"2"},ng={key:0,class:"block-bottom bg-light-teal"},rg=["disabled"],ag={__name:"Payment3",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref(0),i=e.computed(()=>c.value<=0||_.value.some(E=>!E.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.ref(0),l=e.ref(),t=e.ref(0),m=e.ref({}),g=e.computed(()=>m.value.ApprovedAmount?Math.min(Math.round(c.value*100/m.value.ApprovedAmount*100)/100,100):0),b=e.computed(()=>t.value?Math.round(c.value*100/t.value*100)/100:0),_=e.ref([{Type:31,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:32,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:33,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:34,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),u=(E,n)=>{n.Type==="application/pdf"&&E.Files.push({Type:E.Type,Path:n.Path,Name:`${m.value.ProjectID}_結案核銷_${E.Title}.pdf`})},p=F.download,d=B,a=()=>{F.multiple("getPayment",{ID:y.id}).subscribe(E=>{m.value=E.Project,j().init("multiple",m.value),_.value=_.value.filter(n=>{var V;return!((V=n.Excludes)!=null&&V.includes(m.value.OrgCategory))}),_.value.forEach(n=>{n.Files=E.Attachments.filter(V=>V.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(V=>!V.Deleted).length)}),l.value=E.Payments.find(n=>n.Stage===3),t.value=E.Payments.filter(n=>n.Stage<3&&n.Status==="通過").reduce((n,V)=>n+V.CurrentActualPaidAmount,0),r.value=m.value.ApprovedAmount,H().init(l.value,t.value)})},h=E=>{const n={Payment:{ProjectID:y.id,Stage:3,ActDisbursementRatioPct:y.setting.DisbursementRatioPct,TotalSpentAmount:c.value},Attachments:_.value.reduce((V,s)=>V.concat(s.Files),[]),Submit:E?"true":"false"};F.multiple("savePayment",n).subscribe(V=>{V&&(E?d("next",a):a())})};return e.onMounted(a),e.provide("editable",N),(E,n)=>{var k;const V=e.resolveComponent("input-integer"),s=e.resolveComponent("required-label"),o=e.resolveComponent("input-file"),f=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ub,[e.createElementVNode("h5",Pb,e.toDisplayString(x.setting.DisbursementType)+e.toDisplayString(x.setting.Note),1),e.createElementVNode("p",Mb,"核定經費: "+e.toDisplayString((k=e.unref(m).ApprovedAmount)==null?void 0:k.toLocaleString())+"元",1),e.createElementVNode("p",Ib,"賸餘款: "+e.toDisplayString((e.unref(m).ApprovedAmount-e.unref(c)).toLocaleString())+"元",1),e.createElementVNode("div",jb,[e.createElementVNode("table",Ob,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額(元)"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額(元)"),e.createElementVNode("th",null,"累積實支金額(元)"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",Lb,e.toDisplayString(e.unref(t)),1),e.createElementVNode("td",null,[e.createVNode(V,{max:e.unref(r),modelValue:e.unref(c),"onUpdate:modelValue":n[0]||(n[0]=S=>e.isRef(c)?c.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Rb,e.toDisplayString(e.unref(g))+"%",1),e.createElementVNode("td",qb,e.toDisplayString(e.unref(b))+"%",1)])])])]),n[11]||(n[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[12]||(n[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",zb,[e.createElementVNode("table",Gb,[e.createElementVNode("thead",Jb,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Yb,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),(S,D)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",Qb,e.toDisplayString(D+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(N)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Hb)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Wb,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",Kb,"已上傳")):(e.openBlock(),e.createElementBlock("span",Xb,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!S.Uploaded?(e.openBlock(),e.createBlock(o,{key:0,accept:".pdf",onFile:T=>u(S,T)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",Zb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",vb,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(p)(T.Path)},e.toDisplayString(T.Name),9,eg),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:C=>T.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,tg)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128)),e.createElementVNode("tr",null,[e.createElementVNode("td",lg,e.toDisplayString(e.unref(_).length+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...n[10]||(n[10]=[e.createTextVNode("其他資料（5分鐘精華影片）",-1)])]),_:1})])]),e.createElementVNode("td",og,[e.createVNode(f)])])])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",ng,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=S=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=S=>h(!0)),disabled:e.unref(i),type:"button"},[...n[13]||(n[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,rg)])):e.createCommentVNode("",!0)],64)}}},sg={__name:"ProgressBar",setup(x){const B=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(y,c)=>{const i=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(i,{steps:B,type:"multiple"})}}},dg={class:"block"},cg={class:"mt-4"},ig={class:"table align-middle gray-table side-table"},mg={key:0,class:"d-flex align-items-center gap-2"},pg={class:"input-group w-auto"},Vg={class:"text-teal-dark"},fg={key:1,class:"invalid mt-0"},Ng={class:"table-responsive mt-4"},Eg={class:"table align-middle gray-table"},bg={key:0},gg={class:"input-group"},yg={key:0,class:"invalid mt-0"},kg={key:0},ug={class:"d-flex gap-2"},hg=["onClick"],xg={class:"mt-4"},$g={class:"table align-middle gray-table"},Bg={key:0},_g=["value"],Cg={key:0},Tg={class:"d-flex gap-2"},wg=["onClick"],Dg={class:"mt-4"},Sg={class:"table align-middle gray-table side-table"},Ag={key:0,class:"block-bottom bg-light-teal"},Fg={__name:"WorkSchedule",props:{apply:{default:!1,type:Boolean},id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=[{value:1,text:"50%"},{value:2,text:"100%"}],i=e.ref(),N=e.computed(()=>b.value.PlanEndDate),r=e.computed(()=>J("multiple",g.value.Status,2)),l=e.ref({}),t=e.computed(()=>_.value.filter(s=>!s.Deleted)),m=e.computed(()=>u.value.filter(s=>!s.Deleted)),g=e.ref({}),b=e.ref({}),_=e.ref([]),u=e.ref([]),p=()=>F.multiple("createItem",{ID:y.id}).subscribe(s=>_.value.push(s)),d=()=>u.value.push({Type:0,ItemID:0}),a=B,h=()=>{rxjs.forkJoin([F.multiple("getWorkSchedule",{Apply:y.apply?"true":"false",ID:y.id})]).subscribe(s=>{const o=s[0];g.value=o.Project,b.value=o.GrantType,_.value=o.Items,u.value=o.Schedules,_.value.length||p(),u.value.length||d(),j().init("multiple",g.value),i.value=g.value.changeApply,g.value.changeApply=void 0})},E=s=>s.Deleted=!0,n=s=>{var f,k;if(l.value={},s&&!V()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const o={Project:g.value,Items:_.value,Schedules:u.value,Before:(f=i.value)==null?void 0:f.Form2Before,After:(k=i.value)==null?void 0:k.Form2After,Submit:s?"true":"false"};F.multiple("saveWorkSchedule",o).subscribe(()=>{s?a("next"):h()})},V=()=>{let s={StartTime:"計畫期程",EndTime:"計畫期程"};return l.value=I(g.value,s),s={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},t.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`item-${f}-`))),s={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},m.value.forEach((o,f)=>Object.assign(l.value,I(o,s,`schedule-${f}-`))),i.value&&(s={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(l.value,I(i.value,s))),!Object.keys(l.value).length};return e.onMounted(h),e.provide("editable",r),(s,o)=>{const f=e.resolveComponent("required-label"),k=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),D=e.resolveComponent("input-text"),T=e.resolveComponent("input-month"),C=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",dg,[o[26]||(o[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",cg,[e.createElementVNode("table",ig,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[6]||(o[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",mg,[e.createElementVNode("div",pg,[e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).StartTime,"onUpdate:modelValue":o[0]||(o[0]=w=>e.unref(g).StartTime=w)},null,8,["max-date","modelValue"]),o[7]||(o[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(k,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(g).EndTime,"onUpdate:modelValue":o[1]||(o[1]=w=>e.unref(g).EndTime=w)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",Vg,[o[8]||(o[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(N)},null,8,["value"]),o[9]||(o[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(l).StartTime||e.unref(l).EndTime?(e.openBlock(),e.createElementBlock("div",fg,e.toDisplayString(e.unref(l).StartTime||e.unref(l).EndTime),1)):e.createCommentVNode("",!0)])])])])]),o[27]||(o[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Ng,[e.createElementVNode("table",Eg,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[14]||(o[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[10]||(o[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[11]||(o[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[12]||(o[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[13]||(o[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",bg,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+P)),1),e.createElementVNode("td",null,[e.createVNode(D,{error:e.unref(l)[`item-${P}-Title`],modelValue:w.Title,"onUpdate:modelValue":U=>w.Title=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",gg,[e.createVNode(T,{"empty-value":0,modelValue:w.Begin,"onUpdate:modelValue":U=>w.Begin=U},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(T,{"empty-value":0,modelValue:w.End,"onUpdate:modelValue":U=>w.End=U},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]?(e.openBlock(),e.createElementBlock("div",yg,e.toDisplayString(e.unref(l)[`item-${P}-Begin`]||e.unref(l)[`item-${P}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`item-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`item-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",kg,[e.createElementVNode("div",ug,[e.unref(t).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[15]||(o[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,hg)):e.createCommentVNode("",!0),P+1===e.unref(t).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:p,type:"button"},[...o[16]||(o[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),o[28]||(o[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",xg,[e.createElementVNode("table",$g,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[17]||(o[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[18]||(o[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[19]||(o[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[20]||(o[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Bg,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(w,P)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-Type`],options:c,modelValue:w.Type,"onUpdate:modelValue":U=>w.Type=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(l)[`schedule-${P}-ItemID`],options:e.unref(t),modelValue:w.ItemID,"onUpdate:modelValue":U=>w.ItemID=U,modelModifiers:{trim:!0}},{default:e.withCtx(({index:U,option:L})=>[e.createElementVNode("option",{value:L.ID},e.toDisplayString(String.fromCharCode(65+U))+"."+e.toDisplayString(L.Title),9,_g)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(l)[`schedule-${P}-Deadline`],modelValue:w.Deadline,"onUpdate:modelValue":U=>w.Deadline=U},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l)[`schedule-${P}-Content`],rows:"1",modelValue:w.Content,"onUpdate:modelValue":U=>w.Content=U,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Cg,[e.createElementVNode("div",Tg,[e.unref(m).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:U=>E(w),type:"button"},[...o[21]||(o[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,wg)):e.createCommentVNode("",!0),P+1===e.unref(m).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...o[22]||(o[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[o[25]||(o[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Dg,[e.createElementVNode("table",Sg,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[23]||(o[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2Before,rows:"4",modelValue:e.unref(i).Form2Before,"onUpdate:modelValue":o[2]||(o[2]=w=>e.unref(i).Form2Before=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...o[24]||(o[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(C,{error:e.unref(l).Form2After,rows:"4",modelValue:e.unref(i).Form2After,"onUpdate:modelValue":o[3]||(o[3]=w=>e.unref(i).Form2After=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Ag,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:o[4]||(o[4]=w=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:o[5]||(o[5]=w=>n(!0)),type:"button"},[...o[29]||(o[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Ug={class:"block bg-light-teal-100 rounded-4 py-4"},Pg={class:"fw-bold"},Mg={class:"d-flex align-items-center gap-3 text-teal-dark mt-3"},Ig={class:"block rounded-4 mt-4"},jg=["innerHTML"],Og={class:"mt-3 d-flex flex-column gap-2"},Lg=["download","href"],Rg={class:"mt-3"},qg=["data-caption","href"],zg=["alt","src"],Gg={class:"mt-3 d-flex flex-column gap-2"},Jg=["href"],Yg={__name:"NewsDetail",props:{id:{type:[Number,String]}},setup(x){const B=x,y=e.ref(),c=e.ref([]),i=e.ref({}),N=e.ref([]),r=e.ref([]),l=F.download;return e.onMounted(()=>{F.system("getNews",{ID:B.id}).subscribe(t=>{i.value=t.News,c.value=t.Files,N.value=t.Images,r.value=t.Videos,e.nextTick(()=>{Fancybox.bind(y.value,"[data-fancybox]")})})}),(t,m)=>{const g=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ug,[e.createElementVNode("h5",Pg,e.toDisplayString(e.unref(i).Title),1),e.createElementVNode("ul",Mg,[e.createElementVNode("li",null,[m[0]||(m[0]=e.createTextVNode("公告日期：",-1)),e.createVNode(g,{value:e.unref(i).EnableTime},null,8,["value"])]),e.createElementVNode("li",null,"公告單位："+e.toDisplayString(e.unref(i).UserOrg),1)])]),e.createElementVNode("div",Ig,[e.createElementVNode("div",{class:"mb-5",style:{"white-space":"pre-line"},innerHTML:e.unref(i).Content},null,8,jg),e.unref(c).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[m[2]||(m[2]=e.createElementVNode("h5",{class:"square-title"},"相關附件",-1)),e.createElementVNode("ul",Og,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),b=>(e.openBlock(),e.createElementBlock("li",{key:b},[e.createElementVNode("a",{class:"link-black",download:b.Name,href:e.unref(l)(b.Path)},[e.createTextVNode(e.toDisplayString(b.Name)+" ",1),m[1]||(m[1]=e.createElementVNode("i",{class:"fa-solid fa-file-arrow-down text-teal-dark ms-1"},null,-1))],8,Lg)]))),128))])],64)):e.createCommentVNode("",!0),e.unref(N).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[m[4]||(m[4]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關照片",-1)),e.createElementVNode("div",Rg,[e.createElementVNode("div",{class:"image-preview mt-3",ref_key:"container",ref:y},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(b,_)=>(e.openBlock(),e.createElementBlock("div",{class:"image-preview__item",key:b},[e.createElementVNode("a",{"data-fancybox":"gallery","data-caption":`相片 ${_}`,href:e.unref(l)(b.Path)},[e.createElementVNode("img",{alt:`相片 ${_}`,src:e.unref(l)(b.Path)},null,8,zg),m[3]||(m[3]=e.createElementVNode("div",{class:"image-preview__item-overlay"},[e.createElementVNode("button",{"aria-label":"檢視圖片",class:"btn btn-view-image",tabindex:"-1",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"})])],-1))],8,qg)]))),128))],512)])],64)):e.createCommentVNode("",!0),e.unref(r).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[m[6]||(m[6]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關影片",-1)),e.createElementVNode("ul",Gg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),b=>(e.openBlock(),e.createElementBlock("li",{key:b},[e.createElementVNode("a",{class:"link-black",href:b.URL,target:"_blank"},[e.createTextVNode(e.toDisplayString(b.Title)+" ",1),m[5]||(m[5]=e.createStaticVNode('<svg class="ms-1" xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19 24" fill="none"><g clip-path="url(#clip0_1051_6167)"><path d="M17.7333 0.5H12.6667C11.913 0.5 11.4 1.12067 11.4 1.76667C11.4 2.05167 11.4887 2.36833 11.7673 2.65967L13.4077 4.3L9.87367 7.834C9.60767 8.1 9.5 8.423 9.5 8.727C9.5 9.43633 10.0573 9.99367 10.7667 9.99367C11.096 9.99367 11.4127 9.87333 11.6597 9.62L15.1937 6.086L16.834 7.72633C17.1253 8.005 17.442 8.09367 17.727 8.09367C18.373 8.09367 18.9937 7.58067 18.9937 6.827V1.76667C18.9937 1.12067 18.4807 0.5 17.727 0.5H17.7333ZM15.2 7.88467L12.559 10.5257C12.084 11.0007 11.4443 11.2667 10.7667 11.2667C9.348 11.2667 8.23333 10.152 8.23333 8.73333C8.23333 8.05567 8.49933 7.42233 8.97433 6.941L11.6153 4.3L10.8743 3.559C10.716 3.39433 10.5957 3.217 10.488 3.03333H1.26667C0.563667 3.03333 0 3.597 0 4.3V18.2333C0 18.93 0.563667 19.5 1.26667 19.5H15.2C15.8967 19.5 16.4667 18.93 16.4667 18.2333V9.01833C16.2893 8.917 16.1183 8.79667 15.9663 8.651L15.2 7.88467Z" fill="#037F72"></path></g><defs><clipPath id="clip0_1051_6167"><rect width="19" height="19" fill="white" transform="translate(0 0.5)"></rect></clipPath></defs></svg>',1))],8,Jg)]))),128))])],64)):e.createCommentVNode("",!0)])],64)}}},Qg={class:"block rounded-4 mt-4"},Hg={class:"table-responsive",style:{"min-height":"400px"}},Wg={class:"table teal-table","aria-label":"公告列表"},Kg={"data-th":"公告時間:"},Xg={"data-th":"公告標題:",class:"text-start"},Zg=["href"],vg={"data-th":"發布單位:",class:"text-start"},ey={__name:"NewsList",setup(x){const B=e.ref([]),y=e.ref(1),c=e.ref(10),i=e.computed(()=>B.value.slice((y.value-1)*c.value,y.value*c.value)),N=(r,l)=>{y.value=parseInt(r),c.value=parseInt(l)};return e.onMounted(()=>{F.system("getPublishedNewsList").subscribe(r=>B.value=r.List)}),(r,l)=>{const t=e.resolveComponent("tw-date"),m=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",Qg,[l[1]||(l[1]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")])])],-1)),e.createElementVNode("div",Hg,[e.createElementVNode("table",Wg,[l[0]||(l[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告時間"),e.createElementVNode("th",{scope:"col",class:"text-start"},"標題"),e.createElementVNode("th",{scope:"col",style:{width:"300px"}},"發布單位")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),g=>(e.openBlock(),e.createElementBlock("tr",{key:g},[e.createElementVNode("td",Kg,[e.createVNode(t,{value:g.EnableTime},null,8,["value"])]),e.createElementVNode("td",Xg,[e.createElementVNode("a",{class:"link-black",href:`NewsDetail.aspx?ID=${g.ID}`},e.toDisplayString(g.Title),9,Zg)]),e.createElementVNode("td",vg,e.toDisplayString(g.UserOrg)+" "+e.toDisplayString(g.UserName),1)]))),128))])])]),e.createVNode(m,{count:e.unref(B).length,onChange:N,page:e.unref(y),"page-size":e.unref(c)},null,8,["count","page","page-size"])])}}},ty={key:0,class:"notice mb-3"},ly={class:"notice-content"},oy=["onClick"],ny={class:"notice-action"},ry=["href"],ay=ne({__name:"NewsMarquee",setup(x){let B=0;const y=e.ref([]),c=e.ref(),i=e.computed(()=>F.toUrl("/OFS/Information/NewsList.aspx")),N=r=>{window.open(F.toUrl(`/OFS/Information/NewsDetail.aspx?ID=${r.ID}`),"_blank")};return e.onMounted(()=>{F.system("getPublishedNewsList").subscribe(r=>{y.value=r.List,y.value.length>1&&setInterval(()=>{B++,c.value.style.transition="transform 1s ease-in-out",c.value.style.transform=`translateY(-${B*1.5}rem)`,B===y.value.length&&setTimeout(()=>{c.value.style.transition="none",c.value.style.transform="translateY(0)",B=0},1e3)},5e3)})}),(r,l)=>{const t=e.resolveComponent("tw-date");return e.unref(y).length?(e.openBlock(),e.createElementBlock("div",ty,[e.createElementVNode("div",ly,[e.createElementVNode("div",{class:"notice-list",ref_key:"marquee",ref:c},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),m=>(e.openBlock(),e.createElementBlock("h3",{class:"notice-title",onClick:g=>N(m),style:{"margin-bottom":"0.5rem",cursor:"pointer"},key:m},[e.createVNode(t,{value:m.EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(m.Title),1)],8,oy))),128)),e.unref(y).length>1?(e.openBlock(),e.createElementBlock("h3",{key:0,class:"notice-title",onClick:l[0]||(l[0]=m=>N(e.unref(y)[0])),style:{cursor:"pointer"}},[e.createVNode(t,{value:e.unref(y)[0].EnableTime},null,8,["value"]),e.createTextVNode(" "+e.toDisplayString(e.unref(y)[0].Title),1)])):e.createCommentVNode("",!0)],512)]),e.createElementVNode("div",ny,[e.createElementVNode("a",{class:"btn-link",href:e.unref(i)},"全部公告",8,ry)])])):e.createCommentVNode("",!0)}}},[["__scopeId","data-v-8802a1c0"]]),sy={key:0,class:"scroll-bottom-panel"},dy={class:"d-flex flex-column gap-3 mb-3"},cy={class:"d-flex gap-2"},iy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},my={class:"text-nowrap my-2 d-flex align-items-center"},py={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],i=e.ref({}),N=e.ref({ID:B.id,Result:1}),r=()=>{const t={};if(N.value.Result>1&&(t.Reason="原因"),i.value=I(N.value,t),Object.keys(i.value).length){l();return}F[B.type]("reviewApplicationChange",N.value).subscribe(m=>{m&&(window.location.href="../ReviewChecklist.aspx?type=5")})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,t=>{t>1&&l()}),(t,m)=>{const g=e.resolveComponent("input-radio-group"),b=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",sy,[m[3]||(m[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",dy,[e.createElementVNode("li",cy,[m[2]||(m[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",iy,[e.createElementVNode("div",my,[e.createVNode(g,{options:c,modelValue:e.unref(N).Result,"onUpdate:modelValue":m[0]||(m[0]=_=>e.unref(N).Result=_)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(b,{key:0,error:e.unref(i).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":m[1]||(m[1]=_=>e.unref(N).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Vy={key:0,class:"scroll-bottom-panel"},fy={class:"d-flex flex-column gap-3 mb-3"},Ny={class:"d-flex gap-2"},Ey={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},by={class:"text-nowrap my-2 d-flex align-items-center"},gy={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],i=e.ref({}),N=e.ref({ID:B.id,Result:1}),r=()=>{const t={};if(N.value.Result>1&&(t.Reason="原因"),i.value=I(N.value,t),Object.keys(i.value).length){l();return}F[B.type]("reviewApplication",N.value).subscribe(m=>{m&&(window.location.href="../ReviewChecklist.aspx?type=4")})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,t=>{t>1&&l()}),(t,m)=>{const g=e.resolveComponent("input-radio-group"),b=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",Vy,[m[3]||(m[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",fy,[e.createElementVNode("li",Ny,[m[2]||(m[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Ey,[e.createElementVNode("div",by,[e.createVNode(g,{options:c,modelValue:e.unref(N).Result,"onUpdate:modelValue":m[0]||(m[0]=_=>e.unref(N).Result=_)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(b,{key:0,error:e.unref(i).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":m[1]||(m[1]=_=>e.unref(N).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},yy={class:"d-flex align-items-center gap-3"},ky={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},uy={class:"modal-content"},hy={class:"modal-header"},xy={class:"fs-24 fw-bold text-green-light"},$y={class:"modal-body"},By={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},_y=["disabled"],Cy={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=e.computed(()=>!r.value||r.value===t[B.type].organizer),c=e.ref(),i=e.ref(),N=e.computed(()=>t[B.type].organizerName),r=e.ref(0),l=e.computed(()=>{var p;return(p=b.value.find(d=>d.UnitID===g.value))==null?void 0:p.reviewers}),t=j(),m=e.computed(()=>N.value?"移轉案件":"認領案件"),g=e.ref(0),b=e.ref([]),_=()=>{F[B.type]("queryReviewUnits").subscribe(p=>{b.value=p,rxjs.forkJoin(b.value.map(d=>F[B.type]("queryReviewersByUnit",{ID:d.UnitID}))).subscribe(d=>{d.forEach((a,h)=>{b.value[h].reviewers=a,a.some(E=>E.UserID===r.value)&&(g.value=b.value[h].UnitID)}),bootstrap.Modal.getOrCreateInstance(i.value).show()})})},u=()=>{F[B.type]("saveOrganizer",{ID:B.id,Organizer:r.value}).subscribe(p=>{p&&window.location.reload()})};return e.onMounted(()=>{F.system("getRoles").subscribe(p=>{c.value=p.IsOrganizer||p.IsSupervisor||p.IsSysAdmin})}),e.watch(N,()=>r.value=t[B.type].organizer),e.watch(g,()=>{l.value.some(p=>p.UserID===r.value)||(r.value=0)}),(p,d)=>{const a=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yy,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(N)||"尚無"),1),e.unref(c)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal",onClick:_,type:"button"},e.toDisplayString(e.unref(m)),1)):e.createCommentVNode("",!0)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:i,tabindex:"-1"},[e.createElementVNode("div",ky,[e.createElementVNode("div",uy,[e.createElementVNode("div",hy,[e.createElementVNode("h4",xy,e.toDisplayString(e.unref(m)),1),d[2]||(d[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",$y,[e.createElementVNode("div",null,[d[3]||(d[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(a,{"empty-value":0,options:e.unref(b),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(g),"onUpdate:modelValue":d[0]||(d[0]=h=>e.isRef(g)?g.value=h:null)},null,8,["options","modelValue"]),e.createVNode(a,{class:"mt-2","empty-value":0,options:e.unref(l),"text-name":"Name","value-name":"UserID",modelValue:e.unref(r),"onUpdate:modelValue":d[1]||(d[1]=h=>e.isRef(r)?r.value=h:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",By,[d[4]||(d[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:u,disabled:e.unref(y),type:"button"},"確認",8,_y)])])])])],512)]))],64)}}},Ty={key:0,class:"scroll-bottom-panel"},wy={class:"d-flex flex-column gap-3 mb-3"},Dy={key:0,class:"d-flex gap-2 align-items-center"},Sy={key:1,class:"d-flex gap-2 align-items-center"},Ay={class:"d-flex gap-2"},Fy={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Uy={class:"text-nowrap my-2 d-flex align-items-center"},Py=["disabled"],My={__name:"ProjectPaymentReview",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j(),c=H(),i=[{value:1,text:"通過"},{value:2,text:"退回修改"}],N=e.computed(()=>!c.stage),r=e.ref({}),l=e.ref({ID:B.id,Result:1,Reason:""}),t=e.computed(()=>l.value.Result===1?B.type==="culture"&&c.stage===2||B.type==="education"||B.type==="accessibility"&&c.stage===2?"確定撥款及結案":B.type==="multiple"&&c.stage===3||B.type==="literacy"&&c.stage===2?"確定核銷及結案":"確定撥款":"確定退回"),m=()=>{const b={};if(l.value.Result>1&&(b.Reason="原因"),r.value=I(l.value,b),Object.keys(r.value).length){g();return}l.value.Stage=c.stage,F[B.type]("reviewPayment",l.value).subscribe(_=>{_&&(window.location.href="../ReviewChecklist.aspx?type=5")})},g=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>l.value.Result,b=>{b>1&&g()}),e.watch(()=>c.amount,b=>l.value.Amount=b),(b,_)=>{const u=e.resolveComponent("input-integer"),p=e.resolveComponent("input-radio-group"),d=e.resolveComponent("input-textarea");return e.unref(c).status==="審核中"&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",Ty,[_[6]||(_[6]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",wy,[e.unref(c).amount?(e.openBlock(),e.createElementBlock("li",Dy,[_[3]||(_[3]=e.createElementVNode("span",{class:"text-gray"},"本期撥付：",-1)),e.createVNode(u,{class:"w-auto",max:e.unref(c).amount,modelValue:e.unref(l).Amount,"onUpdate:modelValue":_[0]||(_[0]=a=>e.unref(l).Amount=a)},null,8,["max","modelValue"])])):e.createCommentVNode("",!0),e.unref(c).paid?(e.openBlock(),e.createElementBlock("li",Sy,[_[4]||(_[4]=e.createElementVNode("span",{class:"text-gray"},"前期累積撥付：",-1)),e.createTextVNode(" "+e.toDisplayString(e.unref(c).paid.toLocaleString()),1)])):e.createCommentVNode("",!0),e.createElementVNode("li",Ay,[_[5]||(_[5]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Fy,[e.createElementVNode("div",Uy,[e.createVNode(p,{options:i,modelValue:e.unref(l).Result,"onUpdate:modelValue":_[1]||(_[1]=a=>e.unref(l).Result=a)},null,8,["modelValue"])]),e.unref(l).Result>1?(e.openBlock(),e.createBlock(d,{key:0,error:e.unref(r).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(l).Reason,"onUpdate:modelValue":_[2]||(_[2]=a=>e.unref(l).Reason=a)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:m,disabled:e.unref(N),type:"button"},e.toDisplayString(e.unref(t)),9,Py)])):e.createCommentVNode("",!0)}}},Iy={class:"step-line-wrapper"},jy={class:"step-line"},Oy={key:0,class:"tag tag-white"},Ly={key:1,class:"tag tag-white"},Ry={key:0,class:"step-line"},qy={key:0,class:"tag tag-white"},zy={class:"step-line"},Gy={key:0,class:"tag tag-white"},Jy={key:0,class:"tag tag-white"},Yy={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(x){const B=j(),y=x,c=i=>{location.href=`${i}.aspx?ID=${y.id}`};return(i,N)=>(e.openBlock(),e.createElementBlock("div",Iy,[e.createElementVNode("div",jy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===1}]),onClick:N[0]||(N[0]=r=>c("Audit")),role:"button"},[N[4]||(N[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),x.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(B)[y.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",Oy,"編輯中")):e.unref(B)[y.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",Ly,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),x.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ry,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===4}]),onClick:N[1]||(N[1]=r=>c("Progress")),role:"button"},[N[5]||(N[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),x.step===4?(e.openBlock(),e.createElementBlock("div",qy,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",zy,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===5}]),onClick:N[2]||(N[2]=r=>c("Report")),role:"button"},[N[6]||(N[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),x.step===5?(e.openBlock(),e.createElementBlock("div",Gy,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:x.step===6}]),onClick:N[3]||(N[3]=r=>c("Payment")),role:"button"},[N[7]||(N[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),x.step===6?(e.openBlock(),e.createElementBlock("div",Jy,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},Qy={class:"block"},Hy={class:"square-title"},Wy=["innerHTML"],Ky={class:"table-responsive mt-3"},Xy={class:"table align-middle gray-table"},Zy={key:0,class:"text-center"},vy={class:"text-center"},ek=["href"],tk={key:0,class:"text-center"},lk={key:0},ok={key:1,class:"text-pink"},nk={key:1,class:"tag-group mt-2 gap-1"},rk={key:0,class:"tag tag-green-light"},ak=["download","href"],sk=["onClick"],dk={key:0,class:"block-bottom bg-light-teal"},ck=["disabled"],ik={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]},type:{type:String}},emits:["next"],setup(x,{emit:B}){let y;const c=x,i=e.computed(()=>N.value.some(u=>!u.Optional&&!u.Files.filter(p=>!p.Deleted).length)),N=e.ref(c.data.docs.map(u=>({...u,Files:[]}))),r=e.ref(),l=e.ref({}),t=(u,p)=>{(p.Type==="application/zip"||p.Type==="application/x-zip-compressed")&&u.Files.push({Type:u.Type,Path:p.Path,Name:`${c.id}_${u.Title}_${y}.zip`})},m=F.download,g=B,b=()=>{F[c.type]("getReport",{ID:c.id,Stage:c.data.id}).subscribe(u=>{var p;l.value=u.Report,N.value.forEach(d=>{d.Files=u.Attachments.filter(a=>a.Type===d.Type),d.Uploaded=e.computed(()=>d.Files.filter(a=>!a.Deleted).length)}),r.value=!l.value.Status||l.value.Status==="暫存"||l.value.Status==="退回修正",y=(p=l.value)!=null&&p.Reviewer?"修訂版":"初版",j().init(c.type,u.Project,l.value)})},_=u=>{const p={ID:c.id,Stage:c.data.id,Attachments:N.value.reduce((d,a)=>d.concat(a.Files),[]),Submit:u?"true":"false"};F[c.type]("saveReport",p).subscribe(d=>{d&&(u?g("next",b):b())})};return e.onMounted(b),e.provide("editable",r),(u,p)=>{const d=e.resolveComponent("required-label"),a=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qy,[e.createElementVNode("h5",Hy,e.toDisplayString(x.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:x.data.description},null,8,Wy),e.createElementVNode("div",Ky,[e.createElementVNode("table",Xy,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[p[2]||(p[2]=e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號",-1)),p[3]||(p[3]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Zy,"狀態")):e.createCommentVNode("",!0),p[4]||(p[4]=e.createElementVNode("th",null,"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(h,E)=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",vy,e.toDisplayString(E+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h.Title),1)]),_:2},1024)]),e.unref(r)&&h.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:h.Template,style:{width:"140px"},type:"button"},[...p[5]||(p[5]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ek)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",tk,[h.Uploaded?(e.openBlock(),e.createElementBlock("span",lk,"已上傳")):(e.openBlock(),e.createElementBlock("span",ok,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!h.Uploaded?(e.openBlock(),e.createBlock(a,{key:0,accept:".zip",onFile:n=>t(h,n)},null,8,["onFile"])):e.createCommentVNode("",!0),h.Uploaded?(e.openBlock(),e.createElementBlock("div",nk,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.Files,n=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:n},[n.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",rk,[e.createElementVNode("a",{class:"tag-link my-1",download:n.Name,href:e.unref(m)(n.Path)},e.toDisplayString(n.Name),9,ak),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:V=>n.Deleted=!0,type:"button"},[...p[6]||(p[6]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,sk)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",dk,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:p[0]||(p[0]=h=>_()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:p[1]||(p[1]=h=>_(!0)),disabled:e.unref(i),type:"button"},[...p[7]||(p[7]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ck)])):e.createCommentVNode("",!0)],64)}}},mk={key:0,class:"scroll-bottom-panel"},pk={class:"d-flex flex-column gap-3 mb-3"},Vk={class:"d-flex gap-2"},fk={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Nk={class:"text-nowrap my-2 d-flex align-items-center"},Ek={__name:"ProjectReportReview",props:{id:{type:[Number,String]},stage:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"退回修改"}],i=e.ref({}),N=e.ref({ID:B.id,Result:1}),r=()=>{const t={};if(N.value.Result>1&&(t.Reason="原因"),i.value=I(N.value,t),Object.keys(i.value).length){l();return}N.value.Stage=B.stage,F[B.type]("reviewReport",N.value).subscribe(m=>{m&&(window.location.href="../ReviewChecklist.aspx?type=6")})},l=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,t=>{t>1&&l()}),(t,m)=>{const g=e.resolveComponent("input-radio-group"),b=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",mk,[m[3]||(m[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",pk,[e.createElementVNode("li",Vk,[m[2]||(m[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",fk,[e.createElementVNode("div",Nk,[e.createVNode(g,{options:c,modelValue:e.unref(N).Result,"onUpdate:modelValue":m[0]||(m[0]=_=>e.unref(N).Result=_)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(b,{key:0,error:e.unref(i).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":m[1]||(m[1]=_=>e.unref(N).Reason=_)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},bk={key:0,class:"scroll-bottom-panel"},gk={class:"d-flex flex-column gap-3 mb-3"},yk={class:"d-flex gap-2"},kk={class:"d-flex gap-2"},uk={class:"text-pink"},hk={class:"d-flex gap-2"},xk={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},$k={class:"text-nowrap mb-2 d-flex align-items-center"},Bk={key:0,class:"invalid mt-0"},_k={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(x){const B=x,y=j(),c=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],i=["無","低風險","中風險","高風險"],N=e.ref({}),r=e.ref({ID:B.id,Result:1}),l=e.ref({}),t=e.ref(0),m=()=>{window.open(F.toUrl(`/OFS/ApplicationChecklist.aspx?Year=${l.value.Year}&OrgName=${encodeURIComponent(l.value.OrgName)}`),"_blank")},g=()=>{window.open(F.toUrl(`/OFS/AuditHistory.aspx?Name=${encodeURIComponent(l.value.OrgName)}`),"_blank")},b=()=>{const u={};if(r.value.Result>1&&(u.Reason="原因"),r.value.Result===3&&(u.CorrectionDeadline="補正期限"),N.value=I(r.value,u),Object.keys(N.value).length){_();return}F[B.type]("reviewApplication",r.value).subscribe(p=>{p&&(window.location.href="../ReviewChecklist.aspx?type=1")})},_=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.onMounted(()=>{F[B.type]("getReviewInfo",{ID:B.id}).subscribe(u=>{l.value=u,l.value.AuditRecords.forEach(p=>{switch(p.Risk){case"Low":t.value<1&&(t.value=1);break;case"Medium":t.value<2&&(t.value=2);break;case"High":t.value<3&&(t.value=3);break}})})}),e.watch(()=>r.value.Result,u=>{u>1&&_()}),(u,p)=>{const d=e.resolveComponent("input-radio-group"),a=e.resolveComponent("input-tw-date"),h=e.resolveComponent("input-textarea");return e.unref(y)[x.type].organizer&&e.unref(y)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("div",bk,[p[8]||(p[8]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",gk,[e.createElementVNode("li",yk,[p[3]||(p[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:m,href:"javascript:void(0)"},e.toDisplayString(e.unref(l).OtherCount),1)]),e.createElementVNode("li",kk,[p[6]||(p[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),e.createElementVNode("span",uk,e.toDisplayString(i[e.unref(t)]),1),e.createElementVNode("span",null,[p[4]||(p[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:g,href:"javascript:void(0)"},e.toDisplayString(e.unref(l).AuditRecords.length),1),p[5]||(p[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",hk,[p[7]||(p[7]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",xk,[e.createElementVNode("div",$k,[e.createVNode(d,{options:c,modelValue:e.unref(r).Result,"onUpdate:modelValue":p[0]||(p[0]=E=>e.unref(r).Result=E)},null,8,["modelValue"]),e.createVNode(a,{class:"form-control",drops:"up",modelValue:e.unref(r).CorrectionDeadline,"onUpdate:modelValue":p[1]||(p[1]=E=>e.unref(r).CorrectionDeadline=E)},null,8,["modelValue"])]),e.unref(N).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",Bk,e.toDisplayString(e.unref(N).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(r).Result>1?(e.openBlock(),e.createBlock(h,{key:1,error:e.unref(N).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(r).Reason,"onUpdate:modelValue":p[2]||(p[2]=E=>e.unref(r).Reason=E)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:b,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Ck={class:"top-wrapper"},Tk={class:"top-block"},wk={class:"d-flex align-items-center gap-3"},Dk={key:0,class:"tag tag-light-gray"},Sk={key:1,class:"tag tag-light-pink"},Ak={key:2,class:"tag tag-pale-green"},Fk=["href"],Uk={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=x,y=j(),c=e.ref();return e.onMounted(()=>{F.system("getProjectTodoTask",{ID:B.id}).subscribe(i=>c.value=i==null?void 0:i.TaskName)}),(i,N)=>(e.openBlock(),e.createElementBlock("div",Ck,[e.createElementVNode("div",Tk,[e.createElementVNode("div",wk,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(y)[B.type].type)+"］"+e.toDisplayString(e.unref(y)[B.type].id)+"/"+e.toDisplayString(e.unref(y)[B.type].name),1),e.unref(y)[x.type].status===91?(e.openBlock(),e.createElementBlock("span",Dk,"計畫已結案")):e.unref(y)[x.type].status===99?(e.openBlock(),e.createElementBlock("span",Sk,"計畫已終止")):e.unref(c)?(e.openBlock(),e.createElementBlock("span",Ak,"待辦事項："+e.toDisplayString(e.unref(c)),1)):e.createCommentVNode("",!0)]),e.createElementVNode("a",{class:"btn btn-teal-dark",href:`../AuditRecords.aspx?ProjectID=${x.id}`,target:"_blank"}," 查核紀錄 ",8,Fk)])]))}},Pk={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},Mk={class:"d-flex gap-2"},Ik={key:0,class:"btn text-teal-dark",type:"button"},jk=["href"],Ok=["href"],Lk={class:"d-flex gap-2"},Rk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},qk={class:"modal-content"},zk={class:"modal-body"},Gk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Jk={class:"modal-content"},Yk={class:"modal-body"},Qk={class:"d-flex flex-column gap-4 mb-5"},Hk={class:"d-flex align-items-center"},Wk={class:"flex-grow-1"},Kk={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(x){const B=j(),y=x,c=e.ref({}),i=e.ref(),N=e.ref({}),r=e.ref(),l=e.ref({}),t=e.ref(),m=e.computed(()=>{let d="";switch(y.type){case"culture":d="CUL";break;case"education":d="EDC";break;case"multiple":d="MUL";break;case"literacy":d="LIT";break;case"accessibility":d="ACC";break}return`../../Service/OFS/DownloadPdf.ashx?Type=${d}&ProjectID=${y.id}&Version=2`}),g=e.computed(()=>F.toUrl(`/OFS/PlanChangeRecords.aspx?ProjectID=${y.id}`)),b=()=>{const d={Reason:"計畫變更原因"};N.value=I(c.value,d),!Object.keys(N.value).length&&F[y.type]("applyChange",c.value).subscribe(a=>{a&&location.reload()})},_=()=>{c.value={ID:y.id},bootstrap.Modal.getOrCreateInstance(i.value).show()},u=()=>{l.value={ID:y.id},bootstrap.Modal.getOrCreateInstance(t.value).show()},p=()=>{const d={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};N.value=I(l.value,d),!Object.keys(N.value).length&&F[y.type]("terminate",l.value).subscribe(a=>{a&&(location.href="../ApplicationChecklist.aspx")})};return(d,a)=>{const h=e.resolveComponent("project-organizer"),E=e.resolveComponent("input-textarea"),n=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pk,[e.createElementVNode("div",Mk,[e.unref(B)[x.type].changeStatus?(e.openBlock(),e.createElementBlock("button",Ik," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:_,type:"button"}," 計畫變更申請 ")),e.createElementVNode("a",{class:"btn btn-teal-dark",href:e.unref(g),target:"_blank"},[...a[3]||(a[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])],8,jk),e.createElementVNode("a",{class:"btn btn-teal-dark",download:"",href:e.unref(m)},[...a[4]||(a[4]=[e.createElementVNode("i",{class:"fa-solid fa-download"},null,-1),e.createTextVNode(" 下載核定計畫書 ",-1)])],8,Ok)]),e.createElementVNode("div",Lk,[e.createVNode(h,{id:x.id,type:x.type},null,8,["id","type"]),e.unref(B)[x.type].isOrganizer?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-pink",onClick:u,type:"button"}," 計畫終止 ")):e.createCommentVNode("",!0)])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:i,tabindex:"-1"},[e.createElementVNode("div",Rk,[e.createElementVNode("div",qk,[a[8]||(a[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",zk,[a[6]||(a[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),a[7]||(a[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(E,{error:e.unref(N).Reason,modelValue:e.unref(c).Reason,"onUpdate:modelValue":a[0]||(a[0]=V=>e.unref(c).Reason=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[5]||(a[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:b},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:r,tabindex:"-1"},[...a[9]||(a[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:t,tabindex:"-1"},[e.createElementVNode("div",Gk,[e.createElementVNode("div",Jk,[a[14]||(a[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Yk,[e.createElementVNode("div",Qk,[e.createElementVNode("div",null,[a[10]||(a[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(E,{error:e.unref(N).RejectReason,modelValue:e.unref(l).RejectReason,"onUpdate:modelValue":a[1]||(a[1]=V=>e.unref(l).RejectReason=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),a[12]||(a[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",Hk,[a[11]||(a[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",Wk,[e.createVNode(n,{error:e.unref(N).RecoveryAmount,modelValue:e.unref(l).RecoveryAmount,"onUpdate:modelValue":a[2]||(a[2]=V=>e.unref(l).RecoveryAmount=V),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[a[13]||(a[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:p},"送出")])])])])],512)]))],64)}}},Xk={class:"search bg-gray mt-4"},Zk={class:"search-form"},vk={class:"row g-3"},eu={class:"col-12 col-lg-4"},tu=["value"],lu={class:"col-12 col-lg-4"},ou=["value"],nu={class:"row g-3"},ru={class:"col-12 col-lg-6"},au={class:"col-12 col-lg-6"},su={class:"total-list multiple-option"},du={class:"all-total"},cu={class:"total-item-content"},iu={class:"count"},mu=["for"],pu={class:"total-item-title"},Vu={class:"total-item-content"},fu={class:"count"},Nu=["id","onUpdate:modelValue"],Eu={class:"block rounded-bottom-4"},bu={class:"title border-teal"},gu={class:"d-flex align-items-center gap-2"},yu={class:"text-teal"},ku={class:"table-responsive",style:{"min-height":"400px"}},uu={class:"table teal-table"},hu={class:"total-row"},xu={class:"text-end"},$u={class:"text-end"},Bu={class:"text-end"},_u={"data-th":"年度:"},Cu={"data-th":"類別:"},Tu={"data-th":"計畫名稱:",style:{"text-align":"left"}},wu=["href"],Du={"data-th":"申請單位:",style:{"text-align":"left"}},Su={"data-th":"申請本會補助:",class:"text-end"},Au={"data-th":"配合款:",class:"text-end"},Fu={"data-th":"總經費:",class:"text-end"},Uu={"data-th":"狀態:",style:{"text-align":"center",width:"100px"}},Pu={class:"text-teal"},Mu={__name:"ApplyList",setup(x){const B=e.ref([{id:1,title:"申請中",checked:!0},{id:2,title:"審查中",checked:!0},{id:3,title:"已核定",checked:!0},{id:4,title:"未通過",checked:!0}]),y=e.ref([]),c=e.ref({}),i=e.ref([]),N=e.ref(1),r=e.ref(10),l=e.ref([]),t=e.computed(()=>g.value.filter(u=>B.value.find(p=>p.checked&&u.type===p.id))),m=e.computed(()=>t.value.slice((N.value-1)*r.value,N.value*r.value)),g=e.computed(()=>{let u=i.value;return c.value.category&&(u=u.filter(p=>p.Category===c.value.category)),c.value.unit&&(u=u.filter(p=>p.SupervisoryUnit===c.value.unit)),c.value.org&&(u=u.filter(p=>{var d;return(d=p.OrgName)==null?void 0:d.includes(c.value.org)})),c.value.name&&(u=u.filter(p=>{var d;return p.ProjectID.includes(c.value.name)||((d=p.ProjectName)==null?void 0:d.includes(c.value.name))})),u}),b=(u,p)=>{N.value=parseInt(u),r.value=parseInt(p)},_=u=>{if(u.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("CLB"))return`../CLB/ClbApplication.aspx?ProjectID=${u.ProjectID}`;if(u.ProjectID.includes("SCI"))return`../SCI/SciApplication.aspx?ProjectID=${u.ProjectID}`};return e.onMounted(()=>{F.system("getApplyList").subscribe(u=>{i.value=u.List,i.value.forEach(p=>{[1,14].includes(p.Status)?p.type=1:[11,12,21,22,31,32,41,42,43,44].includes(p.Status)?p.type=2:[45,51,52,91].includes(p.Status)?p.type=3:p.type=4,y.value.includes(p.Category)||y.value.push(p.Category),l.value.includes(p.SupervisoryUnit)||l.value.push(p.SupervisoryUnit)})})}),(u,p)=>{const d=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Xk,[p[12]||(p[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Zk,[e.createElementVNode("div",vk,[p[8]||(p[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",eu,[p[5]||(p[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":p[0]||(p[0]=h=>e.unref(c).category=h)},[p[4]||(p[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(y),h=>(e.openBlock(),e.createElementBlock("option",{key:h,value:h},e.toDisplayString(h),9,tu))),128))],512),[[e.vModelSelect,e.unref(c).category]])]),e.createElementVNode("div",lu,[p[7]||(p[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":p[1]||(p[1]=h=>e.unref(c).unit=h)},[p[6]||(p[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),h=>(e.openBlock(),e.createElementBlock("option",{key:h,value:h},e.toDisplayString(h),9,ou))),128))],512),[[e.vModelSelect,e.unref(c).unit]])])]),e.createElementVNode("div",nu,[e.createElementVNode("div",ru,[p[9]||(p[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(d,{modelValue:e.unref(c).org,"onUpdate:modelValue":p[2]||(p[2]=h=>e.unref(c).org=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",au,[p[10]||(p[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(d,{modelValue:e.unref(c).name,"onUpdate:modelValue":p[3]||(p[3]=h=>e.unref(c).name=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),p[11]||(p[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("ul",su,[e.createElementVNode("li",du,[p[14]||(p[14]=e.createElementVNode("div",{class:"total-item-title"},"總申請",-1)),e.createElementVNode("div",cu,[e.createElementVNode("span",iu,e.toDisplayString(e.unref(g).length),1),p[13]||(p[13]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),h=>(e.openBlock(),e.createElementBlock("li",{class:"total-item",key:h},[e.createElementVNode("label",{class:"checke-total",for:`apply-${h.id}`},[e.createElementVNode("div",null,[e.createElementVNode("div",pu,e.toDisplayString(h.title),1),e.createElementVNode("div",Vu,[e.createElementVNode("span",fu,e.toDisplayString(e.unref(g).filter(E=>E.type===h.id).length),1),p[15]||(p[15]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),p[16]||(p[16]=e.createElementVNode("img",{class:"check-icon",src:"../../assets/img/check-white.svg"},null,-1))],8,mu),e.withDirectives(e.createElementVNode("input",{class:"total-checkbox",id:`apply-${h.id}`,type:"checkbox","onUpdate:modelValue":E=>h.checked=E},null,8,Nu),[[e.vModelCheckbox,h.checked]])]))),128))]),e.createElementVNode("div",Eu,[e.createElementVNode("div",bu,[e.createElementVNode("div",gu,[p[19]||(p[19]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[p[17]||(p[17]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",yu,e.toDisplayString(e.unref(t).length),1),p[18]||(p[18]=e.createTextVNode(" 筆資料",-1))])]),p[20]||(p[20]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",ku,[e.createElementVNode("table",uu,[e.createElementVNode("thead",null,[p[23]||(p[23]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"申請本會補助")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"總經費")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"狀態")])])],-1)),e.createElementVNode("tr",hu,[p[21]||(p[21]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",xu,e.toDisplayString(e.unref(t).reduce((h,E)=>h+E.ApplyAmount,0).toLocaleString()),1),e.createElementVNode("td",$u,e.toDisplayString(e.unref(t).reduce((h,E)=>h+E.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",Bu,e.toDisplayString(e.unref(t).reduce((h,E)=>h+E.ApplyAmount+E.OtherAmount,0).toLocaleString()),1),p[22]||(p[22]=e.createElementVNode("td",null,null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),h=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",_u,e.toDisplayString(h.Year),1),e.createElementVNode("td",Cu,e.toDisplayString(h.Category),1),e.createElementVNode("td",Tu,[e.createElementVNode("a",{class:"link-black",href:_(h),target:"_blank"},e.toDisplayString(h.ProjectName||"[未設定]"),9,wu)]),e.createElementVNode("td",Du,e.toDisplayString(h.OrgName),1),e.createElementVNode("td",Su,e.toDisplayString(h.ApplyAmount.toLocaleString()),1),e.createElementVNode("td",Au,e.toDisplayString(h.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Fu,e.toDisplayString((h.ApplyAmount+h.OtherAmount).toLocaleString()),1),e.createElementVNode("td",Uu,[e.createElementVNode("span",Pu,e.toDisplayString(e.unref(B).find(E=>E.id===h.type).title),1)])]))),128))])])]),e.createVNode(a,{count:e.unref(t).length,onChange:b,page:e.unref(N),"page-size":e.unref(r)},null,8,["count","page","page-size"])])],64)}}},Iu={class:"search bg-gray mt-4"},ju={class:"search-form"},Ou={class:"row g-3"},Lu={class:"col-12 col-lg-4"},Ru=["value"],qu={class:"col-12 col-lg-4"},zu=["value"],Gu={class:"row g-3"},Ju={class:"col-12 col-lg-6"},Yu={class:"col-12 col-lg-6"},Qu={class:"block rounded-bottom-4"},Hu={class:"title border-teal"},Wu={class:"d-flex align-items-center gap-2"},Ku={class:"text-teal"},Xu={class:"table-responsive",style:{"min-height":"400px"}},Zu={class:"table teal-table"},vu={class:"total-row"},eh={class:"text-end"},th={class:"text-end"},lh={"data-th":"年度:"},oh={"data-th":"類別:"},nh={"data-th":"計畫名稱:",style:{"text-align":"left"}},rh=["href"],ah={"data-th":"申請單位:",style:{"text-align":"left"}},sh={"data-th":"本會補助金額:",class:"text-end"},dh={"data-th":"配合款:",class:"text-end"},ch={__name:"ApprovedList",props:{category:{type:String}},setup(x){const B=x,y={ACC:"無障礙",CLB:"學校社團",CUL:"文化",EDC:"學校／民間",LIT:"素養",MUL:"多元",SCI:"科專"},c=e.ref([]),i=e.ref({}),N=e.ref([]),r=e.ref(1),l=e.ref(10),t=e.ref([]),m=e.computed(()=>g.value.slice((r.value-1)*l.value,r.value*l.value)),g=e.computed(()=>{let u=N.value;return i.value.category&&(u=u.filter(p=>p.Category===i.value.category)),i.value.unit&&(u=u.filter(p=>p.SupervisoryUnit===i.value.unit)),i.value.org&&(u=u.filter(p=>{var d;return(d=p.OrgName)==null?void 0:d.includes(i.value.org)})),i.value.name&&(u=u.filter(p=>{var d;return p.ProjectID.includes(i.value.name)||((d=p.ProjectName)==null?void 0:d.includes(i.value.name))})),u}),b=(u,p)=>{r.value=parseInt(u),l.value=parseInt(p)},_=u=>{if(u.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${u.ProjectID}`;if(u.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${u.ProjectID}`;if(u.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${u.ProjectID}`};return e.onMounted(()=>{F.system("getApprovedList").subscribe(u=>{if(N.value=u.List,N.value.forEach(p=>{c.value.includes(p.Category)||c.value.push(p.Category),t.value.includes(p.SupervisoryUnit)||t.value.push(p.SupervisoryUnit)}),B.category){const p=y[B.category];c.value.includes(p)&&(i.value.category=p)}})}),(u,p)=>{const d=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Iu,[p[12]||(p[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",ju,[e.createElementVNode("div",Ou,[p[8]||(p[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",Lu,[p[5]||(p[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":p[0]||(p[0]=h=>e.unref(i).category=h)},[p[4]||(p[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),h=>(e.openBlock(),e.createElementBlock("option",{key:h,value:h},e.toDisplayString(h),9,Ru))),128))],512),[[e.vModelSelect,e.unref(i).category]])]),e.createElementVNode("div",qu,[p[7]||(p[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":p[1]||(p[1]=h=>e.unref(i).unit=h)},[p[6]||(p[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),h=>(e.openBlock(),e.createElementBlock("option",{key:h,value:h},e.toDisplayString(h),9,zu))),128))],512),[[e.vModelSelect,e.unref(i).unit]])])]),e.createElementVNode("div",Gu,[e.createElementVNode("div",Ju,[p[9]||(p[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(d,{modelValue:e.unref(i).org,"onUpdate:modelValue":p[2]||(p[2]=h=>e.unref(i).org=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Yu,[p[10]||(p[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(d,{modelValue:e.unref(i).name,"onUpdate:modelValue":p[3]||(p[3]=h=>e.unref(i).name=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),p[11]||(p[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Qu,[e.createElementVNode("div",Hu,[e.createElementVNode("div",Wu,[p[15]||(p[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[p[13]||(p[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Ku,e.toDisplayString(e.unref(g).length),1),p[14]||(p[14]=e.createTextVNode(" 筆資料",-1))])]),p[16]||(p[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Xu,[e.createElementVNode("table",Zu,[e.createElementVNode("thead",null,[p[18]||(p[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])])],-1)),e.createElementVNode("tr",vu,[p[17]||(p[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",eh,e.toDisplayString(e.unref(g).reduce((h,E)=>h+E.ApprovedAmount,0).toLocaleString()),1),e.createElementVNode("td",th,e.toDisplayString(e.unref(g).reduce((h,E)=>h+E.OtherAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),h=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",lh,e.toDisplayString(h.Year),1),e.createElementVNode("td",oh,e.toDisplayString(h.Category),1),e.createElementVNode("td",nh,[e.createElementVNode("a",{class:"link-black",href:_(h),target:"_blank"},e.toDisplayString(h.ProjectName),9,rh)]),e.createElementVNode("td",ah,e.toDisplayString(h.OrgName),1),e.createElementVNode("td",sh,e.toDisplayString(h.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",dh,e.toDisplayString(h.OtherAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(a,{count:e.unref(g).length,onChange:b,page:e.unref(r),"page-size":e.unref(l)},null,8,["count","page","page-size"])])],64)}}},ih={class:"search bg-gray mt-4"},mh={class:"search-form"},ph={class:"row g-3"},Vh={class:"col-12 col-lg-4"},fh=["value"],Nh={class:"col-12 col-lg-4"},Eh=["value"],bh={class:"row g-3"},gh={class:"col-12 col-lg-6"},yh={class:"col-12 col-lg-6"},kh={class:"block rounded-bottom-4"},uh={class:"title border-teal"},hh={class:"d-flex align-items-center gap-2"},xh={class:"text-teal"},$h={class:"table-responsive",style:{"min-height":"400px"}},Bh={class:"table teal-table"},_h={class:"total-row"},Ch={class:"text-end"},Th={class:"text-end"},wh={class:"text-end"},Dh={class:"text-end"},Sh={class:"text-end"},Ah={"data-th":"年度:"},Fh={"data-th":"類別:"},Uh={"data-th":"計畫名稱:",style:{"text-align":"left"}},Ph=["href"],Mh={"data-th":"申請單位:",style:{"text-align":"left"}},Ih={"data-th":"本會補助金額:",class:"text-end"},jh={"data-th":"配合款:",class:"text-end"},Oh={"data-th":"實支金額:",class:"text-end"},Lh={"data-th":"累積經費執行率:",class:"text-end"},Rh={"data-th":"本會已撥金額:",class:"text-end"},qh={__name:"InprogressList",setup(x){const B=e.ref([]),y=e.ref({}),c=e.ref([]),i=e.ref(1),N=e.ref(10),r=e.ref([]),l=e.computed(()=>g.value.reduce((p,d)=>p+d.ApprovedAmount,0)),t=e.computed(()=>g.value.slice((i.value-1)*N.value,i.value*N.value)),m=e.computed(()=>g.value.reduce((p,d)=>p+d.SpendAmount,0)),g=e.computed(()=>{let p=c.value;return y.value.category&&(p=p.filter(d=>d.Category===y.value.category)),y.value.unit&&(p=p.filter(d=>d.SupervisoryUnit===y.value.unit)),y.value.org&&(p=p.filter(d=>{var a;return(a=d.OrgName)==null?void 0:a.includes(y.value.org)})),y.value.name&&(p=p.filter(d=>{var a;return d.ProjectID.includes(y.value.name)||((a=d.ProjectName)==null?void 0:a.includes(y.value.name))})),p}),b=(p,d)=>{i.value=parseInt(p),N.value=parseInt(d)},_=p=>{if(p.ProjectID.includes("CUL"))return`../CUL/Audit.aspx?ID=${p.ProjectID}`;if(p.ProjectID.includes("EDC"))return`../EDC/Audit.aspx?ID=${p.ProjectID}`;if(p.ProjectID.includes("MUL"))return`../MUL/Audit.aspx?ID=${p.ProjectID}`;if(p.ProjectID.includes("LIT"))return`../LIT/Audit.aspx?ID=${p.ProjectID}`;if(p.ProjectID.includes("ACC"))return`../ACC/Audit.aspx?ID=${p.ProjectID}`;if(p.ProjectID.includes("CLB"))return`../Clb/ClbApproved.aspx?ProjectID=${p.ProjectID}`;if(p.ProjectID.includes("SCI"))return`../SCI/SciInprogress_Approved.aspx?ProjectID=${p.ProjectID}`},u=(p,d)=>d?Math.round(p*100/d*100)/100:0;return e.onMounted(()=>{F.system("getInprogressList").subscribe(p=>{c.value=p.List,c.value.forEach(d=>{B.value.includes(d.Category)||B.value.push(d.Category),r.value.includes(d.SupervisoryUnit)||r.value.push(d.SupervisoryUnit)})})}),(p,d)=>{const a=e.resolveComponent("input-text"),h=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ih,[d[12]||(d[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",mh,[e.createElementVNode("div",ph,[d[8]||(d[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",Vh,[d[5]||(d[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":d[0]||(d[0]=E=>e.unref(y).category=E)},[d[4]||(d[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),E=>(e.openBlock(),e.createElementBlock("option",{key:E,value:E},e.toDisplayString(E),9,fh))),128))],512),[[e.vModelSelect,e.unref(y).category]])]),e.createElementVNode("div",Nh,[d[7]||(d[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":d[1]||(d[1]=E=>e.unref(y).unit=E)},[d[6]||(d[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),E=>(e.openBlock(),e.createElementBlock("option",{key:E,value:E},e.toDisplayString(E),9,Eh))),128))],512),[[e.vModelSelect,e.unref(y).unit]])])]),e.createElementVNode("div",bh,[e.createElementVNode("div",gh,[d[9]||(d[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(a,{modelValue:e.unref(y).org,"onUpdate:modelValue":d[2]||(d[2]=E=>e.unref(y).org=E),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",yh,[d[10]||(d[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(a,{modelValue:e.unref(y).name,"onUpdate:modelValue":d[3]||(d[3]=E=>e.unref(y).name=E),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),d[11]||(d[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",kh,[e.createElementVNode("div",uh,[e.createElementVNode("div",hh,[d[15]||(d[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[d[13]||(d[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",xh,e.toDisplayString(e.unref(g).length),1),d[14]||(d[14]=e.createTextVNode(" 筆資料",-1))])]),d[16]||(d[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",$h,[e.createElementVNode("table",Bh,[e.createElementVNode("thead",null,[d[18]||(d[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"實支金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"累積經費執行率")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會已撥金額")])])],-1)),e.createElementVNode("tr",_h,[d[17]||(d[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Ch,e.toDisplayString(e.unref(l).toLocaleString()),1),e.createElementVNode("td",Th,e.toDisplayString(e.unref(g).reduce((E,n)=>E+n.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",wh,e.toDisplayString(e.unref(m).toLocaleString()),1),e.createElementVNode("td",Dh,e.toDisplayString(u(e.unref(m),e.unref(l)).toLocaleString())+"%",1),e.createElementVNode("td",Sh,e.toDisplayString(e.unref(g).reduce((E,n)=>E+n.PaymentAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),E=>(e.openBlock(),e.createElementBlock("tr",{key:E},[e.createElementVNode("td",Ah,e.toDisplayString(E.Year),1),e.createElementVNode("td",Fh,e.toDisplayString(E.Category),1),e.createElementVNode("td",Uh,[e.createElementVNode("a",{class:"link-black",href:_(E),target:"_blank"},e.toDisplayString(E.ProjectName),9,Ph)]),e.createElementVNode("td",Mh,e.toDisplayString(E.OrgName),1),e.createElementVNode("td",Ih,e.toDisplayString(E.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",jh,e.toDisplayString(E.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Oh,e.toDisplayString(E.SpendAmount.toLocaleString()),1),e.createElementVNode("td",Lh,e.toDisplayString(u(E.SpendAmount,E.ApprovedAmount).toLocaleString())+"%",1),e.createElementVNode("td",Rh,e.toDisplayString(E.PaymentAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(h,{count:e.unref(g).length,onChange:b,page:e.unref(i),"page-size":e.unref(N)},null,8,["count","page","page-size"])])],64)}}},zh={__name:"MixChart",props:{list:{required:!0,type:Array}},setup(x){let B;const y=v().typeList,c=x,i=e.ref(),N=l=>{am5.ready(()=>{B=am5.Root.new(i.value),B.setThemes([am5themes_Animated.new(B)]);const t=B.container.children.push(am5xy.XYChart.new(B,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,layout:B.verticalLayout})),m=am5xy.AxisRendererX.new(B,{minGridDistance:30});m.labels.template.setAll({rotation:-45,centerY:am5.p50,centerX:am5.p100,textAlign:"right"});var g=t.xAxes.push(am5xy.CategoryAxis.new(B,{categoryField:"category",renderer:m,tooltip:am5.Tooltip.new(B,{})}));g.data.setAll(l);var b=t.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{})})),_=t.yAxes.push(am5xy.ValueAxis.new(B,{renderer:am5xy.AxisRendererY.new(B,{opposite:!0}),min:0,max:1,numberFormat:"#.0%",extraMax:.1,strictMinMax:!0}));const u=(E,n,V)=>{var s=t.series.push(am5xy.ColumnSeries.new(B,{name:n,xAxis:g,yAxis:b,valueYField:E,categoryXField:"category",clustered:!0,tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY}"})}));return s.data.setAll(l),s.columns.template.setAll({fillOpacity:1,strokeOpacity:0,fill:am5.color(V),cornerRadiusTL:0,cornerRadiusTR:0,width:am5.percent(70)}),s};u("核定經費","核定經費",4946924),u("實支金額","實支金額",9323693),u("已撥付","已撥付",3447003);const p=(E,n,V)=>{var s=t.series.push(am5xy.LineSeries.new(B,{name:n,xAxis:g,yAxis:_,valueYField:E,categoryXField:"category",stroke:am5.color(V),fill:am5.color(V),tooltip:am5.Tooltip.new(B,{labelText:"{name}: {valueY.formatNumber('#.0%')}"})}));return s.strokes.template.setAll({strokeWidth:3}),s.bullets.push(()=>am5.Bullet.new(B,{sprite:am5.Circle.new(B,{radius:5,fill:s.get("stroke")})})),s.data.setAll(l),s};p("經費執行率(%)","經費執行率(%)",15105570),p("支用比(%)","支用比(%)",2600544),t.children.push(am5.Legend.new(B,{centerX:am5.p50,x:am5.p50,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300})).labels.template.setAll({fontSize:12,paddingLeft:4,paddingRight:4,marginTop:4,marginBottom:4,marginLeft:4,marginRight:4});var a=t.children.push(am5.Legend.new(B,{centerX:am5.p0,x:am5.p0,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));a.data.setAll([t.series.getIndex(0),t.series.getIndex(1),t.series.getIndex(2)]);var h=t.children.push(am5.Legend.new(B,{centerX:am5.p100,x:am5.p100,layout:B.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));h.data.setAll([t.series.getIndex(3),t.series.getIndex(4)]),t.set("cursor",am5xy.XYCursor.new(B,{}))})},r=(l,t,m=2)=>{if(t){const g=10**m;return Math.round(l*100/t*g)/g}return 0};return e.onMounted(()=>{N(y.map(l=>{const t={category:l.title,核定經費:0,實支金額:0,已撥付:0,"經費執行率(%)":0,"支用比(%)":0},m=c.list.find(g=>g.Category===l.code);return m&&(t.核定經費=Math.floor(m.ApprovedAmount/1e3),t.實支金額=Math.floor(m.SpendAmount/1e3),t.已撥付=Math.floor(m.PaymentAmount/1e3),t["經費執行率(%)"]=r(t.實支金額,t.核定經費,1),t["支用比(%)"]=r(t.實支金額,t.已撥付,1)),t}))}),(l,t)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:i},null,512))}},Gh={__name:"PieChart",props:{active:{required:!0,type:String},color:{required:!0,type:Number},inactive:{required:!0,type:String},percent:{required:!0,type:Number}},setup(x){let B,y,c;const i=x,N=e.ref();return e.onMounted(()=>{am5.ready(()=>{y=am5.Root.new(N.value),y.setThemes([am5themes_Animated.new(y)]);const r=y.container.children.push(am5percent.PieChart.new(y,{innerRadius:95,width:158,x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,layout:y.verticalLayout}));c=r.series.push(am5percent.PieSeries.new(y,{valueField:"size",categoryField:"sector"})),c.set("colors",am5.ColorSet.new(y,{colors:[am5.color(i.color),am5.color(16119285)]})),c.labels.template.set("visible",!1),c.ticks.template.set("visible",!1),c.data.setAll([{sector:i.active,size:i.percent},{sector:i.inactive,size:100-i.percent}]),c.appear(1e3,100),B=y.tooltipContainer.children.push(am5.Label.new(y,{x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,fill:am5.color(i.color),fontSize:28,fontWeight:"bold"})),B.set("text",`${i.percent}%`);const l=()=>{var t=window.innerWidth>=768&&window.innerWidth<=1024,m=t?105:158,g=t?55:95,b=t?20:28;r.set("width",m),r.set("innerRadius",g),B.set("fontSize",b)};l(),window.addEventListener("resize",l)})}),e.watch(()=>i.percent,r=>{B.set("text",`${r}%`),c.data.setAll([{sector:i.active,size:r},{sector:i.inactive,size:100-r}])}),(r,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:N},null,512))}},Jh={class:"search bg-gray mt-4"},Yh={class:"search-form"},Qh={class:"row g-3"},Hh={class:"col-12 col-lg-4"},Wh={class:"col-12 col-lg-4"},Kh={class:"col-12 col-lg-4"},Xh={class:"row g-3"},Zh={class:"col-12"},vh={class:"block rounded-bottom-4"},ex={class:"title border-teal"},tx={class:"d-flex align-items-center gap-2"},lx={class:"text-teal"},ox={class:"table-responsive",style:{"min-height":"400px"}},nx={class:"table teal-table"},rx={"data-th":"年度:"},ax={"data-th":"計畫名稱:",class:"text-start"},sx=["href"],dx={"data-th":"計畫申請單位:",class:"text-start"},cx={"data-th":"委員姓名:"},ix={"data-th":"任職單位:",class:"text-start"},mx={"data-th":"職稱:"},px={"data-th":"應迴避之具體理由及事證:",class:"text-start"},Vx={__name:"RecusedList",setup(x){const B=e.ref({Year:0,Keyword:"",Name:"",Org:""}),y=e.ref([]),c=e.ref(1),i=e.ref(10),N=[],r=e.computed(()=>y.value.slice((c.value-1)*i.value,c.value*i.value)),l=(g,b)=>{c.value=parseInt(g),i.value=parseInt(b)},t=()=>{F.system("downloadRecusedList",B.value).subscribe(g=>{const b=document.createElement("a");b.download="迴避審查委員名單.xlsx",b.href=F.download(g.filename),b.click()})},m=()=>{F.system("getRecusedList",B.value).subscribe(g=>{y.value=g.List,c.value=1})};for(let g=new Date().getFullYear()-1911;g>=114;g--)N.push({text:`${g} 年`,value:g});return e.onMounted(m),(g,b)=>{const _=e.resolveComponent("input-select"),u=e.resolveComponent("input-text"),p=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jh,[b[9]||(b[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Yh,[e.createElementVNode("div",Qh,[e.createElementVNode("div",Hh,[b[4]||(b[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.createVNode(_,{"empty-value":0,options:N,modelValue:e.unref(B).Year,"onUpdate:modelValue":b[0]||(b[0]=d=>e.unref(B).Year=d)},null,8,["modelValue"])]),e.createElementVNode("div",Wh,[b[5]||(b[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, 任職單位, 職稱",-1)),e.createVNode(u,{placeholder:"請輸入委員姓名, 任職單位, 職稱",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":b[1]||(b[1]=d=>e.unref(B).Keyword=d),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Kh,[b[6]||(b[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫名稱",-1)),e.createVNode(u,{placeholder:"請輸入計畫名稱",modelValue:e.unref(B).Name,"onUpdate:modelValue":b[2]||(b[2]=d=>e.unref(B).Name=d),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("div",Xh,[e.createElementVNode("div",Zh,[b[7]||(b[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫申請單位",-1)),e.createVNode(u,{placeholder:"請輸入計畫申請單位",modelValue:e.unref(B).Org,"onUpdate:modelValue":b[3]||(b[3]=d=>e.unref(B).Org=d),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:m,type:"button"},[...b[8]||(b[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",vh,[e.createElementVNode("div",ex,[e.createElementVNode("div",tx,[b[12]||(b[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[b[10]||(b[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",lx,e.toDisplayString(e.unref(y).length),1),b[11]||(b[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:t,type:"button"},[...b[13]||(b[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",ox,[e.createElementVNode("table",nx,[b[14]||(b[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"任職單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"職稱")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"應迴避之具體理由及事證")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),d=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",rx,e.toDisplayString(d.Year),1),e.createElementVNode("td",ax,[e.createElementVNode("a",{class:"link-black",href:`../SCI/SciApplication.aspx?ProjectID=${d.ProjectID}`,target:"_blank"},e.toDisplayString(d.ProjectNameTw),9,sx)]),e.createElementVNode("td",dx,e.toDisplayString(d.OrgName),1),e.createElementVNode("td",cx,e.toDisplayString(d.RecusedName),1),e.createElementVNode("td",ix,e.toDisplayString(d.EmploymentUnit),1),e.createElementVNode("td",mx,e.toDisplayString(d.JobTitle),1),e.createElementVNode("td",px,e.toDisplayString(d.RecusedReason),1)]))),128))])])]),e.createVNode(p,{count:e.unref(y).length,onChange:l,page:e.unref(c),"page-size":e.unref(i)},null,8,["count","page","page-size"])])],64)}}},fx={class:"block rounded-bottom-4"},Nx={class:"title border-teal"},Ex={class:"d-flex align-items-center gap-2"},bx={class:"text-teal"},gx={class:"table-responsive",style:{"min-height":"400px"}},yx={class:"table teal-table"},kx={"data-th":"委員姓名:",class:"text-start"},ux={"data-th":"審查階段:",class:"text-start"},hx={"data-th":"類別:",class:"text-start"},xx={"data-th":"計畫編號:"},$x={"data-th":"計畫名稱:",class:"text-start"},Bx={__name:"ReviewerDetails",props:{id:{type:String},type:{type:String}},setup(x){const B=x,y=e.ref({ID:B.id,Type:B.type}),c=e.ref([]),i=e.ref(1),N=e.ref(10),r=e.computed(()=>c.value.slice((i.value-1)*N.value,i.value*N.value)),l=(m,g)=>{i.value=parseInt(m),N.value=parseInt(g)},t=()=>{F.system("downloadReviewerDetails",y.value).subscribe(m=>{const g=document.createElement("a");g.download="審查計畫.xlsx",g.href=F.download(m.filename),g.click()})};return e.onMounted(()=>{F.system("getReviewerDetails",y.value).subscribe(m=>{c.value=m.List,i.value=1})}),(m,g)=>{const b=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",fx,[e.createElementVNode("div",Nx,[e.createElementVNode("div",Ex,[g[2]||(g[2]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"審查計畫")],-1)),e.createElementVNode("span",null,[g[0]||(g[0]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",bx,e.toDisplayString(e.unref(c).length),1),g[1]||(g[1]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:t,type:"button"},[...g[3]||(g[3]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",gx,[e.createElementVNode("table",yx,[g[4]||(g[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"計畫編號")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"計畫名稱")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),_=>(e.openBlock(),e.createElementBlock("tr",{key:_},[e.createElementVNode("td",kx,e.toDisplayString(_.CommitteeUser),1),e.createElementVNode("td",ux,e.toDisplayString(x.type==1?"申請計畫":"執行計畫")+"／"+e.toDisplayString(_.ReviewStage),1),e.createElementVNode("td",hx,e.toDisplayString(_.FieldName),1),e.createElementVNode("td",xx,e.toDisplayString(_.ProjectID),1),e.createElementVNode("td",$x,e.toDisplayString(_.ProjectName),1)]))),128))])])]),e.createVNode(b,{count:e.unref(c).length,onChange:l,page:e.unref(i),"page-size":e.unref(N)},null,8,["count","page","page-size"])])}}},_x={class:"search bg-gray mt-4"},Cx={class:"search-form"},Tx={class:"row g-3"},wx={class:"col-3"},Dx={class:"col-3"},Sx={class:"col-3"},Ax={class:"col-3"},Fx={class:"block rounded-bottom-4"},Ux={class:"title border-teal"},Px={class:"d-flex align-items-center gap-2"},Mx={class:"text-teal"},Ix={class:"table-responsive",style:{"min-height":"400px"}},jx={class:"table teal-table"},Ox={"data-th":"委員姓名:"},Lx={"data-th":"Email:",class:"text-start"},Rx={"data-th":"審查階段:"},qx={"data-th":"審查計畫件數:"},zx=["href"],Gx={"data-th":"銀行帳戶:",class:"text-start"},Jx=["onClick"],Yx={key:1},Qx={"data-th":"戶籍地址:",class:"text-start"},Hx={"data-th":"更新時間:",class:"text-start"},Wx={class:"modal-dialog modal-dialog-centered modal-xl"},Kx={class:"modal-content"},Xx={class:"modal-body"},Zx={class:"mb-5"},vx=["src"],e$={__name:"ReviewerList",setup(x){const B=e.ref({Type:0,Keyword:"",Begin:"",End:""}),y=e.ref([]),c=e.ref(),i=e.ref(1),N=e.ref(10),r=e.ref({}),l=[{text:"申請計畫審查",value:1},{text:"執行計畫審查",value:2}],t=e.computed(()=>y.value.slice((i.value-1)*N.value,i.value*N.value)),m=(u,p)=>{i.value=parseInt(u),N.value=parseInt(p)},g=()=>{F.system("downloadReviewerList",B.value).subscribe(u=>{const p=document.createElement("a");p.download="審查委員名單.xlsx",p.href=F.download(u.filename),p.click()})},b=u=>{var p;r.value=u.Type===1?F.download(u.BankPhoto):F.sciDownload("downloadbankbook",{token:(p=u.BankPhoto)==null?void 0:p.trim()}),bootstrap.Modal.getOrCreateInstance(c.value).show()},_=()=>{F.system("getReviewerList",B.value).subscribe(u=>{y.value=u.List,i.value=1})};return e.onMounted(_),(u,p)=>{const d=e.resolveComponent("input-select"),a=e.resolveComponent("input-text"),h=e.resolveComponent("input-tw-date"),E=e.resolveComponent("tw-date-time"),n=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",_x,[p[9]||(p[9]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Cx,[e.createElementVNode("div",Tx,[e.createElementVNode("div",wx,[p[4]||(p[4]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"審查階段",-1)),e.createVNode(d,{"empty-value":0,options:l,modelValue:e.unref(B).Type,"onUpdate:modelValue":p[0]||(p[0]=V=>e.unref(B).Type=V)},null,8,["modelValue"])]),e.createElementVNode("div",Dx,[p[5]||(p[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"委員姓名, Email",-1)),e.createVNode(a,{placeholder:"請輸入委員姓名, Email",modelValue:e.unref(B).Keyword,"onUpdate:modelValue":p[1]||(p[1]=V=>e.unref(B).Keyword=V),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Sx,[p[6]||(p[6]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"開始時間",-1)),e.createVNode(h,{modelValue:e.unref(B).Begin,"onUpdate:modelValue":p[2]||(p[2]=V=>e.unref(B).Begin=V)},null,8,["modelValue"])]),e.createElementVNode("div",Ax,[p[7]||(p[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"結束時間",-1)),e.createVNode(h,{modelValue:e.unref(B).End,"onUpdate:modelValue":p[3]||(p[3]=V=>e.unref(B).End=V)},null,8,["modelValue"])])]),e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",onClick:_,type:"button"},[...p[8]||(p[8]=[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"},null,-1),e.createTextVNode(" 查詢 ",-1)])])])]),e.createElementVNode("div",Fx,[e.createElementVNode("div",Ux,[e.createElementVNode("div",Px,[p[12]||(p[12]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[p[10]||(p[10]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Mx,e.toDisplayString(e.unref(y).length),1),p[11]||(p[11]=e.createTextVNode(" 筆資料",-1))])]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:g,type:"button"},[...p[13]||(p[13]=[e.createElementVNode("i",{class:"fas fa-download"},null,-1),e.createTextVNode("匯出",-1)])])]),e.createElementVNode("div",Ix,[e.createElementVNode("table",jx,[p[14]||(p[14]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"委員姓名")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"Email")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查階段")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"審查計畫件數")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"銀行帳戶")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"戶籍地址")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-start"},[e.createElementVNode("span",null,"更新時間")])])])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),V=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",Ox,e.toDisplayString(V.CommitteeUser),1),e.createElementVNode("td",Lx,e.toDisplayString(V.Email),1),e.createElementVNode("td",Rx,e.toDisplayString(V.Type===1?"申請計畫":"執行計畫"),1),e.createElementVNode("td",qx,[e.createElementVNode("a",{class:"link-black",href:`ReviewerList${V.Type}.aspx?ID=${V.ID}`,target:"_blank"},e.toDisplayString(V.Count),9,zx)]),e.createElementVNode("td",Gx,[V.BankPhoto?(e.openBlock(),e.createElementBlock("a",{key:0,onClick:e.withModifiers(s=>b(V),["prevent"]),href:"#"},e.toDisplayString(V.BankCode)+" "+e.toDisplayString(V.BankName)+" "+e.toDisplayString(V.BankAccount),9,Jx)):(e.openBlock(),e.createElementBlock("span",Yx,e.toDisplayString(V.BankCode)+" "+e.toDisplayString(V.BankName)+" "+e.toDisplayString(V.BankAccount),1))]),e.createElementVNode("td",Qx,e.toDisplayString(V.RegistrationAddress),1),e.createElementVNode("td",Hx,[e.createVNode(E,{value:V.UpdateTime},null,8,["value"])])]))),128))])])]),e.createVNode(n,{count:e.unref(y).length,onChange:m,page:e.unref(i),"page-size":e.unref(N)},null,8,["count","page","page-size"])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",Wx,[e.createElementVNode("div",Kx,[p[16]||(p[16]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Xx,[e.createElementVNode("div",Zx,[e.createElementVNode("img",{class:"img-fluid",src:e.unref(r)},null,8,vx)]),p[15]||(p[15]=e.createElementVNode("div",{class:"d-flex justify-content-center"},[e.createElementVNode("button",{class:"btn btn-primary","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))],64)}}},t$={key:0,class:"text-pink"},l$={__name:"RequiredLabel",setup(x){const B=e.inject("editable",!0);return(y,c)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(B)?(e.openBlock(),e.createElementBlock("span",t$,"* ")):e.createCommentVNode("",!0),e.renderSlot(y.$slots,"default")],64))}},o$={class:"block"},n$={class:"mt-4"},r$={class:"table align-middle gray-table side-table"},a$={class:"d-flex gap-2"},s$=["src"],d$={key:0,class:"invalid mt-0"},c$={__name:"ReviewCommitteeInfo",props:{token:{type:String}},setup(x){const B=x,y=e.ref([]),c=e.ref({}),i=e.ref({}),N=m=>{i.value.BankPhoto=m.Path},r=F.download,l=()=>{if(c.value={},!t()){e.nextTick(()=>{var g;return(g=document.querySelector(".invalid"))==null?void 0:g.scrollIntoView({behavior:"smooth",block:"center"})});return}const m={Token:B.token,BankCode:i.value.BankCode,BankAccount:i.value.BankAccount,BankPhoto:i.value.BankPhoto,RegistrationAddress:i.value.RegistrationAddress};F.system("saveReviewCommittee",m).subscribe(g=>{g&&alert("儲存成功")})},t=()=>{let m={BankCode:"^請選擇銀行",BankAccount:"帳戶號碼",BankPhoto:"^請上傳存摺影本",RegistrationAddress:"戶籍地址"};return c.value=I(i.value,m),!Object.keys(c.value).length};return e.onMounted(()=>{rxjs.forkJoin([F.system("getZgsCodes",{CodeGroup:"BankCode"}),F.system("getReviewCommittee",{Token:B.token})]).subscribe(m=>{y.value=m[0],i.value=m[1].Data})}),(m,g)=>{const b=e.resolveComponent("required-label"),_=e.resolveComponent("input-select"),u=e.resolveComponent("input-text"),p=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",o$,[g[7]||(g[7]=e.createElementVNode("h5",{class:"square-title"},"委員資料",-1)),e.createElementVNode("div",n$,[e.createElementVNode("table",r$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[g[3]||(g[3]=e.createElementVNode("th",null,"審查委員",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(i).CommitteeUser)+" ("+e.toDisplayString(e.unref(i).Email)+") ",1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...g[4]||(g[4]=[e.createTextVNode("銀行帳戶",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",a$,[e.createElementVNode("div",null,[e.createVNode(_,{"empty-value":null,error:e.unref(c).BankCode,options:e.unref(y),placeholder:"請選擇銀行","text-name":"Descname","value-name":"Code",modelValue:e.unref(i).BankCode,"onUpdate:modelValue":g[0]||(g[0]=d=>e.unref(i).BankCode=d)},null,8,["error","options","modelValue"])]),e.createElementVNode("div",null,[e.createVNode(u,{error:e.unref(c).BankAccount,placeholder:"帳戶號碼",modelValue:e.unref(i).BankAccount,"onUpdate:modelValue":g[1]||(g[1]=d=>e.unref(i).BankAccount=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...g[5]||(g[5]=[e.createTextVNode("存摺影本",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(p,{accept:".jpg,.png",onFile:N}),e.unref(i).BankPhoto?(e.openBlock(),e.createElementBlock("img",{key:0,class:"img-fluid mt-2",src:e.unref(r)(e.unref(i).BankPhoto)},null,8,s$)):e.createCommentVNode("",!0)]),e.unref(c).BankPhoto?(e.openBlock(),e.createElementBlock("div",d$,e.toDisplayString(e.unref(c).BankPhoto),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...g[6]||(g[6]=[e.createTextVNode("戶籍地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(u,{error:e.unref(c).RegistrationAddress,placeholder:"(郵遞區號)完整地址",modelValue:e.unref(i).RegistrationAddress,"onUpdate:modelValue":g[2]||(g[2]=d=>e.unref(i).RegistrationAddress=d),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:l,type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定送出",-1)])])])],64)}}},i$={class:"block"},m$={class:"table align-middle gray-table side-table mt-4"},p$=["value"],V$={key:0,class:"tag-group mt-2 gap-1"},f$={class:"tag tag-green-light"},N$=["download","href"],E$={key:1},b$={key:2,class:"invalid mt-0"},g$={class:"table align-middle gray-table side-table mt-4"},y$={class:"d-flex align-items-center flex-wrap"},k$={class:"d-flex align-items-center text-nowrap me-3"},u$={class:"d-flex align-items-center text-nowrap"},h$={key:0,class:"invalid mt-0"},x$={key:0,class:"table align-middle gray-table"},$$={width:"1%"},B$={class:"row"},_$={class:"col"},C$={class:"col"},T$={width:"1%"},w$={class:"d-flex gap-2"},D$=["onClick"],S$={key:0},A$={class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},F$={__name:"GrantForm1",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=v().typeList,i=e.ref(!1),N=e.ref({}),r=e.ref({}),l=e.ref(),t=e.computed(()=>_.value.filter(h=>!h.Deleted)),m=e.computed(()=>b.value.filter(h=>!h.Deleted)),g=e.ref({}),b=e.ref([]),_=e.ref([]),u=F.download,p=B,d=h=>{var n,V,s;if(r.value={},N.value.Path=(n=l.value)==null?void 0:n.Path,N.value.Filename=(V=l.value)==null?void 0:V.Name,h){if(!a()){e.nextTick(()=>{var o;return(o=document.querySelector(".invalid"))==null?void 0:o.scrollIntoView({behavior:"smooth",block:"center"})});return}N.value.Status=i.value?2:1}g.value.ShortName=(s=c.find(o=>o.code===g.value.TypeCode))==null?void 0:s.title;const E={GrantType:g.value,Content:N.value,Procedures:_.value,Links:b.value,Submit:h?"true":"false"};F.system("saveGrantTypeContent",E).subscribe(o=>{o&&p("next",h,o.ID)})},a=()=>{let h={ServiceContent:"內容",ContactPerson:"聯絡電話及分機",ContactTel:"聯絡人",Filename:"相關檔案"};return i.value&&(h.StatusReason="下架原因"),r.value=I(N.value,h),y.id||(h={TypeCode:"補助類別",Year:"年度",FullName:"補助類別全稱"},Object.assign(r.value,I(g.value,h))),t.value.length&&(h={Content:"內容"},t.value.forEach((E,n)=>Object.assign(r.value,I(E,h,`procedure-${n}-`)))),m.value.length&&(h={Title:"參考資料名稱",URL:"網址"},m.value.forEach((E,n)=>Object.assign(r.value,I(E,h,`link-${n}-`)))),!Object.keys(r.value).length};return e.onMounted(()=>{y.id?F.system("getGrantTypeContent",{ID:y.id}).subscribe(h=>{g.value=h.GrantType,N.value=h.Content,_.value=h.Procedures,b.value=h.Links,N.value.Filename&&(l.value={Name:N.value.Filename,Path:N.value.Path}),_.value.length?_.value.forEach((E,n)=>{n&&(E.Deleted=!0)}):_.value.push({}),v().init(g.value.TypeCode)}):_.value.push({})}),(h,E)=>{const n=e.resolveComponent("required-label"),V=e.resolveComponent("input-select"),s=e.resolveComponent("input-integer"),o=e.resolveComponent("input-text"),f=e.resolveComponent("input-file"),k=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",i$,[E[37]||(E[37]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("table",m$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[17]||(E[17]=[e.createTextVNode("補助類別(代碼)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(V,{class:"w-auto",error:e.unref(r).TypeCode,options:e.unref(c),modelValue:e.unref(g).TypeCode,"onUpdate:modelValue":E[0]||(E[0]=S=>e.unref(g).TypeCode=S)},{default:e.withCtx(({option:S})=>[e.createElementVNode("option",{value:S.code},e.toDisplayString(S.title)+" ("+e.toDisplayString(S.code)+")",9,p$)]),_:1},8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[18]||(E[18]=[e.createTextVNode("年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(s,{class:"w-auto",error:e.unref(r).Year,modelValue:e.unref(g).Year,"onUpdate:modelValue":E[1]||(E[1]=S=>e.unref(g).Year=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[19]||(E[19]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{error:e.unref(r).FullName,modelValue:e.unref(g).FullName,"onUpdate:modelValue":E[2]||(E[2]=S=>e.unref(g).FullName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[20]||(E[20]=[e.createTextVNode("相關檔案",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(顯示於首頁)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(l)?(e.openBlock(),e.createElementBlock("div",V$,[e.createElementVNode("span",f$,[e.createElementVNode("a",{class:"tag-link my-1",download:e.unref(l).Name,href:e.unref(u)(e.unref(l).Path)},e.toDisplayString(e.unref(l).Name),9,N$),e.createElementVNode("button",{class:"tag-btn",onClick:E[3]||(E[3]=S=>l.value=null),type:"button"},[...E[21]||(E[21]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])])])])):(e.openBlock(),e.createElementBlock("div",E$,[e.createVNode(f,{onFile:E[4]||(E[4]=S=>l.value=S)})])),e.unref(r).Filename?(e.openBlock(),e.createElementBlock("div",b$,e.toDisplayString(e.unref(r).Filename),1)):e.createCommentVNode("",!0)])])])]),E[38]||(E[38]=e.createElementVNode("h5",{class:"square-title mt-4"},"我的E政府",-1)),e.createElementVNode("table",g$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[22]||(E[22]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(o,{disabled:"",modelValue:e.unref(g).FullName,"onUpdate:modelValue":E[5]||(E[5]=S=>e.unref(g).FullName=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[23]||(E[23]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(k,{error:e.unref(r).ServiceContent,modelValue:e.unref(N).ServiceContent,"onUpdate:modelValue":E[6]||(E[6]=S=>e.unref(N).ServiceContent=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[E[24]||(E[24]=e.createElementVNode("th",null,"關鍵字",-1)),e.createElementVNode("td",null,[e.createVNode(o,{modelValue:e.unref(N).Keywords,"onUpdate:modelValue":E[7]||(E[7]=S=>e.unref(N).Keywords=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[E[25]||(E[25]=e.createElementVNode("th",null,"申辦資格",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(N).Criteria,"onUpdate:modelValue":E[8]||(E[8]=S=>e.unref(N).Criteria=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[26]||(E[26]=[e.createTextVNode("申辦流程",-1)])]),_:1})]),e.createElementVNode("td",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t),(S,D)=>(e.openBlock(),e.createBlock(k,{key:S,error:e.unref(r)[`procedure-${D}-Content`],modelValue:S.Content,"onUpdate:modelValue":T=>S.Content=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"]))),128))])]),e.createElementVNode("tr",null,[E[27]||(E[27]=e.createElementVNode("th",null,"應備物品",-1)),e.createElementVNode("td",null,[e.createVNode(k,{modelValue:e.unref(N).Documentary,"onUpdate:modelValue":E[9]||(E[9]=S=>e.unref(N).Documentary=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...E[28]||(E[28]=[e.createTextVNode("聯絡窗口",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",y$,[e.createElementVNode("div",k$,[E[29]||(E[29]=e.createElementVNode("label",{class:"me-2"},"聯絡電話及分機",-1)),e.createVNode(o,{modelValue:e.unref(N).ContactTel,"onUpdate:modelValue":E[10]||(E[10]=S=>e.unref(N).ContactTel=S),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",u$,[E[30]||(E[30]=e.createElementVNode("label",{class:"me-2"},"聯絡人",-1)),e.createVNode(o,{modelValue:e.unref(N).ContactPerson,"onUpdate:modelValue":E[11]||(E[11]=S=>e.unref(N).ContactPerson=S),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.unref(r).ContactTel||e.unref(r).ContactPerson?(e.openBlock(),e.createElementBlock("div",h$,e.toDisplayString(e.unref(r).ContactTel||e.unref(r).ContactPerson),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[E[33]||(E[33]=e.createElementVNode("th",null,[e.createTextVNode("線上申辦"),e.createElementVNode("br"),e.createTextVNode("參考資料")],-1)),e.createElementVNode("td",null,[e.unref(m).length?(e.openBlock(),e.createElementBlock("table",x$,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(S,D)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",$$,e.toDisplayString(D+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",B$,[e.createElementVNode("div",_$,[e.createVNode(o,{error:e.unref(r)[`link-${D}-Title`],placeholder:"參考資料名稱",modelValue:S.Title,"onUpdate:modelValue":T=>S.Title=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",C$,[e.createVNode(o,{error:e.unref(r)[`link-${D}-URL`],placeholder:"網址",modelValue:S.URL,"onUpdate:modelValue":T=>S.URL=T,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("td",T$,[e.createElementVNode("div",w$,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:T=>S.Deleted=!0,type:"button"},[...E[31]||(E[31]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,D$)])])]))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:E[12]||(E[12]=S=>e.unref(b).push({})),type:"button"},[...E[32]||(E[32]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])]),e.unref(N).Status===1?(e.openBlock(),e.createElementBlock("tr",S$,[E[35]||(E[35]=e.createElementVNode("th",null,"申請下架",-1)),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"status-checkbox",type:"checkbox","onUpdate:modelValue":E[13]||(E[13]=S=>e.isRef(i)?i.value=S:null)},null,512),[[e.vModelCheckbox,e.unref(i)]]),E[34]||(E[34]=e.createElementVNode("label",{class:"form-check-label ms-1 mb-2",for:"status-checkbox"},"申請E政府下架（請輸入原因）",-1)),e.createVNode(k,{error:e.unref(r).StatusReason,modelValue:e.unref(N).StatusReason,"onUpdate:modelValue":E[14]||(E[14]=S=>e.unref(N).StatusReason=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",A$,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:E[15]||(E[15]=S=>d()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:E[16]||(E[16]=S=>d(!0)),type:"button"},[...E[36]||(E[36]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定發布",-1)])])])])}}},U$={class:"block"},P$={class:"table align-middle gray-table side-table"},M$={class:"p-0"},I$={class:"row align-items-center mb-0"},j$={class:"col p-4"},O$={class:"col p-4"},L$={class:"col p-4"},R$={class:"d-flex align-items-center flex-wrap gap-2"},q$={class:"input-group",style:{width:"360px"}},z$={class:"d-flex align-items-center flex-wrap gap-2"},G$={class:"input-group",style:{width:"360px"}},J$={style:{width:"360px"}},Y$={class:"d-flex align-items-center mb-2"},Q$={class:"d-flex align-items-center mb-2"},H$={class:"d-flex align-items-center mb-2"},W$={class:"d-flex align-items-center mb-2"},K$={class:"d-flex align-items-center gap-2"},X$={class:"d-flex align-items-center flex-wrap gap-2"},Z$={class:"input-group",style:{width:"360px"}},v$={class:"d-flex align-items-center flex-wrap gap-2"},e2={class:"input-group",style:{width:"360px"}},t2={__name:"GrantForm2",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),i=e.ref(!1),N=B,r=()=>{const l={};i.value||(c.value.OverduePeriod=null),F.system("saveGrantType",{GrantType:Object.assign(c.value,l)}).subscribe(t=>{t&&(t.error?Swal.fire({title:t.error,icon:"error"}):N("next"))})};return e.onMounted(()=>{F.system("getGrantType",{ID:y.id}).subscribe(l=>{c.value=l.GrantType,c.value.OverduePeriod&&(i.value=!0)})}),(l,t)=>{const m=e.resolveComponent("input-integer"),g=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-tw-date"),_=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock("div",U$,[e.createElementVNode("table",P$,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[18]||(t[18]=e.createElementVNode("th",null,"補助類別 全稱",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(c).FullName),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"補助類別 簡稱",-1)),e.createElementVNode("td",M$,[e.createElementVNode("div",I$,[e.createElementVNode("div",j$,e.toDisplayString(e.unref(c).ShortName),1),t[19]||(t[19]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"代碼",-1)),e.createElementVNode("div",O$,e.toDisplayString(e.unref(c).TypeCode),1),t[20]||(t[20]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"年度",-1)),e.createElementVNode("div",L$,e.toDisplayString(e.unref(c).Year),1)])])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"總預算經費(元)",-1)),e.createElementVNode("td",null,[e.createVNode(m,{class:"w-auto",modelValue:e.unref(c).BudgetFees,"onUpdate:modelValue":t[0]||(t[0]=u=>e.unref(c).BudgetFees=u),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[t[23]||(t[23]=e.createElementVNode("th",null,"身分標籤",-1)),e.createElementVNode("td",null,[e.createVNode(g,{rows:"5",modelValue:e.unref(c).TargetTags,"onUpdate:modelValue":t[1]||(t[1]=u=>e.unref(c).TargetTags=u),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[t[25]||(t[25]=e.createElementVNode("th",null,"申請期間",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",R$,[e.createElementVNode("div",q$,[e.createVNode(b,{modelValue:e.unref(c).ApplyStartDate,"onUpdate:modelValue":t[2]||(t[2]=u=>e.unref(c).ApplyStartDate=u)},null,8,["modelValue"]),t[24]||(t[24]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(b,{modelValue:e.unref(c).ApplyEndDate,"onUpdate:modelValue":t[3]||(t[3]=u=>e.unref(c).ApplyEndDate=u)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[t[26]||(t[26]=e.createElementVNode("th",null,"計畫期程迄日",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",z$,[e.createElementVNode("div",G$,[e.createVNode(b,{modelValue:e.unref(c).PlanEndDate,"onUpdate:modelValue":t[4]||(t[4]=u=>e.unref(c).PlanEndDate=u)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[t[31]||(t[31]=e.createElementVNode("th",null,"申請階段審查",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",J$,[e.createElementVNode("div",Y$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-1",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":t[5]||(t[5]=u=>e.unref(c).Review1Enabled=u)},null,512),[[e.vModelCheckbox,e.unref(c).Review1Enabled]]),t[27]||(t[27]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-1"},"1.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"資格審查",placeholder:"資格審查",modelValue:e.unref(c).Review1Title,"onUpdate:modelValue":t[6]||(t[6]=u=>e.unref(c).Review1Title=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Q$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-2",type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>e.unref(c).Review2Enabled=u)},null,512),[[e.vModelCheckbox,e.unref(c).Review2Enabled]]),t[28]||(t[28]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-2"},"2.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"初審",placeholder:"初審",modelValue:e.unref(c).Review2Title,"onUpdate:modelValue":t[8]||(t[8]=u=>e.unref(c).Review2Title=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",H$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-3",type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=u=>e.unref(c).Review3Enabled=u)},null,512),[[e.vModelCheckbox,e.unref(c).Review3Enabled]]),t[29]||(t[29]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-3"},"3.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"複審",placeholder:"複審",modelValue:e.unref(c).Review3Title,"onUpdate:modelValue":t[10]||(t[10]=u=>e.unref(c).Review3Title=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",W$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-4",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":t[11]||(t[11]=u=>e.unref(c).Review4Enabled=u)},null,512),[[e.vModelCheckbox,e.unref(c).Review4Enabled]]),t[30]||(t[30]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-4"},"4.",-1)),e.createVNode(_,{class:"w-auto","aria-label":"決審核定",placeholder:"決審核定",modelValue:e.unref(c).Review4Title,"onUpdate:modelValue":t[12]||(t[12]=u=>e.unref(c).Review4Title=u),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[t[34]||(t[34]=e.createElementVNode("th",null,"補正補件期限",-1)),e.createElementVNode("td",K$,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"overdue-period",type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=u=>e.isRef(i)?i.value=u:null)},null,512),[[e.vModelCheckbox,e.unref(i)]]),t[33]||(t[33]=e.createElementVNode("label",{class:"form-check-label",for:"overdue-period"},"有期限",-1)),e.unref(i)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(m,{class:"w-auto",modelValue:e.unref(c).OverduePeriod,"onUpdate:modelValue":t[14]||(t[14]=u=>e.unref(c).OverduePeriod=u),modelModifiers:{trim:!0}},null,8,["modelValue"]),t[32]||(t[32]=e.createTextVNode("天 ",-1))],64)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[t[35]||(t[35]=e.createElementVNode("th",null,[e.createTextVNode("期中報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("span",X$,[e.createElementVNode("span",Z$,[e.createVNode(b,{modelValue:e.unref(c).MidtermDeadline,"onUpdate:modelValue":t[15]||(t[15]=u=>e.unref(c).MidtermDeadline=u)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[t[38]||(t[38]=e.createElementVNode("th",null,[e.createTextVNode("期末/成果報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("div",v$,[e.createElementVNode("div",e2,[e.createVNode(b,{disabled:e.unref(c).FinalOneMonth,modelValue:e.unref(c).FinalDeadline,"onUpdate:modelValue":t[16]||(t[16]=u=>e.unref(c).FinalDeadline=u)},null,8,["disabled","modelValue"])]),t[36]||(t[36]=e.createElementVNode("span",{class:"p-2"},"或",-1)),e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"final-one-month",type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=u=>e.unref(c).FinalOneMonth=u)},null,512),[[e.vModelCheckbox,e.unref(c).FinalOneMonth]]),t[37]||(t[37]=e.createElementVNode("label",{class:"form-check-label",for:"final-one-month"},"計畫結束一個月後",-1))])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:r,type:"button"},"儲存")])])}}},l2={class:"block"},o2={class:"mt-4"},n2={class:"table-responsive"},r2={class:"table align-middle gray-table"},a2={class:"d-flex align-items-center gap-2"},s2=["id","onUpdate:modelValue"],d2=["for"],c2={__name:"GrantForm3",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref([]),i=B,N=()=>{const r=c.value.map(l=>({...l,MatchingFund:l.checked?l.MatchingFund:null}));F.system("saveGrantTargetSettings",{List:r}).subscribe(l=>{l&&i("next")})};return e.onMounted(()=>{F.system("getGrantTargetSettings",{ID:y.id}).subscribe(r=>{c.value=r.List,c.value.forEach(l=>{typeof l.MatchingFund=="number"&&(l.checked=!0)})})}),(r,l)=>{const t=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock("div",l2,[e.createElementVNode("div",o2,[e.createElementVNode("div",n2,[e.createElementVNode("table",r2,[l[1]||(l[1]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th"),e.createElementVNode("th",null,"適用申請單位類別"),e.createElementVNode("th",null,"補助經費上限(萬)"),e.createElementVNode("th",null,"配合款")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),(m,g)=>(e.openBlock(),e.createElementBlock("tr",{key:m},[e.createElementVNode("td",null,e.toDisplayString(g+1),1),e.createElementVNode("td",null,e.toDisplayString(m.TargetName),1),e.createElementVNode("td",null,[e.createVNode(t,{modelValue:m.GrantLimit,"onUpdate:modelValue":b=>m.GrantLimit=b},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",a2,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:`checkbox-${g}`,type:"checkbox","onUpdate:modelValue":b=>m.checked=b},null,8,s2),[[e.vModelCheckbox,m.checked]]),e.createElementVNode("label",{class:"form-check-label ms-1",for:`checkbox-${g}`},"配合款分攤比例",8,d2),m.checked?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(t,{class:"w-auto",modelValue:m.MatchingFund,"onUpdate:modelValue":b=>m.MatchingFund=b},null,8,["modelValue","onUpdate:modelValue"]),l[0]||(l[0]=e.createTextVNode("(%) ",-1))],64)):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:N,type:"button"},"儲存")])])}}},i2={class:"block"},m2={class:"mt-4"},p2={class:"table-responsive"},V2={class:"table align-middle gray-table side-table"},f2={class:"input-group",style:{width:"400px"}},N2={class:"teal-dark-tabs"},E2={key:0,class:"table-responsive sub-table"},b2={class:"table align-middle gray-table"},g2={class:"d-flex gap-2"},y2=["onClick"],k2={key:1},u2={class:"d-flex gap-2"},h2={__name:"GrantForm4",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),i=e.ref(),N=e.ref([]),r=e.ref({}),l=e.ref(1),t=e.ref(""),m=()=>{const u=/^(.*?)\s*<([^>]+)>$/;t.value.split(`
`).forEach(p=>{const d=p.trim().match(u);d&&r.value[i.value].push({CommitteeUser:d[1],Email:d[2]})}),l.value=1,t.value=""},g=B,b=()=>{if(!_()){e.nextTick(()=>{var u;return(u=document.querySelector(".invalid"))==null?void 0:u.scrollIntoView({behavior:"smooth",block:"center"})});return}F.system("saveReviewCommitteeList",{ID:i.value,List:r.value[i.value]}).subscribe(u=>{u&&g("next")})},_=()=>{const u={CommitteeUser:"姓名",Email:{presence:{message:"^請輸入 Email"},email:{message:"格式錯誤"}}};return c.value={},r.value[i.value].filter(p=>!p.Deleted).forEach((p,d)=>Object.assign(c.value,I(p,u,`item-${d}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{F.system("getReviewGroups",{ID:y.id}).subscribe(u=>{N.value=u.List,i.value=N.value[0].Value})}),e.watch(i,u=>{r.value[u]||F.system("getReviewCommitteeList",{ID:u}).subscribe(p=>{r.value[u]=p.List})}),(u,p)=>{var n;const d=e.resolveComponent("required-label"),a=e.resolveComponent("input-select"),h=e.resolveComponent("input-text"),E=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",i2,[e.createElementVNode("div",m2,[e.createElementVNode("div",p2,[e.createElementVNode("table",V2,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(d,null,{default:e.withCtx(()=>[...p[5]||(p[5]=[e.createTextVNode("審查組別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",f2,[e.createVNode(a,{options:e.unref(N),"text-name":"Text","value-name":"Value",modelValue:e.unref(i),"onUpdate:modelValue":p[0]||(p[0]=V=>e.isRef(i)?i.value=V:null)},null,8,["options","modelValue"])])])]),e.createElementVNode("tr",null,[p[11]||(p[11]=e.createElementVNode("th",null,"審查委員名單",-1)),e.createElementVNode("td",null,[e.createElementVNode("ul",N2,[e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(l)===1})},[e.createElementVNode("a",{class:"tab-link",onClick:p[1]||(p[1]=V=>l.value=1),href:"javascript:void(0)"},"逐筆輸入")],2),e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(l)===2})},[e.createElementVNode("a",{class:"tab-link",onClick:p[2]||(p[2]=V=>l.value=2),href:"javascript:void(0)"},"批次輸入")],2)]),e.unref(l)===1?(e.openBlock(),e.createElementBlock("div",E2,[e.createElementVNode("table",b2,[p[7]||(p[7]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"1%"}),e.createElementVNode("th",null,"姓名"),e.createElementVNode("th",null,"Email"),e.createElementVNode("th",{width:"1%"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((n=e.unref(r)[e.unref(i)])==null?void 0:n.filter(V=>!V.Deleted),(V,s)=>(e.openBlock(),e.createElementBlock("tr",{key:V},[e.createElementVNode("td",null,e.toDisplayString(s+1),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c)[`item-${s}-CommitteeUser`],modelValue:V.CommitteeUser,"onUpdate:modelValue":o=>V.CommitteeUser=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c)[`item-${s}-Email`],modelValue:V.Email,"onUpdate:modelValue":o=>V.Email=o,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",g2,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:o=>V.Deleted=!0,type:"button"},[...p[6]||(p[6]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,y2)])])]))),128))])]),e.createElementVNode("button",{class:"btn btn-sm btn-teal",onClick:p[3]||(p[3]=V=>{var s;return(s=e.unref(r)[e.unref(i)])==null?void 0:s.push({})}),type:"button"},[...p[8]||(p[8]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])):e.createCommentVNode("",!0),e.unref(l)===2?(e.openBlock(),e.createElementBlock("div",k2,[e.createElementVNode("div",u2,[e.createVNode(E,{placeholder:`張曉明 <aming@gmail.com>
陳小華 <hwahchen@xxx.edu.tw>`,rows:"5",modelValue:e.unref(t),"onUpdate:modelValue":p[4]||(p[4]=V=>e.isRef(t)?t.value=V:null),modelModifiers:{trim:!0}},null,8,["modelValue"]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:m,type:"button"},[...p[9]||(p[9]=[e.createElementVNode("i",{class:"fa-solid fa-plus"},null,-1),e.createTextVNode("新增",-1)])])]),p[10]||(p[10]=e.createElementVNode("label",{class:"form-text"},"輸入格式範例「姓名 <xxx@email.com>」，多筆請斷行輸入",-1))])):e.createCommentVNode("",!0)])])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:b,type:"button"},"儲存")])])}}},x2={class:"search-form"},$2={class:"row g-3"},B2={class:"col-3"},_2=["value"],C2={class:"block rounded-4 mt-4"},T2={class:"table-responsive",style:{"min-height":"400px"}},w2={"aria-label":"公告列表",class:"table teal-table"},D2={"data-th":"年度:"},S2={"data-th":"補助類別全稱:",class:"text-start"},A2={"data-th":"簡稱:",class:"text-start"},F2={"data-th":"代碼:",class:"text-start"},U2={"data-th":"申請期間:",class:"text-start"},P2={"data-th":"管理:",class:"text-center"},M2={class:"d-inline-flex gap-2"},I2=["href"],j2={__name:"GrantList",setup(x){const B=e.ref([]),y=e.ref(),c=e.ref([]),i=e.computed(()=>B.value.filter(N=>N.Year===y.value));return e.onMounted(()=>{F.system("getGrantTypeList").subscribe(N=>{B.value=N.List,c.value=[],B.value.forEach(r=>{c.value.includes(r.Year)||c.value.push(r.Year)}),y.value=c.value.length?c.value[0]:null})}),(N,r)=>{const l=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",x2,[e.createElementVNode("div",$2,[e.createElementVNode("div",B2,[r[1]||(r[1]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":r[0]||(r[0]=t=>e.isRef(y)?y.value=t:null)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),t=>(e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t)+"年",9,_2))),128))],512),[[e.vModelSelect,e.unref(y)]])])])]),e.createElementVNode("div",C2,[r[5]||(r[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="GrantEdit.aspx"><i class="fa-solid fa-plus"></i> 新增類別 </a></div>',1)),e.createElementVNode("div",T2,[e.createElementVNode("table",w2,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"補助類別全稱"),e.createElementVNode("th",{scope:"col",class:"text-start"},"簡稱"),e.createElementVNode("th",{scope:"col"},"代碼"),e.createElementVNode("th",{scope:"col"},"申請期間"),e.createElementVNode("th",{scope:"col"},"管理")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),t=>(e.openBlock(),e.createElementBlock("tr",{key:t},[e.createElementVNode("td",D2,e.toDisplayString(t.Year),1),e.createElementVNode("td",S2,e.toDisplayString(t.FullName),1),e.createElementVNode("td",A2,e.toDisplayString(t.ShortName),1),e.createElementVNode("td",F2,e.toDisplayString(t.TypeCode),1),e.createElementVNode("td",U2,[e.createVNode(l,{"default-value":"未設定",value:t.ApplyStartDate},null,8,["value"]),r[2]||(r[2]=e.createTextVNode(" ~ ",-1)),e.createVNode(l,{"default-value":"未設定",value:t.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",P2,[e.createElementVNode("div",M2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`GrantEdit.aspx?ID=${t.TypeID}`},[...r[3]||(r[3]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,I2)])])]))),128))])])])])],64)}}},O2={class:"block rounded-4 mt-4"},L2={class:"table-responsive",style:{"min-height":"400px"}},R2={class:"table teal-table","aria-label":"公告列表"},q2={"data-th":"公告期間:"},z2={key:1},G2={"data-th":"公告標題:",class:"text-start"},J2={"data-th":"發布者:",class:"text-start"},Y2={"data-th":"功能:",class:"text-center"},Q2={class:"d-inline-flex gap-2"},H2=["href"],W2=["onClick"],K2={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},X2={class:"modal-content"},Z2={class:"modal-body"},v2={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},eB={__name:"NewsList",setup(x){let B;const y=e.ref([]),c=e.ref(),i=e.ref(1),N=e.ref(10),r=e.computed(()=>y.value.slice((i.value-1)*N.value,i.value*N.value)),l=(m,g)=>{i.value=parseInt(m),N.value=parseInt(g)},t=(m,g)=>{if(!g){B=m,bootstrap.Modal.getOrCreateInstance(c.value).show();return}F.system("deleteNews",{ID:m.ID}).subscribe(b=>{b&&(y.value=y.value.filter(_=>_!==m),bootstrap.Modal.getOrCreateInstance(c.value).hide())})};return e.onMounted(()=>{F.system("getNewsList").subscribe(m=>y.value=m.List)}),(m,g)=>{const b=e.resolveComponent("tw-date"),_=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",O2,[g[5]||(g[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="NewsEdit.aspx"><i class="fa-solid fa-plus"></i> 新增公告 </a></div>',1)),e.createElementVNode("div",L2,[e.createElementVNode("table",R2,[g[4]||(g[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告期間"),e.createElementVNode("th",{class:"text-start",scope:"col"},"公告標題"),e.createElementVNode("th",{class:"text-start",scope:"col",style:{width:"200px"}},"發布者"),e.createElementVNode("th",{scope:"col",style:{width:"180px"}},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),u=>(e.openBlock(),e.createElementBlock("tr",{key:u},[e.createElementVNode("td",q2,[e.createVNode(b,{value:u.EnableTime},null,8,["value"]),g[1]||(g[1]=e.createTextVNode(" ~ ",-1)),u.DisableTime?(e.openBlock(),e.createBlock(b,{key:0,value:u.DisableTime},null,8,["value"])):(e.openBlock(),e.createElementBlock("span",z2,"未設定"))]),e.createElementVNode("td",G2,e.toDisplayString(u.Title),1),e.createElementVNode("td",J2,e.toDisplayString(u.UserOrg)+" "+e.toDisplayString(u.UserName),1),e.createElementVNode("td",Y2,[e.createElementVNode("div",Q2,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`NewsEdit.aspx?ID=${u.ID}`},[...g[2]||(g[2]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,H2),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:p=>t(u),type:"button"},[...g[3]||(g[3]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,W2)])])]))),128))])])]),e.createVNode(_,{count:e.unref(y).length,onChange:l,page:e.unref(i),"page-size":e.unref(N)},null,8,["count","page","page-size"])]),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:c,tabindex:"-1"},[e.createElementVNode("div",K2,[e.createElementVNode("div",X2,[g[7]||(g[7]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 fw-bold text-green-light"},"確定刪除公告資料？"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Z2,[e.createElementVNode("div",v2,[g[6]||(g[6]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:g[0]||(g[0]=u=>t(e.unref(B),!0)),type:"button"},"確認刪除")])])])])],512)],64)}}},tB={class:"block rounded-top-4 mt-4 d-flex flex-column gap-5"},lB={class:"table-responsive mt-3 mb-0"},oB={class:"table align-middle gray-table side-table"},nB={class:"d-flex align-items-center gap-2"},rB={class:"input-group w-auto"},aB={key:0,class:"invalid mt-0"},sB={class:"d-flex mb-2 gap-3"},dB={class:"tag-group mt-3"},cB={key:0,class:"tag tag-green-light"},iB=["download","href"],mB=["onClick"],pB={class:"d-flex mb-2 gap-3"},VB={class:"image-preview mt-3"},fB={key:0,class:"image-preview__item"},NB=["src"],EB={class:"image-preview__item-overlay"},bB=["onClick"],gB={class:"d-flex mb-2 gap-3"},yB={key:0,class:"table-responsive mt-3"},kB={class:"table align-middle gray-table"},uB={class:"text-center"},hB={class:"d-flex gap-1"},xB=["onClick"],re={AccessibilityApplication:st,AccessibilityAttachment:Dt,AccessibilityBenefit:Gt,AccessibilityFunding:gl,AccessibilityPayment1:Gl,AccessibilityPayment2:yo,AccessibilityProgressBar:ko,AccessibilityWorkSchedule:Yo,AuditHistory:rn,ConfirmModal:pn,CommonProgressBar:yn,CultureApplication:or,CultureAttachment:_r,CultureFunding:vr,CultureOther:Na,CulturePayment1:Ra,CulturePayment2:Ns,CultureProgress:Us,CultureProgressBar:Ps,CultureWorkSchedule:Cd,EducationApplication:Mc,EducationAttachment:ri,EducationPayment:Ai,EducationProgressBar:Fi,ErrorModal:Oi,HomeDashboard:zm,InputBoolean:Gm,InputFile:Jm,InputInteger:Hm,InputMonth:Wm,InputRadioGroup:Zm,InputSelect:op,InputText:dp,InputTextarea:Vp,InputTwDate:Ep,ListPager:Sp,LiteracyApplication:mV,LiteracyAttachment:UV,LiteracyBenefit:HV,LiteracyFunding:xf,LiteracyPayment1:Qf,LiteracyPayment2:gN,LiteracyProgressBar:yN,LiteracyWorkSchedule:JN,MultipleApplication:B1,MultipleAttachment:H1,MultipleBenefit:dE,MultipleFunding:ME,MultiplePayment1:ab,MultiplePayment2:Fb,MultiplePayment3:ag,MultipleProgressBar:sg,MultipleWorkSchedule:Fg,NewsDetail:Yg,NewsList:ey,NewsMarquee:ay,ProjectChangeReview:py,ProjectCorrectionReview:gy,ProjectOrganizer:Cy,ProjectPaymentReview:My,ProjectProgress:Yy,ProjectReport:ik,ProjectReportReview:Ek,ProjectReview:_k,ProjectTitle:Uk,ProjectToolbar:Kk,ReportApplyList:Mu,ReportApprovedList:ch,ReportInprogressList:qh,ReportMixChart:zh,ReportPieChart:Gh,ReportRecusedList:Vx,ReportReviewerDetails:Bx,ReportReviewerList:e$,RequiredLabel:l$,ReviewCommitteeInfo:c$,SystemGrantForm1:F$,SystemGrantForm2:t2,SystemGrantForm3:c2,SystemGrantForm4:h2,SystemGrantList:j2,SystemNewsList:eB,SystemNewsForm:{__name:"NewsForm",props:{id:{type:[Number,String]}},emits:["next"],setup(x,{emit:B}){const y=x,c=e.ref({}),i=e.ref([]),N=e.computed(()=>t.value.filter(p=>!p.Deleted)),r=e.ref({}),l=e.ref([]),t=e.ref([]),m=(p,d)=>p.push({Path:d.Path,Name:d.Name}),g=F.download,b=B,_=()=>{if(!u()){e.nextTick(()=>{var d;return(d=document.querySelector(".invalid"))==null?void 0:d.scrollIntoView({behavior:"smooth",block:"center"})});return}const p={News:r.value,Files:i.value,Images:l.value,Videos:t.value};F.system("saveNews",p).subscribe(d=>{d&&b("next",d.ID)})},u=()=>{let p={Title:"公告標題",EnableTime:"公告期間",Content:"內容"};return c.value=I(r.value,p),p={Title:"影片名稱",URL:"影片網址"},N.value.forEach((d,a)=>Object.assign(c.value,I(d,p,`video-${a}-`))),!Object.keys(c.value).length};return e.onMounted(()=>{y.id?F.system("getNews",{ID:y.id}).subscribe(p=>{r.value=p.News,i.value=p.Files,l.value=p.Images,t.value=p.Videos}):F.system("getEmptyNews").subscribe(p=>r.value=p)}),(p,d)=>{const a=e.resolveComponent("required-label"),h=e.resolveComponent("input-text"),E=e.resolveComponent("input-tw-date"),n=e.resolveComponent("input-textarea"),V=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",tB,[e.createElementVNode("div",null,[d[12]||(d[12]=e.createElementVNode("h5",{class:"square-title"},"公告內容",-1)),e.createElementVNode("div",lB,[e.createElementVNode("table",oB,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[d[7]||(d[7]=e.createElementVNode("th",null,"發佈者",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(r).UserOrg)+"    "+e.toDisplayString(e.unref(r).UserName),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[8]||(d[8]=[e.createTextVNode("公告標題",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c).Title,modelValue:e.unref(r).Title,"onUpdate:modelValue":d[0]||(d[0]=s=>e.unref(r).Title=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[9]||(d[9]=[e.createTextVNode("公告期間",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",nB,[e.createElementVNode("div",rB,[e.createVNode(E,{class:"w-auto",modelValue:e.unref(r).EnableTime,"onUpdate:modelValue":d[1]||(d[1]=s=>e.unref(r).EnableTime=s)},null,8,["modelValue"]),d[10]||(d[10]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(E,{class:"w-auto",modelValue:e.unref(r).DisableTime,"onUpdate:modelValue":d[2]||(d[2]=s=>e.unref(r).DisableTime=s)},null,8,["modelValue"])])]),e.unref(c).EnableTime?(e.openBlock(),e.createElementBlock("div",aB,e.toDisplayString(e.unref(c).EnableTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...d[11]||(d[11]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(c).Content,modelValue:e.unref(r).Content,"onUpdate:modelValue":d[3]||(d[3]=s=>e.unref(r).Content=s),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",null,[e.createElementVNode("div",sB,[d[13]||(d[13]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關附件")],-1)),e.createVNode(V,{accept:".pdf,.odt,.doc,.docx,.zip",onFile:d[4]||(d[4]=s=>m(e.unref(i),s))})]),d[15]||(d[15]=e.createElementVNode("span",{class:"text-pink"},"支援文件 pdf, odt, doc, docx (10MB以內)、ZIP 壓縮檔 (50MB以內)",-1)),e.createElementVNode("div",dB,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),s=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:s},[s.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",cB,[e.createElementVNode("a",{class:"tag-link my-1",download:s.Name,href:e.unref(g)(s.Path)},e.toDisplayString(s.Name),9,iB),e.createElementVNode("button",{class:"tag-btn",onClick:o=>s.Deleted=!0,type:"button"},[...d[14]||(d[14]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,mB)]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",pB,[d[16]||(d[16]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關圖片")],-1)),e.createVNode(V,{accept:".jpg,.png",onFile:d[5]||(d[5]=s=>m(e.unref(l),s))})]),d[18]||(d[18]=e.createElementVNode("span",{class:"text-pink"},"支援 JPG, PNG，檔案大小 10MB以內",-1)),e.createElementVNode("div",VB,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),s=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:s},[s.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",fB,[e.createElementVNode("img",{alt:"picture",src:e.unref(g)(s.Path)},null,8,NB),e.createElementVNode("div",EB,[e.createElementVNode("button",{"aria-label":"移除圖片",class:"btn btn-remove-image",onClick:o=>s.Deleted=!0,type:"button"},[...d[17]||(d[17]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,bB)])]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",gB,[d[20]||(d[20]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關影片")],-1)),e.createElementVNode("button",{"aria-label":"新增影片",class:"btn btn-teal-dark",onClick:d[6]||(d[6]=s=>e.unref(t).push({})),type:"button"},[...d[19]||(d[19]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增 ",-1)])])]),e.unref(N).length?(e.openBlock(),e.createElementBlock("div",yB,[e.createElementVNode("table",kB,[d[22]||(d[22]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80",class:"text-center"},"項次"),e.createElementVNode("th",null,"影片名稱"),e.createElementVNode("th",null,"影片網址"),e.createElementVNode("th",{width:"120"},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(s,o)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",uB,e.toDisplayString(o+1),1),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c)[`video-${o}-Title`],modelValue:s.Title,"onUpdate:modelValue":f=>s.Title=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(h,{error:e.unref(c)[`video-${o}-URL`],modelValue:s.URL,"onUpdate:modelValue":f=>s.URL=f,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",hB,[e.createElementVNode("button",{"aria-label":"刪除影片",class:"btn btn-sm btn-teal-dark",onClick:f=>s.Deleted=!0,type:"button"},[...d[21]||(d[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,xB)])])]))),128))])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:_,type:"button"},[...d[23]||(d[23]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確認送出",-1)])])])],64)}}},Tooltip:{__name:"Tooltip",setup(x){const B=e.ref();let y;return e.onMounted(()=>{y=new bootstrap.Tooltip(B.value)}),e.onUnmounted(()=>{y&&y.dispose()}),(c,i)=>(e.openBlock(),e.createElementBlock("button",{class:"btn-tooltip",ref_key:"element",ref:B,style:{color:"#027f72"},type:"button"},[...i[0]||(i[0]=[e.createElementVNode("i",{class:"fa-solid fa-circle-info"},null,-1)])],512))}},TwDate:{__name:"TwDate",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(x){const B=x,y=i=>{const N=i==null?void 0:i.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return N?`${parseInt(N[1],10)-1911}/${N[2]}/${N[3]}`:""},c=e.ref(y(B.value));return e.watch(()=>B.value,i=>c.value=y(i)),(i,N)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||x.defaultValue),1))}},TwDateTime:{__name:"TwDateTime",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(x){const B=x,y=i=>{const N=i==null?void 0:i.match(/^(\d+)[\/-](\d+)[\/-](\d+)[ T](\d+:\d+(:\d+)?)/);return N?`${parseInt(N[1],10)-1911}/${N[2]}/${N[3]} ${N[4]}`:""},c=e.ref(y(B.value));return e.watch(()=>B.value,i=>c.value=y(i)),(i,N)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(c)||x.defaultValue),1))}}};return{api:F,install:x=>{for(const B in re)x.component(B,re[B])},useGrantStore:v,useProgressStore:j}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
