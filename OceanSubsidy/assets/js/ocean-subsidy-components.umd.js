(function(e,Q){typeof exports=="object"&&typeof module<"u"?module.exports=Q(require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["vue","pinia"],Q):(e=typeof globalThis<"u"?globalThis:e||self,e.OceanSubsidyComponents=Q(e.Vue,e.Pinia))})(this,(function(e,Q){"use strict";const j=Q.defineStore("progress",{actions:{init(B,_,x){var m,V;this[B]={id:_.ProjectID,type:(m=_.SubsidyPlanType)==null?void 0:m.split(" ")[0],name:_.ProjectName,step:_.FormStep,status:_.Status,progress:_.ProgressStatus,changeStatus:(V=_.changeApply)==null?void 0:V.Status,reportStatus:x==null?void 0:x.Status,organizer:_.Organizer,organizerName:_.OrganizerName}}},state:()=>({accessibility:{},culture:{},education:{},literacy:{},multiple:{}})});let oe=Date.now();const z=(B,_,x)=>{const m=j();if([1,14].includes(m[B].status)||[1,4].includes(m[B].changeStatus))return!0;if(m[B].status===42)switch(B){case"culture":if([2,3,5].includes(x))return!0;break;case"multiple":if([2,3,4,5].includes(x))return!0;break;case"accessibility":if([2,3,4,5].includes(x))return!0;break}return!1},ne=()=>`id--${oe++}`,q=B=>parseInt(B)||0,v=Q.defineStore("message",{state:()=>({error:null})}),{ajax:re}=rxjs.ajax,{map:ae}=rxjs;let Z="";const se=(B,_={})=>W("Service/OFS/Accessibility.ashx",{method:B,param:_}),de=(B,_={})=>W("Service/OFS/Culture.ashx",{method:B,param:_}),ce=B=>`${Z}/Service/OFS/Download.ashx?path=${B}`,ie=(B,_={})=>W("Service/OFS/Education.ashx",{method:B,param:_}),me=(B,_={})=>W("Service/OFS/Literacy.ashx",{method:B,param:_}),pe=(B,_={})=>W("Service/OFS/Multiple.ashx",{method:B,param:_}),Ve=({response:B,status:_})=>{if(_===200){if(B.success)return B.data;v().error=B.message}},W=(B,_={})=>{const x={};_.constructor!==FormData&&(x["Content-Type"]="application/json");const m={body:_,headers:x,method:"POST",url:`${Z}/${B}`};return re(m).pipe(ae(Ve))},U=Object.assign(W,{accessibility:se,culture:de,download:ce,education:ie,literacy:me,multiple:pe,setBaseUrl:B=>Z=B,system:(B,_={})=>W("Service/OFS/System.ashx",{method:B,param:_}),upload:B=>{const _=new FormData;return _.append("file",B),W("Service/OFS/Upload.ashx",_)}});function fe(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var H={exports:{}};/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */var Ne=H.exports,ee;function Ee(){return ee||(ee=1,(function(B,_){(function(x,m,V){var N=function(o,l,d){d=r.extend({},r.options,d);var k=r.runValidations(o,l,d);if(k.some(function(E){return r.isPromise(E.error)}))throw new Error("Use validate.async if you want support for promises");return N.processValidationResults(k,d)},r=N;r.extend=function(o){return[].slice.call(arguments,1).forEach(function(l){for(var d in l)o[d]=l[d]}),o},r.extend(N,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var o=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(o+="+"+r.version.metadata),o}},Promise:typeof Promise<"u"?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(o,l,d){var k=[],E,u,h,g,s,a,y;(r.isDomElement(o)||r.isJqueryElement(o))&&(o=r.collectFormValues(o));for(E in l){h=r.getDeepObjectValue(o,E),g=r.result(l[E],h,o,E,d,l);for(u in g){if(s=r.validators[u],!s)throw y=r.format("Unknown validator %{name}",{name:u}),new Error(y);a=g[u],a=r.result(a,h,o,E,d,l),a&&k.push({attribute:E,value:h,validator:u,globalOptions:d,attributes:o,options:a,error:s.call(s,h,a,E,o,d)})}}return k},processValidationResults:function(o,l){o=r.pruneEmptyErrors(o,l),o=r.expandMultipleErrors(o,l),o=r.convertErrorMessages(o,l);var d=l.format||"grouped";if(typeof r.formatters[d]=="function")o=r.formatters[d](o);else throw new Error(r.format("Unknown format %{format}",l));return r.isEmpty(o)?void 0:o},async:function(o,l,d){d=r.extend({},r.async.options,d);var k=d.wrapErrors||function(u){return u};d.cleanAttributes!==!1&&(o=r.cleanAttributes(o,l));var E=r.runValidations(o,l,d);return new r.Promise(function(u,h){r.waitForResults(E).then(function(){var g=r.processValidationResults(E,d);g?h(new k(g,d,o,l)):u(o)},function(g){h(g)})})},single:function(o,l,d){return d=r.extend({},r.single.options,d,{format:"flat",fullMessages:!1}),r({single:o},{single:l},d)},waitForResults:function(o){return o.reduce(function(l,d){return r.isPromise(d.error)?l.then(function(){return d.error.then(function(k){d.error=k||null})}):l},new r.Promise(function(l){l()}))},result:function(o){var l=[].slice.call(arguments,1);return typeof o=="function"&&(o=o.apply(null,l)),o},isNumber:function(o){return typeof o=="number"&&!isNaN(o)},isFunction:function(o){return typeof o=="function"},isInteger:function(o){return r.isNumber(o)&&o%1===0},isBoolean:function(o){return typeof o=="boolean"},isObject:function(o){return o===Object(o)},isDate:function(o){return o instanceof Date},isDefined:function(o){return o!=null},isPromise:function(o){return!!o&&r.isFunction(o.then)},isJqueryElement:function(o){return o&&r.isString(o.jquery)},isDomElement:function(o){return!o||!o.querySelectorAll||!o.querySelector?!1:r.isObject(document)&&o===document?!0:typeof HTMLElement=="object"?o instanceof HTMLElement:o&&typeof o=="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName=="string"},isEmpty:function(o){var l;if(!r.isDefined(o))return!0;if(r.isFunction(o))return!1;if(r.isString(o))return r.EMPTY_STRING_REGEXP.test(o);if(r.isArray(o))return o.length===0;if(r.isDate(o))return!1;if(r.isObject(o)){for(l in o)return!1;return!0}return!1},format:r.extend(function(o,l){return r.isString(o)?o.replace(r.format.FORMAT_REGEXP,function(d,k,E){return k==="%"?"%{"+E+"}":String(l[E])}):o},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(o){return r.isNumber(o)?o*100%1===0?""+o:parseFloat(Math.round(o*100)/100).toFixed(2):r.isArray(o)?o.map(function(l){return r.prettify(l)}).join(", "):r.isObject(o)?r.isDefined(o.toString)?o.toString():JSON.stringify(o):(o=""+o,o.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(l,d,k){return""+d+" "+k.toLowerCase()}).toLowerCase())},stringifyValue:function(o,l){var d=l&&l.prettify||r.prettify;return d(o)},isString:function(o){return typeof o=="string"},isArray:function(o){return{}.toString.call(o)==="[object Array]"},isHash:function(o){return r.isObject(o)&&!r.isArray(o)&&!r.isFunction(o)},contains:function(o,l){return r.isDefined(o)?r.isArray(o)?o.indexOf(l)!==-1:l in o:!1},unique:function(o){return r.isArray(o)?o.filter(function(l,d,k){return k.indexOf(l)==d}):o},forEachKeyInKeypath:function(o,l,d){if(r.isString(l)){var k="",E,u=!1;for(E=0;E<l.length;++E)switch(l[E]){case".":u?(u=!1,k+="."):(o=d(o,k,!1),k="");break;case"\\":u?(u=!1,k+="\\"):u=!0;break;default:u=!1,k+=l[E];break}return d(o,k,!0)}},getDeepObjectValue:function(o,l){if(r.isObject(o))return r.forEachKeyInKeypath(o,l,function(d,k){if(r.isObject(d))return d[k]})},collectFormValues:function(o,l){var d={},k,E,u,h,g,s;if(r.isJqueryElement(o)&&(o=o[0]),!o)return d;for(l=l||{},h=o.querySelectorAll("input[name], textarea[name]"),k=0;k<h.length;++k)if(u=h.item(k),!r.isDefined(u.getAttribute("data-ignored"))){var a=u.name.replace(/\./g,"\\\\.");s=r.sanitizeFormValue(u.value,l),u.type==="number"?s=s?+s:null:u.type==="checkbox"?u.attributes.value?u.checked||(s=d[a]||null):s=u.checked:u.type==="radio"&&(u.checked||(s=d[a]||null)),d[a]=s}for(h=o.querySelectorAll("select[name]"),k=0;k<h.length;++k)if(u=h.item(k),!r.isDefined(u.getAttribute("data-ignored"))){if(u.multiple){s=[];for(E in u.options)g=u.options[E],g&&g.selected&&s.push(r.sanitizeFormValue(g.value,l))}else{var y=typeof u.options[u.selectedIndex]<"u"?u.options[u.selectedIndex].value:"";s=r.sanitizeFormValue(y,l)}d[u.name]=s}return d},sanitizeFormValue:function(o,l){return l.trim&&r.isString(o)&&(o=o.trim()),l.nullify!==!1&&o===""?null:o},capitalize:function(o){return r.isString(o)?o[0].toUpperCase()+o.slice(1):o},pruneEmptyErrors:function(o){return o.filter(function(l){return!r.isEmpty(l.error)})},expandMultipleErrors:function(o){var l=[];return o.forEach(function(d){r.isArray(d.error)?d.error.forEach(function(k){l.push(r.extend({},d,{error:k}))}):l.push(d)}),l},convertErrorMessages:function(o,l){l=l||{};var d=[],k=l.prettify||r.prettify;return o.forEach(function(E){var u=r.result(E.error,E.value,E.attribute,E.options,E.attributes,E.globalOptions);if(!r.isString(u)){d.push(E);return}u[0]==="^"?u=u.slice(1):l.fullMessages!==!1&&(u=r.capitalize(k(E.attribute))+" "+u),u=u.replace(/\\\^/g,"^"),u=r.format(u,{value:r.stringifyValue(E.value,l)}),d.push(r.extend({},E,{error:u}))}),d},groupErrorsByAttribute:function(o){var l={};return o.forEach(function(d){var k=l[d.attribute];k?k.push(d):l[d.attribute]=[d]}),l},flattenErrorsToArray:function(o){return o.map(function(l){return l.error}).filter(function(l,d,k){return k.indexOf(l)===d})},cleanAttributes:function(o,l){function d(u,h,g){return r.isObject(u[h])?u[h]:u[h]=g?!0:{}}function k(u){var h={},g;for(g in u)u[g]&&r.forEachKeyInKeypath(h,g,d);return h}function E(u,h){if(!r.isObject(u))return u;var g=r.extend({},u),s,a;for(a in u)s=h[a],r.isObject(s)?g[a]=E(g[a],s):s||delete g[a];return g}return!r.isObject(l)||!r.isObject(o)?{}:(l=k(l),E(o,l))},exposeModule:function(o,l,d,k,E){d?(k&&k.exports&&(d=k.exports=o),d.validate=o):(l.validate=o,o.isFunction(E)&&E.amd&&E([],function(){return o}))},warn:function(o){typeof console<"u"&&console.warn&&console.warn("[validate.js] "+o)},error:function(o){typeof console<"u"&&console.error&&console.error("[validate.js] "+o)}}),N.validators={presence:function(o,l){if(l=r.extend({},this.options,l),l.allowEmpty!==!1?!r.isDefined(o):r.isEmpty(o))return l.message||this.message||"can't be blank"},length:function(o,l,d){if(r.isDefined(o)){l=r.extend({},this.options,l);var k=l.is,E=l.maximum,u=l.minimum,h=l.tokenizer||function(y){return y},g,s=[];o=h(o);var a=o.length;if(!r.isNumber(a))return l.message||this.notValid||"has an incorrect length";if(r.isNumber(k)&&a!==k&&(g=l.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",s.push(r.format(g,{count:k}))),r.isNumber(u)&&a<u&&(g=l.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",s.push(r.format(g,{count:u}))),r.isNumber(E)&&a>E&&(g=l.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",s.push(r.format(g,{count:E}))),s.length>0)return l.message||s}},numericality:function(o,l,d,k,E){if(r.isDefined(o)){l=r.extend({},this.options,l);var u=[],h,g,s={greaterThan:function(c,f){return c>f},greaterThanOrEqualTo:function(c,f){return c>=f},equalTo:function(c,f){return c===f},lessThan:function(c,f){return c<f},lessThanOrEqualTo:function(c,f){return c<=f},divisibleBy:function(c,f){return c%f===0}},a=l.prettify||E&&E.prettify||r.prettify;if(r.isString(o)&&l.strict){var y="^-?(0|[1-9]\\d*)";if(l.onlyInteger||(y+="(\\.\\d+)?"),y+="$",!new RegExp(y).test(o))return l.message||l.notValid||this.notValid||this.message||"must be a valid number"}if(l.noStrings!==!0&&r.isString(o)&&!r.isEmpty(o)&&(o=+o),!r.isNumber(o))return l.message||l.notValid||this.notValid||this.message||"is not a number";if(l.onlyInteger&&!r.isInteger(o))return l.message||l.notInteger||this.notInteger||this.message||"must be an integer";for(h in s)if(g=l[h],r.isNumber(g)&&!s[h](o,g)){var i="not"+r.capitalize(h),n=l[i]||this[i]||this.message||"must be %{type} %{count}";u.push(r.format(n,{count:g,type:a(h)}))}if(l.odd&&o%2!==1&&u.push(l.notOdd||this.notOdd||this.message||"must be odd"),l.even&&o%2!==0&&u.push(l.notEven||this.notEven||this.message||"must be even"),u.length)return l.message||u}},datetime:r.extend(function(o,l){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(o)){l=r.extend({},this.options,l);var d,k=[],E=l.earliest?this.parse(l.earliest,l):NaN,u=l.latest?this.parse(l.latest,l):NaN;if(o=this.parse(o,l),isNaN(o)||l.dateOnly&&o%864e5!==0)return d=l.notValid||l.message||this.notValid||"must be a valid date",r.format(d,{value:arguments[0]});if(!isNaN(E)&&o<E&&(d=l.tooEarly||l.message||this.tooEarly||"must be no earlier than %{date}",d=r.format(d,{value:this.format(o,l),date:this.format(E,l)}),k.push(d)),!isNaN(u)&&o>u&&(d=l.tooLate||l.message||this.tooLate||"must be no later than %{date}",d=r.format(d,{date:this.format(u,l),value:this.format(o,l)}),k.push(d)),k.length)return r.unique(k)}},{parse:null,format:null}),date:function(o,l){return l=r.extend({},l,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,o,l)},format:function(o,l){(r.isString(l)||l instanceof RegExp)&&(l={pattern:l}),l=r.extend({},this.options,l);var d=l.message||this.message||"is invalid",k=l.pattern,E;if(r.isDefined(o)&&(!r.isString(o)||(r.isString(k)&&(k=new RegExp(l.pattern,l.flags)),E=k.exec(o),!E||E[0].length!=o.length)))return d},inclusion:function(o,l){if(r.isDefined(o)&&(r.isArray(l)&&(l={within:l}),l=r.extend({},this.options,l),!r.contains(l.within,o))){var d=l.message||this.message||"^%{value} is not included in the list";return r.format(d,{value:o})}},exclusion:function(o,l){if(r.isDefined(o)&&(r.isArray(l)&&(l={within:l}),l=r.extend({},this.options,l),!!r.contains(l.within,o))){var d=l.message||this.message||"^%{value} is restricted";return r.isString(l.within[o])&&(o=l.within[o]),r.format(d,{value:o})}},email:r.extend(function(o,l){l=r.extend({},this.options,l);var d=l.message||this.message||"is not a valid email";if(r.isDefined(o)&&(!r.isString(o)||!this.PATTERN.exec(o)))return d},{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(o,l,d,k,E){if(r.isDefined(o)){r.isString(l)&&(l={attribute:l}),l=r.extend({},this.options,l);var u=l.message||this.message||"is not equal to %{attribute}";if(r.isEmpty(l.attribute)||!r.isString(l.attribute))throw new Error("The attribute must be a non empty string");var h=r.getDeepObjectValue(k,l.attribute),g=l.comparator||function(a,y){return a===y},s=l.prettify||E&&E.prettify||r.prettify;if(!g(o,h,l,d,k))return r.format(u,{attribute:s(l.attribute)})}},url:function(o,l){if(r.isDefined(o)){l=r.extend({},this.options,l);var d=l.message||this.message||"is not a valid url",k=l.schemes||this.schemes||["http","https"],E=l.allowLocal||this.allowLocal||!1,u=l.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(o))return d;var h="^(?:(?:"+k.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(E?g+="?":h+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",h+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+g+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",u){var s="\\w+\\/[-+.\\w]+(?:;[\\w=]+)*",a="[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*",y="data:(?:"+s+")?(?:;base64)?,"+a;h="(?:"+h+")|(?:^"+y+"$)"}var i=new RegExp(h,"i");if(!i.exec(o))return d}},type:r.extend(function(o,l,d,k,E){if(r.isString(l)&&(l={type:l}),!!r.isDefined(o)){var u=r.extend({},this.options,l),h=u.type;if(!r.isDefined(h))throw new Error("No type was specified");var g;if(r.isFunction(h)?g=h:g=this.types[h],!r.isFunction(g))throw new Error("validate.validators.type.types."+h+" must be a function.");if(!g(o,u,d,k,E)){var s=l.message||this.messages[h]||this.message||u.message||(r.isFunction(h)?"must be of the correct type":"must be of type %{type}");return r.isFunction(s)&&(s=s(o,l,d,k,E)),r.format(s,{attribute:r.prettify(d),type:h})}}},{types:{object:function(o){return r.isObject(o)&&!r.isArray(o)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},N.formatters={detailed:function(o){return o},flat:r.flattenErrorsToArray,grouped:function(o){var l;o=r.groupErrorsByAttribute(o);for(l in o)o[l]=r.flattenErrorsToArray(o[l]);return o},constraint:function(o){var l;o=r.groupErrorsByAttribute(o);for(l in o)o[l]=o[l].map(function(d){return d.validator}).sort();return o}},N.exposeModule(N,this,x,m,V)}).call(Ne,_,B,null)})(H,H.exports)),H.exports}var be=Ee();const te=fe(be),P=(B,_,x="")=>{const m={};Object.keys(_).forEach(r=>{const o=_[r];te.isString(o)?m[r]={presence:{allowEmpty:!1,message:`^請輸入${o}`}}:m[r]=o});const V={},N=te(B,m);return N&&Object.keys(N).forEach(r=>V[`${x}${r}`]=N[r].join(",")),V},ge={class:"block"},ke={class:"mt-4"},ye={class:"table align-middle gray-table side-table"},ue={key:0},xe={key:1,class:"text-light-gray"},he={class:"d-flex flex-column gap-2"},$e={key:0},Be={class:"mt-4"},_e={class:"table align-middle gray-table side-table"},Ce={class:"row g-3"},Te={class:"col-12 col-xl-2"},we={class:"text-gray mb-2"},De={class:"col-12 col-xl-3"},Se={class:"text-gray mb-2"},Ae={class:"col-12 col-xl-4"},Fe={class:"row g-1"},Ue={class:"col-7"},Me={class:"col-5"},Pe={class:"col-12 col-xl-3"},Ie={class:"text-gray mb-2"},je={class:"col-12"},Oe={class:"text-gray mb-2"},Le={class:"mt-4"},Re={class:"table align-middle gray-table side-table"},qe={class:"mt-4"},ze={class:"table align-middle gray-table side-table"},Ge={key:0,class:"table-responsive mt-3 mb-0"},Je={class:"table align-middle gray-table"},Ye={key:0},Qe={key:0},We={class:"d-flex gap-2"},He=["onClick"],Xe={class:"mt-4"},Ke={class:"table align-middle gray-table side-table"},Ze={key:0,class:"block-bottom bg-light-teal"},ve={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.ref(),r=e.computed(()=>z("accessibility",d.value.Status,1)),o=e.ref({}),l=e.computed(()=>k.value.filter(i=>!i.Deleted)),d=e.ref({}),k=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:i=>{i?u():k.value.forEach(n=>n.Deleted=!0)}}),u=()=>k.value.push({}),h=_,g=()=>{U.accessibility("getApplication",{ID:x.id}).subscribe(i=>{d.value=i.Project,N.value=i.Contacts,k.value=i.ReceivedSubsidies,d.value.OrgCategory=d.value.OrgCategory||null,j().init("accessibility",d.value),V.value=d.value.changeApply,d.value.changeApply=void 0})},s=i=>i.Deleted=!0,a=i=>{var c,f;if(o.value={},i&&!y()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:d.value,Contacts:N.value,ReceivedSubsidies:k.value.filter(t=>t.ID||!t.Deleted),Before:(c=V.value)==null?void 0:c.Form1Before,After:(f=V.value)==null?void 0:f.Form1After,Submit:i?"true":"false"};U.accessibility("saveApplication",n).subscribe(t=>{i?h("next",t.ID):d.value.ID?g():window.location.href=`Application.aspx?ID=${t.ID}`})},y=()=>{let i={ProjectName:"計畫名稱",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return d.value.OrgCategory==="2"&&(i.RegisteredNum="立案登記證字號"),o.value=P(d.value,i),i={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((n,c)=>Object.assign(o.value,P(n,i,`contact-${c}-`))),i={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},k.value.forEach((n,c)=>Object.assign(o.value,P(n,i,`received-${c}-`))),V.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(V.value,i))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([U.accessibility("getZgsCodes",{CodeGroup:"ACCOrgCategory"})]).subscribe(i=>{m.value=i[0],x.id?g():U.accessibility("getEmptyApplication").subscribe(n=>{d.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},n),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("accessibility",d.value)})})}),e.provide("editable",r),(i,n)=>{const c=e.resolveComponent("required-label"),f=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),p=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ge,[n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",ke,[e.createElementVNode("table",ye,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",ue,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",xe,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[17]||(n[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o).ProjectName,modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=T=>e.unref(d).ProjectName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":n[1]||(n[1]=T=>e.unref(d).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",he,[e.createElementVNode("div",null,[e.createVNode(t,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(m),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).OrgCategory,"onUpdate:modelValue":n[2]||(n[2]=T=>e.unref(d).OrgCategory=T)},null,8,["error","options","modelValue"])]),e.unref(d).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",$e,[e.createVNode(f,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(d).RegisteredNum,"onUpdate:modelValue":n[3]||(n[3]=T=>e.unref(d).RegisteredNum=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(d).TaxID,"onUpdate:modelValue":n[4]||(n[4]=T=>e.unref(d).TaxID=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":n[5]||(n[5]=T=>e.unref(d).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[43]||(n[43]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Be,[e.createElementVNode("table",_e,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Ce,[e.createElementVNode("div",Te,[e.createElementVNode("div",we,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(o)[`contact-${S}-Name`],modelValue:T.Name,"onUpdate:modelValue":M=>T.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",De,[e.createElementVNode("div",Se,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[24]||(n[24]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(o)[`contact-${S}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":M=>T.JobTitle=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Ae,[n[25]||(n[25]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Fe,[e.createElementVNode("div",Ue,[e.createVNode(f,{modelValue:T.Phone,"onUpdate:modelValue":M=>T.Phone=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",Me,[e.createVNode(f,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":M=>T.PhoneExt=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",Pe,[e.createElementVNode("div",Ie,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(o)[`contact-${S}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":M=>T.MobilePhone=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",je,[e.createElementVNode("div",Oe,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(o)[`contact-${S}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":M=>T.EMail=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[44]||(n[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",Le,[e.createElementVNode("table",Re,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[28]||(n[28]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[29]||(n[29]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(p,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(d).Target,"onUpdate:modelValue":n[6]||(n[6]=T=>e.unref(d).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":n[7]||(n[7]=T=>e.unref(d).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":n[8]||(n[8]=T=>e.unref(d).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[32]||(n[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Qualitative,"onUpdate:modelValue":n[9]||(n[9]=T=>e.unref(d).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",qe,[e.createElementVNode("table",ze,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[38]||(n[38]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(b,{modelValue:e.unref(E),"onUpdate:modelValue":n[10]||(n[10]=T=>e.isRef(E)?E.value=T:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Ge,[e.createElementVNode("table",Je,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[33]||(n[33]=e.createElementVNode("th",null,"計畫名稱",-1)),n[34]||(n[34]=e.createElementVNode("th",null,"補助單位",-1)),n[35]||(n[35]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Ye,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o)[`received-${S}-Name`],modelValue:T.Name,"onUpdate:modelValue":M=>T.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(o)[`received-${S}-Unit`],modelValue:T.Unit,"onUpdate:modelValue":M=>T.Unit=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${S}-Amount`],modelValue:T.Amount,"onUpdate:modelValue":M=>T.Amount=M},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Qe,[e.createElementVNode("div",We,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>s(T),type:"button"},[...n[36]||(n[36]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,He)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:u,type:"button"},[...n[37]||(n[37]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Xe,[e.createElementVNode("table",Ke,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[39]||(n[39]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(V).Form1Before,"onUpdate:modelValue":n[11]||(n[11]=T=>e.unref(V).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[40]||(n[40]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(V).Form1After,"onUpdate:modelValue":n[12]||(n[12]=T=>e.unref(V).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Ze,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[13]||(n[13]=T=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[14]||(n[14]=T=>a(!0)),type:"button"},[...n[45]||(n[45]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},et={class:"block"},tt={key:0,class:"text-pink lh-base mt-4"},lt={class:"mt-4"},ot={class:"table align-middle gray-table"},nt={class:"text-center"},rt={key:0,width:"180"},at={class:"text-center"},st={key:0},dt=["innerHTML"],ct=["href"],it={key:0,class:"text-center"},mt={key:0},pt={key:1,class:"text-pink"},Vt={key:1,class:"tag-group mt-2 gap-1"},ft={key:0,class:"tag tag-green-light"},Nt=["download","href"],Et=["onClick"],bt={class:"mt-4"},gt={class:"table align-middle gray-table side-table"},kt={key:0,class:"block-bottom bg-light-teal"},yt=["disabled"],ut={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([{Type:1,Title:"申請表",Template:"../../Template/ACC/附件01-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/ACC/附件02-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/ACC/附件03-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/ACC/附件04-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"證明文件影本",Comment:"A.民間團體：申請單位登記、立案文件、現任負責人當選證明文件。<br>B.國(公)立學校免附證明文件。",Files:[],Multiple:!0,Optional:!0},{Type:6,Title:"其他佐證資料",Comment:"A.本計畫屬民間團體提案者(政府立案之社團法人、財團法人、組織或社區發展協會等)，需檢附3年內任1年曾受相關政府補助完成計畫之實績佐證資料，無則免附。<br>B.提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附。",Files:[],Multiple:!0,Optional:!0}]),V=e.ref(),N=e.computed(()=>m.value.some(s=>!s.Optional&&!s.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("accessibility",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(s.Multiple?a.Name:`${s.Title}.pdf`)})},k=U.download,E=_,u=()=>{rxjs.forkJoin([U.accessibility("getAttachment",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=m.value.filter(y=>{var i;return!((i=y.Excludes)!=null&&i.includes(l.value.OrgCategory))}),m.value.forEach(y=>{y.Files=a.Attachments.filter(i=>i.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(i=>!i.Deleted).length)}),j().init("accessibility",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},h=s=>{var y,i;if(o.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Attachments:m.value.reduce((n,c)=>n.concat(c.Files),[]),Before:(y=V.value)==null?void 0:y.Form5Before,After:(i=V.value)==null?void 0:i.Form5After,Submit:s?"true":"false"};U.accessibility("saveAttachment",a).subscribe(()=>{s?E("next"):u()})},g=()=>{if(V.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(V.value,s))}return!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",et,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",tt,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",lt,[e.createElementVNode("table",ot,[e.createElementVNode("thead",nt,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",rt,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",at,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[c.Optional?(e.openBlock(),e.createElementBlock("span",st,e.toDisplayString(c.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024))]),e.unref(r)&&c.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:c.Comment},null,8,dt)):e.createCommentVNode("",!0),e.unref(r)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,ct)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",it,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",mt,"已上傳")):(e.openBlock(),e.createElementBlock("span",pt,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(c.Multiple||!c.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>d(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",Vt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ft,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(k)(t.Path)},e.toDisplayString(t.Name),9,Nt),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Et)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",bt,[e.createElementVNode("table",gt,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(V).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(V).Form5Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(V).Form5After,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form5After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",kt,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=c=>h(!0)),disabled:e.unref(N),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,yt)])):e.createCommentVNode("",!0)],64)}}},xt={class:"block"},ht={class:"mt-4"},$t={class:"table-responsive mt-3 mb-0"},Bt={class:"table align-middle gray-table"},_t={key:0,width:"1"},Ct={key:0},Tt={class:"d-flex gap-2"},wt=["onClick"],Dt={class:"table-responsive mt-3 mb-0"},St={class:"table align-middle gray-table"},At={class:"mt-4"},Ft={class:"table align-middle gray-table side-table"},Ut={key:0,class:"block-bottom bg-light-teal"},Mt={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.computed(()=>z("accessibility",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>m.value.filter(s=>!s.Deleted)),l=e.ref({}),d=()=>m.value.push({}),k=_,E=()=>{rxjs.forkJoin([U.accessibility("getBenefit",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=a.Benefits,m.value.length||d(),j().init("accessibility",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},u=s=>s.Deleted=!0,h=s=>{var y,i;if(r.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:m.value,Before:(y=V.value)==null?void 0:y.Form4Before,After:(i=V.value)==null?void 0:i.Form4After,Submit:s?"true":"false"};U.accessibility("saveBenefit",a).subscribe(()=>{s?k("next"):E()})},g=()=>{let s={Benefit:"不可量化成果"};return r.value=P(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,y)=>Object.assign(r.value,P(a,s,`item-${y}-`))),V.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,P(V.value,s))),!Object.keys(r.value).length};return e.onMounted(E),e.provide("editable",N),(s,a)=>{const y=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",xt,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",ht,[e.createElementVNode("div",$t,[e.createElementVNode("table",Bt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",_t,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Title`],modelValue:c.Title,"onUpdate:modelValue":t=>c.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Target`],modelValue:c.Target,"onUpdate:modelValue":t=>c.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r)[`item-${f}-Description`],rows:"1",modelValue:c.Description,"onUpdate:modelValue":t=>c.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Ct,[e.createElementVNode("div",Tt,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>u(c),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,wt)):e.createCommentVNode("",!0),f+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",Dt,[e.createElementVNode("table",St,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(l).Benefit=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",At,[e.createElementVNode("table",Ft,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(V).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form4Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(V).Form4After,"onUpdate:modelValue":a[2]||(a[2]=c=>e.unref(V).Form4After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",Ut,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=c=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Pt={class:"block"},It={class:"mt-4"},jt={class:"table-responsive mt-3 mb-0"},Ot={class:"table align-middle gray-table"},Lt={class:"text-end"},Rt={class:"text-end"},qt={class:"table-responsive"},zt={class:"table align-middle gray-table"},Gt=["colspan"],Jt={key:0,width:"1"},Yt={class:"text-end"},Qt={key:0},Wt={class:"d-flex gap-2"},Ht=["onClick"],Xt={class:"mt-4"},Kt={class:"table-responsive mt-3 mb-0"},Zt={class:"table align-middle gray-table"},vt={key:0,width:"1"},el={class:"text-end"},tl={key:0},ll={class:"d-flex gap-2"},ol=["onClick"],nl={class:"mt-4"},rl={class:"table align-middle gray-table side-table"},al={key:0,class:"block-bottom bg-light-teal"},sl={class:"text-center"},dl={class:"mb-5"},cl={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("accessibility",l.value.Status,3)),N=e.ref({}),r=e.computed(()=>k.value.filter(f=>!f.Deleted)),o=e.computed(()=>E.value.filter(f=>!f.Deleted)),l=e.ref({}),d=e.ref(),k=e.ref([]),E=e.ref([]),u=e.ref({}),h=e.ref(0),g=()=>k.value.push({}),s=()=>E.value.push({}),a=_,y=()=>{rxjs.forkJoin([U.accessibility("getFunding",{ID:x.id})]).subscribe(f=>{const t=f[0];l.value=t.Project,k.value=t.OtherSubsidies,E.value=t.BudgetPlans,u.value=t.GrantTargetSetting,k.value.length||g(),E.value.length||s(),j().init("accessibility",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=(f,t)=>{var b,w;if(N.value={},f&&!c()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>u.value.GrantLimit*1e4){d.value.show(()=>n(f,!0));return}const p={Project:l.value,OtherSubsidies:k.value,BudgetPlans:E.value,Before:(b=m.value)==null?void 0:b.Form3Before,After:(w=m.value)==null?void 0:w.Form3After,Submit:f?"true":"false"};U.accessibility("saveFunding",p).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=P(l.value,f),f={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},k.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`other-${p}-`))),f={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`plan-${p}-`))),m.value&&(f={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,P(m.value,f))),!Object.keys(N.value).length};return e.onMounted(y),e.provide("editable",V),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((f,t)=>f+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(f=>f.percent=Math.round(q(f.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(f=>f.sum=q(f.Amount)+q(f.OtherAmount))}),(f,t)=>{var M;const p=e.resolveComponent("input-integer"),b=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),T=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pt,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",It,[e.createElementVNode("div",jt,[e.createElementVNode("table",Ot,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",Lt,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",Rt,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",qt,[e.createElementVNode("table",zt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(V)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,Gt)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Jt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`other-${C}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":D=>A.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`other-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Yt,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`other-${C}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":D=>A.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",Qt,[e.createElementVNode("div",Wt,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ht)):e.createCommentVNode("",!0),C+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",Xt,[e.createElementVNode("div",Kt,[e.createElementVNode("table",Zt,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",vt,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`plan-${C}-Title`],modelValue:A.Title,"onUpdate:modelValue":D=>A.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":D=>A.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",el,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`plan-${C}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":D=>A.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",tl,[e.createElementVNode("div",ll,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,ol)):e.createCommentVNode("",!0),C+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",nl,[e.createElementVNode("table",rl,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(m).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(m).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(m).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(m).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",al,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",sl,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",dl,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(u).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Y=Q.defineStore("payment",{actions:{init(B,_=0){this.stage=B==null?void 0:B.Stage,this.amount=B==null?void 0:B.CurrentRequestAmount,this.paid=_,this.status=B==null?void 0:B.Status}},state:()=>({stage:null,amount:null,paid:null,status:null})}),il={class:"block"},ml={class:"square-title"},pl={class:"text-teal fw-bold py-3"},Vl={class:"table-responsive mb-0"},fl={class:"table align-middle gray-table"},Nl={class:"text-end"},El={class:"text-end"},bl={class:"text-end"},gl={class:"text-teal fw-bold pb-3"},kl={class:"text-teal fw-bold pb-3"},yl={class:"mt-4"},ul={class:"table align-middle gray-table"},xl={class:"text-center"},hl={key:0,width:"180"},$l={class:"text-center"},Bl=["href"],_l={key:0,class:"text-center"},Cl={key:0},Tl={key:1,class:"text-pink"},wl={key:1,class:"tag-group mt-2 gap-1"},Dl={key:0,class:"tag tag-green-light"},Sl=["download","href"],Al=["onClick"],Fl={class:"block-bottom bg-light-teal"},Ul=["disabled"],Ml={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>u.value.some(i=>!i.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),k=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(m.value*100/d.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>r.value?Math.min(Math.round(m.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),u=e.ref([{Type:11,Title:"領據",Files:[]}]),h=(i,n)=>{n.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:n.Path,Name:`${d.value.ProjectID}_第一期請款_${i.Title}.pdf`})},g=U.download,s=_,a=()=>{U.accessibility("getPayment",{ID:x.id}).subscribe(i=>{d.value=i.Project,j().init("accessibility",d.value),u.value=u.value.filter(n=>{var c;return!((c=n.Excludes)!=null&&c.includes(d.value.OrgCategory))}),u.value.forEach(n=>{n.Files=i.Attachments.filter(c=>c.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(c=>!c.Deleted).length)}),l.value=i.Payments.find(n=>n.Stage===1),l.value&&(m.value=l.value.TotalSpentAmount),o.value=Math.round(d.value.ApprovedAmount*x.setting.DisbursementRatioPct/100),Y().init(l.value)})},y=i=>{const n={Payment:{ProjectID:x.id,Stage:1,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:u.value.reduce((c,f)=>c.concat(f.Files),[]),Submit:i?"true":"false"};U.accessibility("savePayment",n).subscribe(()=>{i?s("next"):a()})};return e.onMounted(a),e.provide("editable",N),(i,n)=>{var p;const c=e.resolveComponent("input-integer"),f=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",il,[e.createElementVNode("h5",ml,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",pl,"核定經費: "+e.toDisplayString((p=e.unref(d).ApprovedAmount)==null?void 0:p.toLocaleString())+"元",1),e.createElementVNode("div",Vl,[e.createElementVNode("table",fl,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Nl,e.toDisplayString(e.unref(m)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(c,{max:e.unref(o),modelValue:e.unref(m),"onUpdate:modelValue":n[0]||(n[0]=b=>e.isRef(m)?m.value=b:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",El,e.toDisplayString(e.unref(k))+"%",1),e.createElementVNode("td",bl,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",gl,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",kl,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",yl,[e.createElementVNode("table",ul,[e.createElementVNode("thead",xl,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",hl,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(b,w)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",$l,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.Title),1)]),_:2},1024)]),e.unref(N)&&b.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:b.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Bl)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",_l,[b.Uploaded?(e.openBlock(),e.createElementBlock("span",Cl,"已上傳")):(e.openBlock(),e.createElementBlock("span",Tl,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!b.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:T=>h(b,T)},null,8,["onFile"])):e.createCommentVNode("",!0),b.Uploaded?(e.openBlock(),e.createElementBlock("div",wl,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Dl,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(g)(T.Path)},e.toDisplayString(T.Name),9,Sl),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>T.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Al)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Fl,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=b=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=b=>y(!0)),disabled:e.unref(V),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ul)])],64)}}},Pl={class:"block"},Il={class:"square-title"},jl={class:"text-teal fw-bold py-3"},Ol={class:"text-teal fw-bold pb-3"},Ll={class:"table-responsive mb-0"},Rl={class:"table align-middle gray-table"},ql={class:"text-end"},zl={class:"text-end"},Gl={class:"text-end"},Jl={class:"text-end"},Yl={class:"text-teal fw-bold pb-3"},Ql={class:"text-teal fw-bold pb-3"},Wl={class:"mt-4"},Hl={class:"table align-middle gray-table"},Xl={class:"text-center"},Kl={key:0,width:"180"},Zl={class:"text-center"},vl=["href"],eo={key:0,class:"text-center"},to={key:0},lo={key:1,class:"text-pink"},oo={key:1,class:"tag-group mt-2 gap-1"},no={key:0,class:"tag tag-green-light"},ro=["download","href"],ao=["onClick"],so={class:"block-bottom bg-light-teal"},co=["disabled"],io={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>s.value.some(f=>!f.Files.filter(t=>!t.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var f;return((f=l.value)==null?void 0:f.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref(0),k=e.ref(0),E=e.ref({}),u=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(m.value*100/E.value.ApprovedAmount*100)/100,100):0),h=e.computed(()=>g.value?Math.min(Math.round(m.value*100/g.value*100)/100,100):0),g=e.computed(()=>k.value+(r.value?l.value.CurrentActualPaidAmount:0)),s=e.ref([{Type:21,Title:"領據",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/ACC/1-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/ACC/2-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/ACC/3-補助清單.docx",Files:[]},{Type:25,Title:"其他",Files:[]}]),a=(f,t)=>{t.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${f.Title}.pdf`})},y=U.download,i=_,n=()=>{U.accessibility("getPayment",{ID:x.id}).subscribe(f=>{E.value=f.Project,j().init("accessibility",E.value),s.value=s.value.filter(p=>{var b;return!((b=p.Excludes)!=null&&b.includes(E.value.OrgCategory))}),s.value.forEach(p=>{p.Files=f.Attachments.filter(b=>b.Type===p.Type),p.Uploaded=e.computed(()=>p.Files.filter(b=>!b.Deleted).length)}),l.value=f.Payments.find(p=>p.Stage===2),l.value&&(m.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=f.Payments.filter(p=>p.Stage<2&&p.Status==="通過");d.value=t.reduce((p,b)=>p+b.CurrentRequestAmount,0),k.value=t.reduce((p,b)=>p+b.CurrentActualPaidAmount,0),Y().init(l.value,k.value)})},c=f=>{const t={Payment:{ProjectID:x.id,Stage:2,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:s.value.reduce((p,b)=>p.concat(b.Files),[]),Submit:f?"true":"false"};U.accessibility("savePayment",t).subscribe(()=>{f?i("next"):n()})};return e.onMounted(n),e.provide("editable",N),(f,t)=>{var T;const p=e.resolveComponent("input-integer"),b=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pl,[e.createElementVNode("h5",Il,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",jl,"核定經費: "+e.toDisplayString((T=e.unref(E).ApprovedAmount)==null?void 0:T.toLocaleString())+"元",1),e.createElementVNode("p",Ol,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(m)).toLocaleString())+"元",1),e.createElementVNode("div",Ll,[e.createElementVNode("table",Rl,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",ql,e.toDisplayString(e.unref(m)-e.unref(d)),1),e.createElementVNode("td",zl,e.toDisplayString(e.unref(k)),1),e.createElementVNode("td",null,[e.createVNode(p,{max:e.unref(o),modelValue:e.unref(m),"onUpdate:modelValue":t[0]||(t[0]=S=>e.isRef(m)?m.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Gl,e.toDisplayString(e.unref(u))+"%",1),e.createElementVNode("td",Jl,e.toDisplayString(e.unref(h))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",Yl,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Ql,"累積實際撥款: "+e.toDisplayString(e.unref(g).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Wl,[e.createElementVNode("table",Hl,[e.createElementVNode("thead",Xl,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Kl,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(S,M)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",Zl,e.toDisplayString(M+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(b,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(N)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,vl)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",eo,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",to,"已上傳")):(e.openBlock(),e.createElementBlock("span",lo,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!S.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:A=>a(S,A)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",oo,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",no,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(y)(A.Path)},e.toDisplayString(A.Name),9,ro),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:C=>A.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,ao)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",so,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=S=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=S=>c(!0)),disabled:e.unref(V),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,co)])],64)}}},mo={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(x,m)=>{const V=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(V,{steps:_,type:"accessibility"})}}},po={class:"block"},Vo={class:"mt-4"},fo={class:"table align-middle gray-table side-table"},No={key:0,class:"d-flex align-items-center gap-2"},Eo={class:"input-group w-auto"},bo={class:"text-teal-dark"},go={key:1,class:"invalid mt-0"},ko={class:"table-responsive mt-4"},yo={class:"table align-middle gray-table"},uo={key:0},xo={class:"input-group"},ho={key:0,class:"invalid mt-0"},$o={key:0},Bo={class:"d-flex gap-2"},_o=["onClick"],Co={class:"mt-4"},To={class:"table align-middle gray-table"},wo={key:0},Do=["value"],So={key:0},Ao={class:"d-flex gap-2"},Fo=["onClick"],Uo={class:"mt-4"},Mo={class:"table align-middle gray-table side-table"},Po={key:0,class:"block-bottom bg-light-teal"},Io={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=[{value:1,text:"50%"},{value:2,text:"100%"}],V=e.ref(),N=e.computed(()=>E.value.EndDate),r=e.computed(()=>z("accessibility",k.value.Status,2)),o=e.ref({}),l=e.computed(()=>u.value.filter(f=>!f.Deleted)),d=e.computed(()=>h.value.filter(f=>!f.Deleted)),k=e.ref({}),E=e.ref({}),u=e.ref([]),h=e.ref([]),g=()=>U.accessibility("createItem",{ID:x.id}).subscribe(f=>u.value.push(f)),s=()=>h.value.push({Type:0,ItemID:0}),a=_,y=()=>{rxjs.forkJoin([U.accessibility("getWorkSchedule",{ID:x.id})]).subscribe(f=>{const t=f[0];k.value=t.Project,E.value=t.GrantType,u.value=t.Items,h.value=t.Schedules,u.value.length||g(),h.value.length||s(),j().init("accessibility",k.value),V.value=k.value.changeApply,k.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=f=>{var p,b;if(o.value={},f&&!c()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:k.value,Items:u.value,Schedules:h.value,Before:(p=V.value)==null?void 0:p.Form2Before,After:(b=V.value)==null?void 0:b.Form2After,Submit:f?"true":"false"};U.accessibility("saveWorkSchedule",t).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(k.value,f),f={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`item-${p}-`))),f={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`schedule-${p}-`))),V.value&&(f={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(V.value,f))),!Object.keys(o.value).length};return e.onMounted(y),e.provide("editable",r),(f,t)=>{const p=e.resolveComponent("required-label"),b=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),T=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",po,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Vo,[e.createElementVNode("table",fo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",No,[e.createElementVNode("div",Eo,[e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).StartTime,"onUpdate:modelValue":t[0]||(t[0]=C=>e.unref(k).StartTime=C)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).EndTime,"onUpdate:modelValue":t[1]||(t[1]=C=>e.unref(k).EndTime=C)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",bo,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(N)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",go,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",ko,[e.createElementVNode("table",yo,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",uo,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`item-${D}-Title`],modelValue:C.Title,"onUpdate:modelValue":F=>C.Title=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",xo,[e.createVNode(S,{"empty-value":0,modelValue:C.Begin,"onUpdate:modelValue":F=>C.Begin=F},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:C.End,"onUpdate:modelValue":F=>C.End=F},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",ho,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",$o,[e.createElementVNode("div",Bo,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_o)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Co,[e.createElementVNode("table",To,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",wo,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:m,modelValue:C.Type,"onUpdate:modelValue":F=>C.Type=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:C.ItemID,"onUpdate:modelValue":F=>C.ItemID=F,modelModifiers:{trim:!0}},{default:e.withCtx(({index:F,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+F))+"."+e.toDisplayString(I.Title),9,Do)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",So,[e.createElementVNode("div",Ao,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Fo)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Uo,[e.createElementVNode("table",Mo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(V).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=C=>e.unref(V).Form2Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(V).Form2After,"onUpdate:modelValue":t[3]||(t[3]=C=>e.unref(V).Form2After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Po,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=C=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=C=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},jo={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Oo={class:"modal-content"},Lo={class:"modal-body"},Ro={class:"d-flex justify-content-center mt-4 gap-4"},qo={class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},zo={__name:"ConfirmModal",props:{cancel:{default:"取消",type:String},confirm:{default:"確定",type:String}},setup(B,{expose:_}){let x;const m=e.ref(),V=B,N=()=>{x&&x()};return _({show:o=>{x=o,bootstrap.Modal.getOrCreateInstance(m.value).show()}}),(o,l)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:m,tabindex:"-1"},[e.createElementVNode("div",jo,[e.createElementVNode("div",Oo,[l[0]||(l[0]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Lo,[e.renderSlot(o.$slots,"default"),e.createElementVNode("div",Ro,[e.createElementVNode("button",qo,e.toDisplayString(V.cancel),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:N,"data-bs-dismiss":"modal",type:"button"},e.toDisplayString(V.confirm),1)])])])])],512)]))}},Go={class:"application-step"},Jo=["onClick"],Yo={class:"step-content"},Qo={class:"step-label"},Wo={key:0,class:"step-status edit"},Ho={key:1,class:"step-status"},Xo={__name:"CommonProgressBar",props:{id:{type:Number},review:{default:!1,type:Boolean},step:{required:!0,type:Number},steps:{required:!0,type:Array},type:{required:!0,type:Number}},emits:["click"],setup(B,{emit:_}){const x=e.computed(()=>z(V.type,m[V.type].status,V.step)),m=j(),V=B,N=o=>{V.review?r("click",o.step):o.step<=m[V.type].step&&(location.href=`${o.url}.aspx?ID=${V.id}`)},r=_;return(o,l)=>(e.openBlock(),e.createElementBlock("div",Go,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.steps,d=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["step-item",{active:e.unref(x)&&(d.step<e.unref(m)[B.type].step||d.step===B.step)}]),onClick:k=>N(d),key:d,role:"button"},[e.createElementVNode("div",Yo,[e.createElementVNode("div",Qo,e.toDisplayString(d.title),1),e.unref(x)&&d.step===B.step?(e.openBlock(),e.createElementBlock("div",Wo,"編輯中")):d.step<e.unref(m)[B.type].step?(e.openBlock(),e.createElementBlock("div",Ho,"已完成")):e.createCommentVNode("",!0)])],10,Jo))),128))]))}},Ko={class:"block"},Zo={class:"mt-4"},vo={class:"table align-middle gray-table side-table"},en={key:0},tn={key:1,class:"text-light-gray"},ln={class:"d-flex gap-2"},on={key:0,class:"invalid mt-0"},nn={class:"d-flex flex-column gap-2"},rn={key:0},an={class:"mt-4"},sn={class:"table align-middle gray-table side-table"},dn={class:"row g-3"},cn={class:"col-12 col-xl-2"},mn={class:"text-gray mb-2"},pn={class:"col-12 col-xl-3"},Vn={class:"text-gray mb-2"},fn={class:"col-12 col-xl-4"},Nn={class:"row g-1"},En={class:"col-7"},bn={class:"col-5"},gn={class:"col-12 col-xl-3"},kn={class:"text-gray mb-2"},yn={class:"col-12"},un={class:"text-gray mb-2"},xn={class:"mt-4"},hn={class:"table align-middle gray-table side-table"},$n={class:"mt-4"},Bn={class:"table align-middle gray-table side-table"},_n={key:0,class:"table-responsive mt-3 mb-0"},Cn={class:"table align-middle gray-table"},Tn={key:0},wn={key:0},Dn={class:"d-flex gap-2"},Sn=["onClick"],An={class:"mt-4"},Fn={class:"table align-middle gray-table side-table"},Un={key:0,class:"block-bottom bg-light-teal"},Mn={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.ref(),r=e.computed(()=>z("culture",E.value.Status,1)),o=e.ref({}),l=e.ref(null),d=e.ref([]),k=e.computed(()=>h.value.filter(t=>!t.Deleted)),E=e.ref({}),u=e.computed(()=>d.value.filter(t=>!t.ParentCode)),h=e.ref([]),g=e.computed(()=>d.value.filter(t=>t.ParentCode===l.value)),s=e.computed({get:()=>!!k.value.length,set:t=>{t?a():h.value.forEach(p=>p.Deleted=!0)}}),a=()=>h.value.push({}),y=_,i=()=>{U.culture("getApplication",{ID:x.id}).subscribe(t=>{var p;E.value=t.Project,N.value=t.Contacts,h.value=t.ReceivedSubsidies,l.value=((p=d.value.find(b=>b.Code===E.value.Field))==null?void 0:p.ParentCode)||null,E.value.OrgCategory=E.value.OrgCategory||null,j().init("culture",E.value),V.value=E.value.changeApply,E.value.changeApply=void 0})},n=t=>t.Deleted=!0,c=t=>{var b,w;if(o.value={},t&&!f()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}const p={Project:E.value,Contacts:N.value,ReceivedSubsidies:h.value.filter(T=>T.ID||!T.Deleted),Before:(b=V.value)==null?void 0:b.Form1Before,After:(w=V.value)==null?void 0:w.Form1After,Submit:t?"true":"false"};U.culture("saveApplication",p).subscribe(T=>{t?y("next",T.ID):E.value.ID?i():window.location.href=`Application.aspx?ID=${T.ID}`})},f=()=>{let t={ProjectName:"計畫名稱",Field:"徵件類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return E.value.OrgCategory==="3"&&(t.RegisteredNum="立案登記證字號"),o.value=P(E.value,t),t={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((p,b)=>Object.assign(o.value,P(p,t,`contact-${b}-`))),t={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},h.value.forEach((p,b)=>Object.assign(o.value,P(p,t,`received-${b}-`))),V.value&&(t={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(V.value,t))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([U.culture("getZgsCodes",{CodeGroup:"CULField"}),U.culture("getZgsCodes",{CodeGroup:"CULOrgCategory"})]).subscribe(t=>{d.value=t[0],m.value=t[1],x.id?i():U.culture("getEmptyApplication").subscribe(p=>{l.value=null,E.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},p),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("culture",E.value)})})}),e.provide("editable",r),e.watch(l,()=>{l.value?g.value.find(t=>E.value.Field===t.Code)||(E.value.Field=g.value[0].Code):E.value.Field=null}),(t,p)=>{const b=e.resolveComponent("required-label"),w=e.resolveComponent("input-text"),T=e.resolveComponent("input-select"),S=e.resolveComponent("input-textarea"),M=e.resolveComponent("input-boolean"),A=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ko,[p[45]||(p[45]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Zo,[e.createElementVNode("table",vo,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[p[17]||(p[17]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).Year),1)]),e.createElementVNode("tr",null,[p[18]||(p[18]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(E).ProjectID?(e.openBlock(),e.createElementBlock("span",en,e.toDisplayString(e.unref(E).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",tn,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[p[19]||(p[19]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(E).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[20]||(p[20]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).ProjectName,modelValue:e.unref(E).ProjectName,"onUpdate:modelValue":p[0]||(p[0]=C=>e.unref(E).ProjectName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[21]||(p[21]=[e.createTextVNode("徵件類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",ln,[e.createVNode(T,{"empty-value":null,options:e.unref(u),"text-name":"Descname","value-name":"Code",modelValue:e.unref(l),"onUpdate:modelValue":p[1]||(p[1]=C=>e.isRef(l)?l.value=C:null)},null,8,["options","modelValue"]),e.createVNode(T,{"empty-value":null,disabled:!e.unref(l),options:e.unref(g),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).Field,"onUpdate:modelValue":p[2]||(p[2]=C=>e.unref(E).Field=C)},null,8,["disabled","options","modelValue"])]),e.unref(o).Field?(e.openBlock(),e.createElementBlock("div",on,e.toDisplayString(e.unref(o).Field),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[22]||(p[22]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(E).OrgName,"onUpdate:modelValue":p[3]||(p[3]=C=>e.unref(E).OrgName=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[23]||(p[23]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",nn,[e.createElementVNode("div",null,[e.createVNode(T,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(m),"text-name":"Descname","value-name":"Code",modelValue:e.unref(E).OrgCategory,"onUpdate:modelValue":p[4]||(p[4]=C=>e.unref(E).OrgCategory=C)},null,8,["error","options","modelValue"])]),e.unref(E).OrgCategory==="3"?(e.openBlock(),e.createElementBlock("div",rn,[e.createVNode(w,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(E).RegisteredNum,"onUpdate:modelValue":p[5]||(p[5]=C=>e.unref(E).RegisteredNum=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[24]||(p[24]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(E).TaxID,"onUpdate:modelValue":p[6]||(p[6]=C=>e.unref(E).TaxID=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[25]||(p[25]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(E).Address,"onUpdate:modelValue":p[7]||(p[7]=C=>e.unref(E).Address=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),p[46]||(p[46]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",an,[e.createElementVNode("table",sn,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(C.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",dn,[e.createElementVNode("div",cn,[e.createElementVNode("div",mn,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[26]||(p[26]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-Name`],modelValue:C.Name,"onUpdate:modelValue":F=>C.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",pn,[e.createElementVNode("div",Vn,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[27]||(p[27]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-JobTitle`],modelValue:C.JobTitle,"onUpdate:modelValue":F=>C.JobTitle=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",fn,[p[28]||(p[28]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",Nn,[e.createElementVNode("div",En,[e.createVNode(w,{modelValue:C.Phone,"onUpdate:modelValue":F=>C.Phone=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",bn,[e.createVNode(w,{placeholder:"請輸入分機",size:"4",modelValue:C.PhoneExt,"onUpdate:modelValue":F=>C.PhoneExt=F,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",gn,[e.createElementVNode("div",kn,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[29]||(p[29]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-MobilePhone`],modelValue:C.MobilePhone,"onUpdate:modelValue":F=>C.MobilePhone=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",yn,[e.createElementVNode("div",un,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[30]||(p[30]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(w,{error:e.unref(o)[`contact-${D}-EMail`],modelValue:C.EMail,"onUpdate:modelValue":F=>C.EMail=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),p[47]||(p[47]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",xn,[e.createElementVNode("table",hn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[31]||(p[31]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[p[32]||(p[32]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(S,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(E).Target,"onUpdate:modelValue":p[8]||(p[8]=C=>e.unref(E).Target=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[33]||(p[33]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(E).Summary,"onUpdate:modelValue":p[9]||(p[9]=C=>e.unref(E).Summary=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[34]||(p[34]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Quantified,"onUpdate:modelValue":p[10]||(p[10]=C=>e.unref(E).Quantified=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[35]||(p[35]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(E).Qualitative,"onUpdate:modelValue":p[11]||(p[11]=C=>e.unref(E).Qualitative=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",$n,[e.createElementVNode("table",Bn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[p[41]||(p[41]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(M,{modelValue:e.unref(s),"onUpdate:modelValue":p[12]||(p[12]=C=>e.isRef(s)?s.value=C:null)},null,8,["modelValue"]),e.unref(s)?(e.openBlock(),e.createElementBlock("div",_n,[e.createElementVNode("table",Cn,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[p[36]||(p[36]=e.createElementVNode("th",null,"計畫名稱",-1)),p[37]||(p[37]=e.createElementVNode("th",null,"補助單位",-1)),p[38]||(p[38]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Tn,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(k),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${D}-Name`],modelValue:C.Name,"onUpdate:modelValue":F=>C.Name=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(o)[`received-${D}-Unit`],modelValue:C.Unit,"onUpdate:modelValue":F=>C.Unit=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(o)[`received-${D}-Amount`],modelValue:C.Amount,"onUpdate:modelValue":F=>C.Amount=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",wn,[e.createElementVNode("div",Dn,[e.unref(k).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>n(C),type:"button"},[...p[39]||(p[39]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Sn)):e.createCommentVNode("",!0),D+1===e.unref(k).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...p[40]||(p[40]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[p[44]||(p[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",An,[e.createElementVNode("table",Fn,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[42]||(p[42]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(V).Form1Before,"onUpdate:modelValue":p[13]||(p[13]=C=>e.unref(V).Form1Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(b,null,{default:e.withCtx(()=>[...p[43]||(p[43]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(V).Form1After,"onUpdate:modelValue":p[14]||(p[14]=C=>e.unref(V).Form1After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Un,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:p[15]||(p[15]=C=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:p[16]||(p[16]=C=>c(!0)),type:"button"},[...p[48]||(p[48]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Pn={class:"block"},In={key:0,class:"text-pink lh-base mt-4"},jn={class:"mt-4"},On={class:"table align-middle gray-table"},Ln={class:"text-center"},Rn={key:0,width:"180"},qn={class:"text-center"},zn={key:0},Gn=["innerHTML"],Jn=["href"],Yn={key:0,class:"text-center"},Qn={key:0},Wn={key:1,class:"text-pink"},Hn={key:1,class:"tag-group mt-2 gap-1"},Xn={key:0,class:"tag tag-green-light"},Kn=["download","href"],Zn=["onClick"],vn={class:"mt-4"},er={class:"table align-middle gray-table side-table"},tr={key:0,class:"block-bottom bg-light-teal"},lr=["disabled"],or={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([{Type:1,Title:"申請表",Template:"../../Template/CUL/1.申請表.docx",Files:[]},{Type:2,Title:"申請捐（補）助計畫書",Template:"../../Template/CUL/2.計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/CUL/3.執行承諾書.docx",Files:[],Excludes:["1"]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Comment:"(與本計畫相關之補充資料、如立案證明、配合提案計畫邀集相關合作單位召開討論之會議紀錄等；若有合作對象，請附合作對象同意書)",Template:"../../Template/CUL/4.未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"附錄",Files:[],Multiple:!0}]),V=e.ref(),N=e.computed(()=>m.value.some(s=>!s.Optional&&!s.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("culture",l.value.Status,5)),o=e.ref({}),l=e.ref({}),d=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(s.Multiple?a.Name:`${s.Title}.pdf`)})},k=U.download,E=_,u=()=>{rxjs.forkJoin([U.culture("getAttachment",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=m.value.filter(y=>{var i;return!((i=y.Excludes)!=null&&i.includes(l.value.OrgCategory))}),l.value.Status>=42&&m.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/LIT/5-著作權授權同意書.docx",Files:[]}),m.value.forEach(y=>{y.Files=a.Attachments.filter(i=>i.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(i=>!i.Deleted).length)}),j().init("culture",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},h=s=>{var y,i;if(o.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Attachments:m.value.reduce((n,c)=>n.concat(c.Files),[]),Before:(y=V.value)==null?void 0:y.Form5Before,After:(i=V.value)==null?void 0:i.Form5After,Submit:s?"true":"false"};U.culture("saveAttachment",a).subscribe(()=>{s?E("next"):u()})},g=()=>{if(V.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(V.value,s))}return!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Pn,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"上傳附件",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",In,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",jn,[e.createElementVNode("table",On,[e.createElementVNode("thead",Ln,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Rn,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",qn,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[c.Optional?(e.openBlock(),e.createElementBlock("span",zn,e.toDisplayString(c.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024))]),e.unref(r)&&c.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:c.Comment},null,8,Gn)):e.createCommentVNode("",!0),e.unref(r)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Jn)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Yn,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",Qn,"已上傳")):(e.openBlock(),e.createElementBlock("span",Wn,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(c.Multiple||!c.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>d(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",Hn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Xn,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(k)(t.Path)},e.toDisplayString(t.Name),9,Kn),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Zn)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",vn,[e.createElementVNode("table",er,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(V).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(V).Form5Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(V).Form5After,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form5After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",tr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=c=>h(!0)),disabled:e.unref(N),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,lr)])):e.createCommentVNode("",!0)],64)}}},nr={class:"block"},rr={class:"mt-4"},ar={class:"table-responsive mt-3 mb-0"},sr={class:"table align-middle gray-table"},dr={class:"text-end"},cr={class:"text-end"},ir={class:"table-responsive"},mr={class:"table align-middle gray-table"},pr=["colspan"],Vr={key:0,width:"1"},fr={key:0},Nr={class:"d-flex gap-2"},Er=["onClick"],br={class:"mt-4"},gr={class:"table-responsive mt-3 mb-0"},kr={class:"table align-middle gray-table"},yr={key:0,width:"1"},ur={class:"text-end"},xr={key:0},hr={class:"d-flex gap-2"},$r=["onClick"],Br={class:"mt-4"},_r={class:"table align-middle gray-table side-table"},Cr={key:0,class:"block-bottom bg-light-teal"},Tr={class:"text-center"},wr={class:"mb-5"},Dr={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("culture",l.value.Status,3)),N=e.ref({}),r=e.computed(()=>E.value.filter(p=>!p.Deleted)),o=e.computed(()=>u.value.filter(p=>!p.Deleted)),l=e.ref({}),d=e.ref([]),k=e.ref(),E=e.ref([]),u=e.ref([]),h=e.ref({}),g=e.ref(0),s=()=>E.value.push({}),a=()=>u.value.push({ItemID:0}),y=_,i=()=>{rxjs.forkJoin([U.culture("getFunding",{ID:x.id})]).subscribe(p=>{const b=p[0];l.value=b.Project,E.value=b.OtherSubsidies,u.value=b.BudgetPlans,d.value=b.Items,h.value=b.GrantTargetSetting,E.value.length||s(),u.value.length||a(),j().init("culture",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},n=p=>p.Deleted=!0,c=p=>p.Deleted=!0,f=(p,b)=>{var T,S;if(N.value={},p&&!t()){e.nextTick(()=>{var M;return(M=document.querySelector(".invalid"))==null?void 0:M.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!b&&l.value.ApplyAmount>h.value.GrantLimit*1e4){k.value.show(()=>f(p,!0));return}const w={Project:l.value,OtherSubsidies:E.value,BudgetPlans:u.value,Before:(T=m.value)==null?void 0:T.Form3Before,After:(S=m.value)==null?void 0:S.Form3After,Submit:p?"true":"false"};U.culture("saveFunding",w).subscribe(()=>{p?y("next"):i()})},t=()=>{let p={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=P(l.value,p),p={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}}},E.value.forEach((b,w)=>Object.assign(N.value,P(b,p,`other-${w}-`))),p={ItemID:{numericality:{greaterThan:0,message:"^請選擇工作項目"}},Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},u.value.forEach((b,w)=>Object.assign(N.value,P(b,p,`plan-${w}-`))),m.value&&(p={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,P(m.value,p))),!Object.keys(N.value).length};return e.onMounted(i),e.provide("editable",V),e.watchEffect(()=>{l.value.OtherAmount=E.value.reduce((p,b)=>p+(b.Deleted?0:q(b.Amount)),0),g.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),u.value.forEach(p=>p.sum=q(p.Amount)+q(p.OtherAmount))}),(p,b)=>{var D;const w=e.resolveComponent("input-integer"),T=e.resolveComponent("input-text"),S=e.resolveComponent("input-select"),M=e.resolveComponent("input-textarea"),A=e.resolveComponent("required-label"),C=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nr,[b[25]||(b[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",rr,[e.createElementVNode("div",ar,[e.createElementVNode("table",sr,[b[6]||(b[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":b[0]||(b[0]=F=>e.unref(l).ApplyAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":b[1]||(b[1]=F=>e.unref(l).SelfAmount=F)},null,8,["error","modelValue"])]),e.createElementVNode("td",dr,e.toDisplayString((D=e.unref(l).OtherAmount)==null?void 0:D.toLocaleString()),1),e.createElementVNode("td",cr,e.toDisplayString(e.unref(g).toLocaleString()),1)])])])]),b[12]||(b[12]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",ir,[e.createElementVNode("table",mr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(V)?4:3,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,pr)]),e.createElementVNode("tr",null,[b[7]||(b[7]=e.createElementVNode("th",{width:"1"},null,-1)),b[8]||(b[8]=e.createElementVNode("th",null,"單位名稱",-1)),b[9]||(b[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",Vr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(F,I)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,e.toDisplayString(I+1),1),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(N)[`other-${I}-Unit`],modelValue:F.Unit,"onUpdate:modelValue":O=>F.Unit=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`other-${I}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":O=>F.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",fr,[e.createElementVNode("div",Nr,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>n(F),type:"button"},[...b[10]||(b[10]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Er)):e.createCommentVNode("",!0),I+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...b[11]||(b[11]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),b[26]||(b[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",br,[e.createElementVNode("div",gr,[e.createElementVNode("table",kr,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[b[13]||(b[13]=e.createElementVNode("th",null,"重要工作項目",-1)),b[14]||(b[14]=e.createElementVNode("th",null,"預算項目",-1)),b[15]||(b[15]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),b[16]||(b[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),b[17]||(b[17]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),b[18]||(b[18]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",yr,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,I)=>(e.openBlock(),e.createElementBlock("tr",{key:F},[e.createElementVNode("td",null,[e.createVNode(S,{"empty-value":0,error:e.unref(N)[`plan-${I}-ItemID`],options:e.unref(d),"text-name":"Title","value-name":"ID",modelValue:F.ItemID,"onUpdate:modelValue":O=>F.ItemID=O},null,8,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(N)[`plan-${I}-Title`],modelValue:F.Title,"onUpdate:modelValue":O=>F.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`plan-${I}-Amount`],modelValue:F.Amount,"onUpdate:modelValue":O=>F.Amount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`plan-${I}-OtherAmount`],modelValue:F.OtherAmount,"onUpdate:modelValue":O=>F.OtherAmount=O},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",ur,e.toDisplayString(F.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(N)[`plan-${I}-Description`],rows:"1",modelValue:F.Description,"onUpdate:modelValue":O=>F.Description=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",xr,[e.createElementVNode("div",hr,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:O=>c(F),type:"button"},[...b[19]||(b[19]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,$r)):e.createCommentVNode("",!0),I+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:a,type:"button"},[...b[20]||(b[20]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),b[21]||(b[21]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"【計算方式及說明－範例】口訪工作人員之交通費：2,980（高雄─臺北）×2人=5,960元。")],-1))]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[b[24]||(b[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Br,[e.createElementVNode("table",_r,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...b[22]||(b[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(m).Form3Before,"onUpdate:modelValue":b[2]||(b[2]=F=>e.unref(m).Form3Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(A,null,{default:e.withCtx(()=>[...b[23]||(b[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(m).Form3After,"onUpdate:modelValue":b[3]||(b[3]=F=>e.unref(m).Form3After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Cr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:b[4]||(b[4]=F=>f()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:b[5]||(b[5]=F=>f(!0)),type:"button"},[...b[27]||(b[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(C,{ref_key:"modal",ref:k},{default:e.withCtx(()=>[e.createElementVNode("div",Tr,[b[28]||(b[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",wr,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(h).GrantLimit)+"萬",1),b[29]||(b[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),b[30]||(b[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},Sr={class:"block"},Ar={key:0,class:"text-pink lh-base mt-3"},Fr={class:"border"},Ur={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Mr={class:"d-flex gap-2 align-items-center flex-grow-1"},Pr={class:"text-nowrap"},Ir={class:"flex-grow-1"},jr={class:"d-flex gap-2"},Or=["onClick"],Lr=["href"],Rr=["id"],qr={class:"table align-middle gray-table side-table mb-0"},zr={class:"mt-4"},Gr={class:"table align-middle gray-table side-table"},Jr={key:0,class:"block-bottom bg-light-teal"},Yr={__name:"Other",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("culture",r.value.Status,4)),N=e.ref({}),r=e.ref({}),o=e.ref([]),l=e.computed(()=>o.value.filter(s=>!s.Deleted)),d=()=>o.value.push({}),k=_,E=()=>{rxjs.forkJoin([U.culture("getRelatedProject",{ID:x.id})]).subscribe(s=>{const a=s[0];r.value=a.Project,o.value=a.Projects,j().init("culture",r.value),m.value=r.value.changeApply,r.value.changeApply=void 0})},u=s=>s.Deleted=!0,h=s=>{var y,i;if(N.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Projects:o.value,Before:(y=m.value)==null?void 0:y.Form4Before,After:(i=m.value)==null?void 0:i.Form4After,Submit:s?"true":"false"};U.culture("saveRelatedProject",a).subscribe(()=>{s?k("next"):E()})},g=()=>{let s={Title:"相關計畫名稱",Year:"執行年度",OrgName:"執行單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入計畫經費"},numericality:{greaterThan:0,message:"^計畫經費不可為 0"}},Description:"內容摘述",Benefit:"執行效益"};return l.value.forEach((a,y)=>Object.assign(N.value,P(a,s,`project-${y}-`))),m.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(N.value,P(m.value,s))),!Object.keys(N.value).length};return e.onMounted(E),e.provide("editable",V),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-text"),n=e.resolveComponent("input-integer"),c=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Sr,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"}," 提案單位近三年執行相關計畫之成效及與本計畫之關聯性與差異性 ",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("p",Ar," 若無相關計畫可不填寫 ")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(f,t)=>(e.openBlock(),e.createElementBlock("div",{class:"mt-3",key:f},[e.createElementVNode("div",Fr,[e.createElementVNode("div",Ur,[e.createElementVNode("div",Mr,[e.createElementVNode("label",Pr,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[4]||(a[4]=[e.createTextVNode("相關計畫名稱",-1)])]),_:1})]),e.createElementVNode("div",Ir,[e.createVNode(i,{error:e.unref(N)[`project-${t}-Title`],modelValue:f.Title,"onUpdate:modelValue":p=>f.Title=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",jr,[e.unref(V)?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(p=>u(f),["prevent"]),href:"#"},"刪除",8,Or)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${t}`,role:"button"},"收合",8,Lr)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${t}`},[e.createElementVNode("table",qr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[5]||(a[5]=[e.createTextVNode("執行年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"text-start w-auto",error:e.unref(N)[`project-${t}-Year`],modelValue:f.Year,"onUpdate:modelValue":p=>f.Year=p},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[6]||(a[6]=[e.createTextVNode("執行單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(N)[`project-${t}-OrgName`],modelValue:f.OrgName,"onUpdate:modelValue":p=>f.OrgName=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[7]||(a[7]=[e.createTextVNode("計畫經費(元)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{class:"w-auto",error:e.unref(N)[`project-${t}-Amount`],modelValue:f.Amount,"onUpdate:modelValue":p=>f.Amount=p},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[8]||(a[8]=[e.createTextVNode("內容摘述",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(N)[`project-${t}-Description`],rows:"4",modelValue:f.Description,"onUpdate:modelValue":p=>f.Description=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[9]||(a[9]=[e.createTextVNode("執行效益",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(N)[`project-${t}-Benefit`],rows:"4",modelValue:f.Benefit,"onUpdate:modelValue":p=>f.Benefit=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])])],8,Rr)])]))),128)),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark mt-3",onClick:d,type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",zr,[e.createElementVNode("table",Gr,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(N).Form4Before,rows:"4",modelValue:e.unref(m).Form4Before,"onUpdate:modelValue":a[0]||(a[0]=f=>e.unref(m).Form4Before=f),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{error:e.unref(N).Form4After,rows:"4",modelValue:e.unref(m).Form4After,"onUpdate:modelValue":a[1]||(a[1]=f=>e.unref(m).Form4After=f),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Jr,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=f=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=f=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Qr={class:"block"},Wr={class:"square-title"},Hr={class:"text-teal fw-bold py-3"},Xr={class:"table-responsive mb-0"},Kr={class:"table align-middle gray-table"},Zr={class:"text-end"},vr={class:"text-end"},ea={class:"text-end"},ta={class:"text-teal fw-bold pb-3"},la={class:"text-teal fw-bold pb-3"},oa={class:"mt-4"},na={class:"table align-middle gray-table"},ra={class:"text-center"},aa={key:0,width:"180"},sa={class:"text-center"},da=["href"],ca={key:0,class:"text-center"},ia={key:0},ma={key:1,class:"text-pink"},pa={key:1,class:"tag-group mt-2 gap-1"},Va={key:0,class:"tag tag-green-light"},fa=["download","href"],Na=["onClick"],Ea={class:"block-bottom bg-light-teal"},ba=["disabled"],ga={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>m.value<=0||u.value.some(i=>!i.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),k=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(m.value*100/d.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>r.value?Math.min(Math.round(m.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),u=e.ref([{Type:11,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:12,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),h=(i,n)=>{n.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:n.Path,Name:`${d.value.ProjectID}_第一期請款_${i.Title}.pdf`})},g=U.download,s=_,a=()=>{U.culture("getPayment",{ID:x.id}).subscribe(i=>{d.value=i.Project,j().init("culture",d.value),u.value=u.value.filter(n=>{var c;return!((c=n.Excludes)!=null&&c.includes(d.value.OrgCategory))}),u.value.forEach(n=>{n.Files=i.Attachments.filter(c=>c.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(c=>!c.Deleted).length)}),l.value=i.Payments.find(n=>n.Stage===1),l.value&&(m.value=l.value.TotalSpentAmount),o.value=Math.round(d.value.ApprovedAmount*x.setting.DisbursementRatioPct/100),Y().init(l.value)})},y=i=>{const n={Payment:{ProjectID:x.id,Stage:1,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:u.value.reduce((c,f)=>c.concat(f.Files),[]),Submit:i?"true":"false"};U.culture("savePayment",n).subscribe(()=>{i?s("next"):a()})};return e.onMounted(a),e.provide("editable",N),(i,n)=>{var p;const c=e.resolveComponent("input-integer"),f=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qr,[e.createElementVNode("h5",Wr,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",Hr,"核定經費: "+e.toDisplayString((p=e.unref(d).ApprovedAmount)==null?void 0:p.toLocaleString())+"元",1),e.createElementVNode("div",Xr,[e.createElementVNode("table",Kr,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Zr,e.toDisplayString(e.unref(m)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(c,{max:e.unref(o),modelValue:e.unref(m),"onUpdate:modelValue":n[0]||(n[0]=b=>e.isRef(m)?m.value=b:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",vr,e.toDisplayString(e.unref(k))+"%",1),e.createElementVNode("td",ea,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",ta,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",la,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",oa,[e.createElementVNode("table",na,[e.createElementVNode("thead",ra,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",aa,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(b,w)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",sa,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.Title),1)]),_:2},1024)]),e.unref(N)&&b.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:b.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,da)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",ca,[b.Uploaded?(e.openBlock(),e.createElementBlock("span",ia,"已上傳")):(e.openBlock(),e.createElementBlock("span",ma,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!b.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:T=>h(b,T)},null,8,["onFile"])):e.createCommentVNode("",!0),b.Uploaded?(e.openBlock(),e.createElementBlock("div",pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Va,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(g)(T.Path)},e.toDisplayString(T.Name),9,fa),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>T.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Na)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Ea,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=b=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=b=>y(!0)),disabled:e.unref(V),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,ba)])],64)}}},ka={class:"block"},ya={class:"square-title"},ua={class:"text-teal fw-bold py-3"},xa={class:"text-teal fw-bold pb-3"},ha={class:"table-responsive mb-0"},$a={class:"table align-middle gray-table"},Ba={class:"text-end"},_a={class:"text-end"},Ca={class:"text-end"},Ta={class:"text-end"},wa={class:"text-teal fw-bold pb-3"},Da={class:"text-teal fw-bold pb-3"},Sa={class:"mt-4"},Aa={class:"table align-middle gray-table"},Fa={class:"text-center"},Ua={key:0,width:"180"},Ma={class:"text-center"},Pa=["href"],Ia={key:0,class:"text-center"},ja={key:0},Oa={key:1,class:"text-pink"},La={key:1,class:"tag-group mt-2 gap-1"},Ra={key:0,class:"tag tag-green-light"},qa=["download","href"],za=["onClick"],Ga={class:"block-bottom bg-light-teal"},Ja=["disabled"],Ya={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>m.value<=0||s.value.some(f=>!f.Files.filter(t=>!t.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var f;return((f=l.value)==null?void 0:f.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref(0),k=e.ref(0),E=e.ref({}),u=e.computed(()=>E.value.ApprovedAmount?Math.min(Math.round(m.value*100/E.value.ApprovedAmount*100)/100,100):0),h=e.computed(()=>g.value?Math.min(Math.round(m.value*100/g.value*100)/100,100):0),g=e.computed(()=>k.value+(r.value?l.value.CurrentActualPaidAmount:0)),s=e.ref([{Type:21,Title:"經費收支單",Template:"../../Template/CUL/經費收支單.docx",Files:[]},{Type:22,Title:"經費分攤表",Template:"../../Template/CUL/經費分攤表.docx",Files:[]},{Type:23,Title:"補助清單",Template:"../../Template/CUL/補助清單.docx",Files:[],Excludes:["1"]},{Type:24,Title:"發票憑證",Files:[],Excludes:["1","2"]}]),a=(f,t)=>{t.Type==="application/pdf"&&f.Files.push({Type:f.Type,Path:t.Path,Name:`${E.value.ProjectID}_第二期請款_${f.Title}.pdf`})},y=U.download,i=_,n=()=>{U.culture("getPayment",{ID:x.id}).subscribe(f=>{E.value=f.Project,j().init("culture",E.value),s.value=s.value.filter(p=>{var b;return!((b=p.Excludes)!=null&&b.includes(E.value.OrgCategory))}),s.value.forEach(p=>{p.Files=f.Attachments.filter(b=>b.Type===p.Type),p.Uploaded=e.computed(()=>p.Files.filter(b=>!b.Deleted).length)}),l.value=f.Payments.find(p=>p.Stage===2),l.value&&(m.value=l.value.TotalSpentAmount),o.value=E.value.ApprovedAmount;const t=f.Payments.filter(p=>p.Stage<2&&p.Status==="通過");d.value=t.reduce((p,b)=>p+b.CurrentRequestAmount,0),k.value=t.reduce((p,b)=>p+b.CurrentActualPaidAmount,0),Y().init(l.value,k.value)})},c=f=>{const t={Payment:{ProjectID:x.id,Stage:2,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:s.value.reduce((p,b)=>p.concat(b.Files),[]),Submit:f?"true":"false"};U.culture("savePayment",t).subscribe(()=>{f?i("next"):n()})};return e.onMounted(n),e.provide("editable",N),(f,t)=>{var T;const p=e.resolveComponent("input-integer"),b=e.resolveComponent("required-label"),w=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ka,[e.createElementVNode("h5",ya,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",ua,"核定經費: "+e.toDisplayString((T=e.unref(E).ApprovedAmount)==null?void 0:T.toLocaleString())+"元",1),e.createElementVNode("p",xa,"賸餘款: "+e.toDisplayString((e.unref(E).ApprovedAmount-e.unref(m)).toLocaleString())+"元",1),e.createElementVNode("div",ha,[e.createElementVNode("table",$a,[t[3]||(t[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",Ba,e.toDisplayString(e.unref(m)-e.unref(d)),1),e.createElementVNode("td",_a,e.toDisplayString(e.unref(k)),1),e.createElementVNode("td",null,[e.createVNode(p,{max:e.unref(o),modelValue:e.unref(m),"onUpdate:modelValue":t[0]||(t[0]=S=>e.isRef(m)?m.value=S:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Ca,e.toDisplayString(e.unref(u))+"%",1),e.createElementVNode("td",Ta,e.toDisplayString(e.unref(h))+"%",1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",wa,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Da,"累積實際撥款: "+e.toDisplayString(e.unref(g).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),t[9]||(t[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),t[10]||(t[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Sa,[e.createElementVNode("table",Aa,[e.createElementVNode("thead",Fa,[e.createElementVNode("tr",null,[t[4]||(t[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),t[5]||(t[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Ua,"狀態")):e.createCommentVNode("",!0),t[6]||(t[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s),(S,M)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",Ma,e.toDisplayString(M+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(b,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Title),1)]),_:2},1024)]),e.unref(N)&&S.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:S.Template,style:{width:"140px"},type:"button"},[...t[7]||(t[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Pa)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Ia,[S.Uploaded?(e.openBlock(),e.createElementBlock("span",ja,"已上傳")):(e.openBlock(),e.createElementBlock("span",Oa,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!S.Uploaded?(e.openBlock(),e.createBlock(w,{key:0,accept:".pdf",onFile:A=>a(S,A)},null,8,["onFile"])):e.createCommentVNode("",!0),S.Uploaded?(e.openBlock(),e.createElementBlock("div",La,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.Files,A=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[A.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Ra,[e.createElementVNode("a",{class:"tag-link my-1",download:A.Name,href:e.unref(y)(A.Path)},e.toDisplayString(A.Name),9,qa),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:C=>A.Deleted=!0,type:"button"},[...t[8]||(t[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,za)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Ga,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[1]||(t[1]=S=>c()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[2]||(t[2]=S=>c(!0)),disabled:e.unref(V),type:"button"},[...t[11]||(t[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Ja)])],64)}}},Qa={class:"block rounded-top-4"},Wa={class:"horizontal-scrollable"},Ha={class:"timeline"},Xa={class:"year"},Ka={class:"month"},Za=["onClick"],va={class:"square-title"},es={class:"table-responsive mt-4"},ts={class:"table align-middle gray-table"},ls={class:"text-end"},os={class:"table-responsive"},ns={class:"table align-middle gray-table"},rs={class:"text-end"},as={key:0,class:"invalid mt-0"},ss={class:"mt-3"},ds={class:"mt-3"},cs=["rowspan"],is={key:0,class:"block-bottom bg-light-teal"},ms={__name:"Progress",props:{id:{type:[Number,String]}},setup(B){const _=[{value:3,text:"完成"},{value:2,text:"部分完成"},{value:1,text:"未完成"}],x=B,m=e.ref(),V=e.ref({}),N=e.ref(0),r=e.ref({}),o=e.ref([]),l=e.ref({}),d=e.computed(()=>Math.round((N.value+o.value.filter(a=>a.Status===3).length)*100/k.value.length*10)/10),k=e.ref([]),E=e.ref([]),u=a=>{m.value=a,h()},h=()=>{U.culture("getMonthlyProgress",{ID:x.id,Year:m.value.year-1911,Month:m.value.month}).subscribe(a=>{const y=a.Logs,i=a.Items,n=a.Steps;let c=!1;N.value=0,l.value=a.Progress,k.value=a.Schedules,o.value=[],E.value.forEach(f=>{f.months.forEach(t=>{c||(t===m.value&&(c=!0),k.value.forEach(p=>{var b,w;if(p.Month===t.month)if(c||p.Status!==3){const T=y.find(S=>S.ScheduleID===p.ID)||{ScheduleID:p.ID,Status:p.Status};o.value.push(Object.assign(T,{Year:f.year,Month:p.Month,ItemTitle:(b=i.find(S=>S.ID===p.ItemID))==null?void 0:b.Title,Type:p.Type,StepTitle:(w=n.find(S=>S.ID===p.StepID))==null?void 0:w.Title}))}else N.value++}))})})})},g=a=>{if(V.value={},a&&!s()){e.nextTick(()=>{var i;return(i=document.querySelector(".invalid"))==null?void 0:i.scrollIntoView({behavior:"smooth",block:"center"})});return}const y={ID:l.value.ID,Description:l.value.Description||"",Status:a?1:0,Logs:o.value.map(i=>({ID:i.ID||0,ScheduleID:i.ScheduleID,Status:i.Status,DelayReason:i.DelayReason||"",ImprovedWay:i.ImprovedWay||""}))};U.culture("saveMonthlyProgress",y).subscribe(i=>{i&&(window.location.href="../inprogressList.aspx")})},s=()=>{let a={Description:"實際工作執行情形"};return V.value=P(l.value,a),o.value.forEach((y,i)=>{a={Status:{numericality:{greaterThan:0,message:"^請輸入本月是否完成"}}},[1,2].includes(y.Status)&&(a.DelayReason="落後原因",a.ImprovedWay="改善措施"),Object.assign(V.value,P(y,a,`item-${i}-`))}),!Object.keys(V.value).length};return e.onMounted(()=>{U.culture("getApplication",{ID:x.id}).subscribe(a=>{r.value=a.Project,j().init("culture",r.value);const y=new Date(r.value.StartTime),i=new Date(r.value.EndTime),n=Date.now();for(;;){const c=y.getFullYear(),f=y.getMonth(),t={year:c,month:f+1,disabled:new Date(c,f,20).getTime()>n};let p=E.value.find(b=>b.year===c);if(p?p.months.push(t):E.value.push({year:c,months:[t]}),c*100+f>=i.getFullYear()*100+i.getMonth())break;y.setMonth(f+1)}})}),(a,y)=>{const i=e.resolveComponent("input-textarea"),n=e.resolveComponent("input-radio-group");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qa,[e.createElementVNode("div",Wa,[y[3]||(y[3]=e.createElementVNode("button",{class:"btn-control btn-prev",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-left"})],-1)),e.createElementVNode("ul",Ha,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(E),c=>(e.openBlock(),e.createElementBlock("li",{key:c},[e.createElementVNode("span",Xa,e.toDisplayString(c.year-1911)+"年",1),e.createElementVNode("ul",Ka,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.months,f=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass({active:e.unref(m)===f,disabled:f.disabled}),key:f},[e.createElementVNode("a",{onClick:t=>u(f),href:"javascript:void(0)"},e.toDisplayString(f.month)+"月",9,Za)],2))),128))])]))),128))]),y[4]||(y[4]=e.createElementVNode("button",{class:"btn-control btn-next",type:"button"},[e.createElementVNode("i",{class:"fas fa-angle-right"})],-1))]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("h5",va,e.toDisplayString(e.unref(m).year-1911)+"年"+e.toDisplayString(e.unref(m).month)+"月 實際進度",1),e.createElementVNode("div",es,[e.createElementVNode("table",ts,[y[5]||(y[5]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",{class:"text-center"},"實際工作執行情形（條列式說明）")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",ls,e.toDisplayString(e.unref(m).year-1911)+"年"+e.toDisplayString(e.unref(m).month)+"月",1),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(V).Description,rows:"4",modelValue:e.unref(l).Description,"onUpdate:modelValue":y[0]||(y[0]=c=>e.unref(l).Description=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",os,[e.createElementVNode("table",ns,[y[8]||(y[8]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"月份"),e.createElementVNode("th",null,"重要工作項目"),e.createElementVNode("th",null,"工作進度%"),e.createElementVNode("th",null,"檢核工作"),e.createElementVNode("th",null,"本月是否完成"),e.createElementVNode("th",null,"年度目標達成數")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("th",rs,e.toDisplayString(c.Year-1911)+"年"+e.toDisplayString(c.Month)+"月",1),e.createElementVNode("td",null,e.toDisplayString(c.ItemTitle),1),e.createElementVNode("td",null,e.toDisplayString(c.Type===1?"50%":"100%"),1),e.createElementVNode("td",null,e.toDisplayString(c.StepTitle),1),e.createElementVNode("td",null,[e.createVNode(n,{options:_,modelValue:c.Status,"onUpdate:modelValue":t=>c.Status=t},null,8,["modelValue","onUpdate:modelValue"]),e.unref(V)[`item-${f}-Status`]?(e.openBlock(),e.createElementBlock("div",as,e.toDisplayString(e.unref(V)[`item-${f}-Status`]),1)):e.createCommentVNode("",!0),[1,2].includes(c.Status)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",ss,[y[6]||(y[6]=e.createElementVNode("div",{class:"text-teal pb-2"},"落後原因",-1)),e.createVNode(i,{error:e.unref(V)[`item-${f}-DelayReason`],rows:"1",modelValue:c.DelayReason,"onUpdate:modelValue":t=>c.DelayReason=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ds,[y[7]||(y[7]=e.createElementVNode("div",{class:"text-teal pb-2"},"改善措施",-1)),e.createVNode(i,{error:e.unref(V)[`item-${f}-ImprovedWay`],rows:"1",modelValue:c.ImprovedWay,"onUpdate:modelValue":t=>c.ImprovedWay=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])],64)):e.createCommentVNode("",!0)]),f?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("td",{key:0,class:"text-end",rowspan:e.unref(o).length},e.toDisplayString(e.unref(d))+"% ",9,cs))]))),128))])])])],64)):e.createCommentVNode("",!0)]),e.unref(m)?(e.openBlock(),e.createElementBlock("div",is,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:y[1]||(y[1]=c=>g()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:y[2]||(y[2]=c=>g(!0)),type:"button"},[...y[9]||(y[9]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])])])):e.createCommentVNode("",!0)],64)}}},ps={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"其他",url:"Other"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(x,m)=>{const V=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(V,{steps:_,type:"culture"})}}},Vs=(B,_)=>{const x=B.__vccOpts||B;for(const[m,V]of _)x[m]=V;return x},fs={class:"block"},Ns={class:"mt-4"},Es={class:"table align-middle gray-table side-table"},bs={key:0,class:"d-flex align-items-center gap-2"},gs={class:"input-group w-auto"},ks={class:"text-teal-dark"},ys={key:1,class:"invalid mt-0"},us={class:"square-title mt-4"},xs={class:"mt-4"},hs=["onClick"],$s={class:"d-flex flex-column gap-2"},Bs={class:"mt-4 d-flex flex-column gap-2"},_s={class:"d-flex flex-column gap-3 mt-4"},Cs={class:"bg-light-teal p-3 text-gray d-flex align-items-center gap-3"},Ts={class:"d-flex gap-2 align-items-center flex-grow-1"},ws={class:"text-nowrap"},Ds={class:"flex-grow-1"},Ss={class:"d-flex gap-2"},As=["onClick"],Fs=["href"],Us=["id"],Ms={class:"table align-middle gray-table side-table mb-0"},Ps={class:"p-0"},Is={class:"item-list"},js={class:"mt-2 align-self-start text-center"},Os={class:"input-group"},Ls={key:0,class:"invalid mt-0"},Rs={key:0,class:"d-flex gap-2 mt-1 align-self-start"},qs=["onClick"],zs=["onClick"],Gs={class:"row"},Js={class:"col"},Ys=["value"],Qs={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},Ws=["onClick"],Hs=["onClick"],Xs={class:"col"},Ks=["value"],Zs={key:0,class:"col-2 d-flex gap-2 mt-1 align-self-start"},vs=["onClick"],ed=["onClick"],td=["onClick"],ld={class:"mt-4"},od={class:"table align-middle gray-table side-table"},nd={key:0,class:"block-bottom bg-light-teal"},rd=Vs({__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("culture",l.value.Status,2)),N=e.computed(()=>k.value.EndDate),r=e.ref({}),o=e.computed(()=>d.value.filter(p=>!p.Deleted)),l=e.ref({}),d=e.ref([]),k=e.ref({}),E=()=>{U.culture("createGoal",{ID:x.id}).subscribe(p=>{d.value.push(Object.assign(p,{Items:[]}));const b=d.value[d.value.length-1];u(b)})},u=p=>{U.culture("createGoalItem",{ID:x.id,GoalID:p.ID}).subscribe(b=>{p.Items.push(Object.assign(b,{Steps:[],Schedules:[]}));const w=p.Items[p.Items.length-1];g(w),g(w),g(w),h(w,1),h(w,2)})},h=(p,b)=>U.culture("createGoalSchedule",{ID:x.id,ItemID:p.ID,Type:b}).subscribe(w=>p.Schedules.push(w)),g=p=>U.culture("createGoalStep",{ID:x.id,ItemID:p.ID}).subscribe(b=>p.Steps.push(b)),s=_,a=()=>{rxjs.forkJoin([U.culture("getWorkSchedule",{ID:x.id})]).subscribe(p=>{const b=p[0];l.value=b.Project,d.value=b.Goals,k.value=b.GrantType,d.value.length||E(),j().init("culture",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},y=p=>p.Deleted=!0,i=p=>p.Deleted=!0,n=p=>p.Deleted=!0,c=p=>p.Deleted=!0,f=p=>{var w,T;if(r.value={},p&&!t()){e.nextTick(()=>{var S;return(S=document.querySelector(".invalid"))==null?void 0:S.scrollIntoView({behavior:"smooth",block:"center"})});return}const b={Project:l.value,Goals:d.value,Before:(w=m.value)==null?void 0:w.Form2Before,After:(T=m.value)==null?void 0:T.Form2After,Submit:p?"true":"false"};U.culture("saveWorkSchedule",b).subscribe(()=>{p?s("next"):a()})},t=()=>{let p={StartTime:"計畫期程",EndTime:"計畫期程"};r.value=P(l.value,p);const b={Title:"計畫目標",Content:"預期效益"},w={Title:"重要工作項目",Indicator:"績效指標"},T={Title:"實施步驟",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}}},S={Month:{numericality:{greaterThan:0,message:"^請選擇月份"}},StepID:{numericality:{greaterThan:0,message:"^請選擇實施步驟"}}};return d.value.filter(M=>!M.Deleted).forEach((M,A)=>{Object.assign(r.value,P(M,b,`goal-${A}-`)),M.Items.filter(C=>!C.Deleted).forEach((C,D)=>{Object.assign(r.value,P(C,w,`item-${A}-${D}-`)),C.Steps.filter(F=>!F.Deleted).forEach((F,I)=>Object.assign(r.value,P(F,T,`step-${A}-${D}-${I}-`))),C.Schedules.filter(F=>F.Type===1&&!F.Deleted).forEach((F,I)=>Object.assign(r.value,P(F,S,`schedule-${A}-${D}-1-${I}-`))),C.Schedules.filter(F=>F.Type===2&&!F.Deleted).forEach((F,I)=>Object.assign(r.value,P(F,S,`schedule-${A}-${D}-2-${I}-`)))})}),m.value&&(p={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(r.value,P(m.value,p))),!Object.keys(r.value).length};return e.onMounted(a),e.provide("editable",V),(p,b)=>{const w=e.resolveComponent("required-label"),T=e.resolveComponent("input-tw-date"),S=e.resolveComponent("tw-date"),M=e.resolveComponent("input-text"),A=e.resolveComponent("input-textarea"),C=e.resolveComponent("input-month"),D=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",fs,[b[30]||(b[30]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Ns,[e.createElementVNode("table",Es,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[6]||(b[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",bs,[e.createElementVNode("div",gs,[e.createVNode(T,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(l).StartTime,"onUpdate:modelValue":b[0]||(b[0]=F=>e.unref(l).StartTime=F)},null,8,["max-date","modelValue"]),b[7]||(b[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(T,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(l).EndTime,"onUpdate:modelValue":b[1]||(b[1]=F=>e.unref(l).EndTime=F)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",ks,[b[8]||(b[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(S,{value:e.unref(N)},null,8,["value"]),b[9]||(b[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(r).StartTime||e.unref(r).EndTime?(e.openBlock(),e.createElementBlock("div",ys,e.toDisplayString(e.unref(r).StartTime||e.unref(r).EndTime),1)):e.createCommentVNode("",!0)])])])])]),e.createElementVNode("h5",us,[b[11]||(b[11]=e.createTextVNode(" 計畫目標與內容 ",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal-dark ms-3",onClick:E,type:"button"},[...b[10]||(b[10]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增計畫目標",-1)])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",xs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(F,I)=>(e.openBlock(),e.createElementBlock("div",{class:"block-form mt-3",key:F},[e.unref(V)&&e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-teal del",onClick:O=>y(F),type:"button"},"刪除",8,hs)):e.createCommentVNode("",!0),e.createElementVNode("div",$s,[b[12]||(b[12]=e.createElementVNode("label",{class:"text-teal-dark"},"計畫目標",-1)),e.createElementVNode("div",null,[e.createVNode(M,{error:e.unref(r)[`goal-${I}-Title`],modelValue:F.Title,"onUpdate:modelValue":O=>F.Title=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Bs,[b[13]||(b[13]=e.createElementVNode("label",{class:"text-teal-dark"},"預期效益（含量化或質化說明）",-1)),e.createElementVNode("div",null,[e.createVNode(A,{error:e.unref(r)[`goal-${I}-Content`],rows:"4",modelValue:F.Content,"onUpdate:modelValue":O=>F.Content=O,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",_s,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(F.Items.filter(O=>!O.Deleted),(O,G)=>(e.openBlock(),e.createElementBlock("div",{class:"border",key:O},[e.createElementVNode("div",Cs,[e.createElementVNode("div",Ts,[e.createElementVNode("label",ws,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[14]||(b[14]=[e.createTextVNode("重要工作項目",-1)])]),_:1})]),e.createElementVNode("div",Ds,[e.createVNode(M,{error:e.unref(r)[`item-${I}-${G}-Title`],modelValue:O.Title,"onUpdate:modelValue":L=>O.Title=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("div",Ss,[e.unref(V)&&F.Items.filter(L=>!L.Deleted).length>1?(e.openBlock(),e.createElementBlock("a",{key:0,class:"link-teal",onClick:e.withModifiers(L=>i(O),["prevent"]),href:"#"},"刪除",8,As)):e.createCommentVNode("",!0),e.createElementVNode("a",{"aria-expanded":"true",class:"link-teal","data-bs-toggle":"collapse",href:`#collapse-${G}`,role:"button"},"收合",8,Fs)])]),e.createElementVNode("div",{class:"collapse show",id:`collapse-${G}`},[e.createElementVNode("table",Ms,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[15]||(b[15]=[e.createTextVNode("實施步驟",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("及起迄月份",-1)])]),_:1})]),e.createElementVNode("td",Ps,[e.createElementVNode("ul",Is,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Steps.filter(L=>!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass(["step-item section-wrapper",{disabled:!e.unref(V)}]),key:L},[e.createElementVNode("div",js,e.toDisplayString(String.fromCharCode(65+J)),1),e.createElementVNode("div",null,[e.createVNode(M,{error:e.unref(r)[`step-${I}-${G}-${J}-Title`],placeholder:"如:進行口訪紀錄",modelValue:L.Title,"onUpdate:modelValue":R=>L.Title=R,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",null,[e.createElementVNode("div",Os,[e.createVNode(C,{"empty-value":0,modelValue:L.Begin,"onUpdate:modelValue":R=>L.Begin=R},null,8,["modelValue","onUpdate:modelValue"]),b[16]||(b[16]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(C,{"empty-value":0,modelValue:L.End,"onUpdate:modelValue":R=>L.End=R},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(r)[`step-${I}-${G}-${J}-Begin`]||e.unref(r)[`step-${I}-${G}-${J}-End`]?(e.openBlock(),e.createElementBlock("div",Ls,e.toDisplayString(e.unref(r)[`step-${I}-${G}-${J}-Begin`]||e.unref(r)[`step-${I}-${G}-${J}-End`]),1)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Rs,[O.Steps.filter(R=>!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>c(L),type:"button"},[...b[17]||(b[17]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,qs)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>g(O),type:"button"},[...b[18]||(b[18]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,zs)])):e.createCommentVNode("",!0)],2))),128))])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[19]||(b[19]=[e.createTextVNode("績效指標",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(r)[`item-${I}-${G}-Indicator`],placeholder:"如:完成口訪資料1篇",modelValue:O.Indicator,"onUpdate:modelValue":L=>O.Indicator=L,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[20]||(b[20]=[e.createTextVNode("工作進度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Gs,[e.createElementVNode("div",Js,[b[23]||(b[23]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 50% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===1&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(V)?3:4}`])},[e.createVNode(C,{error:e.unref(r)[`schedule-${I}-${G}-1-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(V)?7:8}`])},[e.createVNode(D,{"empty-value":0,error:e.unref(r)[`schedule-${I}-${G}-1-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:K})=>[e.createElementVNode("option",{value:K.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(K.Title),9,Ys)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Qs,[O.Schedules.filter(R=>R.Type===1&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>n(L),type:"button"},[...b[21]||(b[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ws)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>h(O,1),type:"button"},[...b[22]||(b[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,Hs)])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",Xs,[b[26]||(b[26]=e.createElementVNode("div",{class:"fs-16 text-gray"},"工作進度達 100% 應檢核工作",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(O.Schedules.filter(L=>L.Type===2&&!L.Deleted),(L,J)=>(e.openBlock(),e.createElementBlock("div",{class:"row g-2 align-items-center mt-2 section-wrapper",key:L},[e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(V)?3:4}`])},[e.createVNode(C,{error:e.unref(r)[`schedule-${I}-${G}-2-${J}-Month`],"empty-value":0,modelValue:L.Month,"onUpdate:modelValue":R=>L.Month=R},null,8,["error","modelValue","onUpdate:modelValue"])],2),e.createElementVNode("div",{class:e.normalizeClass(["mt-0",`col-${e.unref(V)?7:8}`])},[e.createVNode(D,{"empty-value":0,error:e.unref(r)[`schedule-${I}-${G}-2-${J}-StepID`],options:O.Steps.filter(R=>!R.Deleted),modelValue:L.StepID,"onUpdate:modelValue":R=>L.StepID=R},{default:e.withCtx(({index:R,option:K})=>[e.createElementVNode("option",{value:K.ID},e.toDisplayString(String.fromCharCode(65+R))+"."+e.toDisplayString(K.Title),9,Ks)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])],2),e.unref(V)?(e.openBlock(),e.createElementBlock("div",Zs,[O.Schedules.filter(R=>R.Type===2&&!R.Deleted).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:R=>n(L),type:"button"},[...b[24]||(b[24]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vs)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0 add-btn",onClick:R=>h(O,2),type:"button"},[...b[25]||(b[25]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])],8,ed)])):e.createCommentVNode("",!0)]))),128))])])])])])])],8,Us)]))),128))]),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal mt-3",onClick:O=>u(F),type:"button"},"新增工作項目",8,td)):e.createCommentVNode("",!0)]))),128))]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[b[29]||(b[29]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",ld,[e.createElementVNode("table",od,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[27]||(b[27]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(r).Form2Before,rows:"4",modelValue:e.unref(m).Form2Before,"onUpdate:modelValue":b[2]||(b[2]=F=>e.unref(m).Form2Before=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(w,null,{default:e.withCtx(()=>[...b[28]||(b[28]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{error:e.unref(r).Form2After,rows:"4",modelValue:e.unref(m).Form2After,"onUpdate:modelValue":b[3]||(b[3]=F=>e.unref(m).Form2After=F),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",nd,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:b[4]||(b[4]=F=>f()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:b[5]||(b[5]=F=>f(!0)),type:"button"},[...b[31]||(b[31]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},[["__scopeId","data-v-84d8fceb"]]),ad={class:"block"},sd={class:"mt-4"},dd={class:"table align-middle gray-table side-table"},cd={key:0},id={key:1,class:"text-light-gray"},md={class:"d-flex flex-column gap-2"},pd={key:0},Vd={class:"mt-4"},fd={class:"table align-middle gray-table side-table"},Nd={class:"row g-3"},Ed={class:"col-12 col-xl-2"},bd={class:"text-gray mb-2"},gd={class:"col-12 col-xl-3"},kd={class:"text-gray mb-2"},yd={key:0,class:"col-12 col-xl-4"},ud={class:"row g-1"},xd={class:"col-7"},hd={class:"col-5"},$d={key:1,class:"col-12 col-xl-3"},Bd={class:"text-gray mb-2"},_d={class:"mt-4"},Cd={class:"table align-middle gray-table side-table"},Td={class:"d-flex align-items-center gap-2"},wd={class:"input-group w-auto"},Dd={key:0,class:"invalid mt-0"},Sd={class:"mt-4"},Ad={class:"table-responsive mt-3 mb-0"},Fd={class:"table align-middle gray-table"},Ud={class:"text-end"},Md={class:"text-end"},Pd={class:"text-end"},Id={class:"text-end"},jd={class:"text-end"},Od={class:"table align-middle gray-table side-table"},Ld={key:0,class:"table-responsive mt-3 mb-0"},Rd={class:"table align-middle gray-table"},qd={key:0},zd={key:0},Gd={class:"d-flex gap-2"},Jd=["onClick"],Yd={class:"mt-4"},Qd={class:"table align-middle gray-table side-table"},Wd={key:0,class:"block-bottom bg-light-teal"},Hd={class:"text-center"},Xd={class:"mb-5"},Kd={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.ref(),r=e.computed(()=>z("education",d.value.Status,1)),o=e.ref({}),l=e.computed(()=>E.value.filter(f=>!f.Deleted)),d=e.ref({}),k=e.ref(),E=e.ref([]),u=e.ref(),h=e.ref(0),g=e.computed({get:()=>!!l.value.length,set:f=>{f?s():E.value.forEach(t=>t.Deleted=!0)}}),s=()=>E.value.push({}),a=_,y=()=>{U.education("getApplication",{ID:x.id}).subscribe(f=>{d.value=f.Project,N.value=f.Contacts,E.value=f.ReceivedSubsidies,d.value.OrgCategory=d.value.OrgCategory||null,j().init("education",d.value),V.value=d.value.changeApply,d.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=(f,t)=>{var b,w;if(o.value={},f&&!c()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&u.value&&d.value.ApplyAmount>u.value.GrantLimit*1e4){k.value.show(()=>n(f,!0));return}const p={Project:d.value,Contacts:N.value,ReceivedSubsidies:E.value.filter(T=>T.ID||!T.Deleted),Before:(b=V.value)==null?void 0:b.Form1Before,After:(w=V.value)==null?void 0:w.Form1After,Submit:f?"true":"false"};U.education("saveApplication",p).subscribe(T=>{f?a("next",T.ID):d.value.ID?y():window.location.href=`Application.aspx?ID=${T.ID}`})},c=()=>{let f={ProjectName:"計畫名稱",OrgCategory:"申請單位類型",OrgName:"申請單位",TaxID:"統一編號",Address:"地址",StartTime:"計畫期程",EndTime:"計畫期程",Target:"參加對象及人數",Summary:"計畫內容摘要",Quantified:"預期效益",ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}},SelfAmount:"申請單位自籌款",OtherGovAmount:"其他政府機關補助經費",OtherUnitAmount:"其他單位補助經費"};return d.value.OrgCategory==="2"&&(f.RegisteredNum="立案登記證字號"),o.value=P(d.value,f),f={Name:"姓名",JobTitle:"職稱"},Object.assign(o.value,P(N.value[0],f,"contact-0-")),f.MobilePhone="手機號碼",Object.assign(o.value,P(N.value[1],f,"contact-1-")),f={Name:"計畫名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入海委會補助經費"},numericality:{greaterThan:0,message:"^海委會補助經費不可為 0"}}},E.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`received-${p}-`))),V.value&&(f={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(V.value,f))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([U.education("getZgsCodes",{CodeGroup:"EDCOrgCategory"})]).subscribe(f=>{m.value=f[0],x.id?y():U.education("getEmptyApplication").subscribe(t=>{d.value=Object.assign({OrgCategory:null,FormStep:1,Status:1},t),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("education",d.value)})})}),e.provide("editable",r),e.watch(()=>d.value.OrgCategory,()=>{U.education("getGrantTargetSetting",{TargetTypeID:`EDC${d.value.OrgCategory}`}).subscribe(f=>{u.value=f})}),e.watchEffect(()=>{h.value=q(d.value.ApplyAmount)+q(d.value.SelfAmount)+q(d.value.OtherGovAmount)+q(d.value.OtherUnitAmount)}),(f,t)=>{const p=e.resolveComponent("required-label"),b=e.resolveComponent("input-text"),w=e.resolveComponent("input-select"),T=e.resolveComponent("input-tw-date"),S=e.resolveComponent("input-textarea"),M=e.resolveComponent("input-integer"),A=e.resolveComponent("input-boolean"),C=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ad,[t[52]||(t[52]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",sd,[e.createElementVNode("table",dd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[t[20]||(t[20]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[t[21]||(t[21]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",cd,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",id,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[t[22]||(t[22]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).ProjectName,modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":t[0]||(t[0]=D=>e.unref(d).ProjectName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("申請單位類型",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",md,[e.createElementVNode("div",null,[e.createVNode(w,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(m),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).OrgCategory,"onUpdate:modelValue":t[1]||(t[1]=D=>e.unref(d).OrgCategory=D)},null,8,["error","options","modelValue"])]),e.unref(d).OrgCategory==="2"?(e.openBlock(),e.createElementBlock("div",pd,[e.createVNode(b,{error:e.unref(o).RegisteredNum,prefix:"立案登記證字號",modelValue:e.unref(d).RegisteredNum,"onUpdate:modelValue":t[2]||(t[2]=D=>e.unref(d).RegisteredNum=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])):e.createCommentVNode("",!0)])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[25]||(t[25]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":t[3]||(t[3]=D=>e.unref(d).OrgName=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[26]||(t[26]=[e.createTextVNode("統一編號",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(d).TaxID,"onUpdate:modelValue":t[4]||(t[4]=D=>e.unref(d).TaxID=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[27]||(t[27]=[e.createTextVNode("地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":t[5]||(t[5]=D=>e.unref(d).Address=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[53]||(t[53]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Vd,[e.createElementVNode("table",fd,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(D,F)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Nd,[e.createElementVNode("div",Ed,[e.createElementVNode("div",bd,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[28]||(t[28]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(b,{error:e.unref(o)[`contact-${F}-Name`],modelValue:D.Name,"onUpdate:modelValue":I=>D.Name=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",gd,[e.createElementVNode("div",kd,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[29]||(t[29]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(b,{error:e.unref(o)[`contact-${F}-JobTitle`],modelValue:D.JobTitle,"onUpdate:modelValue":I=>D.JobTitle=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),F?(e.openBlock(),e.createElementBlock("div",yd,[t[30]||(t[30]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",ud,[e.createElementVNode("div",xd,[e.createVNode(b,{modelValue:D.Phone,"onUpdate:modelValue":I=>D.Phone=I,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",hd,[e.createVNode(b,{placeholder:"請輸入分機",size:"4",modelValue:D.PhoneExt,"onUpdate:modelValue":I=>D.PhoneExt=I,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])])):e.createCommentVNode("",!0),F?(e.openBlock(),e.createElementBlock("div",$d,[e.createElementVNode("div",Bd,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[31]||(t[31]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(b,{error:e.unref(o)[`contact-${F}-MobilePhone`],modelValue:D.MobilePhone,"onUpdate:modelValue":I=>D.MobilePhone=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])):e.createCommentVNode("",!0)])])]))),128))])])]),t[54]||(t[54]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",_d,[e.createElementVNode("table",Cd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[32]||(t[32]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Td,[e.createElementVNode("div",wd,[e.createVNode(T,{class:"w-auto",modelValue:e.unref(d).StartTime,"onUpdate:modelValue":t[6]||(t[6]=D=>e.unref(d).StartTime=D)},null,8,["modelValue"]),t[33]||(t[33]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(T,{class:"w-auto",modelValue:e.unref(d).EndTime,"onUpdate:modelValue":t[7]||(t[7]=D=>e.unref(d).EndTime=D)},null,8,["modelValue"])]),t[34]||(t[34]=e.createElementVNode("span",{class:"text-teal-dark"},"(計畫執行期間不得跨年度)",-1))]),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Dd,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[35]||(t[35]=[e.createTextVNode("參加對象及人數",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Target,modelValue:e.unref(d).Target,"onUpdate:modelValue":t[8]||(t[8]=D=>e.unref(d).Target=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[36]||(t[36]=[e.createTextVNode("計畫內容摘要",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容摘要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":t[9]||(t[9]=D=>e.unref(d).Summary=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[37]||(t[37]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(建議條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Quantified,"max-length":500,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":t[10]||(t[10]=D=>e.unref(d).Quantified=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),t[55]||(t[55]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫經費",-1)),e.createElementVNode("div",Sd,[t[43]||(t[43]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"其他單位及政府機關補助經費等欄，請詳實填寫；未接受補助者，請填寫0。經費單位為新臺幣(元)。")],-1)),e.createElementVNode("div",Ad,[e.createElementVNode("table",Fd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",Ud,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[38]||(t[38]=[e.createTextVNode("申請海委會",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Md,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[39]||(t[39]=[e.createTextVNode("申請單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("自籌款",-1)])]),_:1})]),e.createElementVNode("th",Pd,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[40]||(t[40]=[e.createTextVNode("其他政府機關",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費",-1)])]),_:1})]),e.createElementVNode("th",Id,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[41]||(t[41]=[e.createTextVNode("其他單位",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("補助經費（含總收費）",-1)])]),_:1})]),t[42]||(t[42]=e.createElementVNode("th",{class:"text-end"},"計畫總經費",-1))])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).ApplyAmount,modelValue:e.unref(d).ApplyAmount,"onUpdate:modelValue":t[11]||(t[11]=D=>e.unref(d).ApplyAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).SelfAmount,modelValue:e.unref(d).SelfAmount,"onUpdate:modelValue":t[12]||(t[12]=D=>e.unref(d).SelfAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).OtherGovAmount,modelValue:e.unref(d).OtherGovAmount,"onUpdate:modelValue":t[13]||(t[13]=D=>e.unref(d).OtherGovAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).OtherUnitAmount,modelValue:e.unref(d).OtherUnitAmount,"onUpdate:modelValue":t[14]||(t[14]=D=>e.unref(d).OtherUnitAmount=D)},null,8,["error","modelValue"])]),e.createElementVNode("td",jd,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])])]),e.createElementVNode("table",Od,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[44]||(t[44]=[e.createTextVNode("最近兩年曾獲",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("本會補助",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(A,{modelValue:e.unref(g),"onUpdate:modelValue":t[15]||(t[15]=D=>e.isRef(g)?g.value=D:null)},null,8,["modelValue"]),e.unref(g)?(e.openBlock(),e.createElementBlock("div",Ld,[e.createElementVNode("table",Rd,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[45]||(t[45]=e.createElementVNode("th",null,"計畫名稱",-1)),t[46]||(t[46]=e.createElementVNode("th",{class:"text-end"},"海委會補助經費",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",qd,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(D,F)=>(e.openBlock(),e.createElementBlock("tr",{key:D},[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`received-${F}-Name`],modelValue:D.Name,"onUpdate:modelValue":I=>D.Name=I,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`received-${F}-Amount`],modelValue:D.Amount,"onUpdate:modelValue":I=>D.Amount=I},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",zd,[e.createElementVNode("div",Gd,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:I=>i(D),type:"button"},[...t[47]||(t[47]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Jd)):e.createCommentVNode("",!0),F+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[48]||(t[48]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[51]||(t[51]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Yd,[e.createElementVNode("table",Qd,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[49]||(t[49]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(V).Form1Before,"onUpdate:modelValue":t[16]||(t[16]=D=>e.unref(V).Form1Before=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[50]||(t[50]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(S,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(V).Form1After,"onUpdate:modelValue":t[17]||(t[17]=D=>e.unref(V).Form1After=D),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Wd,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[18]||(t[18]=D=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[19]||(t[19]=D=>n(!0)),type:"button"},[...t[56]||(t[56]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(C,{ref_key:"modal",ref:k},{default:e.withCtx(()=>{var D;return[e.createElementVNode("div",Hd,[t[57]||(t[57]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Xd,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString((D=e.unref(u))==null?void 0:D.GrantLimit)+"萬",1),t[58]||(t[58]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[59]||(t[59]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]}),_:1},512)],64)}}},Zd={class:"block"},vd={key:0,class:"text-pink lh-base mt-4"},ec={class:"mt-4"},tc={class:"table align-middle gray-table"},lc={class:"text-center"},oc={key:0,width:"180"},nc={class:"text-center"},rc={key:0},ac=["innerHTML"],sc=["href"],dc={key:0,class:"text-center"},cc={key:0},ic={key:1,class:"text-pink"},mc={key:1,class:"tag-group mt-2 gap-1"},pc={key:0,class:"tag tag-green-light"},Vc=["download","href"],fc=["onClick"],Nc={class:"mt-4"},Ec={class:"table align-middle gray-table side-table"},bc={key:0,class:"block-bottom bg-light-teal"},gc=["disabled"],kc={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([{Type:1,Title:"申請表",Template:"../../Template/EDC/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/EDC/2-申請計畫書.docx",Files:[]},{Type:3,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/EDC/3-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]}]),V=e.ref(),N=e.computed(()=>m.value.some(s=>!s.Optional&&!s.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("education",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(s.Multiple?a.Name:`${s.Title}.pdf`)})},k=U.download,E=_,u=()=>{rxjs.forkJoin([U.education("getAttachment",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=m.value.filter(y=>{var i;return!((i=y.Excludes)!=null&&i.includes(l.value.OrgCategory))}),m.value.forEach(y=>{y.Files=a.Attachments.filter(i=>i.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(i=>!i.Deleted).length)}),j().init("education",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},h=s=>{var y,i;if(o.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Attachments:m.value.reduce((n,c)=>n.concat(c.Files),[]),Before:(y=V.value)==null?void 0:y.Form5Before,After:(i=V.value)==null?void 0:i.Form5After,Submit:s?"true":"false"};U.education("saveAttachment",a).subscribe(()=>{s?E("next"):u()})},g=()=>{if(V.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(V.value,s))}return!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zd,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",vd,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 請以紙本公文發文郵寄本會憑辦，附件需含資料表或申請書(正本；須加蓋學校、單位關防及負責人核章)、計畫書、未違反公職人員利益衝突迴避法切結書及事前揭露表(正本；須加蓋學校、單位關防及負責人核章)，及相關佐證資料(如社團成立證明、社團運作證明、有效期間內之當選證書、登記證書等) ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",ec,[e.createElementVNode("table",tc,[e.createElementVNode("thead",lc,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",oc,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",nc,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[c.Optional?(e.openBlock(),e.createElementBlock("span",rc,e.toDisplayString(c.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024))]),e.unref(r)&&c.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:c.Comment},null,8,ac)):e.createCommentVNode("",!0),e.unref(r)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,sc)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",dc,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",cc,"已上傳")):(e.openBlock(),e.createElementBlock("span",ic,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(c.Multiple||!c.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>d(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",mc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",pc,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(k)(t.Path)},e.toDisplayString(t.Name),9,Vc),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,fc)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Nc,[e.createElementVNode("table",Ec,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(V).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(V).Form5Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(V).Form5After,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form5After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",bc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=c=>h(!0)),disabled:e.unref(N),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,gc)])):e.createCommentVNode("",!0)],64)}}},yc={class:"block"},uc={class:"square-title"},xc={class:"text-teal fw-bold py-3"},hc={class:"text-teal fw-bold pb-3"},$c={class:"table-responsive mb-0"},Bc={class:"table align-middle gray-table"},_c={class:"text-end"},Cc={class:"text-end"},Tc={class:"text-end"},wc={class:"text-teal fw-bold pb-3"},Dc={class:"text-teal fw-bold pb-3"},Sc={class:"mt-4"},Ac={class:"table align-middle gray-table"},Fc={class:"text-center"},Uc={key:0,width:"180"},Mc={class:"text-center"},Pc=["href"],Ic={key:0,class:"text-center"},jc={key:0},Oc={key:1,class:"text-pink"},Lc={key:1,class:"tag-group mt-2 gap-1"},Rc={key:0,class:"tag tag-green-light"},qc=["download","href"],zc=["onClick"],Gc={class:"block-bottom bg-light-teal"},Jc=["disabled"],Yc={__name:"Payment",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>m.value<=0||u.value.some(i=>!i.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!l.value||l.value.Status==="請款中"),r=e.computed(()=>{var i;return((i=l.value)==null?void 0:i.Status)==="通過"}),o=e.ref(0),l=e.ref(),d=e.ref({}),k=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(m.value*100/d.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>r.value?Math.min(Math.round(m.value*100/l.value.CurrentActualPaidAmount*100)/100,100)+"%":"--"),u=e.ref([{Type:11,Title:"收支明細表",Template:"../../Template/EDC/1-收支明細表.docx",Files:[]},{Type:12,Title:"受補助清單",Template:"../../Template/EDC/2-受補助清單.docx",Files:[]},{Type:13,Title:"經費分攤表",Template:"../../Template/EDC/3-經費分攤表.docx",Files:[]},{Type:14,Title:"憑證",Template:"../../Template/EDC/4-憑證.docx",Files:[]},{Type:15,Title:"領據",Template:"../../Template/EDC/5-領據.docx",Files:[]}]),h=(i,n)=>{n.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:n.Path,Name:`${d.value.ProjectID}_${i.Title}.pdf`})},g=U.download,s=_,a=()=>{U.education("getPayment",{ID:x.id}).subscribe(i=>{d.value=i.Project,j().init("education",d.value),u.value=u.value.filter(n=>{var c;return!((c=n.Excludes)!=null&&c.includes(d.value.OrgCategory))}),u.value.forEach(n=>{n.Files=i.Attachments.filter(c=>c.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(c=>!c.Deleted).length)}),l.value=i.Payments.find(n=>n.Stage===1),l.value&&(m.value=l.value.TotalSpentAmount),o.value=d.value.ApprovedAmount,Y().init(l.value)})},y=i=>{const n={Payment:{ProjectID:x.id,Stage:1,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:u.value.reduce((c,f)=>c.concat(f.Files),[]),Submit:i?"true":"false"};U.education("savePayment",n).subscribe(()=>{i?s("next"):a()})};return e.onMounted(a),e.provide("editable",N),(i,n)=>{var p;const c=e.resolveComponent("input-integer"),f=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",yc,[e.createElementVNode("h5",uc,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",xc,"核定經費: "+e.toDisplayString((p=e.unref(d).ApprovedAmount)==null?void 0:p.toLocaleString())+"元",1),e.createElementVNode("p",hc,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(m)).toLocaleString())+"元",1),e.createElementVNode("div",$c,[e.createElementVNode("table",Bc,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",_c,e.toDisplayString(e.unref(m)),1),n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",null,[e.createVNode(c,{max:e.unref(o),modelValue:e.unref(m),"onUpdate:modelValue":n[0]||(n[0]=b=>e.isRef(m)?m.value=b:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Cc,e.toDisplayString(e.unref(k))+"%",1),e.createElementVNode("td",Tc,e.toDisplayString(e.unref(E)),1)])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",wc,"本期實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",Dc,"累積實際撥款: "+e.toDisplayString(e.unref(l).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Sc,[e.createElementVNode("table",Ac,[e.createElementVNode("thead",Fc,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Uc,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(b,w)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",Mc,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.Title),1)]),_:2},1024)]),e.unref(N)&&b.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:b.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Pc)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Ic,[b.Uploaded?(e.openBlock(),e.createElementBlock("span",jc,"已上傳")):(e.openBlock(),e.createElementBlock("span",Oc,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!b.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:T=>h(b,T)},null,8,["onFile"])):e.createCommentVNode("",!0),b.Uploaded?(e.openBlock(),e.createElementBlock("div",Lc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Rc,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(g)(T.Path)},e.toDisplayString(T.Name),9,qc),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>T.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,zc)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Gc,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=b=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=b=>y(!0)),disabled:e.unref(V),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Jc)])],64)}}},Qc={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請表／計畫書",url:"Application"},{step:2,title:"上傳附件／提送申請",url:"Attachment"}];return(x,m)=>{const V=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(V,{steps:_,type:"education"})}}},Wc={class:"modal-dialog modal-dialog-centered modal-md"},Hc={class:"modal-content"},Xc={class:"modal-body"},Kc={class:"d-flex flex-column align-items-center mb-5 gap-3"},Zc={class:"fs-18"},vc={__name:"ErrorModal",setup(B){const _=v(),x=e.ref();return e.onMounted(()=>x.value.addEventListener("hidden.bs.modal",()=>_.error=null)),e.watch(()=>_.error,()=>{_.error&&bootstrap.Modal.getOrCreateInstance(x.value).show()}),(m,V)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:x,tabindex:"-1"},[e.createElementVNode("div",Wc,[e.createElementVNode("div",Hc,[V[2]||(V[2]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Xc,[e.createElementVNode("div",Kc,[V[0]||(V[0]=e.createElementVNode("h4",{class:"text-danger fw-bold"},"錯誤",-1)),e.createElementVNode("div",Zc,e.toDisplayString(e.unref(_).error),1)]),V[1]||(V[1]=e.createElementVNode("div",{class:"d-flex gap-4 flex-wrap justify-content-center"},[e.createElementVNode("button",{class:"btn btn-danger","data-bs-dismiss":"modal",type:"button"}," 確認 ")],-1))])])])],512)]))}},X=Q.defineStore("grant",{actions:{init(B){this.type=B}},state:()=>({type:null,typeList:[{code:"SCI",title:"科專"},{code:"CUL",title:"文化"},{code:"EDC",title:"學校／民間"},{code:"CLB",title:"學校社團"},{code:"MUL",title:"多元"},{code:"LIT",title:"素養"},{code:"ACC",title:"無障礙"}]})}),ei={class:"search bg-gray rounded-4 mt-4"},ti={class:"search-form",action:""},li={class:"row g-3"},oi={class:"col-12 col-lg-6"},ni={key:0,class:"rounded-4 bg-white mt-4 p-4"},ri={class:"row"},ai={class:"col-12"},si={class:"row"},di={class:"col-12 col-lg-6 d-flex justify-content-between pe-4"},ci={class:"fw-bold text-primary fs-2"},ii={key:1,class:"rounded-4 bg-white mt-4 py-4"},mi={class:"row"},pi={class:"col-12 col-lg-3"},Vi={class:"col-12 col-lg-3"},fi={class:"col-12 col-lg-6"},Ni={key:2,class:"row"},Ei={class:"col-12 col-lg-6 pt-4"},bi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},gi={class:"fw-bold text-primary fs-2"},ki={class:"col-12 col-lg-6 pt-4"},yi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},ui={class:"fw-bold text-primary fs-2"},xi={class:"col-12 col-lg-6 pt-4"},hi={class:"d-flex justify-content-between rounded-4 bg-white p-4"},$i={class:"fw-bold text-primary fs-2"},Bi={class:"col-12 col-lg-6 pt-4"},_i={class:"d-flex justify-content-between rounded-4 bg-white p-4"},Ci={class:"fw-bold text-primary fs-2"},Ti={class:"rounded-4 bg-white p-4 mt-4 d-flex flex-column gap-5"},wi={class:"mt-4"},Di={class:"table-responsive"},Si={class:"table align-middle gray-table"},Ai={class:"text-center"},Fi={class:"text-center"},Ui={href:"Report/ApprovedList.aspx"},Mi={class:"text-end"},Pi={class:"text-end"},Ii={class:"block rounded-4 mt-4"},ji={class:"table-responsive",style:{"min-height":"400px"}},Oi={class:"row"},Li={class:"col"},Ri=["value"],qi={class:"table teal-table","aria-label":"申請計畫列表"},zi={"data-th":"年度:"},Gi={"data-th":"類別:",class:"text-start"},Ji={"data-th":"補助計畫:"},Yi={"data-th":"補助對象:"},Qi={"data-th":"相關檔案:"},Wi=["download","href"],Hi={"data-th":"我要申請:"},Xi=["href"],Ki={class:"total-list mt-4"},Zi=["href"],vi={class:"total-item-title"},em={class:"total-item-content"},tm={class:"count"},lm={__name:"HomeDashboard",setup(B){const _=X().typeList,x=[{title:"申請中尚未提送",url:"ApplicationChecklist.aspx",count:e.computed(()=>m.value.filter(y=>[1,14].includes(y.Status)).length)},{title:"申請審查中",url:"ApplicationChecklist.aspx",count:e.computed(()=>m.value.filter(y=>[11,12,21,22,31,32,41,42,43,44].includes(y.Status)).length)},{title:"審查意見待回覆",url:"ApplicationChecklist.aspx",count:e.computed(()=>0)},{title:"執行中計畫",url:"inprogressList.aspx",count:e.computed(()=>m.value.filter(y=>[51,52].includes(y.Status)).length)},{title:"執行階段待回覆",url:"inprogressList.aspx",count:e.computed(()=>0)}],m=e.ref([]),V=e.ref([]),N=e.ref(""),r=e.ref([]),o=e.ref([]),l=e.ref([]),d=e.ref(),k=e.computed(()=>{let y=V.value;return N.value&&(y=y.filter(i=>i.tags.includes(N.value))),y}),E=e.computed(()=>d.value?l.value.filter(y=>y.Category===d.value):l.value),u=e.computed(()=>({ApprovedAmount:E.value.reduce((y,i)=>y+i.ApprovedAmount,0),RemainingAmount:E.value.reduce((y,i)=>y+i.ApprovedAmount-i.SpendAmount,0),SpendAmount:E.value.reduce((y,i)=>y+i.SpendAmount,0),PaymentAmount:E.value.reduce((y,i)=>y+i.PaymentAmount,0),BudgetFees:E.value.reduce((y,i)=>y+i.BudgetFees,0)})),h=U.download,g=y=>o.value.filter(i=>i.GrantTypeID===y.TypeCode).map((i,n)=>`${n+1}.${i.Note}`).join("<br>"),s=y=>{switch(y.TypeCode){case"SCI":return"SCI/SciApplication.aspx?GrantTypeID=SCI";case"CLB":return"CLB/ClbApplication.aspx?GrantTypeID=CLB";default:return`${y.TypeCode}/Application.aspx`}},a=(y,i,n=2)=>{if(i){const c=10**n;return Math.round(y*100/i*c)/c}return 0};return e.onMounted(()=>{U.system("dashboard").subscribe(y=>{V.value=y.GrantTypes,o.value=y.Settings,m.value=y.ApplyList,l.value=y.StatList,V.value.forEach(i=>{var n;i.tags=(n=i.TargetTags)==null?void 0:n.split(`
`).map(c=>c.trim()),i.tags.forEach(c=>{r.value.includes(c)||r.value.push(c)})})})}),(y,i)=>{const n=e.resolveComponent("input-select"),c=e.resolveComponent("report-pie-chart"),f=e.resolveComponent("report-mix-chart"),t=e.resolveComponent("tooltip");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ei,[i[20]||(i[20]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",ti,[e.createElementVNode("div",li,[i[3]||(i[3]=e.createElementVNode("div",{class:"col-12 col-lg-6"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",{value:""},"114")])],-1)),e.createElementVNode("div",oi,[i[2]||(i[2]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"全部類別",-1)),e.createVNode(n,{options:e.unref(_),placeholder:"全部","text-name":"title","value-name":"code",modelValue:e.unref(d),"onUpdate:modelValue":i[0]||(i[0]=p=>e.isRef(d)?d.value=p:null)},null,8,["options","modelValue"])])]),i[4]||(i[4]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))]),e.unref(u)?(e.openBlock(),e.createElementBlock("div",ni,[e.createElementVNode("div",ri,[e.createElementVNode("div",ai,[e.createElementVNode("div",si,[e.createElementVNode("div",di,[i[6]||(i[6]=e.createElementVNode("div",{class:"fw-bold fs-4"},"總預算經費",-1)),e.createElementVNode("div",ci,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(u).BudgetFees/1e3).toLocaleString())+" ",1),i[5]||(i[5]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])])])):e.createCommentVNode("",!0),e.unref(u)?(e.openBlock(),e.createElementBlock("div",ii,[e.createElementVNode("div",mi,[e.createElementVNode("div",pi,[i[7]||(i[7]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"經費執行率",-1)),e.createVNode(c,{active:"已執行",color:9323693,inactive:"未執行",percent:a(e.unref(u).SpendAmount,e.unref(u).ApprovedAmount,1),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",Vi,[i[8]||(i[8]=e.createElementVNode("div",{class:"text-center fs-4 fw-bold mb-4"},"支用比",-1)),e.createVNode(c,{active:"已支用",color:3447003,inactive:"未支用",percent:Math.min(a(e.unref(u).SpendAmount,e.unref(u).PaymentAmount,1),100),style:{width:"100%",height:"300px"}},null,8,["percent"])]),e.createElementVNode("div",fi,[i[9]||(i[9]=e.createElementVNode("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e.createElementVNode("span",{class:"fs-4 fw-bold"},"各類經費執行情形")],-1)),i[10]||(i[10]=e.createElementVNode("div",{class:"fs-6 text-end text-secondary me-5"},"單位：千元",-1)),e.createVNode(f,{list:e.unref(l),style:{width:"100%",height:"300px"}},null,8,["list"])])])])):e.createCommentVNode("",!0),e.unref(u)?(e.openBlock(),e.createElementBlock("div",Ni,[e.createElementVNode("div",Ei,[e.createElementVNode("div",bi,[i[12]||(i[12]=e.createElementVNode("div",{class:"fw-bold fs-4"},"核定補助經費",-1)),e.createElementVNode("div",gi,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(u).ApprovedAmount/1e3).toLocaleString())+" ",1),i[11]||(i[11]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",ki,[e.createElementVNode("div",yi,[i[14]||(i[14]=e.createElementVNode("div",{class:"fw-bold fs-4"},"賸餘款",-1)),e.createElementVNode("div",ui,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(u).RemainingAmount/1e3).toLocaleString())+" ",1),i[13]||(i[13]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",xi,[e.createElementVNode("div",hi,[i[16]||(i[16]=e.createElementVNode("div",{class:"fw-bold fs-4"},"實支金額",-1)),e.createElementVNode("div",$i,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(u).SpendAmount/1e3).toLocaleString())+" ",1),i[15]||(i[15]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])]),e.createElementVNode("div",Bi,[e.createElementVNode("div",_i,[i[18]||(i[18]=e.createElementVNode("div",{class:"fw-bold fs-4"},"已撥付",-1)),e.createElementVNode("div",Ci,[e.createTextVNode(e.toDisplayString(Math.floor(e.unref(u).PaymentAmount/1e3).toLocaleString())+" ",1),i[17]||(i[17]=e.createElementVNode("span",{class:"fs-6 text-black"},"千元",-1))])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ti,[e.createElementVNode("div",null,[e.createElementVNode("div",wi,[e.createElementVNode("div",Di,[e.createElementVNode("table",Si,[i[19]||(i[19]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-center"},"類別"),e.createElementVNode("th",{class:"text-center"},"核定件數"),e.createElementVNode("th",{class:"text-end"},"核定補助經費"),e.createElementVNode("th",{class:"text-end"},"經費執行率")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),p=>(e.openBlock(),e.createElementBlock("tr",{key:p},[e.createElementVNode("td",Ai,e.toDisplayString(e.unref(_).find(b=>b.code===p.Category).title),1),e.createElementVNode("td",Fi,[e.createElementVNode("a",Ui,e.toDisplayString(p.Count),1)]),e.createElementVNode("td",Mi,e.toDisplayString(p.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Pi,e.toDisplayString(a(p.SpendAmount,p.ApprovedAmount))+"%",1)]))),128))])])])])])])]),e.createElementVNode("div",Ii,[e.createElementVNode("div",ji,[e.createElementVNode("div",Oi,[e.createElementVNode("div",Li,[i[22]||(i[22]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"依身分篩選適用規定",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":i[1]||(i[1]=p=>e.isRef(N)?N.value=p:null)},[i[21]||(i[21]=e.createElementVNode("option",{value:""},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,Ri))),128))],512),[[e.vModelSelect,e.unref(N)]])])]),e.createElementVNode("table",qi,[i[25]||(i[25]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"類別"),e.createElementVNode("th",{scope:"col"},"補助計畫"),e.createElementVNode("th",{scope:"col"},"補助對象"),e.createElementVNode("th",{scope:"col"},"相關檔案"),e.createElementVNode("th",{scope:"col"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(k),p=>(e.openBlock(),e.createElementBlock("tr",{key:p},[e.createElementVNode("td",zi,e.toDisplayString(p.Year),1),e.createElementVNode("td",Gi,e.toDisplayString(p.ShortName),1),e.createElementVNode("td",Ji,e.toDisplayString(p.FullName),1),e.createElementVNode("td",Yi,[e.createVNode(t,{"data-bs-html":"true",title:g(p)},null,8,["title"])]),e.createElementVNode("td",Qi,[p.Path?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark",download:p.Filename,href:e.unref(h)(p.Path),style:{display:"inline"}},[...i[23]||(i[23]=[e.createElementVNode("i",{class:"fas fa-file-alt"},null,-1)])],8,Wi)):e.createCommentVNode("",!0)]),e.createElementVNode("td",Hi,[e.createElementVNode("a",{class:"btn btn-teal-dark",href:s(p),target:"_blank"},[...i[24]||(i[24]=[e.createElementVNode("i",{class:"fa-solid"},null,-1),e.createTextVNode("我要申請",-1)])],8,Xi)])]))),128))])])])]),e.createElementVNode("ul",Ki,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(x,p=>e.createElementVNode("li",{class:"total-item",key:p},[e.createElementVNode("a",{href:p.url},[e.createElementVNode("div",vi,e.toDisplayString(p.title),1),e.createElementVNode("div",em,[e.createElementVNode("span",tm,e.toDisplayString(p.count),1),i[26]||(i[26]=e.createElementVNode("span",{class:"unit"},"件",-1))])],8,Zi)])),64))])],64)}}},om={__name:"InputBoolean",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(B){const _=e.useModel(B,"modelValue"),x=[{value:!0,text:"是"},{value:!1,text:"否"}];return(m,V)=>{const N=e.resolveComponent("input-radio-group");return e.openBlock(),e.createBlock(N,{options:x,modelValue:_.value,"onUpdate:modelValue":V[0]||(V[0]=r=>_.value=r)},null,8,["modelValue"])}}},nm=Object.assign({inheritAttrs:!1},{__name:"InputFile",emits:["file"],setup(B,{emit:_}){const x=e.ref(),m=()=>{Array.from(x.value.files).forEach(N=>U.upload(N).subscribe(r=>V("file",r))),x.value.value=""},V=_;return(N,r)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:r[0]||(r[0]=o=>e.unref(x).click()),type:"button"},[...r[1]||(r[1]=[e.createElementVNode("i",{class:"fas fa-file-upload me-1"},null,-1),e.createTextVNode("上傳",-1)])]),e.createElementVNode("input",e.mergeProps({onChange:m,class:"d-none",ref_key:"input",ref:x,type:"file"},N.$attrs),null,16)],64))}}),rm=["disabled","placeholder","type"],am={key:0,class:"invalid mt-0"},sm=Object.assign({inheritAttrs:!1},{__name:"InputInteger",props:e.mergeModels({error:{type:String},max:{type:Number},placeholder:{default:"請輸入",type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),x=e.useModel(B,"modelValue"),m=B;return e.watch(x,V=>{if(V){const N=(parseInt(V)||0).toString();V.toString()!==N?x.value=N:m.max&&Number(N)>m.max&&(x.value=m.max)}}),(V,N)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:"",style:{"text-align":"right"},type:B.type},V.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=r=>x.value=r)}),null,16,rm),[[e.vModelDynamic,x.value]]),B.error?(e.openBlock(),e.createElementBlock("div",am,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),dm={__name:"InputMonth",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(B){const _=e.useModel(B,"modelValue"),x=[];for(let m=1;m<=12;m++)x.push({value:m,text:`${m}月`});return(m,V)=>{const N=e.resolveComponent("input-select");return e.openBlock(),e.createBlock(N,{options:x,modelValue:_.value,"onUpdate:modelValue":V[0]||(V[0]=r=>_.value=r)},null,8,["modelValue"])}}},cm=["onChange","checked","disabled","id","value"],im=["for"],mm={__name:"InputRadioGroup",props:e.mergeModels({id:{default:()=>ne(),type:String},options:{default:[],type:Array},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),x=e.useModel(B,"modelValue"),m=V=>{x.value=V};return(V,N)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.options,r=>(e.openBlock(),e.createElementBlock("div",{class:"form-check form-check-inline mb-0",key:r},[e.createElementVNode("input",{onChange:o=>m(r[B.valueName]),checked:r[B.valueName]===x.value,class:"form-check-input",disabled:!e.unref(_),id:`${B.id}-${r[B.valueName]}`,type:"radio",value:r[B.valueName]},null,40,cm),e.createElementVNode("label",{class:"form-check-label",for:`${B.id}-${r[B.valueName]}`},e.toDisplayString(r[B.textName]),9,im)]))),128))}},pm=["disabled"],Vm=["value"],fm=["value"],Nm={key:0,class:"invalid mt-0"},Em=Object.assign({inheritAttrs:!1},{__name:"InputSelect",props:e.mergeModels({disabled:{default:!1,type:Boolean},emptyValue:{type:[Number,String]},error:{type:String},options:{default:[],type:Array},placeholder:{default:"請選擇",type:String},textName:{default:"text",type:String},valueName:{default:"value",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),x=e.useModel(B,"modelValue");return(m,V)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("select",e.mergeProps({class:"form-select",disabled:B.disabled||!e.unref(_)},m.$attrs,{"onUpdate:modelValue":V[0]||(V[0]=N=>x.value=N)}),[e.unref(_)&&!x.value?(e.openBlock(),e.createElementBlock("option",{key:0,value:B.emptyValue},e.toDisplayString(B.placeholder),9,Vm)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.options,(N,r)=>e.renderSlot(m.$slots,"default",{key:N,index:r,option:N},()=>[e.createElementVNode("option",{value:N[B.valueName]},e.toDisplayString(N[B.textName]),9,fm)])),128))],16,pm),[[e.vModelSelect,x.value]]),B.error?(e.openBlock(),e.createElementBlock("div",Nm,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),bm={class:"input-group"},gm={key:0,class:"input-group-text"},km=["disabled","placeholder","type"],ym={key:0,class:"invalid mt-0"},um=Object.assign({inheritAttrs:!1},{__name:"InputText",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String},prefix:{type:String},type:{default:"text",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),x=e.useModel(B,"modelValue"),m=B;return m.maxLength&&e.watch(x,()=>{var V;((V=x.value)==null?void 0:V.length)>m.maxLength&&(x.value=x.value.substring(0,m.maxLength))}),(V,N)=>{const r=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",bm,[B.prefix?(e.openBlock(),e.createElementBlock("span",gm,[e.createVNode(r,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(B.prefix),1)]),_:1})])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:"",type:B.type},V.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=o=>x.value=o)}),null,16,km),[[e.vModelDynamic,x.value]])]),B.error?(e.openBlock(),e.createElementBlock("div",ym,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64)}}}),xm=["disabled","placeholder"],hm={key:0,class:"fs-14 text-gray mt-2"},$m={class:"text-pink"},Bm={key:1,class:"invalid mt-0"},_m=Object.assign({inheritAttrs:!1},{__name:"InputTextarea",props:e.mergeModels({error:{type:String},maxLength:{type:Number},placeholder:{default:"請輸入",type:String}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const _=e.inject("editable",!0),x=e.useModel(B,"modelValue"),m=B;return m.maxLength&&e.watch(x,()=>{var V;((V=x.value)==null?void 0:V.length)>m.maxLength&&(x.value=x.value.substring(0,m.maxLength))}),(V,N)=>{var r;return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("textarea",e.mergeProps({class:"form-control",disabled:!e.unref(_),placeholder:e.unref(_)?B.placeholder:""},V.$attrs,{"onUpdate:modelValue":N[0]||(N[0]=o=>x.value=o)}),null,16,xm),[[e.vModelText,x.value]]),e.unref(_)&&B.maxLength?(e.openBlock(),e.createElementBlock("div",hm,[N[1]||(N[1]=e.createTextVNode(" 已輸入 ",-1)),e.createElementVNode("span",$m,e.toDisplayString(((r=x.value)==null?void 0:r.length)||0),1),e.createTextVNode(" 個字數(限"+e.toDisplayString(B.maxLength)+"字數) ",1)])):e.createCommentVNode("",!0),B.error?(e.openBlock(),e.createElementBlock("div",Bm,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64)}}}),Cm=["disabled"],Tm={key:0,class:"invalid"},wm=Object.assign({inheritAttrs:!1},{__name:"InputTwDate",props:{displayFormat:{default:"tYY/MM/DD",type:String},drops:{default:"down",type:String},error:{type:String},format:{default:"YYYY-MM-DD",type:String},maxDate:{type:String},modelValue:{default:"",type:String},noFuture:{default:!1,type:Boolean}},emits:["update:modelValue"],setup(B,{emit:_}){let x;const m=B,V=e.ref(),N=e.inject("editable",!0),r=e.ref(),o=_,l=d=>{!d&&m.modelValue&&(d=moment(new Date(m.modelValue))),d?(V.value=d.format(m.displayFormat),o("update:modelValue",d.format(m.format))):(V.value="",o("update:modelValue","")),x.setStartDate(V.value||void 0)};return e.onMounted(()=>{const d=$(r.value);d.daterangepicker({autoApply:!0,autoUpdateInput:!1,drops:m.drops,locale:{format:m.displayFormat},maxDate:m.maxDate?new Date(m.maxDate):m.noFuture?new Date:void 0,showDropdowns:!0,singleDatePicker:!0}).on("apply.daterangepicker",(k,E)=>l(E.startDate)),x=d.data("daterangepicker"),l()}),e.onUnmounted(()=>x.remove()),e.watch(()=>m.modelValue,()=>l()),(d,k)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.withDirectives(e.createElementVNode("input",e.mergeProps({class:"form-control",disabled:!e.unref(N),ref_key:"element",ref:r,type:"text"},d.$attrs,{"onUpdate:modelValue":k[0]||(k[0]=E=>e.isRef(V)?V.value=E:null)}),null,16,Cm),[[e.vModelText,e.unref(V)]]),B.error?(e.openBlock(),e.createElementBlock("div",Tm,e.toDisplayString(B.error),1)):e.createCommentVNode("",!0)],64))}}),Dm={key:0,class:"d-flex align-items-center justify-content-between flex-wrap gap-2"},Sm={class:"pagination","aria-label":"Pagination"},Am=["disabled"],Fm={key:1,class:"pagination-item ellipsis",type:"button"},Um=["onClick"],Mm={class:"page-number"},Pm={key:2,class:"pagination-item ellipsis",type:"button"},Im={class:"page-number"},jm=["disabled"],Om={class:"page-number-control"},Lm={class:"page-number-control-item"},Rm=["selected","value"],qm={class:"page-number-control-item"},zm=["value","selected"],Gm={__name:"ListPager",props:{count:{required:!0,type:Number},page:{required:!0,type:Number},pageSize:{required:!0,type:Number},slots:{default:3,type:Number}},emits:["change"],setup(B,{emit:_}){const x={},m=B,V=e.computed(()=>Math.ceil(m.count/m.pageSize)),N=(o,l)=>{l&&(o=Math.min(o,Math.ceil(m.count/l))),1<=o&&o<=V.value&&r("change",o,l||m.pageSize)},r=_;return e.watchEffect(()=>{x.from=m.page-parseInt(m.slots/2),x.to=m.page+parseInt((m.slots-1)/2),x.pages=[];for(let o=x.from;o<=x.to;o++)0<o&&o<=V.value&&x.pages.push(o)}),(o,l)=>m.count?(e.openBlock(),e.createElementBlock("div",Dm,[e.createElementVNode("nav",Sm,[e.createElementVNode("button",{"aria-label":"Previous page",class:"nav-button",onClick:l[0]||(l[0]=d=>N(B.page-1)),disabled:B.page===1,type:"button"},[...l[6]||(l[6]=[e.createElementVNode("i",{class:"fas fa-chevron-left"},null,-1)])],8,Am),x.from>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pagination-item",onClick:l[1]||(l[1]=d=>N(1)),type:"button"},[...l[7]||(l[7]=[e.createElementVNode("span",{class:"page-number"},"1",-1)])])):e.createCommentVNode("",!0),x.from>2?(e.openBlock(),e.createElementBlock("button",Fm,[...l[8]||(l[8]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.pages,d=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["pagination-item",{active:B.page===d}]),onClick:k=>N(d),key:d,type:"button"},[e.createElementVNode("span",Mm,e.toDisplayString(d),1)],10,Um))),128)),e.unref(V)>x.to+1?(e.openBlock(),e.createElementBlock("button",Pm,[...l[9]||(l[9]=[e.createElementVNode("span",null,"...",-1)])])):e.createCommentVNode("",!0),e.unref(V)>x.to?(e.openBlock(),e.createElementBlock("button",{key:3,class:"pagination-item",onClick:l[2]||(l[2]=d=>N(e.unref(V))),type:"button"},[e.createElementVNode("span",Im,e.toDisplayString(e.unref(V)),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{"aria-label":"Next page",class:"nav-button",onClick:l[3]||(l[3]=d=>N(B.page+1)),type:"button",disabled:B.page===e.unref(V)},[...l[10]||(l[10]=[e.createElementVNode("i",{class:"fas fa-chevron-right"},null,-1)])],8,jm)]),e.createElementVNode("div",Om,[e.createElementVNode("div",Lm,[l[11]||(l[11]=e.createElementVNode("span",null,"跳到",-1)),e.createElementVNode("select",{onChange:l[4]||(l[4]=d=>N(d.target.value)),class:"form-select jump-to-page"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),d=>(e.openBlock(),e.createElementBlock("option",{key:d,selected:d===B.page,value:d},e.toDisplayString(d),9,Rm))),128))],32),l[12]||(l[12]=e.createElementVNode("span",null,"頁",-1)),l[13]||(l[13]=e.createElementVNode("span",null,",",-1))]),e.createElementVNode("div",qm,[l[14]||(l[14]=e.createElementVNode("span",null,"每頁顯示",-1)),e.createElementVNode("select",{onChange:l[5]||(l[5]=d=>N(B.page,d.target.value)),class:"form-select"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList([10,20,30],d=>e.createElementVNode("option",{value:d,selected:d===B.pageSize},e.toDisplayString(d),9,zm)),64))],32),l[15]||(l[15]=e.createElementVNode("span",null,"筆",-1))])])])):e.createCommentVNode("",!0)}},Jm={class:"block"},Ym={class:"mt-4"},Qm={class:"table align-middle gray-table side-table"},Wm={key:0},Hm={key:1,class:"text-light-gray"},Xm={class:"mt-4"},Km={class:"table align-middle gray-table side-table"},Zm={class:"row g-3"},vm={class:"col-12 col-xl-2"},ep={class:"text-gray mb-2"},tp={class:"col-12 col-xl-3"},lp={class:"text-gray mb-2"},op={class:"col-12 col-xl-4"},np={class:"row g-1"},rp={class:"col-7"},ap={class:"col-5"},sp={class:"col-12 col-xl-3"},dp={class:"text-gray mb-2"},cp={class:"col-12"},ip={class:"text-gray mb-2"},mp={class:"mt-4"},pp={class:"table align-middle gray-table side-table"},Vp={class:"mt-4"},fp={class:"table align-middle gray-table side-table"},Np={key:0,class:"table-responsive mt-3 mb-0"},Ep={class:"table align-middle gray-table"},bp={key:0},gp={key:0},kp={class:"d-flex gap-2"},yp=["onClick"],up={class:"mt-4"},xp={class:"table align-middle gray-table side-table"},hp={key:0,class:"block-bottom bg-light-teal"},$p={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.ref(),N=e.computed(()=>z("literacy",d.value.Status,1)),r=e.ref({}),o=e.ref([]),l=e.computed(()=>k.value.filter(i=>!i.Deleted)),d=e.ref({}),k=e.ref([]),E=e.computed({get:()=>!!l.value.length,set:i=>{i?u():k.value.forEach(n=>n.Deleted=!0)}}),u=()=>k.value.push({}),h=_,g=()=>{U.literacy("getApplication",{ID:x.id}).subscribe(i=>{d.value=i.Project,m.value=i.Contacts,k.value=i.PreviousStudies,j().init("literacy",d.value),V.value=d.value.changeApply,d.value.changeApply=void 0})},s=i=>i.Deleted=!0,a=i=>{var c,f;if(r.value={},i&&!y()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}const n={Project:d.value,Contacts:m.value,PreviousStudies:k.value.filter(t=>t.ID||!t.Deleted),Before:(c=V.value)==null?void 0:c.Form1Before,After:(f=V.value)==null?void 0:f.Form1After,Submit:i?"true":"false"};U.literacy("saveApplication",n).subscribe(t=>{i?h("next",t.ID):d.value.ID?g():window.location.href=`Application.aspx?ID=${t.ID}`})},y=()=>{let i={Field:"計畫類別",OrgName:"申請單位",OrgLeader:"校長姓名",Address:"學校地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return r.value=P(d.value,i),i={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},m.value.forEach((n,c)=>Object.assign(r.value,P(n,i,`contact-${c}-`))),i={Title:"研習/課程名稱",TheDate:"辦理日期"},k.value.forEach((n,c)=>Object.assign(r.value,P(n,i,`study-${c}-`))),V.value&&(i={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(r.value,P(V.value,i))),!Object.keys(r.value).length};return e.onMounted(()=>{rxjs.forkJoin([U.literacy("getZgsCodes",{CodeGroup:"LITField"})]).subscribe(i=>{o.value=i[0],x.id?g():U.literacy("getEmptyApplication").subscribe(n=>{d.value=Object.assign({Field:null,FormStep:1,Status:1},n),m.value=[{Role:"申請人"}],j().init("literacy",d.value)})})}),e.provide("editable",N),e.watch(()=>[d.value.Field,d.value.OrgName],()=>{var i;if(N.value){const n=[];d.value.Field&&n.push((i=o.value.find(c=>c.Code===d.value.Field))==null?void 0:i.Descname),d.value.OrgName&&n.push(d.value.OrgName),d.value.ProjectName=n.join("-")}}),(i,n)=>{const c=e.resolveComponent("required-label"),f=e.resolveComponent("input-text"),t=e.resolveComponent("input-select"),p=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-boolean"),w=e.resolveComponent("input-tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jm,[n[40]||(n[40]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",Ym,[e.createElementVNode("table",Qm,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[14]||(n[14]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).Year),1)]),e.createElementVNode("tr",null,[n[15]||(n[15]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(d).ProjectID?(e.openBlock(),e.createElementBlock("span",Wm,e.toDisplayString(e.unref(d).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",Hm,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[n[16]||(n[16]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(d).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[17]||(n[17]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{disabled:"",modelValue:e.unref(d).ProjectName,"onUpdate:modelValue":n[0]||(n[0]=T=>e.unref(d).ProjectName=T),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[18]||(n[18]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{"empty-value":null,error:e.unref(r).Field,options:e.unref(o),"text-name":"Descname","value-name":"Code",modelValue:e.unref(d).Field,"onUpdate:modelValue":n[1]||(n[1]=T=>e.unref(d).Field=T)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[19]||(n[19]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).OrgName,placeholder:"請輸入學校全銜",modelValue:e.unref(d).OrgName,"onUpdate:modelValue":n[2]||(n[2]=T=>e.unref(d).OrgName=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[20]||(n[20]=[e.createTextVNode("校長姓名",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).OrgLeader,modelValue:e.unref(d).OrgLeader,"onUpdate:modelValue":n[3]||(n[3]=T=>e.unref(d).OrgLeader=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[21]||(n[21]=[e.createTextVNode("學校地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r).Address,placeholder:"請輸入地址",modelValue:e.unref(d).Address,"onUpdate:modelValue":n[4]||(n[4]=T=>e.unref(d).Address=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),n[41]||(n[41]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",Xm,[e.createElementVNode("table",Km,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(T.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",Zm,[e.createElementVNode("div",vm,[e.createElementVNode("div",ep,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[22]||(n[22]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(r)[`contact-${S}-Name`],modelValue:T.Name,"onUpdate:modelValue":M=>T.Name=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",tp,[e.createElementVNode("div",lp,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[23]||(n[23]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(r)[`contact-${S}-JobTitle`],modelValue:T.JobTitle,"onUpdate:modelValue":M=>T.JobTitle=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",op,[n[24]||(n[24]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",np,[e.createElementVNode("div",rp,[e.createVNode(f,{modelValue:T.Phone,"onUpdate:modelValue":M=>T.Phone=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",ap,[e.createVNode(f,{placeholder:"請輸入分機",size:"4",modelValue:T.PhoneExt,"onUpdate:modelValue":M=>T.PhoneExt=M,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",sp,[e.createElementVNode("div",dp,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[25]||(n[25]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(r)[`contact-${S}-MobilePhone`],modelValue:T.MobilePhone,"onUpdate:modelValue":M=>T.MobilePhone=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",cp,[e.createElementVNode("div",ip,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[26]||(n[26]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(f,{error:e.unref(r)[`contact-${S}-EMail`],modelValue:T.EMail,"onUpdate:modelValue":M=>T.EMail=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),n[42]||(n[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",mp,[e.createElementVNode("table",pp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[27]||(n[27]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[n[28]||(n[28]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(p,{error:e.unref(r).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(d).Target,"onUpdate:modelValue":n[5]||(n[5]=T=>e.unref(d).Target=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[29]||(n[29]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(d).Summary,"onUpdate:modelValue":n[6]||(n[6]=T=>e.unref(d).Summary=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[30]||(n[30]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Quantified,"onUpdate:modelValue":n[7]||(n[7]=T=>e.unref(d).Quantified=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[31]||(n[31]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(d).Qualitative,"onUpdate:modelValue":n[8]||(n[8]=T=>e.unref(d).Qualitative=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",Vp,[e.createElementVNode("table",fp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[36]||(n[36]=e.createElementVNode("th",null,"最近三年參與本會辦理之相關研習或課程",-1)),e.createElementVNode("td",null,[e.createVNode(b,{modelValue:e.unref(E),"onUpdate:modelValue":n[9]||(n[9]=T=>e.isRef(E)?E.value=T:null)},null,8,["modelValue"]),e.unref(E)?(e.openBlock(),e.createElementBlock("div",Np,[e.createElementVNode("table",Ep,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[n[32]||(n[32]=e.createElementVNode("th",null,"研習/課程名稱",-1)),n[33]||(n[33]=e.createElementVNode("th",null,"辦理日期",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",bp,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(T,S)=>(e.openBlock(),e.createElementBlock("tr",{key:T},[e.createElementVNode("td",null,[e.createVNode(f,{error:e.unref(r)[`study-${S}-Title`],modelValue:T.Title,"onUpdate:modelValue":M=>T.Title=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(r)[`study-${S}-TheDate`],modelValue:T.TheDate,"onUpdate:modelValue":M=>T.TheDate=M,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",gp,[e.createElementVNode("div",kp,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:M=>s(T),type:"button"},[...n[34]||(n[34]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,yp)):e.createCommentVNode("",!0),S+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:u,type:"button"},[...n[35]||(n[35]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[39]||(n[39]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",up,[e.createElementVNode("table",xp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[37]||(n[37]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Form1Before,rows:"4",modelValue:e.unref(V).Form1Before,"onUpdate:modelValue":n[10]||(n[10]=T=>e.unref(V).Form1Before=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(c,null,{default:e.withCtx(()=>[...n[38]||(n[38]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).Form1After,rows:"4",modelValue:e.unref(V).Form1After,"onUpdate:modelValue":n[11]||(n[11]=T=>e.unref(V).Form1After=T),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",hp,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[12]||(n[12]=T=>a()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[13]||(n[13]=T=>a(!0)),type:"button"},[...n[43]||(n[43]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Bp={class:"block"},_p={key:0,class:"text-pink lh-base mt-4"},Cp={class:"mt-4"},Tp={class:"table align-middle gray-table"},wp={class:"text-center"},Dp={key:0,width:"180"},Sp={class:"text-center"},Ap={key:0},Fp=["innerHTML"],Up=["href"],Mp={key:0,class:"text-center"},Pp={key:0},Ip={key:1,class:"text-pink"},jp={key:1,class:"tag-group mt-2 gap-1"},Op={key:0,class:"tag tag-green-light"},Lp=["download","href"],Rp=["onClick"],qp={class:"mt-4"},zp={class:"table align-middle gray-table side-table"},Gp={key:0,class:"block-bottom bg-light-teal"},Jp=["disabled"],Yp={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([{Type:1,Title:"申請表",Template:"../../Template/LIT/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/LIT/2-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/LIT/3-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/LIT/4-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"著作權授權同意書",Template:"../../Template/LIT/5-著作權授權同意書.docx",Files:[]},{Type:6,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),V=e.ref(),N=e.computed(()=>m.value.some(s=>!s.Optional&&!s.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("literacy",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(s.Multiple?a.Name:`${s.Title}.pdf`)})},k=U.download,E=_,u=()=>{rxjs.forkJoin([U.literacy("getAttachment",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=m.value.filter(y=>{var i;return!((i=y.Excludes)!=null&&i.includes(l.value.OrgCategory))}),m.value.forEach(y=>{y.Files=a.Attachments.filter(i=>i.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(i=>!i.Deleted).length)}),j().init("literacy",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},h=s=>{var y,i;if(o.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Attachments:m.value.reduce((n,c)=>n.concat(c.Files),[]),Before:(y=V.value)==null?void 0:y.Form5Before,After:(i=V.value)==null?void 0:i.Form5After,Submit:s?"true":"false"};U.literacy("saveAttachment",a).subscribe(()=>{s?E("next"):u()})},g=()=>{if(V.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(V.value,s))}return!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Bp,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",_p,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",Cp,[e.createElementVNode("table",Tp,[e.createElementVNode("thead",wp,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Dp,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",Sp,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[c.Optional?(e.openBlock(),e.createElementBlock("span",Ap,e.toDisplayString(c.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024))]),e.unref(r)&&c.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:c.Comment},null,8,Fp)):e.createCommentVNode("",!0),e.unref(r)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,Up)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Mp,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",Pp,"已上傳")):(e.openBlock(),e.createElementBlock("span",Ip,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(c.Multiple||!c.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>d(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",jp,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Op,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(k)(t.Path)},e.toDisplayString(t.Name),9,Lp),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Rp)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",qp,[e.createElementVNode("table",zp,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(V).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(V).Form5Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(V).Form5After,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form5After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",Gp,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=c=>h(!0)),disabled:e.unref(N),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,Jp)])):e.createCommentVNode("",!0)],64)}}},Qp={class:"block"},Wp={class:"mt-4"},Hp={class:"table-responsive mt-3 mb-0"},Xp={class:"table align-middle gray-table"},Kp={key:0,width:"1"},Zp={key:0},vp={class:"d-flex gap-2"},eV=["onClick"],tV={class:"table-responsive mt-3 mb-0"},lV={class:"table align-middle gray-table"},oV={class:"mt-4"},nV={class:"table align-middle gray-table side-table"},rV={key:0,class:"block-bottom bg-light-teal"},aV={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.computed(()=>z("literacy",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>m.value.filter(s=>!s.Deleted)),l=e.ref({}),d=()=>m.value.push({}),k=_,E=()=>{rxjs.forkJoin([U.literacy("getBenefit",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=a.Benefits,m.value.length||d(),j().init("literacy",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},u=s=>s.Deleted=!0,h=s=>{var y,i;if(r.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:m.value,Before:(y=V.value)==null?void 0:y.Form4Before,After:(i=V.value)==null?void 0:i.Form4After,Submit:s?"true":"false"};U.literacy("saveBenefit",a).subscribe(()=>{s?k("next"):E()})},g=()=>{let s={Benefit:"不可量化成果"};return r.value=P(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,y)=>Object.assign(r.value,P(a,s,`item-${y}-`))),V.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,P(V.value,s))),!Object.keys(r.value).length};return e.onMounted(E),e.provide("editable",N),(s,a)=>{const y=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Qp,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",Wp,[e.createElementVNode("div",Hp,[e.createElementVNode("table",Xp,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",Kp,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Title`],modelValue:c.Title,"onUpdate:modelValue":t=>c.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Target`],modelValue:c.Target,"onUpdate:modelValue":t=>c.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r)[`item-${f}-Description`],rows:"1",modelValue:c.Description,"onUpdate:modelValue":t=>c.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",Zp,[e.createElementVNode("div",vp,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>u(c),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,eV)):e.createCommentVNode("",!0),f+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",tV,[e.createElementVNode("table",lV,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(l).Benefit=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",oV,[e.createElementVNode("table",nV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(V).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form4Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(V).Form4After,"onUpdate:modelValue":a[2]||(a[2]=c=>e.unref(V).Form4After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",rV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=c=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},sV={class:"block"},dV={class:"mt-4"},cV={class:"table-responsive mt-3 mb-0"},iV={class:"table align-middle gray-table"},mV={class:"text-end"},pV={class:"text-end"},VV={class:"table-responsive"},fV={class:"table align-middle gray-table"},NV=["colspan"],EV={key:0,width:"1"},bV={class:"text-end"},gV={key:0},kV={class:"d-flex gap-2"},yV=["onClick"],uV={class:"mt-4"},xV={class:"table-responsive mt-3 mb-0"},hV={class:"table align-middle gray-table"},$V={key:0,width:"1"},BV={class:"text-end"},_V={key:0},CV={class:"d-flex gap-2"},TV=["onClick"],wV={class:"mt-4"},DV={class:"table align-middle gray-table side-table"},SV={key:0,class:"block-bottom bg-light-teal"},AV={class:"text-center"},FV={class:"mb-5"},UV={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("literacy",l.value.Status,3)),N=e.ref({}),r=e.computed(()=>k.value.filter(f=>!f.Deleted)),o=e.computed(()=>E.value.filter(f=>!f.Deleted)),l=e.ref({}),d=e.ref(),k=e.ref([]),E=e.ref([]),u=e.ref({}),h=e.ref(0),g=()=>k.value.push({}),s=()=>E.value.push({}),a=_,y=()=>{rxjs.forkJoin([U.literacy("getFunding",{ID:x.id})]).subscribe(f=>{const t=f[0];l.value=t.Project,k.value=t.OtherSubsidies,E.value=t.BudgetPlans,u.value=t.GrantTargetSetting,k.value.length||g(),E.value.length||s(),j().init("literacy",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=(f,t)=>{var b,w;if(N.value={},f&&!c()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>u.value.GrantLimit*1e4){d.value.show(()=>n(f,!0));return}const p={Project:l.value,OtherSubsidies:k.value,BudgetPlans:E.value,Before:(b=m.value)==null?void 0:b.Form3Before,After:(w=m.value)==null?void 0:w.Form3After,Submit:f?"true":"false"};U.literacy("saveFunding",p).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=P(l.value,f),f={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},k.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`other-${p}-`))),f={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`plan-${p}-`))),m.value&&(f={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,P(m.value,f))),!Object.keys(N.value).length};return e.onMounted(y),e.provide("editable",V),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((f,t)=>f+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(f=>f.percent=Math.round(q(f.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(f=>f.sum=q(f.Amount)+q(f.OtherAmount))}),(f,t)=>{var M;const p=e.resolveComponent("input-integer"),b=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),T=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",sV,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",dV,[e.createElementVNode("div",cV,[e.createElementVNode("table",iV,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",mV,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",pV,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",VV,[e.createElementVNode("table",fV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(V)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,NV)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",EV,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`other-${C}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":D=>A.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`other-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",bV,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`other-${C}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":D=>A.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",gV,[e.createElementVNode("div",kV,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,yV)):e.createCommentVNode("",!0),C+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",uV,[e.createElementVNode("div",xV,[e.createElementVNode("table",hV,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",$V,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`plan-${C}-Title`],modelValue:A.Title,"onUpdate:modelValue":D=>A.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":D=>A.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",BV,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`plan-${C}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":D=>A.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",_V,[e.createElementVNode("div",CV,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,TV)):e.createCommentVNode("",!0),C+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",wV,[e.createElementVNode("table",DV,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(m).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(m).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(m).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(m).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",SV,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",AV,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",FV,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(u).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},MV={class:"block"},PV={class:"square-title"},IV={class:"text-teal fw-bold py-3"},jV={class:"table-responsive mb-0"},OV={class:"table align-middle gray-table"},LV={class:"text-end"},RV={class:"text-teal fw-bold pb-3"},qV={class:"text-teal fw-bold pb-3"},zV={class:"mt-4"},GV={class:"table align-middle gray-table"},JV={class:"text-center"},YV={key:0,width:"180"},QV={class:"text-center"},WV=["href"],HV={key:0,class:"text-center"},XV={key:0},KV={key:1,class:"text-pink"},ZV={key:1,class:"tag-group mt-2 gap-1"},vV={key:0,class:"tag tag-green-light"},ef=["download","href"],tf=["onClick"],lf={class:"block-bottom bg-light-teal"},of=["disabled"],nf={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.computed(()=>l.value.some(g=>!g.Files.filter(s=>!s.Deleted).length)),V=e.computed(()=>!r.value||r.value.Status==="請款中"),N=e.computed(()=>{var g;return((g=r.value)==null?void 0:g.Status)==="通過"}),r=e.ref(),o=e.ref({}),l=e.ref([{Type:11,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]}]),d=(g,s)=>{s.Type==="application/pdf"&&g.Files.push({Type:g.Type,Path:s.Path,Name:`${o.value.ProjectID}_請款_${g.Title}.pdf`})},k=U.download,E=_,u=()=>{U.literacy("getPayment",{ID:x.id}).subscribe(g=>{o.value=g.Project,j().init("literacy",o.value),l.value=l.value.filter(s=>{var a;return!((a=s.Excludes)!=null&&a.includes(o.value.OrgCategory))}),l.value.forEach(s=>{s.Files=g.Attachments.filter(a=>a.Type===s.Type),s.Uploaded=e.computed(()=>s.Files.filter(a=>!a.Deleted).length)}),r.value=g.Payments.find(s=>s.Stage===1),Y().init(r.value)})},h=g=>{const s={Payment:{ProjectID:x.id,Stage:1,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,CurrentRequestAmount:o.value.ApprovedAmount},Attachments:l.value.reduce((a,y)=>a.concat(y.Files),[]),Submit:g?"true":"false"};U.literacy("savePayment",s).subscribe(()=>{g?E("next"):u()})};return e.onMounted(u),e.provide("editable",V),(g,s)=>{var i;const a=e.resolveComponent("required-label"),y=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",MV,[e.createElementVNode("h5",PV,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",IV,"核定經費: "+e.toDisplayString((i=e.unref(o).ApprovedAmount)==null?void 0:i.toLocaleString())+"元",1),e.createElementVNode("div",jV,[e.createElementVNode("table",OV,[s[6]||(s[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",LV,e.toDisplayString(e.unref(o).ApprovedAmount),1),s[2]||(s[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[3]||(s[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[4]||(s[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),s[5]||(s[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(N)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",RV,"本期實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",qV,"累積實際撥款: "+e.toDisplayString(e.unref(r).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),s[12]||(s[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),s[13]||(s[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",zV,[e.createElementVNode("table",GV,[e.createElementVNode("thead",JV,[e.createElementVNode("tr",null,[s[7]||(s[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),s[8]||(s[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",YV,"狀態")):e.createCommentVNode("",!0),s[9]||(s[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(n,c)=>(e.openBlock(),e.createElementBlock("tr",{key:n},[e.createElementVNode("td",QV,e.toDisplayString(c+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(n.Title),1)]),_:2},1024)]),e.unref(V)&&n.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:n.Template,style:{width:"140px"},type:"button"},[...s[10]||(s[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,WV)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",HV,[n.Uploaded?(e.openBlock(),e.createElementBlock("span",XV,"已上傳")):(e.openBlock(),e.createElementBlock("span",KV,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(V)&&!n.Uploaded?(e.openBlock(),e.createBlock(y,{key:0,accept:".pdf",onFile:f=>d(n,f)},null,8,["onFile"])):e.createCommentVNode("",!0),n.Uploaded?(e.openBlock(),e.createElementBlock("div",ZV,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.Files,f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",vV,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(k)(f.Path)},e.toDisplayString(f.Name),9,ef),e.unref(V)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:t=>f.Deleted=!0,type:"button"},[...s[11]||(s[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,tf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",lf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:s[0]||(s[0]=n=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:s[1]||(s[1]=n=>h(!0)),disabled:e.unref(m),type:"button"},[...s[14]||(s[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,of)])],64)}}},rf={class:"block"},af={class:"square-title"},sf={class:"text-teal fw-bold py-3"},df={class:"text-teal fw-bold pb-3"},cf={class:"table-responsive"},mf={class:"table align-middle gray-table"},pf={class:"text-end"},Vf={class:"text-end"},ff={class:"text-end"},Nf={class:"mt-4"},Ef={class:"table align-middle gray-table"},bf={class:"text-center"},gf={key:0,width:"180"},kf={class:"text-center"},yf=["href"],uf={key:0,class:"text-center"},xf={key:0},hf={key:1,class:"text-pink"},$f={key:1,class:"tag-group mt-2 gap-1"},Bf={key:0,class:"tag tag-green-light"},_f=["download","href"],Cf=["onClick"],Tf={class:"block-bottom bg-light-teal"},wf=["disabled"],Df={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>m.value<=0||u.value.some(i=>!i.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.ref(0),o=e.ref(),l=e.ref(0),d=e.ref({}),k=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(m.value*100/d.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.min(Math.round(m.value*100/l.value*100)/100,100):0),u=e.ref([{Type:21,Title:"領據",Template:"../../Template/LIT/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/LIT/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/LIT/3-經費分攤表.docx",Files:[]},{Type:24,Title:"補助清單",Template:"../../Template/LIT/4-補助清單.docx",Files:[]}]),h=(i,n)=>{n.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:n.Path,Name:`${d.value.ProjectID}_結案核銷_${i.Title}.pdf`})},g=U.download,s=_,a=()=>{U.literacy("getPayment",{ID:x.id}).subscribe(i=>{d.value=i.Project,j().init("literacy",d.value),u.value=u.value.filter(n=>{var c;return!((c=n.Excludes)!=null&&c.includes(d.value.OrgCategory))}),u.value.forEach(n=>{n.Files=i.Attachments.filter(c=>c.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(c=>!c.Deleted).length)}),o.value=i.Payments.find(n=>n.Stage===2),o.value&&(m.value=o.value.TotalSpentAmount),l.value=i.Payments.filter(n=>n.Stage<2&&n.Status==="通過").reduce((n,c)=>n+c.CurrentActualPaidAmount,0),r.value=l.value,Y().init(o.value,l.value)})},y=i=>{const n={Payment:{ProjectID:x.id,Stage:2,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:u.value.reduce((c,f)=>c.concat(f.Files),[]),Submit:i?"true":"false"};U.literacy("savePayment",n).subscribe(()=>{i?s("next"):a()})};return e.onMounted(a),e.provide("editable",N),(i,n)=>{var p;const c=e.resolveComponent("input-integer"),f=e.resolveComponent("required-label"),t=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",rf,[e.createElementVNode("h5",af,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",sf,"核定經費: "+e.toDisplayString((p=e.unref(d).ApprovedAmount)==null?void 0:p.toLocaleString())+"元",1),e.createElementVNode("p",df,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(m)).toLocaleString())+"元",1),e.createElementVNode("div",cf,[e.createElementVNode("table",mf,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",pf,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(c,{max:e.unref(r),modelValue:e.unref(m),"onUpdate:modelValue":n[0]||(n[0]=b=>e.isRef(m)?m.value=b:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",Vf,e.toDisplayString(e.unref(k))+"%",1),e.createElementVNode("td",ff,e.toDisplayString(e.unref(E))+"%",1)])])])]),n[10]||(n[10]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[11]||(n[11]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",Nf,[e.createElementVNode("table",Ef,[e.createElementVNode("thead",bf,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",gf,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(b,w)=>(e.openBlock(),e.createElementBlock("tr",{key:b},[e.createElementVNode("td",kf,e.toDisplayString(w+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(b.Title),1)]),_:2},1024)]),e.unref(N)&&b.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:b.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,yf)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",uf,[b.Uploaded?(e.openBlock(),e.createElementBlock("span",xf,"已上傳")):(e.openBlock(),e.createElementBlock("span",hf,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!b.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:T=>h(b,T)},null,8,["onFile"])):e.createCommentVNode("",!0),b.Uploaded?(e.openBlock(),e.createElementBlock("div",$f,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.Files,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T},[T.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",Bf,[e.createElementVNode("a",{class:"tag-link my-1",download:T.Name,href:e.unref(g)(T.Path)},e.toDisplayString(T.Name),9,_f),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:S=>T.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Cf)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",Tf,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=b=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=b=>y(!0)),disabled:e.unref(V),type:"button"},[...n[12]||(n[12]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,wf)])],64)}}},Sf={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(x,m)=>{const V=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(V,{steps:_,type:"literacy"})}}},Af={class:"block"},Ff={class:"mt-4"},Uf={class:"table align-middle gray-table side-table"},Mf={key:0,class:"d-flex align-items-center gap-2"},Pf={class:"input-group w-auto"},If={class:"text-teal-dark"},jf={key:1,class:"invalid mt-0"},Of={class:"table-responsive mt-4"},Lf={class:"table align-middle gray-table"},Rf={key:0},qf={class:"input-group"},zf={key:0,class:"invalid mt-0"},Gf={key:0},Jf={class:"d-flex gap-2"},Yf=["onClick"],Qf={class:"mt-4"},Wf={class:"table align-middle gray-table"},Hf={key:0},Xf=["value"],Kf={key:0},Zf={class:"d-flex gap-2"},vf=["onClick"],eN={class:"mt-4"},tN={class:"table align-middle gray-table side-table"},lN={key:0,class:"block-bottom bg-light-teal"},oN={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=[{value:1,text:"50%"},{value:2,text:"100%"}],V=e.ref(),N=e.computed(()=>E.value.EndDate),r=e.computed(()=>z("literacy",k.value.Status,2)),o=e.ref({}),l=e.computed(()=>u.value.filter(f=>!f.Deleted)),d=e.computed(()=>h.value.filter(f=>!f.Deleted)),k=e.ref({}),E=e.ref({}),u=e.ref([]),h=e.ref([]),g=()=>U.literacy("createItem",{ID:x.id}).subscribe(f=>u.value.push(f)),s=()=>h.value.push({Type:0,ItemID:0}),a=_,y=()=>{rxjs.forkJoin([U.literacy("getWorkSchedule",{ID:x.id})]).subscribe(f=>{const t=f[0];k.value=t.Project,E.value=t.GrantType,u.value=t.Items,h.value=t.Schedules,u.value.length||g(),h.value.length||s(),j().init("literacy",k.value),V.value=k.value.changeApply,k.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=f=>{var p,b;if(o.value={},f&&!c()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:k.value,Items:u.value,Schedules:h.value,Before:(p=V.value)==null?void 0:p.Form2Before,After:(b=V.value)==null?void 0:b.Form2After,Submit:f?"true":"false"};U.literacy("saveWorkSchedule",t).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(k.value,f),f={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`item-${p}-`))),f={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`schedule-${p}-`))),V.value&&(f={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(V.value,f))),!Object.keys(o.value).length};return e.onMounted(y),e.provide("editable",r),(f,t)=>{const p=e.resolveComponent("required-label"),b=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),T=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Af,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",Ff,[e.createElementVNode("table",Uf,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",Mf,[e.createElementVNode("div",Pf,[e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).StartTime,"onUpdate:modelValue":t[0]||(t[0]=C=>e.unref(k).StartTime=C)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).EndTime,"onUpdate:modelValue":t[1]||(t[1]=C=>e.unref(k).EndTime=C)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",If,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(N)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",jf,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",Of,[e.createElementVNode("table",Lf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Rf,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`item-${D}-Title`],modelValue:C.Title,"onUpdate:modelValue":F=>C.Title=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",qf,[e.createVNode(S,{"empty-value":0,modelValue:C.Begin,"onUpdate:modelValue":F=>C.Begin=F},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:C.End,"onUpdate:modelValue":F=>C.End=F},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",zf,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Gf,[e.createElementVNode("div",Jf,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Yf)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Qf,[e.createElementVNode("table",Wf,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Hf,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:m,modelValue:C.Type,"onUpdate:modelValue":F=>C.Type=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:C.ItemID,"onUpdate:modelValue":F=>C.ItemID=F,modelModifiers:{trim:!0}},{default:e.withCtx(({index:F,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+F))+"."+e.toDisplayString(I.Title),9,Xf)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Kf,[e.createElementVNode("div",Zf,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,vf)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",eN,[e.createElementVNode("table",tN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(V).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=C=>e.unref(V).Form2Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(V).Form2After,"onUpdate:modelValue":t[3]||(t[3]=C=>e.unref(V).Form2After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",lN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=C=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=C=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},nN={class:"block"},rN={class:"mt-4"},aN={class:"table align-middle gray-table side-table"},sN={key:0},dN={key:1,class:"text-light-gray"},cN={class:"mt-4"},iN={class:"table align-middle gray-table side-table"},mN={class:"row g-3"},pN={class:"col-12 col-xl-2"},VN={class:"text-gray mb-2"},fN={class:"col-12 col-xl-3"},NN={class:"text-gray mb-2"},EN={class:"col-12 col-xl-4"},bN={class:"row g-1"},gN={class:"col-7"},kN={class:"col-5"},yN={class:"col-12 col-xl-3"},uN={class:"text-gray mb-2"},xN={class:"col-12"},hN={class:"text-gray mb-2"},$N={class:"mt-4"},BN={class:"table align-middle gray-table side-table"},_N={class:"mt-4"},CN={class:"table align-middle gray-table side-table"},TN={key:0,class:"table-responsive mt-3 mb-0"},wN={class:"table align-middle gray-table"},DN={key:0},SN={key:0},AN={class:"d-flex gap-2"},FN=["onClick"],UN={class:"mt-4"},MN={class:"table align-middle gray-table side-table"},PN={key:0,class:"block-bottom bg-light-teal"},IN={__name:"Application",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.ref(),r=e.computed(()=>z("multiple",k.value.Status,1)),o=e.ref({}),l=e.ref([]),d=e.computed(()=>E.value.filter(n=>!n.Deleted)),k=e.ref({}),E=e.ref([]),u=e.computed({get:()=>!!d.value.length,set:n=>{n?h():E.value.forEach(c=>c.Deleted=!0)}}),h=()=>E.value.push({}),g=_,s=()=>{U.multiple("getApplication",{ID:x.id}).subscribe(n=>{k.value=n.Project,N.value=n.Contacts,E.value=n.ReceivedSubsidies,k.value.OrgCategory=k.value.OrgCategory||null,j().init("multiple",k.value),V.value=k.value.changeApply,k.value.changeApply=void 0})},a=n=>n.Deleted=!0,y=n=>{var f,t;if(o.value={},n&&!i()){e.nextTick(()=>{var p;return(p=document.querySelector(".invalid"))==null?void 0:p.scrollIntoView({behavior:"smooth",block:"center"})});return}const c={Project:k.value,Contacts:N.value,ReceivedSubsidies:E.value.filter(p=>p.ID||!p.Deleted),Before:(f=V.value)==null?void 0:f.Form1Before,After:(t=V.value)==null?void 0:t.Form1After,Submit:n?"true":"false"};U.multiple("saveApplication",c).subscribe(p=>{n?g("next",p.ID):k.value.ID?s():window.location.href=`Application.aspx?ID=${p.ID}`})},i=()=>{let n={ProjectName:"計畫名稱",Field:"計畫類別",OrgName:"申請單位",OrgCategory:"申請單位類別",TaxID:"統一編號",Address:"立案聯絡地址",Target:"計畫目標",Summary:"計畫內容概要",Quantified:"預期效益(量化)",Qualitative:"預期效益(質化)"};return o.value=P(k.value,n),n={Name:"姓名",JobTitle:"職稱",MobilePhone:"手機號碼",EMail:"電子郵件"},N.value.forEach((c,f)=>Object.assign(o.value,P(c,n,`contact-${f}-`))),n={Name:"計畫名稱",Unit:"補助單位",Amount:{presence:{allowEmpty:!1,message:"^請輸入補助金額"},numericality:{greaterThan:0,message:"^補助金額不可為 0"}}},E.value.forEach((c,f)=>Object.assign(o.value,P(c,n,`received-${f}-`))),V.value&&(n={Form1Before:"變更前說明",Form1After:"變更後說明"},Object.assign(o.value,P(V.value,n))),!Object.keys(o.value).length};return e.onMounted(()=>{rxjs.forkJoin([U.multiple("getZgsCodes",{CodeGroup:"MULField"}),U.multiple("getZgsCodes",{CodeGroup:"MULOrgCategory"})]).subscribe(n=>{l.value=n[0],m.value=n[1],x.id?s():U.multiple("getEmptyApplication").subscribe(c=>{k.value=Object.assign({Field:null,OrgCategory:null,FormStep:1,Status:1},c),N.value=[{Role:"負責人"},{Role:"聯絡人"}],j().init("multiple",k.value)})})}),e.provide("editable",r),(n,c)=>{const f=e.resolveComponent("required-label"),t=e.resolveComponent("input-text"),p=e.resolveComponent("input-select"),b=e.resolveComponent("input-textarea"),w=e.resolveComponent("input-boolean"),T=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",nN,[c[43]||(c[43]=e.createElementVNode("h5",{class:"square-title"},"基本資料",-1)),e.createElementVNode("div",rN,[e.createElementVNode("table",aN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[15]||(c[15]=e.createElementVNode("th",null,"年度",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(k).Year),1)]),e.createElementVNode("tr",null,[c[16]||(c[16]=e.createElementVNode("th",null,"計畫編號",-1)),e.createElementVNode("td",null,[e.unref(k).ProjectID?(e.openBlock(),e.createElementBlock("span",sN,e.toDisplayString(e.unref(k).ProjectID),1)):(e.openBlock(),e.createElementBlock("span",dN,"儲存後由系統自動產生"))])]),e.createElementVNode("tr",null,[c[17]||(c[17]=e.createElementVNode("th",null,"補助計畫類別",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(k).SubsidyPlanType),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[18]||(c[18]=[e.createTextVNode("計畫名稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).ProjectName,modelValue:e.unref(k).ProjectName,"onUpdate:modelValue":c[0]||(c[0]=S=>e.unref(k).ProjectName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[19]||(c[19]=[e.createTextVNode("計畫類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{"empty-value":null,error:e.unref(o).Field,options:e.unref(l),"text-name":"Descname","value-name":"Code",modelValue:e.unref(k).Field,"onUpdate:modelValue":c[1]||(c[1]=S=>e.unref(k).Field=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[20]||(c[20]=[e.createTextVNode("申請單位",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).OrgName,placeholder:"請輸入名稱",modelValue:e.unref(k).OrgName,"onUpdate:modelValue":c[2]||(c[2]=S=>e.unref(k).OrgName=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[21]||(c[21]=[e.createTextVNode("申請單位類別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{"empty-value":null,error:e.unref(o).OrgCategory,options:e.unref(m),"text-name":"Descname","value-name":"Code",modelValue:e.unref(k).OrgCategory,"onUpdate:modelValue":c[3]||(c[3]=S=>e.unref(k).OrgCategory=S)},null,8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[22]||(c[22]=[e.createTextVNode("統一編號",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(稅籍)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).TaxID,"max-length":8,modelValue:e.unref(k).TaxID,"onUpdate:modelValue":c[4]||(c[4]=S=>e.unref(k).TaxID=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[23]||(c[23]=[e.createTextVNode("立案聯絡地址",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o).Address,placeholder:"請輸入地址",modelValue:e.unref(k).Address,"onUpdate:modelValue":c[5]||(c[5]=S=>e.unref(k).Address=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),c[44]||(c[44]=e.createElementVNode("h5",{class:"square-title mt-5"},"人員聯絡資訊",-1)),e.createElementVNode("div",cN,[e.createElementVNode("table",iN,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(S,M)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(S.Role),1)]),_:2},1024)]),e.createElementVNode("td",null,[e.createElementVNode("div",mN,[e.createElementVNode("div",pN,[e.createElementVNode("div",VN,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[24]||(c[24]=[e.createTextVNode("姓名",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-Name`],modelValue:S.Name,"onUpdate:modelValue":A=>S.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",fN,[e.createElementVNode("div",NN,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[25]||(c[25]=[e.createTextVNode("職稱",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-JobTitle`],modelValue:S.JobTitle,"onUpdate:modelValue":A=>S.JobTitle=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",EN,[c[26]||(c[26]=e.createElementVNode("div",{class:"text-gray mb-2"},"電話(分機)",-1)),e.createElementVNode("div",bN,[e.createElementVNode("div",gN,[e.createVNode(t,{modelValue:S.Phone,"onUpdate:modelValue":A=>S.Phone=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",kN,[e.createVNode(t,{placeholder:"請輸入分機",size:"4",modelValue:S.PhoneExt,"onUpdate:modelValue":A=>S.PhoneExt=A,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])])]),e.createElementVNode("div",yN,[e.createElementVNode("div",uN,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[27]||(c[27]=[e.createTextVNode("手機號碼",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-MobilePhone`],modelValue:S.MobilePhone,"onUpdate:modelValue":A=>S.MobilePhone=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("div",xN,[e.createElementVNode("div",hN,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[28]||(c[28]=[e.createTextVNode("電子郵件",-1)])]),_:1})]),e.createVNode(t,{error:e.unref(o)[`contact-${M}-EMail`],modelValue:S.EMail,"onUpdate:modelValue":A=>S.EMail=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])])])])]))),128))])])]),c[45]||(c[45]=e.createElementVNode("h5",{class:"square-title mt-5"},"計畫內容",-1)),e.createElementVNode("div",$N,[e.createElementVNode("table",BN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[29]||(c[29]=[e.createTextVNode("計畫目標",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[c[30]||(c[30]=e.createElementVNode("div",{class:"fs-14 mb-2"},"對海洋文化發展、推廣或傳承之期待，包含落實海洋基本法、2020國家海洋政策白皮書與臺灣永續發展目標",-1)),e.createVNode(b,{error:e.unref(o).Target,"max-length":500,placeholder:"請輸入計畫目標",rows:"4",modelValue:e.unref(k).Target,"onUpdate:modelValue":c[6]||(c[6]=S=>e.unref(k).Target=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[31]||(c[31]=[e.createTextVNode("計畫內容概要",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Summary,"max-length":500,placeholder:"請輸入計畫內容概要",rows:"4",modelValue:e.unref(k).Summary,"onUpdate:modelValue":c[7]||(c[7]=S=>e.unref(k).Summary=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[32]||(c[32]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(量化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Quantified,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(k).Quantified,"onUpdate:modelValue":c[8]||(c[8]=S=>e.unref(k).Quantified=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[33]||(c[33]=[e.createTextVNode("預期效益",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(質化)(條列式)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Qualitative,"max-length":250,placeholder:"請輸入預期效益",rows:"4",modelValue:e.unref(k).Qualitative,"onUpdate:modelValue":c[9]||(c[9]=S=>e.unref(k).Qualitative=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])]),e.createElementVNode("div",_N,[e.createElementVNode("table",CN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[c[39]||(c[39]=e.createElementVNode("th",null,"最近三年曾獲本會及所屬補助／合作計畫及經費",-1)),e.createElementVNode("td",null,[e.createVNode(w,{modelValue:e.unref(u),"onUpdate:modelValue":c[10]||(c[10]=S=>e.isRef(u)?u.value=S:null)},null,8,["modelValue"]),e.unref(u)?(e.openBlock(),e.createElementBlock("div",TN,[e.createElementVNode("table",wN,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[c[34]||(c[34]=e.createElementVNode("th",null,"計畫名稱",-1)),c[35]||(c[35]=e.createElementVNode("th",null,"補助單位",-1)),c[36]||(c[36]=e.createElementVNode("th",{class:"text-end"},"補助金額",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",DN,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(S,M)=>(e.openBlock(),e.createElementBlock("tr",{key:S},[e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${M}-Name`],modelValue:S.Name,"onUpdate:modelValue":A=>S.Name=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(o)[`received-${M}-Unit`],modelValue:S.Unit,"onUpdate:modelValue":A=>S.Unit=A,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`received-${M}-Amount`],modelValue:S.Amount,"onUpdate:modelValue":A=>S.Amount=A},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",SN,[e.createElementVNode("div",AN,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:A=>a(S),type:"button"},[...c[37]||(c[37]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,FN)):e.createCommentVNode("",!0),M+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:h,type:"button"},[...c[38]||(c[38]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])):e.createCommentVNode("",!0)])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[c[42]||(c[42]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",UN,[e.createElementVNode("table",MN,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[40]||(c[40]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Form1Before,rows:"4",modelValue:e.unref(V).Form1Before,"onUpdate:modelValue":c[11]||(c[11]=S=>e.unref(V).Form1Before=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...c[41]||(c[41]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o).Form1After,rows:"4",modelValue:e.unref(V).Form1After,"onUpdate:modelValue":c[12]||(c[12]=S=>e.unref(V).Form1After=S),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",PN,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:c[13]||(c[13]=S=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:c[14]||(c[14]=S=>y(!0)),type:"button"},[...c[46]||(c[46]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},jN={class:"block"},ON={key:0,class:"text-pink lh-base mt-4"},LN={class:"mt-4"},RN={class:"table align-middle gray-table"},qN={class:"text-center"},zN={key:0,width:"180"},GN={class:"text-center"},JN={key:0},YN=["innerHTML"],QN=["href"],WN={key:0,class:"text-center"},HN={key:0},XN={key:1,class:"text-pink"},KN={key:1,class:"tag-group mt-2 gap-1"},ZN={key:0,class:"tag tag-green-light"},vN=["download","href"],e1=["onClick"],t1={class:"mt-4"},l1={class:"table align-middle gray-table side-table"},o1={key:0,class:"block-bottom bg-light-teal"},n1=["disabled"],r1={__name:"Attachment",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([{Type:1,Title:"申請表",Template:"../../Template/MUL/1-申請表.docx",Files:[]},{Type:2,Title:"計畫書",Template:"../../Template/MUL/2-計畫書.docx",Files:[]},{Type:3,Title:"執行承諾書",Template:"../../Template/MUL/3-執行承諾書.docx",Files:[]},{Type:4,Title:"未違反公職人員利益衝突迴避法切結書及事前揭露表",Template:"../../Template/MUL/4-未違反公職人員利益衝突迴避法切結書及事前揭露表.docx",Files:[]},{Type:5,Title:"其他佐證資料",Comment:"提案計畫倘有結合其他合作單位、團體或相關機關(構)，請提供合作意向書或相關參考文件尤佳，無則免附",Files:[],Multiple:!0,Optional:!0}]),V=e.ref(),N=e.computed(()=>m.value.some(s=>!s.Optional&&!s.Files.filter(a=>!a.Deleted).length)),r=e.computed(()=>z("multiple",l.value.Status,2)),o=e.ref({}),l=e.ref({}),d=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:l.value.ProjectID+"_"+(s.Multiple?a.Name:`${s.Title}.pdf`)})},k=U.download,E=_,u=()=>{rxjs.forkJoin([U.multiple("getAttachment",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=m.value.filter(y=>{var i;return!((i=y.Excludes)!=null&&i.includes(l.value.OrgCategory))}),l.value.Status>=42&&m.value.push({Type:6,Title:"著作權授權同意書",Template:"../../Template/MUL/6-著作權授權同意書.docx",Files:[]}),m.value.forEach(y=>{y.Files=a.Attachments.filter(i=>i.Type===y.Type),y.Uploaded=e.computed(()=>y.Files.filter(i=>!i.Deleted).length)}),j().init("multiple",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},h=s=>{var y,i;if(o.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={ID:x.id,Attachments:m.value.reduce((n,c)=>n.concat(c.Files),[]),Before:(y=V.value)==null?void 0:y.Form5Before,After:(i=V.value)==null?void 0:i.Form5After,Submit:s?"true":"false"};U.multiple("saveAttachment",a).subscribe(()=>{s?E("next"):u()})},g=()=>{if(V.value){const s={Form5Before:"變更前說明",Form5After:"變更後說明"};Object.assign(o.value,P(V.value,s))}return!Object.keys(o.value).length};return e.onMounted(u),e.provide("editable",r),(s,a)=>{const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file"),n=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",jN,[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title"},"請下載範本填寫用印並上傳",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("p",ON,[...a[4]||(a[4]=[e.createTextVNode(" 請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF格式上傳，每個檔案10MB以內）",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode(" 計畫書請自行留存送審版電子檔，待決審核定經費後請提交修正計畫書以供核定。 ",-1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",LN,[e.createElementVNode("table",RN,[e.createElementVNode("thead",qN,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",zN,"狀態")):e.createCommentVNode("",!0),a[7]||(a[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",GN,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[c.Optional?(e.openBlock(),e.createElementBlock("span",JN,e.toDisplayString(c.Title),1)):(e.openBlock(),e.createBlock(y,{key:1},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024))]),e.unref(r)&&c.Comment?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mt-3 small",innerHTML:c.Comment},null,8,YN)):e.createCommentVNode("",!0),e.unref(r)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:1,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,QN)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",WN,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",HN,"已上傳")):(e.openBlock(),e.createElementBlock("span",XN,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&(c.Multiple||!c.Uploaded)?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>d(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",KN,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ZN,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(k)(t.Path)},e.toDisplayString(t.Name),9,vN),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,e1)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",t1,[e.createElementVNode("table",l1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[10]||(a[10]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5Before,rows:"4",modelValue:e.unref(V).Form5Before,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(V).Form5Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(y,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(o).Form5After,rows:"4",modelValue:e.unref(V).Form5After,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form5After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",o1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[2]||(a[2]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[3]||(a[3]=c=>h(!0)),disabled:e.unref(N),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("全部完成，提送申請",-1)])],8,n1)])):e.createCommentVNode("",!0)],64)}}},a1={class:"block"},s1={class:"mt-4"},d1={class:"table-responsive mt-3 mb-0"},c1={class:"table align-middle gray-table"},i1={key:0,width:"1"},m1={key:0},p1={class:"d-flex gap-2"},V1=["onClick"],f1={class:"table-responsive mt-3 mb-0"},N1={class:"table align-middle gray-table"},E1={class:"mt-4"},b1={class:"table align-middle gray-table side-table"},g1={key:0,class:"block-bottom bg-light-teal"},k1={__name:"Benefit",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=e.ref(),N=e.computed(()=>z("multiple",l.value.Status,4)),r=e.ref({}),o=e.computed(()=>m.value.filter(s=>!s.Deleted)),l=e.ref({}),d=()=>m.value.push({}),k=_,E=()=>{rxjs.forkJoin([U.multiple("getBenefit",{ID:x.id})]).subscribe(s=>{const a=s[0];l.value=a.Project,m.value=a.Benefits,m.value.length||d(),j().init("multiple",l.value),V.value=l.value.changeApply,l.value.changeApply=void 0})},u=s=>s.Deleted=!0,h=s=>{var y,i;if(r.value={},s&&!g()){e.nextTick(()=>{var n;return(n=document.querySelector(".invalid"))==null?void 0:n.scrollIntoView({behavior:"smooth",block:"center"})});return}const a={Project:l.value,Benefits:m.value,Before:(y=V.value)==null?void 0:y.Form4Before,After:(i=V.value)==null?void 0:i.Form4After,Submit:s?"true":"false"};U.multiple("saveBenefit",a).subscribe(()=>{s?k("next"):E()})},g=()=>{let s={Benefit:"不可量化成果"};return r.value=P(l.value,s),s={Title:"指標",Target:"目標值",Description:"說明"},o.value.forEach((a,y)=>Object.assign(r.value,P(a,s,`item-${y}-`))),V.value&&(s={Form4Before:"變更前說明",Form4After:"變更後說明"},Object.assign(r.value,P(V.value,s))),!Object.keys(r.value).length};return e.onMounted(E),e.provide("editable",N),(s,a)=>{const y=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea"),n=e.resolveComponent("required-label");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",a1,[a[14]||(a[14]=e.createElementVNode("h5",{class:"square-title"},"成果目標與效益",-1)),e.createElementVNode("div",s1,[e.createElementVNode("div",d1,[e.createElementVNode("table",c1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[a[5]||(a[5]=e.createElementVNode("th",null,"可量化成果－指標",-1)),a[6]||(a[6]=e.createElementVNode("th",null,"目標值",-1)),a[7]||(a[7]=e.createElementVNode("th",null,"說明",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",i1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Title`],modelValue:c.Title,"onUpdate:modelValue":t=>c.Title=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(r)[`item-${f}-Target`],modelValue:c.Target,"onUpdate:modelValue":t=>c.Target=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r)[`item-${f}-Description`],rows:"1",modelValue:c.Description,"onUpdate:modelValue":t=>c.Description=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",m1,[e.createElementVNode("div",p1,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:t=>u(c),type:"button"},[...a[8]||(a[8]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,V1)):e.createCommentVNode("",!0),f+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:d,type:"button"},[...a[9]||(a[9]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.createElementVNode("div",f1,[e.createElementVNode("table",N1,[a[10]||(a[10]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"不可量化成果")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Benefit,rows:"4",modelValue:e.unref(l).Benefit,"onUpdate:modelValue":a[0]||(a[0]=c=>e.unref(l).Benefit=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a[13]||(a[13]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",E1,[e.createElementVNode("table",b1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[11]||(a[11]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4Before,rows:"4",modelValue:e.unref(V).Form4Before,"onUpdate:modelValue":a[1]||(a[1]=c=>e.unref(V).Form4Before=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...a[12]||(a[12]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(i,{error:e.unref(r).Form4After,rows:"4",modelValue:e.unref(V).Form4After,"onUpdate:modelValue":a[2]||(a[2]=c=>e.unref(V).Form4After=c),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("div",g1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[3]||(a[3]=c=>h()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[4]||(a[4]=c=>h(!0)),type:"button"},[...a[15]||(a[15]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},y1={class:"block"},u1={class:"mt-4"},x1={class:"table-responsive mt-3 mb-0"},h1={class:"table align-middle gray-table"},$1={class:"text-end"},B1={class:"text-end"},_1={class:"table-responsive"},C1={class:"table align-middle gray-table"},T1=["colspan"],w1={key:0,width:"1"},D1={class:"text-end"},S1={key:0},A1={class:"d-flex gap-2"},F1=["onClick"],U1={class:"mt-4"},M1={class:"table-responsive mt-3 mb-0"},P1={class:"table align-middle gray-table"},I1={key:0,width:"1"},j1={class:"text-end"},O1={key:0},L1={class:"d-flex gap-2"},R1=["onClick"],q1={class:"mt-4"},z1={class:"table align-middle gray-table side-table"},G1={key:0,class:"block-bottom bg-light-teal"},J1={class:"text-center"},Y1={class:"mb-5"},Q1={__name:"Funding",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(),V=e.computed(()=>z("multiple",l.value.Status,3)),N=e.ref({}),r=e.computed(()=>k.value.filter(f=>!f.Deleted)),o=e.computed(()=>E.value.filter(f=>!f.Deleted)),l=e.ref({}),d=e.ref(),k=e.ref([]),E=e.ref([]),u=e.ref({}),h=e.ref(0),g=()=>k.value.push({}),s=()=>E.value.push({}),a=_,y=()=>{rxjs.forkJoin([U.multiple("getFunding",{ID:x.id})]).subscribe(f=>{const t=f[0];l.value=t.Project,k.value=t.OtherSubsidies,E.value=t.BudgetPlans,u.value=t.GrantTargetSetting,k.value.length||g(),E.value.length||s(),j().init("multiple",l.value),m.value=l.value.changeApply,l.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=(f,t)=>{var b,w;if(N.value={},f&&!c()){e.nextTick(()=>{var T;return(T=document.querySelector(".invalid"))==null?void 0:T.scrollIntoView({behavior:"smooth",block:"center"})});return}if(!t&&l.value.ApplyAmount>u.value.GrantLimit*1e4){d.value.show(()=>n(f,!0));return}const p={Project:l.value,OtherSubsidies:k.value,BudgetPlans:E.value,Before:(b=m.value)==null?void 0:b.Form3Before,After:(w=m.value)==null?void 0:w.Form3After,Submit:f?"true":"false"};U.multiple("saveFunding",p).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={ApplyAmount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},SelfAmount:"自籌款"};return N.value=P(l.value,f),f={Unit:"單位名稱",Amount:{presence:{allowEmpty:!1,message:"^請輸入申請金額"},numericality:{greaterThan:0,message:"^申請金額不可為 0"}},Content:"申請合作項目"},k.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`other-${p}-`))),f={Title:"預算項目",Amount:"海委會經費",OtherAmount:"其他經費",Description:"計算方式及說明"},E.value.forEach((t,p)=>Object.assign(N.value,P(t,f,`plan-${p}-`))),m.value&&(f={Form3Before:"變更前說明",Form3After:"變更後說明"},Object.assign(N.value,P(m.value,f))),!Object.keys(N.value).length};return e.onMounted(y),e.provide("editable",V),e.watchEffect(()=>{l.value.OtherAmount=r.value.reduce((f,t)=>f+q(t.Amount),0),h.value=q(l.value.ApplyAmount)+q(l.value.SelfAmount)+q(l.value.OtherAmount),r.value.forEach(f=>f.percent=Math.round(q(f.Amount)/l.value.OtherAmount*1e4)/100),E.value.forEach(f=>f.sum=q(f.Amount)+q(f.OtherAmount))}),(f,t)=>{var M;const p=e.resolveComponent("input-integer"),b=e.resolveComponent("input-text"),w=e.resolveComponent("input-textarea"),T=e.resolveComponent("required-label"),S=e.resolveComponent("confirm-modal");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",y1,[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title"},"申請經費",-1)),e.createElementVNode("div",u1,[e.createElementVNode("div",x1,[e.createElementVNode("table",h1,[t[6]||(t[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"申請海委會補助／合作金額 (A)"),e.createElementVNode("th",{class:"text-end"},"申請單位自籌款 (B)"),e.createElementVNode("th",{class:"text-end"},"其他機關補助／合作總金額 (C)"),e.createElementVNode("th",{class:"text-end"},"計畫總經費 (A+B+C)")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).ApplyAmount,modelValue:e.unref(l).ApplyAmount,"onUpdate:modelValue":t[0]||(t[0]=A=>e.unref(l).ApplyAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N).SelfAmount,modelValue:e.unref(l).SelfAmount,"onUpdate:modelValue":t[1]||(t[1]=A=>e.unref(l).SelfAmount=A)},null,8,["error","modelValue"])]),e.createElementVNode("td",$1,e.toDisplayString((M=e.unref(l).OtherAmount)==null?void 0:M.toLocaleString()),1),e.createElementVNode("td",B1,e.toDisplayString(e.unref(h).toLocaleString()),1)])])])]),t[14]||(t[14]=e.createElementVNode("ul",{class:"list-unstyled lh-base mb-3"},[e.createElementVNode("li",null,"補助申請單位為民間團體或學校者，配合款比例應為計畫總經費之 5％以上；"),e.createElementVNode("li",null,"合作申請單位之分攤比例應為計畫總經費之 20％以上。")],-1)),e.createElementVNode("div",_1,[e.createElementVNode("table",C1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{colspan:e.unref(V)?6:5,style:{"border-bottom-width":"1px"}},"其他機關補助／合作金額 (C)",8,T1)]),e.createElementVNode("tr",null,[t[7]||(t[7]=e.createElementVNode("th",{width:"1"},null,-1)),t[8]||(t[8]=e.createElementVNode("th",null,"單位名稱",-1)),t[9]||(t[9]=e.createElementVNode("th",{class:"text-end"},"申請／分攤補助金額（含尚未核定者）",-1)),t[10]||(t[10]=e.createElementVNode("th",null,"比例",-1)),t[11]||(t[11]=e.createElementVNode("th",null,"申請合作項目",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",w1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,e.toDisplayString(C+1),1),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`other-${C}-Unit`],modelValue:A.Unit,"onUpdate:modelValue":D=>A.Unit=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`other-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",D1,e.toDisplayString(A.percent||0)+"% ",1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`other-${C}-Content`],rows:"1",modelValue:A.Content,"onUpdate:modelValue":D=>A.Content=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",S1,[e.createElementVNode("div",A1,[e.unref(r).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[12]||(t[12]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,F1)):e.createCommentVNode("",!0),C+1===e.unref(r).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[13]||(t[13]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"經費預算規劃",-1)),e.createElementVNode("div",U1,[e.createElementVNode("div",M1,[e.createElementVNode("table",P1,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[15]||(t[15]=e.createElementVNode("th",null,"預算項目",-1)),t[16]||(t[16]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("海洋委員會經費")],-1)),t[17]||(t[17]=e.createElementVNode("th",{class:"text-end"},[e.createTextVNode("預算金額"),e.createElementVNode("br"),e.createTextVNode("其他配合經費")],-1)),t[18]||(t[18]=e.createElementVNode("th",{class:"text-end"},"預算金額小計",-1)),t[19]||(t[19]=e.createElementVNode("th",null,"計算方式及說明",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock("th",I1,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(A,C)=>(e.openBlock(),e.createElementBlock("tr",{key:A},[e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(N)[`plan-${C}-Title`],modelValue:A.Title,"onUpdate:modelValue":D=>A.Title=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-Amount`],modelValue:A.Amount,"onUpdate:modelValue":D=>A.Amount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(N)[`plan-${C}-OtherAmount`],modelValue:A.OtherAmount,"onUpdate:modelValue":D=>A.OtherAmount=D},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",j1,e.toDisplayString(A.sum.toLocaleString()),1),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N)[`plan-${C}-Description`],rows:"1",modelValue:A.Description,"onUpdate:modelValue":D=>A.Description=D,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(V)?(e.openBlock(),e.createElementBlock("td",O1,[e.createElementVNode("div",L1,[e.unref(o).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:D=>i(A),type:"button"},[...t[20]||(t[20]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,R1)):e.createCommentVNode("",!0),C+1===e.unref(o).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])])]),e.unref(m)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[24]||(t[24]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",q1,[e.createElementVNode("table",z1,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[22]||(t[22]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3Before,rows:"4",modelValue:e.unref(m).Form3Before,"onUpdate:modelValue":t[2]||(t[2]=A=>e.unref(m).Form3Before=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(T,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(w,{error:e.unref(N).Form3After,rows:"4",modelValue:e.unref(m).Form3After,"onUpdate:modelValue":t[3]||(t[3]=A=>e.unref(m).Form3After=A),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(V)?(e.openBlock(),e.createElementBlock("div",G1,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=A=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=A=>n(!0)),type:"button"},[...t[27]||(t[27]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0),e.createVNode(S,{ref_key:"modal",ref:d},{default:e.withCtx(()=>[e.createElementVNode("div",J1,[t[28]||(t[28]=e.createElementVNode("div",{class:"mb-3"},"［提醒您］",-1)),e.createElementVNode("div",Y1,"您申請的補助款經費總計，已超過補助原則上限："+e.toDisplayString(e.unref(u).GrantLimit)+"萬",1),t[29]||(t[29]=e.createElementVNode("div",{class:"mb-2"},"繼續申請請按【確定】",-1)),t[30]||(t[30]=e.createElementVNode("div",null,"返回調整請按【取消】",-1))])]),_:1},512)],64)}}},W1={class:"block"},H1={class:"square-title"},X1={class:"text-teal fw-bold py-3"},K1={class:"table-responsive mb-0"},Z1={class:"table align-middle gray-table"},v1={class:"text-end"},eE={class:"text-teal fw-bold pb-3"},tE={class:"text-teal fw-bold pb-3"},lE={class:"mt-4"},oE={class:"table align-middle gray-table"},nE={class:"text-center"},rE={key:0,width:"180"},aE={class:"text-center"},sE=["href"],dE={key:0,class:"text-center"},cE={key:0},iE={key:1,class:"text-pink"},mE={key:1,class:"tag-group mt-2 gap-1"},pE={key:0,class:"tag tag-green-light"},VE=["download","href"],fE=["onClick"],NE={class:"block-bottom bg-light-teal"},EE=["disabled"],bE={__name:"Payment1",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>d.value.some(s=>!s.Files.filter(a=>!a.Deleted).length)),N=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.computed(()=>{var s;return((s=o.value)==null?void 0:s.Status)==="通過"}),o=e.ref(),l=e.ref({}),d=e.ref([{Type:11,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]}]),k=(s,a)=>{a.Type==="application/pdf"&&s.Files.push({Type:s.Type,Path:a.Path,Name:`${l.value.ProjectID}_第一期_${s.Title}.pdf`})},E=U.download,u=_,h=()=>{U.multiple("getPayment",{ID:x.id}).subscribe(s=>{l.value=s.Project,j().init("multiple",l.value),d.value=d.value.filter(a=>{var y;return!((y=a.Excludes)!=null&&y.includes(l.value.OrgCategory))}),d.value.forEach(a=>{a.Files=s.Attachments.filter(y=>y.Type===a.Type),a.Uploaded=e.computed(()=>a.Files.filter(y=>!y.Deleted).length)}),o.value=s.Payments.find(a=>a.Stage===1),o.value?m.value=o.value.CurrentRequestAmount:m.value=Math.round(l.value.ApprovedAmount*x.setting.DisbursementRatioPct/100),Y().init(o.value)})},g=s=>{const a={Payment:{ProjectID:x.id,Stage:1,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,CurrentRequestAmount:m.value},Attachments:d.value.reduce((y,i)=>y.concat(i.Files),[]),Submit:s?"true":"false"};U.multiple("savePayment",a).subscribe(()=>{s?u("next"):h()})};return e.onMounted(h),e.provide("editable",N),(s,a)=>{var n;const y=e.resolveComponent("required-label"),i=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",W1,[e.createElementVNode("h5",H1,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",X1,"核定經費: "+e.toDisplayString((n=e.unref(l).ApprovedAmount)==null?void 0:n.toLocaleString())+"元",1),e.createElementVNode("div",K1,[e.createElementVNode("table",Z1,[a[6]||(a[6]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",v1,e.toDisplayString(e.unref(m)),1),a[2]||(a[2]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[3]||(a[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[4]||(a[4]=e.createElementVNode("td",{class:"text-end"},"--",-1)),a[5]||(a[5]=e.createElementVNode("td",{class:"text-end"},"--",-1))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",eE,"本期實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",tE,"累積實際撥款: "+e.toDisplayString(e.unref(o).CurrentActualPaidAmount.toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),a[12]||(a[12]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),a[13]||(a[13]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",lE,[e.createElementVNode("table",oE,[e.createElementVNode("thead",nE,[e.createElementVNode("tr",null,[a[7]||(a[7]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),a[8]||(a[8]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",rE,"狀態")):e.createCommentVNode("",!0),a[9]||(a[9]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",aE,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(y,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.Title),1)]),_:2},1024)]),e.unref(N)&&c.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:c.Template,style:{width:"140px"},type:"button"},[...a[10]||(a[10]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,sE)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",dE,[c.Uploaded?(e.openBlock(),e.createElementBlock("span",cE,"已上傳")):(e.openBlock(),e.createElementBlock("span",iE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!c.Uploaded?(e.openBlock(),e.createBlock(i,{key:0,accept:".pdf",onFile:t=>k(c,t)},null,8,["onFile"])):e.createCommentVNode("",!0),c.Uploaded?(e.openBlock(),e.createElementBlock("div",mE,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.Files,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[t.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",pE,[e.createElementVNode("a",{class:"tag-link my-1",download:t.Name,href:e.unref(E)(t.Path)},e.toDisplayString(t.Name),9,VE),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:p=>t.Deleted=!0,type:"button"},[...a[11]||(a[11]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,fE)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",NE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:a[0]||(a[0]=c=>g()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:a[1]||(a[1]=c=>g(!0)),disabled:e.unref(V),type:"button"},[...a[14]||(a[14]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,EE)])],64)}}},gE={class:"block"},kE={class:"square-title"},yE={class:"text-teal fw-bold py-3"},uE={class:"table-responsive mb-0"},xE={class:"table align-middle gray-table"},hE={class:"text-end"},$E={class:"text-end"},BE={class:"text-end"},_E={class:"text-end"},CE={class:"text-teal fw-bold pb-3"},TE={class:"text-teal fw-bold pb-3"},wE={class:"mt-4"},DE={class:"table align-middle gray-table"},SE={class:"text-center"},AE={key:0,width:"180"},FE={class:"text-center"},UE=["href"],ME={key:0,class:"text-center"},PE={key:0},IE={key:1,class:"text-pink"},jE={key:1,class:"tag-group mt-2 gap-1"},OE={key:0,class:"tag tag-green-light"},LE=["download","href"],RE=["onClick"],qE={class:"block-bottom bg-light-teal"},zE=["disabled"],GE={__name:"Payment2",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.ref(0),N=e.computed(()=>m.value<=0||a.value.some(t=>!t.Files.filter(p=>!p.Deleted).length)),r=e.computed(()=>!d.value||d.value.Status==="請款中"),o=e.computed(()=>{var t;return((t=d.value)==null?void 0:t.Status)==="通過"}),l=e.ref(0),d=e.ref(),k=e.ref(0),E=e.ref(0),u=e.ref({}),h=e.computed(()=>u.value.ApprovedAmount?Math.min(Math.round(m.value*100/u.value.ApprovedAmount*100)/100,100):0),g=e.computed(()=>s.value?Math.min(Math.round(m.value*100/s.value*100)/100,100):0),s=e.computed(()=>E.value+(o.value?d.value.CurrentActualPaidAmount:0)),a=e.ref([{Type:21,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:22,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:23,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:24,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),y=(t,p)=>{p.Type==="application/pdf"&&t.Files.push({Type:t.Type,Path:p.Path,Name:`${u.value.ProjectID}_第二期_${t.Title}.pdf`})},i=U.download,n=_,c=()=>{U.multiple("getPayment",{ID:x.id}).subscribe(t=>{u.value=t.Project,j().init("multiple",u.value),a.value=a.value.filter(b=>{var w;return!((w=b.Excludes)!=null&&w.includes(u.value.OrgCategory))}),a.value.forEach(b=>{b.Files=t.Attachments.filter(w=>w.Type===b.Type),b.Uploaded=e.computed(()=>b.Files.filter(w=>!w.Deleted).length)}),d.value=t.Payments.find(b=>b.Stage===2),d.value?V.value=d.value.CurrentRequestAmount:V.value=Math.round(u.value.ApprovedAmount*x.setting.DisbursementRatioPct/100);const p=t.Payments.filter(b=>b.Stage<2&&b.Status==="通過");k.value=p.reduce((b,w)=>b+w.CurrentRequestAmount,0),E.value=p.reduce((b,w)=>b+w.CurrentActualPaidAmount,0),l.value=u.value.ApprovedAmount,Y().init(d.value,E.value)})},f=t=>{const p={Payment:{ProjectID:x.id,Stage:2,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,CurrentRequestAmount:V.value,TotalSpentAmount:m.value},Attachments:a.value.reduce((b,w)=>b.concat(w.Files),[]),Submit:t?"true":"false"};U.multiple("savePayment",p).subscribe(()=>{t?n("next"):c()})};return e.onMounted(c),e.provide("editable",r),(t,p)=>{var S;const b=e.resolveComponent("input-integer"),w=e.resolveComponent("required-label"),T=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",gE,[e.createElementVNode("h5",kE,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",yE,"核定經費: "+e.toDisplayString((S=e.unref(u).ApprovedAmount)==null?void 0:S.toLocaleString())+"元",1),e.createElementVNode("div",uE,[e.createElementVNode("table",xE,[p[3]||(p[3]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",hE,e.toDisplayString(e.unref(V)),1),e.createElementVNode("td",$E,e.toDisplayString(e.unref(E)),1),e.createElementVNode("td",null,[e.createVNode(b,{max:e.unref(l),modelValue:e.unref(m),"onUpdate:modelValue":p[0]||(p[0]=M=>e.isRef(m)?m.value=M:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",BE,e.toDisplayString(e.unref(h))+"%",1),e.createElementVNode("td",_E,e.toDisplayString(e.unref(g))+"%",1)])])])]),e.unref(o)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("p",CE,"本期實際撥款: "+e.toDisplayString(e.unref(d).CurrentActualPaidAmount.toLocaleString())+"元",1),e.createElementVNode("p",TE,"累積實際撥款: "+e.toDisplayString(e.unref(s).toLocaleString())+"元",1)],64)):e.createCommentVNode("",!0),p[9]||(p[9]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),p[10]||(p[10]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",wE,[e.createElementVNode("table",DE,[e.createElementVNode("thead",SE,[e.createElementVNode("tr",null,[p[4]||(p[4]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),p[5]||(p[5]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(r)?(e.openBlock(),e.createElementBlock("th",AE,"狀態")):e.createCommentVNode("",!0),p[6]||(p[6]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),(M,A)=>(e.openBlock(),e.createElementBlock("tr",{key:M},[e.createElementVNode("td",FE,e.toDisplayString(A+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(M.Title),1)]),_:2},1024)]),e.unref(r)&&M.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:M.Template,style:{width:"140px"},type:"button"},[...p[7]||(p[7]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,UE)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",ME,[M.Uploaded?(e.openBlock(),e.createElementBlock("span",PE,"已上傳")):(e.openBlock(),e.createElementBlock("span",IE,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!M.Uploaded?(e.openBlock(),e.createBlock(T,{key:0,accept:".pdf",onFile:C=>y(M,C)},null,8,["onFile"])):e.createCommentVNode("",!0),M.Uploaded?(e.openBlock(),e.createElementBlock("div",jE,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(M.Files,C=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[C.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",OE,[e.createElementVNode("a",{class:"tag-link my-1",download:C.Name,href:e.unref(i)(C.Path)},e.toDisplayString(C.Name),9,LE),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:D=>C.Deleted=!0,type:"button"},[...p[8]||(p[8]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,RE)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.createElementVNode("div",qE,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:p[1]||(p[1]=M=>f()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:p[2]||(p[2]=M=>f(!0)),disabled:e.unref(N),type:"button"},[...p[11]||(p[11]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,zE)])],64)}}},JE={class:"block"},YE={class:"square-title"},QE={class:"text-teal fw-bold py-3"},WE={class:"text-teal fw-bold pb-3"},HE={class:"table-responsive"},XE={class:"table align-middle gray-table"},KE={class:"text-end"},ZE={class:"text-end"},vE={class:"text-end"},eb={class:"mt-4"},tb={class:"table align-middle gray-table"},lb={class:"text-center"},ob={key:0,width:"180"},nb={class:"text-center"},rb=["href"],ab={key:0,class:"text-center"},sb={key:0},db={key:1,class:"text-pink"},cb={key:1,class:"tag-group mt-2 gap-1"},ib={key:0,class:"tag tag-green-light"},mb=["download","href"],pb=["onClick"],Vb={class:"text-center"},fb={colspan:"2"},Nb={class:"block-bottom bg-light-teal"},Eb=["disabled"],bb={__name:"Payment3",props:{id:{type:[Number,String]},setting:{type:Object}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref(0),V=e.computed(()=>m.value<=0||u.value.some(i=>!i.Files.filter(n=>!n.Deleted).length)),N=e.computed(()=>!o.value||o.value.Status==="請款中"),r=e.ref(0),o=e.ref(),l=e.ref(0),d=e.ref({}),k=e.computed(()=>d.value.ApprovedAmount?Math.min(Math.round(m.value*100/d.value.ApprovedAmount*100)/100,100):0),E=e.computed(()=>l.value?Math.min(Math.round(m.value*100/l.value*100)/100,100):0),u=e.ref([{Type:31,Title:"領據",Template:"../../Template/MUL/1-領據.docx",Files:[]},{Type:32,Title:"經費收支明細表",Template:"../../Template/MUL/2-經費收支明細表.docx",Files:[]},{Type:33,Title:"經費分攤表",Template:"../../Template/MUL/3-經費分攤表.docx",Files:[]},{Type:34,Title:"合作經費清單",Template:"../../Template/MUL/4-合作經費清單.docx",Files:[]}]),h=(i,n)=>{n.Type==="application/pdf"&&i.Files.push({Type:i.Type,Path:n.Path,Name:`${d.value.ProjectID}_結案核銷_${i.Title}.pdf`})},g=U.download,s=_,a=()=>{U.multiple("getPayment",{ID:x.id}).subscribe(i=>{d.value=i.Project,j().init("multiple",d.value),u.value=u.value.filter(n=>{var c;return!((c=n.Excludes)!=null&&c.includes(d.value.OrgCategory))}),u.value.forEach(n=>{n.Files=i.Attachments.filter(c=>c.Type===n.Type),n.Uploaded=e.computed(()=>n.Files.filter(c=>!c.Deleted).length)}),o.value=i.Payments.find(n=>n.Stage===3),l.value=i.Payments.filter(n=>n.Stage<3&&n.Status==="通過").reduce((n,c)=>n+c.CurrentActualPaidAmount,0),r.value=d.value.ApprovedAmount,Y().init(o.value,l.value)})},y=i=>{const n={Payment:{ProjectID:x.id,Stage:3,ActDisbursementRatioPct:x.setting.DisbursementRatioPct,TotalSpentAmount:m.value},Attachments:u.value.reduce((c,f)=>c.concat(f.Files),[]),Submit:i?"true":"false"};U.multiple("savePayment",n).subscribe(()=>{i?s("next"):a()})};return e.onMounted(a),e.provide("editable",N),(i,n)=>{var b;const c=e.resolveComponent("input-integer"),f=e.resolveComponent("required-label"),t=e.resolveComponent("input-file"),p=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",JE,[e.createElementVNode("h5",YE,e.toDisplayString(B.setting.DisbursementType)+e.toDisplayString(B.setting.Note),1),e.createElementVNode("p",QE,"核定經費: "+e.toDisplayString((b=e.unref(d).ApprovedAmount)==null?void 0:b.toLocaleString())+"元",1),e.createElementVNode("p",WE,"賸餘款: "+e.toDisplayString((e.unref(d).ApprovedAmount-e.unref(m)).toLocaleString())+"元",1),e.createElementVNode("div",HE,[e.createElementVNode("table",XE,[n[4]||(n[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{class:"text-end"},"本期請款金額"),e.createElementVNode("th",{class:"text-end"},"前期已撥付金額"),e.createElementVNode("th",null,"累積實支金額"),e.createElementVNode("th",{class:"text-end"},"累積經費執行率"),e.createElementVNode("th",{class:"text-end"},"支用比")])],-1)),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[n[3]||(n[3]=e.createElementVNode("td",{class:"text-end"},"--",-1)),e.createElementVNode("td",KE,e.toDisplayString(e.unref(l)),1),e.createElementVNode("td",null,[e.createVNode(c,{max:e.unref(r),modelValue:e.unref(m),"onUpdate:modelValue":n[0]||(n[0]=w=>e.isRef(m)?m.value=w:null)},null,8,["max","modelValue"])]),e.createElementVNode("td",ZE,e.toDisplayString(e.unref(k))+"%",1),e.createElementVNode("td",vE,e.toDisplayString(e.unref(E))+"%",1)])])])]),n[11]||(n[11]=e.createElementVNode("h5",{class:"square-title mt-4"},"檔案上傳",-1)),n[12]||(n[12]=e.createElementVNode("p",{class:"text-pink mt-3 lh-base"},"請下載附件範本，填寫資料及公文用印後上傳（僅支援PDF）。",-1)),e.createElementVNode("div",eb,[e.createElementVNode("table",tb,[e.createElementVNode("thead",lb,[e.createElementVNode("tr",null,[n[5]||(n[5]=e.createElementVNode("th",{width:"60"},"附件編號",-1)),n[6]||(n[6]=e.createElementVNode("th",null,"附件名稱",-1)),e.unref(N)?(e.openBlock(),e.createElementBlock("th",ob,"狀態")):e.createCommentVNode("",!0),n[7]||(n[7]=e.createElementVNode("th",{width:"350"},"上傳附件",-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(w,T)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",nb,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(w.Title),1)]),_:2},1024)]),e.unref(N)&&w.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:w.Template,style:{width:"140px"},type:"button"},[...n[8]||(n[8]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,rb)):e.createCommentVNode("",!0)]),e.unref(N)?(e.openBlock(),e.createElementBlock("td",ab,[w.Uploaded?(e.openBlock(),e.createElementBlock("span",sb,"已上傳")):(e.openBlock(),e.createElementBlock("span",db,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(N)&&!w.Uploaded?(e.openBlock(),e.createBlock(t,{key:0,accept:".pdf",onFile:S=>h(w,S)},null,8,["onFile"])):e.createCommentVNode("",!0),w.Uploaded?(e.openBlock(),e.createElementBlock("div",cb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.Files,S=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:S},[S.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ib,[e.createElementVNode("a",{class:"tag-link my-1",download:S.Name,href:e.unref(g)(S.Path)},e.toDisplayString(S.Name),9,mb),e.unref(N)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:M=>S.Deleted=!0,type:"button"},[...n[9]||(n[9]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,pb)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128)),e.createElementVNode("tr",null,[e.createElementVNode("td",Vb,e.toDisplayString(e.unref(u).length+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(f,null,{default:e.withCtx(()=>[...n[10]||(n[10]=[e.createTextVNode("其他資料（5分鐘精華影片）",-1)])]),_:1})])]),e.createElementVNode("td",fb,[e.createVNode(p)])])])])])]),e.createElementVNode("div",Nb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:n[1]||(n[1]=w=>y()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:n[2]||(n[2]=w=>y(!0)),disabled:e.unref(V),type:"button"},[...n[13]||(n[13]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Eb)])],64)}}},gb={__name:"ProgressBar",setup(B){const _=[{step:1,title:"申請書／計畫書",url:"Application"},{step:2,title:"期程／工作項目／查核",url:"WorkSchedule"},{step:3,title:"經費",url:"Funding"},{step:4,title:"成果效益",url:"Benefit"},{step:5,title:"上傳附件／提送申請",url:"Attachment"}];return(x,m)=>{const V=e.resolveComponent("common-progress-bar");return e.openBlock(),e.createBlock(V,{steps:_,type:"multiple"})}}},kb={class:"block"},yb={class:"mt-4"},ub={class:"table align-middle gray-table side-table"},xb={key:0,class:"d-flex align-items-center gap-2"},hb={class:"input-group w-auto"},$b={class:"text-teal-dark"},Bb={key:1,class:"invalid mt-0"},_b={class:"table-responsive mt-4"},Cb={class:"table align-middle gray-table"},Tb={key:0},wb={class:"input-group"},Db={key:0,class:"invalid mt-0"},Sb={key:0},Ab={class:"d-flex gap-2"},Fb=["onClick"],Ub={class:"mt-4"},Mb={class:"table align-middle gray-table"},Pb={key:0},Ib=["value"],jb={key:0},Ob={class:"d-flex gap-2"},Lb=["onClick"],Rb={class:"mt-4"},qb={class:"table align-middle gray-table side-table"},zb={key:0,class:"block-bottom bg-light-teal"},Gb={__name:"WorkSchedule",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=[{value:1,text:"50%"},{value:2,text:"100%"}],V=e.ref(),N=e.computed(()=>E.value.EndDate),r=e.computed(()=>z("multiple",k.value.Status,2)),o=e.ref({}),l=e.computed(()=>u.value.filter(f=>!f.Deleted)),d=e.computed(()=>h.value.filter(f=>!f.Deleted)),k=e.ref({}),E=e.ref({}),u=e.ref([]),h=e.ref([]),g=()=>U.multiple("createItem",{ID:x.id}).subscribe(f=>u.value.push(f)),s=()=>h.value.push({Type:0,ItemID:0}),a=_,y=()=>{rxjs.forkJoin([U.multiple("getWorkSchedule",{ID:x.id})]).subscribe(f=>{const t=f[0];k.value=t.Project,E.value=t.GrantType,u.value=t.Items,h.value=t.Schedules,u.value.length||g(),h.value.length||s(),j().init("multiple",k.value),V.value=k.value.changeApply,k.value.changeApply=void 0})},i=f=>f.Deleted=!0,n=f=>{var p,b;if(o.value={},f&&!c()){e.nextTick(()=>{var w;return(w=document.querySelector(".invalid"))==null?void 0:w.scrollIntoView({behavior:"smooth",block:"center"})});return}const t={Project:k.value,Items:u.value,Schedules:h.value,Before:(p=V.value)==null?void 0:p.Form2Before,After:(b=V.value)==null?void 0:b.Form2After,Submit:f?"true":"false"};U.multiple("saveWorkSchedule",t).subscribe(()=>{f?a("next"):y()})},c=()=>{let f={StartTime:"計畫期程",EndTime:"計畫期程"};return o.value=P(k.value,f),f={Title:"工作項目",Begin:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},End:{numericality:{greaterThan:0,message:"^請選擇起迄月份"}},Deadline:"預定完成日",Content:"詳細執行內容說明"},l.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`item-${p}-`))),f={Type:{numericality:{greaterThan:0,message:"^請選擇完成百分比"}},ItemID:{numericality:{greaterThan:0,message:"^請選擇對應工項"}},Deadline:"預定完成日",Content:"查核內容概述"},d.value.forEach((t,p)=>Object.assign(o.value,P(t,f,`schedule-${p}-`))),V.value&&(f={Form2Before:"變更前說明",Form2After:"變更後說明"},Object.assign(o.value,P(V.value,f))),!Object.keys(o.value).length};return e.onMounted(y),e.provide("editable",r),(f,t)=>{const p=e.resolveComponent("required-label"),b=e.resolveComponent("input-tw-date"),w=e.resolveComponent("tw-date"),T=e.resolveComponent("input-text"),S=e.resolveComponent("input-month"),M=e.resolveComponent("input-textarea"),A=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",kb,[t[26]||(t[26]=e.createElementVNode("h5",{class:"square-title"},"期程",-1)),e.createElementVNode("div",yb,[e.createElementVNode("table",ub,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[6]||(t[6]=[e.createTextVNode("計畫期程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(N)?(e.openBlock(),e.createElementBlock("div",xb,[e.createElementVNode("div",hb,[e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).StartTime,"onUpdate:modelValue":t[0]||(t[0]=C=>e.unref(k).StartTime=C)},null,8,["max-date","modelValue"]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(b,{class:"w-auto","max-date":e.unref(N),modelValue:e.unref(k).EndTime,"onUpdate:modelValue":t[1]||(t[1]=C=>e.unref(k).EndTime=C)},null,8,["max-date","modelValue"])]),e.createElementVNode("span",$b,[t[8]||(t[8]=e.createTextVNode("(期程不可超過 ",-1)),e.createVNode(w,{value:e.unref(N)},null,8,["value"]),t[9]||(t[9]=e.createTextVNode(")",-1))])])):e.createCommentVNode("",!0),e.unref(o).StartTime||e.unref(o).EndTime?(e.openBlock(),e.createElementBlock("div",Bb,e.toDisplayString(e.unref(o).StartTime||e.unref(o).EndTime),1)):e.createCommentVNode("",!0)])])])])]),t[27]||(t[27]=e.createElementVNode("h5",{class:"square-title mt-4"},"工作項目及預定進度",-1)),e.createElementVNode("div",_b,[e.createElementVNode("table",Cb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[t[14]||(t[14]=e.createElementVNode("th",null,"編號",-1)),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[10]||(t[10]=[e.createTextVNode("工作項目",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[11]||(t[11]=[e.createTextVNode("起訖月份",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[12]||(t[12]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[13]||(t[13]=[e.createTextVNode("詳細執行內容說明",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Tb,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,e.toDisplayString(String.fromCharCode(65+D)),1),e.createElementVNode("td",null,[e.createVNode(T,{error:e.unref(o)[`item-${D}-Title`],modelValue:C.Title,"onUpdate:modelValue":F=>C.Title=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",wb,[e.createVNode(S,{"empty-value":0,modelValue:C.Begin,"onUpdate:modelValue":F=>C.Begin=F},null,8,["modelValue","onUpdate:modelValue"]),e.createVNode(S,{"empty-value":0,modelValue:C.End,"onUpdate:modelValue":F=>C.End=F},null,8,["modelValue","onUpdate:modelValue"])]),e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]?(e.openBlock(),e.createElementBlock("div",Db,e.toDisplayString(e.unref(o)[`item-${D}-Begin`]||e.unref(o)[`item-${D}-End`]),1)):e.createCommentVNode("",!0)]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`item-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`item-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",Sb,[e.createElementVNode("div",Ab,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[15]||(t[15]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Fb)):e.createCommentVNode("",!0),D+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:g,type:"button"},[...t[16]||(t[16]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),t[28]||(t[28]=e.createElementVNode("h5",{class:"square-title mt-4"},"進度說明",-1)),e.createElementVNode("div",Ub,[e.createElementVNode("table",Mb,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[17]||(t[17]=[e.createTextVNode("完成百分比",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[18]||(t[18]=[e.createTextVNode("對應工項",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[19]||(t[19]=[e.createTextVNode("預定完成日",-1)])]),_:1})]),e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[20]||(t[20]=[e.createTextVNode("查核內容概述（請具體明確或量化）",-1)])]),_:1})]),e.unref(r)?(e.openBlock(),e.createElementBlock("th",Pb,"功能")):e.createCommentVNode("",!0)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(C,D)=>(e.openBlock(),e.createElementBlock("tr",{key:C},[e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-Type`],options:m,modelValue:C.Type,"onUpdate:modelValue":F=>C.Type=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(A,{"empty-value":0,error:e.unref(o)[`schedule-${D}-ItemID`],options:e.unref(l),modelValue:C.ItemID,"onUpdate:modelValue":F=>C.ItemID=F,modelModifiers:{trim:!0}},{default:e.withCtx(({index:F,option:I})=>[e.createElementVNode("option",{value:I.ID},e.toDisplayString(String.fromCharCode(65+F))+"."+e.toDisplayString(I.Title),9,Ib)]),_:2},1032,["error","options","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(b,{error:e.unref(o)[`schedule-${D}-Deadline`],modelValue:C.Deadline,"onUpdate:modelValue":F=>C.Deadline=F},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o)[`schedule-${D}-Content`],rows:"1",modelValue:C.Content,"onUpdate:modelValue":F=>C.Content=F,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",jb,[e.createElementVNode("div",Ob,[e.unref(d).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:F=>i(C),type:"button"},[...t[21]||(t[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Lb)):e.createCommentVNode("",!0),D+1===e.unref(d).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:s,type:"button"},[...t[22]||(t[22]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)]))),128))])])]),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t[25]||(t[25]=e.createElementVNode("h5",{class:"square-title mt-5"},"變更說明",-1)),e.createElementVNode("div",Rb,[e.createElementVNode("table",qb,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[23]||(t[23]=[e.createTextVNode("變更前",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2Before,rows:"4",modelValue:e.unref(V).Form2Before,"onUpdate:modelValue":t[2]||(t[2]=C=>e.unref(V).Form2Before=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(p,null,{default:e.withCtx(()=>[...t[24]||(t[24]=[e.createTextVNode("變更後",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(M,{error:e.unref(o).Form2After,rows:"4",modelValue:e.unref(V).Form2After,"onUpdate:modelValue":t[3]||(t[3]=C=>e.unref(V).Form2After=C),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])],64)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",zb,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:t[4]||(t[4]=C=>n()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:t[5]||(t[5]=C=>n(!0)),type:"button"},[...t[29]||(t[29]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("完成本頁，下一步",-1)])])])):e.createCommentVNode("",!0)],64)}}},Jb={class:"block bg-light-teal-100 rounded-4 py-4"},Yb={class:"fw-bold"},Qb={class:"d-flex align-items-center gap-3 text-teal-dark mt-3"},Wb={class:"block rounded-4 mt-4"},Hb=["innerHTML"],Xb={class:"mt-3 d-flex flex-column gap-2"},Kb=["download","href"],Zb={class:"mt-3"},vb=["data-caption","href"],eg=["alt","src"],tg={class:"mt-3 d-flex flex-column gap-2"},lg=["href"],og={__name:"NewsDetail",props:{id:{type:[Number,String]}},setup(B){const _=B,x=e.ref(),m=e.ref([]),V=e.ref({}),N=e.ref([]),r=e.ref([]),o=U.download;return e.onMounted(()=>{U.system("getNews",{ID:_.id}).subscribe(l=>{V.value=l.News,m.value=l.Files,N.value=l.Images,r.value=l.Videos,e.nextTick(()=>{Fancybox.bind(x.value,"[data-fancybox]")})})}),(l,d)=>{const k=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Jb,[e.createElementVNode("h5",Yb,e.toDisplayString(e.unref(V).Title),1),e.createElementVNode("ul",Qb,[e.createElementVNode("li",null,[d[0]||(d[0]=e.createTextVNode("公告日期：",-1)),e.createVNode(k,{value:e.unref(V).EnableTime},null,8,["value"])]),e.createElementVNode("li",null,"公告單位："+e.toDisplayString(e.unref(V).UserOrg),1)])]),e.createElementVNode("div",Wb,[e.createElementVNode("div",{class:"mb-5",style:{"white-space":"pre-line"},innerHTML:e.unref(V).Content},null,8,Hb),e.unref(m).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[d[2]||(d[2]=e.createElementVNode("h5",{class:"square-title"},"相關附件",-1)),e.createElementVNode("ul",Xb,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",download:E.Name,href:e.unref(o)(E.Path)},[e.createTextVNode(e.toDisplayString(E.Name)+" ",1),d[1]||(d[1]=e.createElementVNode("i",{class:"fa-solid fa-file-arrow-down text-teal-dark ms-1"},null,-1))],8,Kb)]))),128))])],64)):e.createCommentVNode("",!0),e.unref(N).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[d[4]||(d[4]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關照片",-1)),e.createElementVNode("div",Zb,[e.createElementVNode("div",{class:"image-preview mt-3",ref_key:"container",ref:x},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(E,u)=>(e.openBlock(),e.createElementBlock("div",{class:"image-preview__item",key:E},[e.createElementVNode("a",{"data-fancybox":"gallery","data-caption":`相片 ${u}`,href:e.unref(o)(E.Path)},[e.createElementVNode("img",{alt:`相片 ${u}`,src:e.unref(o)(E.Path)},null,8,eg),d[3]||(d[3]=e.createElementVNode("div",{class:"image-preview__item-overlay"},[e.createElementVNode("button",{"aria-label":"檢視圖片",class:"btn btn-view-image",tabindex:"-1",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"})])],-1))],8,vb)]))),128))],512)])],64)):e.createCommentVNode("",!0),e.unref(r).length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[d[6]||(d[6]=e.createElementVNode("h5",{class:"square-title mt-5"},"相關影片",-1)),e.createElementVNode("ul",tg,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),E=>(e.openBlock(),e.createElementBlock("li",{key:E},[e.createElementVNode("a",{class:"link-black",href:E.URL,target:"_blank"},[e.createTextVNode(e.toDisplayString(E.Title)+" ",1),d[5]||(d[5]=e.createStaticVNode('<svg class="ms-1" xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19 24" fill="none"><g clip-path="url(#clip0_1051_6167)"><path d="M17.7333 0.5H12.6667C11.913 0.5 11.4 1.12067 11.4 1.76667C11.4 2.05167 11.4887 2.36833 11.7673 2.65967L13.4077 4.3L9.87367 7.834C9.60767 8.1 9.5 8.423 9.5 8.727C9.5 9.43633 10.0573 9.99367 10.7667 9.99367C11.096 9.99367 11.4127 9.87333 11.6597 9.62L15.1937 6.086L16.834 7.72633C17.1253 8.005 17.442 8.09367 17.727 8.09367C18.373 8.09367 18.9937 7.58067 18.9937 6.827V1.76667C18.9937 1.12067 18.4807 0.5 17.727 0.5H17.7333ZM15.2 7.88467L12.559 10.5257C12.084 11.0007 11.4443 11.2667 10.7667 11.2667C9.348 11.2667 8.23333 10.152 8.23333 8.73333C8.23333 8.05567 8.49933 7.42233 8.97433 6.941L11.6153 4.3L10.8743 3.559C10.716 3.39433 10.5957 3.217 10.488 3.03333H1.26667C0.563667 3.03333 0 3.597 0 4.3V18.2333C0 18.93 0.563667 19.5 1.26667 19.5H15.2C15.8967 19.5 16.4667 18.93 16.4667 18.2333V9.01833C16.2893 8.917 16.1183 8.79667 15.9663 8.651L15.2 7.88467Z" fill="#037F72"></path></g><defs><clipPath id="clip0_1051_6167"><rect width="19" height="19" fill="white" transform="translate(0 0.5)"></rect></clipPath></defs></svg>',1))],8,lg)]))),128))])],64)):e.createCommentVNode("",!0)])],64)}}},ng={class:"block rounded-4 mt-4"},rg={class:"table-responsive",style:{"min-height":"400px"}},ag={class:"table teal-table","aria-label":"公告列表"},sg={"data-th":"公告時間:"},dg={"data-th":"公告標題:",class:"text-start"},cg=["href"],ig={"data-th":"發布單位:",class:"text-start"},mg={__name:"NewsList",setup(B){const _=e.ref([]),x=e.ref(1),m=e.ref(10),V=e.computed(()=>_.value.slice((x.value-1)*m.value,x.value*m.value)),N=(r,o)=>{x.value=parseInt(r),m.value=parseInt(o)};return e.onMounted(()=>{U.system("getPublishedNewsList").subscribe(r=>_.value=r.List)}),(r,o)=>{const l=e.resolveComponent("tw-date"),d=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock("div",ng,[o[1]||(o[1]=e.createElementVNode("div",{class:"title border-teal"},[e.createElementVNode("div",{class:"d-flex align-items-center gap-2"},[e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")])])],-1)),e.createElementVNode("div",rg,[e.createElementVNode("table",ag,[o[0]||(o[0]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告時間"),e.createElementVNode("th",{scope:"col",class:"text-start"},"標題"),e.createElementVNode("th",{scope:"col",style:{width:"300px"}},"發布單位")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),k=>(e.openBlock(),e.createElementBlock("tr",{key:k},[e.createElementVNode("td",sg,[e.createVNode(l,{value:k.EnableTime},null,8,["value"])]),e.createElementVNode("td",dg,[e.createElementVNode("a",{class:"link-black",href:`NewsDetail.aspx?ID=${k.ID}`},e.toDisplayString(k.Title),9,cg)]),e.createElementVNode("td",ig,e.toDisplayString(k.UserOrg)+" "+e.toDisplayString(k.UserName),1)]))),128))])])]),e.createVNode(d,{count:e.unref(_).length,onChange:N,page:e.unref(x),"page-size":e.unref(m)},null,8,["count","page","page-size"])])}}},pg={key:0,class:"scroll-bottom-panel"},Vg={class:"d-flex flex-column gap-3 mb-3"},fg={class:"d-flex gap-2"},Ng={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Eg={class:"text-nowrap my-2 d-flex align-items-center"},bg={__name:"ProjectChangeReview",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=B,x=j(),m=[{value:1,text:"通過"},{value:2,text:"退回修改"}],V=e.ref({}),N=e.ref({ID:_.id,Result:1}),r=()=>{const l={};if(N.value.Result>1&&(l.Reason="原因"),V.value=P(N.value,l),Object.keys(V.value).length){o();return}U[_.type]("reviewApplicationChange",N.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=5")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,l=>{l>1&&o()}),(l,d)=>{const k=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(x)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",pg,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Vg,[e.createElementVNode("li",fg,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",Ng,[e.createElementVNode("div",Eg,[e.createVNode(k,{options:m,modelValue:e.unref(N).Result,"onUpdate:modelValue":d[0]||(d[0]=u=>e.unref(N).Result=u)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(V).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":d[1]||(d[1]=u=>e.unref(N).Reason=u)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},gg={key:0,class:"scroll-bottom-panel"},kg={class:"d-flex flex-column gap-3 mb-3"},yg={class:"d-flex gap-2"},ug={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},xg={class:"text-nowrap my-2 d-flex align-items-center"},hg={__name:"ProjectCorrectionReview",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,x=j(),m=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回修改"}],V=e.ref({}),N=e.ref({ID:_.id,Result:1}),r=()=>{const l={};if(N.value.Result>1&&(l.Reason="原因"),V.value=P(N.value,l),Object.keys(V.value).length){o();return}U[_.type]("reviewApplication",N.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=4")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,l=>{l>1&&o()}),(l,d)=>{const k=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(x)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",gg,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",kg,[e.createElementVNode("li",yg,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",ug,[e.createElementVNode("div",xg,[e.createVNode(k,{options:m,modelValue:e.unref(N).Result,"onUpdate:modelValue":d[0]||(d[0]=u=>e.unref(N).Result=u)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(V).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":d[1]||(d[1]=u=>e.unref(N).Reason=u)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},$g={class:"d-flex align-items-center gap-3"},Bg={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},_g={class:"modal-content"},Cg={class:"modal-header"},Tg={class:"fs-24 fw-bold text-green-light"},wg={class:"modal-body"},Dg={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},Sg=["disabled"],Ag={__name:"ProjectOrganizer",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,x=e.computed(()=>!N.value||N.value===o[_.type].organizer),m=e.ref(),V=e.computed(()=>o[_.type].organizerName),N=e.ref(0),r=e.computed(()=>{var h;return(h=k.value.find(g=>g.UnitID===d.value))==null?void 0:h.reviewers}),o=j(),l=e.computed(()=>V.value?"移轉案件":"認領案件"),d=e.ref(0),k=e.ref([]),E=()=>{U[_.type]("queryReviewUnits").subscribe(h=>{k.value=h,rxjs.forkJoin(k.value.map(g=>U[_.type]("queryReviewersByUnit",{ID:g.UnitID}))).subscribe(g=>{g.forEach((s,a)=>{k.value[a].reviewers=s,s.some(y=>y.UserID===N.value)&&(d.value=k.value[a].UnitID)}),bootstrap.Modal.getOrCreateInstance(m.value).show()})})},u=()=>{U[_.type]("saveOrganizer",{ID:_.id,Organizer:N.value}).subscribe(h=>{h&&window.location.reload()})};return e.watch(V,()=>N.value=o[_.type].organizer),e.watch(d,()=>{r.value.some(h=>h.UserID===N.value)||(N.value=0)}),(h,g)=>{const s=e.resolveComponent("input-select");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",$g,[e.createElementVNode("span",null,"審核承辦人員："+e.toDisplayString(e.unref(V)||"尚無"),1),e.createElementVNode("button",{class:"btn btn-teal",onClick:E,type:"button"},e.toDisplayString(e.unref(l)),1)]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:m,tabindex:"-1"},[e.createElementVNode("div",Bg,[e.createElementVNode("div",_g,[e.createElementVNode("div",Cg,[e.createElementVNode("h4",Tg,e.toDisplayString(e.unref(l)),1),g[2]||(g[2]=e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})],-1))]),e.createElementVNode("div",wg,[e.createElementVNode("div",null,[g[3]||(g[3]=e.createElementVNode("div",{class:"fs-16 text-gray mb-3"},"承辦人員",-1)),e.createVNode(s,{"empty-value":0,options:e.unref(k),"text-name":"UnitName","value-name":"UnitID",modelValue:e.unref(d),"onUpdate:modelValue":g[0]||(g[0]=a=>e.isRef(d)?d.value=a:null)},null,8,["options","modelValue"]),e.createVNode(s,{class:"mt-2","empty-value":0,options:e.unref(r),"text-name":"Name","value-name":"UserID",modelValue:e.unref(N),"onUpdate:modelValue":g[1]||(g[1]=a=>e.isRef(N)?N.value=a:null)},null,8,["options","modelValue"])]),e.createElementVNode("div",Dg,[g[4]||(g[4]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:u,disabled:e.unref(x),type:"button"},"確認",8,Sg)])])])])],512)]))],64)}}},Fg={key:0,class:"scroll-bottom-panel"},Ug={class:"d-flex flex-column gap-3 mb-3"},Mg={key:0,class:"d-flex gap-2 align-items-center"},Pg={key:1,class:"d-flex gap-2 align-items-center"},Ig={class:"d-flex gap-2"},jg={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Og={class:"text-nowrap my-2 d-flex align-items-center"},Lg=["disabled"],Rg={__name:"ProjectPaymentReview",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=B,x=Y(),m=[{value:1,text:"通過"},{value:2,text:"退回修改"}],V=e.computed(()=>!x.stage),N=e.ref({}),r=e.ref({ID:_.id,Result:1,Reason:""}),o=e.computed(()=>r.value.Result===1?["culture","literacy","accessibility"].includes(_.type)&&x.stage===2||_.type==="education"||_.type==="multiple"&&x.stage===3?"確定撥款及結案核銷":"確定撥款":"確定退回"),l=()=>{const k={};if(r.value.Result>1&&(k.Reason="原因"),N.value=P(r.value,k),Object.keys(N.value).length){d();return}r.value.Stage=x.stage,U[_.type]("reviewPayment",r.value).subscribe(E=>{E&&(window.location.href="../ReviewChecklist.aspx?type=5")})},d=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>r.value.Result,k=>{k>1&&d()}),e.watch(()=>x.amount,k=>r.value.Amount=k),(k,E)=>{const u=e.resolveComponent("input-integer"),h=e.resolveComponent("input-radio-group"),g=e.resolveComponent("input-textarea");return e.unref(x).status==="審核中"?(e.openBlock(),e.createElementBlock("div",Fg,[E[6]||(E[6]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ug,[e.unref(x).amount?(e.openBlock(),e.createElementBlock("li",Mg,[E[3]||(E[3]=e.createElementVNode("span",{class:"text-gray"},"本期撥付：",-1)),e.createVNode(u,{class:"w-auto",max:e.unref(x).amount,modelValue:e.unref(r).Amount,"onUpdate:modelValue":E[0]||(E[0]=s=>e.unref(r).Amount=s)},null,8,["max","modelValue"])])):e.createCommentVNode("",!0),e.unref(x).paid?(e.openBlock(),e.createElementBlock("li",Pg,[E[4]||(E[4]=e.createElementVNode("span",{class:"text-gray"},"前期累積撥付：",-1)),e.createTextVNode(" "+e.toDisplayString(e.unref(x).paid.toLocaleString()),1)])):e.createCommentVNode("",!0),e.createElementVNode("li",Ig,[E[5]||(E[5]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",jg,[e.createElementVNode("div",Og,[e.createVNode(h,{options:m,modelValue:e.unref(r).Result,"onUpdate:modelValue":E[1]||(E[1]=s=>e.unref(r).Result=s)},null,8,["modelValue"])]),e.unref(r).Result>1?(e.openBlock(),e.createBlock(g,{key:0,error:e.unref(N).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(r).Reason,"onUpdate:modelValue":E[2]||(E[2]=s=>e.unref(r).Reason=s)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:l,disabled:e.unref(V),type:"button"},e.toDisplayString(e.unref(o)),9,Lg)])):e.createCommentVNode("",!0)}}},qg={class:"step-line-wrapper"},zg={class:"step-line"},Gg={key:0,class:"tag tag-white"},Jg={key:1,class:"tag tag-white"},Yg={key:0,class:"step-line"},Qg={key:0,class:"tag tag-white"},Wg={class:"step-line"},Hg={key:0,class:"tag tag-white"},Xg={key:0,class:"tag tag-white"},Kg={__name:"ProjectProgress",props:{excludes:{default:[],type:Array},id:{type:[Number,String]},step:{required:!0,type:Number},type:{required:!0,type:String}},setup(B){const _=j(),x=B,m=V=>{location.href=`${V}.aspx?ID=${x.id}`};return(V,N)=>(e.openBlock(),e.createElementBlock("div",qg,[e.createElementVNode("div",zg,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:B.step===1}]),onClick:N[0]||(N[0]=r=>m("Audit")),role:"button"},[N[4]||(N[4]=e.createElementVNode("div",{class:"step-line-item-title"},"核定計畫",-1)),B.step===1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[[1,4].includes(e.unref(_)[x.type].changeStatus)?(e.openBlock(),e.createElementBlock("div",Gg,"編輯中")):e.unref(_)[x.type].changeStatus===2?(e.openBlock(),e.createElementBlock("div",Jg,"審核中")):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],2)]),B.excludes.includes(4)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Yg,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:B.step===4}]),onClick:N[1]||(N[1]=r=>m("Progress")),role:"button"},[N[5]||(N[5]=e.createElementVNode("div",{class:"step-line-item-title"},"每月進度",-1)),B.step===4?(e.openBlock(),e.createElementBlock("div",Qg,"編輯中")):e.createCommentVNode("",!0)],2)])),e.createElementVNode("div",Wg,[e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:B.step===5}]),onClick:N[2]||(N[2]=r=>m("Report")),role:"button"},[N[6]||(N[6]=e.createElementVNode("div",{class:"step-line-item-title"},"階段報告",-1)),B.step===5?(e.openBlock(),e.createElementBlock("div",Hg,"編輯中")):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(["step-line-item",{active:B.step===6}]),onClick:N[3]||(N[3]=r=>m("Payment")),role:"button"},[N[7]||(N[7]=e.createElementVNode("div",{class:"step-line-item-title"},"請款核銷",-1)),B.step===6?(e.openBlock(),e.createElementBlock("div",Xg,"編輯中")):e.createCommentVNode("",!0)],2)])]))}},Zg={class:"block"},vg={class:"square-title"},ek=["innerHTML"],tk={class:"table-responsive mt-3"},lk={class:"table align-middle gray-table"},ok={class:"text-center"},nk=["href"],rk={key:0,class:"text-center"},ak={key:0},sk={key:1,class:"text-pink"},dk={key:1,class:"tag-group mt-2 gap-1"},ck={key:0,class:"tag tag-green-light"},ik=["download","href"],mk=["onClick"],pk={key:0,class:"block-bottom bg-light-teal"},Vk=["disabled"],fk={__name:"ProjectReport",props:{data:{required:!0,type:Object},id:{type:[Number,String]},type:{type:String}},emits:["next"],setup(B,{emit:_}){let x;const m=B,V=e.computed(()=>N.value.some(h=>!h.Optional&&!h.Files.filter(g=>!g.Deleted).length)),N=e.ref(m.data.docs.map(h=>({...h,Files:[]}))),r=e.ref(),o=e.ref({}),l=(h,g)=>{g.Type==="application/zip"&&h.Files.push({Type:h.Type,Path:g.Path,Name:`${m.id}_${h.Title}_${x}.zip`})},d=U.download,k=_,E=()=>{U[m.type]("getReport",{ID:m.id,Stage:m.data.id}).subscribe(h=>{var g;o.value=h.Report,N.value.forEach(s=>{s.Files=h.Attachments.filter(a=>a.Type===s.Type),s.Uploaded=e.computed(()=>s.Files.filter(a=>!a.Deleted).length)}),r.value=!o.value.Status||o.value.Status==="暫存",x=(g=o.value)!=null&&g.Reviewer?"修訂版":"初版",j().init(m.type,h.Project,o.value)})},u=h=>{const g={ID:m.id,Stage:m.data.id,Attachments:N.value.reduce((s,a)=>s.concat(a.Files),[]),Submit:h?"true":"false"};U[m.type]("saveReport",g).subscribe(()=>{h?k("next"):E()})};return e.onMounted(E),e.provide("editable",r),(h,g)=>{const s=e.resolveComponent("required-label"),a=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Zg,[e.createElementVNode("h5",vg,e.toDisplayString(B.data.subtitle),1),e.createElementVNode("p",{class:"text-pink mt-3 lh-base",innerHTML:B.data.description},null,8,ek),e.createElementVNode("div",tk,[e.createElementVNode("table",lk,[g[4]||(g[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"70",class:"text-center"},"附件編號"),e.createElementVNode("th",null,"附件名稱"),e.createElementVNode("th",{class:"text-center"},"狀態"),e.createElementVNode("th",null,"上傳附件")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(y,i)=>(e.openBlock(),e.createElementBlock("tr",{key:y},[e.createElementVNode("td",ok,e.toDisplayString(i+1),1),e.createElementVNode("td",null,[e.createElementVNode("div",null,[e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y.Title),1)]),_:2},1024)]),e.unref(r)&&y.Template?(e.openBlock(),e.createElementBlock("a",{key:0,class:"btn btn-sm btn-teal-dark rounded-pill mt-2",href:y.Template,style:{width:"140px"},type:"button"},[...g[2]||(g[2]=[e.createElementVNode("i",{class:"fas fa-file-download me-1"},null,-1),e.createTextVNode("範本下載 ",-1)])],8,nk)):e.createCommentVNode("",!0)]),e.unref(r)?(e.openBlock(),e.createElementBlock("td",rk,[y.Uploaded?(e.openBlock(),e.createElementBlock("span",ak,"已上傳")):(e.openBlock(),e.createElementBlock("span",sk,"尚未上傳"))])):e.createCommentVNode("",!0),e.createElementVNode("td",null,[e.unref(r)&&!y.Uploaded?(e.openBlock(),e.createBlock(a,{key:0,accept:".zip",onFile:n=>l(y,n)},null,8,["onFile"])):e.createCommentVNode("",!0),y.Uploaded?(e.openBlock(),e.createElementBlock("div",dk,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.Files,n=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:n},[n.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",ck,[e.createElementVNode("a",{class:"tag-link my-1",download:n.Name,href:e.unref(d)(n.Path)},e.toDisplayString(n.Name),9,ik),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"tag-btn",onClick:c=>n.Deleted=!0,type:"button"},[...g[3]||(g[3]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,mk)):e.createCommentVNode("",!0)]))],64))),128))])):e.createCommentVNode("",!0)])]))),128))])])])]),e.unref(r)?(e.openBlock(),e.createElementBlock("div",pk,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:g[0]||(g[0]=y=>u()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:g[1]||(g[1]=y=>u(!0)),disabled:e.unref(V),type:"button"},[...g[5]||(g[5]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("提送",-1)])],8,Vk)])):e.createCommentVNode("",!0)],64)}}},Nk={key:0,class:"scroll-bottom-panel"},Ek={class:"d-flex flex-column gap-3 mb-3"},bk={class:"d-flex gap-2"},gk={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},kk={class:"text-nowrap my-2 d-flex align-items-center"},yk={__name:"ProjectReportReview",props:{id:{type:[Number,String]},stage:{type:Number},type:{type:String}},setup(B){const _=B,x=j(),m=[{value:1,text:"通過"},{value:2,text:"退回修改"}],V=e.ref({}),N=e.ref({ID:_.id,Result:1}),r=()=>{const l={};if(N.value.Result>1&&(l.Reason="原因"),V.value=P(N.value,l),Object.keys(V.value).length){o();return}N.Stage=_.stage,U[_.type]("reviewReport",N.value).subscribe(d=>{d&&(window.location.href="../ReviewChecklist.aspx?type=6")})},o=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,l=>{l>1&&o()}),(l,d)=>{const k=e.resolveComponent("input-radio-group"),E=e.resolveComponent("input-textarea");return e.unref(x)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",Nk,[d[3]||(d[3]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",Ek,[e.createElementVNode("li",bk,[d[2]||(d[2]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",gk,[e.createElementVNode("div",kk,[e.createVNode(k,{options:m,modelValue:e.unref(N).Result,"onUpdate:modelValue":d[0]||(d[0]=u=>e.unref(N).Result=u)},null,8,["modelValue"])]),e.unref(N).Result>1?(e.openBlock(),e.createBlock(E,{key:0,error:e.unref(V).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":d[1]||(d[1]=u=>e.unref(N).Reason=u)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:r,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},uk={key:0,class:"scroll-bottom-panel"},xk={class:"d-flex flex-column gap-3 mb-3"},hk={class:"d-flex gap-2"},$k={class:"d-flex flex-column gap-2 align-items-start flex-grow-1 checkPass"},Bk={class:"text-nowrap mb-2 d-flex align-items-center"},_k={key:0,class:"invalid mt-0"},Ck={__name:"ProjectReview",props:{id:{type:Number},type:{type:String}},setup(B){const _=B,x=j(),m=[{value:1,text:"通過"},{value:2,text:"不通過"},{value:3,text:"退回補正補件"}],V=e.ref({}),N=e.ref({ID:_.id,Result:1}),r=()=>{},o=()=>{},l=()=>{const k={};if(N.value.Result>1&&(k.Reason="原因"),N.value.Result===3&&(k.CorrectionDeadline="補正期限"),V.value=P(N.value,k),Object.keys(V.value).length){d();return}U[_.type]("reviewApplication",N.value).subscribe(E=>{E&&(window.location.href="../ReviewChecklist.aspx?type=1")})},d=()=>setTimeout(()=>document.querySelector(".mis-content").scrollTop=1e6);return e.watch(()=>N.value.Result,k=>{k>1&&d()}),(k,E)=>{const u=e.resolveComponent("input-radio-group"),h=e.resolveComponent("input-tw-date"),g=e.resolveComponent("input-textarea");return e.unref(x)[B.type].organizer?(e.openBlock(),e.createElementBlock("div",uk,[E[9]||(E[9]=e.createElementVNode("h5",{class:"text-pink fs-18 fw-bold mb-3"},"審查結果",-1)),e.createElementVNode("ul",xk,[e.createElementVNode("li",{class:"d-flex gap-2"},[E[3]||(E[3]=e.createElementVNode("span",{class:"text-gray"},"同單位申請計畫數 :",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:r,href:"javascript:void(0)"},"3")]),e.createElementVNode("li",{class:"d-flex gap-2"},[E[6]||(E[6]=e.createElementVNode("span",{class:"text-gray"},"風險評估 :",-1)),E[7]||(E[7]=e.createElementVNode("span",{class:"text-pink"},"中風險",-1)),e.createElementVNode("span",null,[E[4]||(E[4]=e.createTextVNode("( ",-1)),e.createElementVNode("a",{class:"link-teal fw-bold",onClick:o,href:"javascript:void(0)"},"1"),E[5]||(E[5]=e.createTextVNode(" 筆記錄 )",-1))])]),e.createElementVNode("li",hk,[E[8]||(E[8]=e.createElementVNode("span",{class:"text-gray mt-2"},"審查結果：",-1)),e.createElementVNode("div",$k,[e.createElementVNode("div",Bk,[e.createVNode(u,{options:m,modelValue:e.unref(N).Result,"onUpdate:modelValue":E[0]||(E[0]=s=>e.unref(N).Result=s)},null,8,["modelValue"]),e.createVNode(h,{class:"form-control",drops:"up",modelValue:e.unref(N).CorrectionDeadline,"onUpdate:modelValue":E[1]||(E[1]=s=>e.unref(N).CorrectionDeadline=s)},null,8,["modelValue"])]),e.unref(V).CorrectionDeadline?(e.openBlock(),e.createElementBlock("div",_k,e.toDisplayString(e.unref(V).CorrectionDeadline),1)):e.createCommentVNode("",!0),e.unref(N).Result>1?(e.openBlock(),e.createBlock(g,{key:1,error:e.unref(V).Reason,placeholder:"請輸入原因",rows:"4",modelValue:e.unref(N).Reason,"onUpdate:modelValue":E[2]||(E[2]=s=>e.unref(N).Reason=s)},null,8,["error","modelValue"])):e.createCommentVNode("",!0)])])]),e.createElementVNode("button",{class:"btn btn-teal d-table mx-auto",onClick:l,type:"button"},"確定")])):e.createCommentVNode("",!0)}}},Tk={class:"top-wrapper"},wk={class:"top-block"},Dk={class:"d-flex align-items-center gap-3"},Sk={__name:"ProjectTitle",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=B,x=j();return(m,V)=>(e.openBlock(),e.createElementBlock("div",Tk,[e.createElementVNode("div",wk,[e.createElementVNode("div",Dk,[e.createElementVNode("span",null,"［"+e.toDisplayString(e.unref(x)[_.type].type)+"］"+e.toDisplayString(e.unref(x)[_.type].id)+"/"+e.toDisplayString(e.unref(x)[_.type].name),1)]),V[0]||(V[0]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"}," 查核紀錄 ",-1))])]))}},Ak={class:"block rounded-top-4 py-4 d-flex justify-content-between",style:{position:"sticky",top:"180px","z-index":"15"}},Fk={class:"d-flex gap-2"},Uk={key:0,class:"btn text-teal-dark",type:"button"},Mk={class:"d-flex gap-2"},Pk={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Ik={class:"modal-content"},jk={class:"modal-body"},Ok={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-md"},Lk={class:"modal-content"},Rk={class:"modal-body"},qk={class:"d-flex flex-column gap-4 mb-5"},zk={class:"d-flex align-items-center"},Gk={class:"flex-grow-1"},Jk={__name:"ProjectToolbar",props:{id:{type:[Number,String]},type:{type:String}},setup(B){const _=j(),x=B,m=e.ref({}),V=e.ref(),N=e.ref({}),r=e.ref(),o=e.ref({}),l=e.ref(),d=()=>{const g={Reason:"計畫變更原因"};N.value=P(m.value,g),!Object.keys(N.value).length&&U[x.type]("applyChange",m.value).subscribe(s=>{s&&location.reload()})},k=()=>{m.value={ID:x.id},bootstrap.Modal.getOrCreateInstance(V.value).show()},E=()=>{bootstrap.Modal.getOrCreateInstance(r.value).show()},u=()=>{o.value={ID:x.id},bootstrap.Modal.getOrCreateInstance(l.value).show()},h=()=>{const g={RejectReason:"計畫終止原因",RecoveryAmount:"已追回金額"};N.value=P(o.value,g),!Object.keys(N.value).length&&U[x.type]("terminate",o.value).subscribe(s=>{s&&(location.href="../ApplicationChecklist.aspx")})};return(g,s)=>{const a=e.resolveComponent("project-organizer"),y=e.resolveComponent("input-textarea"),i=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ak,[e.createElementVNode("div",Fk,[e.unref(_)[x.type].changeStatus?(e.openBlock(),e.createElementBlock("button",Uk," 計畫變更申請中 ")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-teal-dark",onClick:k,type:"button"}," 計畫變更申請 ")),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:E,type:"button"},[...s[3]||(s[3]=[e.createElementVNode("i",{class:"fas fa-history"},null,-1),e.createTextVNode(" 計畫變更紀錄 ",-1)])]),s[4]||(s[4]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-download"}),e.createTextVNode(" 下載核定計畫書 ")],-1))]),e.createElementVNode("div",Mk,[e.createVNode(a,{id:B.id,type:B.type},null,8,["id","type"]),e.createElementVNode("button",{class:"btn btn-pink",onClick:u,type:"button"}," 計畫終止 ")])]),(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"applyModal",ref:V,tabindex:"-1"},[e.createElementVNode("div",Pk,[e.createElementVNode("div",Ik,[s[8]||(s[8]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更申請"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",jk,[s[6]||(s[6]=e.createElementVNode("p",{class:"text-pink lh-base py-3"},"提醒您：計畫變更審核通過後，每月進度資料將清空，必須重填！",-1)),s[7]||(s[7]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫變更原因",-1)),e.createVNode(y,{error:e.unref(N).Reason,modelValue:e.unref(m).Reason,"onUpdate:modelValue":s[0]||(s[0]=n=>e.unref(m).Reason=n),modelModifiers:{trim:!0}},null,8,["error","modelValue"]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[s[5]||(s[5]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:d},"確定變更")])])])])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"logModal",ref:r,tabindex:"-1"},[...s[9]||(s[9]=[e.createElementVNode("div",{class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"},[e.createElementVNode("div",{class:"modal-content"},[e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫變更紀錄"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])]),e.createElementVNode("div",{class:"modal-body"},[e.createElementVNode("div",{class:"table-responsive"},[e.createElementVNode("table",{class:"table align-middle gray-table lh-base"},[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"150"},"版次"),e.createElementVNode("th",{width:"150"},"變更時間"),e.createElementVNode("th",null,"變更者"),e.createElementVNode("th",null,"變更原因"),e.createElementVNode("th",null,"變更前"),e.createElementVNode("th",null,"變更後")])]),e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("td",null,"核定版"),e.createElementVNode("td",null,"114/04/10"),e.createElementVNode("td",null,"劉申慶"),e.createElementVNode("td",null,"意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容意見內容"),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")]),e.createElementVNode("td",null,[e.createTextVNode("【期程／工作項目／查核】"),e.createElementVNode("br"),e.createTextVNode(" 1.OO資料，原為OOOOOOOO"),e.createElementVNode("br"),e.createTextVNode(" 2.OO資料，原為OOOOOOOO ")])])])])])])])],-1)])],512),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"terminateModal",ref:l,tabindex:"-1"},[e.createElementVNode("div",Ok,[e.createElementVNode("div",Lk,[s[14]||(s[14]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 text-green-light fw-bold"},"計畫終止"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Rk,[e.createElementVNode("div",qk,[e.createElementVNode("div",null,[s[10]||(s[10]=e.createElementVNode("div",{class:"text-gray pb-2"},"計畫終止原因：",-1)),e.createVNode(y,{error:e.unref(N).RejectReason,modelValue:e.unref(o).RejectReason,"onUpdate:modelValue":s[1]||(s[1]=n=>e.unref(o).RejectReason=n),modelModifiers:{trim:!0}},null,8,["error","modelValue"])]),s[12]||(s[12]=e.createElementVNode("div",{class:"d-flex align-items-center"},[e.createElementVNode("div",{class:"text-gray text-nowrap"},"已撥款："),e.createElementVNode("div",null,"700,000")],-1)),e.createElementVNode("div",zk,[s[11]||(s[11]=e.createElementVNode("div",{class:"text-gray text-nowrap"},"已追回：",-1)),e.createElementVNode("div",Gk,[e.createVNode(i,{error:e.unref(N).RecoveryAmount,modelValue:e.unref(o).RecoveryAmount,"onUpdate:modelValue":s[2]||(s[2]=n=>e.unref(o).RecoveryAmount=n),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])]),e.createElementVNode("div",{class:"d-flex justify-content-center mt-4 gap-4"},[s[13]||(s[13]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:h},"送出")])])])])],512)]))],64)}}},Yk={class:"search bg-gray mt-4"},Qk={class:"search-form"},Wk={class:"row g-3"},Hk={class:"col-12 col-lg-4"},Xk=["value"],Kk={class:"col-12 col-lg-4"},Zk=["value"],vk={class:"row g-3"},ey={class:"col-12 col-lg-6"},ty={class:"col-12 col-lg-6"},ly={class:"total-list multiple-option"},oy={class:"all-total"},ny={class:"total-item-content"},ry={class:"count"},ay=["for"],sy={class:"total-item-title"},dy={class:"total-item-content"},cy={class:"count"},iy=["id","onUpdate:modelValue"],my={class:"block rounded-bottom-4"},py={class:"title border-teal"},Vy={class:"d-flex align-items-center gap-2"},fy={class:"text-teal"},Ny={class:"table-responsive",style:{"min-height":"400px"}},Ey={class:"table teal-table"},by={class:"total-row"},gy={class:"text-end"},ky={class:"text-end"},yy={class:"text-end"},uy={"data-th":"年度:"},xy={"data-th":"類別:"},hy={"data-th":"計畫名稱:",style:{"text-align":"left"}},$y=["href"],By={"data-th":"申請單位:",style:{"text-align":"left"}},_y={"data-th":"申請本會補助:",class:"text-end"},Cy={"data-th":"配合款:",class:"text-end"},Ty={"data-th":"總經費:",class:"text-end"},wy={"data-th":"狀態:",style:{"text-align":"center",width:"100px"}},Dy={class:"text-teal"},Sy={__name:"ApplyList",setup(B){const _=e.ref([{id:1,title:"申請中",checked:!0},{id:2,title:"審查中",checked:!0},{id:3,title:"已核定",checked:!0},{id:4,title:"未通過",checked:!0}]),x=e.ref([]),m=e.ref({}),V=e.ref([]),N=e.ref(1),r=e.ref(10),o=e.ref([]),l=e.computed(()=>k.value.filter(h=>_.value.find(g=>g.checked&&h.type===g.id))),d=e.computed(()=>l.value.slice((N.value-1)*r.value,N.value*r.value)),k=e.computed(()=>{let h=V.value;return m.value.category&&(h=h.filter(g=>g.Category===m.value.category)),m.value.unit&&(h=h.filter(g=>g.SupervisoryUnit===m.value.unit)),m.value.org&&(h=h.filter(g=>{var s;return(s=g.UserOrg)==null?void 0:s.includes(m.value.org)})),m.value.name&&(h=h.filter(g=>{var s;return g.ProjectID.includes(m.value.name)||((s=g.ProjectName)==null?void 0:s.includes(m.value.name))})),h}),E=(h,g)=>{N.value=parseInt(h),r.value=parseInt(g)},u=h=>{if(h.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${h.ProjectID}`;if(h.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${h.ProjectID}`};return e.onMounted(()=>{U.system("getApplyList").subscribe(h=>{V.value=h.List,V.value.forEach(g=>{[1,14].includes(g.Status)?g.type=1:[11,12,21,22,31,32,41,42,43,44].includes(g.Status)?g.type=2:[45,51,52,91].includes(g.Status)?g.type=3:g.type=4,x.value.includes(g.Category)||x.value.push(g.Category),o.value.includes(g.SupervisoryUnit)||o.value.push(g.SupervisoryUnit)})})}),(h,g)=>{const s=e.resolveComponent("input-text"),a=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Yk,[g[12]||(g[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Qk,[e.createElementVNode("div",Wk,[g[8]||(g[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",Hk,[g[5]||(g[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":g[0]||(g[0]=y=>e.unref(m).category=y)},[g[4]||(g[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),y=>(e.openBlock(),e.createElementBlock("option",{key:y,value:y},e.toDisplayString(y),9,Xk))),128))],512),[[e.vModelSelect,e.unref(m).category]])]),e.createElementVNode("div",Kk,[g[7]||(g[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":g[1]||(g[1]=y=>e.unref(m).unit=y)},[g[6]||(g[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),y=>(e.openBlock(),e.createElementBlock("option",{key:y,value:y},e.toDisplayString(y),9,Zk))),128))],512),[[e.vModelSelect,e.unref(m).unit]])])]),e.createElementVNode("div",vk,[e.createElementVNode("div",ey,[g[9]||(g[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(s,{modelValue:e.unref(m).org,"onUpdate:modelValue":g[2]||(g[2]=y=>e.unref(m).org=y),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",ty,[g[10]||(g[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(s,{modelValue:e.unref(m).name,"onUpdate:modelValue":g[3]||(g[3]=y=>e.unref(m).name=y),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),g[11]||(g[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("ul",ly,[e.createElementVNode("li",oy,[g[14]||(g[14]=e.createElementVNode("div",{class:"total-item-title"},"總申請",-1)),e.createElementVNode("div",ny,[e.createElementVNode("span",ry,e.toDisplayString(e.unref(k).length),1),g[13]||(g[13]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),y=>(e.openBlock(),e.createElementBlock("li",{class:"total-item",key:y},[e.createElementVNode("label",{class:"checke-total",for:`apply-${y.id}`},[e.createElementVNode("div",null,[e.createElementVNode("div",sy,e.toDisplayString(y.title),1),e.createElementVNode("div",dy,[e.createElementVNode("span",cy,e.toDisplayString(e.unref(k).filter(i=>i.type===y.id).length),1),g[15]||(g[15]=e.createElementVNode("span",{class:"unit"},"件",-1))])]),g[16]||(g[16]=e.createElementVNode("img",{class:"check-icon",src:"../../assets/img/check-white.svg"},null,-1))],8,ay),e.withDirectives(e.createElementVNode("input",{class:"total-checkbox",id:`apply-${y.id}`,type:"checkbox","onUpdate:modelValue":i=>y.checked=i},null,8,iy),[[e.vModelCheckbox,y.checked]])]))),128))]),e.createElementVNode("div",my,[e.createElementVNode("div",py,[e.createElementVNode("div",Vy,[g[19]||(g[19]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[g[17]||(g[17]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",fy,e.toDisplayString(e.unref(l).length),1),g[18]||(g[18]=e.createTextVNode(" 筆資料",-1))])]),g[20]||(g[20]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Ny,[e.createElementVNode("table",Ey,[e.createElementVNode("thead",null,[g[23]||(g[23]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"申請本會補助")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"總經費")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"狀態")])])],-1)),e.createElementVNode("tr",by,[g[21]||(g[21]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",gy,e.toDisplayString(e.unref(l).reduce((y,i)=>y+i.ApplyAmount,0).toLocaleString()),1),e.createElementVNode("td",ky,e.toDisplayString(e.unref(l).reduce((y,i)=>y+i.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",yy,e.toDisplayString(e.unref(l).reduce((y,i)=>y+i.ApplyAmount+i.OtherAmount,0).toLocaleString()),1),g[22]||(g[22]=e.createElementVNode("td",null,null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),y=>(e.openBlock(),e.createElementBlock("tr",{key:y},[e.createElementVNode("td",uy,e.toDisplayString(y.Year),1),e.createElementVNode("td",xy,e.toDisplayString(y.Category),1),e.createElementVNode("td",hy,[e.createElementVNode("a",{class:"link-black",href:u(y),target:"_blank"},e.toDisplayString(y.ProjectName||"[未設定]"),9,$y)]),e.createElementVNode("td",By,e.toDisplayString(y.UserOrg),1),e.createElementVNode("td",_y,e.toDisplayString(y.ApplyAmount.toLocaleString()),1),e.createElementVNode("td",Cy,e.toDisplayString(y.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Ty,e.toDisplayString((y.ApplyAmount+y.OtherAmount).toLocaleString()),1),e.createElementVNode("td",wy,[e.createElementVNode("span",Dy,e.toDisplayString(e.unref(_).find(i=>i.id===y.type).title),1)])]))),128))])])]),e.createVNode(a,{count:e.unref(l).length,onChange:E,page:e.unref(N),"page-size":e.unref(r)},null,8,["count","page","page-size"])])],64)}}},Ay={class:"search bg-gray mt-4"},Fy={class:"search-form"},Uy={class:"row g-3"},My={class:"col-12 col-lg-4"},Py=["value"],Iy={class:"col-12 col-lg-4"},jy=["value"],Oy={class:"row g-3"},Ly={class:"col-12 col-lg-6"},Ry={class:"col-12 col-lg-6"},qy={class:"block rounded-bottom-4"},zy={class:"title border-teal"},Gy={class:"d-flex align-items-center gap-2"},Jy={class:"text-teal"},Yy={class:"table-responsive",style:{"min-height":"400px"}},Qy={class:"table teal-table"},Wy={class:"total-row"},Hy={class:"text-end"},Xy={class:"text-end"},Ky={"data-th":"年度:"},Zy={"data-th":"類別:"},vy={"data-th":"計畫名稱:",style:{"text-align":"left"}},eu=["href"],tu={"data-th":"申請單位:",style:{"text-align":"left"}},lu={"data-th":"本會補助金額:",class:"text-end"},ou={"data-th":"配合款:",class:"text-end"},nu={__name:"ApprovedList",setup(B){const _=e.ref([]),x=e.ref({}),m=e.ref([]),V=e.ref(1),N=e.ref(10),r=e.ref([]),o=e.computed(()=>l.value.slice((V.value-1)*N.value,V.value*N.value)),l=e.computed(()=>{let E=m.value;return x.value.category&&(E=E.filter(u=>u.Category===x.value.category)),x.value.unit&&(E=E.filter(u=>u.SupervisoryUnit===x.value.unit)),x.value.org&&(E=E.filter(u=>{var h;return(h=u.UserOrg)==null?void 0:h.includes(x.value.org)})),x.value.name&&(E=E.filter(u=>{var h;return u.ProjectID.includes(x.value.name)||((h=u.ProjectName)==null?void 0:h.includes(x.value.name))})),E}),d=(E,u)=>{V.value=parseInt(E),N.value=parseInt(u)},k=E=>{if(E.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${E.ProjectID}`;if(E.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${E.ProjectID}`};return e.onMounted(()=>{U.system("getApprovedList").subscribe(E=>{m.value=E.List,m.value.forEach(u=>{_.value.includes(u.Category)||_.value.push(u.Category),r.value.includes(u.SupervisoryUnit)||r.value.push(u.SupervisoryUnit)})})}),(E,u)=>{const h=e.resolveComponent("input-text"),g=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Ay,[u[12]||(u[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",Fy,[e.createElementVNode("div",Uy,[u[8]||(u[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",My,[u[5]||(u[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":u[0]||(u[0]=s=>e.unref(x).category=s)},[u[4]||(u[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),s=>(e.openBlock(),e.createElementBlock("option",{key:s,value:s},e.toDisplayString(s),9,Py))),128))],512),[[e.vModelSelect,e.unref(x).category]])]),e.createElementVNode("div",Iy,[u[7]||(u[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":u[1]||(u[1]=s=>e.unref(x).unit=s)},[u[6]||(u[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),s=>(e.openBlock(),e.createElementBlock("option",{key:s,value:s},e.toDisplayString(s),9,jy))),128))],512),[[e.vModelSelect,e.unref(x).unit]])])]),e.createElementVNode("div",Oy,[e.createElementVNode("div",Ly,[u[9]||(u[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(h,{modelValue:e.unref(x).org,"onUpdate:modelValue":u[2]||(u[2]=s=>e.unref(x).org=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Ry,[u[10]||(u[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(h,{modelValue:e.unref(x).name,"onUpdate:modelValue":u[3]||(u[3]=s=>e.unref(x).name=s),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),u[11]||(u[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",qy,[e.createElementVNode("div",zy,[e.createElementVNode("div",Gy,[u[15]||(u[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[u[13]||(u[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",Jy,e.toDisplayString(e.unref(l).length),1),u[14]||(u[14]=e.createTextVNode(" 筆資料",-1))])]),u[16]||(u[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",Yy,[e.createElementVNode("table",Qy,[e.createElementVNode("thead",null,[u[18]||(u[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])])],-1)),e.createElementVNode("tr",Wy,[u[17]||(u[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",Hy,e.toDisplayString(e.unref(l).reduce((s,a)=>s+a.ApprovedAmount,0).toLocaleString()),1),e.createElementVNode("td",Xy,e.toDisplayString(e.unref(l).reduce((s,a)=>s+a.OtherAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),s=>(e.openBlock(),e.createElementBlock("tr",{key:s},[e.createElementVNode("td",Ky,e.toDisplayString(s.Year),1),e.createElementVNode("td",Zy,e.toDisplayString(s.Category),1),e.createElementVNode("td",vy,[e.createElementVNode("a",{class:"link-black",href:k(s),target:"_blank"},e.toDisplayString(s.ProjectName),9,eu)]),e.createElementVNode("td",tu,e.toDisplayString(s.UserOrg),1),e.createElementVNode("td",lu,e.toDisplayString(s.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",ou,e.toDisplayString(s.OtherAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(g,{count:e.unref(l).length,onChange:d,page:e.unref(V),"page-size":e.unref(N)},null,8,["count","page","page-size"])])],64)}}},ru={class:"search bg-gray mt-4"},au={class:"search-form"},su={class:"row g-3"},du={class:"col-12 col-lg-4"},cu=["value"],iu={class:"col-12 col-lg-4"},mu=["value"],pu={class:"row g-3"},Vu={class:"col-12 col-lg-6"},fu={class:"col-12 col-lg-6"},Nu={class:"block rounded-bottom-4"},Eu={class:"title border-teal"},bu={class:"d-flex align-items-center gap-2"},gu={class:"text-teal"},ku={class:"table-responsive",style:{"min-height":"400px"}},yu={class:"table teal-table"},uu={class:"total-row"},xu={class:"text-end"},hu={class:"text-end"},$u={class:"text-end"},Bu={class:"text-end"},_u={class:"text-end"},Cu={"data-th":"年度:"},Tu={"data-th":"類別:"},wu={"data-th":"計畫名稱:",style:{"text-align":"left"}},Du=["href"],Su={"data-th":"申請單位:",style:{"text-align":"left"}},Au={"data-th":"本會補助金額:",class:"text-end"},Fu={"data-th":"配合款:",class:"text-end"},Uu={"data-th":"實支金額:",class:"text-end"},Mu={"data-th":"累積經費執行率:",class:"text-end"},Pu={"data-th":"本會已撥金額:",class:"text-end"},Iu={__name:"InprogressList",setup(B){const _=e.ref([]),x=e.ref({}),m=e.ref([]),V=e.ref(1),N=e.ref(10),r=e.ref([]),o=e.computed(()=>k.value.reduce((g,s)=>g+s.ApprovedAmount,0)),l=e.computed(()=>k.value.slice((V.value-1)*N.value,V.value*N.value)),d=e.computed(()=>k.value.reduce((g,s)=>g+s.SpendAmount,0)),k=e.computed(()=>{let g=m.value;return x.value.category&&(g=g.filter(s=>s.Category===x.value.category)),x.value.unit&&(g=g.filter(s=>s.SupervisoryUnit===x.value.unit)),x.value.org&&(g=g.filter(s=>{var a;return(a=s.UserOrg)==null?void 0:a.includes(x.value.org)})),x.value.name&&(g=g.filter(s=>{var a;return s.ProjectID.includes(x.value.name)||((a=s.ProjectName)==null?void 0:a.includes(x.value.name))})),g}),E=(g,s)=>{V.value=parseInt(g),N.value=parseInt(s)},u=g=>{if(g.ProjectID.includes("CUL"))return`../CUL/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("EDC"))return`../EDC/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("MUL"))return`../MUL/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("LIT"))return`../LIT/Application.aspx?ID=${g.ProjectID}`;if(g.ProjectID.includes("ACC"))return`../ACC/Application.aspx?ID=${g.ProjectID}`},h=(g,s)=>s?Math.round(g*100/s*100)/100:0;return e.onMounted(()=>{U.system("getInprogressList").subscribe(g=>{m.value=g.List,m.value.forEach(s=>{_.value.includes(s.Category)||_.value.push(s.Category),r.value.includes(s.SupervisoryUnit)||r.value.push(s.SupervisoryUnit)})})}),(g,s)=>{const a=e.resolveComponent("input-text"),y=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",ru,[s[12]||(s[12]=e.createElementVNode("h3",{class:"text-teal"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1)),e.createElementVNode("div",au,[e.createElementVNode("div",su,[s[8]||(s[8]=e.createElementVNode("div",{class:"col-12 col-lg-4"},[e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度"),e.createElementVNode("select",{class:"form-select"},[e.createElementVNode("option",null,"114年")])],-1)),e.createElementVNode("div",du,[s[5]||(s[5]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"類別",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[0]||(s[0]=i=>e.unref(x).category=i)},[s[4]||(s[4]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(_),i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,cu))),128))],512),[[e.vModelSelect,e.unref(x).category]])]),e.createElementVNode("div",iu,[s[7]||(s[7]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"主管單位",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=i=>e.unref(x).unit=i)},[s[6]||(s[6]=e.createElementVNode("option",{value:void 0},"全部",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,mu))),128))],512),[[e.vModelSelect,e.unref(x).unit]])])]),e.createElementVNode("div",pu,[e.createElementVNode("div",Vu,[s[9]||(s[9]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"申請補助單位",-1)),e.createVNode(a,{modelValue:e.unref(x).org,"onUpdate:modelValue":s[2]||(s[2]=i=>e.unref(x).org=i),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",fu,[s[10]||(s[10]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"計畫編號, 計畫名稱",-1)),e.createVNode(a,{modelValue:e.unref(x).name,"onUpdate:modelValue":s[3]||(s[3]=i=>e.unref(x).name=i),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),s[11]||(s[11]=e.createElementVNode("button",{class:"btn btn-teal-dark d-table mx-auto",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-magnifying-glass"}),e.createTextVNode(" 查詢 ")],-1))])]),e.createElementVNode("div",Nu,[e.createElementVNode("div",Eu,[e.createElementVNode("div",bu,[s[15]||(s[15]=e.createElementVNode("h4",{class:"text-teal"},[e.createElementVNode("img",{src:"../../assets/img/title-icon02-teal.svg",alt:"logo"}),e.createElementVNode("span",null,"列表")],-1)),e.createElementVNode("span",null,[s[13]||(s[13]=e.createTextVNode("共 ",-1)),e.createElementVNode("span",gu,e.toDisplayString(e.unref(k).length),1),s[14]||(s[14]=e.createTextVNode(" 筆資料",-1))])]),s[16]||(s[16]=e.createElementVNode("button",{class:"btn btn-teal-dark",type:"button"},[e.createElementVNode("i",{class:"fas fa-download"}),e.createTextVNode("匯出")],-1))]),e.createElementVNode("div",ku,[e.createElementVNode("table",yu,[e.createElementVNode("thead",null,[s[18]||(s[18]=e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80"},"年度"),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"類別")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"計畫名稱")])]),e.createElementVNode("th",{width:"240"},[e.createElementVNode("div",{class:"hstack align-items-center"},[e.createElementVNode("span",null,"申請單位")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會補助金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"配合款")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"實支金額")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"累積經費執行率")])]),e.createElementVNode("th",null,[e.createElementVNode("div",{class:"hstack align-items-center justify-content-end"},[e.createElementVNode("span",null,"本會已撥金額")])])],-1)),e.createElementVNode("tr",uu,[s[17]||(s[17]=e.createElementVNode("td",{colspan:"4",style:{"text-align":"end"}},"總計",-1)),e.createElementVNode("td",xu,e.toDisplayString(e.unref(o).toLocaleString()),1),e.createElementVNode("td",hu,e.toDisplayString(e.unref(k).reduce((i,n)=>i+n.OtherAmount,0).toLocaleString()),1),e.createElementVNode("td",$u,e.toDisplayString(e.unref(d).toLocaleString()),1),e.createElementVNode("td",Bu,e.toDisplayString(h(e.unref(d),e.unref(o)).toLocaleString())+"%",1),e.createElementVNode("td",_u,e.toDisplayString(e.unref(k).reduce((i,n)=>i+n.PaymentAmount,0).toLocaleString()),1)])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),i=>(e.openBlock(),e.createElementBlock("tr",{key:i},[e.createElementVNode("td",Cu,e.toDisplayString(i.Year),1),e.createElementVNode("td",Tu,e.toDisplayString(i.Category),1),e.createElementVNode("td",wu,[e.createElementVNode("a",{class:"link-black",href:u(i),target:"_blank"},e.toDisplayString(i.ProjectName),9,Du)]),e.createElementVNode("td",Su,e.toDisplayString(i.UserOrg),1),e.createElementVNode("td",Au,e.toDisplayString(i.ApprovedAmount.toLocaleString()),1),e.createElementVNode("td",Fu,e.toDisplayString(i.OtherAmount.toLocaleString()),1),e.createElementVNode("td",Uu,e.toDisplayString(i.SpendAmount.toLocaleString()),1),e.createElementVNode("td",Mu,e.toDisplayString(h(i.SpendAmount,i.ApprovedAmount).toLocaleString())+"%",1),e.createElementVNode("td",Pu,e.toDisplayString(i.PaymentAmount.toLocaleString()),1)]))),128))])])]),e.createVNode(y,{count:e.unref(k).length,onChange:E,page:e.unref(V),"page-size":e.unref(N)},null,8,["count","page","page-size"])])],64)}}},ju={__name:"MixChart",props:{list:{required:!0,type:Array}},setup(B){let _;const x=X().typeList,m=B,V=e.ref(),N=o=>{am5.ready(()=>{_=am5.Root.new(V.value),_.setThemes([am5themes_Animated.new(_)]);const l=_.container.children.push(am5xy.XYChart.new(_,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,layout:_.verticalLayout})),d=am5xy.AxisRendererX.new(_,{minGridDistance:30});d.labels.template.setAll({rotation:-45,centerY:am5.p50,centerX:am5.p100,textAlign:"right"});var k=l.xAxes.push(am5xy.CategoryAxis.new(_,{categoryField:"category",renderer:d,tooltip:am5.Tooltip.new(_,{})}));k.data.setAll(o);var E=l.yAxes.push(am5xy.ValueAxis.new(_,{renderer:am5xy.AxisRendererY.new(_,{})})),u=l.yAxes.push(am5xy.ValueAxis.new(_,{renderer:am5xy.AxisRendererY.new(_,{opposite:!0}),min:0,max:1,numberFormat:"#.0%",extraMax:.1,strictMinMax:!0}));const h=(i,n,c)=>{var f=l.series.push(am5xy.ColumnSeries.new(_,{name:n,xAxis:k,yAxis:E,valueYField:i,categoryXField:"category",clustered:!0,tooltip:am5.Tooltip.new(_,{labelText:"{name}: {valueY}"})}));return f.data.setAll(o),f.columns.template.setAll({fillOpacity:1,strokeOpacity:0,fill:am5.color(c),cornerRadiusTL:0,cornerRadiusTR:0,width:am5.percent(70)}),f};h("核定經費","核定經費",4946924),h("實支金額","實支金額",9323693),h("已撥付","已撥付",3447003);const g=(i,n,c)=>{var f=l.series.push(am5xy.LineSeries.new(_,{name:n,xAxis:k,yAxis:u,valueYField:i,categoryXField:"category",stroke:am5.color(c),fill:am5.color(c),tooltip:am5.Tooltip.new(_,{labelText:"{name}: {valueY.formatNumber('#.0%')}"})}));return f.strokes.template.setAll({strokeWidth:3}),f.bullets.push(()=>am5.Bullet.new(_,{sprite:am5.Circle.new(_,{radius:5,fill:f.get("stroke")})})),f.data.setAll(o),f};g("經費執行率(%)","經費執行率(%)",15105570),g("支用比(%)","支用比(%)",2600544),l.children.push(am5.Legend.new(_,{centerX:am5.p50,x:am5.p50,layout:_.horizontalLayout,useDefaultMarker:!0,maxWidth:300})).labels.template.setAll({fontSize:12,paddingLeft:4,paddingRight:4,marginTop:4,marginBottom:4,marginLeft:4,marginRight:4});var a=l.children.push(am5.Legend.new(_,{centerX:am5.p0,x:am5.p0,layout:_.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));a.data.setAll([l.series.getIndex(0),l.series.getIndex(1),l.series.getIndex(2)]);var y=l.children.push(am5.Legend.new(_,{centerX:am5.p100,x:am5.p100,layout:_.horizontalLayout,useDefaultMarker:!0,maxWidth:300}));y.data.setAll([l.series.getIndex(3),l.series.getIndex(4)]),l.set("cursor",am5xy.XYCursor.new(_,{}))})},r=(o,l,d=2)=>{if(l){const k=10**d;return Math.round(o*100/l*k)/k}return 0};return e.watch(()=>m.list,()=>{N(x.map(o=>{const l={category:o.title,核定經費:0,實支金額:0,已撥付:0,"經費執行率(%)":0,"支用比(%)":0},d=m.list.find(k=>k.Category===o.code);return d&&(l.核定經費=Math.floor(d.ApprovedAmount/1e3),l.實支金額=Math.floor(d.SpendAmount/1e3),l.已撥付=Math.floor(d.PaymentAmount/1e3),l["經費執行率(%)"]=r(l.實支金額,l.核定經費,1),l["支用比(%)"]=r(l.實支金額,l.已撥付,1)),l}))}),(o,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:V},null,512))}},Ou={__name:"PieChart",props:{active:{required:!0,type:String},color:{required:!0,type:Number},inactive:{required:!0,type:String},percent:{required:!0,type:Number}},setup(B){let _,x,m;const V=B,N=e.ref();return e.onMounted(()=>{am5.ready(()=>{x=am5.Root.new(N.value),x.setThemes([am5themes_Animated.new(x)]);const r=x.container.children.push(am5percent.PieChart.new(x,{innerRadius:95,width:158,x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,layout:x.verticalLayout}));m=r.series.push(am5percent.PieSeries.new(x,{valueField:"size",categoryField:"sector"})),m.set("colors",am5.ColorSet.new(x,{colors:[am5.color(V.color),am5.color(16119285)]})),m.labels.template.set("visible",!1),m.ticks.template.set("visible",!1),m.data.setAll([{sector:V.active,size:V.percent},{sector:V.inactive,size:100-V.percent}]),m.appear(1e3,100),_=x.tooltipContainer.children.push(am5.Label.new(x,{x:am5.p50,y:am5.p50,centerX:am5.p50,centerY:am5.p50,fill:am5.color(V.color),fontSize:28,fontWeight:"bold"})),_.set("text",`${V.percent}%`);const o=()=>{var l=window.innerWidth>=768&&window.innerWidth<=1024,d=l?105:158,k=l?55:95,E=l?20:28;r.set("width",d),r.set("innerRadius",k),_.set("fontSize",E)};o(),window.addEventListener("resize",o)})}),e.watch(()=>V.percent,r=>{_.set("text",`${r}%`),m.data.setAll([{sector:V.active,size:r},{sector:V.inactive,size:100-r}])}),(r,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"container",ref:N},null,512))}},Lu={key:0,class:"text-pink"},Ru={__name:"RequiredLabel",setup(B){const _=e.inject("editable",!0);return(x,m)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.unref(_)?(e.openBlock(),e.createElementBlock("span",Lu,"* ")):e.createCommentVNode("",!0),e.renderSlot(x.$slots,"default")],64))}},qu={class:"block"},zu={class:"table align-middle gray-table side-table"},Gu=["value"],Ju={class:"table align-middle gray-table"},Yu={width:"1%"},Qu={width:"1%"},Wu={class:"d-flex gap-2"},Hu=["onClick"],Xu={class:"d-flex align-items-center flex-wrap"},Ku={class:"d-flex align-items-center text-nowrap me-3"},Zu={class:"d-flex align-items-center text-nowrap"},vu={key:0,class:"invalid mt-0"},ex={key:0,class:"table align-middle gray-table"},tx={width:"1%"},lx={width:"1%"},ox={class:"d-flex gap-2"},nx=["onClick"],rx={key:0,class:"tag-group mt-2 gap-1"},ax={class:"tag tag-green-light"},sx=["download","href"],dx={key:1},cx={key:2,class:"invalid mt-0"},ix={key:0},mx={class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},px={__name:"GrantForm1",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=X().typeList,V=e.ref(!1),N=e.ref({}),r=e.ref({}),o=e.ref(),l=e.computed(()=>u.value.filter(y=>!y.Deleted)),d=e.computed(()=>E.value.filter(y=>!y.Deleted)),k=e.ref({}),E=e.ref([]),u=e.ref([]),h=U.download,g=_,s=y=>{var n,c,f;if(r.value={},N.value.Path=(n=o.value)==null?void 0:n.Path,N.value.Filename=(c=o.value)==null?void 0:c.Name,y&&!a()){e.nextTick(()=>{var t;return(t=document.querySelector(".invalid"))==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})});return}k.value.ShortName=(f=m.find(t=>t.code===k.value.TypeCode))==null?void 0:f.title;const i={GrantType:k.value,Content:N.value,Procedures:u.value,Links:E.value};U.system("saveGrantTypeContent",i).subscribe(t=>{t&&g("next")})},a=()=>{let y={ServiceContent:"內容",ContactPerson:"聯絡電話及分機",ContactTel:"聯絡人",Filename:"相關檔案"};return V.value&&(y.StatusReason="下架原因"),r.value=P(N.value,y),x.id||(y={TypeCode:"補助類別",Year:"年度",FullName:"補助類別全稱"},Object.assign(r.value,P(k.value,y))),l.value.length&&(y={Content:"內容"},l.value.forEach((i,n)=>Object.assign(r.value,P(i,y,`procedure-${n}-`)))),d.value.length&&(y={URL:"網址"},d.value.forEach((i,n)=>Object.assign(r.value,P(i,y,`link-${n}-`)))),!Object.keys(r.value).length};return e.onMounted(()=>{x.id?U.system("getGrantTypeContent",{ID:x.id}).subscribe(y=>{k.value=y.GrantType,N.value=y.Content,u.value=y.Procedures,E.value=y.Links,N.value.Filename&&(o.value={Name:N.value.Filename,Path:N.value.Path}),u.value.length||u.value.push({}),X().init(k.value.TypeCode)}):u.value.push({})}),(y,i)=>{const n=e.resolveComponent("required-label"),c=e.resolveComponent("input-select"),f=e.resolveComponent("input-integer"),t=e.resolveComponent("input-text"),p=e.resolveComponent("input-textarea"),b=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock("div",qu,[e.createElementVNode("table",zu,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[16]||(i[16]=[e.createTextVNode("補助類別(代碼)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(c,{class:"w-auto",error:e.unref(r).TypeCode,options:e.unref(m),modelValue:e.unref(k).TypeCode,"onUpdate:modelValue":i[0]||(i[0]=w=>e.unref(k).TypeCode=w)},{default:e.withCtx(({option:w})=>[e.createElementVNode("option",{value:w.code},e.toDisplayString(w.title)+" ("+e.toDisplayString(w.code)+")",9,Gu)]),_:1},8,["error","options","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[17]||(i[17]=[e.createTextVNode("年度",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(f,{class:"w-auto",error:e.unref(r).Year,modelValue:e.unref(k).Year,"onUpdate:modelValue":i[1]||(i[1]=w=>e.unref(k).Year=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[18]||(i[18]=[e.createTextVNode("補助類別全稱",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(r).FullName,modelValue:e.unref(k).FullName,"onUpdate:modelValue":i[2]||(i[2]=w=>e.unref(k).FullName=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[19]||(i[19]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r).ServiceContent,modelValue:e.unref(N).ServiceContent,"onUpdate:modelValue":i[3]||(i[3]=w=>e.unref(N).ServiceContent=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[i[20]||(i[20]=e.createElementVNode("th",null,"申辦資格",-1)),e.createElementVNode("td",null,[e.createVNode(p,{modelValue:e.unref(N).Criteria,"onUpdate:modelValue":i[4]||(i[4]=w=>e.unref(N).Criteria=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[21]||(i[21]=[e.createTextVNode("申辦流程",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("table",Ju,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),(w,T)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",Yu,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(p,{error:e.unref(r)[`procedure-${T}-Content`],modelValue:w.Content,"onUpdate:modelValue":S=>w.Content=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",Qu,[e.createElementVNode("div",Wu,[e.unref(l).length>1?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-sm btn-teal-dark m-0",onClick:S=>w.Deleted=!0,type:"button"},[...i[22]||(i[22]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Hu)):e.createCommentVNode("",!0),T+1===e.unref(l).length?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-sm btn-teal-dark m-0",onClick:i[5]||(i[5]=S=>e.unref(u).push({})),type:"button"},[...i[23]||(i[23]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1)])])):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("tr",null,[i[24]||(i[24]=e.createElementVNode("th",null,"應備物品",-1)),e.createElementVNode("td",null,[e.createVNode(p,{modelValue:e.unref(N).Documentary,"onUpdate:modelValue":i[6]||(i[6]=w=>e.unref(N).Documentary=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[25]||(i[25]=[e.createTextVNode("聯絡窗口",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Xu,[e.createElementVNode("div",Ku,[i[26]||(i[26]=e.createElementVNode("label",{class:"me-2"},"聯絡電話及分機",-1)),e.createVNode(t,{modelValue:e.unref(N).ContactTel,"onUpdate:modelValue":i[7]||(i[7]=w=>e.unref(N).ContactTel=w),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Zu,[i[27]||(i[27]=e.createElementVNode("label",{class:"me-2"},"聯絡人",-1)),e.createVNode(t,{modelValue:e.unref(N).ContactPerson,"onUpdate:modelValue":i[8]||(i[8]=w=>e.unref(N).ContactPerson=w),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.unref(r).ContactTel||e.unref(r).ContactPerson?(e.openBlock(),e.createElementBlock("div",vu,e.toDisplayString(e.unref(r).ContactTel||e.unref(r).ContactPerson),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[i[30]||(i[30]=e.createElementVNode("th",null,[e.createTextVNode("線上申辦"),e.createElementVNode("br"),e.createTextVNode("參考資料")],-1)),e.createElementVNode("td",null,[e.unref(d).length?(e.openBlock(),e.createElementBlock("table",ex,[e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(w,T)=>(e.openBlock(),e.createElementBlock("tr",{key:w},[e.createElementVNode("td",tx,e.toDisplayString(T+1),1),e.createElementVNode("td",null,[e.createVNode(t,{error:e.unref(r)[`link-${T}-URL`],modelValue:w.URL,"onUpdate:modelValue":S=>w.URL=S,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",lx,[e.createElementVNode("div",ox,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark m-0",onClick:S=>w.Deleted=!0,type:"button"},[...i[28]||(i[28]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,nx)])])]))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:i[9]||(i[9]=w=>e.unref(E).push({})),type:"button"},[...i[29]||(i[29]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(n,null,{default:e.withCtx(()=>[...i[31]||(i[31]=[e.createTextVNode("相關檔案",-1),e.createElementVNode("br",null,null,-1),e.createTextVNode("(顯示於首頁)",-1)])]),_:1})]),e.createElementVNode("td",null,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",rx,[e.createElementVNode("span",ax,[e.createElementVNode("a",{class:"tag-link my-1",download:e.unref(o).Name,href:e.unref(h)(e.unref(o).Path)},e.toDisplayString(e.unref(o).Name),9,sx),e.createElementVNode("button",{class:"tag-btn",onClick:i[10]||(i[10]=w=>o.value=null),type:"button"},[...i[32]||(i[32]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])])])])):(e.openBlock(),e.createElementBlock("div",dx,[e.createVNode(b,{onFile:i[11]||(i[11]=w=>o.value=w)})])),e.unref(r).Filename?(e.openBlock(),e.createElementBlock("div",cx,e.toDisplayString(e.unref(r).Filename),1)):e.createCommentVNode("",!0)])]),e.unref(N).IsValid?(e.openBlock(),e.createElementBlock("tr",ix,[i[34]||(i[34]=e.createElementVNode("th",null,"申請下架",-1)),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"status-checkbox",type:"checkbox","onUpdate:modelValue":i[12]||(i[12]=w=>e.isRef(V)?V.value=w:null)},null,512),[[e.vModelCheckbox,e.unref(V)]]),i[33]||(i[33]=e.createElementVNode("label",{class:"form-check-label ms-1 mb-2",for:"status-checkbox"},"申請E政府下架（請輸入原因）",-1)),e.createVNode(p,{error:e.unref(r).StatusReason,modelValue:e.unref(N).StatusReason,"onUpdate:modelValue":i[13]||(i[13]=w=>e.unref(N).StatusReason=w),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",mx,[e.createElementVNode("button",{class:"btn btn-outline-teal me-3",onClick:i[14]||(i[14]=w=>s()),type:"button"},"暫存"),e.createElementVNode("button",{class:"btn btn-teal",onClick:i[15]||(i[15]=w=>s(!0)),type:"button"},[...i[35]||(i[35]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確定發布",-1)])])])])}}},Vx={class:"block"},fx={class:"table align-middle gray-table side-table"},Nx={class:"p-0"},Ex={class:"row align-items-center mb-0"},bx={class:"col p-4"},gx={class:"col p-4"},kx={class:"col p-4"},yx={class:"d-flex align-items-center flex-wrap gap-2"},ux={class:"input-group",style:{width:"360px"}},xx={class:"d-flex align-items-center flex-wrap gap-2"},hx={class:"input-group",style:{width:"360px"}},$x={style:{width:"360px"}},Bx={class:"d-flex align-items-center mb-2"},_x={class:"d-flex align-items-center mb-2"},Cx={class:"d-flex align-items-center mb-2"},Tx={class:"d-flex align-items-center mb-2"},wx={class:"d-flex align-items-center gap-2"},Dx={class:"d-flex align-items-center flex-wrap gap-2"},Sx={class:"input-group",style:{width:"360px"}},Ax={class:"d-flex align-items-center flex-wrap gap-2"},Fx={class:"input-group",style:{width:"360px"}},Ux={__name:"GrantForm2",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref({}),V=e.ref(!1),N=_,r=()=>{const o={};V.value||(m.value.OverduePeriod=null),U.system("saveGrantType",{GrantType:Object.assign(m.value,o)}).subscribe(l=>{l&&N("next")})};return e.onMounted(()=>{U.system("getGrantType",{ID:x.id}).subscribe(o=>{m.value=o.GrantType,m.value.OverduePeriod&&(V.value=!0)})}),(o,l)=>{const d=e.resolveComponent("input-integer"),k=e.resolveComponent("input-textarea"),E=e.resolveComponent("input-tw-date"),u=e.resolveComponent("input-text");return e.openBlock(),e.createElementBlock("div",Vx,[e.createElementVNode("table",fx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[l[18]||(l[18]=e.createElementVNode("th",null,"補助類別 全稱",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(m).FullName),1)]),e.createElementVNode("tr",null,[l[21]||(l[21]=e.createElementVNode("th",null,"補助類別 簡稱",-1)),e.createElementVNode("td",Nx,[e.createElementVNode("div",Ex,[e.createElementVNode("div",bx,e.toDisplayString(e.unref(m).ShortName),1),l[19]||(l[19]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"代碼",-1)),e.createElementVNode("div",gx,e.toDisplayString(e.unref(m).TypeCode),1),l[20]||(l[20]=e.createElementVNode("div",{class:"col p-4 text-nowrap",style:{"border-right":"8px solid #DDDDDD","background-color":"#F5F5F5"}},"年度",-1)),e.createElementVNode("div",kx,e.toDisplayString(e.unref(m).Year),1)])])]),e.createElementVNode("tr",null,[l[22]||(l[22]=e.createElementVNode("th",null,"總預算經費(元)",-1)),e.createElementVNode("td",null,[e.createVNode(d,{class:"w-auto",modelValue:e.unref(m).BudgetFees,"onUpdate:modelValue":l[0]||(l[0]=h=>e.unref(m).BudgetFees=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[23]||(l[23]=e.createElementVNode("th",null,"身分標籤",-1)),e.createElementVNode("td",null,[e.createVNode(k,{rows:"5",modelValue:e.unref(m).TargetTags,"onUpdate:modelValue":l[1]||(l[1]=h=>e.unref(m).TargetTags=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),e.createElementVNode("tr",null,[l[25]||(l[25]=e.createElementVNode("th",null,"申請期間",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",yx,[e.createElementVNode("div",ux,[e.createVNode(E,{modelValue:e.unref(m).ApplyStartDate,"onUpdate:modelValue":l[2]||(l[2]=h=>e.unref(m).ApplyStartDate=h)},null,8,["modelValue"]),l[24]||(l[24]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(E,{modelValue:e.unref(m).ApplyEndDate,"onUpdate:modelValue":l[3]||(l[3]=h=>e.unref(m).ApplyEndDate=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[26]||(l[26]=e.createElementVNode("th",null,"計畫期程迄日",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",xx,[e.createElementVNode("div",hx,[e.createVNode(E,{modelValue:e.unref(m).PlanEndDate,"onUpdate:modelValue":l[4]||(l[4]=h=>e.unref(m).PlanEndDate=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[31]||(l[31]=e.createElementVNode("th",null,"申請階段審查",-1)),e.createElementVNode("td",null,[e.createElementVNode("div",$x,[e.createElementVNode("div",Bx,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-1",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[5]||(l[5]=h=>e.unref(m).Review1Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(m).Review1Enabled]]),l[27]||(l[27]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-1"},"1.",-1)),e.createVNode(u,{class:"w-auto","aria-label":"資格審查",placeholder:"資格審查",modelValue:e.unref(m).Review1Title,"onUpdate:modelValue":l[6]||(l[6]=h=>e.unref(m).Review1Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",_x,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-2",type:"checkbox","onUpdate:modelValue":l[7]||(l[7]=h=>e.unref(m).Review2Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(m).Review2Enabled]]),l[28]||(l[28]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-2"},"2.",-1)),e.createVNode(u,{class:"w-auto","aria-label":"初審",placeholder:"初審",modelValue:e.unref(m).Review2Title,"onUpdate:modelValue":l[8]||(l[8]=h=>e.unref(m).Review2Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Cx,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-3",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=h=>e.unref(m).Review3Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(m).Review3Enabled]]),l[29]||(l[29]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-3"},"3.",-1)),e.createVNode(u,{class:"w-auto","aria-label":"複審",placeholder:"複審",modelValue:e.unref(m).Review3Title,"onUpdate:modelValue":l[10]||(l[10]=h=>e.unref(m).Review3Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e.createElementVNode("div",Tx,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"review-4",type:"checkbox",style:{visibility:"hidden"},"onUpdate:modelValue":l[11]||(l[11]=h=>e.unref(m).Review4Enabled=h)},null,512),[[e.vModelCheckbox,e.unref(m).Review4Enabled]]),l[30]||(l[30]=e.createElementVNode("label",{class:"form-check-label ms-2 me-2",for:"review-4"},"4.",-1)),e.createVNode(u,{class:"w-auto","aria-label":"決審核定",placeholder:"決審核定",modelValue:e.unref(m).Review4Title,"onUpdate:modelValue":l[12]||(l[12]=h=>e.unref(m).Review4Title=h),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[34]||(l[34]=e.createElementVNode("th",null,"補正補件期限",-1)),e.createElementVNode("td",wx,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"overdue-period",type:"checkbox","onUpdate:modelValue":l[13]||(l[13]=h=>e.isRef(V)?V.value=h:null)},null,512),[[e.vModelCheckbox,e.unref(V)]]),l[33]||(l[33]=e.createElementVNode("label",{class:"form-check-label",for:"overdue-period"},"有期限",-1)),e.unref(V)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(d,{class:"w-auto",modelValue:e.unref(m).OverduePeriod,"onUpdate:modelValue":l[14]||(l[14]=h=>e.unref(m).OverduePeriod=h),modelModifiers:{trim:!0}},null,8,["modelValue"]),l[32]||(l[32]=e.createTextVNode("天 ",-1))],64)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[l[35]||(l[35]=e.createElementVNode("th",null,[e.createTextVNode("期中報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("span",Dx,[e.createElementVNode("span",Sx,[e.createVNode(E,{modelValue:e.unref(m).MidtermDeadline,"onUpdate:modelValue":l[15]||(l[15]=h=>e.unref(m).MidtermDeadline=h)},null,8,["modelValue"])])])])]),e.createElementVNode("tr",null,[l[38]||(l[38]=e.createElementVNode("th",null,[e.createTextVNode("期末/成果報告"),e.createElementVNode("br"),e.createTextVNode("繳交期限")],-1)),e.createElementVNode("td",null,[e.createElementVNode("div",Ax,[e.createElementVNode("div",Fx,[e.createVNode(E,{disabled:e.unref(m).FinalOneMonth,modelValue:e.unref(m).FinalDeadline,"onUpdate:modelValue":l[16]||(l[16]=h=>e.unref(m).FinalDeadline=h)},null,8,["disabled","modelValue"])]),l[36]||(l[36]=e.createElementVNode("span",{class:"p-2"},"或",-1)),e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:"final-one-month",type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=h=>e.unref(m).FinalOneMonth=h)},null,512),[[e.vModelCheckbox,e.unref(m).FinalOneMonth]]),l[37]||(l[37]=e.createElementVNode("label",{class:"form-check-label",for:"final-one-month"},"計畫結束一個月後",-1))])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:r,type:"button"},"儲存")])])}}},Mx={class:"block"},Px={class:"mt-4"},Ix={class:"table-responsive"},jx={class:"table align-middle gray-table"},Ox={class:"d-flex align-items-center gap-2"},Lx=["id","onUpdate:modelValue"],Rx=["for"],qx={__name:"GrantForm3",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref([]),V=_,N=()=>{const r=m.value.map(o=>({...o,MatchingFund:o.checked?o.MatchingFund:null}));U.system("saveGrantTargetSettings",{List:r}).subscribe(o=>{o&&V("next")})};return e.onMounted(()=>{U.system("getGrantTargetSettings",{ID:x.id}).subscribe(r=>{m.value=r.List,m.value.forEach(o=>{typeof o.MatchingFund=="number"&&(o.checked=!0)})})}),(r,o)=>{const l=e.resolveComponent("input-integer");return e.openBlock(),e.createElementBlock("div",Mx,[e.createElementVNode("div",Px,[e.createElementVNode("div",Ix,[e.createElementVNode("table",jx,[o[1]||(o[1]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th"),e.createElementVNode("th",null,"適用申請單位類別"),e.createElementVNode("th",null,"補助經費上限(萬)"),e.createElementVNode("th",null,"配合款")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(d,k)=>(e.openBlock(),e.createElementBlock("tr",{key:d},[e.createElementVNode("td",null,e.toDisplayString(k+1),1),e.createElementVNode("td",null,e.toDisplayString(d.TargetName),1),e.createElementVNode("td",null,[e.createVNode(l,{modelValue:d.GrantLimit,"onUpdate:modelValue":E=>d.GrantLimit=E},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Ox,[e.withDirectives(e.createElementVNode("input",{class:"form-check-input",id:`checkbox-${k}`,type:"checkbox","onUpdate:modelValue":E=>d.checked=E},null,8,Lx),[[e.vModelCheckbox,d.checked]]),e.createElementVNode("label",{class:"form-check-label ms-1",for:`checkbox-${k}`},"配合款分攤比例",8,Rx),d.checked?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(l,{class:"w-auto",modelValue:d.MatchingFund,"onUpdate:modelValue":E=>d.MatchingFund=E},null,8,["modelValue","onUpdate:modelValue"]),o[0]||(o[0]=e.createTextVNode("(%) ",-1))],64)):e.createCommentVNode("",!0)])])]))),128))])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:N,type:"button"},"儲存")])])}}},zx={class:"block"},Gx={class:"mt-4"},Jx={class:"table-responsive"},Yx={class:"table align-middle gray-table side-table"},Qx={class:"input-group",style:{width:"400px"}},Wx={class:"teal-dark-tabs"},Hx={key:0,class:"table-responsive sub-table"},Xx={class:"table align-middle gray-table"},Kx={class:"d-flex gap-2"},Zx=["onClick"],vx={key:1},eh={class:"d-flex gap-2"},th={__name:"GrantForm4",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref({}),V=e.ref(),N=e.ref([]),r=e.ref({}),o=e.ref(1),l=e.ref(""),d=()=>{const h=/^(.*?)\s*<([^>]+)>$/;l.value.split(`
`).forEach(g=>{const s=g.trim().match(h);s&&r.value[V.value].push({CommitteeUser:s[1],Email:s[2]})}),o.value=1,l.value=""},k=_,E=()=>{if(!u()){e.nextTick(()=>{var h;return(h=document.querySelector(".invalid"))==null?void 0:h.scrollIntoView({behavior:"smooth",block:"center"})});return}U.system("saveReviewCommitteeList",{ID:V.value,List:r.value[V.value]}).subscribe(h=>{h&&k("next")})},u=()=>{const h={CommitteeUser:"姓名",Email:{presence:{message:"^請輸入 Email"},email:{message:"格式錯誤"}}};return m.value={},r.value[V.value].filter(g=>!g.Deleted).forEach((g,s)=>Object.assign(m.value,P(g,h,`item-${s}-`))),!Object.keys(m.value).length};return e.onMounted(()=>{U.system("getReviewGroups",{ID:x.id}).subscribe(h=>{N.value=h.List,V.value=N.value[0].Value})}),e.watch(V,h=>{r.value[h]||U.system("getReviewCommitteeList",{ID:h}).subscribe(g=>{r.value[h]=g.List})}),(h,g)=>{var n;const s=e.resolveComponent("required-label"),a=e.resolveComponent("input-select"),y=e.resolveComponent("input-text"),i=e.resolveComponent("input-textarea");return e.openBlock(),e.createElementBlock("div",zx,[e.createElementVNode("div",Gx,[e.createElementVNode("div",Jx,[e.createElementVNode("table",Yx,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(s,null,{default:e.withCtx(()=>[...g[5]||(g[5]=[e.createTextVNode("審查組別",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Qx,[e.createVNode(a,{options:e.unref(N),"text-name":"Text","value-name":"Value",modelValue:e.unref(V),"onUpdate:modelValue":g[0]||(g[0]=c=>e.isRef(V)?V.value=c:null)},null,8,["options","modelValue"])])])]),e.createElementVNode("tr",null,[g[11]||(g[11]=e.createElementVNode("th",null,"審查委員名單",-1)),e.createElementVNode("td",null,[e.createElementVNode("ul",Wx,[e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===1})},[e.createElementVNode("a",{class:"tab-link",onClick:g[1]||(g[1]=c=>o.value=1),href:"javascript:void(0)"},"逐筆輸入")],2),e.createElementVNode("li",{class:e.normalizeClass({active:e.unref(o)===2})},[e.createElementVNode("a",{class:"tab-link",onClick:g[2]||(g[2]=c=>o.value=2),href:"javascript:void(0)"},"批次輸入")],2)]),e.unref(o)===1?(e.openBlock(),e.createElementBlock("div",Hx,[e.createElementVNode("table",Xx,[g[7]||(g[7]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"1%"}),e.createElementVNode("th",null,"姓名"),e.createElementVNode("th",null,"Email"),e.createElementVNode("th",{width:"1%"})])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((n=e.unref(r)[e.unref(V)])==null?void 0:n.filter(c=>!c.Deleted),(c,f)=>(e.openBlock(),e.createElementBlock("tr",{key:c},[e.createElementVNode("td",null,e.toDisplayString(f+1),1),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(m)[`item-${f}-CommitteeUser`],modelValue:c.CommitteeUser,"onUpdate:modelValue":t=>c.CommitteeUser=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(m)[`item-${f}-Email`],modelValue:c.Email,"onUpdate:modelValue":t=>c.Email=t,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",Kx,[e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:t=>c.Deleted=!0,type:"button"},[...g[6]||(g[6]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,Zx)])])]))),128))])]),e.createElementVNode("button",{class:"btn btn-sm btn-teal",onClick:g[3]||(g[3]=c=>{var f;return(f=e.unref(r)[e.unref(V)])==null?void 0:f.push({})}),type:"button"},[...g[8]||(g[8]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode("新增",-1)])])])):e.createCommentVNode("",!0),e.unref(o)===2?(e.openBlock(),e.createElementBlock("div",vx,[e.createElementVNode("div",eh,[e.createVNode(i,{placeholder:`張曉明 <aming@gmail.com>
陳小華 <hwahchen@xxx.edu.tw>`,rows:"5",modelValue:e.unref(l),"onUpdate:modelValue":g[4]||(g[4]=c=>e.isRef(l)?l.value=c:null),modelModifiers:{trim:!0}},null,8,["modelValue"]),e.createElementVNode("button",{class:"btn btn-teal-dark",onClick:d,type:"button"},[...g[9]||(g[9]=[e.createElementVNode("i",{class:"fa-solid fa-plus"},null,-1),e.createTextVNode("新增",-1)])])]),g[10]||(g[10]=e.createElementVNode("label",{class:"form-text"},"輸入格式範例「姓名 <xxx@email.com>」，多筆請斷行輸入",-1))])):e.createCommentVNode("",!0)])])])])])]),e.createElementVNode("div",{class:"d-flex gap-3 flex-wrap justify-content-center mt-4"},[e.createElementVNode("button",{class:"btn btn-outline-teal",onClick:E,type:"button"},"儲存")])])}}},lh={class:"search-form"},oh={class:"row g-3"},nh={class:"col-3"},rh=["value"],ah={class:"block rounded-4 mt-4"},sh={class:"table-responsive",style:{"min-height":"400px"}},dh={"aria-label":"公告列表",class:"table teal-table"},ch={"data-th":"年度:"},ih={"data-th":"補助類別全稱:",class:"text-start"},mh={"data-th":"簡稱:",class:"text-start"},ph={"data-th":"代碼:",class:"text-start"},Vh={"data-th":"申請期間:",class:"text-start"},fh={"data-th":"管理:",class:"text-center"},Nh={class:"d-inline-flex gap-2"},Eh=["href"],bh={__name:"GrantList",setup(B){const _=e.ref([]),x=e.ref(),m=e.ref([]),V=e.computed(()=>_.value.filter(N=>N.Year===x.value));return e.onMounted(()=>{U.system("getGrantTypeList").subscribe(N=>{_.value=N.List,m.value=[],_.value.forEach(r=>{m.value.includes(r.Year)||m.value.push(r.Year)}),x.value=m.value.length?m.value[0]:null})}),(N,r)=>{const o=e.resolveComponent("tw-date");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",lh,[e.createElementVNode("div",oh,[e.createElementVNode("div",nh,[r[1]||(r[1]=e.createElementVNode("div",{class:"fs-16 text-gray mb-2"},"年度",-1)),e.withDirectives(e.createElementVNode("select",{class:"form-select","onUpdate:modelValue":r[0]||(r[0]=l=>e.isRef(x)?x.value=l:null)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l)+"年",9,rh))),128))],512),[[e.vModelSelect,e.unref(x)]])])])]),e.createElementVNode("div",ah,[r[5]||(r[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="GrantEdit.aspx"><i class="fa-solid fa-plus"></i> 新增類別 </a></div>',1)),e.createElementVNode("div",sh,[e.createElementVNode("table",dh,[r[4]||(r[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col"},"年度"),e.createElementVNode("th",{scope:"col",class:"text-start"},"補助類別全稱"),e.createElementVNode("th",{scope:"col",class:"text-start"},"簡稱"),e.createElementVNode("th",{scope:"col"},"代碼"),e.createElementVNode("th",{scope:"col"},"申請期間"),e.createElementVNode("th",{scope:"col"},"管理")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),l=>(e.openBlock(),e.createElementBlock("tr",{key:l},[e.createElementVNode("td",ch,e.toDisplayString(l.Year),1),e.createElementVNode("td",ih,e.toDisplayString(l.FullName),1),e.createElementVNode("td",mh,e.toDisplayString(l.ShortName),1),e.createElementVNode("td",ph,e.toDisplayString(l.TypeCode),1),e.createElementVNode("td",Vh,[e.createVNode(o,{"default-value":"未設定",value:l.ApplyStartDate},null,8,["value"]),r[2]||(r[2]=e.createTextVNode(" ~ ",-1)),e.createVNode(o,{"default-value":"未設定",value:l.ApplyEndDate},null,8,["value"])]),e.createElementVNode("td",fh,[e.createElementVNode("div",Nh,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`GrantEdit.aspx?ID=${l.TypeID}`},[...r[3]||(r[3]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,Eh)])])]))),128))])])])])],64)}}},gh={class:"block rounded-4 mt-4"},kh={class:"table-responsive",style:{"min-height":"400px"}},yh={class:"table teal-table","aria-label":"公告列表"},uh={"data-th":"公告期間:"},xh={key:1},hh={"data-th":"公告標題:",class:"text-start"},$h={"data-th":"發布者:",class:"text-start"},Bh={"data-th":"功能:",class:"text-center"},_h={class:"d-inline-flex gap-2"},Ch=["href"],Th=["onClick"],wh={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},Dh={class:"modal-content"},Sh={class:"modal-body"},Ah={class:"d-flex gap-4 flex-wrap justify-content-center mt-5"},Fh={__name:"NewsList",setup(B){let _;const x=e.ref([]),m=e.ref(),V=e.ref(1),N=e.ref(10),r=e.computed(()=>x.value.slice((V.value-1)*N.value,V.value*N.value)),o=(d,k)=>{V.value=parseInt(d),N.value=parseInt(k)},l=(d,k)=>{k||(_=d,bootstrap.Modal.getOrCreateInstance(m.value).show()),U.system("deleteNews",{ID:d.ID}).subscribe(E=>{E&&(x.value=x.value.filter(u=>u!==d),bootstrap.Modal.getOrCreateInstance(m.value).hide())})};return e.onMounted(()=>{U.system("getNewsList").subscribe(d=>x.value=d.List)}),(d,k)=>{const E=e.resolveComponent("tw-date"),u=e.resolveComponent("list-pager");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",gh,[k[5]||(k[5]=e.createStaticVNode('<div class="title border-teal"><div class="d-flex align-items-center gap-2"><h4 class="text-teal"><img src="../../assets/img/title-icon02-teal.svg" alt="logo"><span>列表</span></h4></div><a class="btn btn-teal-dark" href="NewsEdit.aspx"><i class="fa-solid fa-plus"></i> 新增公告 </a></div>',1)),e.createElementVNode("div",kh,[e.createElementVNode("table",yh,[k[4]||(k[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{scope:"col",style:{width:"220px"}},"公告期間"),e.createElementVNode("th",{class:"text-start",scope:"col"},"公告標題"),e.createElementVNode("th",{class:"text-start",scope:"col",style:{width:"200px"}},"發布者"),e.createElementVNode("th",{scope:"col",style:{width:"180px"}},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),h=>(e.openBlock(),e.createElementBlock("tr",{key:h},[e.createElementVNode("td",uh,[e.createVNode(E,{value:h.EnableTime},null,8,["value"]),k[1]||(k[1]=e.createTextVNode(" ~ ",-1)),h.DisableTime?(e.openBlock(),e.createBlock(E,{key:0,value:h.DisableTime},null,8,["value"])):(e.openBlock(),e.createElementBlock("span",xh,"未設定"))]),e.createElementVNode("td",hh,e.toDisplayString(h.Title),1),e.createElementVNode("td",$h,e.toDisplayString(h.UserOrg)+" "+e.toDisplayString(h.UserName),1),e.createElementVNode("td",Bh,[e.createElementVNode("div",_h,[e.createElementVNode("a",{class:"btn btn-sm btn-teal-dark",href:`NewsEdit.aspx?id=${h.ID}`},[...k[2]||(k[2]=[e.createElementVNode("i",{class:"fa-solid fa-pen"},null,-1)])],8,Ch),e.createElementVNode("button",{class:"btn btn-sm btn-teal-dark",onClick:g=>l(h),type:"button"},[...k[3]||(k[3]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Th)])])]))),128))])])]),e.createVNode(u,{count:e.unref(x).length,onChange:o,page:e.unref(V),"page-size":e.unref(N)},null,8,["count","page","page-size"])]),e.createElementVNode("div",{"aria-hidden":"true",class:"modal fade","data-bs-backdrop":"static",ref_key:"modal",ref:m,tabindex:"-1"},[e.createElementVNode("div",wh,[e.createElementVNode("div",Dh,[k[7]||(k[7]=e.createElementVNode("div",{class:"modal-header"},[e.createElementVNode("h4",{class:"fs-24 fw-bold text-green-light"},"確定刪除公告資料？"),e.createElementVNode("button",{"aria-label":"Close",class:"btn-close","data-bs-dismiss":"modal",type:"button"},[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"})])],-1)),e.createElementVNode("div",Sh,[e.createElementVNode("div",Ah,[k[6]||(k[6]=e.createElementVNode("button",{class:"btn btn-gray","data-bs-dismiss":"modal",type:"button"},"取消",-1)),e.createElementVNode("button",{class:"btn btn-teal",onClick:k[0]||(k[0]=h=>l(e.unref(_),!0)),type:"button"},"確認刪除")])])])])],512)],64)}}},Uh={class:"block rounded-top-4 mt-4 d-flex flex-column gap-5"},Mh={class:"table-responsive mt-3 mb-0"},Ph={class:"table align-middle gray-table side-table"},Ih={class:"d-flex align-items-center gap-2"},jh={class:"input-group w-auto"},Oh={key:0,class:"invalid mt-0"},Lh={class:"d-flex mb-2 gap-3"},Rh={class:"tag-group mt-3"},qh={key:0,class:"tag tag-green-light"},zh=["download","href"],Gh=["onClick"],Jh={class:"d-flex mb-2 gap-3"},Yh={class:"image-preview mt-3"},Qh={key:0,class:"image-preview__item"},Wh=["src"],Hh={class:"image-preview__item-overlay"},Xh=["onClick"],Kh={class:"d-flex mb-2 gap-3"},Zh={key:0,class:"table-responsive mt-3"},vh={class:"table align-middle gray-table"},e2={class:"text-center"},t2={class:"d-flex gap-1"},l2=["onClick"],le={AccessibilityApplication:ve,AccessibilityAttachment:ut,AccessibilityBenefit:Mt,AccessibilityFunding:cl,AccessibilityPayment1:Ml,AccessibilityPayment2:io,AccessibilityProgressBar:mo,AccessibilityWorkSchedule:Io,ConfirmModal:zo,CommonProgressBar:Xo,CultureApplication:Mn,CultureAttachment:or,CultureFunding:Dr,CultureOther:Yr,CulturePayment1:ga,CulturePayment2:Ya,CultureProgress:ms,CultureProgressBar:ps,CultureWorkSchedule:rd,EducationApplication:Kd,EducationAttachment:kc,EducationPayment:Yc,EducationProgressBar:Qc,ErrorModal:vc,HomeDashboard:lm,InputBoolean:om,InputFile:nm,InputInteger:sm,InputMonth:dm,InputRadioGroup:mm,InputSelect:Em,InputText:um,InputTextarea:_m,InputTwDate:wm,ListPager:Gm,LiteracyApplication:$p,LiteracyAttachment:Yp,LiteracyBenefit:aV,LiteracyFunding:UV,LiteracyPayment1:nf,LiteracyPayment2:Df,LiteracyProgressBar:Sf,LiteracyWorkSchedule:oN,MultipleApplication:IN,MultipleAttachment:r1,MultipleBenefit:k1,MultipleFunding:Q1,MultiplePayment1:bE,MultiplePayment2:GE,MultiplePayment3:bb,MultipleProgressBar:gb,MultipleWorkSchedule:Gb,NewsDetail:og,NewsList:mg,ProjectChangeReview:bg,ProjectCorrectionReview:hg,ProjectOrganizer:Ag,ProjectPaymentReview:Rg,ProjectProgress:Kg,ProjectReport:fk,ProjectReportReview:yk,ProjectReview:Ck,ProjectTitle:Sk,ProjectToolbar:Jk,ReportApplyList:Sy,ReportApprovedList:nu,ReportInprogressList:Iu,ReportMixChart:ju,ReportPieChart:Ou,RequiredLabel:Ru,SystemGrantForm1:px,SystemGrantForm2:Ux,SystemGrantForm3:qx,SystemGrantForm4:th,SystemGrantList:bh,SystemNewsList:Fh,SystemNewsForm:{__name:"NewsForm",props:{id:{type:[Number,String]}},emits:["next"],setup(B,{emit:_}){const x=B,m=e.ref({}),V=e.ref([]),N=e.computed(()=>l.value.filter(g=>!g.Deleted)),r=e.ref({}),o=e.ref([]),l=e.ref([]),d=(g,s)=>g.push({Path:s.Path,Name:s.Name}),k=U.download,E=_,u=()=>{if(!h()){e.nextTick(()=>{var s;return(s=document.querySelector(".invalid"))==null?void 0:s.scrollIntoView({behavior:"smooth",block:"center"})});return}const g={News:r.value,Files:V.value,Images:o.value,Videos:l.value};U.system("saveNews",g).subscribe(s=>{s&&E("next")})},h=()=>{let g={Title:"公告標題",EnableTime:"公告期間",Content:"內容"};return m.value=P(r.value,g),g={Title:"影片名稱",URL:"影片網址"},N.value.forEach((s,a)=>Object.assign(m.value,P(s,g,`video-${a}-`))),!Object.keys(m.value).length};return e.onMounted(()=>{x.id?U.system("getNews",{ID:x.id}).subscribe(g=>{r.value=g.News,V.value=g.Files,o.value=g.Images,l.value=g.Videos}):U.system("getEmptyNews").subscribe(g=>r.value=g)}),(g,s)=>{const a=e.resolveComponent("required-label"),y=e.resolveComponent("input-text"),i=e.resolveComponent("input-tw-date"),n=e.resolveComponent("input-textarea"),c=e.resolveComponent("input-file");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",Uh,[e.createElementVNode("div",null,[s[12]||(s[12]=e.createElementVNode("h5",{class:"square-title"},"公告內容",-1)),e.createElementVNode("div",Mh,[e.createElementVNode("table",Ph,[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[s[7]||(s[7]=e.createElementVNode("th",null,"發佈者",-1)),e.createElementVNode("td",null,e.toDisplayString(e.unref(r).UserOrg)+"    "+e.toDisplayString(e.unref(r).UserName),1)]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...s[8]||(s[8]=[e.createTextVNode("公告標題",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(m).Title,modelValue:e.unref(r).Title,"onUpdate:modelValue":s[0]||(s[0]=f=>e.unref(r).Title=f),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...s[9]||(s[9]=[e.createTextVNode("公告期間",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createElementVNode("div",Ih,[e.createElementVNode("div",jh,[e.createVNode(i,{class:"w-auto",modelValue:e.unref(r).EnableTime,"onUpdate:modelValue":s[1]||(s[1]=f=>e.unref(r).EnableTime=f)},null,8,["modelValue"]),s[10]||(s[10]=e.createElementVNode("span",{class:"input-group-text"},"至",-1)),e.createVNode(i,{class:"w-auto",modelValue:e.unref(r).DisableTime,"onUpdate:modelValue":s[2]||(s[2]=f=>e.unref(r).DisableTime=f)},null,8,["modelValue"])])]),e.unref(m).EnableTime?(e.openBlock(),e.createElementBlock("div",Oh,e.toDisplayString(e.unref(m).EnableTime),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("tr",null,[e.createElementVNode("th",null,[e.createVNode(a,null,{default:e.withCtx(()=>[...s[11]||(s[11]=[e.createTextVNode("內容",-1)])]),_:1})]),e.createElementVNode("td",null,[e.createVNode(n,{error:e.unref(m).Content,modelValue:e.unref(r).Content,"onUpdate:modelValue":s[3]||(s[3]=f=>e.unref(r).Content=f),modelModifiers:{trim:!0}},null,8,["error","modelValue"])])])])])])]),e.createElementVNode("div",null,[e.createElementVNode("div",Lh,[s[13]||(s[13]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關附件")],-1)),e.createVNode(c,{accept:".pdf,.odt,.doc,.docx,.zip",onFile:s[4]||(s[4]=f=>d(e.unref(V),f))})]),s[15]||(s[15]=e.createElementVNode("span",{class:"text-pink"},"支援文件 pdf, odt, doc, docx (10MB以內)、ZIP 壓縮檔 (50MB以內)",-1)),e.createElementVNode("div",Rh,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(V),f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",qh,[e.createElementVNode("a",{class:"tag-link my-1",download:f.Name,href:e.unref(k)(f.Path)},e.toDisplayString(f.Name),9,zh),e.createElementVNode("button",{class:"tag-btn",onClick:t=>f.Deleted=!0,type:"button"},[...s[14]||(s[14]=[e.createElementVNode("i",{class:"fa-solid fa-circle-xmark"},null,-1)])],8,Gh)]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",Jh,[s[16]||(s[16]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關圖片")],-1)),e.createVNode(c,{accept:".jpg,.png",onFile:s[5]||(s[5]=f=>d(e.unref(o),f))})]),s[18]||(s[18]=e.createElementVNode("span",{class:"text-pink"},"支援 JPG, PNG，檔案大小 10MB以內",-1)),e.createElementVNode("div",Yh,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),f=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:f},[f.Deleted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Qh,[e.createElementVNode("img",{alt:"picture",src:e.unref(k)(f.Path)},null,8,Wh),e.createElementVNode("div",Hh,[e.createElementVNode("button",{"aria-label":"移除圖片",class:"btn btn-remove-image",onClick:t=>f.Deleted=!0,type:"button"},[...s[17]||(s[17]=[e.createElementVNode("i",{class:"fa-solid fa-xmark"},null,-1)])],8,Xh)])]))],64))),128))])]),e.createElementVNode("div",null,[e.createElementVNode("div",Kh,[s[20]||(s[20]=e.createElementVNode("h5",{class:"square-title"},[e.createElementVNode("span",null,"相關影片")],-1)),e.createElementVNode("button",{"aria-label":"新增影片",class:"btn btn-teal-dark",onClick:s[6]||(s[6]=f=>e.unref(l).push({})),type:"button"},[...s[19]||(s[19]=[e.createElementVNode("i",{class:"fas fa-plus"},null,-1),e.createTextVNode(" 新增 ",-1)])])]),e.unref(N).length?(e.openBlock(),e.createElementBlock("div",Zh,[e.createElementVNode("table",vh,[s[22]||(s[22]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{width:"80",class:"text-center"},"項次"),e.createElementVNode("th",null,"影片名稱"),e.createElementVNode("th",null,"影片網址"),e.createElementVNode("th",{width:"120"},"功能")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(N),(f,t)=>(e.openBlock(),e.createElementBlock("tr",{key:f},[e.createElementVNode("td",e2,e.toDisplayString(t+1),1),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(m)[`video-${t}-Title`],modelValue:f.Title,"onUpdate:modelValue":p=>f.Title=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createVNode(y,{error:e.unref(m)[`video-${t}-URL`],modelValue:f.URL,"onUpdate:modelValue":p=>f.URL=p,modelModifiers:{trim:!0}},null,8,["error","modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,[e.createElementVNode("div",t2,[e.createElementVNode("button",{"aria-label":"刪除影片",class:"btn btn-sm btn-teal-dark",onClick:p=>f.Deleted=!0,type:"button"},[...s[21]||(s[21]=[e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,l2)])])]))),128))])])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",{class:"block-bottom bg-light-teal"},[e.createElementVNode("button",{class:"btn btn-teal",onClick:u,type:"button"},[...s[23]||(s[23]=[e.createElementVNode("i",{class:"fas fa-check"},null,-1),e.createTextVNode("確認送出",-1)])])])],64)}}},Tooltip:{__name:"Tooltip",setup(B){const _=e.ref();let x;return e.onMounted(()=>{x=new bootstrap.Tooltip(_.value)}),e.onUnmounted(()=>{x&&x.dispose()}),(m,V)=>(e.openBlock(),e.createElementBlock("button",{class:"btn-tooltip",ref_key:"element",ref:_,style:{color:"#027f72"},type:"button"},[...V[0]||(V[0]=[e.createElementVNode("i",{class:"fa-solid fa-circle-info"},null,-1)])],512))}},TwDate:{__name:"TwDate",props:{defaultValue:{default:"",type:String},value:{default:null,type:String}},setup(B){const _=B,x=V=>{const N=V==null?void 0:V.match(/^(\d+)[\/-](\d+)[\/-](\d+)/);return N?`${parseInt(N[1],10)-1911}/${N[2]}/${N[3]}`:""},m=e.ref(x(_.value));return e.watch(()=>_.value,V=>m.value=x(V)),(V,N)=>(e.openBlock(),e.createElementBlock("span",null,e.toDisplayString(e.unref(m)||B.defaultValue),1))}}};return{api:U,install:B=>{for(const _ in le)B.component(_,le[_])},useGrantStore:X,useProgressStore:j}}));
//# sourceMappingURL=ocean-subsidy-components.umd.js.map
